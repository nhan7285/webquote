parcelRequire = function (e, r, n, t) { var i = "function" == typeof parcelRequire && parcelRequire, o = "function" == typeof require && require; function u(n, t) { if (!r[n]) { if (!e[n]) { var f = "function" == typeof parcelRequire && parcelRequire; if (!t && f) return f(n, !0); if (i) return i(n, !0); if (o && "string" == typeof n) return o(n); var c = new Error("Cannot find module '" + n + "'"); throw c.code = "MODULE_NOT_FOUND", c } p.resolve = function (r) { return e[n][1][r] || r }, p.cache = {}; var l = r[n] = new u.Module(n); e[n][0].call(l.exports, p, l, l.exports, this) } return r[n].exports; function p(e) { return u(p.resolve(e)) } } u.isParcelRequire = !0, u.Module = function (e) { this.id = e, this.bundle = u, this.exports = {} }, u.modules = e, u.cache = r, u.parent = i, u.register = function (r, n) { e[r] = [function (e, r) { r.exports = n }, {}] }; for (var f = 0; f < n.length; f++)u(n[f]); if (n.length) { var c = u(n[n.length - 1]); "object" == typeof exports && "undefined" != typeof module ? module.exports = c : "function" == typeof define && define.amd ? define(function () { return c }) : t && (this[t] = c) } return u }({
    "J4Nk": [function (require, module, exports) {
        "use strict"; var r = Object.getOwnPropertySymbols, t = Object.prototype.hasOwnProperty, e = Object.prototype.propertyIsEnumerable; function n(r) { if (null == r) throw new TypeError("Object.assign cannot be called with null or undefined"); return Object(r) } function o() { try { if (!Object.assign) return !1; var r = new String("abc"); if (r[5] = "de", "5" === Object.getOwnPropertyNames(r)[0]) return !1; for (var t = {}, e = 0; e < 10; e++)t["_" + String.fromCharCode(e)] = e; if ("0123456789" !== Object.getOwnPropertyNames(t).map(function (r) { return t[r] }).join("")) return !1; var n = {}; return "abcdefghijklmnopqrst".split("").forEach(function (r) { n[r] = r }), "abcdefghijklmnopqrst" === Object.keys(Object.assign({}, n)).join("") } catch (o) { return !1 } } module.exports = o() ? Object.assign : function (o, c) { for (var a, i, s = n(o), f = 1; f < arguments.length; f++) { for (var u in a = Object(arguments[f])) t.call(a, u) && (s[u] = a[u]); if (r) { i = r(a); for (var b = 0; b < i.length; b++)e.call(a, i[b]) && (s[i[b]] = a[i[b]]) } } return s };
    }, {}], "wRU+": [function (require, module, exports) {
        "use strict"; var e = function (e) { }; function n(n, r, i, o, t, a, f, s) { if (e(r), !n) { var u; if (void 0 === r) u = new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings."); else { var d = [i, o, t, a, f, s], l = 0; (u = new Error(r.replace(/%s/g, function () { return d[l++] }))).name = "Invariant Violation" } throw u.framesToPop = 1, u } } module.exports = n;
    }, {}], "+CtU": [function (require, module, exports) {
        "use strict"; var e = {}; module.exports = e;
    }, {}], "UQex": [function (require, module, exports) {
        "use strict"; function t(t) { return function () { return t } } var n = function () { }; n.thatReturns = t, n.thatReturnsFalse = t(!1), n.thatReturnsTrue = t(!0), n.thatReturnsNull = t(null), n.thatReturnsThis = function () { return this }, n.thatReturnsArgument = function (t) { return t }, module.exports = n;
    }, {}], "awqi": [function (require, module, exports) {
        "use strict"; var e = require("object-assign"), t = require("fbjs/lib/invariant"), r = require("fbjs/lib/emptyObject"), n = require("fbjs/lib/emptyFunction"), o = "function" == typeof Symbol && Symbol.for, u = o ? Symbol.for("react.element") : 60103, l = o ? Symbol.for("react.portal") : 60106, i = o ? Symbol.for("react.fragment") : 60107, f = o ? Symbol.for("react.strict_mode") : 60108, c = o ? Symbol.for("react.profiler") : 60114, a = o ? Symbol.for("react.provider") : 60109, s = o ? Symbol.for("react.context") : 60110, p = o ? Symbol.for("react.async_mode") : 60111, y = o ? Symbol.for("react.forward_ref") : 60112; o && Symbol.for("react.timeout"); var d = "function" == typeof Symbol && Symbol.iterator; function v(e) { for (var r = arguments.length - 1, n = "https://reactjs.org/docs/error-decoder.html?invariant=" + e, o = 0; o < r; o++)n += "&args[]=" + encodeURIComponent(arguments[o + 1]); t(!1, "Minified React error #" + e + "; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ", n) } var h = { isMounted: function () { return !1 }, enqueueForceUpdate: function () { }, enqueueReplaceState: function () { }, enqueueSetState: function () { } }; function m(e, t, n) { this.props = e, this.context = t, this.refs = r, this.updater = n || h } function b() { } function _(e, t, n) { this.props = e, this.context = t, this.refs = r, this.updater = n || h } m.prototype.isReactComponent = {}, m.prototype.setState = function (e, t) { "object" != typeof e && "function" != typeof e && null != e && v("85"), this.updater.enqueueSetState(this, e, t, "setState") }, m.prototype.forceUpdate = function (e) { this.updater.enqueueForceUpdate(this, e, "forceUpdate") }, b.prototype = m.prototype; var S = _.prototype = new b; S.constructor = _, e(S, m.prototype), S.isPureReactComponent = !0; var g = { current: null }, k = Object.prototype.hasOwnProperty, $ = { key: !0, ref: !0, __self: !0, __source: !0 }; function j(e, t, r) { var n = void 0, o = {}, l = null, i = null; if (null != t) for (n in void 0 !== t.ref && (i = t.ref), void 0 !== t.key && (l = "" + t.key), t) k.call(t, n) && !$.hasOwnProperty(n) && (o[n] = t[n]); var f = arguments.length - 2; if (1 === f) o.children = r; else if (1 < f) { for (var c = Array(f), a = 0; a < f; a++)c[a] = arguments[a + 2]; o.children = c } if (e && e.defaultProps) for (n in f = e.defaultProps) void 0 === o[n] && (o[n] = f[n]); return { $$typeof: u, type: e, key: l, ref: i, props: o, _owner: g.current } } function w(e) { return "object" == typeof e && null !== e && e.$$typeof === u } function x(e) { var t = { "=": "=0", ":": "=2" }; return "$" + ("" + e).replace(/[=:]/g, function (e) { return t[e] }) } var P = /\/+/g, R = []; function C(e, t, r, n) { if (R.length) { var o = R.pop(); return o.result = e, o.keyPrefix = t, o.func = r, o.context = n, o.count = 0, o } return { result: e, keyPrefix: t, func: r, context: n, count: 0 } } function O(e) { e.result = null, e.keyPrefix = null, e.func = null, e.context = null, e.count = 0, 10 > R.length && R.push(e) } function A(e, t, r, n) { var o = typeof e; "undefined" !== o && "boolean" !== o || (e = null); var i = !1; if (null === e) i = !0; else switch (o) { case "string": case "number": i = !0; break; case "object": switch (e.$$typeof) { case u: case l: i = !0 } }if (i) return r(n, e, "" === t ? "." + E(e, 0) : t), 1; if (i = 0, t = "" === t ? "." : t + ":", Array.isArray(e)) for (var f = 0; f < e.length; f++) { var c = t + E(o = e[f], f); i += A(o, c, r, n) } else if (null == e ? c = null : c = "function" == typeof (c = d && e[d] || e["@@iterator"]) ? c : null, "function" == typeof c) for (e = c.call(e), f = 0; !(o = e.next()).done;)i += A(o = o.value, c = t + E(o, f++), r, n); else "object" === o && v("31", "[object Object]" === (r = "" + e) ? "object with keys {" + Object.keys(e).join(", ") + "}" : r, ""); return i } function E(e, t) { return "object" == typeof e && null !== e && null != e.key ? x(e.key) : t.toString(36) } function q(e, t) { e.func.call(e.context, t, e.count++) } function U(e, t, r) { var o = e.result, l = e.keyPrefix; e = e.func.call(e.context, t, e.count++), Array.isArray(e) ? F(e, o, r, n.thatReturnsArgument) : null != e && (w(e) && (t = l + (!e.key || t && t.key === e.key ? "" : ("" + e.key).replace(P, "$&/") + "/") + r, e = { $$typeof: u, type: e.type, key: t, ref: e.ref, props: e.props, _owner: e._owner }), o.push(e)) } function F(e, t, r, n, o) { var u = ""; null != r && (u = ("" + r).replace(P, "$&/") + "/"), t = C(t, u, n, o), null == e || A(e, "", U, t), O(t) } var B = { Children: { map: function (e, t, r) { if (null == e) return e; var n = []; return F(e, n, null, t, r), n }, forEach: function (e, t, r) { if (null == e) return e; t = C(null, null, t, r), null == e || A(e, "", q, t), O(t) }, count: function (e) { return null == e ? 0 : A(e, "", n.thatReturnsNull, null) }, toArray: function (e) { var t = []; return F(e, t, null, n.thatReturnsArgument), t }, only: function (e) { return w(e) || v("143"), e } }, createRef: function () { return { current: null } }, Component: m, PureComponent: _, createContext: function (e, t) { return void 0 === t && (t = null), (e = { $$typeof: s, _calculateChangedBits: t, _defaultValue: e, _currentValue: e, _currentValue2: e, _changedBits: 0, _changedBits2: 0, Provider: null, Consumer: null }).Provider = { $$typeof: a, _context: e }, e.Consumer = e }, forwardRef: function (e) { return { $$typeof: y, render: e } }, Fragment: i, StrictMode: f, unstable_AsyncMode: p, unstable_Profiler: c, createElement: j, cloneElement: function (t, r, n) { null == t && v("267", t); var o = void 0, l = e({}, t.props), i = t.key, f = t.ref, c = t._owner; if (null != r) { void 0 !== r.ref && (f = r.ref, c = g.current), void 0 !== r.key && (i = "" + r.key); var a = void 0; for (o in t.type && t.type.defaultProps && (a = t.type.defaultProps), r) k.call(r, o) && !$.hasOwnProperty(o) && (l[o] = void 0 === r[o] && void 0 !== a ? a[o] : r[o]) } if (1 === (o = arguments.length - 2)) l.children = n; else if (1 < o) { a = Array(o); for (var s = 0; s < o; s++)a[s] = arguments[s + 2]; l.children = a } return { $$typeof: u, type: t.type, key: i, ref: f, props: l, _owner: c } }, createFactory: function (e) { var t = j.bind(null, e); return t.type = e, t }, isValidElement: w, version: "16.4.1", __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED: { ReactCurrentOwner: g, assign: e } }, I = { default: B }, M = I && B || I; module.exports = M.default ? M.default : M;
    }, { "object-assign": "J4Nk", "fbjs/lib/invariant": "wRU+", "fbjs/lib/emptyObject": "+CtU", "fbjs/lib/emptyFunction": "UQex" }], "1n8/": [function (require, module, exports) {
        "use strict"; module.exports = require("./cjs/react.production.min.js");
    }, { "./cjs/react.production.min.js": "awqi" }], "KW17": [function (require, module, exports) {
        "use strict"; var e = !("undefined" == typeof window || !window.document || !window.document.createElement), n = { canUseDOM: e, canUseWorkers: "undefined" != typeof Worker, canUseEventListeners: e && !(!window.addEventListener && !window.attachEvent), canUseViewport: e && !!window.screen, isInWorker: !e }; module.exports = n;
    }, {}], "XeWd": [function (require, module, exports) {
        "use strict"; function e(e) { if (void 0 === (e = e || ("undefined" != typeof document ? document : void 0))) return null; try { return e.activeElement || e.body } catch (t) { return e.body } } module.exports = e;
    }, {}], "lyLi": [function (require, module, exports) {
        "use strict"; var t = Object.prototype.hasOwnProperty; function e(t, e) { return t === e ? 0 !== t || 0 !== e || 1 / t == 1 / e : t != t && e != e } function r(r, n) { if (e(r, n)) return !0; if ("object" != typeof r || null === r || "object" != typeof n || null === n) return !1; var o = Object.keys(r), u = Object.keys(n); if (o.length !== u.length) return !1; for (var l = 0; l < o.length; l++)if (!t.call(n, o[l]) || !e(r[o[l]], n[o[l]])) return !1; return !0 } module.exports = r;
    }, {}], "kKLW": [function (require, module, exports) {
        "use strict"; function e(e) { var o = (e ? e.ownerDocument || e : document).defaultView || window; return !(!e || !("function" == typeof o.Node ? e instanceof o.Node : "object" == typeof e && "number" == typeof e.nodeType && "string" == typeof e.nodeName)) } module.exports = e;
    }, {}], "RiJr": [function (require, module, exports) {
        "use strict"; var e = require("./isNode"); function r(r) { return e(r) && 3 == r.nodeType } module.exports = r;
    }, { "./isNode": "kKLW" }], "epr4": [function (require, module, exports) {
        "use strict"; var o = require("./isTextNode"); function e(n, t) { return !(!n || !t) && (n === t || !o(n) && (o(t) ? e(n, t.parentNode) : "contains" in n ? n.contains(t) : !!n.compareDocumentPosition && !!(16 & n.compareDocumentPosition(t)))) } module.exports = e;
    }, { "./isTextNode": "RiJr" }], "i17t": [function (require, module, exports) {
        "use strict"; var e = require("fbjs/lib/invariant"), t = require("react"), n = require("fbjs/lib/ExecutionEnvironment"), r = require("object-assign"), a = require("fbjs/lib/emptyFunction"), l = require("fbjs/lib/getActiveElement"), o = require("fbjs/lib/shallowEqual"), i = require("fbjs/lib/containsNode"), u = require("fbjs/lib/emptyObject"); function c(t) { for (var n = arguments.length - 1, r = "https://reactjs.org/docs/error-decoder.html?invariant=" + t, a = 0; a < n; a++)r += "&args[]=" + encodeURIComponent(arguments[a + 1]); e(!1, "Minified React error #" + t + "; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ", r) } function s(e, t, n, r, a, l, o, i, u) { this._hasCaughtError = !1, this._caughtError = null; var c = Array.prototype.slice.call(arguments, 3); try { t.apply(n, c) } catch (s) { this._caughtError = s, this._hasCaughtError = !0 } } t || c("227"); var f = { _caughtError: null, _hasCaughtError: !1, _rethrowError: null, _hasRethrowError: !1, invokeGuardedCallback: function (e, t, n, r, a, l, o, i, u) { s.apply(f, arguments) }, invokeGuardedCallbackAndCatchFirstError: function (e, t, n, r, a, l, o, i, u) { if (f.invokeGuardedCallback.apply(this, arguments), f.hasCaughtError()) { var c = f.clearCaughtError(); f._hasRethrowError || (f._hasRethrowError = !0, f._rethrowError = c) } }, rethrowCaughtError: function () { return d.apply(f, arguments) }, hasCaughtError: function () { return f._hasCaughtError }, clearCaughtError: function () { if (f._hasCaughtError) { var e = f._caughtError; return f._caughtError = null, f._hasCaughtError = !1, e } c("198") } }; function d() { if (f._hasRethrowError) { var e = f._rethrowError; throw f._rethrowError = null, f._hasRethrowError = !1, e } } var p = null, m = {}; function h() { if (p) for (var e in m) { var t = m[e], n = p.indexOf(e); if (-1 < n || c("96", e), !g[n]) for (var r in t.extractEvents || c("97", e), g[n] = t, n = t.eventTypes) { var a = void 0, l = n[r], o = t, i = r; y.hasOwnProperty(i) && c("99", i), y[i] = l; var u = l.phasedRegistrationNames; if (u) { for (a in u) u.hasOwnProperty(a) && v(u[a], o, i); a = !0 } else l.registrationName ? (v(l.registrationName, o, i), a = !0) : a = !1; a || c("98", r, e) } } } function v(e, t, n) { b[e] && c("100", e), b[e] = t, k[e] = t.eventTypes[n].dependencies } var g = [], y = {}, b = {}, k = {}; function w(e) { p && c("101"), p = Array.prototype.slice.call(e), h() } function x(e) { var t, n = !1; for (t in e) if (e.hasOwnProperty(t)) { var r = e[t]; m.hasOwnProperty(t) && m[t] === r || (m[t] && c("102", t), m[t] = r, n = !0) } n && h() } var C = { plugins: g, eventNameDispatchConfigs: y, registrationNameModules: b, registrationNameDependencies: k, possibleRegistrationNames: null, injectEventPluginOrder: w, injectEventPluginsByName: x }, E = null, T = null, _ = null; function S(e, t, n, r) { t = e.type || "unknown-event", e.currentTarget = _(r), f.invokeGuardedCallbackAndCatchFirstError(t, n, void 0, e), e.currentTarget = null } function P(e, t) { return null == t && c("30"), null == e ? t : Array.isArray(e) ? Array.isArray(t) ? (e.push.apply(e, t), e) : (e.push(t), e) : Array.isArray(t) ? [e].concat(t) : [e, t] } function N(e, t, n) { Array.isArray(e) ? e.forEach(t, n) : e && t.call(n, e) } var U = null; function F(e, t) { if (e) { var n = e._dispatchListeners, r = e._dispatchInstances; if (Array.isArray(n)) for (var a = 0; a < n.length && !e.isPropagationStopped(); a++)S(e, t, n[a], r[a]); else n && S(e, t, n, r); e._dispatchListeners = null, e._dispatchInstances = null, e.isPersistent() || e.constructor.release(e) } } function I(e) { return F(e, !0) } function M(e) { return F(e, !1) } var R = { injectEventPluginOrder: w, injectEventPluginsByName: x }; function z(e, t) { var n = e.stateNode; if (!n) return null; var r = E(n); if (!r) return null; n = r[t]; e: switch (t) { case "onClick": case "onClickCapture": case "onDoubleClick": case "onDoubleClickCapture": case "onMouseDown": case "onMouseDownCapture": case "onMouseMove": case "onMouseMoveCapture": case "onMouseUp": case "onMouseUpCapture": (r = !r.disabled) || (r = !("button" === (e = e.type) || "input" === e || "select" === e || "textarea" === e)), e = !r; break e; default: e = !1 }return e ? null : (n && "function" != typeof n && c("231", t, typeof n), n) } function O(e, t) { null !== e && (U = P(U, e)), e = U, U = null, e && (N(e, t ? I : M), U && c("95"), f.rethrowCaughtError()) } function D(e, t, n, r) { for (var a = null, l = 0; l < g.length; l++) { var o = g[l]; o && (o = o.extractEvents(e, t, n, r)) && (a = P(a, o)) } O(a, !1) } var L = { injection: R, getListener: z, runEventsInBatch: O, runExtractedEventsInBatch: D }, A = Math.random().toString(36).slice(2), j = "__reactInternalInstance$" + A, W = "__reactEventHandlers$" + A; function B(e) { if (e[j]) return e[j]; for (; !e[j];) { if (!e.parentNode) return null; e = e.parentNode } return 5 === (e = e[j]).tag || 6 === e.tag ? e : null } function V(e) { if (5 === e.tag || 6 === e.tag) return e.stateNode; c("33") } function H(e) { return e[W] || null } var Q = { precacheFiberNode: function (e, t) { t[j] = e }, getClosestInstanceFromNode: B, getInstanceFromNode: function (e) { return !(e = e[j]) || 5 !== e.tag && 6 !== e.tag ? null : e }, getNodeFromInstance: V, getFiberCurrentPropsFromNode: H, updateFiberProps: function (e, t) { e[W] = t } }; function q(e) { do { e = e.return } while (e && 5 !== e.tag); return e || null } function K(e, t, n) { for (var r = []; e;)r.push(e), e = q(e); for (e = r.length; 0 < e--;)t(r[e], "captured", n); for (e = 0; e < r.length; e++)t(r[e], "bubbled", n) } function $(e, t, n) { (t = z(e, n.dispatchConfig.phasedRegistrationNames[t])) && (n._dispatchListeners = P(n._dispatchListeners, t), n._dispatchInstances = P(n._dispatchInstances, e)) } function Y(e) { e && e.dispatchConfig.phasedRegistrationNames && K(e._targetInst, $, e) } function X(e) { if (e && e.dispatchConfig.phasedRegistrationNames) { var t = e._targetInst; K(t = t ? q(t) : null, $, e) } } function G(e, t, n) { e && n && n.dispatchConfig.registrationName && (t = z(e, n.dispatchConfig.registrationName)) && (n._dispatchListeners = P(n._dispatchListeners, t), n._dispatchInstances = P(n._dispatchInstances, e)) } function Z(e) { e && e.dispatchConfig.registrationName && G(e._targetInst, null, e) } function J(e) { N(e, Y) } function ee(e, t, n, r) { if (n && r) e: { for (var a = n, l = r, o = 0, i = a; i; i = q(i))o++; i = 0; for (var u = l; u; u = q(u))i++; for (; 0 < o - i;)a = q(a), o--; for (; 0 < i - o;)l = q(l), i--; for (; o--;) { if (a === l || a === l.alternate) break e; a = q(a), l = q(l) } a = null } else a = null; for (l = a, a = []; n && n !== l && (null === (o = n.alternate) || o !== l);)a.push(n), n = q(n); for (n = []; r && r !== l && (null === (o = r.alternate) || o !== l);)n.push(r), r = q(r); for (r = 0; r < a.length; r++)G(a[r], "bubbled", e); for (e = n.length; 0 < e--;)G(n[e], "captured", t) } var te = { accumulateTwoPhaseDispatches: J, accumulateTwoPhaseDispatchesSkipTarget: function (e) { N(e, X) }, accumulateEnterLeaveDispatches: ee, accumulateDirectDispatches: function (e) { N(e, Z) } }; function ne(e, t) { var n = {}; return n[e.toLowerCase()] = t.toLowerCase(), n["Webkit" + e] = "webkit" + t, n["Moz" + e] = "moz" + t, n["ms" + e] = "MS" + t, n["O" + e] = "o" + t.toLowerCase(), n } var re = { animationend: ne("Animation", "AnimationEnd"), animationiteration: ne("Animation", "AnimationIteration"), animationstart: ne("Animation", "AnimationStart"), transitionend: ne("Transition", "TransitionEnd") }, ae = {}, le = {}; function oe(e) { if (ae[e]) return ae[e]; if (!re[e]) return e; var t, n = re[e]; for (t in n) if (n.hasOwnProperty(t) && t in le) return ae[e] = n[t]; return e } n.canUseDOM && (le = document.createElement("div").style, "AnimationEvent" in window || (delete re.animationend.animation, delete re.animationiteration.animation, delete re.animationstart.animation), "TransitionEvent" in window || delete re.transitionend.transition); var ie = oe("animationend"), ue = oe("animationiteration"), ce = oe("animationstart"), se = oe("transitionend"), fe = "abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "), de = null; function pe() { return !de && n.canUseDOM && (de = "textContent" in document.documentElement ? "textContent" : "innerText"), de } var me = { _root: null, _startText: null, _fallbackText: null }; function he() { if (me._fallbackText) return me._fallbackText; var e, t, n = me._startText, r = n.length, a = ve(), l = a.length; for (e = 0; e < r && n[e] === a[e]; e++); var o = r - e; for (t = 1; t <= o && n[r - t] === a[l - t]; t++); return me._fallbackText = a.slice(e, 1 < t ? 1 - t : void 0), me._fallbackText } function ve() { return "value" in me._root ? me._root.value : me._root[pe()] } var ge = "dispatchConfig _targetInst nativeEvent isDefaultPrevented isPropagationStopped _dispatchListeners _dispatchInstances".split(" "), ye = { type: null, target: null, currentTarget: a.thatReturnsNull, eventPhase: null, bubbles: null, cancelable: null, timeStamp: function (e) { return e.timeStamp || Date.now() }, defaultPrevented: null, isTrusted: null }; function be(e, t, n, r) { for (var l in this.dispatchConfig = e, this._targetInst = t, this.nativeEvent = n, e = this.constructor.Interface) e.hasOwnProperty(l) && ((t = e[l]) ? this[l] = t(n) : "target" === l ? this.target = r : this[l] = n[l]); return this.isDefaultPrevented = (null != n.defaultPrevented ? n.defaultPrevented : !1 === n.returnValue) ? a.thatReturnsTrue : a.thatReturnsFalse, this.isPropagationStopped = a.thatReturnsFalse, this } function ke(e, t, n, r) { if (this.eventPool.length) { var a = this.eventPool.pop(); return this.call(a, e, t, n, r), a } return new this(e, t, n, r) } function we(e) { e instanceof this || c("223"), e.destructor(), 10 > this.eventPool.length && this.eventPool.push(e) } function xe(e) { e.eventPool = [], e.getPooled = ke, e.release = we } r(be.prototype, { preventDefault: function () { this.defaultPrevented = !0; var e = this.nativeEvent; e && (e.preventDefault ? e.preventDefault() : "unknown" != typeof e.returnValue && (e.returnValue = !1), this.isDefaultPrevented = a.thatReturnsTrue) }, stopPropagation: function () { var e = this.nativeEvent; e && (e.stopPropagation ? e.stopPropagation() : "unknown" != typeof e.cancelBubble && (e.cancelBubble = !0), this.isPropagationStopped = a.thatReturnsTrue) }, persist: function () { this.isPersistent = a.thatReturnsTrue }, isPersistent: a.thatReturnsFalse, destructor: function () { var e, t = this.constructor.Interface; for (e in t) this[e] = null; for (t = 0; t < ge.length; t++)this[ge[t]] = null } }), be.Interface = ye, be.extend = function (e) { function t() { } function n() { return a.apply(this, arguments) } var a = this; t.prototype = a.prototype; var l = new t; return r(l, n.prototype), n.prototype = l, n.prototype.constructor = n, n.Interface = r({}, a.Interface, e), n.extend = a.extend, xe(n), n }, xe(be); var Ce = be.extend({ data: null }), Ee = be.extend({ data: null }), Te = [9, 13, 27, 32], _e = n.canUseDOM && "CompositionEvent" in window, Se = null; n.canUseDOM && "documentMode" in document && (Se = document.documentMode); var Pe = n.canUseDOM && "TextEvent" in window && !Se, Ne = n.canUseDOM && (!_e || Se && 8 < Se && 11 >= Se), Ue = String.fromCharCode(32), Fe = { beforeInput: { phasedRegistrationNames: { bubbled: "onBeforeInput", captured: "onBeforeInputCapture" }, dependencies: ["compositionend", "keypress", "textInput", "paste"] }, compositionEnd: { phasedRegistrationNames: { bubbled: "onCompositionEnd", captured: "onCompositionEndCapture" }, dependencies: "blur compositionend keydown keypress keyup mousedown".split(" ") }, compositionStart: { phasedRegistrationNames: { bubbled: "onCompositionStart", captured: "onCompositionStartCapture" }, dependencies: "blur compositionstart keydown keypress keyup mousedown".split(" ") }, compositionUpdate: { phasedRegistrationNames: { bubbled: "onCompositionUpdate", captured: "onCompositionUpdateCapture" }, dependencies: "blur compositionupdate keydown keypress keyup mousedown".split(" ") } }, Ie = !1; function Me(e, t) { switch (e) { case "keyup": return -1 !== Te.indexOf(t.keyCode); case "keydown": return 229 !== t.keyCode; case "keypress": case "mousedown": case "blur": return !0; default: return !1 } } function Re(e) { return "object" == typeof (e = e.detail) && "data" in e ? e.data : null } var ze = !1; function Oe(e, t) { switch (e) { case "compositionend": return Re(t); case "keypress": return 32 !== t.which ? null : (Ie = !0, Ue); case "textInput": return (e = t.data) === Ue && Ie ? null : e; default: return null } } function De(e, t) { if (ze) return "compositionend" === e || !_e && Me(e, t) ? (e = he(), me._root = null, me._startText = null, me._fallbackText = null, ze = !1, e) : null; switch (e) { case "paste": return null; case "keypress": if (!(t.ctrlKey || t.altKey || t.metaKey) || t.ctrlKey && t.altKey) { if (t.char && 1 < t.char.length) return t.char; if (t.which) return String.fromCharCode(t.which) } return null; case "compositionend": return Ne ? null : t.data; default: return null } } var Le = { eventTypes: Fe, extractEvents: function (e, t, n, r) { var a = void 0, l = void 0; if (_e) e: { switch (e) { case "compositionstart": a = Fe.compositionStart; break e; case "compositionend": a = Fe.compositionEnd; break e; case "compositionupdate": a = Fe.compositionUpdate; break e }a = void 0 } else ze ? Me(e, n) && (a = Fe.compositionEnd) : "keydown" === e && 229 === n.keyCode && (a = Fe.compositionStart); return a ? (Ne && (ze || a !== Fe.compositionStart ? a === Fe.compositionEnd && ze && (l = he()) : (me._root = r, me._startText = ve(), ze = !0)), a = Ce.getPooled(a, t, n, r), l ? a.data = l : null !== (l = Re(n)) && (a.data = l), J(a), l = a) : l = null, (e = Pe ? Oe(e, n) : De(e, n)) ? ((t = Ee.getPooled(Fe.beforeInput, t, n, r)).data = e, J(t)) : t = null, null === l ? t : null === t ? l : [l, t] } }, Ae = null, je = { injectFiberControlledHostComponent: function (e) { Ae = e } }, We = null, Be = null; function Ve(e) { if (e = T(e)) { Ae && "function" == typeof Ae.restoreControlledState || c("194"); var t = E(e.stateNode); Ae.restoreControlledState(e.stateNode, e.type, t) } } function He(e) { We ? Be ? Be.push(e) : Be = [e] : We = e } function Qe() { return null !== We || null !== Be } function qe() { if (We) { var e = We, t = Be; if (Be = We = null, Ve(e), t) for (e = 0; e < t.length; e++)Ve(t[e]) } } var Ke = { injection: je, enqueueStateRestore: He, needsStateRestore: Qe, restoreStateIfNeeded: qe }; function $e(e, t) { return e(t) } function Ye(e, t, n) { return e(t, n) } function Xe() { } var Ge = !1; function Ze(e, t) { if (Ge) return e(t); Ge = !0; try { return $e(e, t) } finally { Ge = !1, Qe() && (Xe(), qe()) } } var Je = { color: !0, date: !0, datetime: !0, "datetime-local": !0, email: !0, month: !0, number: !0, password: !0, range: !0, search: !0, tel: !0, text: !0, time: !0, url: !0, week: !0 }; function et(e) { var t = e && e.nodeName && e.nodeName.toLowerCase(); return "input" === t ? !!Je[e.type] : "textarea" === t } function tt(e) { return (e = e.target || e.srcElement || window).correspondingUseElement && (e = e.correspondingUseElement), 3 === e.nodeType ? e.parentNode : e } function nt(e, t) { return !(!n.canUseDOM || t && !("addEventListener" in document)) && ((t = (e = "on" + e) in document) || ((t = document.createElement("div")).setAttribute(e, "return;"), t = "function" == typeof t[e]), t) } function rt(e) { var t = e.type; return (e = e.nodeName) && "input" === e.toLowerCase() && ("checkbox" === t || "radio" === t) } function at(e) { var t = rt(e) ? "checked" : "value", n = Object.getOwnPropertyDescriptor(e.constructor.prototype, t), r = "" + e[t]; if (!e.hasOwnProperty(t) && void 0 !== n && "function" == typeof n.get && "function" == typeof n.set) { var a = n.get, l = n.set; return Object.defineProperty(e, t, { configurable: !0, get: function () { return a.call(this) }, set: function (e) { r = "" + e, l.call(this, e) } }), Object.defineProperty(e, t, { enumerable: n.enumerable }), { getValue: function () { return r }, setValue: function (e) { r = "" + e }, stopTracking: function () { e._valueTracker = null, delete e[t] } } } } function lt(e) { e._valueTracker || (e._valueTracker = at(e)) } function ot(e) { if (!e) return !1; var t = e._valueTracker; if (!t) return !0; var n = t.getValue(), r = ""; return e && (r = rt(e) ? e.checked ? "true" : "false" : e.value), (e = r) !== n && (t.setValue(e), !0) } var it = t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner, ut = "function" == typeof Symbol && Symbol.for, ct = ut ? Symbol.for("react.element") : 60103, st = ut ? Symbol.for("react.portal") : 60106, ft = ut ? Symbol.for("react.fragment") : 60107, dt = ut ? Symbol.for("react.strict_mode") : 60108, pt = ut ? Symbol.for("react.profiler") : 60114, mt = ut ? Symbol.for("react.provider") : 60109, ht = ut ? Symbol.for("react.context") : 60110, vt = ut ? Symbol.for("react.async_mode") : 60111, gt = ut ? Symbol.for("react.forward_ref") : 60112, yt = ut ? Symbol.for("react.timeout") : 60113, bt = "function" == typeof Symbol && Symbol.iterator; function kt(e) { return null == e ? null : "function" == typeof (e = bt && e[bt] || e["@@iterator"]) ? e : null } function wt(e) { var t = e.type; if ("function" == typeof t) return t.displayName || t.name; if ("string" == typeof t) return t; switch (t) { case vt: return "AsyncMode"; case ht: return "Context.Consumer"; case ft: return "ReactFragment"; case st: return "ReactPortal"; case pt: return "Profiler(" + e.pendingProps.id + ")"; case mt: return "Context.Provider"; case dt: return "StrictMode"; case yt: return "Timeout" }if ("object" == typeof t && null !== t) switch (t.$$typeof) { case gt: return "" !== (e = t.render.displayName || t.render.name || "") ? "ForwardRef(" + e + ")" : "ForwardRef" }return null } function xt(e) { var t = ""; do { e: switch (e.tag) { case 0: case 1: case 2: case 5: var n = e._debugOwner, r = e._debugSource, a = wt(e), l = null; n && (l = wt(n)), a = "\n    in " + (a || "Unknown") + ((n = r) ? " (at " + n.fileName.replace(/^.*[\\\/]/, "") + ":" + n.lineNumber + ")" : l ? " (created by " + l + ")" : ""); break e; default: a = "" }t += a, e = e.return } while (e); return t } var Ct = /^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/, Et = {}, Tt = {}; function _t(e) { return !!Tt.hasOwnProperty(e) || !Et.hasOwnProperty(e) && (Ct.test(e) ? Tt[e] = !0 : (Et[e] = !0, !1)) } function St(e, t, n, r) { if (null !== n && 0 === n.type) return !1; switch (typeof t) { case "function": case "symbol": return !0; case "boolean": return !r && (null !== n ? !n.acceptsBooleans : "data-" !== (e = e.toLowerCase().slice(0, 5)) && "aria-" !== e); default: return !1 } } function Pt(e, t, n, r) { if (null == t || St(e, t, n, r)) return !0; if (r) return !1; if (null !== n) switch (n.type) { case 3: return !t; case 4: return !1 === t; case 5: return isNaN(t); case 6: return isNaN(t) || 1 > t }return !1 } function Nt(e, t, n, r, a) { this.acceptsBooleans = 2 === t || 3 === t || 4 === t, this.attributeName = r, this.attributeNamespace = a, this.mustUseProperty = n, this.propertyName = e, this.type = t } var Ut = {}; "children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function (e) { Ut[e] = new Nt(e, 0, !1, e, null) }), [["acceptCharset", "accept-charset"], ["className", "class"], ["htmlFor", "for"], ["httpEquiv", "http-equiv"]].forEach(function (e) { var t = e[0]; Ut[t] = new Nt(t, 1, !1, e[1], null) }), ["contentEditable", "draggable", "spellCheck", "value"].forEach(function (e) { Ut[e] = new Nt(e, 2, !1, e.toLowerCase(), null) }), ["autoReverse", "externalResourcesRequired", "preserveAlpha"].forEach(function (e) { Ut[e] = new Nt(e, 2, !1, e, null) }), "allowFullScreen async autoFocus autoPlay controls default defer disabled formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function (e) { Ut[e] = new Nt(e, 3, !1, e.toLowerCase(), null) }), ["checked", "multiple", "muted", "selected"].forEach(function (e) { Ut[e] = new Nt(e, 3, !0, e.toLowerCase(), null) }), ["capture", "download"].forEach(function (e) { Ut[e] = new Nt(e, 4, !1, e.toLowerCase(), null) }), ["cols", "rows", "size", "span"].forEach(function (e) { Ut[e] = new Nt(e, 6, !1, e.toLowerCase(), null) }), ["rowSpan", "start"].forEach(function (e) { Ut[e] = new Nt(e, 5, !1, e.toLowerCase(), null) }); var Ft = /[\-:]([a-z])/g; function It(e) { return e[1].toUpperCase() } function Mt(e, t, n, r) { var a = Ut.hasOwnProperty(t) ? Ut[t] : null; (null !== a ? 0 === a.type : !r && (2 < t.length && ("o" === t[0] || "O" === t[0]) && ("n" === t[1] || "N" === t[1]))) || (Pt(t, n, a, r) && (n = null), r || null === a ? _t(t) && (null === n ? e.removeAttribute(t) : e.setAttribute(t, "" + n)) : a.mustUseProperty ? e[a.propertyName] = null === n ? 3 !== a.type && "" : n : (t = a.attributeName, r = a.attributeNamespace, null === n ? e.removeAttribute(t) : (n = 3 === (a = a.type) || 4 === a && !0 === n ? "" : "" + n, r ? e.setAttributeNS(r, t, n) : e.setAttribute(t, n)))) } function Rt(e, t) { var n = t.checked; return r({}, t, { defaultChecked: void 0, defaultValue: void 0, value: void 0, checked: null != n ? n : e._wrapperState.initialChecked }) } function zt(e, t) { var n = null == t.defaultValue ? "" : t.defaultValue, r = null != t.checked ? t.checked : t.defaultChecked; n = jt(null != t.value ? t.value : n), e._wrapperState = { initialChecked: r, initialValue: n, controlled: "checkbox" === t.type || "radio" === t.type ? null != t.checked : null != t.value } } function Ot(e, t) { null != (t = t.checked) && Mt(e, "checked", t, !1) } function Dt(e, t) { Ot(e, t); var n = jt(t.value); null != n && ("number" === t.type ? (0 === n && "" === e.value || e.value != n) && (e.value = "" + n) : e.value !== "" + n && (e.value = "" + n)), t.hasOwnProperty("value") ? At(e, t.type, n) : t.hasOwnProperty("defaultValue") && At(e, t.type, jt(t.defaultValue)), null == t.checked && null != t.defaultChecked && (e.defaultChecked = !!t.defaultChecked) } function Lt(e, t, n) { if (t.hasOwnProperty("value") || t.hasOwnProperty("defaultValue")) { t = "" + e._wrapperState.initialValue; var r = e.value; n || t === r || (e.value = t), e.defaultValue = t } "" !== (n = e.name) && (e.name = ""), e.defaultChecked = !e.defaultChecked, e.defaultChecked = !e.defaultChecked, "" !== n && (e.name = n) } function At(e, t, n) { "number" === t && e.ownerDocument.activeElement === e || (null == n ? e.defaultValue = "" + e._wrapperState.initialValue : e.defaultValue !== "" + n && (e.defaultValue = "" + n)) } function jt(e) { switch (typeof e) { case "boolean": case "number": case "object": case "string": case "undefined": return e; default: return "" } } "accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function (e) { var t = e.replace(Ft, It); Ut[t] = new Nt(t, 1, !1, e, null) }), "xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function (e) { var t = e.replace(Ft, It); Ut[t] = new Nt(t, 1, !1, e, "http://www.w3.org/1999/xlink") }), ["xml:base", "xml:lang", "xml:space"].forEach(function (e) { var t = e.replace(Ft, It); Ut[t] = new Nt(t, 1, !1, e, "http://www.w3.org/XML/1998/namespace") }), Ut.tabIndex = new Nt("tabIndex", 1, !1, "tabindex", null); var Wt = { change: { phasedRegistrationNames: { bubbled: "onChange", captured: "onChangeCapture" }, dependencies: "blur change click focus input keydown keyup selectionchange".split(" ") } }; function Bt(e, t, n) { return (e = be.getPooled(Wt.change, e, t, n)).type = "change", He(n), J(e), e } var Vt = null, Ht = null; function Qt(e) { O(e, !1) } function qt(e) { if (ot(V(e))) return e } function Kt(e, t) { if ("change" === e) return t } var $t = !1; function Yt() { Vt && (Vt.detachEvent("onpropertychange", Xt), Ht = Vt = null) } function Xt(e) { "value" === e.propertyName && qt(Ht) && Ze(Qt, e = Bt(Ht, e, tt(e))) } function Gt(e, t, n) { "focus" === e ? (Yt(), Ht = n, (Vt = t).attachEvent("onpropertychange", Xt)) : "blur" === e && Yt() } function Zt(e) { if ("selectionchange" === e || "keyup" === e || "keydown" === e) return qt(Ht) } function Jt(e, t) { if ("click" === e) return qt(t) } function en(e, t) { if ("input" === e || "change" === e) return qt(t) } n.canUseDOM && ($t = nt("input") && (!document.documentMode || 9 < document.documentMode)); var tn = { eventTypes: Wt, _isInputEventSupported: $t, extractEvents: function (e, t, n, r) { var a = t ? V(t) : window, l = void 0, o = void 0, i = a.nodeName && a.nodeName.toLowerCase(); if ("select" === i || "input" === i && "file" === a.type ? l = Kt : et(a) ? $t ? l = en : (l = Zt, o = Gt) : (i = a.nodeName) && "input" === i.toLowerCase() && ("checkbox" === a.type || "radio" === a.type) && (l = Jt), l && (l = l(e, t))) return Bt(l, n, r); o && o(e, a, t), "blur" === e && (e = a._wrapperState) && e.controlled && "number" === a.type && At(a, "number", a.value) } }, nn = be.extend({ view: null, detail: null }), rn = { Alt: "altKey", Control: "ctrlKey", Meta: "metaKey", Shift: "shiftKey" }; function an(e) { var t = this.nativeEvent; return t.getModifierState ? t.getModifierState(e) : !!(e = rn[e]) && !!t[e] } function ln() { return an } var on = nn.extend({ screenX: null, screenY: null, clientX: null, clientY: null, pageX: null, pageY: null, ctrlKey: null, shiftKey: null, altKey: null, metaKey: null, getModifierState: ln, button: null, buttons: null, relatedTarget: function (e) { return e.relatedTarget || (e.fromElement === e.srcElement ? e.toElement : e.fromElement) } }), un = on.extend({ pointerId: null, width: null, height: null, pressure: null, tiltX: null, tiltY: null, pointerType: null, isPrimary: null }), cn = { mouseEnter: { registrationName: "onMouseEnter", dependencies: ["mouseout", "mouseover"] }, mouseLeave: { registrationName: "onMouseLeave", dependencies: ["mouseout", "mouseover"] }, pointerEnter: { registrationName: "onPointerEnter", dependencies: ["pointerout", "pointerover"] }, pointerLeave: { registrationName: "onPointerLeave", dependencies: ["pointerout", "pointerover"] } }, sn = { eventTypes: cn, extractEvents: function (e, t, n, r) { var a = "mouseover" === e || "pointerover" === e, l = "mouseout" === e || "pointerout" === e; if (a && (n.relatedTarget || n.fromElement) || !l && !a) return null; if (a = r.window === r ? r : (a = r.ownerDocument) ? a.defaultView || a.parentWindow : window, l ? (l = t, t = (t = n.relatedTarget || n.toElement) ? B(t) : null) : l = null, l === t) return null; var o = void 0, i = void 0, u = void 0, c = void 0; return "mouseout" === e || "mouseover" === e ? (o = on, i = cn.mouseLeave, u = cn.mouseEnter, c = "mouse") : "pointerout" !== e && "pointerover" !== e || (o = un, i = cn.pointerLeave, u = cn.pointerEnter, c = "pointer"), e = null == l ? a : V(l), a = null == t ? a : V(t), (i = o.getPooled(i, l, n, r)).type = c + "leave", i.target = e, i.relatedTarget = a, (n = o.getPooled(u, t, n, r)).type = c + "enter", n.target = a, n.relatedTarget = e, ee(i, n, l, t), [i, n] } }; function fn(e) { var t = e; if (e.alternate) for (; t.return;)t = t.return; else { if (0 != (2 & t.effectTag)) return 1; for (; t.return;)if (0 != (2 & (t = t.return).effectTag)) return 1 } return 3 === t.tag ? 2 : 3 } function dn(e) { 2 !== fn(e) && c("188") } function pn(e) { var t = e.alternate; if (!t) return 3 === (t = fn(e)) && c("188"), 1 === t ? null : e; for (var n = e, r = t; ;) { var a = n.return, l = a ? a.alternate : null; if (!a || !l) break; if (a.child === l.child) { for (var o = a.child; o;) { if (o === n) return dn(a), e; if (o === r) return dn(a), t; o = o.sibling } c("188") } if (n.return !== r.return) n = a, r = l; else { o = !1; for (var i = a.child; i;) { if (i === n) { o = !0, n = a, r = l; break } if (i === r) { o = !0, r = a, n = l; break } i = i.sibling } if (!o) { for (i = l.child; i;) { if (i === n) { o = !0, n = l, r = a; break } if (i === r) { o = !0, r = l, n = a; break } i = i.sibling } o || c("189") } } n.alternate !== r && c("190") } return 3 !== n.tag && c("188"), n.stateNode.current === n ? e : t } function mn(e) { if (!(e = pn(e))) return null; for (var t = e; ;) { if (5 === t.tag || 6 === t.tag) return t; if (t.child) t.child.return = t, t = t.child; else { if (t === e) break; for (; !t.sibling;) { if (!t.return || t.return === e) return null; t = t.return } t.sibling.return = t.return, t = t.sibling } } return null } function hn(e) { if (!(e = pn(e))) return null; for (var t = e; ;) { if (5 === t.tag || 6 === t.tag) return t; if (t.child && 4 !== t.tag) t.child.return = t, t = t.child; else { if (t === e) break; for (; !t.sibling;) { if (!t.return || t.return === e) return null; t = t.return } t.sibling.return = t.return, t = t.sibling } } return null } var vn = be.extend({ animationName: null, elapsedTime: null, pseudoElement: null }), gn = be.extend({ clipboardData: function (e) { return "clipboardData" in e ? e.clipboardData : window.clipboardData } }), yn = nn.extend({ relatedTarget: null }); function bn(e) { var t = e.keyCode; return "charCode" in e ? 0 === (e = e.charCode) && 13 === t && (e = 13) : e = t, 10 === e && (e = 13), 32 <= e || 13 === e ? e : 0 } var kn = { Esc: "Escape", Spacebar: " ", Left: "ArrowLeft", Up: "ArrowUp", Right: "ArrowRight", Down: "ArrowDown", Del: "Delete", Win: "OS", Menu: "ContextMenu", Apps: "ContextMenu", Scroll: "ScrollLock", MozPrintableKey: "Unidentified" }, wn = { 8: "Backspace", 9: "Tab", 12: "Clear", 13: "Enter", 16: "Shift", 17: "Control", 18: "Alt", 19: "Pause", 20: "CapsLock", 27: "Escape", 32: " ", 33: "PageUp", 34: "PageDown", 35: "End", 36: "Home", 37: "ArrowLeft", 38: "ArrowUp", 39: "ArrowRight", 40: "ArrowDown", 45: "Insert", 46: "Delete", 112: "F1", 113: "F2", 114: "F3", 115: "F4", 116: "F5", 117: "F6", 118: "F7", 119: "F8", 120: "F9", 121: "F10", 122: "F11", 123: "F12", 144: "NumLock", 145: "ScrollLock", 224: "Meta" }, xn = nn.extend({ key: function (e) { if (e.key) { var t = kn[e.key] || e.key; if ("Unidentified" !== t) return t } return "keypress" === e.type ? 13 === (e = bn(e)) ? "Enter" : String.fromCharCode(e) : "keydown" === e.type || "keyup" === e.type ? wn[e.keyCode] || "Unidentified" : "" }, location: null, ctrlKey: null, shiftKey: null, altKey: null, metaKey: null, repeat: null, locale: null, getModifierState: ln, charCode: function (e) { return "keypress" === e.type ? bn(e) : 0 }, keyCode: function (e) { return "keydown" === e.type || "keyup" === e.type ? e.keyCode : 0 }, which: function (e) { return "keypress" === e.type ? bn(e) : "keydown" === e.type || "keyup" === e.type ? e.keyCode : 0 } }), Cn = on.extend({ dataTransfer: null }), En = nn.extend({ touches: null, targetTouches: null, changedTouches: null, altKey: null, metaKey: null, ctrlKey: null, shiftKey: null, getModifierState: ln }), Tn = be.extend({ propertyName: null, elapsedTime: null, pseudoElement: null }), _n = on.extend({ deltaX: function (e) { return "deltaX" in e ? e.deltaX : "wheelDeltaX" in e ? -e.wheelDeltaX : 0 }, deltaY: function (e) { return "deltaY" in e ? e.deltaY : "wheelDeltaY" in e ? -e.wheelDeltaY : "wheelDelta" in e ? -e.wheelDelta : 0 }, deltaZ: null, deltaMode: null }), Sn = [["abort", "abort"], [ie, "animationEnd"], [ue, "animationIteration"], [ce, "animationStart"], ["canplay", "canPlay"], ["canplaythrough", "canPlayThrough"], ["drag", "drag"], ["dragenter", "dragEnter"], ["dragexit", "dragExit"], ["dragleave", "dragLeave"], ["dragover", "dragOver"], ["durationchange", "durationChange"], ["emptied", "emptied"], ["encrypted", "encrypted"], ["ended", "ended"], ["error", "error"], ["gotpointercapture", "gotPointerCapture"], ["load", "load"], ["loadeddata", "loadedData"], ["loadedmetadata", "loadedMetadata"], ["loadstart", "loadStart"], ["lostpointercapture", "lostPointerCapture"], ["mousemove", "mouseMove"], ["mouseout", "mouseOut"], ["mouseover", "mouseOver"], ["playing", "playing"], ["pointermove", "pointerMove"], ["pointerout", "pointerOut"], ["pointerover", "pointerOver"], ["progress", "progress"], ["scroll", "scroll"], ["seeking", "seeking"], ["stalled", "stalled"], ["suspend", "suspend"], ["timeupdate", "timeUpdate"], ["toggle", "toggle"], ["touchmove", "touchMove"], [se, "transitionEnd"], ["waiting", "waiting"], ["wheel", "wheel"]], Pn = {}, Nn = {}; function Un(e, t) { var n = e[0], r = "on" + ((e = e[1])[0].toUpperCase() + e.slice(1)); t = { phasedRegistrationNames: { bubbled: r, captured: r + "Capture" }, dependencies: [n], isInteractive: t }, Pn[e] = t, Nn[n] = t } [["blur", "blur"], ["cancel", "cancel"], ["click", "click"], ["close", "close"], ["contextmenu", "contextMenu"], ["copy", "copy"], ["cut", "cut"], ["dblclick", "doubleClick"], ["dragend", "dragEnd"], ["dragstart", "dragStart"], ["drop", "drop"], ["focus", "focus"], ["input", "input"], ["invalid", "invalid"], ["keydown", "keyDown"], ["keypress", "keyPress"], ["keyup", "keyUp"], ["mousedown", "mouseDown"], ["mouseup", "mouseUp"], ["paste", "paste"], ["pause", "pause"], ["play", "play"], ["pointercancel", "pointerCancel"], ["pointerdown", "pointerDown"], ["pointerup", "pointerUp"], ["ratechange", "rateChange"], ["reset", "reset"], ["seeked", "seeked"], ["submit", "submit"], ["touchcancel", "touchCancel"], ["touchend", "touchEnd"], ["touchstart", "touchStart"], ["volumechange", "volumeChange"]].forEach(function (e) { Un(e, !0) }), Sn.forEach(function (e) { Un(e, !1) }); var Fn = { eventTypes: Pn, isInteractiveTopLevelEventType: function (e) { return void 0 !== (e = Nn[e]) && !0 === e.isInteractive }, extractEvents: function (e, t, n, r) { var a = Nn[e]; if (!a) return null; switch (e) { case "keypress": if (0 === bn(n)) return null; case "keydown": case "keyup": e = xn; break; case "blur": case "focus": e = yn; break; case "click": if (2 === n.button) return null; case "dblclick": case "mousedown": case "mousemove": case "mouseup": case "mouseout": case "mouseover": case "contextmenu": e = on; break; case "drag": case "dragend": case "dragenter": case "dragexit": case "dragleave": case "dragover": case "dragstart": case "drop": e = Cn; break; case "touchcancel": case "touchend": case "touchmove": case "touchstart": e = En; break; case ie: case ue: case ce: e = vn; break; case se: e = Tn; break; case "scroll": e = nn; break; case "wheel": e = _n; break; case "copy": case "cut": case "paste": e = gn; break; case "gotpointercapture": case "lostpointercapture": case "pointercancel": case "pointerdown": case "pointermove": case "pointerout": case "pointerover": case "pointerup": e = un; break; default: e = be }return J(t = e.getPooled(a, t, n, r)), t } }, In = Fn.isInteractiveTopLevelEventType, Mn = []; function Rn(e) { var t = e.targetInst; do { if (!t) { e.ancestors.push(t); break } var n; for (n = t; n.return;)n = n.return; if (!(n = 3 !== n.tag ? null : n.stateNode.containerInfo)) break; e.ancestors.push(t), t = B(n) } while (t); for (n = 0; n < e.ancestors.length; n++)t = e.ancestors[n], D(e.topLevelType, t, e.nativeEvent, tt(e.nativeEvent)) } var zn = !0; function On(e) { zn = !!e } function Dn(e, t) { if (!t) return null; var n = (In(e) ? An : jn).bind(null, e); t.addEventListener(e, n, !1) } function Ln(e, t) { if (!t) return null; var n = (In(e) ? An : jn).bind(null, e); t.addEventListener(e, n, !0) } function An(e, t) { Ye(jn, e, t) } function jn(e, t) { if (zn) { var n = tt(t); if (null === (n = B(n)) || "number" != typeof n.tag || 2 === fn(n) || (n = null), Mn.length) { var r = Mn.pop(); r.topLevelType = e, r.nativeEvent = t, r.targetInst = n, e = r } else e = { topLevelType: e, nativeEvent: t, targetInst: n, ancestors: [] }; try { Ze(Rn, e) } finally { e.topLevelType = null, e.nativeEvent = null, e.targetInst = null, e.ancestors.length = 0, 10 > Mn.length && Mn.push(e) } } } var Wn = { get _enabled() { return zn }, setEnabled: On, isEnabled: function () { return zn }, trapBubbledEvent: Dn, trapCapturedEvent: Ln, dispatchEvent: jn }, Bn = {}, Vn = 0, Hn = "_reactListenersID" + ("" + Math.random()).slice(2); function Qn(e) { return Object.prototype.hasOwnProperty.call(e, Hn) || (e[Hn] = Vn++ , Bn[e[Hn]] = {}), Bn[e[Hn]] } function qn(e) { for (; e && e.firstChild;)e = e.firstChild; return e } function Kn(e, t) { var n, r = qn(e); for (e = 0; r;) { if (3 === r.nodeType) { if (n = e + r.textContent.length, e <= t && n >= t) return { node: r, offset: t - e }; e = n } e: { for (; r;) { if (r.nextSibling) { r = r.nextSibling; break e } r = r.parentNode } r = void 0 } r = qn(r) } } function $n(e) { var t = e && e.nodeName && e.nodeName.toLowerCase(); return t && ("input" === t && ("text" === e.type || "search" === e.type || "tel" === e.type || "url" === e.type || "password" === e.type) || "textarea" === t || "true" === e.contentEditable) } var Yn = n.canUseDOM && "documentMode" in document && 11 >= document.documentMode, Xn = { select: { phasedRegistrationNames: { bubbled: "onSelect", captured: "onSelectCapture" }, dependencies: "blur contextmenu focus keydown keyup mousedown mouseup selectionchange".split(" ") } }, Gn = null, Zn = null, Jn = null, er = !1; function tr(e, t) { if (er || null == Gn || Gn !== l()) return null; var n = Gn; return "selectionStart" in n && $n(n) ? n = { start: n.selectionStart, end: n.selectionEnd } : window.getSelection ? n = { anchorNode: (n = window.getSelection()).anchorNode, anchorOffset: n.anchorOffset, focusNode: n.focusNode, focusOffset: n.focusOffset } : n = void 0, Jn && o(Jn, n) ? null : (Jn = n, (e = be.getPooled(Xn.select, Zn, e, t)).type = "select", e.target = Gn, J(e), e) } var nr = { eventTypes: Xn, extractEvents: function (e, t, n, r) { var a, l = r.window === r ? r.document : 9 === r.nodeType ? r : r.ownerDocument; if (!(a = !l)) { e: { l = Qn(l), a = k.onSelect; for (var o = 0; o < a.length; o++) { var i = a[o]; if (!l.hasOwnProperty(i) || !l[i]) { l = !1; break e } } l = !0 } a = !l } if (a) return null; switch (l = t ? V(t) : window, e) { case "focus": (et(l) || "true" === l.contentEditable) && (Gn = l, Zn = t, Jn = null); break; case "blur": Jn = Zn = Gn = null; break; case "mousedown": er = !0; break; case "contextmenu": case "mouseup": return er = !1, tr(n, r); case "selectionchange": if (Yn) break; case "keydown": case "keyup": return tr(n, r) }return null } }; R.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin TapEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")), E = Q.getFiberCurrentPropsFromNode, T = Q.getInstanceFromNode, _ = Q.getNodeFromInstance, R.injectEventPluginsByName({ SimpleEventPlugin: Fn, EnterLeaveEventPlugin: sn, ChangeEventPlugin: tn, SelectEventPlugin: nr, BeforeInputEventPlugin: Le }); var rr = "function" == typeof requestAnimationFrame ? requestAnimationFrame : void 0, ar = Date, lr = setTimeout, or = clearTimeout, ir = void 0; if ("object" == typeof performance && "function" == typeof performance.now) { var ur = performance; ir = function () { return ur.now() } } else ir = function () { return ar.now() }; var cr = void 0, sr = void 0; if (n.canUseDOM) { var fr = "function" == typeof rr ? rr : function () { c("276") }, dr = null, pr = null, mr = -1, hr = !1, vr = !1, gr = 0, yr = 33, br = 33, kr = { didTimeout: !1, timeRemaining: function () { var e = gr - ir(); return 0 < e ? e : 0 } }, wr = function (e, t) { var n = e.scheduledCallback, r = !1; try { n(t), r = !0 } finally { sr(e), r || (hr = !0, window.postMessage(xr, "*")) } }, xr = "__reactIdleCallback$" + Math.random().toString(36).slice(2); window.addEventListener("message", function (e) { if (e.source === window && e.data === xr && (hr = !1, null !== dr)) { if (null !== dr) { var t = ir(); if (!(-1 === mr || mr > t)) { e = -1; for (var n = [], r = dr; null !== r;) { var a = r.timeoutTime; -1 !== a && a <= t ? n.push(r) : -1 !== a && (-1 === e || a < e) && (e = a), r = r.next } if (0 < n.length) for (kr.didTimeout = !0, t = 0, r = n.length; t < r; t++)wr(n[t], kr); mr = e } } for (e = ir(); 0 < gr - e && null !== dr;)e = dr, kr.didTimeout = !1, wr(e, kr), e = ir(); null === dr || vr || (vr = !0, fr(Cr)) } }, !1); var Cr = function (e) { vr = !1; var t = e - gr + br; t < br && yr < br ? (8 > t && (t = 8), br = t < yr ? yr : t) : yr = t, gr = e + br, hr || (hr = !0, window.postMessage(xr, "*")) }; cr = function (e, t) { var n = -1; return null != t && "number" == typeof t.timeout && (n = ir() + t.timeout), (-1 === mr || -1 !== n && n < mr) && (mr = n), e = { scheduledCallback: e, timeoutTime: n, prev: null, next: null }, null === dr ? dr = e : null !== (t = e.prev = pr) && (t.next = e), pr = e, vr || (vr = !0, fr(Cr)), e }, sr = function (e) { if (null !== e.prev || dr === e) { var t = e.next, n = e.prev; e.next = null, e.prev = null, null !== t ? null !== n ? (n.next = t, t.prev = n) : (t.prev = null, dr = t) : null !== n ? (n.next = null, pr = n) : pr = dr = null } } } else { var Er = new Map; cr = function (e) { var t = { scheduledCallback: e, timeoutTime: 0, next: null, prev: null }, n = lr(function () { e({ timeRemaining: function () { return 1 / 0 }, didTimeout: !1 }) }); return Er.set(e, n), t }, sr = function (e) { var t = Er.get(e.scheduledCallback); Er.delete(e), or(t) } } function Tr(e) { var n = ""; return t.Children.forEach(e, function (e) { null == e || "string" != typeof e && "number" != typeof e || (n += e) }), n } function _r(e, t) { return e = r({ children: void 0 }, t), (t = Tr(t.children)) && (e.children = t), e } function Sr(e, t, n, r) { if (e = e.options, t) { t = {}; for (var a = 0; a < n.length; a++)t["$" + n[a]] = !0; for (n = 0; n < e.length; n++)a = t.hasOwnProperty("$" + e[n].value), e[n].selected !== a && (e[n].selected = a), a && r && (e[n].defaultSelected = !0) } else { for (n = "" + n, t = null, a = 0; a < e.length; a++) { if (e[a].value === n) return e[a].selected = !0, void (r && (e[a].defaultSelected = !0)); null !== t || e[a].disabled || (t = e[a]) } null !== t && (t.selected = !0) } } function Pr(e, t) { var n = t.value; e._wrapperState = { initialValue: null != n ? n : t.defaultValue, wasMultiple: !!t.multiple } } function Nr(e, t) { return null != t.dangerouslySetInnerHTML && c("91"), r({}, t, { value: void 0, defaultValue: void 0, children: "" + e._wrapperState.initialValue }) } function Ur(e, t) { var n = t.value; null == n && (n = t.defaultValue, null != (t = t.children) && (null != n && c("92"), Array.isArray(t) && (1 >= t.length || c("93"), t = t[0]), n = "" + t), null == n && (n = "")), e._wrapperState = { initialValue: "" + n } } function Fr(e, t) { var n = t.value; null != n && ((n = "" + n) !== e.value && (e.value = n), null == t.defaultValue && (e.defaultValue = n)), null != t.defaultValue && (e.defaultValue = t.defaultValue) } function Ir(e) { var t = e.textContent; t === e._wrapperState.initialValue && (e.value = t) } var Mr = { html: "http://www.w3.org/1999/xhtml", mathml: "http://www.w3.org/1998/Math/MathML", svg: "http://www.w3.org/2000/svg" }; function Rr(e) { switch (e) { case "svg": return "http://www.w3.org/2000/svg"; case "math": return "http://www.w3.org/1998/Math/MathML"; default: return "http://www.w3.org/1999/xhtml" } } function zr(e, t) { return null == e || "http://www.w3.org/1999/xhtml" === e ? Rr(t) : "http://www.w3.org/2000/svg" === e && "foreignObject" === t ? "http://www.w3.org/1999/xhtml" : e } var Or = void 0, Dr = function (e) { return "undefined" != typeof MSApp && MSApp.execUnsafeLocalFunction ? function (t, n, r, a) { MSApp.execUnsafeLocalFunction(function () { return e(t, n) }) } : e }(function (e, t) { if (e.namespaceURI !== Mr.svg || "innerHTML" in e) e.innerHTML = t; else { for ((Or = Or || document.createElement("div")).innerHTML = "<svg>" + t + "</svg>", t = Or.firstChild; e.firstChild;)e.removeChild(e.firstChild); for (; t.firstChild;)e.appendChild(t.firstChild) } }); function Lr(e, t) { if (t) { var n = e.firstChild; if (n && n === e.lastChild && 3 === n.nodeType) return void (n.nodeValue = t) } e.textContent = t } var Ar = { animationIterationCount: !0, borderImageOutset: !0, borderImageSlice: !0, borderImageWidth: !0, boxFlex: !0, boxFlexGroup: !0, boxOrdinalGroup: !0, columnCount: !0, columns: !0, flex: !0, flexGrow: !0, flexPositive: !0, flexShrink: !0, flexNegative: !0, flexOrder: !0, gridRow: !0, gridRowEnd: !0, gridRowSpan: !0, gridRowStart: !0, gridColumn: !0, gridColumnEnd: !0, gridColumnSpan: !0, gridColumnStart: !0, fontWeight: !0, lineClamp: !0, lineHeight: !0, opacity: !0, order: !0, orphans: !0, tabSize: !0, widows: !0, zIndex: !0, zoom: !0, fillOpacity: !0, floodOpacity: !0, stopOpacity: !0, strokeDasharray: !0, strokeDashoffset: !0, strokeMiterlimit: !0, strokeOpacity: !0, strokeWidth: !0 }, jr = ["Webkit", "ms", "Moz", "O"]; function Wr(e, t) { for (var n in e = e.style, t) if (t.hasOwnProperty(n)) { var r = 0 === n.indexOf("--"), a = n, l = t[n]; a = null == l || "boolean" == typeof l || "" === l ? "" : r || "number" != typeof l || 0 === l || Ar.hasOwnProperty(a) && Ar[a] ? ("" + l).trim() : l + "px", "float" === n && (n = "cssFloat"), r ? e.setProperty(n, a) : e[n] = a } } Object.keys(Ar).forEach(function (e) { jr.forEach(function (t) { t = t + e.charAt(0).toUpperCase() + e.substring(1), Ar[t] = Ar[e] }) }); var Br = r({ menuitem: !0 }, { area: !0, base: !0, br: !0, col: !0, embed: !0, hr: !0, img: !0, input: !0, keygen: !0, link: !0, meta: !0, param: !0, source: !0, track: !0, wbr: !0 }); function Vr(e, t, n) { t && (Br[e] && (null != t.children || null != t.dangerouslySetInnerHTML) && c("137", e, n()), null != t.dangerouslySetInnerHTML && (null != t.children && c("60"), "object" == typeof t.dangerouslySetInnerHTML && "__html" in t.dangerouslySetInnerHTML || c("61")), null != t.style && "object" != typeof t.style && c("62", n())) } function Hr(e, t) { if (-1 === e.indexOf("-")) return "string" == typeof t.is; switch (e) { case "annotation-xml": case "color-profile": case "font-face": case "font-face-src": case "font-face-uri": case "font-face-format": case "font-face-name": case "missing-glyph": return !1; default: return !0 } } var Qr = a.thatReturns(""); function qr(e, t) { var n = Qn(e = 9 === e.nodeType || 11 === e.nodeType ? e : e.ownerDocument); t = k[t]; for (var r = 0; r < t.length; r++) { var a = t[r]; if (!n.hasOwnProperty(a) || !n[a]) { switch (a) { case "scroll": Ln("scroll", e); break; case "focus": case "blur": Ln("focus", e), Ln("blur", e), n.blur = !0, n.focus = !0; break; case "cancel": case "close": nt(a, !0) && Ln(a, e); break; case "invalid": case "submit": case "reset": break; default: -1 === fe.indexOf(a) && Dn(a, e) }n[a] = !0 } } } function Kr(e, t, n, r) { return n = 9 === n.nodeType ? n : n.ownerDocument, r === Mr.html && (r = Rr(e)), r === Mr.html ? "script" === e ? ((e = n.createElement("div")).innerHTML = "<script><\/script>", e = e.removeChild(e.firstChild)) : e = "string" == typeof t.is ? n.createElement(e, { is: t.is }) : n.createElement(e) : e = n.createElementNS(r, e), e } function $r(e, t) { return (9 === t.nodeType ? t : t.ownerDocument).createTextNode(e) } function Yr(e, t, n, l) { var o = Hr(t, n); switch (t) { case "iframe": case "object": Dn("load", e); var i = n; break; case "video": case "audio": for (i = 0; i < fe.length; i++)Dn(fe[i], e); i = n; break; case "source": Dn("error", e), i = n; break; case "img": case "image": case "link": Dn("error", e), Dn("load", e), i = n; break; case "form": Dn("reset", e), Dn("submit", e), i = n; break; case "details": Dn("toggle", e), i = n; break; case "input": zt(e, n), i = Rt(e, n), Dn("invalid", e), qr(l, "onChange"); break; case "option": i = _r(e, n); break; case "select": Pr(e, n), i = r({}, n, { value: void 0 }), Dn("invalid", e), qr(l, "onChange"); break; case "textarea": Ur(e, n), i = Nr(e, n), Dn("invalid", e), qr(l, "onChange"); break; default: i = n }Vr(t, i, Qr); var u, c = i; for (u in c) if (c.hasOwnProperty(u)) { var s = c[u]; "style" === u ? Wr(e, s, Qr) : "dangerouslySetInnerHTML" === u ? null != (s = s ? s.__html : void 0) && Dr(e, s) : "children" === u ? "string" == typeof s ? ("textarea" !== t || "" !== s) && Lr(e, s) : "number" == typeof s && Lr(e, "" + s) : "suppressContentEditableWarning" !== u && "suppressHydrationWarning" !== u && "autoFocus" !== u && (b.hasOwnProperty(u) ? null != s && qr(l, u) : null != s && Mt(e, u, s, o)) } switch (t) { case "input": lt(e), Lt(e, n, !1); break; case "textarea": lt(e), Ir(e, n); break; case "option": null != n.value && e.setAttribute("value", n.value); break; case "select": e.multiple = !!n.multiple, null != (t = n.value) ? Sr(e, !!n.multiple, t, !1) : null != n.defaultValue && Sr(e, !!n.multiple, n.defaultValue, !0); break; default: "function" == typeof i.onClick && (e.onclick = a) } } function Xr(e, t, n, l, o) { var i = null; switch (t) { case "input": n = Rt(e, n), l = Rt(e, l), i = []; break; case "option": n = _r(e, n), l = _r(e, l), i = []; break; case "select": n = r({}, n, { value: void 0 }), l = r({}, l, { value: void 0 }), i = []; break; case "textarea": n = Nr(e, n), l = Nr(e, l), i = []; break; default: "function" != typeof n.onClick && "function" == typeof l.onClick && (e.onclick = a) }Vr(t, l, Qr), t = e = void 0; var u = null; for (e in n) if (!l.hasOwnProperty(e) && n.hasOwnProperty(e) && null != n[e]) if ("style" === e) { var c = n[e]; for (t in c) c.hasOwnProperty(t) && (u || (u = {}), u[t] = "") } else "dangerouslySetInnerHTML" !== e && "children" !== e && "suppressContentEditableWarning" !== e && "suppressHydrationWarning" !== e && "autoFocus" !== e && (b.hasOwnProperty(e) ? i || (i = []) : (i = i || []).push(e, null)); for (e in l) { var s = l[e]; if (c = null != n ? n[e] : void 0, l.hasOwnProperty(e) && s !== c && (null != s || null != c)) if ("style" === e) if (c) { for (t in c) !c.hasOwnProperty(t) || s && s.hasOwnProperty(t) || (u || (u = {}), u[t] = ""); for (t in s) s.hasOwnProperty(t) && c[t] !== s[t] && (u || (u = {}), u[t] = s[t]) } else u || (i || (i = []), i.push(e, u)), u = s; else "dangerouslySetInnerHTML" === e ? (s = s ? s.__html : void 0, c = c ? c.__html : void 0, null != s && c !== s && (i = i || []).push(e, "" + s)) : "children" === e ? c === s || "string" != typeof s && "number" != typeof s || (i = i || []).push(e, "" + s) : "suppressContentEditableWarning" !== e && "suppressHydrationWarning" !== e && (b.hasOwnProperty(e) ? (null != s && qr(o, e), i || c === s || (i = [])) : (i = i || []).push(e, s)) } return u && (i = i || []).push("style", u), i } function Gr(e, t, n, r, a) { "input" === n && "radio" === a.type && null != a.name && Ot(e, a), Hr(n, r), r = Hr(n, a); for (var l = 0; l < t.length; l += 2) { var o = t[l], i = t[l + 1]; "style" === o ? Wr(e, i, Qr) : "dangerouslySetInnerHTML" === o ? Dr(e, i) : "children" === o ? Lr(e, i) : Mt(e, o, i, r) } switch (n) { case "input": Dt(e, a); break; case "textarea": Fr(e, a); break; case "select": e._wrapperState.initialValue = void 0, t = e._wrapperState.wasMultiple, e._wrapperState.wasMultiple = !!a.multiple, null != (n = a.value) ? Sr(e, !!a.multiple, n, !1) : t !== !!a.multiple && (null != a.defaultValue ? Sr(e, !!a.multiple, a.defaultValue, !0) : Sr(e, !!a.multiple, a.multiple ? [] : "", !1)) } } function Zr(e, t, n, r, l) { switch (t) { case "iframe": case "object": Dn("load", e); break; case "video": case "audio": for (r = 0; r < fe.length; r++)Dn(fe[r], e); break; case "source": Dn("error", e); break; case "img": case "image": case "link": Dn("error", e), Dn("load", e); break; case "form": Dn("reset", e), Dn("submit", e); break; case "details": Dn("toggle", e); break; case "input": zt(e, n), Dn("invalid", e), qr(l, "onChange"); break; case "select": Pr(e, n), Dn("invalid", e), qr(l, "onChange"); break; case "textarea": Ur(e, n), Dn("invalid", e), qr(l, "onChange") }for (var o in Vr(t, n, Qr), r = null, n) if (n.hasOwnProperty(o)) { var i = n[o]; "children" === o ? "string" == typeof i ? e.textContent !== i && (r = ["children", i]) : "number" == typeof i && e.textContent !== "" + i && (r = ["children", "" + i]) : b.hasOwnProperty(o) && null != i && qr(l, o) } switch (t) { case "input": lt(e), Lt(e, n, !0); break; case "textarea": lt(e), Ir(e, n); break; case "select": case "option": break; default: "function" == typeof n.onClick && (e.onclick = a) }return r } function Jr(e, t) { return e.nodeValue !== t } var ea = { createElement: Kr, createTextNode: $r, setInitialProperties: Yr, diffProperties: Xr, updateProperties: Gr, diffHydratedProperties: Zr, diffHydratedText: Jr, warnForUnmatchedText: function () { }, warnForDeletedHydratableElement: function () { }, warnForDeletedHydratableText: function () { }, warnForInsertedHydratedElement: function () { }, warnForInsertedHydratedText: function () { }, restoreControlledState: function (e, t, n) { switch (t) { case "input": if (Dt(e, n), t = n.name, "radio" === n.type && null != t) { for (n = e; n.parentNode;)n = n.parentNode; for (n = n.querySelectorAll("input[name=" + JSON.stringify("" + t) + '][type="radio"]'), t = 0; t < n.length; t++) { var r = n[t]; if (r !== e && r.form === e.form) { var a = H(r); a || c("90"), ot(r), Dt(r, a) } } } break; case "textarea": Fr(e, n); break; case "select": null != (t = n.value) && Sr(e, !!n.multiple, t, !1) } } }, ta = null, na = null; function ra(e, t) { switch (e) { case "button": case "input": case "select": case "textarea": return !!t.autoFocus }return !1 } function aa(e, t) { return "textarea" === e || "string" == typeof t.children || "number" == typeof t.children || "object" == typeof t.dangerouslySetInnerHTML && null !== t.dangerouslySetInnerHTML && "string" == typeof t.dangerouslySetInnerHTML.__html } var la = ir, oa = cr, ia = sr; function ua(e) { for (e = e.nextSibling; e && 1 !== e.nodeType && 3 !== e.nodeType;)e = e.nextSibling; return e } function ca(e) { for (e = e.firstChild; e && 1 !== e.nodeType && 3 !== e.nodeType;)e = e.nextSibling; return e } new Set; var sa = [], fa = -1; function da(e) { return { current: e } } function pa(e) { 0 > fa || (e.current = sa[fa], sa[fa] = null, fa--) } function ma(e, t) { sa[++fa] = e.current, e.current = t } var ha = da(u), va = da(!1), ga = u; function ya(e) { return ka(e) ? ga : ha.current } function ba(e, t) { var n = e.type.contextTypes; if (!n) return u; var r = e.stateNode; if (r && r.__reactInternalMemoizedUnmaskedChildContext === t) return r.__reactInternalMemoizedMaskedChildContext; var a, l = {}; for (a in n) l[a] = t[a]; return r && ((e = e.stateNode).__reactInternalMemoizedUnmaskedChildContext = t, e.__reactInternalMemoizedMaskedChildContext = l), l } function ka(e) { return 2 === e.tag && null != e.type.childContextTypes } function wa(e) { ka(e) && (pa(va, e), pa(ha, e)) } function xa(e) { pa(va, e), pa(ha, e) } function Ca(e, t, n) { ha.current !== u && c("168"), ma(ha, t, e), ma(va, n, e) } function Ea(e, t) { var n = e.stateNode, a = e.type.childContextTypes; if ("function" != typeof n.getChildContext) return t; for (var l in n = n.getChildContext()) l in a || c("108", wt(e) || "Unknown", l); return r({}, t, n) } function Ta(e) { if (!ka(e)) return !1; var t = e.stateNode; return t = t && t.__reactInternalMemoizedMergedChildContext || u, ga = ha.current, ma(ha, t, e), ma(va, va.current, e), !0 } function _a(e, t) { var n = e.stateNode; if (n || c("169"), t) { var r = Ea(e, ga); n.__reactInternalMemoizedMergedChildContext = r, pa(va, e), pa(ha, e), ma(ha, r, e) } else pa(va, e); ma(va, t, e) } function Sa(e, t, n, r) { this.tag = e, this.key = n, this.sibling = this.child = this.return = this.stateNode = this.type = null, this.index = 0, this.ref = null, this.pendingProps = t, this.memoizedState = this.updateQueue = this.memoizedProps = null, this.mode = r, this.effectTag = 0, this.lastEffect = this.firstEffect = this.nextEffect = null, this.expirationTime = 0, this.alternate = null } function Pa(e, t, n) { var r = e.alternate; return null === r ? ((r = new Sa(e.tag, t, e.key, e.mode)).type = e.type, r.stateNode = e.stateNode, r.alternate = e, e.alternate = r) : (r.pendingProps = t, r.effectTag = 0, r.nextEffect = null, r.firstEffect = null, r.lastEffect = null), r.expirationTime = n, r.child = e.child, r.memoizedProps = e.memoizedProps, r.memoizedState = e.memoizedState, r.updateQueue = e.updateQueue, r.sibling = e.sibling, r.index = e.index, r.ref = e.ref, r } function Na(e, t, n) { var r = e.type, a = e.key; if (e = e.props, "function" == typeof r) var l = r.prototype && r.prototype.isReactComponent ? 2 : 0; else if ("string" == typeof r) l = 5; else switch (r) { case ft: return Ua(e.children, t, n, a); case vt: l = 11, t |= 3; break; case dt: l = 11, t |= 2; break; case pt: return (r = new Sa(15, e, a, 4 | t)).type = pt, r.expirationTime = n, r; case yt: l = 16, t |= 2; break; default: e: { switch ("object" == typeof r && null !== r ? r.$$typeof : null) { case mt: l = 13; break e; case ht: l = 12; break e; case gt: l = 14; break e; default: c("130", null == r ? r : typeof r, "") }l = void 0 } }return (t = new Sa(l, e, a, t)).type = r, t.expirationTime = n, t } function Ua(e, t, n, r) { return (e = new Sa(10, e, r, t)).expirationTime = n, e } function Fa(e, t, n) { return (e = new Sa(6, e, null, t)).expirationTime = n, e } function Ia(e, t, n) { return (t = new Sa(4, null !== e.children ? e.children : [], e.key, t)).expirationTime = n, t.stateNode = { containerInfo: e.containerInfo, pendingChildren: null, implementation: e.implementation }, t } function Ma(e, t, n) { return e = { current: t = new Sa(3, null, null, t ? 3 : 0), containerInfo: e, pendingChildren: null, earliestPendingTime: 0, latestPendingTime: 0, earliestSuspendedTime: 0, latestSuspendedTime: 0, latestPingedTime: 0, pendingCommitExpirationTime: 0, finishedWork: null, context: null, pendingContext: null, hydrate: n, remainingExpirationTime: 0, firstBatch: null, nextScheduledRoot: null }, t.stateNode = e } var Ra = null, za = null; function Oa(e) { return function (t) { try { return e(t) } catch (n) { } } } function Da(e) { if ("undefined" == typeof __REACT_DEVTOOLS_GLOBAL_HOOK__) return !1; var t = __REACT_DEVTOOLS_GLOBAL_HOOK__; if (t.isDisabled || !t.supportsFiber) return !0; try { var n = t.inject(e); Ra = Oa(function (e) { return t.onCommitFiberRoot(n, e) }), za = Oa(function (e) { return t.onCommitFiberUnmount(n, e) }) } catch (r) { } return !0 } function La(e) { "function" == typeof Ra && Ra(e) } function Aa(e) { "function" == typeof za && za(e) } var ja = !1; function Wa(e) { return { expirationTime: 0, baseState: e, firstUpdate: null, lastUpdate: null, firstCapturedUpdate: null, lastCapturedUpdate: null, firstEffect: null, lastEffect: null, firstCapturedEffect: null, lastCapturedEffect: null } } function Ba(e) { return { expirationTime: e.expirationTime, baseState: e.baseState, firstUpdate: e.firstUpdate, lastUpdate: e.lastUpdate, firstCapturedUpdate: null, lastCapturedUpdate: null, firstEffect: null, lastEffect: null, firstCapturedEffect: null, lastCapturedEffect: null } } function Va(e) { return { expirationTime: e, tag: 0, payload: null, callback: null, next: null, nextEffect: null } } function Ha(e, t, n) { null === e.lastUpdate ? e.firstUpdate = e.lastUpdate = t : (e.lastUpdate.next = t, e.lastUpdate = t), (0 === e.expirationTime || e.expirationTime > n) && (e.expirationTime = n) } function Qa(e, t, n) { var r = e.alternate; if (null === r) { var a = e.updateQueue, l = null; null === a && (a = e.updateQueue = Wa(e.memoizedState)) } else a = e.updateQueue, l = r.updateQueue, null === a ? null === l ? (a = e.updateQueue = Wa(e.memoizedState), l = r.updateQueue = Wa(r.memoizedState)) : a = e.updateQueue = Ba(l) : null === l && (l = r.updateQueue = Ba(a)); null === l || a === l ? Ha(a, t, n) : null === a.lastUpdate || null === l.lastUpdate ? (Ha(a, t, n), Ha(l, t, n)) : (Ha(a, t, n), l.lastUpdate = t) } function qa(e, t, n) { var r = e.updateQueue; null === (r = null === r ? e.updateQueue = Wa(e.memoizedState) : Ka(e, r)).lastCapturedUpdate ? r.firstCapturedUpdate = r.lastCapturedUpdate = t : (r.lastCapturedUpdate.next = t, r.lastCapturedUpdate = t), (0 === r.expirationTime || r.expirationTime > n) && (r.expirationTime = n) } function Ka(e, t) { var n = e.alternate; return null !== n && t === n.updateQueue && (t = e.updateQueue = Ba(t)), t } function $a(e, t, n, a, l, o) { switch (n.tag) { case 1: return "function" == typeof (e = n.payload) ? e.call(o, a, l) : e; case 3: e.effectTag = -1025 & e.effectTag | 64; case 0: if (null == (l = "function" == typeof (e = n.payload) ? e.call(o, a, l) : e)) break; return r({}, a, l); case 2: ja = !0 }return a } function Ya(e, t, n, r, a) { if (ja = !1, !(0 === t.expirationTime || t.expirationTime > a)) { for (var l = (t = Ka(e, t)).baseState, o = null, i = 0, u = t.firstUpdate, c = l; null !== u;) { var s = u.expirationTime; s > a ? (null === o && (o = u, l = c), (0 === i || i > s) && (i = s)) : (c = $a(e, t, u, c, n, r), null !== u.callback && (e.effectTag |= 32, u.nextEffect = null, null === t.lastEffect ? t.firstEffect = t.lastEffect = u : (t.lastEffect.nextEffect = u, t.lastEffect = u))), u = u.next } for (s = null, u = t.firstCapturedUpdate; null !== u;) { var f = u.expirationTime; f > a ? (null === s && (s = u, null === o && (l = c)), (0 === i || i > f) && (i = f)) : (c = $a(e, t, u, c, n, r), null !== u.callback && (e.effectTag |= 32, u.nextEffect = null, null === t.lastCapturedEffect ? t.firstCapturedEffect = t.lastCapturedEffect = u : (t.lastCapturedEffect.nextEffect = u, t.lastCapturedEffect = u))), u = u.next } null === o && (t.lastUpdate = null), null === s ? t.lastCapturedUpdate = null : e.effectTag |= 32, null === o && null === s && (l = c), t.baseState = l, t.firstUpdate = o, t.firstCapturedUpdate = s, t.expirationTime = i, e.memoizedState = c } } function Xa(e, t) { "function" != typeof e && c("191", e), e.call(t) } function Ga(e, t, n) { for (null !== t.firstCapturedUpdate && (null !== t.lastUpdate && (t.lastUpdate.next = t.firstCapturedUpdate, t.lastUpdate = t.lastCapturedUpdate), t.firstCapturedUpdate = t.lastCapturedUpdate = null), e = t.firstEffect, t.firstEffect = t.lastEffect = null; null !== e;) { var r = e.callback; null !== r && (e.callback = null, Xa(r, n)), e = e.nextEffect } for (e = t.firstCapturedEffect, t.firstCapturedEffect = t.lastCapturedEffect = null; null !== e;)null !== (t = e.callback) && (e.callback = null, Xa(t, n)), e = e.nextEffect } function Za(e, t) { return { value: e, source: t, stack: xt(t) } } var Ja = da(null), el = da(null), tl = da(0); function nl(e) { var t = e.type._context; ma(tl, t._changedBits, e), ma(el, t._currentValue, e), ma(Ja, e, e), t._currentValue = e.pendingProps.value, t._changedBits = e.stateNode } function rl(e) { var t = tl.current, n = el.current; pa(Ja, e), pa(el, e), pa(tl, e), (e = e.type._context)._currentValue = n, e._changedBits = t } var al = {}, ll = da(al), ol = da(al), il = da(al); function ul(e) { return e === al && c("174"), e } function cl(e, t) { ma(il, t, e), ma(ol, e, e), ma(ll, al, e); var n = t.nodeType; switch (n) { case 9: case 11: t = (t = t.documentElement) ? t.namespaceURI : zr(null, ""); break; default: t = zr(t = (n = 8 === n ? t.parentNode : t).namespaceURI || null, n = n.tagName) }pa(ll, e), ma(ll, t, e) } function sl(e) { pa(ll, e), pa(ol, e), pa(il, e) } function fl(e) { ol.current === e && (pa(ll, e), pa(ol, e)) } function dl(e, t, n) { var a = e.memoizedState; a = null == (t = t(n, a)) ? a : r({}, a, t), e.memoizedState = a, null !== (e = e.updateQueue) && 0 === e.expirationTime && (e.baseState = a) } var pl = { isMounted: function (e) { return !!(e = e._reactInternalFiber) && 2 === fn(e) }, enqueueSetState: function (e, t, n) { e = e._reactInternalFiber; var r = So(), a = Va(r = To(r, e)); a.payload = t, null != n && (a.callback = n), Qa(e, a, r), _o(e, r) }, enqueueReplaceState: function (e, t, n) { e = e._reactInternalFiber; var r = So(), a = Va(r = To(r, e)); a.tag = 1, a.payload = t, null != n && (a.callback = n), Qa(e, a, r), _o(e, r) }, enqueueForceUpdate: function (e, t) { e = e._reactInternalFiber; var n = So(), r = Va(n = To(n, e)); r.tag = 2, null != t && (r.callback = t), Qa(e, r, n), _o(e, n) } }; function ml(e, t, n, r, a, l) { var i = e.stateNode; return e = e.type, "function" == typeof i.shouldComponentUpdate ? i.shouldComponentUpdate(n, a, l) : !e.prototype || !e.prototype.isPureReactComponent || (!o(t, n) || !o(r, a)) } function hl(e, t, n, r) { e = t.state, "function" == typeof t.componentWillReceiveProps && t.componentWillReceiveProps(n, r), "function" == typeof t.UNSAFE_componentWillReceiveProps && t.UNSAFE_componentWillReceiveProps(n, r), t.state !== e && pl.enqueueReplaceState(t, t.state, null) } function vl(e, t) { var n = e.type, r = e.stateNode, a = e.pendingProps, l = ya(e); r.props = a, r.state = e.memoizedState, r.refs = u, r.context = ba(e, l), null !== (l = e.updateQueue) && (Ya(e, l, a, r, t), r.state = e.memoizedState), "function" == typeof (l = e.type.getDerivedStateFromProps) && (dl(e, l, a), r.state = e.memoizedState), "function" == typeof n.getDerivedStateFromProps || "function" == typeof r.getSnapshotBeforeUpdate || "function" != typeof r.UNSAFE_componentWillMount && "function" != typeof r.componentWillMount || (n = r.state, "function" == typeof r.componentWillMount && r.componentWillMount(), "function" == typeof r.UNSAFE_componentWillMount && r.UNSAFE_componentWillMount(), n !== r.state && pl.enqueueReplaceState(r, r.state, null), null !== (l = e.updateQueue) && (Ya(e, l, a, r, t), r.state = e.memoizedState)), "function" == typeof r.componentDidMount && (e.effectTag |= 4) } var gl = Array.isArray; function yl(e, t, n) { if (null !== (e = n.ref) && "function" != typeof e && "object" != typeof e) { if (n._owner) { n = n._owner; var r = void 0; n && (2 !== n.tag && c("110"), r = n.stateNode), r || c("147", e); var a = "" + e; return null !== t && null !== t.ref && "function" == typeof t.ref && t.ref._stringRef === a ? t.ref : ((t = function (e) { var t = r.refs === u ? r.refs = {} : r.refs; null === e ? delete t[a] : t[a] = e })._stringRef = a, t) } "string" != typeof e && c("148"), n._owner || c("254", e) } return e } function bl(e, t) { "textarea" !== e.type && c("31", "[object Object]" === Object.prototype.toString.call(t) ? "object with keys {" + Object.keys(t).join(", ") + "}" : t, "") } function kl(e) { function t(t, n) { if (e) { var r = t.lastEffect; null !== r ? (r.nextEffect = n, t.lastEffect = n) : t.firstEffect = t.lastEffect = n, n.nextEffect = null, n.effectTag = 8 } } function n(n, r) { if (!e) return null; for (; null !== r;)t(n, r), r = r.sibling; return null } function r(e, t) { for (e = new Map; null !== t;)null !== t.key ? e.set(t.key, t) : e.set(t.index, t), t = t.sibling; return e } function a(e, t, n) { return (e = Pa(e, t, n)).index = 0, e.sibling = null, e } function l(t, n, r) { return t.index = r, e ? null !== (r = t.alternate) ? (r = r.index) < n ? (t.effectTag = 2, n) : r : (t.effectTag = 2, n) : n } function o(t) { return e && null === t.alternate && (t.effectTag = 2), t } function i(e, t, n, r) { return null === t || 6 !== t.tag ? ((t = Fa(n, e.mode, r)).return = e, t) : ((t = a(t, n, r)).return = e, t) } function u(e, t, n, r) { return null !== t && t.type === n.type ? ((r = a(t, n.props, r)).ref = yl(e, t, n), r.return = e, r) : ((r = Na(n, e.mode, r)).ref = yl(e, t, n), r.return = e, r) } function s(e, t, n, r) { return null === t || 4 !== t.tag || t.stateNode.containerInfo !== n.containerInfo || t.stateNode.implementation !== n.implementation ? ((t = Ia(n, e.mode, r)).return = e, t) : ((t = a(t, n.children || [], r)).return = e, t) } function f(e, t, n, r, l) { return null === t || 10 !== t.tag ? ((t = Ua(n, e.mode, r, l)).return = e, t) : ((t = a(t, n, r)).return = e, t) } function d(e, t, n) { if ("string" == typeof t || "number" == typeof t) return (t = Fa("" + t, e.mode, n)).return = e, t; if ("object" == typeof t && null !== t) { switch (t.$$typeof) { case ct: return (n = Na(t, e.mode, n)).ref = yl(e, null, t), n.return = e, n; case st: return (t = Ia(t, e.mode, n)).return = e, t }if (gl(t) || kt(t)) return (t = Ua(t, e.mode, n, null)).return = e, t; bl(e, t) } return null } function p(e, t, n, r) { var a = null !== t ? t.key : null; if ("string" == typeof n || "number" == typeof n) return null !== a ? null : i(e, t, "" + n, r); if ("object" == typeof n && null !== n) { switch (n.$$typeof) { case ct: return n.key === a ? n.type === ft ? f(e, t, n.props.children, r, a) : u(e, t, n, r) : null; case st: return n.key === a ? s(e, t, n, r) : null }if (gl(n) || kt(n)) return null !== a ? null : f(e, t, n, r, null); bl(e, n) } return null } function m(e, t, n, r, a) { if ("string" == typeof r || "number" == typeof r) return i(t, e = e.get(n) || null, "" + r, a); if ("object" == typeof r && null !== r) { switch (r.$$typeof) { case ct: return e = e.get(null === r.key ? n : r.key) || null, r.type === ft ? f(t, e, r.props.children, a, r.key) : u(t, e, r, a); case st: return s(t, e = e.get(null === r.key ? n : r.key) || null, r, a) }if (gl(r) || kt(r)) return f(t, e = e.get(n) || null, r, a, null); bl(t, r) } return null } function h(a, o, i, u) { for (var c = null, s = null, f = o, h = o = 0, v = null; null !== f && h < i.length; h++) { f.index > h ? (v = f, f = null) : v = f.sibling; var g = p(a, f, i[h], u); if (null === g) { null === f && (f = v); break } e && f && null === g.alternate && t(a, f), o = l(g, o, h), null === s ? c = g : s.sibling = g, s = g, f = v } if (h === i.length) return n(a, f), c; if (null === f) { for (; h < i.length; h++)(f = d(a, i[h], u)) && (o = l(f, o, h), null === s ? c = f : s.sibling = f, s = f); return c } for (f = r(a, f); h < i.length; h++)(v = m(f, a, h, i[h], u)) && (e && null !== v.alternate && f.delete(null === v.key ? h : v.key), o = l(v, o, h), null === s ? c = v : s.sibling = v, s = v); return e && f.forEach(function (e) { return t(a, e) }), c } function v(a, o, i, u) { var s = kt(i); "function" != typeof s && c("150"), null == (i = s.call(i)) && c("151"); for (var f = s = null, h = o, v = o = 0, g = null, y = i.next(); null !== h && !y.done; v++ , y = i.next()) { h.index > v ? (g = h, h = null) : g = h.sibling; var b = p(a, h, y.value, u); if (null === b) { h || (h = g); break } e && h && null === b.alternate && t(a, h), o = l(b, o, v), null === f ? s = b : f.sibling = b, f = b, h = g } if (y.done) return n(a, h), s; if (null === h) { for (; !y.done; v++ , y = i.next())null !== (y = d(a, y.value, u)) && (o = l(y, o, v), null === f ? s = y : f.sibling = y, f = y); return s } for (h = r(a, h); !y.done; v++ , y = i.next())null !== (y = m(h, a, v, y.value, u)) && (e && null !== y.alternate && h.delete(null === y.key ? v : y.key), o = l(y, o, v), null === f ? s = y : f.sibling = y, f = y); return e && h.forEach(function (e) { return t(a, e) }), s } return function (e, r, l, i) { var u = "object" == typeof l && null !== l && l.type === ft && null === l.key; u && (l = l.props.children); var s = "object" == typeof l && null !== l; if (s) switch (l.$$typeof) { case ct: e: { for (s = l.key, u = r; null !== u;) { if (u.key === s) { if (10 === u.tag ? l.type === ft : u.type === l.type) { n(e, u.sibling), (r = a(u, l.type === ft ? l.props.children : l.props, i)).ref = yl(e, u, l), r.return = e, e = r; break e } n(e, u); break } t(e, u), u = u.sibling } l.type === ft ? ((r = Ua(l.props.children, e.mode, i, l.key)).return = e, e = r) : ((i = Na(l, e.mode, i)).ref = yl(e, r, l), i.return = e, e = i) } return o(e); case st: e: { for (u = l.key; null !== r;) { if (r.key === u) { if (4 === r.tag && r.stateNode.containerInfo === l.containerInfo && r.stateNode.implementation === l.implementation) { n(e, r.sibling), (r = a(r, l.children || [], i)).return = e, e = r; break e } n(e, r); break } t(e, r), r = r.sibling } (r = Ia(l, e.mode, i)).return = e, e = r } return o(e) }if ("string" == typeof l || "number" == typeof l) return l = "" + l, null !== r && 6 === r.tag ? (n(e, r.sibling), (r = a(r, l, i)).return = e, e = r) : (n(e, r), (r = Fa(l, e.mode, i)).return = e, e = r), o(e); if (gl(l)) return h(e, r, l, i); if (kt(l)) return v(e, r, l, i); if (s && bl(e, l), void 0 === l && !u) switch (e.tag) { case 2: case 1: c("152", (i = e.type).displayName || i.name || "Component") }return n(e, r) } } var wl = kl(!0), xl = kl(!1), Cl = null, El = null, Tl = !1; function _l(e, t) { var n = new Sa(5, null, null, 0); n.type = "DELETED", n.stateNode = t, n.return = e, n.effectTag = 8, null !== e.lastEffect ? (e.lastEffect.nextEffect = n, e.lastEffect = n) : e.firstEffect = e.lastEffect = n } function Sl(e, t) { switch (e.tag) { case 5: var n = e.type; return null !== (t = 1 !== t.nodeType || n.toLowerCase() !== t.nodeName.toLowerCase() ? null : t) && (e.stateNode = t, !0); case 6: return null !== (t = "" === e.pendingProps || 3 !== t.nodeType ? null : t) && (e.stateNode = t, !0); default: return !1 } } function Pl(e) { if (Tl) { var t = El; if (t) { var n = t; if (!Sl(e, t)) { if (!(t = ua(n)) || !Sl(e, t)) return e.effectTag |= 2, Tl = !1, void (Cl = e); _l(Cl, n) } Cl = e, El = ca(t) } else e.effectTag |= 2, Tl = !1, Cl = e } } function Nl(e) { for (e = e.return; null !== e && 5 !== e.tag && 3 !== e.tag;)e = e.return; Cl = e } function Ul(e) { if (e !== Cl) return !1; if (!Tl) return Nl(e), Tl = !0, !1; var t = e.type; if (5 !== e.tag || "head" !== t && "body" !== t && !aa(t, e.memoizedProps)) for (t = El; t;)_l(e, t), t = ua(t); return Nl(e), El = Cl ? ua(e.stateNode) : null, !0 } function Fl() { El = Cl = null, Tl = !1 } function Il(e, t, n) { Ml(e, t, n, t.expirationTime) } function Ml(e, t, n, r) { t.child = null === e ? xl(t, null, n, r) : wl(t, e.child, n, r) } function Rl(e, t) { var n = t.ref; (null === e && null !== n || null !== e && e.ref !== n) && (t.effectTag |= 128) } function zl(e, t, n, r, a) { Rl(e, t); var l = 0 != (64 & t.effectTag); if (!n && !l) return r && _a(t, !1), Al(e, t); n = t.stateNode, it.current = t; var o = l ? null : n.render(); return t.effectTag |= 1, l && (Ml(e, t, null, a), t.child = null), Ml(e, t, o, a), t.memoizedState = n.state, t.memoizedProps = n.props, r && _a(t, !0), t.child } function Ol(e) { var t = e.stateNode; t.pendingContext ? Ca(e, t.pendingContext, t.pendingContext !== t.context) : t.context && Ca(e, t.context, !1), cl(e, t.containerInfo) } function Dl(e, t, n, r) { var a = e.child; for (null !== a && (a.return = e); null !== a;) { switch (a.tag) { case 12: var l = 0 | a.stateNode; if (a.type === t && 0 != (l & n)) { for (l = a; null !== l;) { var o = l.alternate; if (0 === l.expirationTime || l.expirationTime > r) l.expirationTime = r, null !== o && (0 === o.expirationTime || o.expirationTime > r) && (o.expirationTime = r); else { if (null === o || !(0 === o.expirationTime || o.expirationTime > r)) break; o.expirationTime = r } l = l.return } l = null } else l = a.child; break; case 13: l = a.type === e.type ? null : a.child; break; default: l = a.child }if (null !== l) l.return = a; else for (l = a; null !== l;) { if (l === e) { l = null; break } if (null !== (a = l.sibling)) { a.return = l.return, l = a; break } l = l.return } a = l } } function Ll(e, t, n) { var r = t.type._context, a = t.pendingProps, l = t.memoizedProps, o = !0; if (va.current) o = !1; else if (l === a) return t.stateNode = 0, nl(t), Al(e, t); var i = a.value; if (t.memoizedProps = a, null === l) i = 1073741823; else if (l.value === a.value) { if (l.children === a.children && o) return t.stateNode = 0, nl(t), Al(e, t); i = 0 } else { var u = l.value; if (u === i && (0 !== u || 1 / u == 1 / i) || u != u && i != i) { if (l.children === a.children && o) return t.stateNode = 0, nl(t), Al(e, t); i = 0 } else if (i = "function" == typeof r._calculateChangedBits ? r._calculateChangedBits(u, i) : 1073741823, 0 === (i |= 0)) { if (l.children === a.children && o) return t.stateNode = 0, nl(t), Al(e, t) } else Dl(t, r, i, n) } return t.stateNode = i, nl(t), Il(e, t, a.children), t.child } function Al(e, t) { if (null !== e && t.child !== e.child && c("153"), null !== t.child) { var n = Pa(e = t.child, e.pendingProps, e.expirationTime); for (t.child = n, n.return = t; null !== e.sibling;)e = e.sibling, (n = n.sibling = Pa(e, e.pendingProps, e.expirationTime)).return = t; n.sibling = null } return t.child } function jl(e, t, n) { if (0 === t.expirationTime || t.expirationTime > n) { switch (t.tag) { case 3: Ol(t); break; case 2: Ta(t); break; case 4: cl(t, t.stateNode.containerInfo); break; case 13: nl(t) }return null } switch (t.tag) { case 0: null !== e && c("155"); var r = t.type, a = t.pendingProps, l = ya(t); return r = r(a, l = ba(t, l)), t.effectTag |= 1, "object" == typeof r && null !== r && "function" == typeof r.render && void 0 === r.$$typeof ? (l = t.type, t.tag = 2, t.memoizedState = null !== r.state && void 0 !== r.state ? r.state : null, "function" == typeof (l = l.getDerivedStateFromProps) && dl(t, l, a), a = Ta(t), r.updater = pl, t.stateNode = r, r._reactInternalFiber = t, vl(t, n), e = zl(e, t, !0, a, n)) : (t.tag = 1, Il(e, t, r), t.memoizedProps = a, e = t.child), e; case 1: return a = t.type, n = t.pendingProps, va.current || t.memoizedProps !== n ? (a = a(n, r = ba(t, r = ya(t))), t.effectTag |= 1, Il(e, t, a), t.memoizedProps = n, e = t.child) : e = Al(e, t), e; case 2: if (a = Ta(t), null === e) if (null === t.stateNode) { var o = t.pendingProps, i = t.type; r = ya(t); var s = 2 === t.tag && null != t.type.contextTypes; o = new i(o, l = s ? ba(t, r) : u), t.memoizedState = null !== o.state && void 0 !== o.state ? o.state : null, o.updater = pl, t.stateNode = o, o._reactInternalFiber = t, s && ((s = t.stateNode).__reactInternalMemoizedUnmaskedChildContext = r, s.__reactInternalMemoizedMaskedChildContext = l), vl(t, n), r = !0 } else { i = t.type, r = t.stateNode, s = t.memoizedProps, l = t.pendingProps, r.props = s; var f = r.context; o = ba(t, o = ya(t)); var d = i.getDerivedStateFromProps; (i = "function" == typeof d || "function" == typeof r.getSnapshotBeforeUpdate) || "function" != typeof r.UNSAFE_componentWillReceiveProps && "function" != typeof r.componentWillReceiveProps || (s !== l || f !== o) && hl(t, r, l, o), ja = !1; var p = t.memoizedState; f = r.state = p; var m = t.updateQueue; null !== m && (Ya(t, m, l, r, n), f = t.memoizedState), s !== l || p !== f || va.current || ja ? ("function" == typeof d && (dl(t, d, l), f = t.memoizedState), (s = ja || ml(t, s, l, p, f, o)) ? (i || "function" != typeof r.UNSAFE_componentWillMount && "function" != typeof r.componentWillMount || ("function" == typeof r.componentWillMount && r.componentWillMount(), "function" == typeof r.UNSAFE_componentWillMount && r.UNSAFE_componentWillMount()), "function" == typeof r.componentDidMount && (t.effectTag |= 4)) : ("function" == typeof r.componentDidMount && (t.effectTag |= 4), t.memoizedProps = l, t.memoizedState = f), r.props = l, r.state = f, r.context = o, r = s) : ("function" == typeof r.componentDidMount && (t.effectTag |= 4), r = !1) } else i = t.type, r = t.stateNode, l = t.memoizedProps, s = t.pendingProps, r.props = l, f = r.context, o = ba(t, o = ya(t)), (i = "function" == typeof (d = i.getDerivedStateFromProps) || "function" == typeof r.getSnapshotBeforeUpdate) || "function" != typeof r.UNSAFE_componentWillReceiveProps && "function" != typeof r.componentWillReceiveProps || (l !== s || f !== o) && hl(t, r, s, o), ja = !1, f = t.memoizedState, p = r.state = f, null !== (m = t.updateQueue) && (Ya(t, m, s, r, n), p = t.memoizedState), l !== s || f !== p || va.current || ja ? ("function" == typeof d && (dl(t, d, s), p = t.memoizedState), (d = ja || ml(t, l, s, f, p, o)) ? (i || "function" != typeof r.UNSAFE_componentWillUpdate && "function" != typeof r.componentWillUpdate || ("function" == typeof r.componentWillUpdate && r.componentWillUpdate(s, p, o), "function" == typeof r.UNSAFE_componentWillUpdate && r.UNSAFE_componentWillUpdate(s, p, o)), "function" == typeof r.componentDidUpdate && (t.effectTag |= 4), "function" == typeof r.getSnapshotBeforeUpdate && (t.effectTag |= 256)) : ("function" != typeof r.componentDidUpdate || l === e.memoizedProps && f === e.memoizedState || (t.effectTag |= 4), "function" != typeof r.getSnapshotBeforeUpdate || l === e.memoizedProps && f === e.memoizedState || (t.effectTag |= 256), t.memoizedProps = s, t.memoizedState = p), r.props = s, r.state = p, r.context = o, r = d) : ("function" != typeof r.componentDidUpdate || l === e.memoizedProps && f === e.memoizedState || (t.effectTag |= 4), "function" != typeof r.getSnapshotBeforeUpdate || l === e.memoizedProps && f === e.memoizedState || (t.effectTag |= 256), r = !1); return zl(e, t, r, a, n); case 3: return Ol(t), null !== (a = t.updateQueue) ? (r = null !== (r = t.memoizedState) ? r.element : null, Ya(t, a, t.pendingProps, null, n), (a = t.memoizedState.element) === r ? (Fl(), e = Al(e, t)) : (r = t.stateNode, (r = (null === e || null === e.child) && r.hydrate) && (El = ca(t.stateNode.containerInfo), Cl = t, r = Tl = !0), r ? (t.effectTag |= 2, t.child = xl(t, null, a, n)) : (Fl(), Il(e, t, a)), e = t.child)) : (Fl(), e = Al(e, t)), e; case 5: return ul(il.current), (a = ul(ll.current)) !== (r = zr(a, t.type)) && (ma(ol, t, t), ma(ll, r, t)), null === e && Pl(t), a = t.type, s = t.memoizedProps, r = t.pendingProps, l = null !== e ? e.memoizedProps : null, va.current || s !== r || ((s = 1 & t.mode && !!r.hidden) && (t.expirationTime = 1073741823), s && 1073741823 === n) ? (s = r.children, aa(a, r) ? s = null : l && aa(a, l) && (t.effectTag |= 16), Rl(e, t), 1073741823 !== n && 1 & t.mode && r.hidden ? (t.expirationTime = 1073741823, t.memoizedProps = r, e = null) : (Il(e, t, s), t.memoizedProps = r, e = t.child)) : e = Al(e, t), e; case 6: return null === e && Pl(t), t.memoizedProps = t.pendingProps, null; case 16: return null; case 4: return cl(t, t.stateNode.containerInfo), a = t.pendingProps, va.current || t.memoizedProps !== a ? (null === e ? t.child = wl(t, null, a, n) : Il(e, t, a), t.memoizedProps = a, e = t.child) : e = Al(e, t), e; case 14: return a = t.type.render, n = t.pendingProps, r = t.ref, va.current || t.memoizedProps !== n || r !== (null !== e ? e.ref : null) ? (Il(e, t, a = a(n, r)), t.memoizedProps = n, e = t.child) : e = Al(e, t), e; case 10: return n = t.pendingProps, va.current || t.memoizedProps !== n ? (Il(e, t, n), t.memoizedProps = n, e = t.child) : e = Al(e, t), e; case 11: return n = t.pendingProps.children, va.current || null !== n && t.memoizedProps !== n ? (Il(e, t, n), t.memoizedProps = n, e = t.child) : e = Al(e, t), e; case 15: return n = t.pendingProps, t.memoizedProps === n ? e = Al(e, t) : (Il(e, t, n.children), t.memoizedProps = n, e = t.child), e; case 13: return Ll(e, t, n); case 12: e: if (r = t.type, l = t.pendingProps, s = t.memoizedProps, a = r._currentValue, o = r._changedBits, va.current || 0 !== o || s !== l) { if (t.memoizedProps = l, null == (i = l.unstable_observedBits) && (i = 1073741823), t.stateNode = i, 0 != (o & i)) Dl(t, r, o, n); else if (s === l) { e = Al(e, t); break e } n = (n = l.children)(a), t.effectTag |= 1, Il(e, t, n), e = t.child } else e = Al(e, t); return e; default: c("156") } } function Wl(e) { e.effectTag |= 4 } var Bl = void 0, Vl = void 0, Hl = void 0; function Ql(e, t) { var n = t.pendingProps; switch (t.tag) { case 1: return null; case 2: return wa(t), null; case 3: sl(t), xa(t); var r = t.stateNode; return r.pendingContext && (r.context = r.pendingContext, r.pendingContext = null), null !== e && null !== e.child || (Ul(t), t.effectTag &= -3), Bl(t), null; case 5: fl(t), r = ul(il.current); var a = t.type; if (null !== e && null != t.stateNode) { var l = e.memoizedProps, o = t.stateNode, i = ul(ll.current); o = Xr(o, a, l, n, r), Vl(e, t, o, a, l, n, r, i), e.ref !== t.ref && (t.effectTag |= 128) } else { if (!n) return null === t.stateNode && c("166"), null; if (e = ul(ll.current), Ul(t)) n = t.stateNode, a = t.type, l = t.memoizedProps, n[j] = t, n[W] = l, r = Zr(n, a, l, e, r), t.updateQueue = r, null !== r && Wl(t); else { (e = Kr(a, n, r, e))[j] = t, e[W] = n; e: for (l = t.child; null !== l;) { if (5 === l.tag || 6 === l.tag) e.appendChild(l.stateNode); else if (4 !== l.tag && null !== l.child) { l.child.return = l, l = l.child; continue } if (l === t) break; for (; null === l.sibling;) { if (null === l.return || l.return === t) break e; l = l.return } l.sibling.return = l.return, l = l.sibling } Yr(e, a, n, r), ra(a, n) && Wl(t), t.stateNode = e } null !== t.ref && (t.effectTag |= 128) } return null; case 6: if (e && null != t.stateNode) Hl(e, t, e.memoizedProps, n); else { if ("string" != typeof n) return null === t.stateNode && c("166"), null; r = ul(il.current), ul(ll.current), Ul(t) ? (r = t.stateNode, n = t.memoizedProps, r[j] = t, Jr(r, n) && Wl(t)) : ((r = $r(n, r))[j] = t, t.stateNode = r) } return null; case 14: case 16: case 10: case 11: case 15: return null; case 4: return sl(t), Bl(t), null; case 13: return rl(t), null; case 12: return null; case 0: c("167"); default: c("156") } } function ql(e, t) { var n = t.source; null === t.stack && null !== n && xt(n), null !== n && wt(n), t = t.value, null !== e && 2 === e.tag && wt(e); try { t && t.suppressReactErrorLogging || console.error(t) } catch (r) { r && r.suppressReactErrorLogging || console.error(r) } } function Kl(e) { var t = e.ref; if (null !== t) if ("function" == typeof t) try { t(null) } catch (n) { Co(e, n) } else t.current = null } function $l(e) { switch ("function" == typeof Aa && Aa(e), e.tag) { case 2: Kl(e); var t = e.stateNode; if ("function" == typeof t.componentWillUnmount) try { t.props = e.memoizedProps, t.state = e.memoizedState, t.componentWillUnmount() } catch (n) { Co(e, n) } break; case 5: Kl(e); break; case 4: Gl(e) } } function Yl(e) { return 5 === e.tag || 3 === e.tag || 4 === e.tag } function Xl(e) { e: { for (var t = e.return; null !== t;) { if (Yl(t)) { var n = t; break e } t = t.return } c("160"), n = void 0 } var r = t = void 0; switch (n.tag) { case 5: t = n.stateNode, r = !1; break; case 3: case 4: t = n.stateNode.containerInfo, r = !0; break; default: c("161") }16 & n.effectTag && (Lr(t, ""), n.effectTag &= -17); e: t: for (n = e; ;) { for (; null === n.sibling;) { if (null === n.return || Yl(n.return)) { n = null; break e } n = n.return } for (n.sibling.return = n.return, n = n.sibling; 5 !== n.tag && 6 !== n.tag;) { if (2 & n.effectTag) continue t; if (null === n.child || 4 === n.tag) continue t; n.child.return = n, n = n.child } if (!(2 & n.effectTag)) { n = n.stateNode; break e } } for (var a = e; ;) { if (5 === a.tag || 6 === a.tag) if (n) if (r) { var l = t, o = a.stateNode, i = n; 8 === l.nodeType ? l.parentNode.insertBefore(o, i) : l.insertBefore(o, i) } else t.insertBefore(a.stateNode, n); else r ? (l = t, o = a.stateNode, 8 === l.nodeType ? l.parentNode.insertBefore(o, l) : l.appendChild(o)) : t.appendChild(a.stateNode); else if (4 !== a.tag && null !== a.child) { a.child.return = a, a = a.child; continue } if (a === e) break; for (; null === a.sibling;) { if (null === a.return || a.return === e) return; a = a.return } a.sibling.return = a.return, a = a.sibling } } function Gl(e) { for (var t = e, n = !1, r = void 0, a = void 0; ;) { if (!n) { n = t.return; e: for (; ;) { switch (null === n && c("160"), n.tag) { case 5: r = n.stateNode, a = !1; break e; case 3: case 4: r = n.stateNode.containerInfo, a = !0; break e }n = n.return } n = !0 } if (5 === t.tag || 6 === t.tag) { e: for (var l = t, o = l; ;)if ($l(o), null !== o.child && 4 !== o.tag) o.child.return = o, o = o.child; else { if (o === l) break; for (; null === o.sibling;) { if (null === o.return || o.return === l) break e; o = o.return } o.sibling.return = o.return, o = o.sibling } a ? (l = r, o = t.stateNode, 8 === l.nodeType ? l.parentNode.removeChild(o) : l.removeChild(o)) : r.removeChild(t.stateNode) } else if (4 === t.tag ? r = t.stateNode.containerInfo : $l(t), null !== t.child) { t.child.return = t, t = t.child; continue } if (t === e) break; for (; null === t.sibling;) { if (null === t.return || t.return === e) return; 4 === (t = t.return).tag && (n = !1) } t.sibling.return = t.return, t = t.sibling } } function Zl(e, t) { switch (t.tag) { case 2: break; case 5: var n = t.stateNode; if (null != n) { var r = t.memoizedProps; e = null !== e ? e.memoizedProps : r; var a = t.type, l = t.updateQueue; t.updateQueue = null, null !== l && (n[W] = r, Gr(n, l, a, e, r)) } break; case 6: null === t.stateNode && c("162"), t.stateNode.nodeValue = t.memoizedProps; break; case 3: case 15: case 16: break; default: c("163") } } function Jl(e, t, n) { (n = Va(n)).tag = 3, n.payload = { element: null }; var r = t.value; return n.callback = function () { oi(r), ql(e, t) }, n } function eo(e, t, n) { (n = Va(n)).tag = 3; var r = e.stateNode; return null !== r && "function" == typeof r.componentDidCatch && (n.callback = function () { null === yo ? yo = new Set([this]) : yo.add(this); var n = t.value, r = t.stack; ql(e, t), this.componentDidCatch(n, { componentStack: null !== r ? r : "" }) }), n } function to(e, t, n, r, a, l) { n.effectTag |= 512, n.firstEffect = n.lastEffect = null, r = Za(r, n), e = t; do { switch (e.tag) { case 3: return e.effectTag |= 1024, void qa(e, r = Jl(e, r, l), l); case 2: if (t = r, n = e.stateNode, 0 == (64 & e.effectTag) && null !== n && "function" == typeof n.componentDidCatch && (null === yo || !yo.has(n))) return e.effectTag |= 1024, void qa(e, r = eo(e, t, l), l) }e = e.return } while (null !== e) } function no(e) { switch (e.tag) { case 2: wa(e); var t = e.effectTag; return 1024 & t ? (e.effectTag = -1025 & t | 64, e) : null; case 3: return sl(e), xa(e), 1024 & (t = e.effectTag) ? (e.effectTag = -1025 & t | 64, e) : null; case 5: return fl(e), null; case 16: return 1024 & (t = e.effectTag) ? (e.effectTag = -1025 & t | 64, e) : null; case 4: return sl(e), null; case 13: return rl(e), null; default: return null } } Bl = function () { }, Vl = function (e, t, n) { (t.updateQueue = n) && Wl(t) }, Hl = function (e, t, n, r) { n !== r && Wl(t) }; var ro = la(), ao = 2, lo = ro, oo = 0, io = 0, uo = !1, co = null, so = null, fo = 0, po = -1, mo = !1, ho = null, vo = !1, go = !1, yo = null; function bo() { if (null !== co) for (var e = co.return; null !== e;) { var t = e; switch (t.tag) { case 2: wa(t); break; case 3: sl(t), xa(t); break; case 5: fl(t); break; case 4: sl(t); break; case 13: rl(t) }e = e.return } so = null, fo = 0, po = -1, mo = !1, co = null, go = !1 } function ko(e) { for (; ;) { var t = e.alternate, n = e.return, r = e.sibling; if (0 == (512 & e.effectTag)) { t = Ql(t, e, fo); var a = e; if (1073741823 === fo || 1073741823 !== a.expirationTime) { var l = 0; switch (a.tag) { case 3: case 2: var o = a.updateQueue; null !== o && (l = o.expirationTime) }for (o = a.child; null !== o;)0 !== o.expirationTime && (0 === l || l > o.expirationTime) && (l = o.expirationTime), o = o.sibling; a.expirationTime = l } if (null !== t) return t; if (null !== n && 0 == (512 & n.effectTag) && (null === n.firstEffect && (n.firstEffect = e.firstEffect), null !== e.lastEffect && (null !== n.lastEffect && (n.lastEffect.nextEffect = e.firstEffect), n.lastEffect = e.lastEffect), 1 < e.effectTag && (null !== n.lastEffect ? n.lastEffect.nextEffect = e : n.firstEffect = e, n.lastEffect = e)), null !== r) return r; if (null === n) { go = !0; break } e = n } else { if (null !== (e = no(e, mo, fo))) return e.effectTag &= 511, e; if (null !== n && (n.firstEffect = n.lastEffect = null, n.effectTag |= 512), null !== r) return r; if (null === n) break; e = n } } return null } function wo(e) { var t = jl(e.alternate, e, fo); return null === t && (t = ko(e)), it.current = null, t } function xo(e, t, n) { uo && c("243"), uo = !0, t === fo && e === so && null !== co || (bo(), fo = t, po = -1, co = Pa((so = e).current, null, fo), e.pendingCommitExpirationTime = 0); var r = !1; for (mo = !n || fo <= ao; ;) { try { if (n) for (; null !== co && !li();)co = wo(co); else for (; null !== co;)co = wo(co) } catch (l) { if (null === co) r = !0, oi(l); else { null === co && c("271"); var a = (n = co).return; if (null === a) { r = !0, oi(l); break } to(e, a, n, l, mo, fo, lo), co = ko(n) } } break } if (uo = !1, r) return null; if (null === co) { if (go) return e.pendingCommitExpirationTime = t, e.current.alternate; mo && c("262"), 0 <= po && setTimeout(function () { var t = e.current.expirationTime; 0 !== t && (0 === e.remainingExpirationTime || e.remainingExpirationTime < t) && Xo(e, t) }, po), ii(e.current.expirationTime) } return null } function Co(e, t) { var n; e: { for (uo && !vo && c("263"), n = e.return; null !== n;) { switch (n.tag) { case 2: var r = n.stateNode; if ("function" == typeof n.type.getDerivedStateFromCatch || "function" == typeof r.componentDidCatch && (null === yo || !yo.has(r))) { Qa(n, e = eo(n, e = Za(t, e), 1), 1), _o(n, 1), n = void 0; break e } break; case 3: Qa(n, e = Jl(n, e = Za(t, e), 1), 1), _o(n, 1), n = void 0; break e }n = n.return } 3 === e.tag && (Qa(e, n = Jl(e, n = Za(t, e), 1), 1), _o(e, 1)), n = void 0 } return n } function Eo() { var e = 2 + 25 * (1 + ((So() - 2 + 500) / 25 | 0)); return e <= oo && (e = oo + 1), oo = e } function To(e, t) { return e = 0 !== io ? io : uo ? vo ? 1 : fo : 1 & t.mode ? Ho ? 2 + 10 * (1 + ((e - 2 + 15) / 10 | 0)) : 2 + 25 * (1 + ((e - 2 + 500) / 25 | 0)) : 1, Ho && (0 === Do || e > Do) && (Do = e), e } function _o(e, t) { for (; null !== e;) { if ((0 === e.expirationTime || e.expirationTime > t) && (e.expirationTime = t), null !== e.alternate && (0 === e.alternate.expirationTime || e.alternate.expirationTime > t) && (e.alternate.expirationTime = t), null === e.return) { if (3 !== e.tag) break; var n = e.stateNode; !uo && 0 !== fo && t < fo && bo(); var r = n.current.expirationTime; uo && !vo && so === n || Xo(n, r), Ko > qo && c("185") } e = e.return } } function So() { return lo = la() - ro, ao = 2 + (lo / 10 | 0) } function Po(e) { var t = io; io = 2 + 25 * (1 + ((So() - 2 + 500) / 25 | 0)); try { return e() } finally { io = t } } function No(e, t, n, r, a) { var l = io; io = 1; try { return e(t, n, r, a) } finally { io = l } } var Uo = null, Fo = null, Io = 0, Mo = void 0, Ro = !1, zo = null, Oo = 0, Do = 0, Lo = !1, Ao = !1, jo = null, Wo = null, Bo = !1, Vo = !1, Ho = !1, Qo = null, qo = 1e3, Ko = 0, $o = 1; function Yo(e) { if (0 !== Io) { if (e > Io) return; null !== Mo && ia(Mo) } var t = la() - ro; Io = e, Mo = oa(Zo, { timeout: 10 * (e - 2) - t }) } function Xo(e, t) { if (null === e.nextScheduledRoot) e.remainingExpirationTime = t, null === Fo ? (Uo = Fo = e, e.nextScheduledRoot = e) : (Fo = Fo.nextScheduledRoot = e).nextScheduledRoot = Uo; else { var n = e.remainingExpirationTime; (0 === n || t < n) && (e.remainingExpirationTime = t) } Ro || (Bo ? Vo && (zo = e, Oo = 1, ri(e, 1, !1)) : 1 === t ? Jo() : Yo(t)) } function Go() { var e = 0, t = null; if (null !== Fo) for (var n = Fo, r = Uo; null !== r;) { var a = r.remainingExpirationTime; if (0 === a) { if ((null === n || null === Fo) && c("244"), r === r.nextScheduledRoot) { Uo = Fo = r.nextScheduledRoot = null; break } if (r === Uo) Uo = a = r.nextScheduledRoot, Fo.nextScheduledRoot = a, r.nextScheduledRoot = null; else { if (r === Fo) { (Fo = n).nextScheduledRoot = Uo, r.nextScheduledRoot = null; break } n.nextScheduledRoot = r.nextScheduledRoot, r.nextScheduledRoot = null } r = n.nextScheduledRoot } else { if ((0 === e || a < e) && (e = a, t = r), r === Fo) break; n = r, r = r.nextScheduledRoot } } null !== (n = zo) && n === t && 1 === e ? Ko++ : Ko = 0, zo = t, Oo = e } function Zo(e) { ei(0, !0, e) } function Jo() { ei(1, !1, null) } function ei(e, t, n) { if (Wo = n, Go(), t) for (; null !== zo && 0 !== Oo && (0 === e || e >= Oo) && (!Lo || So() >= Oo);)So(), ri(zo, Oo, !Lo), Go(); else for (; null !== zo && 0 !== Oo && (0 === e || e >= Oo);)ri(zo, Oo, !1), Go(); null !== Wo && (Io = 0, Mo = null), 0 !== Oo && Yo(Oo), Wo = null, Lo = !1, ni() } function ti(e, t) { Ro && c("253"), zo = e, Oo = t, ri(e, t, !1), Jo(), ni() } function ni() { if (Ko = 0, null !== Qo) { var e = Qo; Qo = null; for (var t = 0; t < e.length; t++) { var n = e[t]; try { n._onComplete() } catch (r) { Ao || (Ao = !0, jo = r) } } } if (Ao) throw e = jo, jo = null, Ao = !1, e } function ri(e, t, n) { Ro && c("245"), Ro = !0, n ? null !== (n = e.finishedWork) ? ai(e, n, t) : null !== (n = xo(e, t, !0)) && (li() ? e.finishedWork = n : ai(e, n, t)) : null !== (n = e.finishedWork) ? ai(e, n, t) : null !== (n = xo(e, t, !1)) && ai(e, n, t), Ro = !1 } function ai(e, t, n) { var r = e.firstBatch; if (null !== r && r._expirationTime <= n && (null === Qo ? Qo = [r] : Qo.push(r), r._defer)) return e.finishedWork = t, void (e.remainingExpirationTime = 0); if (e.finishedWork = null, vo = uo = !0, (n = t.stateNode).current === t && c("177"), 0 === (r = n.pendingCommitExpirationTime) && c("261"), n.pendingCommitExpirationTime = 0, So(), it.current = null, 1 < t.effectTag) if (null !== t.lastEffect) { t.lastEffect.nextEffect = t; var a = t.firstEffect } else a = t; else a = t.firstEffect; ta = zn; var o = l(); if ($n(o)) { if ("selectionStart" in o) var u = { start: o.selectionStart, end: o.selectionEnd }; else e: { var s = window.getSelection && window.getSelection(); if (s && 0 !== s.rangeCount) { u = s.anchorNode; var f = s.anchorOffset, d = s.focusNode; s = s.focusOffset; try { u.nodeType, d.nodeType } catch (j) { u = null; break e } var p = 0, m = -1, h = -1, v = 0, g = 0, y = o, b = null; t: for (; ;) { for (var k; y !== u || 0 !== f && 3 !== y.nodeType || (m = p + f), y !== d || 0 !== s && 3 !== y.nodeType || (h = p + s), 3 === y.nodeType && (p += y.nodeValue.length), null !== (k = y.firstChild);)b = y, y = k; for (; ;) { if (y === o) break t; if (b === u && ++v === f && (m = p), b === d && ++g === s && (h = p), null !== (k = y.nextSibling)) break; b = (y = b).parentNode } y = k } u = -1 === m || -1 === h ? null : { start: m, end: h } } else u = null } u = u || { start: 0, end: 0 } } else u = null; for (na = { focusedElem: o, selectionRange: u }, On(!1), ho = a; null !== ho;) { o = !1, u = void 0; try { for (; null !== ho;) { if (256 & ho.effectTag) { var w = ho.alternate; switch ((f = ho).tag) { case 2: if (256 & f.effectTag && null !== w) { var x = w.memoizedProps, C = w.memoizedState, E = f.stateNode; E.props = f.memoizedProps, E.state = f.memoizedState; var T = E.getSnapshotBeforeUpdate(x, C); E.__reactInternalSnapshotBeforeUpdate = T } break; case 3: case 5: case 6: case 4: break; default: c("163") } } ho = ho.nextEffect } } catch (j) { o = !0, u = j } o && (null === ho && c("178"), Co(ho, u), null !== ho && (ho = ho.nextEffect)) } for (ho = a; null !== ho;) { w = !1, x = void 0; try { for (; null !== ho;) { var _ = ho.effectTag; if (16 & _ && Lr(ho.stateNode, ""), 128 & _) { var S = ho.alternate; if (null !== S) { var P = S.ref; null !== P && ("function" == typeof P ? P(null) : P.current = null) } } switch (14 & _) { case 2: Xl(ho), ho.effectTag &= -3; break; case 6: Xl(ho), ho.effectTag &= -3, Zl(ho.alternate, ho); break; case 4: Zl(ho.alternate, ho); break; case 8: Gl(C = ho), C.return = null, C.child = null, C.alternate && (C.alternate.child = null, C.alternate.return = null) }ho = ho.nextEffect } } catch (j) { w = !0, x = j } w && (null === ho && c("178"), Co(ho, x), null !== ho && (ho = ho.nextEffect)) } if (P = na, S = l(), _ = P.focusedElem, w = P.selectionRange, S !== _ && i(document.documentElement, _)) { null !== w && $n(_) && (S = w.start, void 0 === (P = w.end) && (P = S), "selectionStart" in _ ? (_.selectionStart = S, _.selectionEnd = Math.min(P, _.value.length)) : window.getSelection && (S = window.getSelection(), x = _[pe()].length, P = Math.min(w.start, x), w = void 0 === w.end ? P : Math.min(w.end, x), !S.extend && P > w && (x = w, w = P, P = x), x = Kn(_, P), C = Kn(_, w), x && C && (1 !== S.rangeCount || S.anchorNode !== x.node || S.anchorOffset !== x.offset || S.focusNode !== C.node || S.focusOffset !== C.offset) && ((E = document.createRange()).setStart(x.node, x.offset), S.removeAllRanges(), P > w ? (S.addRange(E), S.extend(C.node, C.offset)) : (E.setEnd(C.node, C.offset), S.addRange(E))))), S = []; for (P = _; P = P.parentNode;)1 === P.nodeType && S.push({ element: P, left: P.scrollLeft, top: P.scrollTop }); for ("function" == typeof _.focus && _.focus(), _ = 0; _ < S.length; _++)(P = S[_]).element.scrollLeft = P.left, P.element.scrollTop = P.top } for (na = null, On(ta), ta = null, n.current = t, ho = a; null !== ho;) { a = !1, _ = void 0; try { for (S = r; null !== ho;) { var N = ho.effectTag; if (36 & N) { var U = ho.alternate; switch (w = S, (P = ho).tag) { case 2: var F = P.stateNode; if (4 & P.effectTag) if (null === U) F.props = P.memoizedProps, F.state = P.memoizedState, F.componentDidMount(); else { var I = U.memoizedProps, M = U.memoizedState; F.props = P.memoizedProps, F.state = P.memoizedState, F.componentDidUpdate(I, M, F.__reactInternalSnapshotBeforeUpdate) } var R = P.updateQueue; null !== R && (F.props = P.memoizedProps, F.state = P.memoizedState, Ga(P, R, F, w)); break; case 3: var z = P.updateQueue; if (null !== z) { if (x = null, null !== P.child) switch (P.child.tag) { case 5: x = P.child.stateNode; break; case 2: x = P.child.stateNode }Ga(P, z, x, w) } break; case 5: var O = P.stateNode; null === U && 4 & P.effectTag && ra(P.type, P.memoizedProps) && O.focus(); break; case 6: case 4: case 15: case 16: break; default: c("163") } } if (128 & N) { P = void 0; var D = ho.ref; if (null !== D) { var L = ho.stateNode; switch (ho.tag) { case 5: P = L; break; default: P = L }"function" == typeof D ? D(P) : D.current = P } } var A = ho.nextEffect; ho.nextEffect = null, ho = A } } catch (j) { a = !0, _ = j } a && (null === ho && c("178"), Co(ho, _), null !== ho && (ho = ho.nextEffect)) } uo = vo = !1, "function" == typeof La && La(t.stateNode), 0 === (t = n.current.expirationTime) && (yo = null), e.remainingExpirationTime = t } function li() { return !(null === Wo || Wo.timeRemaining() > $o) && (Lo = !0) } function oi(e) { null === zo && c("246"), zo.remainingExpirationTime = 0, Ao || (Ao = !0, jo = e) } function ii(e) { null === zo && c("246"), zo.remainingExpirationTime = e } function ui(e, t) { var n = Bo; Bo = !0; try { return e(t) } finally { (Bo = n) || Ro || Jo() } } function ci(e, t) { if (Bo && !Vo) { Vo = !0; try { return e(t) } finally { Vo = !1 } } return e(t) } function si(e, t) { Ro && c("187"); var n = Bo; Bo = !0; try { return No(e, t) } finally { Bo = n, Jo() } } function fi(e, t, n) { if (Ho) return e(t, n); Bo || Ro || 0 === Do || (ei(Do, !1, null), Do = 0); var r = Ho, a = Bo; Bo = Ho = !0; try { return e(t, n) } finally { Ho = r, (Bo = a) || Ro || Jo() } } function di(e) { var t = Bo; Bo = !0; try { No(e) } finally { (Bo = t) || Ro || ei(1, !1, null) } } function pi(e, t, n, r, a) { var l = t.current; if (n) { var o; e: { for (2 === fn(n = n._reactInternalFiber) && 2 === n.tag || c("170"), o = n; 3 !== o.tag;) { if (ka(o)) { o = o.stateNode.__reactInternalMemoizedMergedChildContext; break e } (o = o.return) || c("171") } o = o.stateNode.context } n = ka(n) ? Ea(n, o) : o } else n = u; return null === t.context ? t.context = n : t.pendingContext = n, t = a, (a = Va(r)).payload = { element: e }, null !== (t = void 0 === t ? null : t) && (a.callback = t), Qa(l, a, r), _o(l, r), r } function mi(e) { var t = e._reactInternalFiber; return void 0 === t && ("function" == typeof e.render ? c("188") : c("268", Object.keys(e))), null === (e = mn(t)) ? null : e.stateNode } function hi(e, t, n, r) { var a = t.current; return pi(e, t, n, a = To(So(), a), r) } function vi(e) { if (!(e = e.current).child) return null; switch (e.child.tag) { case 5: default: return e.child.stateNode } } function gi(e) { var t = e.findFiberByHostInstance; return Da(r({}, e, { findHostInstanceByFiber: function (e) { return null === (e = mn(e)) ? null : e.stateNode }, findFiberByHostInstance: function (e) { return t ? t(e) : null } })) } var yi = { updateContainerAtExpirationTime: pi, createContainer: function (e, t, n) { return Ma(e, t, n) }, updateContainer: hi, flushRoot: ti, requestWork: Xo, computeUniqueAsyncExpiration: Eo, batchedUpdates: ui, unbatchedUpdates: ci, deferredUpdates: Po, syncUpdates: No, interactiveUpdates: fi, flushInteractiveUpdates: function () { Ro || 0 === Do || (ei(Do, !1, null), Do = 0) }, flushControlled: di, flushSync: si, getPublicRootInstance: vi, findHostInstance: mi, findHostInstanceWithNoPortals: function (e) { return null === (e = hn(e)) ? null : e.stateNode }, injectIntoDevTools: gi }; function bi(e, t, n) { var r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : null; return { $$typeof: st, key: null == r ? null : "" + r, children: e, containerInfo: t, implementation: n } } function ki(e) { this._expirationTime = Eo(), this._root = e, this._callbacks = this._next = null, this._hasChildren = this._didComplete = !1, this._children = null, this._defer = !0 } function wi() { this._callbacks = null, this._didCommit = !1, this._onCommit = this._onCommit.bind(this) } function xi(e, t, n) { this._internalRoot = Ma(e, t, n) } function Ci(e) { return !(!e || 1 !== e.nodeType && 9 !== e.nodeType && 11 !== e.nodeType && (8 !== e.nodeType || " react-mount-point-unstable " !== e.nodeValue)) } function Ei(e, t) { if (t || (t = !(!(t = e ? 9 === e.nodeType ? e.documentElement : e.firstChild : null) || 1 !== t.nodeType || !t.hasAttribute("data-reactroot"))), !t) for (var n; n = e.lastChild;)e.removeChild(n); return new xi(e, !1, t) } function Ti(e, t, n, r, a) { Ci(n) || c("200"); var l = n._reactRootContainer; if (l) { if ("function" == typeof a) { var o = a; a = function () { var e = vi(l._internalRoot); o.call(e) } } null != e ? l.legacy_renderSubtreeIntoContainer(e, t, a) : l.render(t, a) } else { if (l = n._reactRootContainer = Ei(n, r), "function" == typeof a) { var i = a; a = function () { var e = vi(l._internalRoot); i.call(e) } } ci(function () { null != e ? l.legacy_renderSubtreeIntoContainer(e, t, a) : l.render(t, a) }) } return vi(l._internalRoot) } function _i(e, t) { var n = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : null; return Ci(t) || c("200"), bi(e, t, null, n) } je.injectFiberControlledHostComponent(ea), ki.prototype.render = function (e) { this._defer || c("250"), this._hasChildren = !0, this._children = e; var t = this._root._internalRoot, n = this._expirationTime, r = new wi; return pi(e, t, null, n, r._onCommit), r }, ki.prototype.then = function (e) { if (this._didComplete) e(); else { var t = this._callbacks; null === t && (t = this._callbacks = []), t.push(e) } }, ki.prototype.commit = function () { var e = this._root._internalRoot, t = e.firstBatch; if (this._defer && null !== t || c("251"), this._hasChildren) { var n = this._expirationTime; if (t !== this) { this._hasChildren && (n = this._expirationTime = t._expirationTime, this.render(this._children)); for (var r = null, a = t; a !== this;)r = a, a = a._next; null === r && c("251"), r._next = a._next, this._next = t, e.firstBatch = this } this._defer = !1, ti(e, n), t = this._next, this._next = null, null !== (t = e.firstBatch = t) && t._hasChildren && t.render(t._children) } else this._next = null, this._defer = !1 }, ki.prototype._onComplete = function () { if (!this._didComplete) { this._didComplete = !0; var e = this._callbacks; if (null !== e) for (var t = 0; t < e.length; t++)(0, e[t])() } }, wi.prototype.then = function (e) { if (this._didCommit) e(); else { var t = this._callbacks; null === t && (t = this._callbacks = []), t.push(e) } }, wi.prototype._onCommit = function () { if (!this._didCommit) { this._didCommit = !0; var e = this._callbacks; if (null !== e) for (var t = 0; t < e.length; t++) { var n = e[t]; "function" != typeof n && c("191", n), n() } } }, xi.prototype.render = function (e, t) { var n = this._internalRoot, r = new wi; return null !== (t = void 0 === t ? null : t) && r.then(t), hi(e, n, null, r._onCommit), r }, xi.prototype.unmount = function (e) { var t = this._internalRoot, n = new wi; return null !== (e = void 0 === e ? null : e) && n.then(e), hi(null, t, null, n._onCommit), n }, xi.prototype.legacy_renderSubtreeIntoContainer = function (e, t, n) { var r = this._internalRoot, a = new wi; return null !== (n = void 0 === n ? null : n) && a.then(n), hi(t, r, e, a._onCommit), a }, xi.prototype.createBatch = function () { var e = new ki(this), t = e._expirationTime, n = this._internalRoot, r = n.firstBatch; if (null === r) n.firstBatch = e, e._next = null; else { for (n = null; null !== r && r._expirationTime <= t;)n = r, r = r._next; e._next = r, null !== n && (n._next = e) } return e }, $e = yi.batchedUpdates, Ye = yi.interactiveUpdates, Xe = yi.flushInteractiveUpdates; var Si = { createPortal: _i, findDOMNode: function (e) { return null == e ? null : 1 === e.nodeType ? e : mi(e) }, hydrate: function (e, t, n) { return Ti(null, e, t, !0, n) }, render: function (e, t, n) { return Ti(null, e, t, !1, n) }, unstable_renderSubtreeIntoContainer: function (e, t, n, r) { return (null == e || void 0 === e._reactInternalFiber) && c("38"), Ti(e, t, n, !1, r) }, unmountComponentAtNode: function (e) { return Ci(e) || c("40"), !!e._reactRootContainer && (ci(function () { Ti(null, null, e, !1, function () { e._reactRootContainer = null }) }), !0) }, unstable_createPortal: function () { return _i.apply(void 0, arguments) }, unstable_batchedUpdates: ui, unstable_deferredUpdates: Po, unstable_interactiveUpdates: fi, flushSync: si, unstable_flushControlled: di, __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED: { EventPluginHub: L, EventPluginRegistry: C, EventPropagators: te, ReactControlledComponent: Ke, ReactDOMComponentTree: Q, ReactDOMEventListener: Wn }, unstable_createRoot: function (e, t) { return new xi(e, !0, null != t && !0 === t.hydrate) } }; gi({ findFiberByHostInstance: B, bundleType: 0, version: "16.4.1", rendererPackageName: "react-dom" }); var Pi = { default: Si }, Ni = Pi && Si || Pi; module.exports = Ni.default ? Ni.default : Ni;
    }, { "fbjs/lib/invariant": "wRU+", "react": "1n8/", "fbjs/lib/ExecutionEnvironment": "KW17", "object-assign": "J4Nk", "fbjs/lib/emptyFunction": "UQex", "fbjs/lib/getActiveElement": "XeWd", "fbjs/lib/shallowEqual": "lyLi", "fbjs/lib/containsNode": "epr4", "fbjs/lib/emptyObject": "+CtU" }], "NKHc": [function (require, module, exports) {
        "use strict"; function _() { if ("undefined" != typeof __REACT_DEVTOOLS_GLOBAL_HOOK__ && "function" == typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE) { 0; try { __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_) } catch (O) { console.error(O) } } } _(), module.exports = require("./cjs/react-dom.production.min.js");
    }, { "./cjs/react-dom.production.min.js": "i17t" }], "pBGv": [function (require, module, exports) {

        var t, e, n = module.exports = {}; function r() { throw new Error("setTimeout has not been defined") } function o() { throw new Error("clearTimeout has not been defined") } function i(e) { if (t === setTimeout) return setTimeout(e, 0); if ((t === r || !t) && setTimeout) return t = setTimeout, setTimeout(e, 0); try { return t(e, 0) } catch (n) { try { return t.call(null, e, 0) } catch (n) { return t.call(this, e, 0) } } } function u(t) { if (e === clearTimeout) return clearTimeout(t); if ((e === o || !e) && clearTimeout) return e = clearTimeout, clearTimeout(t); try { return e(t) } catch (n) { try { return e.call(null, t) } catch (n) { return e.call(this, t) } } } !function () { try { t = "function" == typeof setTimeout ? setTimeout : r } catch (n) { t = r } try { e = "function" == typeof clearTimeout ? clearTimeout : o } catch (n) { e = o } }(); var c, s = [], l = !1, a = -1; function f() { l && c && (l = !1, c.length ? s = c.concat(s) : a = -1, s.length && h()) } function h() { if (!l) { var t = i(f); l = !0; for (var e = s.length; e;) { for (c = s, s = []; ++a < e;)c && c[a].run(); a = -1, e = s.length } c = null, l = !1, u(t) } } function m(t, e) { this.fun = t, this.array = e } function p() { } n.nextTick = function (t) { var e = new Array(arguments.length - 1); if (arguments.length > 1) for (var n = 1; n < arguments.length; n++)e[n - 1] = arguments[n]; s.push(new m(t, e)), 1 !== s.length || l || i(h) }, m.prototype.run = function () { this.fun.apply(null, this.array) }, n.title = "browser", n.browser = !0, n.env = {}, n.argv = [], n.version = "", n.versions = {}, n.on = p, n.addListener = p, n.once = p, n.off = p, n.removeListener = p, n.removeAllListeners = p, n.emit = p, n.prependListener = p, n.prependOnceListener = p, n.listeners = function (t) { return [] }, n.binding = function (t) { throw new Error("process.binding is not supported") }, n.cwd = function () { return "/" }, n.chdir = function (t) { throw new Error("process.chdir is not supported") }, n.umask = function () { return 0 };
    }, {}], "6uYi": [function (require, module, exports) {
        var process = require("process");
        var global = arguments[3];
        var e = require("process"), t = arguments[3]; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.untracked = Rn, exports.createAtom = lt, exports.spy = m, exports.isObservableObject = be, exports.isObservableArray = _t, exports.transaction = Fe, exports.isObservable = xe, exports.isObservableProp = Oe, exports.isComputed = _e, exports.isComputedProp = Se, exports.extendObservable = ke, exports.extendShallowObservable = Te, exports.observe = Jn, exports.intercept = Xn, exports.autorun = W, exports.reaction = J, exports.when = Zn, exports.isAction = P, exports.runInAction = V, exports.keys = nr, exports.values = rr, exports.entries = or, exports.set = ir, exports.remove = ar, exports.has = sr, exports.get = ur, exports.decorate = cr, exports.configure = lr, exports.onBecomeObserved = at, exports.onBecomeUnobserved = st, exports.flow = fr, exports.toJS = gr, exports.trace = Bn, exports.getDependencyTree = un, exports.getObserverTree = ln, exports._resetGlobalState = sn, exports._getGlobalState = an, exports.getDebugName = it, exports.getAtom = rt, exports._getAdministration = ot, exports._allowStateChanges = _, exports.isArrayLike = zt, exports._isComputingDerivation = Tn, exports.onReactionError = Mn, exports._interceptReads = xr, exports.action = exports.computed = exports.observable = exports.isObservableMap = exports.ObservableMap = exports.isBoxedObservable = exports.comparer = exports.IDerivationState = exports.Reaction = exports.$mobx = void 0; var n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) }; function r(e, t) { function r() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (r.prototype = t.prototype, new r) } var o = Object.assign || function (e) { for (var t, n = 1, r = arguments.length; n < r; n++)for (var o in t = arguments[n]) Object.prototype.hasOwnProperty.call(t, o) && (e[o] = t[o]); return e }; function i(e, t) { var n = "function" == typeof Symbol && e[Symbol.iterator]; if (!n) return e; var r, o, i = n.call(e), a = []; try { for (; (void 0 === t || t-- > 0) && !(r = i.next()).done;)a.push(r.value) } catch (s) { o = { error: s } } finally { try { r && !r.done && (n = i.return) && n.call(i) } finally { if (o) throw o.error } } return a } function a() { for (var e = [], t = 0; t < arguments.length; t++)e = e.concat(i(arguments[t])); return e } var s = {}, u = {}; function c(e, t) { var n = t ? s : u; return n[e] || (n[e] = { configurable: !0, enumerable: t, get: function () { return l(this), this[e] }, set: function (t) { l(this), this[e] = t } }) } function l(e) { if (!0 !== e.__mobxDidRunLazyInitializers) { var t = e.__mobxDecorators; if (t) for (var n in $t(e, "__mobxDidRunLazyInitializers", !0), t) { var r = t[n]; r.propertyCreator(e, r.prop, r.descriptor, r.decoratorTarget, r.decoratorArguments) } } } function p(e, t) { return function () { var n, r = function (r, i, a, s) { if (!0 === s) return t(r, i, a, r, n), null; if (!Object.prototype.hasOwnProperty.call(r, "__mobxDecorators")) { var u = r.__mobxDecorators; $t(r, "__mobxDecorators", o({}, u)) } return r.__mobxDecorators[i] = { prop: i, propertyCreator: t, descriptor: a, decoratorTarget: r, decoratorArguments: n }, c(i, e) }; return f(arguments) ? (n = At, r.apply(null, arguments)) : (n = Array.prototype.slice.call(arguments), r) } } function f(e) { return (2 === e.length || 3 === e.length) && "string" == typeof e[1] || 4 === e.length && !0 === e[3] } function h() { return !!tn.spyListeners.length } function v(e) { if (tn.spyListeners.length) for (var t = tn.spyListeners, n = 0, r = t.length; n < r; n++)t[n](e) } function d(e) { v(o({}, e, { spyReportStart: !0 })) } var y = { spyReportEnd: !0 }; function b(e) { v(e ? o({}, e, { spyReportEnd: !0 }) : y) } function m(e) { return tn.spyListeners.push(e), Rt(function () { tn.spyListeners = tn.spyListeners.filter(function (t) { return t !== e }) }) } function g(e, t) { var n = function () { return x(e, t, this, arguments) }; return n.isMobxAction = !0, n } function x(e, t, n, r) { var o = O(e, t, n, r); try { return t.apply(n, r) } finally { w(o) } } function O(e, t, n, r) { var o = h() && !!e, i = 0; if (o) { i = Date.now(); var a = r && r.length || 0, s = new Array(a); if (a > 0) for (var u = 0; u < a; u++)s[u] = r[u]; d({ type: "action", name: e, object: n, arguments: s }) } var c = Cn(); return bn(), { prevDerivation: c, prevAllowStateChanges: S(!0), notifySpy: o, startTime: i } } function w(e) { A(e.prevAllowStateChanges), mn(), In(e.prevDerivation), e.notifySpy && b({ time: Date.now() - e.startTime }) } function _(e, t) { var n, r = S(e); try { n = t() } finally { A(r) } return n } function S(e) { var t = tn.allowStateChanges; return tn.allowStateChanges = e, t } function A(e) { tn.allowStateChanges = e } function E() { kt(!1) } function j(e) { return function (t, n, r) { if (r) { if (r.value) return { value: g(e, r.value), enumerable: !1, configurable: !0, writable: !0 }; var o = r.initializer; return { enumerable: !1, configurable: !0, writable: !0, initializer: function () { return g(e, o.call(this)) } } } return T(e).apply(this, arguments) } } function T(e) { return function (t, n, r) { Object.defineProperty(t, n, { configurable: !0, enumerable: !1, get: function () { }, set: function (t) { $t(this, n, D(e, t)) } }) } } function k(e, t, n, r) { return !0 === r ? (R(e, t, n.value), null) : n ? { configurable: !0, enumerable: !1, get: function () { return R(this, t, n.value || n.initializer.call(this)), this[t] }, set: E } : { enumerable: !1, configurable: !0, set: function (e) { R(this, t, e) }, get: function () { } } } var D = function (e, t, n, r) { return 1 === arguments.length && "function" == typeof e ? g(e.name || "<unnamed action>", e) : 2 === arguments.length && "function" == typeof t ? g(e, t) : 1 === arguments.length && "string" == typeof e ? j(e) : !0 !== r ? j(t).apply(null, arguments) : void (e[t] = g(e.name || t, n.value)) }; function V(e, t) { var n = "string" == typeof e ? e : e.name || "<unnamed action>", r = "function" == typeof e ? e : t; return x(n, r, this, void 0) } function P(e) { return "function" == typeof e && !0 === e.isMobxAction } function R(e, t, n) { $t(e, t, g(t, n.bind(e))) } exports.action = D, D.bound = k; var C = Object.prototype.toString; function I(e, t) { return L(e, t) } function L(e, t, n, r) { if (e === t) return 0 !== e || 1 / e == 1 / t; if (null == e || null == t) return !1; if (e != e) return t != t; var o = typeof e; return ("function" === o || "object" === o || "object" == typeof t) && B(e, t, n, r) } function B(e, t, n, r) { e = N(e), t = N(t); var o = C.call(e); if (o !== C.call(t)) return !1; switch (o) { case "[object RegExp]": case "[object String]": return "" + e == "" + t; case "[object Number]": return +e != +e ? +t != +t : 0 == +e ? 1 / +e == 1 / t : +e == +t; case "[object Date]": case "[object Boolean]": return +e == +t; case "[object Symbol]": return "undefined" != typeof Symbol && Symbol.valueOf.call(e) === Symbol.valueOf.call(t) }var i = "[object Array]" === o; if (!i) { if ("object" != typeof e || "object" != typeof t) return !1; var a = e.constructor, s = t.constructor; if (a !== s && !("function" == typeof a && a instanceof a && "function" == typeof s && s instanceof s) && "constructor" in e && "constructor" in t) return !1 } r = r || []; for (var u = (n = n || []).length; u--;)if (n[u] === e) return r[u] === t; if (n.push(e), r.push(t), i) { if ((u = e.length) !== t.length) return !1; for (; u--;)if (!L(e[u], t[u], n, r)) return !1 } else { var c, l = Object.keys(e); if (u = l.length, Object.keys(t).length !== u) return !1; for (; u--;)if (!$(t, c = l[u]) || !L(e[c], t[c], n, r)) return !1 } return n.pop(), r.pop(), !0 } function N(e) { return _t(e) ? e.peek() : Ht(e) || nt(e) ? qt(e.entries()) : e } function $(e, t) { return Object.prototype.hasOwnProperty.call(e, t) } function M(e, t) { return e === t } function U(e, t) { return I(e, t) } function G(e, t) { return Wt(e, t) || M(e, t) } var K = { identity: M, structural: U, default: G }; function W(e, t) { void 0 === t && (t = Et); var n, r = t && t.name || e.name || "Autorun@" + Tt(); if (!t.scheduler && !t.delay) n = new $n(r, function () { this.track(a) }, t.onError); else { var o = H(t), i = !1; n = new $n(r, function () { i || (i = !0, o(function () { i = !1, n.isDisposed || n.track(a) })) }, t.onError) } function a() { e(n) } return n.schedule(), n.getDisposer() } exports.comparer = K; var z = function (e) { return e() }; function H(e) { return e.scheduler ? e.scheduler : e.delay ? function (t) { return setTimeout(t, e.delay) } : z } function J(e, t, n) { void 0 === n && (n = Et), "boolean" == typeof n && (n = { fireImmediately: n }, Pt("Using fireImmediately as argument is deprecated. Use '{ fireImmediately: true }' instead")); var r, o = n.name || "Reaction@" + Tt(), i = D(o, n.onError ? q(n.onError, t) : t), a = !n.scheduler && !n.delay, s = H(n), u = !0, c = !1, l = n.compareStructural ? K.structural : n.equals || K.default, p = new $n(o, function () { u || a ? f() : c || (c = !0, s(f)) }, n.onError); function f() { if (c = !1, !p.isDisposed) { var t = !1; p.track(function () { var n = e(p); t = u || !l(r, n), r = n }), u && n.fireImmediately && i(r, p), u || !0 !== t || i(r, p), u && (u = !1) } } return p.schedule(), p.getDisposer() } function q(e, t) { return function () { try { return t.apply(this, arguments) } catch (n) { e.call(this, n) } } } var Y = function () { function e(e) { var t = this; this.dependenciesState = Ft.NOT_TRACKING, this.observing = [], this.newObserving = null, this.isBeingObserved = !1, this.isPendingUnobservation = !1, this.observers = [], this.observersIndexes = {}, this.diffValue = 0, this.runId = 0, this.lastAccessedBy = 0, this.lowestObserverState = Ft.UP_TO_DATE, this.unboundDepsCount = 0, this.__mapid = "#" + Tt(), this.value = new An(null), this.isComputing = !1, this.isRunningSetter = !1, this.isTracing = Qt.NONE, this.derivation = e.get, this.name = e.name || "ComputedValue@" + Tt(), e.set && (this.setter = g(this.name + "-setter", e.set)), this.equals = e.equals || (e.compareStructural || e.struct ? K.structural : K.default), this.scope = e.context, this.requiresReaction = !!e.requiresReaction, !0 === e.keepAlive && W(function () { return t.get() }) } return e.prototype.onBecomeStale = function () { wn(this) }, e.prototype.onBecomeUnobserved = function () { }, e.prototype.onBecomeObserved = function () { }, e.prototype.get = function () { this.isComputing && kt("Cycle detected in computation " + this.name + ": " + this.derivation), 0 === tn.inBatch && 0 === this.observers.length ? jn(this) && (this.warnAboutUntrackedRead(), bn(), this.value = this.computeValue(!1), mn()) : (gn(this), jn(this) && this.trackAndCompute() && On(this)); var e = this.value; if (En(e)) throw e.cause; return e }, e.prototype.peek = function () { var e = this.computeValue(!1); if (En(e)) throw e.cause; return e }, e.prototype.set = function (e) { if (this.setter) { Dt(!this.isRunningSetter, "The setter of computed value '" + this.name + "' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"), this.isRunningSetter = !0; try { this.setter.call(this.scope, e) } finally { this.isRunningSetter = !1 } } else Dt(!1, !1) }, e.prototype.trackAndCompute = function () { h() && v({ object: this.scope, type: "compute", name: this.name }); var e = this.value, t = this.dependenciesState === Ft.NOT_TRACKING, n = this.computeValue(!0), r = t || En(e) || En(n) || !this.equals(e, n); return r && (this.value = n), r }, e.prototype.computeValue = function (e) { var t; if (this.isComputing = !0, tn.computationDepth++ , e) t = Dn(this, this.derivation, this.scope); else if (!0 === tn.disableErrorBoundaries) t = this.derivation.call(this.scope); else try { t = this.derivation.call(this.scope) } catch (n) { t = new An(n) } return tn.computationDepth-- , this.isComputing = !1, t }, e.prototype.suspend = function () { Pn(this), this.value = void 0 }, e.prototype.observe = function (e, t) { var n = this, r = !0, o = void 0; return W(function () { var i = n.get(); if (!r || t) { var a = Cn(); e({ type: "update", object: n, newValue: i, oldValue: o }), In(a) } r = !1, o = i }) }, e.prototype.warnAboutUntrackedRead = function () { }, e.prototype.toJSON = function () { return this.get() }, e.prototype.toString = function () { return this.name + "[" + this.derivation.toString() + "]" }, e.prototype.valueOf = function () { return Xt(this.get()) }, e }(); Y.prototype[Yt()] = Y.prototype.valueOf; var X = Kt("ComputedValue", Y); function F(e) { return void 0 !== e.interceptors && e.interceptors.length > 0 } function Q(e, t) { var n = e.interceptors || (e.interceptors = []); return n.push(t), Rt(function () { var e = n.indexOf(t); -1 !== e && n.splice(e, 1) }) } function Z(e, t) { var n = Cn(); try { var r = e.interceptors; if (r) for (var o = 0, i = r.length; o < i && (Dt(!(t = r[o](t)) || t.type, "Intercept handlers should return nothing or a change object"), t); o++); return t } finally { In(n) } } function ee(e) { return void 0 !== e.changeListeners && e.changeListeners.length > 0 } function te(e, t) { var n = e.changeListeners || (e.changeListeners = []); return n.push(t), Rt(function () { var e = n.indexOf(t); -1 !== e && n.splice(e, 1) }) } function ne(e, t) { var n = Cn(), r = e.changeListeners; if (r) { for (var o = 0, i = (r = r.slice()).length; o < i; o++)r[o](t); In(n) } } var re = {}; ct(); var oe = function (e) { function t(t, n, r, o) { void 0 === r && (r = "ObservableValue@" + Tt()), void 0 === o && (o = !0); var i = e.call(this, r) || this; return i.enhancer = n, i.hasUnreportedChange = !1, i.value = n(t, void 0, r), o && h() && v({ type: "create", name: i.name, newValue: "" + i.value }), i } return r(t, e), t.prototype.dehanceValue = function (e) { return void 0 !== this.dehancer ? this.dehancer(e) : e }, t.prototype.set = function (e) { var t = this.value; if ((e = this.prepareNewValue(e)) !== re) { var n = h(); n && d({ type: "update", name: this.name, newValue: e, oldValue: t }), this.setNewValue(e), n && b() } }, t.prototype.prepareNewValue = function (e) { if (kn(this), F(this)) { var t = Z(this, { object: this, type: "update", newValue: e }); if (!t) return re; e = t.newValue } return e = this.enhancer(e, this.value, this.name), this.value !== e ? e : re }, t.prototype.setNewValue = function (e) { var t = this.value; this.value = e, this.reportChanged(), ee(this) && ne(this, { type: "update", object: this, newValue: e, oldValue: t }) }, t.prototype.get = function () { return this.reportObserved(), this.dehanceValue(this.value) }, t.prototype.intercept = function (e) { return Q(this, e) }, t.prototype.observe = function (e, t) { return t && e({ object: this, type: "update", newValue: this.value, oldValue: void 0 }), te(this, e) }, t.prototype.toJSON = function () { return this.get() }, t.prototype.toString = function () { return this.name + "[" + this.value + "]" }, t.prototype.valueOf = function () { return Xt(this.get()) }, t }(et); oe.prototype[Yt()] = oe.prototype.valueOf; var ie = Kt("ObservableValue", oe); exports.isBoxedObservable = ie; var ae = function () { function e(e, t, n) { this.target = e, this.name = t, this.defaultEnhancer = n, this.values = {} } return e.prototype.read = function (e, t) { if (this.target === e || (this.illegalAccess(e, t), this.values[t])) return this.values[t].get() }, e.prototype.write = function (e, t, n) { var r = this.target; r !== e && this.illegalAccess(e, t); var i = this.values[t]; if (i instanceof Y) i.set(n); else { if (F(this)) { if (!(u = Z(this, { type: "update", object: r, name: t, newValue: n }))) return; n = u.newValue } if ((n = i.prepareNewValue(n)) !== re) { var a = ee(this), s = h(), u = a || s ? { type: "update", object: r, oldValue: i.value, name: t, newValue: n } : null; s && d(o({}, u, { name: this.name, key: t })), i.setNewValue(n), a && ne(this, u), s && b() } } }, e.prototype.remove = function (e) { if (this.values[e]) { var t = this.target; if (F(this)) if (!(a = Z(this, { object: t, name: e, type: "remove" }))) return; try { bn(); var n = ee(this), r = h(), i = this.values[e].get(); this.keys && this.keys.remove(e), delete this.values[e], delete this.target[e]; var a = n || r ? { type: "remove", object: t, oldValue: i, name: e } : null; r && d(o({}, a, { name: this.name, key: e })), n && ne(this, a), r && b() } finally { mn() } } }, e.prototype.illegalAccess = function (e, t) { console.warn("Property '" + t + "' of '" + e + "' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner") }, e.prototype.observe = function (e, t) { return te(this, e) }, e.prototype.intercept = function (e) { return Q(this, e) }, e.prototype.getKeys = function () { var e = this; return void 0 === this.keys && (this.keys = new bt(Object.keys(this.values).filter(function (t) { return e.values[t] instanceof oe }), ze, "keys(" + this.name + ")", !0)), this.keys.slice() }, e }(); function se(e, t, n) { void 0 === t && (t = ""), void 0 === n && (n = Ke); var r = e.$mobx; return r || (Bt(e) || (t = (e.constructor.name || "ObservableObject") + "@" + Tt()), t || (t = "ObservableObject@" + Tt()), Mt(e, "$mobx", r = new ae(e, t, n)), r) } function ue(e, t, n, r) { var o = se(e); if (Gt(e, t), F(o)) { var i = Z(o, { object: e, name: t, type: "add", newValue: n }); if (!i) return; n = i.newValue } n = (o.values[t] = new oe(n, r, o.name + "." + t, !1)).value, Object.defineProperty(e, t, fe(t)), o.keys && o.keys.push(t), de(o, e, t, n) } function ce(e, t, n) { var r = se(e); n.name = r.name + "." + t, n.context = e, r.values[t] = new Y(n), Object.defineProperty(e, t, ve(t)) } var le = {}, pe = {}; function fe(e) { return le[e] || (le[e] = { configurable: !0, enumerable: !0, get: function () { return this.$mobx.read(this, e) }, set: function (t) { this.$mobx.write(this, e, t) } }) } function he(e) { var t = e.$mobx; return t || (l(e), e.$mobx) } function ve(e) { return pe[e] || (pe[e] = { configurable: !0, enumerable: !1, get: function () { return he(this).read(this, e) }, set: function (t) { he(this).write(this, e, t) } }) } function de(e, t, n, r) { var i = ee(e), a = h(), s = i || a ? { type: "add", object: t, name: n, newValue: r } : null; a && d(o({}, s, { name: e.name, key: n })), i && ne(e, s), a && b() } var ye = Kt("ObservableObjectAdministration", ae); function be(e) { return !!Lt(e) && (l(e), ye(e.$mobx)) } function me(t) { var n = p(!0, function (e, n, r, o, i) { ue(e, n, r ? r.initializer ? r.initializer.call(e) : r.value : void 0, t) }), r = (void 0 !== e && e.env, n); return r.enhancer = t, r } function ge(e, t) { if (null == e) return !1; if (void 0 !== t) { if (be(e)) { var n = e.$mobx; return n.values && !!n.values[t] } return !1 } return be(e) || !!e.$mobx || tt(e) || zn(e) || X(e) } function xe(e) { return 1 !== arguments.length && kt(!1), ge(e) } function Oe(e, t) { return "string" != typeof t ? kt(!1) : ge(e, t) } function we(e, t) { if (null == e) return !1; if (void 0 !== t) { if (!1 === be(e)) return !1; if (!e.$mobx.values[t]) return !1; var n = rt(e, t); return X(n) } return X(e) } function _e(e) { return arguments.length > 1 ? kt(!1) : we(e) } function Se(e, t) { return "string" != typeof t ? kt(!1) : we(e, t) } var Ae = p(!1, function (e, t, n, r, i) { var a = n.get, s = n.set, u = i[0] || {}; ce(e, t, o({ get: a, set: s }, u)) }), Ee = Ae({ equals: K.structural }), je = function (e, t, n) { if ("string" == typeof t) return Ae.apply(null, arguments); if (null !== e && "object" == typeof e && 1 === arguments.length) return Ae.apply(null, arguments); var r = "object" == typeof t ? t : {}; return r.get = e, r.set = "function" == typeof t ? t : r.set, r.name = r.name || e.name || "", new Y(r) }; function Te(e, t, n) { return Pt("'extendShallowObservable' is deprecated, use 'extendObservable(target, props, { deep: false })' instead"), ke(e, t, n, Ve) } function ke(e, t, n, r) { var o = (r = Re(r)).defaultDecorator || (!1 === r.deep ? Be : Ie); se(e, r.name, o.enhancer), bn(); try { for (var i in t) { var a = Object.getOwnPropertyDescriptor(t, i); 0; var s = n && i in n ? n[i] : a.get ? Ae : o; 0; var u = s(e, i, a, !0); u && Object.defineProperty(e, i, u) } } finally { mn() } return e } exports.computed = je, je.struct = Ee; var De = { deep: !0, name: void 0, defaultDecorator: void 0 }, Ve = { deep: !1, name: void 0, defaultDecorator: void 0 }; function Pe(e) { /^(deep|name|defaultDecorator)$/.test(e) || kt("invalid option for (extend)observable: " + e) } function Re(e) { return null == e ? De : "string" == typeof e ? { name: e, deep: !0 } : e } function Ce(e) { return e.defaultDecorator ? e.defaultDecorator.enhancer : !1 === e.deep ? ze : Ke } Object.freeze(De), Object.freeze(Ve); var Ie = me(Ke), Le = me(We), Be = me(ze), Ne = me(He); function $e(e, t, n) { if ("string" == typeof arguments[1]) return Ie.apply(null, arguments); if (xe(e)) return e; var r = Bt(e) ? Ue.object(e, t, n) : Array.isArray(e) ? Ue.array(e, t) : Ht(e) ? Ue.map(e, t) : e; if (r !== e) return r; kt(!1) } var Me = { box: function (e, t) { arguments.length > 2 && Ge("box"); var n = Re(t); return new oe(e, Ce(n), n.name) }, shallowBox: function (e, t) { return arguments.length > 2 && Ge("shallowBox"), Pt("observable.shallowBox", "observable.box(value, { deep: false })"), Ue.box(e, { name: t, deep: !1 }) }, array: function (e, t) { arguments.length > 2 && Ge("array"); var n = Re(t); return new bt(e, Ce(n), n.name) }, shallowArray: function (e, t) { return arguments.length > 2 && Ge("shallowArray"), Pt("observable.shallowArray", "observable.array(values, { deep: false })"), Ue.array(e, { name: t, deep: !1 }) }, map: function (e, t) { arguments.length > 2 && Ge("map"); var n = Re(t); return new Ze(e, Ce(n), n.name) }, shallowMap: function (e, t) { return arguments.length > 2 && Ge("shallowMap"), Pt("observable.shallowMap", "observable.map(values, { deep: false })"), Ue.map(e, { name: t, deep: !1 }) }, object: function (e, t, n) { return "string" == typeof arguments[1] && Ge("object"), ke({}, e, t, Re(n)) }, shallowObject: function (e, t) { return "string" == typeof arguments[1] && Ge("shallowObject"), Pt("observable.shallowObject", "observable.object(values, {}, { deep: false })"), Ue.object(e, {}, { name: t, deep: !1 }) }, ref: Be, shallow: Le, deep: Ie, struct: Ne }, Ue = $e; function Ge(e) { kt("Expected one or two arguments to observable." + e + ". Did you accidentally try to use observable." + e + " as decorator?") } function Ke(e, t, n) { return xe(e) ? e : Array.isArray(e) ? Ue.array(e, { name: n }) : Bt(e) ? Ue.object(e, void 0, { name: n }) : Ht(e) ? Ue.map(e, { name: n }) : e } function We(e, t, n) { return null == e ? e : be(e) || _t(e) || nt(e) ? e : Array.isArray(e) ? Ue.array(e, { name: n, deep: !1 }) : Bt(e) ? Ue.object(e, void 0, { name: n, deep: !1 }) : Ht(e) ? Ue.map(e, { name: n, deep: !1 }) : kt(!1) } function ze(e) { return e } function He(e, t, n) { return I(e, t) ? t : e } function Je() { return "function" == typeof Symbol && Symbol.iterator || "@@iterator" } function qe(e, t) { Mt(e, Je(), t) } function Ye(e) { return e[Je()] = Xe, e } function Xe() { return this } function Fe(e, t) { void 0 === t && (t = void 0), bn(); try { return e.apply(t) } finally { mn() } } exports.observable = Ue, Object.keys(Me).forEach(function (e) { return Ue[e] = Me[e] }); var Qe = {}, Ze = function () { function e(e, t, n) { if (void 0 === t && (t = Ke), void 0 === n && (n = "ObservableMap@" + Tt()), this.enhancer = t, this.name = n, this.$mobx = Qe, this._keys = new bt(void 0, ze, this.name + ".keys()", !0), "function" != typeof Map) throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js"); this._data = new Map, this._hasMap = new Map, this.merge(e) } return e.prototype._has = function (e) { return this._data.has(e) }, e.prototype.has = function (e) { return this._hasMap.has(e) ? this._hasMap.get(e).get() : this._updateHasMapEntry(e, !1).get() }, e.prototype.set = function (e, t) { var n = this._has(e); if (F(this)) { var r = Z(this, { type: n ? "update" : "add", object: this, newValue: t, name: e }); if (!r) return this; t = r.newValue } return n ? this._updateValue(e, t) : this._addValue(e, t), this }, e.prototype.delete = function (e) { var t = this; if (F(this) && !(i = Z(this, { type: "delete", object: this, name: e }))) return !1; if (this._has(e)) { var n = h(), r = ee(this), i = r || n ? { type: "delete", object: this, oldValue: this._data.get(e).value, name: e } : null; return n && d(o({}, i, { name: this.name, key: e })), Fe(function () { t._keys.remove(e), t._updateHasMapEntry(e, !1), t._data.get(e).setNewValue(void 0), t._data.delete(e) }), r && ne(this, i), n && b(), !0 } return !1 }, e.prototype._updateHasMapEntry = function (e, t) { var n = this._hasMap.get(e); return n ? n.setNewValue(t) : (n = new oe(t, ze, this.name + "." + e + "?", !1), this._hasMap.set(e, n)), n }, e.prototype._updateValue = function (e, t) { var n = this._data.get(e); if ((t = n.prepareNewValue(t)) !== re) { var r = h(), i = ee(this), a = i || r ? { type: "update", object: this, oldValue: n.value, name: e, newValue: t } : null; r && d(o({}, a, { name: this.name, key: e })), n.setNewValue(t), i && ne(this, a), r && b() } }, e.prototype._addValue = function (e, t) { var n = this; Fe(function () { var r = new oe(t, n.enhancer, n.name + "." + e, !1); n._data.set(e, r), t = r.value, n._updateHasMapEntry(e, !0), n._keys.push(e) }); var r = h(), i = ee(this), a = i || r ? { type: "add", object: this, name: e, newValue: t } : null; r && d(o({}, a, { name: this.name, key: e })), i && ne(this, a), r && b() }, e.prototype.get = function (e) { return this.has(e) ? this.dehanceValue(this._data.get(e).get()) : this.dehanceValue(void 0) }, e.prototype.dehanceValue = function (e) { return void 0 !== this.dehancer ? this.dehancer(e) : e }, e.prototype.keys = function () { return this._keys[Je()]() }, e.prototype.values = function () { var e = this, t = 0; return Ye({ next: function () { return t < e._keys.length ? { value: e.get(e._keys[t++]), done: !1 } : { value: void 0, done: !0 } } }) }, e.prototype.entries = function () { var e = this, t = 0; return Ye({ next: function () { if (t < e._keys.length) { var n = e._keys[t++]; return { value: [n, e.get(n)], done: !1 } } return { done: !0 } } }) }, e.prototype.forEach = function (e, t) { var n = this; this._keys.forEach(function (r) { return e.call(t, n.get(r), r, n) }) }, e.prototype.merge = function (e) { var t = this; return nt(e) && (e = e.toJS()), Fe(function () { Bt(e) ? Object.keys(e).forEach(function (n) { return t.set(n, e[n]) }) : Array.isArray(e) ? e.forEach(function (e) { var n = i(e, 2), r = n[0], o = n[1]; return t.set(r, o) }) : Ht(e) ? e.forEach(function (e, n) { return t.set(n, e) }) : null != e && kt("Cannot initialize map from " + e) }), this }, e.prototype.clear = function () { var e = this; Fe(function () { Rn(function () { e._keys.slice().forEach(function (t) { return e.delete(t) }) }) }) }, e.prototype.replace = function (e) { var t = this; return Fe(function () { var n = Jt(e); t._keys.filter(function (e) { return -1 === n.indexOf(e) }).forEach(function (e) { return t.delete(e) }), t.merge(e) }), this }, Object.defineProperty(e.prototype, "size", { get: function () { return this._keys.length }, enumerable: !0, configurable: !0 }), e.prototype.toPOJO = function () { var e = this, t = {}; return this._keys.forEach(function (n) { return t["" + n] = e.get(n) }), t }, e.prototype.toJS = function () { var e = this, t = new Map; return this._keys.forEach(function (n) { return t.set(n, e.get(n)) }), t }, e.prototype.toJSON = function () { return this.toPOJO() }, e.prototype.toString = function () { var e = this; return this.name + "[{ " + this._keys.map(function (t) { return t + ": " + e.get(t) }).join(", ") + " }]" }, e.prototype.observe = function (e, t) { return te(this, e) }, e.prototype.intercept = function (e) { return Q(this, e) }, e }(); exports.ObservableMap = Ze, qe(Ze.prototype, function () { return this.entries() }), Mt(Ze.prototype, "undefined" != typeof Symbol ? Symbol.toStringTag : "@@toStringTag", "Map"); var et, tt, nt = Kt("ObservableMap", Ze); function rt(e, t) { if ("object" == typeof e && null !== e) { if (_t(e)) return void 0 !== t && kt(!1), e.$mobx.atom; if (nt(e)) { var n = e; return void 0 === t ? rt(n._keys) : ((r = n._data.get(t) || n._hasMap.get(t)) || kt(!1), r) } var r; if (l(e), t && !e.$mobx && e[t], be(e)) return t ? ((r = e.$mobx.values[t]) || kt(!1), r) : kt(!1); if (tt(e) || X(e) || zn(e)) return e } else if ("function" == typeof e && zn(e.$mobx)) return e.$mobx; return kt(!1) } function ot(e, t) { return e || kt("Expecting some object"), void 0 !== t ? ot(rt(e, t)) : tt(e) || X(e) || zn(e) ? e : nt(e) ? e : (l(e), e.$mobx ? e.$mobx : void kt(!1)) } function it(e, t) { return (void 0 !== t ? rt(e, t) : be(e) || nt(e) ? ot(e) : rt(e)).name } function at(e, t, n) { return ut("onBecomeObserved", e, t, n) } function st(e, t, n) { return ut("onBecomeUnobserved", e, t, n) } function ut(e, t, n, r) { var o = "string" == typeof n ? rt(t, n) : rt(t), i = "string" == typeof n ? r : n, a = o[e]; return "function" != typeof a ? kt(!1) : (o[e] = function () { a.call(this), i.call(this) }, function () { o[e] = a }) } function ct() { et || (et = function () { function e(e) { void 0 === e && (e = "Atom@" + Tt()), this.name = e, this.isPendingUnobservation = !1, this.isBeingObserved = !1, this.observers = [], this.observersIndexes = {}, this.diffValue = 0, this.lastAccessedBy = 0, this.lowestObserverState = Ft.NOT_TRACKING } return e.prototype.onBecomeUnobserved = function () { }, e.prototype.onBecomeObserved = function () { }, e.prototype.reportObserved = function () { return gn(this) }, e.prototype.reportChanged = function () { bn(), xn(this), mn() }, e.prototype.toString = function () { return this.name }, e }(), tt = Kt("Atom", et)) } function lt(e, t, n) { void 0 === t && (t = Ct), void 0 === n && (n = Ct); var r = new et(e); return at(r, t), st(r, n), r } exports.isObservableMap = nt; var pt = 1e4, ft = function () { var e = !1, t = {}; return Object.defineProperty(t, "0", { set: function () { e = !0 } }), Object.create(t)[0] = 1, !1 === e }(), ht = 0, vt = function () { return function () { } }(); function dt(e, t) { void 0 !== Object.setPrototypeOf ? Object.setPrototypeOf(e.prototype, t) : void 0 !== e.prototype.__proto__ ? e.prototype.__proto__ = t : e.prototype = t } dt(vt, Array.prototype), Object.isFrozen(Array) && ["constructor", "push", "shift", "concat", "pop", "unshift", "replace", "find", "findIndex", "splice", "reverse", "sort"].forEach(function (e) { Object.defineProperty(vt.prototype, e, { configurable: !0, writable: !0, value: Array.prototype[e] }) }); var yt = function () { function e(e, t, n, r) { this.array = n, this.owned = r, this.values = [], this.lastKnownLength = 0, this.atom = new et(e || "ObservableArray@" + Tt()), this.enhancer = function (n, r) { return t(n, r, e + "[..]") } } return e.prototype.dehanceValue = function (e) { return void 0 !== this.dehancer ? this.dehancer(e) : e }, e.prototype.dehanceValues = function (e) { return void 0 !== this.dehancer && this.values.length > 0 ? e.map(this.dehancer) : e }, e.prototype.intercept = function (e) { return Q(this, e) }, e.prototype.observe = function (e, t) { return void 0 === t && (t = !1), t && e({ object: this.array, type: "splice", index: 0, added: this.values.slice(), addedCount: this.values.length, removed: [], removedCount: 0 }), te(this, e) }, e.prototype.getArrayLength = function () { return this.atom.reportObserved(), this.values.length }, e.prototype.setArrayLength = function (e) { if ("number" != typeof e || e < 0) throw new Error("[mobx.array] Out of range: " + e); var t = this.values.length; if (e !== t) if (e > t) { for (var n = new Array(e - t), r = 0; r < e - t; r++)n[r] = void 0; this.spliceWithArray(t, 0, n) } else this.spliceWithArray(e, t - e) }, e.prototype.updateArrayLength = function (e, t) { if (e !== this.lastKnownLength) throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed. Did you use peek() to change it?"); this.lastKnownLength += t, t > 0 && e + t + 1 > ht && Ot(e + t + 1) }, e.prototype.spliceWithArray = function (e, t, n) { var r = this; kn(this.atom); var o = this.values.length; if (void 0 === e ? e = 0 : e > o ? e = o : e < 0 && (e = Math.max(0, o + e)), t = 1 === arguments.length ? o - e : null == t ? 0 : Math.max(0, Math.min(t, o - e)), void 0 === n && (n = At), F(this)) { var i = Z(this, { object: this.array, type: "splice", index: e, removedCount: t, added: n }); if (!i) return At; t = i.removedCount, n = i.added } var a = (n = 0 === n.length ? n : n.map(function (e) { return r.enhancer(e, void 0) })).length - t; this.updateArrayLength(o, a); var s = this.spliceItemsIntoValues(e, t, n); return 0 === t && 0 === n.length || this.notifyArraySplice(e, n, s), this.dehanceValues(s) }, e.prototype.spliceItemsIntoValues = function (e, t, n) { if (n.length < pt) return (r = this.values).splice.apply(r, a([e, t], n)); var r, o = this.values.slice(e, e + t); return this.values = this.values.slice(0, e).concat(n, this.values.slice(e + t)), o }, e.prototype.notifyArrayChildUpdate = function (e, t, n) { var r = !this.owned && h(), i = ee(this), a = i || r ? { object: this.array, type: "update", index: e, newValue: t, oldValue: n } : null; r && d(o({}, a, { name: this.atom.name })), this.atom.reportChanged(), i && ne(this, a), r && b() }, e.prototype.notifyArraySplice = function (e, t, n) { var r = !this.owned && h(), i = ee(this), a = i || r ? { object: this.array, type: "splice", index: e, removed: n, added: t, removedCount: n.length, addedCount: t.length } : null; r && d(o({}, a, { name: this.atom.name })), this.atom.reportChanged(), i && ne(this, a), r && b() }, e }(), bt = function (e) { function t(t, n, r, o) { void 0 === r && (r = "ObservableArray@" + Tt()), void 0 === o && (o = !1); var i = e.call(this) || this, a = new yt(r, n, i, o); return Mt(i, "$mobx", a), t && t.length && i.spliceWithArray(0, 0, t), ft && Object.defineProperty(a.array, "0", mt), i } return r(t, e), t.prototype.intercept = function (e) { return this.$mobx.intercept(e) }, t.prototype.observe = function (e, t) { return void 0 === t && (t = !1), this.$mobx.observe(e, t) }, t.prototype.clear = function () { return this.splice(0) }, t.prototype.concat = function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; return this.$mobx.atom.reportObserved(), Array.prototype.concat.apply(this.peek(), e.map(function (e) { return _t(e) ? e.peek() : e })) }, t.prototype.replace = function (e) { return this.$mobx.spliceWithArray(0, this.$mobx.values.length, e) }, t.prototype.toJS = function () { return this.slice() }, t.prototype.toJSON = function () { return this.toJS() }, t.prototype.peek = function () { return this.$mobx.atom.reportObserved(), this.$mobx.dehanceValues(this.$mobx.values) }, t.prototype.find = function (e, t, n) { void 0 === n && (n = 0), 3 === arguments.length && Pt("The array.find fromIndex argument to find will not be supported anymore in the next major"); var r = this.findIndex.apply(this, arguments); return -1 === r ? void 0 : this.get(r) }, t.prototype.findIndex = function (e, t, n) { void 0 === n && (n = 0), 3 === arguments.length && Pt("The array.findIndex fromIndex argument to find will not be supported anymore in the next major"); for (var r = this.peek(), o = r.length, i = n; i < o; i++)if (e.call(t, r[i], i, this)) return i; return -1 }, t.prototype.splice = function (e, t) { for (var n = [], r = 2; r < arguments.length; r++)n[r - 2] = arguments[r]; switch (arguments.length) { case 0: return []; case 1: return this.$mobx.spliceWithArray(e); case 2: return this.$mobx.spliceWithArray(e, t) }return this.$mobx.spliceWithArray(e, t, n) }, t.prototype.spliceWithArray = function (e, t, n) { return this.$mobx.spliceWithArray(e, t, n) }, t.prototype.push = function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; var n = this.$mobx; return n.spliceWithArray(n.values.length, 0, e), n.values.length }, t.prototype.pop = function () { return this.splice(Math.max(this.$mobx.values.length - 1, 0), 1)[0] }, t.prototype.shift = function () { return this.splice(0, 1)[0] }, t.prototype.unshift = function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; var n = this.$mobx; return n.spliceWithArray(0, 0, e), n.values.length }, t.prototype.reverse = function () { var e = this.slice(); return e.reverse.apply(e, arguments) }, t.prototype.sort = function (e) { var t = this.slice(); return t.sort.apply(t, arguments) }, t.prototype.remove = function (e) { var t = this.$mobx.dehanceValues(this.$mobx.values).indexOf(e); return t > -1 && (this.splice(t, 1), !0) }, t.prototype.move = function (e, t) { function n(e) { if (e < 0) throw new Error("[mobx.array] Index out of bounds: " + e + " is negative"); var t = this.$mobx.values.length; if (e >= t) throw new Error("[mobx.array] Index out of bounds: " + e + " is not smaller than " + t) } if (Pt("observableArray.move is deprecated, use .slice() & .replace() instead"), n.call(this, e), n.call(this, t), e !== t) { var r, o = this.$mobx.values; r = e < t ? a(o.slice(0, e), o.slice(e + 1, t + 1), [o[e]], o.slice(t + 1)) : a(o.slice(0, t), [o[e]], o.slice(t, e), o.slice(e + 1)), this.replace(r) } }, t.prototype.get = function (e) { var t = this.$mobx; if (t) { if (e < t.values.length) return t.atom.reportObserved(), t.dehanceValue(t.values[e]); console.warn("[mobx.array] Attempt to read an array index (" + e + ") that is out of bounds (" + t.values.length + "). Please check length first. Out of bound indices will not be tracked by MobX") } }, t.prototype.set = function (e, t) { var n = this.$mobx, r = n.values; if (e < r.length) { kn(n.atom); var o = r[e]; if (F(n)) { var i = Z(n, { type: "update", object: this, index: e, newValue: t }); if (!i) return; t = i.newValue } (t = n.enhancer(t, o)) !== o && (r[e] = t, n.notifyArrayChildUpdate(e, t, o)) } else { if (e !== r.length) throw new Error("[mobx.array] Index out of bounds, " + e + " is larger than " + r.length); n.spliceWithArray(e, 0, [t]) } }, t }(vt); qe(bt.prototype, function () { this.$mobx.atom.reportObserved(); var e = this, t = 0; return Ye({ next: function () { return t < e.length ? { value: e[t++], done: !1 } : { done: !0, value: void 0 } } }) }), Object.defineProperty(bt.prototype, "length", { enumerable: !1, configurable: !0, get: function () { return this.$mobx.getArrayLength() }, set: function (e) { this.$mobx.setArrayLength(e) } }), "undefined" != typeof Symbol && Symbol.toStringTag && $t(bt.prototype, "undefined" != typeof Symbol ? Symbol.toStringTag : "@@toStringTag", "Array"), ["every", "filter", "forEach", "indexOf", "join", "lastIndexOf", "map", "reduce", "reduceRight", "slice", "some", "toString", "toLocaleString"].forEach(function (e) { var t = Array.prototype[e]; Dt("function" == typeof t, "Base function not defined on Array prototype: '" + e + "'"), $t(bt.prototype, e, function () { return t.apply(this.peek(), arguments) }) }), Nt(bt.prototype, ["constructor", "intercept", "observe", "clear", "concat", "get", "replace", "toJS", "toJSON", "peek", "find", "findIndex", "splice", "spliceWithArray", "push", "pop", "set", "shift", "unshift", "reverse", "sort", "remove", "move", "toString", "toLocaleString"]); var mt = gt(0); function gt(e) { return { enumerable: !1, configurable: !1, get: function () { return this.get(e) }, set: function (t) { this.set(e, t) } } } function xt(e) { Object.defineProperty(bt.prototype, "" + e, gt(e)) } function Ot(e) { for (var t = ht; t < e; t++)xt(t); ht = e } Ot(1e3); var wt = Kt("ObservableArrayAdministration", yt); function _t(e) { return Lt(e) && wt(e.$mobx) } var St = "An invariant failed, however the error is obfuscated because this is an production build.", At = []; Object.freeze(At); var Et = {}; function jt() { return "undefined" != typeof window ? window : t } function Tt() { return ++tn.mobxGuid } function kt(e) { throw Dt(!1, e), "X" } function Dt(e, t) { if (!e) throw new Error("[mobx] " + (t || St)) } Object.freeze(Et); var Vt = []; function Pt(e, t) { return !1 } function Rt(e) { var t = !1; return function () { if (!t) return t = !0, e.apply(this, arguments) } } var Ct = function () { }; function It(e) { var t = []; return e.forEach(function (e) { -1 === t.indexOf(e) && t.push(e) }), t } function Lt(e) { return null !== e && "object" == typeof e } function Bt(e) { if (null === e || "object" != typeof e) return !1; var t = Object.getPrototypeOf(e); return t === Object.prototype || null === t } function Nt(e, t) { for (var n = 0; n < t.length; n++)$t(e, t[n], e[t[n]]) } function $t(e, t, n) { Object.defineProperty(e, t, { enumerable: !1, writable: !0, configurable: !0, value: n }) } function Mt(e, t, n) { Object.defineProperty(e, t, { enumerable: !1, writable: !1, configurable: !0, value: n }) } function Ut(e, t) { var n = Object.getOwnPropertyDescriptor(e, t); return !n || !1 !== n.configurable && !1 !== n.writable } function Gt(e, t) { 0 } function Kt(e, t) { var n = "isMobX" + e; return t.prototype[n] = !0, function (e) { return Lt(e) && !0 === e[n] } } function Wt(e, t) { return "number" == typeof e && "number" == typeof t && isNaN(e) && isNaN(t) } function zt(e) { return Array.isArray(e) || _t(e) } function Ht(e) { return void 0 !== jt().Map && e instanceof jt().Map } function Jt(e) { return Bt(e) ? Object.keys(e) : Array.isArray(e) ? e.map(function (e) { return i(e, 1)[0] }) : Ht(e) || nt(e) ? qt(e.keys()) : kt("Cannot get keys from '" + e + "'") } function qt(e) { for (var t = []; ;) { var n = e.next(); if (n.done) break; t.push(n.value) } return t } function Yt() { return "function" == typeof Symbol && Symbol.toPrimitive || "@@toPrimitive" } function Xt(e) { return null === e ? null : "object" == typeof e ? "" + e : e } var Ft, Qt, Zt = ["mobxGuid", "spyListeners", "enforceActions", "computedRequiresReaction", "disableErrorBoundaries", "runId"], en = function () { return function () { this.version = 5, this.trackingDerivation = null, this.computationDepth = 0, this.runId = 0, this.mobxGuid = 0, this.inBatch = 0, this.pendingUnobservations = [], this.pendingReactions = [], this.isRunningReactions = !1, this.allowStateChanges = !0, this.enforceActions = !1, this.spyListeners = [], this.globalReactionErrorHandlers = [], this.computedRequiresReaction = !1, this.disableErrorBoundaries = !1 } }(), tn = new en, nn = !1, rn = jt(); function on() { nn = !0, jt().__mobxInstanceCount-- } function an() { return tn } function sn() { var e = new en; for (var t in e) -1 === Zt.indexOf(t) && (tn[t] = e[t]); tn.allowStateChanges = !tn.enforceActions } function un(e, t) { return cn(rt(e, t)) } function cn(e) { var t = { name: e.name }; return e.observing && e.observing.length > 0 && (t.dependencies = It(e.observing).map(cn)), t } function ln(e, t) { return pn(rt(e, t)) } function pn(e) { var t = { name: e.name }; return fn(e) && (t.observers = hn(e).map(pn)), t } function fn(e) { return e.observers && e.observers.length > 0 } function hn(e) { return e.observers } function vn(e, t) { var n = e.observers.length; n && (e.observersIndexes[t.__mapid] = n), e.observers[n] = t, e.lowestObserverState > t.dependenciesState && (e.lowestObserverState = t.dependenciesState) } function dn(e, t) { if (1 === e.observers.length) e.observers.length = 0, yn(e); else { var n = e.observers, r = e.observersIndexes, o = n.pop(); if (o !== t) { var i = r[t.__mapid] || 0; i ? r[o.__mapid] = i : delete r[o.__mapid], n[i] = o } delete r[t.__mapid] } } function yn(e) { !1 === e.isPendingUnobservation && (e.isPendingUnobservation = !0, tn.pendingUnobservations.push(e)) } function bn() { tn.inBatch++ } function mn() { if (0 == --tn.inBatch) { Kn(); for (var e = tn.pendingUnobservations, t = 0; t < e.length; t++) { var n = e[t]; n.isPendingUnobservation = !1, 0 === n.observers.length && (n.isBeingObserved && (n.isBeingObserved = !1, n.onBecomeUnobserved()), n instanceof Y && n.suspend()) } tn.pendingUnobservations = [] } } function gn(e) { var t = tn.trackingDerivation; return null !== t ? (t.runId !== e.lastAccessedBy && (e.lastAccessedBy = t.runId, t.newObserving[t.unboundDepsCount++] = e, e.isBeingObserved || (e.isBeingObserved = !0, e.onBecomeObserved())), !0) : (0 === e.observers.length && tn.inBatch > 0 && yn(e), !1) } function xn(e) { if (e.lowestObserverState !== Ft.STALE) { e.lowestObserverState = Ft.STALE; for (var t = e.observers, n = t.length; n--;) { var r = t[n]; r.dependenciesState === Ft.UP_TO_DATE && (r.isTracing !== Qt.NONE && _n(r, e), r.onBecomeStale()), r.dependenciesState = Ft.STALE } } } function On(e) { if (e.lowestObserverState !== Ft.STALE) { e.lowestObserverState = Ft.STALE; for (var t = e.observers, n = t.length; n--;) { var r = t[n]; r.dependenciesState === Ft.POSSIBLY_STALE ? r.dependenciesState = Ft.STALE : r.dependenciesState === Ft.UP_TO_DATE && (e.lowestObserverState = Ft.UP_TO_DATE) } } } function wn(e) { if (e.lowestObserverState === Ft.UP_TO_DATE) { e.lowestObserverState = Ft.POSSIBLY_STALE; for (var t = e.observers, n = t.length; n--;) { var r = t[n]; r.dependenciesState === Ft.UP_TO_DATE && (r.dependenciesState = Ft.POSSIBLY_STALE, r.isTracing !== Qt.NONE && _n(r, e), r.onBecomeStale()) } } } function _n(e, t) { if (console.log("[mobx.trace] '" + e.name + "' is invalidated due to a change in: '" + t.name + "'"), e.isTracing === Qt.BREAK) { var n = []; Sn(un(e), n, 1), new Function("debugger;\n/*\nTracing '" + e.name + "'\n\nYou are entering this break point because derivation '" + e.name + "' is being traced and '" + t.name + "' is now forcing it to update.\nJust follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update\nThe stackframe you are looking for is at least ~6-8 stack-frames up.\n\n" + (e instanceof Y ? e.derivation.toString() : "") + "\n\nThe dependencies for this derivation are:\n\n" + n.join("\n") + "\n*/\n    ")() } } function Sn(e, t, n) { t.length >= 1e3 ? t.push("(and many more)") : (t.push("" + new Array(n).join("\t") + e.name), e.dependencies && e.dependencies.forEach(function (e) { return Sn(e, t, n + 1) })) } rn.__mobxInstanceCount ? (rn.__mobxInstanceCount++ , setTimeout(function () { nn || kt(!1) }, 1)) : rn.__mobxInstanceCount = 1, exports.IDerivationState = Ft, function (e) { e[e.NOT_TRACKING = -1] = "NOT_TRACKING", e[e.UP_TO_DATE = 0] = "UP_TO_DATE", e[e.POSSIBLY_STALE = 1] = "POSSIBLY_STALE", e[e.STALE = 2] = "STALE" }(Ft || (exports.IDerivationState = Ft = {})), function (e) { e[e.NONE = 0] = "NONE", e[e.LOG = 1] = "LOG", e[e.BREAK = 2] = "BREAK" }(Qt || (Qt = {})); var An = function () { return function (e) { this.cause = e } }(); function En(e) { return e instanceof An } function jn(e) { switch (e.dependenciesState) { case Ft.UP_TO_DATE: return !1; case Ft.NOT_TRACKING: case Ft.STALE: return !0; case Ft.POSSIBLY_STALE: for (var t = Cn(), n = e.observing, r = n.length, o = 0; o < r; o++) { var i = n[o]; if (X(i)) { if (tn.disableErrorBoundaries) i.get(); else try { i.get() } catch (a) { return In(t), !0 } if (e.dependenciesState === Ft.STALE) return In(t), !0 } } return Ln(e), In(t), !1 } } function Tn() { return null !== tn.trackingDerivation } function kn(e) { var t = e.observers.length > 0; tn.computationDepth > 0 && t && kt(!1), tn.allowStateChanges || !t && "strict" !== tn.enforceActions || kt(!1) } function Dn(e, t, n) { Ln(e), e.newObserving = new Array(e.observing.length + 100), e.unboundDepsCount = 0, e.runId = ++tn.runId; var r, o = tn.trackingDerivation; if (tn.trackingDerivation = e, !0 === tn.disableErrorBoundaries) r = t.call(n); else try { r = t.call(n) } catch (i) { r = new An(i) } return tn.trackingDerivation = o, Vn(e), r } function Vn(e) { for (var t = e.observing, n = e.observing = e.newObserving, r = Ft.UP_TO_DATE, o = 0, i = e.unboundDepsCount, a = 0; a < i; a++) { 0 === (s = n[a]).diffValue && (s.diffValue = 1, o !== a && (n[o] = s), o++), s.dependenciesState > r && (r = s.dependenciesState) } for (n.length = o, e.newObserving = null, i = t.length; i--;) { 0 === (s = t[i]).diffValue && dn(s, e), s.diffValue = 0 } for (; o--;) { var s; 1 === (s = n[o]).diffValue && (s.diffValue = 0, vn(s, e)) } r !== Ft.UP_TO_DATE && (e.dependenciesState = r, e.onBecomeStale()) } function Pn(e) { var t = e.observing; e.observing = []; for (var n = t.length; n--;)dn(t[n], e); e.dependenciesState = Ft.NOT_TRACKING } function Rn(e) { var t = Cn(), n = e(); return In(t), n } function Cn() { var e = tn.trackingDerivation; return tn.trackingDerivation = null, e } function In(e) { tn.trackingDerivation = e } function Ln(e) { if (e.dependenciesState !== Ft.UP_TO_DATE) { e.dependenciesState = Ft.UP_TO_DATE; for (var t = e.observing, n = t.length; n--;)t[n].lowestObserverState = Ft.UP_TO_DATE } } function Bn() { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; var n = !1; "boolean" == typeof e[e.length - 1] && (n = e.pop()); var r = Nn(e); if (!r) return kt(!1); r.isTracing === Qt.NONE && console.log("[mobx.trace] '" + r.name + "' tracing enabled"), r.isTracing = n ? Qt.BREAK : Qt.LOG } function Nn(e) { switch (e.length) { case 0: return tn.trackingDerivation; case 1: return rt(e[0]); case 2: return rt(e[0], e[1]) } } var $n = function () { function e(e, t, n) { void 0 === e && (e = "Reaction@" + Tt()), this.name = e, this.onInvalidate = t, this.errorHandler = n, this.observing = [], this.newObserving = [], this.dependenciesState = Ft.NOT_TRACKING, this.diffValue = 0, this.runId = 0, this.unboundDepsCount = 0, this.__mapid = "#" + Tt(), this.isDisposed = !1, this._isScheduled = !1, this._isTrackPending = !1, this._isRunning = !1, this.isTracing = Qt.NONE } return e.prototype.onBecomeStale = function () { this.schedule() }, e.prototype.schedule = function () { this._isScheduled || (this._isScheduled = !0, tn.pendingReactions.push(this), Kn()) }, e.prototype.isScheduled = function () { return this._isScheduled }, e.prototype.runReaction = function () { if (!this.isDisposed) { if (bn(), this._isScheduled = !1, jn(this)) { this._isTrackPending = !0; try { this.onInvalidate(), this._isTrackPending && h() && v({ name: this.name, type: "scheduled-reaction" }) } catch (e) { this.reportExceptionInDerivation(e) } } mn() } }, e.prototype.track = function (e) { bn(); var t, n = h(); n && (t = Date.now(), d({ name: this.name, type: "reaction" })), this._isRunning = !0; var r = Dn(this, e, void 0); this._isRunning = !1, this._isTrackPending = !1, this.isDisposed && Pn(this), En(r) && this.reportExceptionInDerivation(r.cause), n && b({ time: Date.now() - t }), mn() }, e.prototype.reportExceptionInDerivation = function (e) { var t = this; if (this.errorHandler) this.errorHandler(e, this); else { if (tn.disableErrorBoundaries) throw e; var n = "[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '" + this; console.error(n, e), h() && v({ type: "error", name: this.name, message: n, error: "" + e }), tn.globalReactionErrorHandlers.forEach(function (n) { return n(e, t) }) } }, e.prototype.dispose = function () { this.isDisposed || (this.isDisposed = !0, this._isRunning || (bn(), Pn(this), mn())) }, e.prototype.getDisposer = function () { var e = this.dispose.bind(this); return e.$mobx = this, e }, e.prototype.toString = function () { return "Reaction[" + this.name + "]" }, e.prototype.trace = function (e) { void 0 === e && (e = !1), Bn(this, e) }, e }(); function Mn(e) { return tn.globalReactionErrorHandlers.push(e), function () { var t = tn.globalReactionErrorHandlers.indexOf(e); t >= 0 && tn.globalReactionErrorHandlers.splice(t, 1) } } exports.Reaction = $n; var Un = 100, Gn = function (e) { return e() }; function Kn() { tn.inBatch > 0 || tn.isRunningReactions || Gn(Wn) } function Wn() { tn.isRunningReactions = !0; for (var e = tn.pendingReactions, t = 0; e.length > 0;) { ++t === Un && (console.error("Reaction doesn't converge to a stable state after " + Un + " iterations. Probably there is a cycle in the reactive function: " + e[0]), e.splice(0)); for (var n = e.splice(0), r = 0, o = n.length; r < o; r++)n[r].runReaction() } tn.isRunningReactions = !1 } var zn = Kt("Reaction", $n); function Hn(e) { var t = Gn; Gn = function (n) { return e(function () { return t(n) }) } } function Jn(e, t, n, r) { return "function" == typeof n ? Yn(e, t, n, r) : qn(e, t, n) } function qn(e, t, n) { return ot(e).observe(t, n) } function Yn(e, t, n, r) { return ot(e, t).observe(n, r) } function Xn(e, t, n) { return "function" == typeof n ? Qn(e, t, n) : Fn(e, t) } function Fn(e, t) { return ot(e).intercept(t) } function Qn(e, t, n) { return ot(e, t).intercept(n) } function Zn(e, t, n) { return 1 === arguments.length || t && "object" == typeof t ? tr(e, t) : er(e, t, n || {}) } function er(e, t, n) { var r; "number" == typeof n.timeout && (r = setTimeout(function () { if (!i.$mobx.isDisposed) { i(); var e = new Error("WHEN_TIMEOUT"); if (!n.onError) throw e; n.onError(e) } }, n.timeout)), n.name = n.name || "When@" + Tt(); var o = g(n.name + "-effect", t), i = W(function (t) { e() && (t.dispose(), r && clearTimeout(r), o()) }, n); return i } function tr(e, t) { var n; var r = new Promise(function (r, i) { var a = er(e, r, o({}, t, { onError: i })); n = function () { a(), i("WHEN_CANCELLED") } }); return r.cancel = n, r } function nr(e) { return be(e) ? e.$mobx.getKeys() : nt(e) ? e._keys.slice() : kt(!1) } function rr(e) { return be(e) ? nr(e).map(function (t) { return e[t] }) : nt(e) ? nr(e).map(function (t) { return e.get(t) }) : _t(e) ? e.slice() : kt(!1) } function or(e) { return be(e) ? nr(e).map(function (t) { return [t, e[t]] }) : nt(e) ? nr(e).map(function (t) { return [t, e.get(t)] }) : _t(e) ? e.map(function (e, t) { return [t, e] }) : kt(!1) } function ir(e, t, n) { if (2 !== arguments.length) if (be(e)) { var r = e.$mobx; r.values[t] ? r.write(e, t, n) : ue(e, t, n, r.defaultEnhancer) } else if (nt(e)) e.set(t, n); else { if (!_t(e)) return kt(!1); "number" != typeof t && (t = parseInt(t, 10)), Dt(t >= 0, "Not a valid index: '" + t + "'"), bn(), t >= e.length && (e.length = t + 1), e[t] = n, mn() } else { bn(); var o = t; try { for (var i in o) ir(e, i, o[i]) } finally { mn() } } } function ar(e, t) { if (be(e)) e.$mobx.remove(t); else if (nt(e)) e.delete(t); else { if (!_t(e)) return kt(!1); "number" != typeof t && (t = parseInt(t, 10)), Dt(t >= 0, "Not a valid index: '" + t + "'"), e.splice(t, 1) } } function sr(e, t) { if (be(e)) { var n = ot(e); return n.getKeys(), n.values[t] instanceof oe } return nt(e) ? e.has(t) : _t(e) ? t >= 0 && t < e.length : kt(!1) } function ur(e, t) { if (sr(e, t)) return be(e) ? e[t] : nt(e) ? e.get(t) : _t(e) ? e[t] : kt(!1) } function cr(e, t) { var n = "function" == typeof e ? e.prototype : e; for (var r in t) { var o = t[r], i = o(n, r, Object.getOwnPropertyDescriptor(n, r)); i && Object.defineProperty(n, r, i) } return e } function lr(e) { var t = e.enforceActions, n = e.computedRequiresReaction, r = e.disableErrorBoundaries, o = e.arrayBuffer, i = e.reactionScheduler; if (void 0 !== t) { if ("boolean" != typeof t && "strict" !== t) return fail("Invalid configuration for 'enforceActions': " + t); tn.enforceActions = t, tn.allowStateChanges = !0 !== t && "strict" !== t } void 0 !== n && (tn.computedRequiresReaction = !!n), !0 === e.isolateGlobalState && on(), void 0 !== r && (!0 === r && console.warn("WARNING: Debug feature only. MobX will NOT recover from errors if this is on."), tn.disableErrorBoundaries = !!r), "number" == typeof o && Ot(o), i && Hn(i) } var pr = 0; function fr(e) { 1 !== arguments.length && kt("Flow expects one 1 argument and cannot be used as decorator"); var t = e.name || "<unnamed flow>"; return function () { var n, r = arguments, o = ++pr, i = D(t + " - runid: " + o + " - init", e).apply(this, r), a = void 0, s = new Promise(function (e, r) { var s = 0; function u(e) { var n; a = void 0; try { n = D(t + " - runid: " + o + " - yield " + s++, i.next).call(i, e) } catch (u) { return r(u) } l(n) } function c(e) { var n; a = void 0; try { n = D(t + " - runid: " + o + " - yield " + s++, i.throw).call(i, e) } catch (u) { return r(u) } l(n) } function l(t) { if (!t || "function" != typeof t.then) return t.done ? e(t.value) : (a = Promise.resolve(t.value)).then(u, c); t.then(l, r) } n = r, u(void 0) }); return s.cancel = D(t + " - runid: " + o + " - cancel", function () { try { a && hr(a); var e = i.return(), t = Promise.resolve(e.value); t.then(Ct, Ct), hr(t), n(new Error("FLOW_CANCELLED")) } catch (r) { n(r) } }), s } } function hr(e) { "function" == typeof e.cancel && e.cancel() } var vr, dr, yr = { detectCycles: !0, exportMapsAsObjects: !0 }; function br(e, t, n, r) { return r.detectCycles && e.set(t, n), n } function mr(e, t, n) { if (!xe(e)) return e; if (!0 === t.detectCycles && null !== e && "object" == typeof e && n.has(e)) return n.get(e); if (_t(e)) { var r = br(n, e, [], t), o = e.map(function (e) { return mr(e, t, n) }); r.length = o.length; for (var i = 0, a = o.length; i < a; i++)r[i] = o[i]; return r } if (be(e)) { r = br(n, e, {}, t); for (var s in nr(e), e) r[s] = mr(e[s], t, n); return r } if (nt(e)) { if (!1 === t.exportMapsAsObjects) { var u = br(n, e, new Map, t); return e.forEach(function (e, r) { u.set(r, mr(e, t, n)) }), u } var c = br(n, e, {}, t); return e.forEach(function (e, r) { c[r] = mr(e, t, n) }), c } return ie(e) ? mr(e.get(), t, n) : e } function gr(e, t) { return xe(e) ? ("boolean" == typeof t && (t = { detectCycles: t }), t || (t = yr), !0 === t.detectCycles && (n = new Map), mr(e, t, n)) : e; var n } function xr(e, t, n) { var r; if (nt(e) || _t(e) || ie(e)) r = ot(e); else { if (!be(e)) return kt(!1); if ("string" != typeof t) return kt(!1); r = ot(e, t) } return void 0 !== r.dehancer ? kt(!1) : (r.dehancer = "function" == typeof t ? t : n, function () { r.dehancer = void 0 }) } "object" == typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__ && __MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({ spy: m, extras: { getDebugName: it } }); var Or = "$mobx"; exports.$mobx = Or;
    }, { "process": "pBGv" }], "lQiT": [function (require, module, exports) {
        var global = arguments[3];
        var e = arguments[3]; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.observer = re, exports.trackComponents = V, exports.useStaticRendering = Y, exports.inject = T, exports.Provider = exports.componentByNodeRegistry = exports.componentByNodeRegistery = exports.renderReporter = exports.Observer = exports.onError = exports.PropTypes = exports.propTypes = void 0; var t = require("mobx"), n = o(require("react")), r = require("react-dom"); function o(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; r.get || r.set ? Object.defineProperty(t, n, r) : t[n] = e[n] } return t.default = e, t } var i = void 0, a = "undefined" != typeof window ? window : void 0 !== e ? e : "undefined" != typeof self ? self : {}; function s(e, t) { return e(t = { exports: {} }, t.exports), t.exports } var c = s(function (e, t) { e.exports = function () { "use strict"; var e = { childContextTypes: !0, contextTypes: !0, defaultProps: !0, displayName: !0, getDefaultProps: !0, getDerivedStateFromProps: !0, mixins: !0, propTypes: !0, type: !0 }, t = { name: !0, length: !0, prototype: !0, caller: !0, callee: !0, arguments: !0, arity: !0 }, n = Object.defineProperty, r = Object.getOwnPropertyNames, o = Object.getOwnPropertySymbols, i = Object.getOwnPropertyDescriptor, a = Object.getPrototypeOf, s = a && a(Object); return function c(p, u, l) { if ("string" != typeof u) { if (s) { var f = a(u); f && f !== s && c(p, f, l) } var d = r(u); o && (d = d.concat(o(u))); for (var h = 0; h < d.length; ++h) { var y = d[h]; if (!(e[y] || t[y] || l && l[y])) { var v = i(u, y); try { n(p, y, v) } catch (b) { } } } return p } return p } }() }), p = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, u = function () { function e(e) { this.value = e } function t(t) { var n, r; function o(n, r) { try { var a = t[n](r), s = a.value; s instanceof e ? Promise.resolve(s.value).then(function (e) { o("next", e) }, function (e) { o("throw", e) }) : i(a.done ? "return" : "normal", a.value) } catch (c) { i("throw", c) } } function i(e, t) { switch (e) { case "return": n.resolve({ value: t, done: !0 }); break; case "throw": n.reject(t); break; default: n.resolve({ value: t, done: !1 }) }(n = n.next) ? o(n.key, n.arg) : r = null } this._invoke = function (e, t) { return new Promise(function (i, a) { var s = { key: e, arg: t, resolve: i, reject: a, next: null }; r ? r = r.next = s : (n = r = s, o(e, t)) }) }, "function" != typeof t.return && (this.return = void 0) } return "function" == typeof Symbol && Symbol.asyncIterator && (t.prototype[Symbol.asyncIterator] = function () { return this }), t.prototype.next = function (e) { return this._invoke("next", e) }, t.prototype.throw = function (e) { return this._invoke("throw", e) }, t.prototype.return = function (e) { return this._invoke("return", e) }, { wrap: function (e) { return function () { return new t(e.apply(this, arguments)) } }, await: function (t) { return new e(t) } } }(), l = function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }, f = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } return function (t, n, r) { return n && e(t.prototype, n), r && e(t, r), t } }(), d = function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }, h = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }, y = function () { function e() { l(this, e), this.listeners = [] } return f(e, [{ key: "on", value: function (e) { var t = this; return this.listeners.push(e), function () { var n = t.listeners.indexOf(e); -1 !== n && t.listeners.splice(n, 1) } } }, { key: "emit", value: function (e) { this.listeners.forEach(function (t) { return t(e) }) } }]), e }(); function v(e) { function n(n, r, o, i, a, s) { for (var c = arguments.length, p = Array(c > 6 ? c - 6 : 0), u = 6; u < c; u++)p[u - 6] = arguments[u]; return (0, t.untracked)(function () { if (i = i || "<<anonymous>>", s = s || o, null == r[o]) { if (n) { var t = null === r[o] ? "null" : "undefined"; return new Error("The " + a + " `" + s + "` is marked as required in `" + i + "`, but its value is `" + t + "`.") } return null } return e.apply(void 0, [r, o, i, a, s].concat(p)) }) } var r = n.bind(null, !1); return r.isRequired = n.bind(null, !0), r } function b(e, t) { return "symbol" === e || ("Symbol" === t["@@toStringTag"] || "function" == typeof Symbol && t instanceof Symbol) } function m(e) { var t = void 0 === e ? "undefined" : p(e); return Array.isArray(e) ? "array" : e instanceof RegExp ? "object" : b(t, e) ? "symbol" : t } function g(e) { var t = m(e); if ("object" === t) { if (e instanceof Date) return "date"; if (e instanceof RegExp) return "regexp" } return t } function w(e, n) { return v(function (r, o, i, a, s) { return (0, t.untracked)(function () { if (e && m(r[o]) === n.toLowerCase()) return null; var a = void 0; switch (n) { case "Array": a = t.isObservableArray; break; case "Object": a = t.isObservableObject; break; case "Map": a = t.isObservableMap; break; default: throw new Error("Unexpected mobxType: " + n) }var c = r[o]; if (!a(c)) { var p = g(c), u = e ? " or javascript `" + n.toLowerCase() + "`" : ""; return new Error("Invalid prop `" + s + "` of type `" + p + "` supplied to `" + i + "`, expected `mobx.Observable" + n + "`" + u + ".") } return null }) }) } function _(e, n) { return v(function (r, o, i, a, s) { for (var c = arguments.length, p = Array(c > 5 ? c - 5 : 0), u = 5; u < c; u++)p[u - 5] = arguments[u]; return (0, t.untracked)(function () { if ("function" != typeof n) return new Error("Property `" + s + "` of component `" + i + "` has invalid PropType notation."); var t = w(e, "Array")(r, o, i); if (t instanceof Error) return t; for (var c = r[o], u = 0; u < c.length; u++)if ((t = n.apply(void 0, [c, u, i, a, s + "[" + u + "]"].concat(p))) instanceof Error) return t; return null }) }) } var O = w(!1, "Array"), x = _.bind(null, !1), j = w(!1, "Map"), P = w(!1, "Object"), S = w(!0, "Array"), U = _.bind(null, !0), C = w(!0, "Object"), k = Object.freeze({ observableArray: O, observableArrayOf: x, observableMap: j, observableObject: P, arrayOrObservableArray: S, arrayOrObservableArrayOf: U, objectOrObservableObject: C }); function E(e) { return !(e.prototype && e.prototype.render) } exports.PropTypes = exports.propTypes = k; var R = { mobxStores: C }; Object.seal(R); var D = { contextTypes: { get: function () { return R }, set: function (e) { console.warn("Mobx Injector: you are trying to attach `contextTypes` on an component decorated with `inject` (or `observer`) HOC. Please specify the contextTypes on the wrapped component instead. It is accessible through the `wrappedComponent`") }, configurable: !0, enumerable: !1 }, isMobxInjector: { value: !0, writable: !0, configurable: !0, enumerable: !0 } }; function M(e, t, r) { var o, i, a = "inject-" + (t.displayName || t.name || t.constructor && t.constructor.name || "Unknown"); r && (a += "-with-" + r); var s = (i = o = function (r) { function o() { var e, t, n; l(this, o); for (var r = arguments.length, i = Array(r), a = 0; a < r; a++)i[a] = arguments[a]; return t = n = h(this, (e = o.__proto__ || Object.getPrototypeOf(o)).call.apply(e, [this].concat(i))), n.storeRef = function (e) { n.wrappedInstance = e }, h(n, t) } return d(o, r), f(o, [{ key: "render", value: function () { var r = {}; for (var o in this.props) this.props.hasOwnProperty(o) && (r[o] = this.props[o]); var i = e(this.context.mobxStores || {}, r, this.context) || {}; for (var a in i) r[a] = i[a]; return E(t) || (r.ref = this.storeRef), (0, n.createElement)(t, r) } }]), o }(n.Component), o.displayName = a, i); return c(s, t), s.wrappedComponent = t, Object.defineProperties(s, D), s } function I(e) { return function (t, n) { return e.forEach(function (e) { if (!(e in n)) { if (!(e in t)) throw new Error("MobX injector: Store '" + e + "' is not available! Make sure it is provided by some Provider"); n[e] = t[e] } }), n } } function T() { var e = void 0; if ("function" == typeof arguments[0]) return e = arguments[0], function (t) { var n = M(e, t); return n.isMobxInjector = !1, (n = re(n)).isMobxInjector = !0, n }; for (var t = [], n = 0; n < arguments.length; n++)t[n] = arguments[n]; return e = I(t), function (n) { return M(e, n, t.join("-")) } } var A = t.$mobx || "$mobx", N = !1, W = !1, F = !1, B = "undefined" != typeof WeakMap ? new WeakMap : void 0; exports.componentByNodeRegistry = exports.componentByNodeRegistery = B; var L = new y; function $(e) { return "function" == typeof Symbol ? Symbol(e) : "$mobxReactProp$" + e + Math.random() } exports.renderReporter = L; var q = $("skipRender"), X = $("isForcingUpdate"); function H(e, t, n) { Object.hasOwnProperty(e, t) ? e[t] = n : Object.defineProperty(e, t, { enumerable: !1, configurable: !0, writeable: !0, value: n }) } function G(e) { if (r.findDOMNode) try { return (0, r.findDOMNode)(e) } catch (t) { return null } return null } function K(e) { var t = G(e); t && B && B.set(t, e), L.emit({ event: "render", renderTime: e.__$mobRenderEnd - e.__$mobRenderStart, totalTime: Date.now() - e.__$mobRenderStart, component: e, node: t }) } function V() { if ("undefined" == typeof WeakMap) throw new Error("[mobx-react] tracking components is not supported in this browser."); N || (N = !0) } function Y(e) { W = e } var z = new y; function J(e, t) { var n = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], r = e[t], o = te[t], i = r ? !0 === n ? function () { o.apply(this, arguments), r.apply(this, arguments) } : function () { r.apply(this, arguments), o.apply(this, arguments) } : o; e[t] = i } function Q(e, t) { if (Z(e, t)) return !0; if ("object" !== (void 0 === e ? "undefined" : p(e)) || null === e || "object" !== (void 0 === t ? "undefined" : p(t)) || null === t) return !1; var n = Object.keys(e), r = Object.keys(t); if (n.length !== r.length) return !1; for (var o = 0; o < n.length; o++)if (!hasOwnProperty.call(t, n[o]) || !Z(e[n[o]], t[n[o]])) return !1; return !0 } function Z(e, t) { return e === t ? 0 !== e || 1 / e == 1 / t : e != e && t != t } function ee(e) { var r = this; if (!0 === W) return e.call(this); function o() { var e = this; c = !1; var n = void 0, r = void 0; if (p.track(function () { N && (e.__$mobRenderStart = Date.now()); try { r = (0, t._allowStateChanges)(!1, s) } catch (o) { n = o } N && (e.__$mobRenderEnd = Date.now()) }), n) throw z.emit(n), n; return r } var i = this.displayName || this.name || this.constructor && (this.constructor.displayName || this.constructor.name) || "<component>", a = this._reactInternalInstance && this._reactInternalInstance._rootNodeID || this._reactInternalInstance && this._reactInternalInstance._debugID || this._reactInternalFiber && this._reactInternalFiber._debugID; H(this, q, !1), H(this, X, !1); var s = e.bind(this), c = !1, p = new t.Reaction(i + "#" + a + ".render()", function () { if (!c && (c = !0, "function" == typeof r.componentWillReact && r.componentWillReact(), !0 !== r.__$mobxIsUnmounted)) { var e = !0; try { H(r, X, !0), r[q] || n.Component.prototype.forceUpdate.call(r), e = !1 } finally { H(r, X, !1), e && p.dispose() } } }); return p.reactComponent = this, o[A] = p, this.render = o, o.call(this) } var te = { componentWillUnmount: function () { if (!0 !== W && (this.render[A] && this.render[A].dispose(), this.__$mobxIsUnmounted = !0, N)) { var e = G(this); e && B && B.delete(e), L.emit({ event: "destroy", component: this, node: e }) } }, componentDidMount: function () { N && K(this) }, componentDidUpdate: function () { N && K(this) }, shouldComponentUpdate: function (e, t) { return W && console.warn("[mobx-react] It seems that a re-rendering of a React component is triggered while in static (server-side) mode. Please make sure components are rendered only once server-side."), this.state !== t || !Q(this.props, e) } }; function ne(e, n) { var r = $(n + " value holder"), o = $(n + " atom holder"); function i() { return this[o] || H(this, o, (0, t.createAtom)("reactive " + n)), this[o] } Object.defineProperty(e, n, { configurable: !0, enumerable: !0, get: function () { return i.call(this).reportObserved(), this[r] }, set: function (e) { this[X] || Q(this[r], e) ? H(this, r, e) : (H(this, r, e), H(this, q, !0), i.call(this).reportChanged(), H(this, q, !1)) } }) } function re(e, t) { if ("string" == typeof e) throw new Error("Store names should be provided as array"); if (Array.isArray(e)) return F || (F = !0, console.warn('Mobx observer: Using observer to inject stores is deprecated since 4.0. Use `@inject("store1", "store2") @observer ComponentClass` or `inject("store1", "store2")(observer(componentClass))` instead of `@observer(["store1", "store2"]) ComponentClass`')), t ? T.apply(null, e)(re(t)) : function (t) { return re(e, t) }; var r = e; if (!0 === r.isMobxInjector && console.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"), r.__proto__ === n.PureComponent && console.warn("Mobx observer: You are using 'observer' on React.PureComponent. These two achieve two opposite goals and should not be used together"), !("function" != typeof r || r.prototype && r.prototype.render || r.isReactClass || n.Component.isPrototypeOf(r))) { var o, i, a = re((i = o = function (e) { function t() { return l(this, t), h(this, (t.__proto__ || Object.getPrototypeOf(t)).apply(this, arguments)) } return d(t, e), f(t, [{ key: "render", value: function () { return r.call(this, this.props, this.context) } }]), t }(n.Component), o.displayName = r.displayName || r.name, o.contextTypes = r.contextTypes, o.propTypes = r.propTypes, o.defaultProps = r.defaultProps, i)); return c(a, r), a } if (!r) throw new Error("Please pass a valid component to 'observer'"); var s = r.prototype || r; oe(s), r.isMobXReactObserver = !0, ne(s, "props"), ne(s, "state"); var p = s.render; return s.render = function () { return ee.call(this, p) }, r } function oe(e) { ["componentDidMount", "componentWillUnmount", "componentDidUpdate"].forEach(function (t) { J(e, t) }), e.shouldComponentUpdate ? e.shouldComponentUpdate !== te.shouldComponentUpdate && console.warn("Use `shouldComponentUpdate` in an `observer` based component breaks the behavior of `observer` and might lead to unexpected results. Manually implementing `sCU` should not be needed when using mobx-react.") : e.shouldComponentUpdate = te.shouldComponentUpdate } var ie = re(function (e) { var t = e.children, r = e.inject, o = e.render, i = t || o; if (void 0 === i) return null; if (!r) return i(); console.warn("<Observer inject=.../> is no longer supported. Please use inject on the enclosing component instead"); var a = T(r)(i); return n.default.createElement(a, null) }); exports.Observer = ie, ie.displayName = "Observer"; var ae, se, ce = function (e, t, n, r, o) { var i = "children" === t ? "render" : "children"; return "function" == typeof e[t] && "function" == typeof e[i] ? new Error("Invalid prop,do not use children and render in the same time in`" + n) : "function" != typeof e[t] && "function" != typeof e[i] ? new Error("Invalid prop `" + o + "` of type `" + p(e[t]) + "` supplied to `" + n + "`, expected `function`.") : void 0 }; function pe() { var e = this.constructor.getDerivedStateFromProps(this.props, this.state); null != e && this.setState(e) } function ue(e) { var t = this.constructor.getDerivedStateFromProps(e, this.state); null != t && this.setState(t) } function le(e, t) { try { var n = this.props, r = this.state; this.props = e, this.state = t, this.__reactInternalSnapshotFlag = !0, this.__reactInternalSnapshot = this.getSnapshotBeforeUpdate(n, r) } finally { this.props = n, this.state = r } } function fe(e) { var t = e.prototype; if (!t || !t.isReactComponent) throw new Error("Can only polyfill class components"); if ("function" != typeof e.getDerivedStateFromProps && "function" != typeof t.getSnapshotBeforeUpdate) return e; var n = null, r = null, o = null; if ("function" == typeof t.componentWillMount ? n = "componentWillMount" : "function" == typeof t.UNSAFE_componentWillMount && (n = "UNSAFE_componentWillMount"), "function" == typeof t.componentWillReceiveProps ? r = "componentWillReceiveProps" : "function" == typeof t.UNSAFE_componentWillReceiveProps && (r = "UNSAFE_componentWillReceiveProps"), "function" == typeof t.componentWillUpdate ? o = "componentWillUpdate" : "function" == typeof t.UNSAFE_componentWillUpdate && (o = "UNSAFE_componentWillUpdate"), null !== n || null !== r || null !== o) { var i = e.displayName || e.name, a = "function" == typeof e.getDerivedStateFromProps ? "getDerivedStateFromProps()" : "getSnapshotBeforeUpdate()"; throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n" + i + " uses " + a + " but also contains the following legacy lifecycles:" + (null !== n ? "\n  " + n : "") + (null !== r ? "\n  " + r : "") + (null !== o ? "\n  " + o : "") + "\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks") } if ("function" == typeof e.getDerivedStateFromProps && (t.componentWillMount = pe, t.componentWillReceiveProps = ue), "function" == typeof t.getSnapshotBeforeUpdate) { if ("function" != typeof t.componentDidUpdate) throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype"); t.componentWillUpdate = le; var s = t.componentDidUpdate; t.componentDidUpdate = function (e, t, n) { var r = this.__reactInternalSnapshotFlag ? this.__reactInternalSnapshot : n; s.call(this, e, t, r) } } return e } ie.propTypes = { render: ce, children: ce }, pe.__suppressDeprecationWarning = !0, ue.__suppressDeprecationWarning = !0, le.__suppressDeprecationWarning = !0; var de = { children: !0, key: !0, ref: !0 }, he = (se = ae = function (e) { function t(e, n) { l(this, t); var r = h(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n)); return r.state = e || {}, r } return d(t, e), f(t, [{ key: "render", value: function () { return n.Children.only(this.props.children) } }, { key: "getChildContext", value: function () { var e = {}, t = this.context.mobxStores; if (t) for (var n in t) e[n] = t[n]; for (var r in this.state) de[r] || "suppressChangedStoreWarning" === r || (e[r] = this.props[r]); return { mobxStores: e } } }], [{ key: "getDerivedStateFromProps", value: function (e, t) { if (!e) return null; if (!t) return e; if (Object.keys(e).length !== Object.keys(t).length && console.warn("MobX Provider: The set of provided stores has changed. Please avoid changing stores as the change might not propagate to all children"), !e.suppressChangedStoreWarning) for (var n in e) de[n] || t[n] === e[n] || console.warn("MobX Provider: Provided store '" + n + "' has changed. Please avoid replacing stores as the change might not propagate to all children"); return e } }]), t }(n.Component), ae.contextTypes = { mobxStores: C }, ae.childContextTypes = { mobxStores: C.isRequired }, se); if (exports.Provider = he, fe(he), !n.Component) throw new Error("mobx-react requires React to be available"); if (!t.spy) throw new Error("mobx-react requires mobx to be available"); "function" == typeof r.unstable_batchedUpdates ? (0, t.configure)({ reactionScheduler: r.unstable_batchedUpdates }) : "function" == typeof i && (0, t.configure)({ reactionScheduler: i }); var ye = function (e) { return z.on(e) }; if (exports.onError = ye, "object" === ("undefined" == typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__ ? "undefined" : p(__MOBX_DEVTOOLS_GLOBAL_HOOK__))) { var ve = { spy: t.spy, extras: { getDebugName: t.getDebugName } }, be = { renderReporter: L, componentByNodeRegistry: B, componentByNodeRegistery: B, trackComponents: V }; __MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobxReact(be, ve) }
    }, { "mobx": "6uYi", "react": "1n8/", "react-dom": "NKHc" }], "ED/T": [function (require, module, exports) {
        "use strict"; module.exports = function (r, n) { return function () { for (var t = new Array(arguments.length), e = 0; e < t.length; e++)t[e] = arguments[e]; return r.apply(n, t) } };
    }, {}], "q/Zl": [function (require, module, exports) {
        function t(t) { return !!t.constructor && "function" == typeof t.constructor.isBuffer && t.constructor.isBuffer(t) } function n(n) { return "function" == typeof n.readFloatLE && "function" == typeof n.slice && t(n.slice(0, 0)) } module.exports = function (o) { return null != o && (t(o) || n(o) || !!o._isBuffer) };
    }, {}], "S1cf": [function (require, module, exports) {
        "use strict"; var e = require("./helpers/bind"), r = require("is-buffer"), n = Object.prototype.toString; function t(e) { return "[object Array]" === n.call(e) } function i(e) { return "[object ArrayBuffer]" === n.call(e) } function o(e) { return "undefined" != typeof FormData && e instanceof FormData } function f(e) { return "undefined" != typeof ArrayBuffer && ArrayBuffer.isView ? ArrayBuffer.isView(e) : e && e.buffer && e.buffer instanceof ArrayBuffer } function u(e) { return "string" == typeof e } function c(e) { return "number" == typeof e } function a(e) { return void 0 === e } function l(e) { return null !== e && "object" == typeof e } function s(e) { return "[object Date]" === n.call(e) } function p(e) { return "[object File]" === n.call(e) } function y(e) { return "[object Blob]" === n.call(e) } function d(e) { return "[object Function]" === n.call(e) } function b(e) { return l(e) && d(e.pipe) } function j(e) { return "undefined" != typeof URLSearchParams && e instanceof URLSearchParams } function m(e) { return e.replace(/^\s*/, "").replace(/\s*$/, "") } function B() { return ("undefined" == typeof navigator || "ReactNative" !== navigator.product) && ("undefined" != typeof window && "undefined" != typeof document) } function v(e, r) { if (null != e) if ("object" != typeof e && (e = [e]), t(e)) for (var n = 0, i = e.length; n < i; n++)r.call(null, e[n], n, e); else for (var o in e) Object.prototype.hasOwnProperty.call(e, o) && r.call(null, e[o], o, e) } function A() { var e = {}; function r(r, n) { "object" == typeof e[n] && "object" == typeof r ? e[n] = A(e[n], r) : e[n] = r } for (var n = 0, t = arguments.length; n < t; n++)v(arguments[n], r); return e } function g(r, n, t) { return v(n, function (n, i) { r[i] = t && "function" == typeof n ? e(n, t) : n }), r } module.exports = { isArray: t, isArrayBuffer: i, isBuffer: r, isFormData: o, isArrayBufferView: f, isString: u, isNumber: c, isObject: l, isUndefined: a, isDate: s, isFile: p, isBlob: y, isFunction: d, isStream: b, isURLSearchParams: j, isStandardBrowserEnv: B, forEach: v, merge: A, extend: g, trim: m };
    }, { "./helpers/bind": "ED/T", "is-buffer": "q/Zl" }], "M8l6": [function (require, module, exports) {
        "use strict"; var e = require("../utils"); module.exports = function (t, r) { e.forEach(t, function (e, o) { o !== r && o.toUpperCase() === r.toUpperCase() && (t[r] = e, delete t[o]) }) };
    }, { "../utils": "S1cf" }], "YdsM": [function (require, module, exports) {
        "use strict"; module.exports = function (e, o, r, s, t) { return e.config = o, r && (e.code = r), e.request = s, e.response = t, e };
    }, {}], "3bIi": [function (require, module, exports) {
        "use strict"; var r = require("./enhanceError"); module.exports = function (e, n, o, t, u) { var a = new Error(e); return r(a, n, o, t, u) };
    }, { "./enhanceError": "YdsM" }], "aS8y": [function (require, module, exports) {
        "use strict"; var t = require("./createError"); module.exports = function (e, s, u) { var a = u.config.validateStatus; u.status && a && !a(u.status) ? s(t("Request failed with status code " + u.status, u.config, null, u.request, u)) : e(u) };
    }, { "./createError": "3bIi" }], "H6Qo": [function (require, module, exports) {
        "use strict"; var e = require("./../utils"); function r(e) { return encodeURIComponent(e).replace(/%40/gi, "@").replace(/%3A/gi, ":").replace(/%24/g, "$").replace(/%2C/gi, ",").replace(/%20/g, "+").replace(/%5B/gi, "[").replace(/%5D/gi, "]") } module.exports = function (i, n, t) { if (!n) return i; var a; if (t) a = t(n); else if (e.isURLSearchParams(n)) a = n.toString(); else { var c = []; e.forEach(n, function (i, n) { null != i && (e.isArray(i) ? n += "[]" : i = [i], e.forEach(i, function (i) { e.isDate(i) ? i = i.toISOString() : e.isObject(i) && (i = JSON.stringify(i)), c.push(r(n) + "=" + r(i)) })) }), a = c.join("&") } return a && (i += (-1 === i.indexOf("?") ? "?" : "&") + a), i };
    }, { "./../utils": "S1cf" }], "ZeD7": [function (require, module, exports) {
        "use strict"; var e = require("./../utils"), t = ["age", "authorization", "content-length", "content-type", "etag", "expires", "from", "host", "if-modified-since", "if-unmodified-since", "last-modified", "location", "max-forwards", "proxy-authorization", "referer", "retry-after", "user-agent"]; module.exports = function (r) { var i, o, n, s = {}; return r ? (e.forEach(r.split("\n"), function (r) { if (n = r.indexOf(":"), i = e.trim(r.substr(0, n)).toLowerCase(), o = e.trim(r.substr(n + 1)), i) { if (s[i] && t.indexOf(i) >= 0) return; s[i] = "set-cookie" === i ? (s[i] ? s[i] : []).concat([o]) : s[i] ? s[i] + ", " + o : o } }), s) : s };
    }, { "./../utils": "S1cf" }], "/w7L": [function (require, module, exports) {
        "use strict"; var t = require("./../utils"); module.exports = t.isStandardBrowserEnv() ? function () { var r, e = /(msie|trident)/i.test(navigator.userAgent), o = document.createElement("a"); function a(t) { var r = t; return e && (o.setAttribute("href", r), r = o.href), o.setAttribute("href", r), { href: o.href, protocol: o.protocol ? o.protocol.replace(/:$/, "") : "", host: o.host, search: o.search ? o.search.replace(/^\?/, "") : "", hash: o.hash ? o.hash.replace(/^#/, "") : "", hostname: o.hostname, port: o.port, pathname: "/" === o.pathname.charAt(0) ? o.pathname : "/" + o.pathname } } return r = a(window.location.href), function (e) { var o = t.isString(e) ? a(e) : e; return o.protocol === r.protocol && o.host === r.host } }() : function () { return !0 };
    }, { "./../utils": "S1cf" }], "mmkS": [function (require, module, exports) {
        "use strict"; var r = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="; function t() { this.message = "String contains an invalid character" } function o(o) { for (var e, a, n = String(o), c = "", i = 0, h = r; n.charAt(0 | i) || (h = "=", i % 1); c += h.charAt(63 & e >> 8 - i % 1 * 8)) { if ((a = n.charCodeAt(i += .75)) > 255) throw new t; e = e << 8 | a } return c } t.prototype = new Error, t.prototype.code = 5, t.prototype.name = "InvalidCharacterError", module.exports = o;
    }, {}], "dn2M": [function (require, module, exports) {
        "use strict"; var e = require("./../utils"); module.exports = e.isStandardBrowserEnv() ? { write: function (n, t, o, r, i, u) { var s = []; s.push(n + "=" + encodeURIComponent(t)), e.isNumber(o) && s.push("expires=" + new Date(o).toGMTString()), e.isString(r) && s.push("path=" + r), e.isString(i) && s.push("domain=" + i), !0 === u && s.push("secure"), document.cookie = s.join("; ") }, read: function (e) { var n = document.cookie.match(new RegExp("(^|;\\s*)(" + e + ")=([^;]*)")); return n ? decodeURIComponent(n[3]) : null }, remove: function (e) { this.write(e, "", Date.now() - 864e5) } } : { write: function () { }, read: function () { return null }, remove: function () { } };
    }, { "./../utils": "S1cf" }], "KRuG": [function (require, module, exports) {
        "use strict"; var e = require("./../utils"), r = require("./../core/settle"), o = require("./../helpers/buildURL"), t = require("./../helpers/parseHeaders"), n = require("./../helpers/isURLSameOrigin"), s = require("../core/createError"), i = "undefined" != typeof window && window.btoa && window.btoa.bind(window) || require("./../helpers/btoa"); module.exports = function (a) { return new Promise(function (u, d) { var l = a.data, p = a.headers; e.isFormData(l) && delete p["Content-Type"]; var f = new XMLHttpRequest, c = "onreadystatechange", w = !1; if ("undefined" == typeof window || !window.XDomainRequest || "withCredentials" in f || n(a.url) || (f = new window.XDomainRequest, c = "onload", w = !0, f.onprogress = function () { }, f.ontimeout = function () { }), a.auth) { var h = a.auth.username || "", m = a.auth.password || ""; p.Authorization = "Basic " + i(h + ":" + m) } if (f.open(a.method.toUpperCase(), o(a.url, a.params, a.paramsSerializer), !0), f.timeout = a.timeout, f[c] = function () { if (f && (4 === f.readyState || w) && (0 !== f.status || f.responseURL && 0 === f.responseURL.indexOf("file:"))) { var e = "getAllResponseHeaders" in f ? t(f.getAllResponseHeaders()) : null, o = { data: a.responseType && "text" !== a.responseType ? f.response : f.responseText, status: 1223 === f.status ? 204 : f.status, statusText: 1223 === f.status ? "No Content" : f.statusText, headers: e, config: a, request: f }; r(u, d, o), f = null } }, f.onerror = function () { d(s("Network Error", a, null, f)), f = null }, f.ontimeout = function () { d(s("timeout of " + a.timeout + "ms exceeded", a, "ECONNABORTED", f)), f = null }, e.isStandardBrowserEnv()) { var y = require("./../helpers/cookies"), q = (a.withCredentials || n(a.url)) && a.xsrfCookieName ? y.read(a.xsrfCookieName) : void 0; q && (p[a.xsrfHeaderName] = q) } if ("setRequestHeader" in f && e.forEach(p, function (e, r) { void 0 === l && "content-type" === r.toLowerCase() ? delete p[r] : f.setRequestHeader(r, e) }), a.withCredentials && (f.withCredentials = !0), a.responseType) try { f.responseType = a.responseType } catch (T) { if ("json" !== a.responseType) throw T } "function" == typeof a.onDownloadProgress && f.addEventListener("progress", a.onDownloadProgress), "function" == typeof a.onUploadProgress && f.upload && f.upload.addEventListener("progress", a.onUploadProgress), a.cancelToken && a.cancelToken.promise.then(function (e) { f && (f.abort(), d(e), f = null) }), void 0 === l && (l = null), f.send(l) }) };
    }, { "./../utils": "S1cf", "./../core/settle": "aS8y", "./../helpers/buildURL": "H6Qo", "./../helpers/parseHeaders": "ZeD7", "./../helpers/isURLSameOrigin": "/w7L", "../core/createError": "3bIi", "./../helpers/btoa": "mmkS", "./../helpers/cookies": "dn2M" }], "p5a1": [function (require, module, exports) {
        var global = arguments[3];
        var r, e = arguments[3]; exports.fetch = s(e.fetch) && s(e.ReadableStream), exports.writableStream = s(e.WritableStream), exports.abortController = s(e.AbortController), exports.blobConstructor = !1; try { new Blob([new ArrayBuffer(1)]), exports.blobConstructor = !0 } catch (f) { } function t() { if (void 0 !== r) return r; if (e.XMLHttpRequest) { r = new e.XMLHttpRequest; try { r.open("GET", e.XDomainRequest ? "/" : "https://example.com") } catch (f) { r = null } } else r = null; return r } function o(r) { var e = t(); if (!e) return !1; try { return e.responseType = r, e.responseType === r } catch (f) { } return !1 } var a = void 0 !== e.ArrayBuffer, n = a && s(e.ArrayBuffer.prototype.slice); function s(r) { return "function" == typeof r } exports.arraybuffer = exports.fetch || a && o("arraybuffer"), exports.msstream = !exports.fetch && n && o("ms-stream"), exports.mozchunkedarraybuffer = !exports.fetch && a && o("moz-chunked-arraybuffer"), exports.overrideMimeType = exports.fetch || !!t() && s(t().overrideMimeType), exports.vbArray = s(e.VBArray), r = null;
    }, {}], "4Bm0": [function (require, module, exports) {
        "function" == typeof Object.create ? module.exports = function (t, e) { t.super_ = e, t.prototype = Object.create(e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }) } : module.exports = function (t, e) { t.super_ = e; var o = function () { }; o.prototype = e.prototype, t.prototype = new o, t.prototype.constructor = t };
    }, {}], "Yj0v": [function (require, module, exports) {
        var process = require("process");
        var n = require("process"); function e(e, r, t, c) { if ("function" != typeof e) throw new TypeError('"callback" argument must be a function'); var i, l, u = arguments.length; switch (u) { case 0: case 1: return n.nextTick(e); case 2: return n.nextTick(function () { e.call(null, r) }); case 3: return n.nextTick(function () { e.call(null, r, t) }); case 4: return n.nextTick(function () { e.call(null, r, t, c) }); default: for (i = new Array(u - 1), l = 0; l < i.length;)i[l++] = arguments[l]; return n.nextTick(function () { e.apply(null, i) }) } } !n.version || 0 === n.version.indexOf("v0.") || 0 === n.version.indexOf("v1.") && 0 !== n.version.indexOf("v1.8.") ? module.exports = { nextTick: e } : module.exports = n;
    }, { "process": "pBGv" }], "REa7": [function (require, module, exports) {
        var r = {}.toString; module.exports = Array.isArray || function (t) { return "[object Array]" == r.call(t) };
    }, {}], "FRpO": [function (require, module, exports) {
        function e() { this._events = this._events || {}, this._maxListeners = this._maxListeners || void 0 } function t(e) { return "function" == typeof e } function s(e) { return "number" == typeof e } function n(e) { return "object" == typeof e && null !== e } function i(e) { return void 0 === e } module.exports = e, e.EventEmitter = e, e.prototype._events = void 0, e.prototype._maxListeners = void 0, e.defaultMaxListeners = 10, e.prototype.setMaxListeners = function (e) { if (!s(e) || e < 0 || isNaN(e)) throw TypeError("n must be a positive number"); return this._maxListeners = e, this }, e.prototype.emit = function (e) { var s, r, o, h, v, l; if (this._events || (this._events = {}), "error" === e && (!this._events.error || n(this._events.error) && !this._events.error.length)) { if ((s = arguments[1]) instanceof Error) throw s; var u = new Error('Uncaught, unspecified "error" event. (' + s + ")"); throw u.context = s, u } if (i(r = this._events[e])) return !1; if (t(r)) switch (arguments.length) { case 1: r.call(this); break; case 2: r.call(this, arguments[1]); break; case 3: r.call(this, arguments[1], arguments[2]); break; default: h = Array.prototype.slice.call(arguments, 1), r.apply(this, h) } else if (n(r)) for (h = Array.prototype.slice.call(arguments, 1), o = (l = r.slice()).length, v = 0; v < o; v++)l[v].apply(this, h); return !0 }, e.prototype.addListener = function (s, r) { var o; if (!t(r)) throw TypeError("listener must be a function"); return this._events || (this._events = {}), this._events.newListener && this.emit("newListener", s, t(r.listener) ? r.listener : r), this._events[s] ? n(this._events[s]) ? this._events[s].push(r) : this._events[s] = [this._events[s], r] : this._events[s] = r, n(this._events[s]) && !this._events[s].warned && (o = i(this._maxListeners) ? e.defaultMaxListeners : this._maxListeners) && o > 0 && this._events[s].length > o && (this._events[s].warned = !0, console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.", this._events[s].length), "function" == typeof console.trace && console.trace()), this }, e.prototype.on = e.prototype.addListener, e.prototype.once = function (e, s) { if (!t(s)) throw TypeError("listener must be a function"); var n = !1; function i() { this.removeListener(e, i), n || (n = !0, s.apply(this, arguments)) } return i.listener = s, this.on(e, i), this }, e.prototype.removeListener = function (e, s) { var i, r, o, h; if (!t(s)) throw TypeError("listener must be a function"); if (!this._events || !this._events[e]) return this; if (o = (i = this._events[e]).length, r = -1, i === s || t(i.listener) && i.listener === s) delete this._events[e], this._events.removeListener && this.emit("removeListener", e, s); else if (n(i)) { for (h = o; h-- > 0;)if (i[h] === s || i[h].listener && i[h].listener === s) { r = h; break } if (r < 0) return this; 1 === i.length ? (i.length = 0, delete this._events[e]) : i.splice(r, 1), this._events.removeListener && this.emit("removeListener", e, s) } return this }, e.prototype.removeAllListeners = function (e) { var s, n; if (!this._events) return this; if (!this._events.removeListener) return 0 === arguments.length ? this._events = {} : this._events[e] && delete this._events[e], this; if (0 === arguments.length) { for (s in this._events) "removeListener" !== s && this.removeAllListeners(s); return this.removeAllListeners("removeListener"), this._events = {}, this } if (t(n = this._events[e])) this.removeListener(e, n); else if (n) for (; n.length;)this.removeListener(e, n[n.length - 1]); return delete this._events[e], this }, e.prototype.listeners = function (e) { return this._events && this._events[e] ? t(this._events[e]) ? [this._events[e]] : this._events[e].slice() : [] }, e.prototype.listenerCount = function (e) { if (this._events) { var s = this._events[e]; if (t(s)) return 1; if (s) return s.length } return 0 }, e.listenerCount = function (e, t) { return e.listenerCount(t) };
    }, {}], "yh9p": [function (require, module, exports) {
        "use strict"; exports.byteLength = u, exports.toByteArray = i, exports.fromByteArray = d; for (var r = [], t = [], e = "undefined" != typeof Uint8Array ? Uint8Array : Array, n = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", o = 0, a = n.length; o < a; ++o)r[o] = n[o], t[n.charCodeAt(o)] = o; function h(r) { var t = r.length; if (t % 4 > 0) throw new Error("Invalid string. Length must be a multiple of 4"); var e = r.indexOf("="); return -1 === e && (e = t), [e, e === t ? 0 : 4 - e % 4] } function u(r) { var t = h(r), e = t[0], n = t[1]; return 3 * (e + n) / 4 - n } function c(r, t, e) { return 3 * (t + e) / 4 - e } function i(r) { for (var n, o = h(r), a = o[0], u = o[1], i = new e(c(r, a, u)), f = 0, A = u > 0 ? a - 4 : a, d = 0; d < A; d += 4)n = t[r.charCodeAt(d)] << 18 | t[r.charCodeAt(d + 1)] << 12 | t[r.charCodeAt(d + 2)] << 6 | t[r.charCodeAt(d + 3)], i[f++] = n >> 16 & 255, i[f++] = n >> 8 & 255, i[f++] = 255 & n; return 2 === u && (n = t[r.charCodeAt(d)] << 2 | t[r.charCodeAt(d + 1)] >> 4, i[f++] = 255 & n), 1 === u && (n = t[r.charCodeAt(d)] << 10 | t[r.charCodeAt(d + 1)] << 4 | t[r.charCodeAt(d + 2)] >> 2, i[f++] = n >> 8 & 255, i[f++] = 255 & n), i } function f(t) { return r[t >> 18 & 63] + r[t >> 12 & 63] + r[t >> 6 & 63] + r[63 & t] } function A(r, t, e) { for (var n, o = [], a = t; a < e; a += 3)n = (r[a] << 16 & 16711680) + (r[a + 1] << 8 & 65280) + (255 & r[a + 2]), o.push(f(n)); return o.join("") } function d(t) { for (var e, n = t.length, o = n % 3, a = [], h = 0, u = n - o; h < u; h += 16383)a.push(A(t, h, h + 16383 > u ? u : h + 16383)); return 1 === o ? (e = t[n - 1], a.push(r[e >> 2] + r[e << 4 & 63] + "==")) : 2 === o && (e = (t[n - 2] << 8) + t[n - 1], a.push(r[e >> 10] + r[e >> 4 & 63] + r[e << 2 & 63] + "=")), a.join("") } t["-".charCodeAt(0)] = 62, t["_".charCodeAt(0)] = 63;
    }, {}], "JgNJ": [function (require, module, exports) {
        exports.read = function (a, o, t, r, h) { var M, p, w = 8 * h - r - 1, f = (1 << w) - 1, e = f >> 1, i = -7, N = t ? h - 1 : 0, n = t ? -1 : 1, s = a[o + N]; for (N += n, M = s & (1 << -i) - 1, s >>= -i, i += w; i > 0; M = 256 * M + a[o + N], N += n, i -= 8); for (p = M & (1 << -i) - 1, M >>= -i, i += r; i > 0; p = 256 * p + a[o + N], N += n, i -= 8); if (0 === M) M = 1 - e; else { if (M === f) return p ? NaN : 1 / 0 * (s ? -1 : 1); p += Math.pow(2, r), M -= e } return (s ? -1 : 1) * p * Math.pow(2, M - r) }, exports.write = function (a, o, t, r, h, M) { var p, w, f, e = 8 * M - h - 1, i = (1 << e) - 1, N = i >> 1, n = 23 === h ? Math.pow(2, -24) - Math.pow(2, -77) : 0, s = r ? 0 : M - 1, u = r ? 1 : -1, l = o < 0 || 0 === o && 1 / o < 0 ? 1 : 0; for (o = Math.abs(o), isNaN(o) || o === 1 / 0 ? (w = isNaN(o) ? 1 : 0, p = i) : (p = Math.floor(Math.log(o) / Math.LN2), o * (f = Math.pow(2, -p)) < 1 && (p-- , f *= 2), (o += p + N >= 1 ? n / f : n * Math.pow(2, 1 - N)) * f >= 2 && (p++ , f /= 2), p + N >= i ? (w = 0, p = i) : p + N >= 1 ? (w = (o * f - 1) * Math.pow(2, h), p += N) : (w = o * Math.pow(2, N - 1) * Math.pow(2, h), p = 0)); h >= 8; a[t + s] = 255 & w, s += u, w /= 256, h -= 8); for (p = p << h | w, e += h; e > 0; a[t + s] = 255 & p, s += u, p /= 256, e -= 8); a[t + s - u] |= 128 * l };
    }, {}], "dskh": [function (require, module, exports) {

        var global = arguments[3];
        var t = arguments[3], r = require("base64-js"), e = require("ieee754"), n = require("isarray"); function i() { try { var t = new Uint8Array(1); return t.__proto__ = { __proto__: Uint8Array.prototype, foo: function () { return 42 } }, 42 === t.foo() && "function" == typeof t.subarray && 0 === t.subarray(1, 1).byteLength } catch (r) { return !1 } } function o() { return f.TYPED_ARRAY_SUPPORT ? 2147483647 : 1073741823 } function u(t, r) { if (o() < r) throw new RangeError("Invalid typed array length"); return f.TYPED_ARRAY_SUPPORT ? (t = new Uint8Array(r)).__proto__ = f.prototype : (null === t && (t = new f(r)), t.length = r), t } function f(t, r, e) { if (!(f.TYPED_ARRAY_SUPPORT || this instanceof f)) return new f(t, r, e); if ("number" == typeof t) { if ("string" == typeof r) throw new Error("If encoding is specified then the first argument must be a string"); return c(this, t) } return s(this, t, r, e) } function s(t, r, e, n) { if ("number" == typeof r) throw new TypeError('"value" argument must not be a number'); return "undefined" != typeof ArrayBuffer && r instanceof ArrayBuffer ? g(t, r, e, n) : "string" == typeof r ? l(t, r, e) : y(t, r) } function h(t) { if ("number" != typeof t) throw new TypeError('"size" argument must be a number'); if (t < 0) throw new RangeError('"size" argument must not be negative') } function a(t, r, e, n) { return h(r), r <= 0 ? u(t, r) : void 0 !== e ? "string" == typeof n ? u(t, r).fill(e, n) : u(t, r).fill(e) : u(t, r) } function c(t, r) { if (h(r), t = u(t, r < 0 ? 0 : 0 | w(r)), !f.TYPED_ARRAY_SUPPORT) for (var e = 0; e < r; ++e)t[e] = 0; return t } function l(t, r, e) { if ("string" == typeof e && "" !== e || (e = "utf8"), !f.isEncoding(e)) throw new TypeError('"encoding" must be a valid string encoding'); var n = 0 | v(r, e), i = (t = u(t, n)).write(r, e); return i !== n && (t = t.slice(0, i)), t } function p(t, r) { var e = r.length < 0 ? 0 : 0 | w(r.length); t = u(t, e); for (var n = 0; n < e; n += 1)t[n] = 255 & r[n]; return t } function g(t, r, e, n) { if (r.byteLength, e < 0 || r.byteLength < e) throw new RangeError("'offset' is out of bounds"); if (r.byteLength < e + (n || 0)) throw new RangeError("'length' is out of bounds"); return r = void 0 === e && void 0 === n ? new Uint8Array(r) : void 0 === n ? new Uint8Array(r, e) : new Uint8Array(r, e, n), f.TYPED_ARRAY_SUPPORT ? (t = r).__proto__ = f.prototype : t = p(t, r), t } function y(t, r) { if (f.isBuffer(r)) { var e = 0 | w(r.length); return 0 === (t = u(t, e)).length ? t : (r.copy(t, 0, 0, e), t) } if (r) { if ("undefined" != typeof ArrayBuffer && r.buffer instanceof ArrayBuffer || "length" in r) return "number" != typeof r.length || W(r.length) ? u(t, 0) : p(t, r); if ("Buffer" === r.type && n(r.data)) return p(t, r.data) } throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.") } function w(t) { if (t >= o()) throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x" + o().toString(16) + " bytes"); return 0 | t } function d(t) { return +t != t && (t = 0), f.alloc(+t) } function v(t, r) { if (f.isBuffer(t)) return t.length; if ("undefined" != typeof ArrayBuffer && "function" == typeof ArrayBuffer.isView && (ArrayBuffer.isView(t) || t instanceof ArrayBuffer)) return t.byteLength; "string" != typeof t && (t = "" + t); var e = t.length; if (0 === e) return 0; for (var n = !1; ;)switch (r) { case "ascii": case "latin1": case "binary": return e; case "utf8": case "utf-8": case void 0: return $(t).length; case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": return 2 * e; case "hex": return e >>> 1; case "base64": return K(t).length; default: if (n) return $(t).length; r = ("" + r).toLowerCase(), n = !0 } } function E(t, r, e) { var n = !1; if ((void 0 === r || r < 0) && (r = 0), r > this.length) return ""; if ((void 0 === e || e > this.length) && (e = this.length), e <= 0) return ""; if ((e >>>= 0) <= (r >>>= 0)) return ""; for (t || (t = "utf8"); ;)switch (t) { case "hex": return x(this, r, e); case "utf8": case "utf-8": return Y(this, r, e); case "ascii": return L(this, r, e); case "latin1": case "binary": return D(this, r, e); case "base64": return S(this, r, e); case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": return C(this, r, e); default: if (n) throw new TypeError("Unknown encoding: " + t); t = (t + "").toLowerCase(), n = !0 } } function b(t, r, e) { var n = t[r]; t[r] = t[e], t[e] = n } function R(t, r, e, n, i) { if (0 === t.length) return -1; if ("string" == typeof e ? (n = e, e = 0) : e > 2147483647 ? e = 2147483647 : e < -2147483648 && (e = -2147483648), e = +e, isNaN(e) && (e = i ? 0 : t.length - 1), e < 0 && (e = t.length + e), e >= t.length) { if (i) return -1; e = t.length - 1 } else if (e < 0) { if (!i) return -1; e = 0 } if ("string" == typeof r && (r = f.from(r, n)), f.isBuffer(r)) return 0 === r.length ? -1 : _(t, r, e, n, i); if ("number" == typeof r) return r &= 255, f.TYPED_ARRAY_SUPPORT && "function" == typeof Uint8Array.prototype.indexOf ? i ? Uint8Array.prototype.indexOf.call(t, r, e) : Uint8Array.prototype.lastIndexOf.call(t, r, e) : _(t, [r], e, n, i); throw new TypeError("val must be string, number or Buffer") } function _(t, r, e, n, i) { var o, u = 1, f = t.length, s = r.length; if (void 0 !== n && ("ucs2" === (n = String(n).toLowerCase()) || "ucs-2" === n || "utf16le" === n || "utf-16le" === n)) { if (t.length < 2 || r.length < 2) return -1; u = 2, f /= 2, s /= 2, e /= 2 } function h(t, r) { return 1 === u ? t[r] : t.readUInt16BE(r * u) } if (i) { var a = -1; for (o = e; o < f; o++)if (h(t, o) === h(r, -1 === a ? 0 : o - a)) { if (-1 === a && (a = o), o - a + 1 === s) return a * u } else -1 !== a && (o -= o - a), a = -1 } else for (e + s > f && (e = f - s), o = e; o >= 0; o--) { for (var c = !0, l = 0; l < s; l++)if (h(t, o + l) !== h(r, l)) { c = !1; break } if (c) return o } return -1 } function A(t, r, e, n) { e = Number(e) || 0; var i = t.length - e; n ? (n = Number(n)) > i && (n = i) : n = i; var o = r.length; if (o % 2 != 0) throw new TypeError("Invalid hex string"); n > o / 2 && (n = o / 2); for (var u = 0; u < n; ++u) { var f = parseInt(r.substr(2 * u, 2), 16); if (isNaN(f)) return u; t[e + u] = f } return u } function m(t, r, e, n) { return Q($(r, t.length - e), t, e, n) } function P(t, r, e, n) { return Q(G(r), t, e, n) } function T(t, r, e, n) { return P(t, r, e, n) } function B(t, r, e, n) { return Q(K(r), t, e, n) } function U(t, r, e, n) { return Q(H(r, t.length - e), t, e, n) } function S(t, e, n) { return 0 === e && n === t.length ? r.fromByteArray(t) : r.fromByteArray(t.slice(e, n)) } function Y(t, r, e) { e = Math.min(t.length, e); for (var n = [], i = r; i < e;) { var o, u, f, s, h = t[i], a = null, c = h > 239 ? 4 : h > 223 ? 3 : h > 191 ? 2 : 1; if (i + c <= e) switch (c) { case 1: h < 128 && (a = h); break; case 2: 128 == (192 & (o = t[i + 1])) && (s = (31 & h) << 6 | 63 & o) > 127 && (a = s); break; case 3: o = t[i + 1], u = t[i + 2], 128 == (192 & o) && 128 == (192 & u) && (s = (15 & h) << 12 | (63 & o) << 6 | 63 & u) > 2047 && (s < 55296 || s > 57343) && (a = s); break; case 4: o = t[i + 1], u = t[i + 2], f = t[i + 3], 128 == (192 & o) && 128 == (192 & u) && 128 == (192 & f) && (s = (15 & h) << 18 | (63 & o) << 12 | (63 & u) << 6 | 63 & f) > 65535 && s < 1114112 && (a = s) }null === a ? (a = 65533, c = 1) : a > 65535 && (a -= 65536, n.push(a >>> 10 & 1023 | 55296), a = 56320 | 1023 & a), n.push(a), i += c } return O(n) } exports.Buffer = f, exports.SlowBuffer = d, exports.INSPECT_MAX_BYTES = 50, f.TYPED_ARRAY_SUPPORT = void 0 !== t.TYPED_ARRAY_SUPPORT ? t.TYPED_ARRAY_SUPPORT : i(), exports.kMaxLength = o(), f.poolSize = 8192, f._augment = function (t) { return t.__proto__ = f.prototype, t }, f.from = function (t, r, e) { return s(null, t, r, e) }, f.TYPED_ARRAY_SUPPORT && (f.prototype.__proto__ = Uint8Array.prototype, f.__proto__ = Uint8Array, "undefined" != typeof Symbol && Symbol.species && f[Symbol.species] === f && Object.defineProperty(f, Symbol.species, { value: null, configurable: !0 })), f.alloc = function (t, r, e) { return a(null, t, r, e) }, f.allocUnsafe = function (t) { return c(null, t) }, f.allocUnsafeSlow = function (t) { return c(null, t) }, f.isBuffer = function (t) { return !(null == t || !t._isBuffer) }, f.compare = function (t, r) { if (!f.isBuffer(t) || !f.isBuffer(r)) throw new TypeError("Arguments must be Buffers"); if (t === r) return 0; for (var e = t.length, n = r.length, i = 0, o = Math.min(e, n); i < o; ++i)if (t[i] !== r[i]) { e = t[i], n = r[i]; break } return e < n ? -1 : n < e ? 1 : 0 }, f.isEncoding = function (t) { switch (String(t).toLowerCase()) { case "hex": case "utf8": case "utf-8": case "ascii": case "latin1": case "binary": case "base64": case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": return !0; default: return !1 } }, f.concat = function (t, r) { if (!n(t)) throw new TypeError('"list" argument must be an Array of Buffers'); if (0 === t.length) return f.alloc(0); var e; if (void 0 === r) for (r = 0, e = 0; e < t.length; ++e)r += t[e].length; var i = f.allocUnsafe(r), o = 0; for (e = 0; e < t.length; ++e) { var u = t[e]; if (!f.isBuffer(u)) throw new TypeError('"list" argument must be an Array of Buffers'); u.copy(i, o), o += u.length } return i }, f.byteLength = v, f.prototype._isBuffer = !0, f.prototype.swap16 = function () { var t = this.length; if (t % 2 != 0) throw new RangeError("Buffer size must be a multiple of 16-bits"); for (var r = 0; r < t; r += 2)b(this, r, r + 1); return this }, f.prototype.swap32 = function () { var t = this.length; if (t % 4 != 0) throw new RangeError("Buffer size must be a multiple of 32-bits"); for (var r = 0; r < t; r += 4)b(this, r, r + 3), b(this, r + 1, r + 2); return this }, f.prototype.swap64 = function () { var t = this.length; if (t % 8 != 0) throw new RangeError("Buffer size must be a multiple of 64-bits"); for (var r = 0; r < t; r += 8)b(this, r, r + 7), b(this, r + 1, r + 6), b(this, r + 2, r + 5), b(this, r + 3, r + 4); return this }, f.prototype.toString = function () { var t = 0 | this.length; return 0 === t ? "" : 0 === arguments.length ? Y(this, 0, t) : E.apply(this, arguments) }, f.prototype.equals = function (t) { if (!f.isBuffer(t)) throw new TypeError("Argument must be a Buffer"); return this === t || 0 === f.compare(this, t) }, f.prototype.inspect = function () { var t = "", r = exports.INSPECT_MAX_BYTES; return this.length > 0 && (t = this.toString("hex", 0, r).match(/.{2}/g).join(" "), this.length > r && (t += " ... ")), "<Buffer " + t + ">" }, f.prototype.compare = function (t, r, e, n, i) { if (!f.isBuffer(t)) throw new TypeError("Argument must be a Buffer"); if (void 0 === r && (r = 0), void 0 === e && (e = t ? t.length : 0), void 0 === n && (n = 0), void 0 === i && (i = this.length), r < 0 || e > t.length || n < 0 || i > this.length) throw new RangeError("out of range index"); if (n >= i && r >= e) return 0; if (n >= i) return -1; if (r >= e) return 1; if (this === t) return 0; for (var o = (i >>>= 0) - (n >>>= 0), u = (e >>>= 0) - (r >>>= 0), s = Math.min(o, u), h = this.slice(n, i), a = t.slice(r, e), c = 0; c < s; ++c)if (h[c] !== a[c]) { o = h[c], u = a[c]; break } return o < u ? -1 : u < o ? 1 : 0 }, f.prototype.includes = function (t, r, e) { return -1 !== this.indexOf(t, r, e) }, f.prototype.indexOf = function (t, r, e) { return R(this, t, r, e, !0) }, f.prototype.lastIndexOf = function (t, r, e) { return R(this, t, r, e, !1) }, f.prototype.write = function (t, r, e, n) { if (void 0 === r) n = "utf8", e = this.length, r = 0; else if (void 0 === e && "string" == typeof r) n = r, e = this.length, r = 0; else { if (!isFinite(r)) throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported"); r |= 0, isFinite(e) ? (e |= 0, void 0 === n && (n = "utf8")) : (n = e, e = void 0) } var i = this.length - r; if ((void 0 === e || e > i) && (e = i), t.length > 0 && (e < 0 || r < 0) || r > this.length) throw new RangeError("Attempt to write outside buffer bounds"); n || (n = "utf8"); for (var o = !1; ;)switch (n) { case "hex": return A(this, t, r, e); case "utf8": case "utf-8": return m(this, t, r, e); case "ascii": return P(this, t, r, e); case "latin1": case "binary": return T(this, t, r, e); case "base64": return B(this, t, r, e); case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": return U(this, t, r, e); default: if (o) throw new TypeError("Unknown encoding: " + n); n = ("" + n).toLowerCase(), o = !0 } }, f.prototype.toJSON = function () { return { type: "Buffer", data: Array.prototype.slice.call(this._arr || this, 0) } }; var I = 4096; function O(t) { var r = t.length; if (r <= I) return String.fromCharCode.apply(String, t); for (var e = "", n = 0; n < r;)e += String.fromCharCode.apply(String, t.slice(n, n += I)); return e } function L(t, r, e) { var n = ""; e = Math.min(t.length, e); for (var i = r; i < e; ++i)n += String.fromCharCode(127 & t[i]); return n } function D(t, r, e) { var n = ""; e = Math.min(t.length, e); for (var i = r; i < e; ++i)n += String.fromCharCode(t[i]); return n } function x(t, r, e) { var n = t.length; (!r || r < 0) && (r = 0), (!e || e < 0 || e > n) && (e = n); for (var i = "", o = r; o < e; ++o)i += Z(t[o]); return i } function C(t, r, e) { for (var n = t.slice(r, e), i = "", o = 0; o < n.length; o += 2)i += String.fromCharCode(n[o] + 256 * n[o + 1]); return i } function M(t, r, e) { if (t % 1 != 0 || t < 0) throw new RangeError("offset is not uint"); if (t + r > e) throw new RangeError("Trying to access beyond buffer length") } function k(t, r, e, n, i, o) { if (!f.isBuffer(t)) throw new TypeError('"buffer" argument must be a Buffer instance'); if (r > i || r < o) throw new RangeError('"value" argument is out of bounds'); if (e + n > t.length) throw new RangeError("Index out of range") } function N(t, r, e, n) { r < 0 && (r = 65535 + r + 1); for (var i = 0, o = Math.min(t.length - e, 2); i < o; ++i)t[e + i] = (r & 255 << 8 * (n ? i : 1 - i)) >>> 8 * (n ? i : 1 - i) } function z(t, r, e, n) { r < 0 && (r = 4294967295 + r + 1); for (var i = 0, o = Math.min(t.length - e, 4); i < o; ++i)t[e + i] = r >>> 8 * (n ? i : 3 - i) & 255 } function F(t, r, e, n, i, o) { if (e + n > t.length) throw new RangeError("Index out of range"); if (e < 0) throw new RangeError("Index out of range") } function j(t, r, n, i, o) { return o || F(t, r, n, 4, 3.4028234663852886e38, -3.4028234663852886e38), e.write(t, r, n, i, 23, 4), n + 4 } function q(t, r, n, i, o) { return o || F(t, r, n, 8, 1.7976931348623157e308, -1.7976931348623157e308), e.write(t, r, n, i, 52, 8), n + 8 } f.prototype.slice = function (t, r) { var e, n = this.length; if ((t = ~~t) < 0 ? (t += n) < 0 && (t = 0) : t > n && (t = n), (r = void 0 === r ? n : ~~r) < 0 ? (r += n) < 0 && (r = 0) : r > n && (r = n), r < t && (r = t), f.TYPED_ARRAY_SUPPORT) (e = this.subarray(t, r)).__proto__ = f.prototype; else { var i = r - t; e = new f(i, void 0); for (var o = 0; o < i; ++o)e[o] = this[o + t] } return e }, f.prototype.readUIntLE = function (t, r, e) { t |= 0, r |= 0, e || M(t, r, this.length); for (var n = this[t], i = 1, o = 0; ++o < r && (i *= 256);)n += this[t + o] * i; return n }, f.prototype.readUIntBE = function (t, r, e) { t |= 0, r |= 0, e || M(t, r, this.length); for (var n = this[t + --r], i = 1; r > 0 && (i *= 256);)n += this[t + --r] * i; return n }, f.prototype.readUInt8 = function (t, r) { return r || M(t, 1, this.length), this[t] }, f.prototype.readUInt16LE = function (t, r) { return r || M(t, 2, this.length), this[t] | this[t + 1] << 8 }, f.prototype.readUInt16BE = function (t, r) { return r || M(t, 2, this.length), this[t] << 8 | this[t + 1] }, f.prototype.readUInt32LE = function (t, r) { return r || M(t, 4, this.length), (this[t] | this[t + 1] << 8 | this[t + 2] << 16) + 16777216 * this[t + 3] }, f.prototype.readUInt32BE = function (t, r) { return r || M(t, 4, this.length), 16777216 * this[t] + (this[t + 1] << 16 | this[t + 2] << 8 | this[t + 3]) }, f.prototype.readIntLE = function (t, r, e) { t |= 0, r |= 0, e || M(t, r, this.length); for (var n = this[t], i = 1, o = 0; ++o < r && (i *= 256);)n += this[t + o] * i; return n >= (i *= 128) && (n -= Math.pow(2, 8 * r)), n }, f.prototype.readIntBE = function (t, r, e) { t |= 0, r |= 0, e || M(t, r, this.length); for (var n = r, i = 1, o = this[t + --n]; n > 0 && (i *= 256);)o += this[t + --n] * i; return o >= (i *= 128) && (o -= Math.pow(2, 8 * r)), o }, f.prototype.readInt8 = function (t, r) { return r || M(t, 1, this.length), 128 & this[t] ? -1 * (255 - this[t] + 1) : this[t] }, f.prototype.readInt16LE = function (t, r) { r || M(t, 2, this.length); var e = this[t] | this[t + 1] << 8; return 32768 & e ? 4294901760 | e : e }, f.prototype.readInt16BE = function (t, r) { r || M(t, 2, this.length); var e = this[t + 1] | this[t] << 8; return 32768 & e ? 4294901760 | e : e }, f.prototype.readInt32LE = function (t, r) { return r || M(t, 4, this.length), this[t] | this[t + 1] << 8 | this[t + 2] << 16 | this[t + 3] << 24 }, f.prototype.readInt32BE = function (t, r) { return r || M(t, 4, this.length), this[t] << 24 | this[t + 1] << 16 | this[t + 2] << 8 | this[t + 3] }, f.prototype.readFloatLE = function (t, r) { return r || M(t, 4, this.length), e.read(this, t, !0, 23, 4) }, f.prototype.readFloatBE = function (t, r) { return r || M(t, 4, this.length), e.read(this, t, !1, 23, 4) }, f.prototype.readDoubleLE = function (t, r) { return r || M(t, 8, this.length), e.read(this, t, !0, 52, 8) }, f.prototype.readDoubleBE = function (t, r) { return r || M(t, 8, this.length), e.read(this, t, !1, 52, 8) }, f.prototype.writeUIntLE = function (t, r, e, n) { (t = +t, r |= 0, e |= 0, n) || k(this, t, r, e, Math.pow(2, 8 * e) - 1, 0); var i = 1, o = 0; for (this[r] = 255 & t; ++o < e && (i *= 256);)this[r + o] = t / i & 255; return r + e }, f.prototype.writeUIntBE = function (t, r, e, n) { (t = +t, r |= 0, e |= 0, n) || k(this, t, r, e, Math.pow(2, 8 * e) - 1, 0); var i = e - 1, o = 1; for (this[r + i] = 255 & t; --i >= 0 && (o *= 256);)this[r + i] = t / o & 255; return r + e }, f.prototype.writeUInt8 = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 1, 255, 0), f.TYPED_ARRAY_SUPPORT || (t = Math.floor(t)), this[r] = 255 & t, r + 1 }, f.prototype.writeUInt16LE = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 2, 65535, 0), f.TYPED_ARRAY_SUPPORT ? (this[r] = 255 & t, this[r + 1] = t >>> 8) : N(this, t, r, !0), r + 2 }, f.prototype.writeUInt16BE = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 2, 65535, 0), f.TYPED_ARRAY_SUPPORT ? (this[r] = t >>> 8, this[r + 1] = 255 & t) : N(this, t, r, !1), r + 2 }, f.prototype.writeUInt32LE = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 4, 4294967295, 0), f.TYPED_ARRAY_SUPPORT ? (this[r + 3] = t >>> 24, this[r + 2] = t >>> 16, this[r + 1] = t >>> 8, this[r] = 255 & t) : z(this, t, r, !0), r + 4 }, f.prototype.writeUInt32BE = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 4, 4294967295, 0), f.TYPED_ARRAY_SUPPORT ? (this[r] = t >>> 24, this[r + 1] = t >>> 16, this[r + 2] = t >>> 8, this[r + 3] = 255 & t) : z(this, t, r, !1), r + 4 }, f.prototype.writeIntLE = function (t, r, e, n) { if (t = +t, r |= 0, !n) { var i = Math.pow(2, 8 * e - 1); k(this, t, r, e, i - 1, -i) } var o = 0, u = 1, f = 0; for (this[r] = 255 & t; ++o < e && (u *= 256);)t < 0 && 0 === f && 0 !== this[r + o - 1] && (f = 1), this[r + o] = (t / u >> 0) - f & 255; return r + e }, f.prototype.writeIntBE = function (t, r, e, n) { if (t = +t, r |= 0, !n) { var i = Math.pow(2, 8 * e - 1); k(this, t, r, e, i - 1, -i) } var o = e - 1, u = 1, f = 0; for (this[r + o] = 255 & t; --o >= 0 && (u *= 256);)t < 0 && 0 === f && 0 !== this[r + o + 1] && (f = 1), this[r + o] = (t / u >> 0) - f & 255; return r + e }, f.prototype.writeInt8 = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 1, 127, -128), f.TYPED_ARRAY_SUPPORT || (t = Math.floor(t)), t < 0 && (t = 255 + t + 1), this[r] = 255 & t, r + 1 }, f.prototype.writeInt16LE = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 2, 32767, -32768), f.TYPED_ARRAY_SUPPORT ? (this[r] = 255 & t, this[r + 1] = t >>> 8) : N(this, t, r, !0), r + 2 }, f.prototype.writeInt16BE = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 2, 32767, -32768), f.TYPED_ARRAY_SUPPORT ? (this[r] = t >>> 8, this[r + 1] = 255 & t) : N(this, t, r, !1), r + 2 }, f.prototype.writeInt32LE = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 4, 2147483647, -2147483648), f.TYPED_ARRAY_SUPPORT ? (this[r] = 255 & t, this[r + 1] = t >>> 8, this[r + 2] = t >>> 16, this[r + 3] = t >>> 24) : z(this, t, r, !0), r + 4 }, f.prototype.writeInt32BE = function (t, r, e) { return t = +t, r |= 0, e || k(this, t, r, 4, 2147483647, -2147483648), t < 0 && (t = 4294967295 + t + 1), f.TYPED_ARRAY_SUPPORT ? (this[r] = t >>> 24, this[r + 1] = t >>> 16, this[r + 2] = t >>> 8, this[r + 3] = 255 & t) : z(this, t, r, !1), r + 4 }, f.prototype.writeFloatLE = function (t, r, e) { return j(this, t, r, !0, e) }, f.prototype.writeFloatBE = function (t, r, e) { return j(this, t, r, !1, e) }, f.prototype.writeDoubleLE = function (t, r, e) { return q(this, t, r, !0, e) }, f.prototype.writeDoubleBE = function (t, r, e) { return q(this, t, r, !1, e) }, f.prototype.copy = function (t, r, e, n) { if (e || (e = 0), n || 0 === n || (n = this.length), r >= t.length && (r = t.length), r || (r = 0), n > 0 && n < e && (n = e), n === e) return 0; if (0 === t.length || 0 === this.length) return 0; if (r < 0) throw new RangeError("targetStart out of bounds"); if (e < 0 || e >= this.length) throw new RangeError("sourceStart out of bounds"); if (n < 0) throw new RangeError("sourceEnd out of bounds"); n > this.length && (n = this.length), t.length - r < n - e && (n = t.length - r + e); var i, o = n - e; if (this === t && e < r && r < n) for (i = o - 1; i >= 0; --i)t[i + r] = this[i + e]; else if (o < 1e3 || !f.TYPED_ARRAY_SUPPORT) for (i = 0; i < o; ++i)t[i + r] = this[i + e]; else Uint8Array.prototype.set.call(t, this.subarray(e, e + o), r); return o }, f.prototype.fill = function (t, r, e, n) { if ("string" == typeof t) { if ("string" == typeof r ? (n = r, r = 0, e = this.length) : "string" == typeof e && (n = e, e = this.length), 1 === t.length) { var i = t.charCodeAt(0); i < 256 && (t = i) } if (void 0 !== n && "string" != typeof n) throw new TypeError("encoding must be a string"); if ("string" == typeof n && !f.isEncoding(n)) throw new TypeError("Unknown encoding: " + n) } else "number" == typeof t && (t &= 255); if (r < 0 || this.length < r || this.length < e) throw new RangeError("Out of range index"); if (e <= r) return this; var o; if (r >>>= 0, e = void 0 === e ? this.length : e >>> 0, t || (t = 0), "number" == typeof t) for (o = r; o < e; ++o)this[o] = t; else { var u = f.isBuffer(t) ? t : $(new f(t, n).toString()), s = u.length; for (o = 0; o < e - r; ++o)this[o + r] = u[o % s] } return this }; var V = /[^+\/0-9A-Za-z-_]/g; function X(t) { if ((t = J(t).replace(V, "")).length < 2) return ""; for (; t.length % 4 != 0;)t += "="; return t } function J(t) { return t.trim ? t.trim() : t.replace(/^\s+|\s+$/g, "") } function Z(t) { return t < 16 ? "0" + t.toString(16) : t.toString(16) } function $(t, r) { var e; r = r || 1 / 0; for (var n = t.length, i = null, o = [], u = 0; u < n; ++u) { if ((e = t.charCodeAt(u)) > 55295 && e < 57344) { if (!i) { if (e > 56319) { (r -= 3) > -1 && o.push(239, 191, 189); continue } if (u + 1 === n) { (r -= 3) > -1 && o.push(239, 191, 189); continue } i = e; continue } if (e < 56320) { (r -= 3) > -1 && o.push(239, 191, 189), i = e; continue } e = 65536 + (i - 55296 << 10 | e - 56320) } else i && (r -= 3) > -1 && o.push(239, 191, 189); if (i = null, e < 128) { if ((r -= 1) < 0) break; o.push(e) } else if (e < 2048) { if ((r -= 2) < 0) break; o.push(e >> 6 | 192, 63 & e | 128) } else if (e < 65536) { if ((r -= 3) < 0) break; o.push(e >> 12 | 224, e >> 6 & 63 | 128, 63 & e | 128) } else { if (!(e < 1114112)) throw new Error("Invalid code point"); if ((r -= 4) < 0) break; o.push(e >> 18 | 240, e >> 12 & 63 | 128, e >> 6 & 63 | 128, 63 & e | 128) } } return o } function G(t) { for (var r = [], e = 0; e < t.length; ++e)r.push(255 & t.charCodeAt(e)); return r } function H(t, r) { for (var e, n, i, o = [], u = 0; u < t.length && !((r -= 2) < 0); ++u)n = (e = t.charCodeAt(u)) >> 8, i = e % 256, o.push(i), o.push(n); return o } function K(t) { return r.toByteArray(X(t)) } function Q(t, r, e, n) { for (var i = 0; i < n && !(i + e >= r.length || i >= t.length); ++i)r[i + e] = t[i]; return i } function W(t) { return t != t }
    }, { "base64-js": "yh9p", "ieee754": "JgNJ", "isarray": "REa7", "buffer": "dskh" }], "Q14w": [function (require, module, exports) {
        var Buffer = require("buffer").Buffer;
        var r = require("buffer").Buffer; function t(r) { return Array.isArray ? Array.isArray(r) : "[object Array]" === a(r) } function e(r) { return "boolean" == typeof r } function n(r) { return null === r } function o(r) { return null == r } function i(r) { return "number" == typeof r } function u(r) { return "string" == typeof r } function s(r) { return "symbol" == typeof r } function f(r) { return void 0 === r } function p(r) { return "[object RegExp]" === a(r) } function c(r) { return "object" == typeof r && null !== r } function l(r) { return "[object Date]" === a(r) } function y(r) { return "[object Error]" === a(r) || r instanceof Error } function x(r) { return "function" == typeof r } function b(r) { return null === r || "boolean" == typeof r || "number" == typeof r || "string" == typeof r || "symbol" == typeof r || void 0 === r } function a(r) { return Object.prototype.toString.call(r) } exports.isArray = t, exports.isBoolean = e, exports.isNull = n, exports.isNullOrUndefined = o, exports.isNumber = i, exports.isString = u, exports.isSymbol = s, exports.isUndefined = f, exports.isRegExp = p, exports.isObject = c, exports.isDate = l, exports.isError = y, exports.isFunction = x, exports.isPrimitive = b, exports.isBuffer = r.isBuffer;
    }, { "buffer": "dskh" }], "yM1o": [function (require, module, exports) {
        var global = arguments[3];
        var r = arguments[3]; function t(r, t) { if (e("noDeprecation")) return r; var n = !1; return function () { if (!n) { if (e("throwDeprecation")) throw new Error(t); e("traceDeprecation") ? console.trace(t) : console.warn(t), n = !0 } return r.apply(this, arguments) } } function e(t) { try { if (!r.localStorage) return !1 } catch (n) { return !1 } var e = r.localStorage[t]; return null != e && "true" === String(e).toLowerCase() } module.exports = t;
    }, {}], "38Wu": [function (require, module, exports) {

        var r = require("buffer"), e = r.Buffer; function n(r, e) { for (var n in r) e[n] = r[n] } function o(r, n, o) { return e(r, n, o) } e.from && e.alloc && e.allocUnsafe && e.allocUnsafeSlow ? module.exports = r : (n(r, exports), exports.Buffer = o), n(e, o), o.from = function (r, n, o) { if ("number" == typeof r) throw new TypeError("Argument must not be a number"); return e(r, n, o) }, o.alloc = function (r, n, o) { if ("number" != typeof r) throw new TypeError("Argument must be a number"); var f = e(r); return void 0 !== n ? "string" == typeof o ? f.fill(n, o) : f.fill(n) : f.fill(0), f }, o.allocUnsafe = function (r) { if ("number" != typeof r) throw new TypeError("Argument must be a number"); return e(r) }, o.allocUnsafeSlow = function (e) { if ("number" != typeof e) throw new TypeError("Argument must be a number"); return r.SlowBuffer(e) };
    }, { "buffer": "dskh" }], "GRUB": [function (require, module, exports) {
        "use strict"; var t = require("process-nextick-args"); function e(e, a) { var r = this, s = this._readableState && this._readableState.destroyed, d = this._writableState && this._writableState.destroyed; return s || d ? (a ? a(e) : !e || this._writableState && this._writableState.errorEmitted || t.nextTick(i, this, e), this) : (this._readableState && (this._readableState.destroyed = !0), this._writableState && (this._writableState.destroyed = !0), this._destroy(e || null, function (e) { !a && e ? (t.nextTick(i, r, e), r._writableState && (r._writableState.errorEmitted = !0)) : a && a(e) }), this) } function a() { this._readableState && (this._readableState.destroyed = !1, this._readableState.reading = !1, this._readableState.ended = !1, this._readableState.endEmitted = !1), this._writableState && (this._writableState.destroyed = !1, this._writableState.ended = !1, this._writableState.ending = !1, this._writableState.finished = !1, this._writableState.errorEmitted = !1) } function i(t, e) { t.emit("error", e) } module.exports = { destroy: e, undestroy: a };
    }, { "process-nextick-args": "Yj0v" }], "Hba+": [function (require, module, exports) {
        "use strict"; var e = require("process-nextick-args"), t = Object.keys || function (e) { var t = []; for (var r in e) t.push(r); return t }; module.exports = l; var r = require("core-util-is"); r.inherits = require("inherits"); var i = require("./_stream_readable"), a = require("./_stream_writable"); r.inherits(l, i); for (var o = t(a.prototype), s = 0; s < o.length; s++) { var n = o[s]; l.prototype[n] || (l.prototype[n] = a.prototype[n]) } function l(e) { if (!(this instanceof l)) return new l(e); i.call(this, e), a.call(this, e), e && !1 === e.readable && (this.readable = !1), e && !1 === e.writable && (this.writable = !1), this.allowHalfOpen = !0, e && !1 === e.allowHalfOpen && (this.allowHalfOpen = !1), this.once("end", h) } function h() { this.allowHalfOpen || this._writableState.ended || e.nextTick(d, this) } function d(e) { e.end() } Object.defineProperty(l.prototype, "writableHighWaterMark", { enumerable: !1, get: function () { return this._writableState.highWaterMark } }), Object.defineProperty(l.prototype, "destroyed", { get: function () { return void 0 !== this._readableState && void 0 !== this._writableState && (this._readableState.destroyed && this._writableState.destroyed) }, set: function (e) { void 0 !== this._readableState && void 0 !== this._writableState && (this._readableState.destroyed = e, this._writableState.destroyed = e) } }), l.prototype._destroy = function (t, r) { this.push(null), this.end(), e.nextTick(r, t) };
    }, { "process-nextick-args": "Yj0v", "core-util-is": "Q14w", "inherits": "4Bm0", "./_stream_readable": "DHrQ", "./_stream_writable": "WSyY" }], "WSyY": [function (require, module, exports) {
        var process = require("process");

        var global = arguments[3];
        var e = require("process"), t = arguments[3], n = require("process-nextick-args"); function r(e, t, n) { this.chunk = e, this.encoding = t, this.callback = n, this.next = null } function i(e) { var t = this; this.next = null, this.entry = null, this.finish = function () { W(t, e) } } module.exports = g; var o, s = !e.browser && ["v0.10", "v0.9."].indexOf(e.version.slice(0, 5)) > -1 ? setImmediate : n.nextTick; g.WritableState = y; var f = require("core-util-is"); f.inherits = require("inherits"); var u = { deprecate: require("util-deprecate") }, a = require("./internal/streams/stream"), c = require("safe-buffer").Buffer, d = t.Uint8Array || function () { }; function l(e) { return c.from(e) } function h(e) { return c.isBuffer(e) || e instanceof d } var b, p = require("./internal/streams/destroy"); function w() { } function y(e, t) { o = o || require("./_stream_duplex"), e = e || {}; var n = t instanceof o; this.objectMode = !!e.objectMode, n && (this.objectMode = this.objectMode || !!e.writableObjectMode); var r = e.highWaterMark, s = e.writableHighWaterMark, f = this.objectMode ? 16 : 16384; this.highWaterMark = r || 0 === r ? r : n && (s || 0 === s) ? s : f, this.highWaterMark = Math.floor(this.highWaterMark), this.finalCalled = !1, this.needDrain = !1, this.ending = !1, this.ended = !1, this.finished = !1, this.destroyed = !1; var u = !1 === e.decodeStrings; this.decodeStrings = !u, this.defaultEncoding = e.defaultEncoding || "utf8", this.length = 0, this.writing = !1, this.corked = 0, this.sync = !0, this.bufferProcessing = !1, this.onwrite = function (e) { S(t, e) }, this.writecb = null, this.writelen = 0, this.bufferedRequest = null, this.lastBufferedRequest = null, this.pendingcb = 0, this.prefinished = !1, this.errorEmitted = !1, this.bufferedRequestCount = 0, this.corkedRequestsFree = new i(this) } function g(e) { if (o = o || require("./_stream_duplex"), !(b.call(g, this) || this instanceof o)) return new g(e); this._writableState = new y(e, this), this.writable = !0, e && ("function" == typeof e.write && (this._write = e.write), "function" == typeof e.writev && (this._writev = e.writev), "function" == typeof e.destroy && (this._destroy = e.destroy), "function" == typeof e.final && (this._final = e.final)), a.call(this) } function k(e, t) { var r = new Error("write after end"); e.emit("error", r), n.nextTick(t, r) } function v(e, t, r, i) { var o = !0, s = !1; return null === r ? s = new TypeError("May not write null values to stream") : "string" == typeof r || void 0 === r || t.objectMode || (s = new TypeError("Invalid non-string/buffer chunk")), s && (e.emit("error", s), n.nextTick(i, s), o = !1), o } function q(e, t, n) { return e.objectMode || !1 === e.decodeStrings || "string" != typeof t || (t = c.from(t, n)), t } function _(e, t, n, r, i, o) { if (!n) { var s = q(t, r, i); r !== s && (n = !0, i = "buffer", r = s) } var f = t.objectMode ? 1 : r.length; t.length += f; var u = t.length < t.highWaterMark; if (u || (t.needDrain = !0), t.writing || t.corked) { var a = t.lastBufferedRequest; t.lastBufferedRequest = { chunk: r, encoding: i, isBuf: n, callback: o, next: null }, a ? a.next = t.lastBufferedRequest : t.bufferedRequest = t.lastBufferedRequest, t.bufferedRequestCount += 1 } else m(e, t, !1, f, r, i, o); return u } function m(e, t, n, r, i, o, s) { t.writelen = r, t.writecb = s, t.writing = !0, t.sync = !0, n ? e._writev(i, t.onwrite) : e._write(i, o, t.onwrite), t.sync = !1 } function x(e, t, r, i, o) { --t.pendingcb, r ? (n.nextTick(o, i), n.nextTick(T, e, t), e._writableState.errorEmitted = !0, e.emit("error", i)) : (o(i), e._writableState.errorEmitted = !0, e.emit("error", i), T(e, t)) } function R(e) { e.writing = !1, e.writecb = null, e.length -= e.writelen, e.writelen = 0 } function S(e, t) { var n = e._writableState, r = n.sync, i = n.writecb; if (R(n), t) x(e, n, r, t, i); else { var o = E(n); o || n.corked || n.bufferProcessing || !n.bufferedRequest || j(e, n), r ? s(M, e, n, o, i) : M(e, n, o, i) } } function M(e, t, n, r) { n || B(e, t), t.pendingcb-- , r(), T(e, t) } function B(e, t) { 0 === t.length && t.needDrain && (t.needDrain = !1, e.emit("drain")) } function j(e, t) { t.bufferProcessing = !0; var n = t.bufferedRequest; if (e._writev && n && n.next) { var r = t.bufferedRequestCount, o = new Array(r), s = t.corkedRequestsFree; s.entry = n; for (var f = 0, u = !0; n;)o[f] = n, n.isBuf || (u = !1), n = n.next, f += 1; o.allBuffers = u, m(e, t, !0, t.length, o, "", s.finish), t.pendingcb++ , t.lastBufferedRequest = null, s.next ? (t.corkedRequestsFree = s.next, s.next = null) : t.corkedRequestsFree = new i(t), t.bufferedRequestCount = 0 } else { for (; n;) { var a = n.chunk, c = n.encoding, d = n.callback; if (m(e, t, !1, t.objectMode ? 1 : a.length, a, c, d), n = n.next, t.bufferedRequestCount-- , t.writing) break } null === n && (t.lastBufferedRequest = null) } t.bufferedRequest = n, t.bufferProcessing = !1 } function E(e) { return e.ending && 0 === e.length && null === e.bufferedRequest && !e.finished && !e.writing } function C(e, t) { e._final(function (n) { t.pendingcb-- , n && e.emit("error", n), t.prefinished = !0, e.emit("prefinish"), T(e, t) }) } function P(e, t) { t.prefinished || t.finalCalled || ("function" == typeof e._final ? (t.pendingcb++ , t.finalCalled = !0, n.nextTick(C, e, t)) : (t.prefinished = !0, e.emit("prefinish"))) } function T(e, t) { var n = E(t); return n && (P(e, t), 0 === t.pendingcb && (t.finished = !0, e.emit("finish"))), n } function F(e, t, r) { t.ending = !0, T(e, t), r && (t.finished ? n.nextTick(r) : e.once("finish", r)), t.ended = !0, e.writable = !1 } function W(e, t, n) { var r = e.entry; for (e.entry = null; r;) { var i = r.callback; t.pendingcb-- , i(n), r = r.next } t.corkedRequestsFree ? t.corkedRequestsFree.next = e : t.corkedRequestsFree = e } f.inherits(g, a), y.prototype.getBuffer = function () { for (var e = this.bufferedRequest, t = []; e;)t.push(e), e = e.next; return t }, function () { try { Object.defineProperty(y.prototype, "buffer", { get: u.deprecate(function () { return this.getBuffer() }, "_writableState.buffer is deprecated. Use _writableState.getBuffer instead.", "DEP0003") }) } catch (e) { } }(), "function" == typeof Symbol && Symbol.hasInstance && "function" == typeof Function.prototype[Symbol.hasInstance] ? (b = Function.prototype[Symbol.hasInstance], Object.defineProperty(g, Symbol.hasInstance, { value: function (e) { return !!b.call(this, e) || this === g && (e && e._writableState instanceof y) } })) : b = function (e) { return e instanceof this }, g.prototype.pipe = function () { this.emit("error", new Error("Cannot pipe, not readable")) }, g.prototype.write = function (e, t, n) { var r = this._writableState, i = !1, o = !r.objectMode && h(e); return o && !c.isBuffer(e) && (e = l(e)), "function" == typeof t && (n = t, t = null), o ? t = "buffer" : t || (t = r.defaultEncoding), "function" != typeof n && (n = w), r.ended ? k(this, n) : (o || v(this, r, e, n)) && (r.pendingcb++ , i = _(this, r, o, e, t, n)), i }, g.prototype.cork = function () { this._writableState.corked++ }, g.prototype.uncork = function () { var e = this._writableState; e.corked && (e.corked-- , e.writing || e.corked || e.finished || e.bufferProcessing || !e.bufferedRequest || j(this, e)) }, g.prototype.setDefaultEncoding = function (e) { if ("string" == typeof e && (e = e.toLowerCase()), !(["hex", "utf8", "utf-8", "ascii", "binary", "base64", "ucs2", "ucs-2", "utf16le", "utf-16le", "raw"].indexOf((e + "").toLowerCase()) > -1)) throw new TypeError("Unknown encoding: " + e); return this._writableState.defaultEncoding = e, this }, Object.defineProperty(g.prototype, "writableHighWaterMark", { enumerable: !1, get: function () { return this._writableState.highWaterMark } }), g.prototype._write = function (e, t, n) { n(new Error("_write() is not implemented")) }, g.prototype._writev = null, g.prototype.end = function (e, t, n) { var r = this._writableState; "function" == typeof e ? (n = e, e = null, t = null) : "function" == typeof t && (n = t, t = null), null != e && this.write(e, t), r.corked && (r.corked = 1, this.uncork()), r.ending || r.finished || F(this, r, n) }, Object.defineProperty(g.prototype, "destroyed", { get: function () { return void 0 !== this._writableState && this._writableState.destroyed }, set: function (e) { this._writableState && (this._writableState.destroyed = e) } }), g.prototype.destroy = p.destroy, g.prototype._undestroy = p.undestroy, g.prototype._destroy = function (e, t) { this.end(), t(e) };
    }, { "process-nextick-args": "Yj0v", "core-util-is": "Q14w", "inherits": "4Bm0", "util-deprecate": "yM1o", "./internal/streams/stream": "E9dt", "safe-buffer": "38Wu", "./internal/streams/destroy": "GRUB", "./_stream_duplex": "Hba+", "process": "pBGv" }], "LnjZ": [function (require, module, exports) {
        module.exports = require("./lib/_stream_writable.js");
    }, { "./lib/_stream_writable.js": "WSyY" }], "kT1X": [function (require, module, exports) {
        module.exports = require("./lib/_stream_duplex.js");
    }, { "./lib/_stream_duplex.js": "Hba+" }], "A9/K": [function (require, module, exports) {
        module.exports = require("./readable").Transform;
    }, { "./readable": "tzeh" }], "C6nS": [function (require, module, exports) {
        module.exports = require("./readable").PassThrough;
    }, { "./readable": "tzeh" }], "fnRj": [function (require, module, exports) {
        module.exports = n; var e = require("events").EventEmitter, r = require("inherits"); function n() { e.call(this) } r(n, e), n.Readable = require("readable-stream/readable.js"), n.Writable = require("readable-stream/writable.js"), n.Duplex = require("readable-stream/duplex.js"), n.Transform = require("readable-stream/transform.js"), n.PassThrough = require("readable-stream/passthrough.js"), n.Stream = n, n.prototype.pipe = function (r, n) { var o = this; function t(e) { r.writable && !1 === r.write(e) && o.pause && o.pause() } function s() { o.readable && o.resume && o.resume() } o.on("data", t), r.on("drain", s), r._isStdio || n && !1 === n.end || (o.on("end", a), o.on("close", u)); var i = !1; function a() { i || (i = !0, r.end()) } function u() { i || (i = !0, "function" == typeof r.destroy && r.destroy()) } function d(r) { if (l(), 0 === e.listenerCount(this, "error")) throw r } function l() { o.removeListener("data", t), r.removeListener("drain", s), o.removeListener("end", a), o.removeListener("close", u), o.removeListener("error", d), r.removeListener("error", d), o.removeListener("end", l), o.removeListener("close", l), r.removeListener("close", l) } return o.on("error", d), r.on("error", d), o.on("end", l), o.on("close", l), r.on("close", l), r.emit("pipe", o), r };
    }, { "events": "FRpO", "inherits": "4Bm0", "readable-stream/readable.js": "tzeh", "readable-stream/writable.js": "LnjZ", "readable-stream/duplex.js": "kT1X", "readable-stream/transform.js": "A9/K", "readable-stream/passthrough.js": "C6nS" }], "E9dt": [function (require, module, exports) {
        module.exports = require("stream");
    }, { "stream": "fnRj" }], "70rD": [function (require, module, exports) {

    }, {}], "wl+m": [function (require, module, exports) {

        "use strict"; function t(t, n) { if (!(t instanceof n)) throw new TypeError("Cannot call a class as a function") } var n = require("safe-buffer").Buffer, e = require("util"); function i(t, n, e) { t.copy(n, e) } module.exports = function () { function e() { t(this, e), this.head = null, this.tail = null, this.length = 0 } return e.prototype.push = function (t) { var n = { data: t, next: null }; this.length > 0 ? this.tail.next = n : this.head = n, this.tail = n, ++this.length }, e.prototype.unshift = function (t) { var n = { data: t, next: this.head }; 0 === this.length && (this.tail = n), this.head = n, ++this.length }, e.prototype.shift = function () { if (0 !== this.length) { var t = this.head.data; return 1 === this.length ? this.head = this.tail = null : this.head = this.head.next, --this.length, t } }, e.prototype.clear = function () { this.head = this.tail = null, this.length = 0 }, e.prototype.join = function (t) { if (0 === this.length) return ""; for (var n = this.head, e = "" + n.data; n = n.next;)e += t + n.data; return e }, e.prototype.concat = function (t) { if (0 === this.length) return n.alloc(0); if (1 === this.length) return this.head.data; for (var e = n.allocUnsafe(t >>> 0), h = this.head, a = 0; h;)i(h.data, e, a), a += h.data.length, h = h.next; return e }, e }(), e && e.inspect && e.inspect.custom && (module.exports.prototype[e.inspect.custom] = function () { var t = e.inspect({ length: this.length }); return this.constructor.name + " " + t });
    }, { "safe-buffer": "38Wu", "util": "70rD" }], "z0rv": [function (require, module, exports) {

        "use strict"; var t = require("safe-buffer").Buffer, e = t.isEncoding || function (t) { switch ((t = "" + t) && t.toLowerCase()) { case "hex": case "utf8": case "utf-8": case "ascii": case "binary": case "base64": case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": case "raw": return !0; default: return !1 } }; function s(t) { if (!t) return "utf8"; for (var e; ;)switch (t) { case "utf8": case "utf-8": return "utf8"; case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": return "utf16le"; case "latin1": case "binary": return "latin1"; case "base64": case "ascii": case "hex": return t; default: if (e) return; t = ("" + t).toLowerCase(), e = !0 } } function i(i) { var a = s(i); if ("string" != typeof a && (t.isEncoding === e || !e(i))) throw new Error("Unknown encoding: " + i); return a || i } function a(e) { var s; switch (this.encoding = i(e), this.encoding) { case "utf16le": this.text = c, this.end = f, s = 4; break; case "utf8": this.fillLast = l, s = 4; break; case "base64": this.text = d, this.end = g, s = 3; break; default: return this.write = N, void (this.end = v) }this.lastNeed = 0, this.lastTotal = 0, this.lastChar = t.allocUnsafe(s) } function r(t) { return t <= 127 ? 0 : t >> 5 == 6 ? 2 : t >> 4 == 14 ? 3 : t >> 3 == 30 ? 4 : t >> 6 == 2 ? -1 : -2 } function n(t, e, s) { var i = e.length - 1; if (i < s) return 0; var a = r(e[i]); return a >= 0 ? (a > 0 && (t.lastNeed = a - 1), a) : --i < s || -2 === a ? 0 : (a = r(e[i])) >= 0 ? (a > 0 && (t.lastNeed = a - 2), a) : --i < s || -2 === a ? 0 : (a = r(e[i])) >= 0 ? (a > 0 && (2 === a ? a = 0 : t.lastNeed = a - 3), a) : 0 } function h(t, e, s) { if (128 != (192 & e[0])) return t.lastNeed = 0, "�"; if (t.lastNeed > 1 && e.length > 1) { if (128 != (192 & e[1])) return t.lastNeed = 1, "�"; if (t.lastNeed > 2 && e.length > 2 && 128 != (192 & e[2])) return t.lastNeed = 2, "�" } } function l(t) { var e = this.lastTotal - this.lastNeed, s = h(this, t, e); return void 0 !== s ? s : this.lastNeed <= t.length ? (t.copy(this.lastChar, e, 0, this.lastNeed), this.lastChar.toString(this.encoding, 0, this.lastTotal)) : (t.copy(this.lastChar, e, 0, t.length), void (this.lastNeed -= t.length)) } function u(t, e) { var s = n(this, t, e); if (!this.lastNeed) return t.toString("utf8", e); this.lastTotal = s; var i = t.length - (s - this.lastNeed); return t.copy(this.lastChar, 0, i), t.toString("utf8", e, i) } function o(t) { var e = t && t.length ? this.write(t) : ""; return this.lastNeed ? e + "�" : e } function c(t, e) { if ((t.length - e) % 2 == 0) { var s = t.toString("utf16le", e); if (s) { var i = s.charCodeAt(s.length - 1); if (i >= 55296 && i <= 56319) return this.lastNeed = 2, this.lastTotal = 4, this.lastChar[0] = t[t.length - 2], this.lastChar[1] = t[t.length - 1], s.slice(0, -1) } return s } return this.lastNeed = 1, this.lastTotal = 2, this.lastChar[0] = t[t.length - 1], t.toString("utf16le", e, t.length - 1) } function f(t) { var e = t && t.length ? this.write(t) : ""; if (this.lastNeed) { var s = this.lastTotal - this.lastNeed; return e + this.lastChar.toString("utf16le", 0, s) } return e } function d(t, e) { var s = (t.length - e) % 3; return 0 === s ? t.toString("base64", e) : (this.lastNeed = 3 - s, this.lastTotal = 3, 1 === s ? this.lastChar[0] = t[t.length - 1] : (this.lastChar[0] = t[t.length - 2], this.lastChar[1] = t[t.length - 1]), t.toString("base64", e, t.length - s)) } function g(t) { var e = t && t.length ? this.write(t) : ""; return this.lastNeed ? e + this.lastChar.toString("base64", 0, 3 - this.lastNeed) : e } function N(t) { return t.toString(this.encoding) } function v(t) { return t && t.length ? this.write(t) : "" } exports.StringDecoder = a, a.prototype.write = function (t) { if (0 === t.length) return ""; var e, s; if (this.lastNeed) { if (void 0 === (e = this.fillLast(t))) return ""; s = this.lastNeed, this.lastNeed = 0 } else s = 0; return s < t.length ? e ? e + this.text(t, s) : this.text(t, s) : e || "" }, a.prototype.end = o, a.prototype.text = u, a.prototype.fillLast = function (t) { if (this.lastNeed <= t.length) return t.copy(this.lastChar, this.lastTotal - this.lastNeed, 0, this.lastNeed), this.lastChar.toString(this.encoding, 0, this.lastTotal); t.copy(this.lastChar, this.lastTotal - this.lastNeed, 0, t.length), this.lastNeed -= t.length };
    }, { "safe-buffer": "38Wu" }], "DHrQ": [function (require, module, exports) {

        var global = arguments[3];
        var process = require("process");
        var e = arguments[3], t = require("process"), n = require("process-nextick-args"); module.exports = _; var r, i = require("isarray"); _.ReadableState = w; var a = require("events").EventEmitter, d = function (e, t) { return e.listeners(t).length }, o = require("./internal/streams/stream"), s = require("safe-buffer").Buffer, u = e.Uint8Array || function () { }; function l(e) { return s.from(e) } function h(e) { return s.isBuffer(e) || e instanceof u } var p = require("core-util-is"); p.inherits = require("inherits"); var f = require("util"), c = void 0; c = f && f.debuglog ? f.debuglog("stream") : function () { }; var g, b = require("./internal/streams/BufferList"), m = require("./internal/streams/destroy"); p.inherits(_, o); var v = ["error", "close", "destroy", "pause", "resume"]; function y(e, t, n) { if ("function" == typeof e.prependListener) return e.prependListener(t, n); e._events && e._events[t] ? i(e._events[t]) ? e._events[t].unshift(n) : e._events[t] = [n, e._events[t]] : e.on(t, n) } function w(e, t) { e = e || {}; var n = t instanceof (r = r || require("./_stream_duplex")); this.objectMode = !!e.objectMode, n && (this.objectMode = this.objectMode || !!e.readableObjectMode); var i = e.highWaterMark, a = e.readableHighWaterMark, d = this.objectMode ? 16 : 16384; this.highWaterMark = i || 0 === i ? i : n && (a || 0 === a) ? a : d, this.highWaterMark = Math.floor(this.highWaterMark), this.buffer = new b, this.length = 0, this.pipes = null, this.pipesCount = 0, this.flowing = null, this.ended = !1, this.endEmitted = !1, this.reading = !1, this.sync = !0, this.needReadable = !1, this.emittedReadable = !1, this.readableListening = !1, this.resumeScheduled = !1, this.destroyed = !1, this.defaultEncoding = e.defaultEncoding || "utf8", this.awaitDrain = 0, this.readingMore = !1, this.decoder = null, this.encoding = null, e.encoding && (g || (g = require("string_decoder/").StringDecoder), this.decoder = new g(e.encoding), this.encoding = e.encoding) } function _(e) { if (r = r || require("./_stream_duplex"), !(this instanceof _)) return new _(e); this._readableState = new w(e, this), this.readable = !0, e && ("function" == typeof e.read && (this._read = e.read), "function" == typeof e.destroy && (this._destroy = e.destroy)), o.call(this) } function M(e, t, n, r, i) { var a, d = e._readableState; null === t ? (d.reading = !1, x(e, d)) : (i || (a = k(d, t)), a ? e.emit("error", a) : d.objectMode || t && t.length > 0 ? ("string" == typeof t || d.objectMode || Object.getPrototypeOf(t) === s.prototype || (t = l(t)), r ? d.endEmitted ? e.emit("error", new Error("stream.unshift() after end event")) : S(e, d, t, !0) : d.ended ? e.emit("error", new Error("stream.push() after EOF")) : (d.reading = !1, d.decoder && !n ? (t = d.decoder.write(t), d.objectMode || 0 !== t.length ? S(e, d, t, !1) : C(e, d)) : S(e, d, t, !1))) : r || (d.reading = !1)); return j(d) } function S(e, t, n, r) { t.flowing && 0 === t.length && !t.sync ? (e.emit("data", n), e.read(0)) : (t.length += t.objectMode ? 1 : n.length, r ? t.buffer.unshift(n) : t.buffer.push(n), t.needReadable && q(e)), C(e, t) } function k(e, t) { var n; return h(t) || "string" == typeof t || void 0 === t || e.objectMode || (n = new TypeError("Invalid non-string/buffer chunk")), n } function j(e) { return !e.ended && (e.needReadable || e.length < e.highWaterMark || 0 === e.length) } Object.defineProperty(_.prototype, "destroyed", { get: function () { return void 0 !== this._readableState && this._readableState.destroyed }, set: function (e) { this._readableState && (this._readableState.destroyed = e) } }), _.prototype.destroy = m.destroy, _.prototype._undestroy = m.undestroy, _.prototype._destroy = function (e, t) { this.push(null), t(e) }, _.prototype.push = function (e, t) { var n, r = this._readableState; return r.objectMode ? n = !0 : "string" == typeof e && ((t = t || r.defaultEncoding) !== r.encoding && (e = s.from(e, t), t = ""), n = !0), M(this, e, t, !1, n) }, _.prototype.unshift = function (e) { return M(this, e, null, !0, !1) }, _.prototype.isPaused = function () { return !1 === this._readableState.flowing }, _.prototype.setEncoding = function (e) { return g || (g = require("string_decoder/").StringDecoder), this._readableState.decoder = new g(e), this._readableState.encoding = e, this }; var R = 8388608; function E(e) { return e >= R ? e = R : (e-- , e |= e >>> 1, e |= e >>> 2, e |= e >>> 4, e |= e >>> 8, e |= e >>> 16, e++), e } function L(e, t) { return e <= 0 || 0 === t.length && t.ended ? 0 : t.objectMode ? 1 : e != e ? t.flowing && t.length ? t.buffer.head.data.length : t.length : (e > t.highWaterMark && (t.highWaterMark = E(e)), e <= t.length ? e : t.ended ? t.length : (t.needReadable = !0, 0)) } function x(e, t) { if (!t.ended) { if (t.decoder) { var n = t.decoder.end(); n && n.length && (t.buffer.push(n), t.length += t.objectMode ? 1 : n.length) } t.ended = !0, q(e) } } function q(e) { var t = e._readableState; t.needReadable = !1, t.emittedReadable || (c("emitReadable", t.flowing), t.emittedReadable = !0, t.sync ? n.nextTick(W, e) : W(e)) } function W(e) { c("emit readable"), e.emit("readable"), B(e) } function C(e, t) { t.readingMore || (t.readingMore = !0, n.nextTick(D, e, t)) } function D(e, t) { for (var n = t.length; !t.reading && !t.flowing && !t.ended && t.length < t.highWaterMark && (c("maybeReadMore read 0"), e.read(0), n !== t.length);)n = t.length; t.readingMore = !1 } function O(e) { return function () { var t = e._readableState; c("pipeOnDrain", t.awaitDrain), t.awaitDrain && t.awaitDrain-- , 0 === t.awaitDrain && d(e, "data") && (t.flowing = !0, B(e)) } } function T(e) { c("readable nexttick read 0"), e.read(0) } function U(e, t) { t.resumeScheduled || (t.resumeScheduled = !0, n.nextTick(P, e, t)) } function P(e, t) { t.reading || (c("resume read 0"), e.read(0)), t.resumeScheduled = !1, t.awaitDrain = 0, e.emit("resume"), B(e), t.flowing && !t.reading && e.read(0) } function B(e) { var t = e._readableState; for (c("flow", t.flowing); t.flowing && null !== e.read();); } function H(e, t) { return 0 === t.length ? null : (t.objectMode ? n = t.buffer.shift() : !e || e >= t.length ? (n = t.decoder ? t.buffer.join("") : 1 === t.buffer.length ? t.buffer.head.data : t.buffer.concat(t.length), t.buffer.clear()) : n = I(e, t.buffer, t.decoder), n); var n } function I(e, t, n) { var r; return e < t.head.data.length ? (r = t.head.data.slice(0, e), t.head.data = t.head.data.slice(e)) : r = e === t.head.data.length ? t.shift() : n ? A(e, t) : F(e, t), r } function A(e, t) { var n = t.head, r = 1, i = n.data; for (e -= i.length; n = n.next;) { var a = n.data, d = e > a.length ? a.length : e; if (d === a.length ? i += a : i += a.slice(0, e), 0 === (e -= d)) { d === a.length ? (++r, n.next ? t.head = n.next : t.head = t.tail = null) : (t.head = n, n.data = a.slice(d)); break } ++r } return t.length -= r, i } function F(e, t) { var n = s.allocUnsafe(e), r = t.head, i = 1; for (r.data.copy(n), e -= r.data.length; r = r.next;) { var a = r.data, d = e > a.length ? a.length : e; if (a.copy(n, n.length - e, 0, d), 0 === (e -= d)) { d === a.length ? (++i, r.next ? t.head = r.next : t.head = t.tail = null) : (t.head = r, r.data = a.slice(d)); break } ++i } return t.length -= i, n } function z(e) { var t = e._readableState; if (t.length > 0) throw new Error('"endReadable()" called on non-empty stream'); t.endEmitted || (t.ended = !0, n.nextTick(G, t, e)) } function G(e, t) { e.endEmitted || 0 !== e.length || (e.endEmitted = !0, t.readable = !1, t.emit("end")) } function J(e, t) { for (var n = 0, r = e.length; n < r; n++)if (e[n] === t) return n; return -1 } _.prototype.read = function (e) { c("read", e), e = parseInt(e, 10); var t = this._readableState, n = e; if (0 !== e && (t.emittedReadable = !1), 0 === e && t.needReadable && (t.length >= t.highWaterMark || t.ended)) return c("read: emitReadable", t.length, t.ended), 0 === t.length && t.ended ? z(this) : q(this), null; if (0 === (e = L(e, t)) && t.ended) return 0 === t.length && z(this), null; var r, i = t.needReadable; return c("need readable", i), (0 === t.length || t.length - e < t.highWaterMark) && c("length less than watermark", i = !0), t.ended || t.reading ? c("reading or ended", i = !1) : i && (c("do read"), t.reading = !0, t.sync = !0, 0 === t.length && (t.needReadable = !0), this._read(t.highWaterMark), t.sync = !1, t.reading || (e = L(n, t))), null === (r = e > 0 ? H(e, t) : null) ? (t.needReadable = !0, e = 0) : t.length -= e, 0 === t.length && (t.ended || (t.needReadable = !0), n !== e && t.ended && z(this)), null !== r && this.emit("data", r), r }, _.prototype._read = function (e) { this.emit("error", new Error("_read() is not implemented")) }, _.prototype.pipe = function (e, r) { var i = this, a = this._readableState; switch (a.pipesCount) { case 0: a.pipes = e; break; case 1: a.pipes = [a.pipes, e]; break; default: a.pipes.push(e) }a.pipesCount += 1, c("pipe count=%d opts=%j", a.pipesCount, r); var o = (!r || !1 !== r.end) && e !== t.stdout && e !== t.stderr ? u : v; function s(t, n) { c("onunpipe"), t === i && n && !1 === n.hasUnpiped && (n.hasUnpiped = !0, c("cleanup"), e.removeListener("close", b), e.removeListener("finish", m), e.removeListener("drain", l), e.removeListener("error", g), e.removeListener("unpipe", s), i.removeListener("end", u), i.removeListener("end", v), i.removeListener("data", f), h = !0, !a.awaitDrain || e._writableState && !e._writableState.needDrain || l()) } function u() { c("onend"), e.end() } a.endEmitted ? n.nextTick(o) : i.once("end", o), e.on("unpipe", s); var l = O(i); e.on("drain", l); var h = !1; var p = !1; function f(t) { c("ondata"), p = !1, !1 !== e.write(t) || p || ((1 === a.pipesCount && a.pipes === e || a.pipesCount > 1 && -1 !== J(a.pipes, e)) && !h && (c("false write response, pause", i._readableState.awaitDrain), i._readableState.awaitDrain++ , p = !0), i.pause()) } function g(t) { c("onerror", t), v(), e.removeListener("error", g), 0 === d(e, "error") && e.emit("error", t) } function b() { e.removeListener("finish", m), v() } function m() { c("onfinish"), e.removeListener("close", b), v() } function v() { c("unpipe"), i.unpipe(e) } return i.on("data", f), y(e, "error", g), e.once("close", b), e.once("finish", m), e.emit("pipe", i), a.flowing || (c("pipe resume"), i.resume()), e }, _.prototype.unpipe = function (e) { var t = this._readableState, n = { hasUnpiped: !1 }; if (0 === t.pipesCount) return this; if (1 === t.pipesCount) return e && e !== t.pipes ? this : (e || (e = t.pipes), t.pipes = null, t.pipesCount = 0, t.flowing = !1, e && e.emit("unpipe", this, n), this); if (!e) { var r = t.pipes, i = t.pipesCount; t.pipes = null, t.pipesCount = 0, t.flowing = !1; for (var a = 0; a < i; a++)r[a].emit("unpipe", this, n); return this } var d = J(t.pipes, e); return -1 === d ? this : (t.pipes.splice(d, 1), t.pipesCount -= 1, 1 === t.pipesCount && (t.pipes = t.pipes[0]), e.emit("unpipe", this, n), this) }, _.prototype.on = function (e, t) { var r = o.prototype.on.call(this, e, t); if ("data" === e) !1 !== this._readableState.flowing && this.resume(); else if ("readable" === e) { var i = this._readableState; i.endEmitted || i.readableListening || (i.readableListening = i.needReadable = !0, i.emittedReadable = !1, i.reading ? i.length && q(this) : n.nextTick(T, this)) } return r }, _.prototype.addListener = _.prototype.on, _.prototype.resume = function () { var e = this._readableState; return e.flowing || (c("resume"), e.flowing = !0, U(this, e)), this }, _.prototype.pause = function () { return c("call pause flowing=%j", this._readableState.flowing), !1 !== this._readableState.flowing && (c("pause"), this._readableState.flowing = !1, this.emit("pause")), this }, _.prototype.wrap = function (e) { var t = this, n = this._readableState, r = !1; for (var i in e.on("end", function () { if (c("wrapped end"), n.decoder && !n.ended) { var e = n.decoder.end(); e && e.length && t.push(e) } t.push(null) }), e.on("data", function (i) { (c("wrapped data"), n.decoder && (i = n.decoder.write(i)), n.objectMode && null == i) || (n.objectMode || i && i.length) && (t.push(i) || (r = !0, e.pause())) }), e) void 0 === this[i] && "function" == typeof e[i] && (this[i] = function (t) { return function () { return e[t].apply(e, arguments) } }(i)); for (var a = 0; a < v.length; a++)e.on(v[a], this.emit.bind(this, v[a])); return this._read = function (t) { c("wrapped _read", t), r && (r = !1, e.resume()) }, this }, Object.defineProperty(_.prototype, "readableHighWaterMark", { enumerable: !1, get: function () { return this._readableState.highWaterMark } }), _._fromList = H;
    }, { "process-nextick-args": "Yj0v", "isarray": "REa7", "events": "FRpO", "./internal/streams/stream": "E9dt", "safe-buffer": "38Wu", "core-util-is": "Q14w", "inherits": "4Bm0", "util": "70rD", "./internal/streams/BufferList": "wl+m", "./internal/streams/destroy": "GRUB", "./_stream_duplex": "Hba+", "string_decoder/": "z0rv", "process": "pBGv" }], "7tlB": [function (require, module, exports) {
        "use strict"; module.exports = n; var t = require("./_stream_duplex"), r = require("core-util-is"); function e(t, r) { var e = this._transformState; e.transforming = !1; var n = e.writecb; if (!n) return this.emit("error", new Error("write callback called multiple times")); e.writechunk = null, e.writecb = null, null != r && this.push(r), n(t); var i = this._readableState; i.reading = !1, (i.needReadable || i.length < i.highWaterMark) && this._read(i.highWaterMark) } function n(r) { if (!(this instanceof n)) return new n(r); t.call(this, r), this._transformState = { afterTransform: e.bind(this), needTransform: !1, transforming: !1, writecb: null, writechunk: null, writeencoding: null }, this._readableState.needReadable = !0, this._readableState.sync = !1, r && ("function" == typeof r.transform && (this._transform = r.transform), "function" == typeof r.flush && (this._flush = r.flush)), this.on("prefinish", i) } function i() { var t = this; "function" == typeof this._flush ? this._flush(function (r, e) { a(t, r, e) }) : a(this, null, null) } function a(t, r, e) { if (r) return t.emit("error", r); if (null != e && t.push(e), t._writableState.length) throw new Error("Calling transform done when ws.length != 0"); if (t._transformState.transforming) throw new Error("Calling transform done when still transforming"); return t.push(null) } r.inherits = require("inherits"), r.inherits(n, t), n.prototype.push = function (r, e) { return this._transformState.needTransform = !1, t.prototype.push.call(this, r, e) }, n.prototype._transform = function (t, r, e) { throw new Error("_transform() is not implemented") }, n.prototype._write = function (t, r, e) { var n = this._transformState; if (n.writecb = e, n.writechunk = t, n.writeencoding = r, !n.transforming) { var i = this._readableState; (n.needTransform || i.needReadable || i.length < i.highWaterMark) && this._read(i.highWaterMark) } }, n.prototype._read = function (t) { var r = this._transformState; null !== r.writechunk && r.writecb && !r.transforming ? (r.transforming = !0, this._transform(r.writechunk, r.writeencoding, r.afterTransform)) : r.needTransform = !0 }, n.prototype._destroy = function (r, e) { var n = this; t.prototype._destroy.call(this, r, function (t) { e(t), n.emit("close") }) };
    }, { "./_stream_duplex": "Hba+", "core-util-is": "Q14w", "inherits": "4Bm0" }], "nwyA": [function (require, module, exports) {
        "use strict"; module.exports = i; var r = require("./_stream_transform"), e = require("core-util-is"); function i(e) { if (!(this instanceof i)) return new i(e); r.call(this, e) } e.inherits = require("inherits"), e.inherits(i, r), i.prototype._transform = function (r, e, i) { i(null, r) };
    }, { "./_stream_transform": "7tlB", "core-util-is": "Q14w", "inherits": "4Bm0" }], "tzeh": [function (require, module, exports) {
        exports = module.exports = require("./lib/_stream_readable.js"), exports.Stream = exports, exports.Readable = exports, exports.Writable = require("./lib/_stream_writable.js"), exports.Duplex = require("./lib/_stream_duplex.js"), exports.Transform = require("./lib/_stream_transform.js"), exports.PassThrough = require("./lib/_stream_passthrough.js");
    }, { "./lib/_stream_readable.js": "DHrQ", "./lib/_stream_writable.js": "WSyY", "./lib/_stream_duplex.js": "Hba+", "./lib/_stream_transform.js": "7tlB", "./lib/_stream_passthrough.js": "nwyA" }], "Ux+i": [function (require, module, exports) {
        var process = require("process");
        var Buffer = require("buffer").Buffer;
        var global = arguments[3];
        var e = require("process"), r = require("buffer").Buffer, t = arguments[3], s = require("./capability"), a = require("inherits"), o = require("readable-stream"), n = exports.readyStates = { UNSENT: 0, OPENED: 1, HEADERS_RECEIVED: 2, LOADING: 3, DONE: 4 }, u = exports.IncomingMessage = function (a, n, u, i) { var c = this; if (o.Readable.call(c), c._mode = u, c.headers = {}, c.rawHeaders = [], c.trailers = {}, c.rawTrailers = [], c.on("end", function () { e.nextTick(function () { c.emit("close") }) }), "fetch" === u) { if (c._fetchResponse = n, c.url = n.url, c.statusCode = n.status, c.statusMessage = n.statusText, n.headers.forEach(function (e, r) { c.headers[r.toLowerCase()] = e, c.rawHeaders.push(r, e) }), s.writableStream) { var d = new WritableStream({ write: function (e) { return new Promise(function (t, s) { c._destroyed ? s() : c.push(new r(e)) ? t() : c._resumeFetch = t }) }, close: function () { t.clearTimeout(i), c._destroyed || c.push(null) }, abort: function (e) { c._destroyed || c.emit("error", e) } }); try { return void n.body.pipeTo(d).catch(function (e) { t.clearTimeout(i), c._destroyed || c.emit("error", e) }) } catch (p) { } } var h = n.body.getReader(); !function e() { h.read().then(function (s) { if (!c._destroyed) { if (s.done) return t.clearTimeout(i), void c.push(null); c.push(new r(s.value)), e() } }).catch(function (e) { t.clearTimeout(i), c._destroyed || c.emit("error", e) }) }() } else { if (c._xhr = a, c._pos = 0, c.url = a.responseURL, c.statusCode = a.status, c.statusMessage = a.statusText, a.getAllResponseHeaders().split(/\r?\n/).forEach(function (e) { var r = e.match(/^([^:]+):\s*(.*)/); if (r) { var t = r[1].toLowerCase(); "set-cookie" === t ? (void 0 === c.headers[t] && (c.headers[t] = []), c.headers[t].push(r[2])) : void 0 !== c.headers[t] ? c.headers[t] += ", " + r[2] : c.headers[t] = r[2], c.rawHeaders.push(r[1], r[2]) } }), c._charset = "x-user-defined", !s.overrideMimeType) { var f = c.rawHeaders["mime-type"]; if (f) { var l = f.match(/;\s*charset=([^;])(;|$)/); l && (c._charset = l[1].toLowerCase()) } c._charset || (c._charset = "utf-8") } } }; a(u, o.Readable), u.prototype._read = function () { var e = this._resumeFetch; e && (this._resumeFetch = null, e()) }, u.prototype._onXHRProgress = function () { var e = this, s = e._xhr, a = null; switch (e._mode) { case "text:vbarray": if (s.readyState !== n.DONE) break; try { a = new t.VBArray(s.responseBody).toArray() } catch (d) { } if (null !== a) { e.push(new r(a)); break } case "text": try { a = s.responseText } catch (d) { e._mode = "text:vbarray"; break } if (a.length > e._pos) { var o = a.substr(e._pos); if ("x-user-defined" === e._charset) { for (var u = new r(o.length), i = 0; i < o.length; i++)u[i] = 255 & o.charCodeAt(i); e.push(u) } else e.push(o, e._charset); e._pos = a.length } break; case "arraybuffer": if (s.readyState !== n.DONE || !s.response) break; a = s.response, e.push(new r(new Uint8Array(a))); break; case "moz-chunked-arraybuffer": if (a = s.response, s.readyState !== n.LOADING || !a) break; e.push(new r(new Uint8Array(a))); break; case "ms-stream": if (a = s.response, s.readyState !== n.LOADING) break; var c = new t.MSStreamReader; c.onprogress = function () { c.result.byteLength > e._pos && (e.push(new r(new Uint8Array(c.result.slice(e._pos)))), e._pos = c.result.byteLength) }, c.onload = function () { e.push(null) }, c.readAsArrayBuffer(a) }e._xhr.readyState === n.DONE && "ms-stream" !== e._mode && e.push(null) };
    }, { "./capability": "p5a1", "inherits": "4Bm0", "readable-stream": "tzeh", "process": "pBGv", "buffer": "dskh" }], "+AH4": [function (require, module, exports) {

        var e = require("buffer").Buffer; module.exports = function (f) { if (f instanceof Uint8Array) { if (0 === f.byteOffset && f.byteLength === f.buffer.byteLength) return f.buffer; if ("function" == typeof f.buffer.slice) return f.buffer.slice(f.byteOffset, f.byteOffset + f.byteLength) } if (e.isBuffer(f)) { for (var r = new Uint8Array(f.length), t = f.length, n = 0; n < t; n++)r[n] = f[n]; return r.buffer } throw new Error("Argument must be a Buffer") };
    }, { "buffer": "dskh" }], "yL7F": [function (require, module, exports) {
        var Buffer = require("buffer").Buffer;
        var global = arguments[3];
        var process = require("process");
        var e = require("buffer").Buffer, t = arguments[3], r = require("process"), o = require("./capability"), n = require("inherits"), i = require("./response"), s = require("readable-stream"), a = require("to-arraybuffer"), c = i.IncomingMessage, u = i.readyStates; function d(e, t) { return o.fetch && t ? "fetch" : o.mozchunkedarraybuffer ? "moz-chunked-arraybuffer" : o.msstream ? "ms-stream" : o.arraybuffer && e ? "arraybuffer" : o.vbArray && e ? "text:vbarray" : "text" } var f = module.exports = function (t) { var r, n = this; s.Writable.call(n), n._opts = t, n._body = [], n._headers = {}, t.auth && n.setHeader("Authorization", "Basic " + new e(t.auth).toString("base64")), Object.keys(t.headers).forEach(function (e) { n.setHeader(e, t.headers[e]) }); var i = !0; if ("disable-fetch" === t.mode || "requestTimeout" in t && !o.abortController) i = !1, r = !0; else if ("prefer-streaming" === t.mode) r = !1; else if ("allow-wrong-content-type" === t.mode) r = !o.overrideMimeType; else { if (t.mode && "default" !== t.mode && "prefer-fast" !== t.mode) throw new Error("Invalid value for opts.mode"); r = !0 } n._mode = d(r, i), n._fetchTimer = null, n.on("finish", function () { n._onFinish() }) }; function h(e) { try { var t = e.status; return null !== t && 0 !== t } catch (r) { return !1 } } n(f, s.Writable), f.prototype.setHeader = function (e, t) { var r = e.toLowerCase(); -1 === p.indexOf(r) && (this._headers[r] = { name: e, value: t }) }, f.prototype.getHeader = function (e) { var t = this._headers[e.toLowerCase()]; return t ? t.value : null }, f.prototype.removeHeader = function (e) { delete this._headers[e.toLowerCase()] }, f.prototype._onFinish = function () { var n = this; if (!n._destroyed) { var i = n._opts, s = n._headers, c = null; "GET" !== i.method && "HEAD" !== i.method && (c = o.arraybuffer ? a(e.concat(n._body)) : o.blobConstructor ? new t.Blob(n._body.map(function (e) { return a(e) }), { type: (s["content-type"] || {}).value || "" }) : e.concat(n._body).toString()); var d = []; if (Object.keys(s).forEach(function (e) { var t = s[e].name, r = s[e].value; Array.isArray(r) ? r.forEach(function (e) { d.push([t, e]) }) : d.push([t, r]) }), "fetch" === n._mode) { var f = null; if (o.abortController) { var h = new AbortController; f = h.signal, n._fetchAbortController = h, "requestTimeout" in i && 0 !== i.requestTimeout && (n._fetchTimer = t.setTimeout(function () { n.emit("requestTimeout"), n._fetchAbortController && n._fetchAbortController.abort() }, i.requestTimeout)) } t.fetch(n._opts.url, { method: n._opts.method, headers: d, body: c || void 0, mode: "cors", credentials: i.withCredentials ? "include" : "same-origin", signal: f }).then(function (e) { n._fetchResponse = e, n._connect() }, function (e) { t.clearTimeout(n._fetchTimer), n._destroyed || n.emit("error", e) }) } else { var p = n._xhr = new t.XMLHttpRequest; try { p.open(n._opts.method, n._opts.url, !0) } catch (l) { return void r.nextTick(function () { n.emit("error", l) }) } "responseType" in p && (p.responseType = n._mode.split(":")[0]), "withCredentials" in p && (p.withCredentials = !!i.withCredentials), "text" === n._mode && "overrideMimeType" in p && p.overrideMimeType("text/plain; charset=x-user-defined"), "requestTimeout" in i && (p.timeout = i.requestTimeout, p.ontimeout = function () { n.emit("requestTimeout") }), d.forEach(function (e) { p.setRequestHeader(e[0], e[1]) }), n._response = null, p.onreadystatechange = function () { switch (p.readyState) { case u.LOADING: case u.DONE: n._onXHRProgress() } }, "moz-chunked-arraybuffer" === n._mode && (p.onprogress = function () { n._onXHRProgress() }), p.onerror = function () { n._destroyed || n.emit("error", new Error("XHR error")) }; try { p.send(c) } catch (l) { return void r.nextTick(function () { n.emit("error", l) }) } } } }, f.prototype._onXHRProgress = function () { h(this._xhr) && !this._destroyed && (this._response || this._connect(), this._response._onXHRProgress()) }, f.prototype._connect = function () { var e = this; e._destroyed || (e._response = new c(e._xhr, e._fetchResponse, e._mode, e._fetchTimer), e._response.on("error", function (t) { e.emit("error", t) }), e.emit("response", e._response)) }, f.prototype._write = function (e, t, r) { this._body.push(e), r() }, f.prototype.abort = f.prototype.destroy = function () { this._destroyed = !0, t.clearTimeout(this._fetchTimer), this._response && (this._response._destroyed = !0), this._xhr ? this._xhr.abort() : this._fetchAbortController && this._fetchAbortController.abort() }, f.prototype.end = function (e, t, r) { "function" == typeof e && (r = e, e = void 0), s.Writable.prototype.end.call(this, e, t, r) }, f.prototype.flushHeaders = function () { }, f.prototype.setTimeout = function () { }, f.prototype.setNoDelay = function () { }, f.prototype.setSocketKeepAlive = function () { }; var p = ["accept-charset", "accept-encoding", "access-control-request-headers", "access-control-request-method", "connection", "content-length", "cookie", "cookie2", "date", "dnt", "expect", "host", "keep-alive", "origin", "referer", "te", "trailer", "transfer-encoding", "upgrade", "via"];
    }, { "./capability": "p5a1", "inherits": "4Bm0", "./response": "Ux+i", "readable-stream": "tzeh", "to-arraybuffer": "+AH4", "buffer": "dskh", "process": "pBGv" }], "K5Tb": [function (require, module, exports) {
        module.exports = o; var r = Object.prototype.hasOwnProperty; function o() { for (var o = {}, t = 0; t < arguments.length; t++) { var e = arguments[t]; for (var a in e) r.call(e, a) && (o[a] = e[a]) } return o }
    }, {}], "9OpT": [function (require, module, exports) {
        module.exports = { 100: "Continue", 101: "Switching Protocols", 102: "Processing", 200: "OK", 201: "Created", 202: "Accepted", 203: "Non-Authoritative Information", 204: "No Content", 205: "Reset Content", 206: "Partial Content", 207: "Multi-Status", 208: "Already Reported", 226: "IM Used", 300: "Multiple Choices", 301: "Moved Permanently", 302: "Found", 303: "See Other", 304: "Not Modified", 305: "Use Proxy", 307: "Temporary Redirect", 308: "Permanent Redirect", 400: "Bad Request", 401: "Unauthorized", 402: "Payment Required", 403: "Forbidden", 404: "Not Found", 405: "Method Not Allowed", 406: "Not Acceptable", 407: "Proxy Authentication Required", 408: "Request Timeout", 409: "Conflict", 410: "Gone", 411: "Length Required", 412: "Precondition Failed", 413: "Payload Too Large", 414: "URI Too Long", 415: "Unsupported Media Type", 416: "Range Not Satisfiable", 417: "Expectation Failed", 418: "I'm a teapot", 421: "Misdirected Request", 422: "Unprocessable Entity", 423: "Locked", 424: "Failed Dependency", 425: "Unordered Collection", 426: "Upgrade Required", 428: "Precondition Required", 429: "Too Many Requests", 431: "Request Header Fields Too Large", 451: "Unavailable For Legal Reasons", 500: "Internal Server Error", 501: "Not Implemented", 502: "Bad Gateway", 503: "Service Unavailable", 504: "Gateway Timeout", 505: "HTTP Version Not Supported", 506: "Variant Also Negotiates", 507: "Insufficient Storage", 508: "Loop Detected", 509: "Bandwidth Limit Exceeded", 510: "Not Extended", 511: "Network Authentication Required" };
    }, {}], "/oWq": [function (require, module, exports) {
        var global = arguments[3];
        var define;
        var o, e = arguments[3]; !function (n) { var r = "object" == typeof exports && exports && !exports.nodeType && exports, t = "object" == typeof module && module && !module.nodeType && module, u = "object" == typeof e && e; u.global !== u && u.window !== u && u.self !== u || (n = u); var i, f, c = 2147483647, l = 36, s = 1, p = 26, a = 38, d = 700, h = 72, v = 128, g = "-", w = /^xn--/, x = /[^\x20-\x7E]/, y = /[\x2E\u3002\uFF0E\uFF61]/g, m = { overflow: "Overflow: input needs wider integers to process", "not-basic": "Illegal input >= 0x80 (not a basic code point)", "invalid-input": "Invalid input" }, C = l - s, b = Math.floor, j = String.fromCharCode; function A(o) { throw new RangeError(m[o]) } function I(o, e) { for (var n = o.length, r = []; n--;)r[n] = e(o[n]); return r } function E(o, e) { var n = o.split("@"), r = ""; return n.length > 1 && (r = n[0] + "@", o = n[1]), r + I((o = o.replace(y, ".")).split("."), e).join(".") } function F(o) { for (var e, n, r = [], t = 0, u = o.length; t < u;)(e = o.charCodeAt(t++)) >= 55296 && e <= 56319 && t < u ? 56320 == (64512 & (n = o.charCodeAt(t++))) ? r.push(((1023 & e) << 10) + (1023 & n) + 65536) : (r.push(e), t--) : r.push(e); return r } function O(o) { return I(o, function (o) { var e = ""; return o > 65535 && (e += j((o -= 65536) >>> 10 & 1023 | 55296), o = 56320 | 1023 & o), e += j(o) }).join("") } function S(o, e) { return o + 22 + 75 * (o < 26) - ((0 != e) << 5) } function T(o, e, n) { var r = 0; for (o = n ? b(o / d) : o >> 1, o += b(o / e); o > C * p >> 1; r += l)o = b(o / C); return b(r + (C + 1) * o / (o + a)) } function L(o) { var e, n, r, t, u, i, f, a, d, w, x, y = [], m = o.length, C = 0, j = v, I = h; for ((n = o.lastIndexOf(g)) < 0 && (n = 0), r = 0; r < n; ++r)o.charCodeAt(r) >= 128 && A("not-basic"), y.push(o.charCodeAt(r)); for (t = n > 0 ? n + 1 : 0; t < m;) { for (u = C, i = 1, f = l; t >= m && A("invalid-input"), ((a = (x = o.charCodeAt(t++)) - 48 < 10 ? x - 22 : x - 65 < 26 ? x - 65 : x - 97 < 26 ? x - 97 : l) >= l || a > b((c - C) / i)) && A("overflow"), C += a * i, !(a < (d = f <= I ? s : f >= I + p ? p : f - I)); f += l)i > b(c / (w = l - d)) && A("overflow"), i *= w; I = T(C - u, e = y.length + 1, 0 == u), b(C / e) > c - j && A("overflow"), j += b(C / e), C %= e, y.splice(C++, 0, j) } return O(y) } function M(o) { var e, n, r, t, u, i, f, a, d, w, x, y, m, C, I, E = []; for (y = (o = F(o)).length, e = v, n = 0, u = h, i = 0; i < y; ++i)(x = o[i]) < 128 && E.push(j(x)); for (r = t = E.length, t && E.push(g); r < y;) { for (f = c, i = 0; i < y; ++i)(x = o[i]) >= e && x < f && (f = x); for (f - e > b((c - n) / (m = r + 1)) && A("overflow"), n += (f - e) * m, e = f, i = 0; i < y; ++i)if ((x = o[i]) < e && ++n > c && A("overflow"), x == e) { for (a = n, d = l; !(a < (w = d <= u ? s : d >= u + p ? p : d - u)); d += l)I = a - w, C = l - w, E.push(j(S(w + I % C, 0))), a = b(I / C); E.push(j(S(a, 0))), u = T(n, m, r == t), n = 0, ++r } ++n, ++e } return E.join("") } if (i = { version: "1.4.1", ucs2: { decode: F, encode: O }, decode: L, encode: M, toASCII: function (o) { return E(o, function (o) { return x.test(o) ? "xn--" + M(o) : o }) }, toUnicode: function (o) { return E(o, function (o) { return w.test(o) ? L(o.slice(4).toLowerCase()) : o }) } }, "function" == typeof o && "object" == typeof o.amd && o.amd) o("punycode", function () { return i }); else if (r && t) if (module.exports == r) t.exports = i; else for (f in i) i.hasOwnProperty(f) && (r[f] = i[f]); else n.punycode = i }(this);
    }, {}], "5YsI": [function (require, module, exports) {
        "use strict"; module.exports = { isString: function (n) { return "string" == typeof n }, isObject: function (n) { return "object" == typeof n && null !== n }, isNull: function (n) { return null === n }, isNullOrUndefined: function (n) { return null == n } };
    }, {}], "J6GP": [function (require, module, exports) {
        "use strict"; function r(r, e) { return Object.prototype.hasOwnProperty.call(r, e) } module.exports = function (t, n, o, a) { n = n || "&", o = o || "="; var s = {}; if ("string" != typeof t || 0 === t.length) return s; var p = /\+/g; t = t.split(n); var u = 1e3; a && "number" == typeof a.maxKeys && (u = a.maxKeys); var c = t.length; u > 0 && c > u && (c = u); for (var i = 0; i < c; ++i) { var y, l, f, v, b = t[i].replace(p, "%20"), d = b.indexOf(o); d >= 0 ? (y = b.substr(0, d), l = b.substr(d + 1)) : (y = b, l = ""), f = decodeURIComponent(y), v = decodeURIComponent(l), r(s, f) ? e(s[f]) ? s[f].push(v) : s[f] = [s[f], v] : s[f] = v } return s }; var e = Array.isArray || function (r) { return "[object Array]" === Object.prototype.toString.call(r) };
    }, {}], "bvhO": [function (require, module, exports) {
        "use strict"; var n = function (n) { switch (typeof n) { case "string": return n; case "boolean": return n ? "true" : "false"; case "number": return isFinite(n) ? n : ""; default: return "" } }; module.exports = function (o, u, c, a) { return u = u || "&", c = c || "=", null === o && (o = void 0), "object" == typeof o ? r(t(o), function (t) { var a = encodeURIComponent(n(t)) + c; return e(o[t]) ? r(o[t], function (e) { return a + encodeURIComponent(n(e)) }).join(u) : a + encodeURIComponent(n(o[t])) }).join(u) : a ? encodeURIComponent(n(a)) + c + encodeURIComponent(n(o)) : "" }; var e = Array.isArray || function (n) { return "[object Array]" === Object.prototype.toString.call(n) }; function r(n, e) { if (n.map) return n.map(e); for (var r = [], t = 0; t < n.length; t++)r.push(e(n[t], t)); return r } var t = Object.keys || function (n) { var e = []; for (var r in n) Object.prototype.hasOwnProperty.call(n, r) && e.push(r); return e };
    }, {}], "+00f": [function (require, module, exports) {
        "use strict"; exports.decode = exports.parse = require("./decode"), exports.encode = exports.stringify = require("./encode");
    }, { "./decode": "J6GP", "./encode": "bvhO" }], "Mej7": [function (require, module, exports) {
        "use strict"; var t = require("punycode"), s = require("./util"); function h() { this.protocol = null, this.slashes = null, this.auth = null, this.host = null, this.port = null, this.hostname = null, this.hash = null, this.search = null, this.query = null, this.pathname = null, this.path = null, this.href = null } exports.parse = b, exports.resolve = O, exports.resolveObject = d, exports.format = q, exports.Url = h; var e = /^([a-z0-9.+-]+:)/i, a = /:[0-9]*$/, r = /^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/, o = ["<", ">", '"', "`", " ", "\r", "\n", "\t"], n = ["{", "}", "|", "\\", "^", "`"].concat(o), i = ["'"].concat(n), l = ["%", "/", "?", ";", "#"].concat(i), p = ["/", "?", "#"], c = 255, u = /^[+a-z0-9A-Z_-]{0,63}$/, f = /^([+a-z0-9A-Z_-]{0,63})(.*)$/, m = { javascript: !0, "javascript:": !0 }, v = { javascript: !0, "javascript:": !0 }, g = { http: !0, https: !0, ftp: !0, gopher: !0, file: !0, "http:": !0, "https:": !0, "ftp:": !0, "gopher:": !0, "file:": !0 }, y = require("querystring"); function b(t, e, a) { if (t && s.isObject(t) && t instanceof h) return t; var r = new h; return r.parse(t, e, a), r } function q(t) { return s.isString(t) && (t = b(t)), t instanceof h ? t.format() : h.prototype.format.call(t) } function O(t, s) { return b(t, !1, !0).resolve(s) } function d(t, s) { return t ? b(t, !1, !0).resolveObject(s) : s } h.prototype.parse = function (h, a, o) { if (!s.isString(h)) throw new TypeError("Parameter 'url' must be a string, not " + typeof h); var n = h.indexOf("?"), b = -1 !== n && n < h.indexOf("#") ? "?" : "#", q = h.split(b); q[0] = q[0].replace(/\\/g, "/"); var O = h = q.join(b); if (O = O.trim(), !o && 1 === h.split("#").length) { var d = r.exec(O); if (d) return this.path = O, this.href = O, this.pathname = d[1], d[2] ? (this.search = d[2], this.query = a ? y.parse(this.search.substr(1)) : this.search.substr(1)) : a && (this.search = "", this.query = {}), this } var j = e.exec(O); if (j) { var x = (j = j[0]).toLowerCase(); this.protocol = x, O = O.substr(j.length) } if (o || j || O.match(/^\/\/[^@\/]+@[^@\/]+/)) { var A = "//" === O.substr(0, 2); !A || j && v[j] || (O = O.substr(2), this.slashes = !0) } if (!v[j] && (A || j && !g[j])) { for (var C, I, w = -1, U = 0; U < p.length; U++) { -1 !== (k = O.indexOf(p[U])) && (-1 === w || k < w) && (w = k) } -1 !== (I = -1 === w ? O.lastIndexOf("@") : O.lastIndexOf("@", w)) && (C = O.slice(0, I), O = O.slice(I + 1), this.auth = decodeURIComponent(C)), w = -1; for (U = 0; U < l.length; U++) { var k; -1 !== (k = O.indexOf(l[U])) && (-1 === w || k < w) && (w = k) } -1 === w && (w = O.length), this.host = O.slice(0, w), O = O.slice(w), this.parseHost(), this.hostname = this.hostname || ""; var N = "[" === this.hostname[0] && "]" === this.hostname[this.hostname.length - 1]; if (!N) for (var R = this.hostname.split(/\./), S = (U = 0, R.length); U < S; U++) { var $ = R[U]; if ($ && !$.match(u)) { for (var z = "", H = 0, L = $.length; H < L; H++)$.charCodeAt(H) > 127 ? z += "x" : z += $[H]; if (!z.match(u)) { var Z = R.slice(0, U), _ = R.slice(U + 1), E = $.match(f); E && (Z.push(E[1]), _.unshift(E[2])), _.length && (O = "/" + _.join(".") + O), this.hostname = Z.join("."); break } } } this.hostname.length > c ? this.hostname = "" : this.hostname = this.hostname.toLowerCase(), N || (this.hostname = t.toASCII(this.hostname)); var P = this.port ? ":" + this.port : "", T = this.hostname || ""; this.host = T + P, this.href += this.host, N && (this.hostname = this.hostname.substr(1, this.hostname.length - 2), "/" !== O[0] && (O = "/" + O)) } if (!m[x]) for (U = 0, S = i.length; U < S; U++) { var B = i[U]; if (-1 !== O.indexOf(B)) { var D = encodeURIComponent(B); D === B && (D = escape(B)), O = O.split(B).join(D) } } var F = O.indexOf("#"); -1 !== F && (this.hash = O.substr(F), O = O.slice(0, F)); var G = O.indexOf("?"); if (-1 !== G ? (this.search = O.substr(G), this.query = O.substr(G + 1), a && (this.query = y.parse(this.query)), O = O.slice(0, G)) : a && (this.search = "", this.query = {}), O && (this.pathname = O), g[x] && this.hostname && !this.pathname && (this.pathname = "/"), this.pathname || this.search) { P = this.pathname || ""; var J = this.search || ""; this.path = P + J } return this.href = this.format(), this }, h.prototype.format = function () { var t = this.auth || ""; t && (t = (t = encodeURIComponent(t)).replace(/%3A/i, ":"), t += "@"); var h = this.protocol || "", e = this.pathname || "", a = this.hash || "", r = !1, o = ""; this.host ? r = t + this.host : this.hostname && (r = t + (-1 === this.hostname.indexOf(":") ? this.hostname : "[" + this.hostname + "]"), this.port && (r += ":" + this.port)), this.query && s.isObject(this.query) && Object.keys(this.query).length && (o = y.stringify(this.query)); var n = this.search || o && "?" + o || ""; return h && ":" !== h.substr(-1) && (h += ":"), this.slashes || (!h || g[h]) && !1 !== r ? (r = "//" + (r || ""), e && "/" !== e.charAt(0) && (e = "/" + e)) : r || (r = ""), a && "#" !== a.charAt(0) && (a = "#" + a), n && "?" !== n.charAt(0) && (n = "?" + n), h + r + (e = e.replace(/[?#]/g, function (t) { return encodeURIComponent(t) })) + (n = n.replace("#", "%23")) + a }, h.prototype.resolve = function (t) { return this.resolveObject(b(t, !1, !0)).format() }, h.prototype.resolveObject = function (t) { if (s.isString(t)) { var e = new h; e.parse(t, !1, !0), t = e } for (var a = new h, r = Object.keys(this), o = 0; o < r.length; o++) { var n = r[o]; a[n] = this[n] } if (a.hash = t.hash, "" === t.href) return a.href = a.format(), a; if (t.slashes && !t.protocol) { for (var i = Object.keys(t), l = 0; l < i.length; l++) { var p = i[l]; "protocol" !== p && (a[p] = t[p]) } return g[a.protocol] && a.hostname && !a.pathname && (a.path = a.pathname = "/"), a.href = a.format(), a } if (t.protocol && t.protocol !== a.protocol) { if (!g[t.protocol]) { for (var c = Object.keys(t), u = 0; u < c.length; u++) { var f = c[u]; a[f] = t[f] } return a.href = a.format(), a } if (a.protocol = t.protocol, t.host || v[t.protocol]) a.pathname = t.pathname; else { for (var m = (t.pathname || "").split("/"); m.length && !(t.host = m.shift());); t.host || (t.host = ""), t.hostname || (t.hostname = ""), "" !== m[0] && m.unshift(""), m.length < 2 && m.unshift(""), a.pathname = m.join("/") } if (a.search = t.search, a.query = t.query, a.host = t.host || "", a.auth = t.auth, a.hostname = t.hostname || t.host, a.port = t.port, a.pathname || a.search) { var y = a.pathname || "", b = a.search || ""; a.path = y + b } return a.slashes = a.slashes || t.slashes, a.href = a.format(), a } var q = a.pathname && "/" === a.pathname.charAt(0), O = t.host || t.pathname && "/" === t.pathname.charAt(0), d = O || q || a.host && t.pathname, j = d, x = a.pathname && a.pathname.split("/") || [], A = (m = t.pathname && t.pathname.split("/") || [], a.protocol && !g[a.protocol]); if (A && (a.hostname = "", a.port = null, a.host && ("" === x[0] ? x[0] = a.host : x.unshift(a.host)), a.host = "", t.protocol && (t.hostname = null, t.port = null, t.host && ("" === m[0] ? m[0] = t.host : m.unshift(t.host)), t.host = null), d = d && ("" === m[0] || "" === x[0])), O) a.host = t.host || "" === t.host ? t.host : a.host, a.hostname = t.hostname || "" === t.hostname ? t.hostname : a.hostname, a.search = t.search, a.query = t.query, x = m; else if (m.length) x || (x = []), x.pop(), x = x.concat(m), a.search = t.search, a.query = t.query; else if (!s.isNullOrUndefined(t.search)) { if (A) a.hostname = a.host = x.shift(), (k = !!(a.host && a.host.indexOf("@") > 0) && a.host.split("@")) && (a.auth = k.shift(), a.host = a.hostname = k.shift()); return a.search = t.search, a.query = t.query, s.isNull(a.pathname) && s.isNull(a.search) || (a.path = (a.pathname ? a.pathname : "") + (a.search ? a.search : "")), a.href = a.format(), a } if (!x.length) return a.pathname = null, a.search ? a.path = "/" + a.search : a.path = null, a.href = a.format(), a; for (var C = x.slice(-1)[0], I = (a.host || t.host || x.length > 1) && ("." === C || ".." === C) || "" === C, w = 0, U = x.length; U >= 0; U--)"." === (C = x[U]) ? x.splice(U, 1) : ".." === C ? (x.splice(U, 1), w++) : w && (x.splice(U, 1), w--); if (!d && !j) for (; w--; w)x.unshift(".."); !d || "" === x[0] || x[0] && "/" === x[0].charAt(0) || x.unshift(""), I && "/" !== x.join("/").substr(-1) && x.push(""); var k, N = "" === x[0] || x[0] && "/" === x[0].charAt(0); A && (a.hostname = a.host = N ? "" : x.length ? x.shift() : "", (k = !!(a.host && a.host.indexOf("@") > 0) && a.host.split("@")) && (a.auth = k.shift(), a.host = a.hostname = k.shift())); return (d = d || a.host && x.length) && !N && x.unshift(""), x.length ? a.pathname = x.join("/") : (a.pathname = null, a.path = null), s.isNull(a.pathname) && s.isNull(a.search) || (a.path = (a.pathname ? a.pathname : "") + (a.search ? a.search : "")), a.auth = t.auth || a.auth, a.slashes = a.slashes || t.slashes, a.href = a.format(), a }, h.prototype.parseHost = function () { var t = this.host, s = a.exec(t); s && (":" !== (s = s[0]) && (this.port = s.substr(1)), t = t.substr(0, t.length - s.length)), t && (this.hostname = t) };
    }, { "punycode": "/oWq", "./util": "5YsI", "querystring": "+00f" }], "KKrj": [function (require, module, exports) {
        var global = arguments[3];
        var e = arguments[3], t = require("./lib/request"), r = require("./lib/response"), n = require("xtend"), o = require("builtin-status-codes"), s = require("url"), u = exports; u.request = function (r, o) { r = "string" == typeof r ? s.parse(r) : n(r); var u = -1 === e.location.protocol.search(/^https?:$/) ? "http:" : "", E = r.protocol || u, a = r.hostname || r.host, C = r.port, i = r.path || "/"; a && -1 !== a.indexOf(":") && (a = "[" + a + "]"), r.url = (a ? E + "//" + a : "") + (C ? ":" + C : "") + i, r.method = (r.method || "GET").toUpperCase(), r.headers = r.headers || {}; var T = new t(r); return o && T.on("response", o), T }, u.get = function (e, t) { var r = u.request(e, t); return r.end(), r }, u.ClientRequest = t, u.IncomingMessage = r.IncomingMessage, u.Agent = function () { }, u.Agent.defaultMaxSockets = 4, u.globalAgent = new u.Agent, u.STATUS_CODES = o, u.METHODS = ["CHECKOUT", "CONNECT", "COPY", "DELETE", "GET", "HEAD", "LOCK", "M-SEARCH", "MERGE", "MKACTIVITY", "MKCOL", "MOVE", "NOTIFY", "OPTIONS", "PATCH", "POST", "PROPFIND", "PROPPATCH", "PURGE", "PUT", "REPORT", "SEARCH", "SUBSCRIBE", "TRACE", "UNLOCK", "UNSUBSCRIBE"];
    }, { "./lib/request": "yL7F", "./lib/response": "Ux+i", "xtend": "K5Tb", "builtin-status-codes": "9OpT", "url": "Mej7" }], "wVMl": [function (require, module, exports) {
        var t = require("http"), r = require("url"), o = module.exports; for (var e in t) t.hasOwnProperty(e) && (o[e] = t[e]); function p(t) { if ("string" == typeof t && (t = r.parse(t)), t.protocol || (t.protocol = "https:"), "https:" !== t.protocol) throw new Error('Protocol "' + t.protocol + '" not supported. Expected "https:"'); return t } o.request = function (r, o) { return r = p(r), t.request.call(this, r, o) }, o.get = function (r, o) { return r = p(r), t.get.call(this, r, o) };
    }, { "http": "KKrj", "url": "Mej7" }], "a7/e": [function (require, module, exports) {
        var Buffer = require("buffer").Buffer;
        var e = require("buffer").Buffer; module.exports = function (r) { return r instanceof e };
    }, { "buffer": "dskh" }], "XO/A": [function (require, module, exports) {
        var global = arguments[3];
        var process = require("process");
        var e = arguments[3], t = require("process"), r = /%[sdj%]/g; exports.format = function (e) { if (!v(e)) { for (var t = [], n = 0; n < arguments.length; n++)t.push(i(arguments[n])); return t.join(" ") } n = 1; for (var o = arguments, s = o.length, u = String(e).replace(r, function (e) { if ("%%" === e) return "%"; if (n >= s) return e; switch (e) { case "%s": return String(o[n++]); case "%d": return Number(o[n++]); case "%j": try { return JSON.stringify(o[n++]) } catch (t) { return "[Circular]" } default: return e } }), c = o[n]; n < s; c = o[++n])h(c) || !z(c) ? u += " " + c : u += " " + i(c); return u }, exports.deprecate = function (r, n) { if (j(e.process)) return function () { return exports.deprecate(r, n).apply(this, arguments) }; if (!0 === t.noDeprecation) return r; var o = !1; return function () { if (!o) { if (t.throwDeprecation) throw new Error(n); t.traceDeprecation ? console.trace(n) : console.error(n), o = !0 } return r.apply(this, arguments) } }; var n, o = {}; function i(e, t) { var r = { seen: [], stylize: u }; return arguments.length >= 3 && (r.depth = arguments[2]), arguments.length >= 4 && (r.colors = arguments[3]), x(t) ? r.showHidden = t : t && exports._extend(r, t), j(r.showHidden) && (r.showHidden = !1), j(r.depth) && (r.depth = 2), j(r.colors) && (r.colors = !1), j(r.customInspect) && (r.customInspect = !0), r.colors && (r.stylize = s), p(r, e, r.depth) } function s(e, t) { var r = i.styles[t]; return r ? "[" + i.colors[r][0] + "m" + e + "[" + i.colors[r][1] + "m" : e } function u(e, t) { return e } function c(e) { var t = {}; return e.forEach(function (e, r) { t[e] = !0 }), t } function p(e, t, r) { if (e.customInspect && t && D(t.inspect) && t.inspect !== exports.inspect && (!t.constructor || t.constructor.prototype !== t)) { var n = t.inspect(r, e); return v(n) || (n = p(e, n, r)), n } var o = l(e, t); if (o) return o; var i = Object.keys(t), s = c(i); if (e.showHidden && (i = Object.getOwnPropertyNames(t)), E(t) && (i.indexOf("message") >= 0 || i.indexOf("description") >= 0)) return a(t); if (0 === i.length) { if (D(t)) { var u = t.name ? ": " + t.name : ""; return e.stylize("[Function" + u + "]", "special") } if (O(t)) return e.stylize(RegExp.prototype.toString.call(t), "regexp"); if (w(t)) return e.stylize(Date.prototype.toString.call(t), "date"); if (E(t)) return a(t) } var x, h = "", b = !1, m = ["{", "}"]; (d(t) && (b = !0, m = ["[", "]"]), D(t)) && (h = " [Function" + (t.name ? ": " + t.name : "") + "]"); return O(t) && (h = " " + RegExp.prototype.toString.call(t)), w(t) && (h = " " + Date.prototype.toUTCString.call(t)), E(t) && (h = " " + a(t)), 0 !== i.length || b && 0 != t.length ? r < 0 ? O(t) ? e.stylize(RegExp.prototype.toString.call(t), "regexp") : e.stylize("[Object]", "special") : (e.seen.push(t), x = b ? f(e, t, r, s, i) : i.map(function (n) { return g(e, t, r, s, n, b) }), e.seen.pop(), y(x, h, m)) : m[0] + h + m[1] } function l(e, t) { if (j(t)) return e.stylize("undefined", "undefined"); if (v(t)) { var r = "'" + JSON.stringify(t).replace(/^"|"$/g, "").replace(/'/g, "\\'").replace(/\\"/g, '"') + "'"; return e.stylize(r, "string") } return m(t) ? e.stylize("" + t, "number") : x(t) ? e.stylize("" + t, "boolean") : h(t) ? e.stylize("null", "null") : void 0 } function a(e) { return "[" + Error.prototype.toString.call(e) + "]" } function f(e, t, r, n, o) { for (var i = [], s = 0, u = t.length; s < u; ++s)$(t, String(s)) ? i.push(g(e, t, r, n, String(s), !0)) : i.push(""); return o.forEach(function (o) { o.match(/^\d+$/) || i.push(g(e, t, r, n, o, !0)) }), i } function g(e, t, r, n, o, i) { var s, u, c; if ((c = Object.getOwnPropertyDescriptor(t, o) || { value: t[o] }).get ? u = c.set ? e.stylize("[Getter/Setter]", "special") : e.stylize("[Getter]", "special") : c.set && (u = e.stylize("[Setter]", "special")), $(n, o) || (s = "[" + o + "]"), u || (e.seen.indexOf(c.value) < 0 ? (u = h(r) ? p(e, c.value, null) : p(e, c.value, r - 1)).indexOf("\n") > -1 && (u = i ? u.split("\n").map(function (e) { return "  " + e }).join("\n").substr(2) : "\n" + u.split("\n").map(function (e) { return "   " + e }).join("\n")) : u = e.stylize("[Circular]", "special")), j(s)) { if (i && o.match(/^\d+$/)) return u; (s = JSON.stringify("" + o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/) ? (s = s.substr(1, s.length - 2), s = e.stylize(s, "name")) : (s = s.replace(/'/g, "\\'").replace(/\\"/g, '"').replace(/(^"|"$)/g, "'"), s = e.stylize(s, "string")) } return s + ": " + u } function y(e, t, r) { return e.reduce(function (e, t) { return 0, t.indexOf("\n") >= 0 && 0, e + t.replace(/\u001b\[\d\d?m/g, "").length + 1 }, 0) > 60 ? r[0] + ("" === t ? "" : t + "\n ") + " " + e.join(",\n  ") + " " + r[1] : r[0] + t + " " + e.join(", ") + " " + r[1] } function d(e) { return Array.isArray(e) } function x(e) { return "boolean" == typeof e } function h(e) { return null === e } function b(e) { return null == e } function m(e) { return "number" == typeof e } function v(e) { return "string" == typeof e } function S(e) { return "symbol" == typeof e } function j(e) { return void 0 === e } function O(e) { return z(e) && "[object RegExp]" === A(e) } function z(e) { return "object" == typeof e && null !== e } function w(e) { return z(e) && "[object Date]" === A(e) } function E(e) { return z(e) && ("[object Error]" === A(e) || e instanceof Error) } function D(e) { return "function" == typeof e } function N(e) { return null === e || "boolean" == typeof e || "number" == typeof e || "string" == typeof e || "symbol" == typeof e || void 0 === e } function A(e) { return Object.prototype.toString.call(e) } function J(e) { return e < 10 ? "0" + e.toString(10) : e.toString(10) } exports.debuglog = function (e) { if (j(n) && (n = ""), e = e.toUpperCase(), !o[e]) if (new RegExp("\\b" + e + "\\b", "i").test(n)) { var r = t.pid; o[e] = function () { var t = exports.format.apply(exports, arguments); console.error("%s %d: %s", e, r, t) } } else o[e] = function () { }; return o[e] }, exports.inspect = i, i.colors = { bold: [1, 22], italic: [3, 23], underline: [4, 24], inverse: [7, 27], white: [37, 39], grey: [90, 39], black: [30, 39], blue: [34, 39], cyan: [36, 39], green: [32, 39], magenta: [35, 39], red: [31, 39], yellow: [33, 39] }, i.styles = { special: "cyan", number: "yellow", boolean: "yellow", undefined: "grey", null: "bold", string: "green", date: "magenta", regexp: "red" }, exports.isArray = d, exports.isBoolean = x, exports.isNull = h, exports.isNullOrUndefined = b, exports.isNumber = m, exports.isString = v, exports.isSymbol = S, exports.isUndefined = j, exports.isRegExp = O, exports.isObject = z, exports.isDate = w, exports.isError = E, exports.isFunction = D, exports.isPrimitive = N, exports.isBuffer = require("./support/isBuffer"); var R = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; function H() { var e = new Date, t = [J(e.getHours()), J(e.getMinutes()), J(e.getSeconds())].join(":"); return [e.getDate(), R[e.getMonth()], t].join(" ") } function $(e, t) { return Object.prototype.hasOwnProperty.call(e, t) } exports.log = function () { console.log("%s - %s", H(), exports.format.apply(exports, arguments)) }, exports.inherits = require("inherits"), exports._extend = function (e, t) { if (!t || !z(t)) return e; for (var r = Object.keys(t), n = r.length; n--;)e[r[n]] = t[r[n]]; return e };
    }, { "./support/isBuffer": "a7/e", "inherits": "4Bm0", "process": "pBGv" }], "DlZn": [function (require, module, exports) {
        var global = arguments[3];
        var t = arguments[3]; function e(t, e) { if (t === e) return 0; for (var r = t.length, n = e.length, i = 0, o = Math.min(r, n); i < o; ++i)if (t[i] !== e[i]) { r = t[i], n = e[i]; break } return r < n ? -1 : n < r ? 1 : 0 } function r(e) { return t.Buffer && "function" == typeof t.Buffer.isBuffer ? t.Buffer.isBuffer(e) : !(null == e || !e._isBuffer) } var n = require("util/"), i = Object.prototype.hasOwnProperty, o = Array.prototype.slice, u = "foo" === function () { }.name; function a(t) { return Object.prototype.toString.call(t) } function f(e) { return !r(e) && ("function" == typeof t.ArrayBuffer && ("function" == typeof ArrayBuffer.isView ? ArrayBuffer.isView(e) : !!e && (e instanceof DataView || !!(e.buffer && e.buffer instanceof ArrayBuffer)))) } var c = module.exports = y, s = /\s*function\s+([^\(\s]*)\s*/; function l(t) { if (n.isFunction(t)) { if (u) return t.name; var e = t.toString().match(s); return e && e[1] } } function p(t, e) { return "string" == typeof t ? t.length < e ? t : t.slice(0, e) : t } function g(t) { if (u || !n.isFunction(t)) return n.inspect(t); var e = l(t); return "[Function" + (e ? ": " + e : "") + "]" } function h(t) { return p(g(t.actual), 128) + " " + t.operator + " " + p(g(t.expected), 128) } function E(t, e, r, n, i) { throw new c.AssertionError({ message: r, actual: t, expected: e, operator: n, stackStartFunction: i }) } function y(t, e) { t || E(t, !0, e, "==", c.ok) } function d(t, i, o, u) { if (t === i) return !0; if (r(t) && r(i)) return 0 === e(t, i); if (n.isDate(t) && n.isDate(i)) return t.getTime() === i.getTime(); if (n.isRegExp(t) && n.isRegExp(i)) return t.source === i.source && t.global === i.global && t.multiline === i.multiline && t.lastIndex === i.lastIndex && t.ignoreCase === i.ignoreCase; if (null !== t && "object" == typeof t || null !== i && "object" == typeof i) { if (f(t) && f(i) && a(t) === a(i) && !(t instanceof Float32Array || t instanceof Float64Array)) return 0 === e(new Uint8Array(t.buffer), new Uint8Array(i.buffer)); if (r(t) !== r(i)) return !1; var c = (u = u || { actual: [], expected: [] }).actual.indexOf(t); return -1 !== c && c === u.expected.indexOf(i) || (u.actual.push(t), u.expected.push(i), b(t, i, o, u)) } return o ? t === i : t == i } function m(t) { return "[object Arguments]" == Object.prototype.toString.call(t) } function b(t, e, r, i) { if (null == t || null == e) return !1; if (n.isPrimitive(t) || n.isPrimitive(e)) return t === e; if (r && Object.getPrototypeOf(t) !== Object.getPrototypeOf(e)) return !1; var u = m(t), a = m(e); if (u && !a || !u && a) return !1; if (u) return d(t = o.call(t), e = o.call(e), r); var f, c, s = O(t), l = O(e); if (s.length !== l.length) return !1; for (s.sort(), l.sort(), c = s.length - 1; c >= 0; c--)if (s[c] !== l[c]) return !1; for (c = s.length - 1; c >= 0; c--)if (!d(t[f = s[c]], e[f], r, i)) return !1; return !0 } function v(t, e, r) { d(t, e, !0) && E(t, e, r, "notDeepStrictEqual", v) } function q(t, e) { if (!t || !e) return !1; if ("[object RegExp]" == Object.prototype.toString.call(e)) return e.test(t); try { if (t instanceof e) return !0 } catch (r) { } return !Error.isPrototypeOf(e) && !0 === e.call({}, t) } function x(t) { var e; try { t() } catch (r) { e = r } return e } function w(t, e, r, i) { var o; if ("function" != typeof e) throw new TypeError('"block" argument must be a function'); "string" == typeof r && (i = r, r = null), o = x(e), i = (r && r.name ? " (" + r.name + ")." : ".") + (i ? " " + i : "."), t && !o && E(o, r, "Missing expected exception" + i); var u = "string" == typeof i, a = !t && o && !r; if ((!t && n.isError(o) && u && q(o, r) || a) && E(o, r, "Got unwanted exception" + i), t && o && r && !q(o, r) || !t && o) throw o } c.AssertionError = function (t) { this.name = "AssertionError", this.actual = t.actual, this.expected = t.expected, this.operator = t.operator, t.message ? (this.message = t.message, this.generatedMessage = !1) : (this.message = h(this), this.generatedMessage = !0); var e = t.stackStartFunction || E; if (Error.captureStackTrace) Error.captureStackTrace(this, e); else { var r = new Error; if (r.stack) { var n = r.stack, i = l(e), o = n.indexOf("\n" + i); if (o >= 0) { var u = n.indexOf("\n", o + 1); n = n.substring(u + 1) } this.stack = n } } }, n.inherits(c.AssertionError, Error), c.fail = E, c.ok = y, c.equal = function (t, e, r) { t != e && E(t, e, r, "==", c.equal) }, c.notEqual = function (t, e, r) { t == e && E(t, e, r, "!=", c.notEqual) }, c.deepEqual = function (t, e, r) { d(t, e, !1) || E(t, e, r, "deepEqual", c.deepEqual) }, c.deepStrictEqual = function (t, e, r) { d(t, e, !0) || E(t, e, r, "deepStrictEqual", c.deepStrictEqual) }, c.notDeepEqual = function (t, e, r) { d(t, e, !1) && E(t, e, r, "notDeepEqual", c.notDeepEqual) }, c.notDeepStrictEqual = v, c.strictEqual = function (t, e, r) { t !== e && E(t, e, r, "===", c.strictEqual) }, c.notStrictEqual = function (t, e, r) { t === e && E(t, e, r, "!==", c.notStrictEqual) }, c.throws = function (t, e, r) { w(!0, t, e, r) }, c.doesNotThrow = function (t, e, r) { w(!1, t, e, r) }, c.ifError = function (t) { if (t) throw t }; var O = Object.keys || function (t) { var e = []; for (var r in t) i.call(t, r) && e.push(r); return e };
    }, { "util/": "XO/A" }], "6IAg": [function (require, module, exports) {
        var s = 1e3, e = 60 * s, r = 60 * e, a = 24 * r, n = 365.25 * a; function c(c) { if (!((c = String(c)).length > 100)) { var t = /^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(c); if (t) { var i = parseFloat(t[1]); switch ((t[2] || "ms").toLowerCase()) { case "years": case "year": case "yrs": case "yr": case "y": return i * n; case "days": case "day": case "d": return i * a; case "hours": case "hour": case "hrs": case "hr": case "h": return i * r; case "minutes": case "minute": case "mins": case "min": case "m": return i * e; case "seconds": case "second": case "secs": case "sec": case "s": return i * s; case "milliseconds": case "millisecond": case "msecs": case "msec": case "ms": return i; default: return } } } } function t(n) { return n >= a ? Math.round(n / a) + "d" : n >= r ? Math.round(n / r) + "h" : n >= e ? Math.round(n / e) + "m" : n >= s ? Math.round(n / s) + "s" : n + "ms" } function i(n) { return o(n, a, "day") || o(n, r, "hour") || o(n, e, "minute") || o(n, s, "second") || n + " ms" } function o(s, e, r) { if (!(s < e)) return s < 1.5 * e ? Math.floor(s / e) + " " + r : Math.ceil(s / e) + " " + r + "s" } module.exports = function (s, e) { e = e || {}; var r = typeof s; if ("string" === r && s.length > 0) return c(s); if ("number" === r && !1 === isNaN(s)) return e.long ? i(s) : t(s); throw new Error("val is not a non-empty string or a valid number. val=" + JSON.stringify(s)) };
    }, {}], "mdLU": [function (require, module, exports) {
        function e(e) { var r, s = 0; for (r in e) s = (s << 5) - s + e.charCodeAt(r), s |= 0; return exports.colors[Math.abs(s) % exports.colors.length] } function r(r) { var t; function o() { if (o.enabled) { var e = o, r = +new Date, s = r - (t || r); e.diff = s, e.prev = t, e.curr = r, t = r; for (var n = new Array(arguments.length), p = 0; p < n.length; p++)n[p] = arguments[p]; n[0] = exports.coerce(n[0]), "string" != typeof n[0] && n.unshift("%O"); var a = 0; n[0] = n[0].replace(/%([a-zA-Z%])/g, function (r, s) { if ("%%" === r) return r; a++; var t = exports.formatters[s]; if ("function" == typeof t) { var o = n[a]; r = t.call(e, o), n.splice(a, 1), a-- } return r }), exports.formatArgs.call(e, n), (o.log || exports.log || console.log.bind(console)).apply(e, n) } } return o.namespace = r, o.enabled = exports.enabled(r), o.useColors = exports.useColors(), o.color = e(r), o.destroy = s, "function" == typeof exports.init && exports.init(o), exports.instances.push(o), o } function s() { var e = exports.instances.indexOf(this); return -1 !== e && (exports.instances.splice(e, 1), !0) } function t(e) { var r; exports.save(e), exports.names = [], exports.skips = []; var s = ("string" == typeof e ? e : "").split(/[\s,]+/), t = s.length; for (r = 0; r < t; r++)s[r] && ("-" === (e = s[r].replace(/\*/g, ".*?"))[0] ? exports.skips.push(new RegExp("^" + e.substr(1) + "$")) : exports.names.push(new RegExp("^" + e + "$"))); for (r = 0; r < exports.instances.length; r++) { var o = exports.instances[r]; o.enabled = exports.enabled(o.namespace) } } function o() { exports.enable("") } function n(e) { if ("*" === e[e.length - 1]) return !0; var r, s; for (r = 0, s = exports.skips.length; r < s; r++)if (exports.skips[r].test(e)) return !1; for (r = 0, s = exports.names.length; r < s; r++)if (exports.names[r].test(e)) return !0; return !1 } function p(e) { return e instanceof Error ? e.stack || e.message : e } exports = module.exports = r.debug = r.default = r, exports.coerce = p, exports.disable = o, exports.enable = t, exports.enabled = n, exports.humanize = require("ms"), exports.instances = [], exports.names = [], exports.skips = [], exports.formatters = {};
    }, { "ms": "6IAg" }], "WWM4": [function (require, module, exports) {
        var process = require("process");
        var e = require("process"); function o() { return !("undefined" == typeof window || !window.process || "renderer" !== window.process.type) || ("undefined" == typeof navigator || !navigator.userAgent || !navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)) && ("undefined" != typeof document && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance || "undefined" != typeof window && window.console && (window.console.firebug || window.console.exception && window.console.table) || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) && parseInt(RegExp.$1, 10) >= 31 || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)) } function C(e) { var o = this.useColors; if (e[0] = (o ? "%c" : "") + this.namespace + (o ? " %c" : " ") + e[0] + (o ? "%c " : " ") + "+" + exports.humanize(this.diff), o) { var C = "color: " + this.color; e.splice(1, 0, C, "color: inherit"); var t = 0, r = 0; e[0].replace(/%[a-zA-Z%]/g, function (e) { "%%" !== e && (t++ , "%c" === e && (r = t)) }), e.splice(r, 0, C) } } function t() { return "object" == typeof console && console.log && Function.prototype.apply.call(console.log, console, arguments) } function r(e) { try { null == e ? exports.storage.removeItem("debug") : exports.storage.debug = e } catch (o) { } } function n() { var o; try { o = exports.storage.debug } catch (C) { } return !o && void 0 !== e && "env" in e && (o = void 0), o } function F() { try { return window.localStorage } catch (e) { } } exports = module.exports = require("./debug"), exports.log = t, exports.formatArgs = C, exports.save = r, exports.load = n, exports.useColors = o, exports.storage = "undefined" != typeof chrome && void 0 !== chrome.storage ? chrome.storage.local : F(), exports.colors = ["#0000CC", "#0000FF", "#0033CC", "#0033FF", "#0066CC", "#0066FF", "#0099CC", "#0099FF", "#00CC00", "#00CC33", "#00CC66", "#00CC99", "#00CCCC", "#00CCFF", "#3300CC", "#3300FF", "#3333CC", "#3333FF", "#3366CC", "#3366FF", "#3399CC", "#3399FF", "#33CC00", "#33CC33", "#33CC66", "#33CC99", "#33CCCC", "#33CCFF", "#6600CC", "#6600FF", "#6633CC", "#6633FF", "#66CC00", "#66CC33", "#9900CC", "#9900FF", "#9933CC", "#9933FF", "#99CC00", "#99CC33", "#CC0000", "#CC0033", "#CC0066", "#CC0099", "#CC00CC", "#CC00FF", "#CC3300", "#CC3333", "#CC3366", "#CC3399", "#CC33CC", "#CC33FF", "#CC6600", "#CC6633", "#CC9900", "#CC9933", "#CCCC00", "#CCCC33", "#FF0000", "#FF0033", "#FF0066", "#FF0099", "#FF00CC", "#FF00FF", "#FF3300", "#FF3333", "#FF3366", "#FF3399", "#FF33CC", "#FF33FF", "#FF6600", "#FF6633", "#FF9900", "#FF9933", "#FFCC00", "#FFCC33"], exports.formatters.j = function (e) { try { return JSON.stringify(e) } catch (o) { return "[UnexpectedJSONParseError]: " + o.message } }, exports.enable(n());
    }, { "./debug": "mdLU", "process": "pBGv" }], "3JCP": [function (require, module, exports) {
        function t(e) { return (t = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(e) } var e = require("url"), r = require("http"), o = require("https"), s = require("assert"), i = require("stream").Writable, n = require("debug")("follow-redirects"), u = { GET: !0, HEAD: !0, OPTIONS: !0, TRACE: !0 }, h = Object.create(null); function a(t, e) { i.call(this), t.headers = t.headers || {}, this._options = t, this._redirectCount = 0, this._redirects = [], this._requestBodyLength = 0, this._requestBodyBuffers = [], e && this.on("response", e); var r = this; if (this._onNativeResponse = function (t) { r._processResponse(t) }, !t.pathname && t.path) { var o = t.path.indexOf("?"); o < 0 ? t.pathname = t.path : (t.pathname = t.path.substring(0, o), t.search = t.path.substring(o)) } this._performRequest() } function c(t) { var r = { maxRedirects: 21, maxBodyLength: 10485760 }, o = {}; return Object.keys(t).forEach(function (i) { var u = i + ":", h = o[u] = t[i], c = r[i] = Object.create(h); c.request = function (t, i) { return "string" == typeof t ? (t = e.parse(t)).maxRedirects = r.maxRedirects : t = Object.assign({ protocol: u, maxRedirects: r.maxRedirects, maxBodyLength: r.maxBodyLength }, t), t.nativeProtocols = o, s.equal(t.protocol, u, "protocol mismatch"), n("options", t), new a(t, i) }, c.get = function (t, e) { var r = c.request(t, e); return r.end(), r } }), r } ["abort", "aborted", "error", "socket", "timeout"].forEach(function (t) { h[t] = function (e) { this._redirectable.emit(t, e) } }), a.prototype = Object.create(i.prototype), a.prototype.write = function (e, r, o) { if (!("string" == typeof e || "object" === t(e) && "length" in e)) throw new Error("data should be a string, Buffer or Uint8Array"); "function" == typeof r && (o = r, r = null), 0 !== e.length ? this._requestBodyLength + e.length <= this._options.maxBodyLength ? (this._requestBodyLength += e.length, this._requestBodyBuffers.push({ data: e, encoding: r }), this._currentRequest.write(e, r, o)) : (this.emit("error", new Error("Request body larger than maxBodyLength limit")), this.abort()) : o && o() }, a.prototype.end = function (t, e, r) { "function" == typeof t ? (r = t, t = e = null) : "function" == typeof e && (r = e, e = null); var o = this._currentRequest; this.write(t || "", e, function () { o.end(null, null, r) }) }, a.prototype.setHeader = function (t, e) { this._options.headers[t] = e, this._currentRequest.setHeader(t, e) }, a.prototype.removeHeader = function (t) { delete this._options.headers[t], this._currentRequest.removeHeader(t) }, ["abort", "flushHeaders", "getHeader", "setNoDelay", "setSocketKeepAlive", "setTimeout"].forEach(function (t) { a.prototype[t] = function (e, r) { return this._currentRequest[t](e, r) } }), ["aborted", "connection", "socket"].forEach(function (t) { Object.defineProperty(a.prototype, t, { get: function () { return this._currentRequest[t] } }) }), a.prototype._performRequest = function () { var t = this._options.protocol, r = this._options.nativeProtocols[t]; if (r) { if (this._options.agents) { var o = t.substr(0, t.length - 1); this._options.agent = this._options.agents[o] } var s = this._currentRequest = r.request(this._options, this._onNativeResponse); for (var i in this._currentUrl = e.format(this._options), s._redirectable = this, h) i && s.on(i, h[i]); if (this._isRedirect) { var n = 0, u = this._requestBodyBuffers; !function t() { if (n < u.length) { var e = u[n++]; s.write(e.data, e.encoding, t) } else s.end() }() } } else this.emit("error", new Error("Unsupported protocol " + t)) }, a.prototype._processResponse = function (t) { this._options.trackRedirects && this._redirects.push({ url: this._currentUrl, headers: t.headers, statusCode: t.statusCode }); var r = t.headers.location; if (r && !1 !== this._options.followRedirects && t.statusCode >= 300 && t.statusCode < 400) { if (++this._redirectCount > this._options.maxRedirects) return void this.emit("error", new Error("Max redirects exceeded.")); var o, s = this._options.headers; if (307 !== t.statusCode && !(this._options.method in u)) for (o in this._options.method = "GET", this._requestBodyBuffers = [], s) /^content-/i.test(o) && delete s[o]; if (!this._isRedirect) for (o in s) /^host$/i.test(o) && delete s[o]; var i = e.resolve(this._currentUrl, r); n("redirecting to", i), Object.assign(this._options, e.parse(i)), this._isRedirect = !0, this._performRequest(), t.destroy() } else t.responseUrl = this._currentUrl, t.redirects = this._redirects, this.emit("response", t), this._requestBodyBuffers = [] }, module.exports = c({ http: r, https: o }), module.exports.wrap = c;
    }, { "url": "Mej7", "http": "KKrj", "https": "wVMl", "assert": "DlZn", "stream": "fnRj", "debug": "WWM4" }], "wru8": [function (require, module, exports) {
        "use strict"; function t() { this.input = null, this.next_in = 0, this.avail_in = 0, this.total_in = 0, this.output = null, this.next_out = 0, this.avail_out = 0, this.total_out = 0, this.msg = "", this.state = null, this.data_type = 2, this.adler = 0 } module.exports = t;
    }, {}], "Cngu": [function (require, module, exports) {
        "use strict"; var r = "undefined" != typeof Uint8Array && "undefined" != typeof Uint16Array && "undefined" != typeof Int32Array; function t(r, t) { return Object.prototype.hasOwnProperty.call(r, t) } exports.assign = function (r) { for (var e = Array.prototype.slice.call(arguments, 1); e.length;) { var n = e.shift(); if (n) { if ("object" != typeof n) throw new TypeError(n + "must be non-object"); for (var a in n) t(n, a) && (r[a] = n[a]) } } return r }, exports.shrinkBuf = function (r, t) { return r.length === t ? r : r.subarray ? r.subarray(0, t) : (r.length = t, r) }; var e = { arraySet: function (r, t, e, n, a) { if (t.subarray && r.subarray) r.set(t.subarray(e, e + n), a); else for (var o = 0; o < n; o++)r[a + o] = t[e + o] }, flattenChunks: function (r) { var t, e, n, a, o, s; for (n = 0, t = 0, e = r.length; t < e; t++)n += r[t].length; for (s = new Uint8Array(n), a = 0, t = 0, e = r.length; t < e; t++)o = r[t], s.set(o, a), a += o.length; return s } }, n = { arraySet: function (r, t, e, n, a) { for (var o = 0; o < n; o++)r[a + o] = t[e + o] }, flattenChunks: function (r) { return [].concat.apply([], r) } }; exports.setTyped = function (r) { r ? (exports.Buf8 = Uint8Array, exports.Buf16 = Uint16Array, exports.Buf32 = Int32Array, exports.assign(exports, e)) : (exports.Buf8 = Array, exports.Buf16 = Array, exports.Buf32 = Array, exports.assign(exports, n)) }, exports.setTyped(r);
    }, {}], "Iy1V": [function (require, module, exports) {
        "use strict"; var e = require("../utils/common"), t = 4, n = 0, _ = 1, r = 2; function a(e) { for (var t = e.length; --t >= 0;)e[t] = 0 } var i = 0, l = 1, d = 2, f = 3, o = 258, b = 29, s = 256, u = s + 1 + b, c = 30, p = 19, h = 2 * u + 1, v = 15, y = 16, x = 7, g = 256, m = 16, w = 17, A = 18, k = [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0], q = [0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13], z = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 3, 7], S = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15], j = 512, B = new Array(2 * (u + 2)); a(B); var C = new Array(2 * c); a(C); var D = new Array(j); a(D); var E = new Array(o - f + 1); a(E); var F = new Array(b); a(F); var G, H, I, J = new Array(c); function K(e, t, n, _, r) { this.static_tree = e, this.extra_bits = t, this.extra_base = n, this.elems = _, this.max_length = r, this.has_stree = e && e.length } function L(e, t) { this.dyn_tree = e, this.max_code = 0, this.stat_desc = t } function M(e) { return e < 256 ? D[e] : D[256 + (e >>> 7)] } function N(e, t) { e.pending_buf[e.pending++] = 255 & t, e.pending_buf[e.pending++] = t >>> 8 & 255 } function O(e, t, n) { e.bi_valid > y - n ? (e.bi_buf |= t << e.bi_valid & 65535, N(e, e.bi_buf), e.bi_buf = t >> y - e.bi_valid, e.bi_valid += n - y) : (e.bi_buf |= t << e.bi_valid & 65535, e.bi_valid += n) } function P(e, t, n) { O(e, n[2 * t], n[2 * t + 1]) } function Q(e, t) { var n = 0; do { n |= 1 & e, e >>>= 1, n <<= 1 } while (--t > 0); return n >>> 1 } function R(e) { 16 === e.bi_valid ? (N(e, e.bi_buf), e.bi_buf = 0, e.bi_valid = 0) : e.bi_valid >= 8 && (e.pending_buf[e.pending++] = 255 & e.bi_buf, e.bi_buf >>= 8, e.bi_valid -= 8) } function T(e, t) { var n, _, r, a, i, l, d = t.dyn_tree, f = t.max_code, o = t.stat_desc.static_tree, b = t.stat_desc.has_stree, s = t.stat_desc.extra_bits, u = t.stat_desc.extra_base, c = t.stat_desc.max_length, p = 0; for (a = 0; a <= v; a++)e.bl_count[a] = 0; for (d[2 * e.heap[e.heap_max] + 1] = 0, n = e.heap_max + 1; n < h; n++)(a = d[2 * d[2 * (_ = e.heap[n]) + 1] + 1] + 1) > c && (a = c, p++), d[2 * _ + 1] = a, _ > f || (e.bl_count[a]++ , i = 0, _ >= u && (i = s[_ - u]), l = d[2 * _], e.opt_len += l * (a + i), b && (e.static_len += l * (o[2 * _ + 1] + i))); if (0 !== p) { do { for (a = c - 1; 0 === e.bl_count[a];)a--; e.bl_count[a]-- , e.bl_count[a + 1] += 2, e.bl_count[c]-- , p -= 2 } while (p > 0); for (a = c; 0 !== a; a--)for (_ = e.bl_count[a]; 0 !== _;)(r = e.heap[--n]) > f || (d[2 * r + 1] !== a && (e.opt_len += (a - d[2 * r + 1]) * d[2 * r], d[2 * r + 1] = a), _--) } } function U(e, t, n) { var _, r, a = new Array(v + 1), i = 0; for (_ = 1; _ <= v; _++)a[_] = i = i + n[_ - 1] << 1; for (r = 0; r <= t; r++) { var l = e[2 * r + 1]; 0 !== l && (e[2 * r] = Q(a[l]++, l)) } } function V() { var e, t, n, _, r, a = new Array(v + 1); for (n = 0, _ = 0; _ < b - 1; _++)for (F[_] = n, e = 0; e < 1 << k[_]; e++)E[n++] = _; for (E[n - 1] = _, r = 0, _ = 0; _ < 16; _++)for (J[_] = r, e = 0; e < 1 << q[_]; e++)D[r++] = _; for (r >>= 7; _ < c; _++)for (J[_] = r << 7, e = 0; e < 1 << q[_] - 7; e++)D[256 + r++] = _; for (t = 0; t <= v; t++)a[t] = 0; for (e = 0; e <= 143;)B[2 * e + 1] = 8, e++ , a[8]++; for (; e <= 255;)B[2 * e + 1] = 9, e++ , a[9]++; for (; e <= 279;)B[2 * e + 1] = 7, e++ , a[7]++; for (; e <= 287;)B[2 * e + 1] = 8, e++ , a[8]++; for (U(B, u + 1, a), e = 0; e < c; e++)C[2 * e + 1] = 5, C[2 * e] = Q(e, 5); G = new K(B, k, s + 1, u, v), H = new K(C, q, 0, c, v), I = new K(new Array(0), z, 0, p, x) } function W(e) { var t; for (t = 0; t < u; t++)e.dyn_ltree[2 * t] = 0; for (t = 0; t < c; t++)e.dyn_dtree[2 * t] = 0; for (t = 0; t < p; t++)e.bl_tree[2 * t] = 0; e.dyn_ltree[2 * g] = 1, e.opt_len = e.static_len = 0, e.last_lit = e.matches = 0 } function X(e) { e.bi_valid > 8 ? N(e, e.bi_buf) : e.bi_valid > 0 && (e.pending_buf[e.pending++] = e.bi_buf), e.bi_buf = 0, e.bi_valid = 0 } function Y(t, n, _, r) { X(t), r && (N(t, _), N(t, ~_)), e.arraySet(t.pending_buf, t.window, n, _, t.pending), t.pending += _ } function Z(e, t, n, _) { var r = 2 * t, a = 2 * n; return e[r] < e[a] || e[r] === e[a] && _[t] <= _[n] } function $(e, t, n) { for (var _ = e.heap[n], r = n << 1; r <= e.heap_len && (r < e.heap_len && Z(t, e.heap[r + 1], e.heap[r], e.depth) && r++ , !Z(t, _, e.heap[r], e.depth));)e.heap[n] = e.heap[r], n = r, r <<= 1; e.heap[n] = _ } function ee(e, t, n) { var _, r, a, i, l = 0; if (0 !== e.last_lit) do { _ = e.pending_buf[e.d_buf + 2 * l] << 8 | e.pending_buf[e.d_buf + 2 * l + 1], r = e.pending_buf[e.l_buf + l], l++ , 0 === _ ? P(e, r, t) : (P(e, (a = E[r]) + s + 1, t), 0 !== (i = k[a]) && O(e, r -= F[a], i), P(e, a = M(--_), n), 0 !== (i = q[a]) && O(e, _ -= J[a], i)) } while (l < e.last_lit); P(e, g, t) } function te(e, t) { var n, _, r, a = t.dyn_tree, i = t.stat_desc.static_tree, l = t.stat_desc.has_stree, d = t.stat_desc.elems, f = -1; for (e.heap_len = 0, e.heap_max = h, n = 0; n < d; n++)0 !== a[2 * n] ? (e.heap[++e.heap_len] = f = n, e.depth[n] = 0) : a[2 * n + 1] = 0; for (; e.heap_len < 2;)a[2 * (r = e.heap[++e.heap_len] = f < 2 ? ++f : 0)] = 1, e.depth[r] = 0, e.opt_len-- , l && (e.static_len -= i[2 * r + 1]); for (t.max_code = f, n = e.heap_len >> 1; n >= 1; n--)$(e, a, n); r = d; do { n = e.heap[1], e.heap[1] = e.heap[e.heap_len--], $(e, a, 1), _ = e.heap[1], e.heap[--e.heap_max] = n, e.heap[--e.heap_max] = _, a[2 * r] = a[2 * n] + a[2 * _], e.depth[r] = (e.depth[n] >= e.depth[_] ? e.depth[n] : e.depth[_]) + 1, a[2 * n + 1] = a[2 * _ + 1] = r, e.heap[1] = r++ , $(e, a, 1) } while (e.heap_len >= 2); e.heap[--e.heap_max] = e.heap[1], T(e, t), U(a, f, e.bl_count) } function ne(e, t, n) { var _, r, a = -1, i = t[1], l = 0, d = 7, f = 4; for (0 === i && (d = 138, f = 3), t[2 * (n + 1) + 1] = 65535, _ = 0; _ <= n; _++)r = i, i = t[2 * (_ + 1) + 1], ++l < d && r === i || (l < f ? e.bl_tree[2 * r] += l : 0 !== r ? (r !== a && e.bl_tree[2 * r]++ , e.bl_tree[2 * m]++) : l <= 10 ? e.bl_tree[2 * w]++ : e.bl_tree[2 * A]++ , l = 0, a = r, 0 === i ? (d = 138, f = 3) : r === i ? (d = 6, f = 3) : (d = 7, f = 4)) } function _e(e, t, n) { var _, r, a = -1, i = t[1], l = 0, d = 7, f = 4; for (0 === i && (d = 138, f = 3), _ = 0; _ <= n; _++)if (r = i, i = t[2 * (_ + 1) + 1], !(++l < d && r === i)) { if (l < f) do { P(e, r, e.bl_tree) } while (0 != --l); else 0 !== r ? (r !== a && (P(e, r, e.bl_tree), l--), P(e, m, e.bl_tree), O(e, l - 3, 2)) : l <= 10 ? (P(e, w, e.bl_tree), O(e, l - 3, 3)) : (P(e, A, e.bl_tree), O(e, l - 11, 7)); l = 0, a = r, 0 === i ? (d = 138, f = 3) : r === i ? (d = 6, f = 3) : (d = 7, f = 4) } } function re(e) { var t; for (ne(e, e.dyn_ltree, e.l_desc.max_code), ne(e, e.dyn_dtree, e.d_desc.max_code), te(e, e.bl_desc), t = p - 1; t >= 3 && 0 === e.bl_tree[2 * S[t] + 1]; t--); return e.opt_len += 3 * (t + 1) + 5 + 5 + 4, t } function ae(e, t, n, _) { var r; for (O(e, t - 257, 5), O(e, n - 1, 5), O(e, _ - 4, 4), r = 0; r < _; r++)O(e, e.bl_tree[2 * S[r] + 1], 3); _e(e, e.dyn_ltree, t - 1), _e(e, e.dyn_dtree, n - 1) } function ie(e) { var t, r = 4093624447; for (t = 0; t <= 31; t++ , r >>>= 1)if (1 & r && 0 !== e.dyn_ltree[2 * t]) return n; if (0 !== e.dyn_ltree[18] || 0 !== e.dyn_ltree[20] || 0 !== e.dyn_ltree[26]) return _; for (t = 32; t < s; t++)if (0 !== e.dyn_ltree[2 * t]) return _; return n } a(J); var le = !1; function de(e) { le || (V(), le = !0), e.l_desc = new L(e.dyn_ltree, G), e.d_desc = new L(e.dyn_dtree, H), e.bl_desc = new L(e.bl_tree, I), e.bi_buf = 0, e.bi_valid = 0, W(e) } function fe(e, t, n, _) { O(e, (i << 1) + (_ ? 1 : 0), 3), Y(e, t, n, !0) } function oe(e) { O(e, l << 1, 3), P(e, g, B), R(e) } function be(e, n, _, a) { var i, f, o = 0; e.level > 0 ? (e.strm.data_type === r && (e.strm.data_type = ie(e)), te(e, e.l_desc), te(e, e.d_desc), o = re(e), i = e.opt_len + 3 + 7 >>> 3, (f = e.static_len + 3 + 7 >>> 3) <= i && (i = f)) : i = f = _ + 5, _ + 4 <= i && -1 !== n ? fe(e, n, _, a) : e.strategy === t || f === i ? (O(e, (l << 1) + (a ? 1 : 0), 3), ee(e, B, C)) : (O(e, (d << 1) + (a ? 1 : 0), 3), ae(e, e.l_desc.max_code + 1, e.d_desc.max_code + 1, o + 1), ee(e, e.dyn_ltree, e.dyn_dtree)), W(e), a && X(e) } function se(e, t, n) { return e.pending_buf[e.d_buf + 2 * e.last_lit] = t >>> 8 & 255, e.pending_buf[e.d_buf + 2 * e.last_lit + 1] = 255 & t, e.pending_buf[e.l_buf + e.last_lit] = 255 & n, e.last_lit++ , 0 === t ? e.dyn_ltree[2 * n]++ : (e.matches++ , t-- , e.dyn_ltree[2 * (E[n] + s + 1)]++ , e.dyn_dtree[2 * M(t)]++), e.last_lit === e.lit_bufsize - 1 } exports._tr_init = de, exports._tr_stored_block = fe, exports._tr_flush_block = be, exports._tr_tally = se, exports._tr_align = oe;
    }, { "../utils/common": "Cngu" }], "P885": [function (require, module, exports) {
        "use strict"; function e(e, r, o, t) { for (var u = 65535 & e | 0, i = e >>> 16 & 65535 | 0, n = 0; 0 !== o;) { o -= n = o > 2e3 ? 2e3 : o; do { i = i + (u = u + r[t++] | 0) | 0 } while (--n); u %= 65521, i %= 65521 } return u | i << 16 | 0 } module.exports = e;
    }, {}], "ntXC": [function (require, module, exports) {
        "use strict"; function r() { for (var r, o = [], t = 0; t < 256; t++) { r = t; for (var n = 0; n < 8; n++)r = 1 & r ? 3988292384 ^ r >>> 1 : r >>> 1; o[t] = r } return o } var o = r(); function t(r, t, n, u) { var a = o, e = u + n; r ^= -1; for (var f = u; f < e; f++)r = r >>> 8 ^ a[255 & (r ^ t[f])]; return -1 ^ r } module.exports = t;
    }, {}], "spUl": [function (require, module, exports) {
        "use strict"; module.exports = { 2: "need dictionary", 1: "stream end", 0: "", "-1": "file error", "-2": "stream error", "-3": "data error", "-4": "insufficient memory", "-5": "buffer error", "-6": "incompatible version" };
    }, {}], "d27Y": [function (require, module, exports) {
        "use strict"; var t, a = require("../utils/common"), e = require("./trees"), s = require("./adler32"), i = require("./crc32"), r = require("./messages"), n = 0, h = 1, l = 3, _ = 4, d = 5, o = 0, u = 1, g = -2, f = -3, c = -5, p = -1, m = 1, w = 2, v = 3, k = 4, z = 0, b = 2, x = 8, y = 9, B = 15, S = 8, q = 29, I = 256, A = I + 1 + q, C = 30, R = 19, j = 2 * A + 1, D = 15, E = 3, H = 258, K = H + E + 1, N = 32, F = 42, G = 69, J = 73, L = 91, M = 103, O = 113, P = 666, Q = 1, T = 2, U = 3, V = 4, W = 3; function X(t, a) { return t.msg = r[a], a } function Y(t) { return (t << 1) - (t > 4 ? 9 : 0) } function Z(t) { for (var a = t.length; --a >= 0;)t[a] = 0 } function $(t) { var e = t.state, s = e.pending; s > t.avail_out && (s = t.avail_out), 0 !== s && (a.arraySet(t.output, e.pending_buf, e.pending_out, s, t.next_out), t.next_out += s, e.pending_out += s, t.total_out += s, t.avail_out -= s, e.pending -= s, 0 === e.pending && (e.pending_out = 0)) } function tt(t, a) { e._tr_flush_block(t, t.block_start >= 0 ? t.block_start : -1, t.strstart - t.block_start, a), t.block_start = t.strstart, $(t.strm) } function at(t, a) { t.pending_buf[t.pending++] = a } function et(t, a) { t.pending_buf[t.pending++] = a >>> 8 & 255, t.pending_buf[t.pending++] = 255 & a } function st(t, e, r, n) { var h = t.avail_in; return h > n && (h = n), 0 === h ? 0 : (t.avail_in -= h, a.arraySet(e, t.input, t.next_in, h, r), 1 === t.state.wrap ? t.adler = s(t.adler, e, h, r) : 2 === t.state.wrap && (t.adler = i(t.adler, e, h, r)), t.next_in += h, t.total_in += h, h) } function it(t, a) { var e, s, i = t.max_chain_length, r = t.strstart, n = t.prev_length, h = t.nice_match, l = t.strstart > t.w_size - K ? t.strstart - (t.w_size - K) : 0, _ = t.window, d = t.w_mask, o = t.prev, u = t.strstart + H, g = _[r + n - 1], f = _[r + n]; t.prev_length >= t.good_match && (i >>= 2), h > t.lookahead && (h = t.lookahead); do { if (_[(e = a) + n] === f && _[e + n - 1] === g && _[e] === _[r] && _[++e] === _[r + 1]) { r += 2, e++; do { } while (_[++r] === _[++e] && _[++r] === _[++e] && _[++r] === _[++e] && _[++r] === _[++e] && _[++r] === _[++e] && _[++r] === _[++e] && _[++r] === _[++e] && _[++r] === _[++e] && r < u); if (s = H - (u - r), r = u - H, s > n) { if (t.match_start = a, n = s, s >= h) break; g = _[r + n - 1], f = _[r + n] } } } while ((a = o[a & d]) > l && 0 != --i); return n <= t.lookahead ? n : t.lookahead } function rt(t) { var e, s, i, r, n, h = t.w_size; do { if (r = t.window_size - t.lookahead - t.strstart, t.strstart >= h + (h - K)) { a.arraySet(t.window, t.window, h, h, 0), t.match_start -= h, t.strstart -= h, t.block_start -= h, e = s = t.hash_size; do { i = t.head[--e], t.head[e] = i >= h ? i - h : 0 } while (--s); e = s = h; do { i = t.prev[--e], t.prev[e] = i >= h ? i - h : 0 } while (--s); r += h } if (0 === t.strm.avail_in) break; if (s = st(t.strm, t.window, t.strstart + t.lookahead, r), t.lookahead += s, t.lookahead + t.insert >= E) for (n = t.strstart - t.insert, t.ins_h = t.window[n], t.ins_h = (t.ins_h << t.hash_shift ^ t.window[n + 1]) & t.hash_mask; t.insert && (t.ins_h = (t.ins_h << t.hash_shift ^ t.window[n + E - 1]) & t.hash_mask, t.prev[n & t.w_mask] = t.head[t.ins_h], t.head[t.ins_h] = n, n++ , t.insert-- , !(t.lookahead + t.insert < E));); } while (t.lookahead < K && 0 !== t.strm.avail_in) } function nt(t, a) { var e = 65535; for (e > t.pending_buf_size - 5 && (e = t.pending_buf_size - 5); ;) { if (t.lookahead <= 1) { if (rt(t), 0 === t.lookahead && a === n) return Q; if (0 === t.lookahead) break } t.strstart += t.lookahead, t.lookahead = 0; var s = t.block_start + e; if ((0 === t.strstart || t.strstart >= s) && (t.lookahead = t.strstart - s, t.strstart = s, tt(t, !1), 0 === t.strm.avail_out)) return Q; if (t.strstart - t.block_start >= t.w_size - K && (tt(t, !1), 0 === t.strm.avail_out)) return Q } return t.insert = 0, a === _ ? (tt(t, !0), 0 === t.strm.avail_out ? U : V) : (t.strstart > t.block_start && (tt(t, !1), t.strm.avail_out), Q) } function ht(t, a) { for (var s, i; ;) { if (t.lookahead < K) { if (rt(t), t.lookahead < K && a === n) return Q; if (0 === t.lookahead) break } if (s = 0, t.lookahead >= E && (t.ins_h = (t.ins_h << t.hash_shift ^ t.window[t.strstart + E - 1]) & t.hash_mask, s = t.prev[t.strstart & t.w_mask] = t.head[t.ins_h], t.head[t.ins_h] = t.strstart), 0 !== s && t.strstart - s <= t.w_size - K && (t.match_length = it(t, s)), t.match_length >= E) if (i = e._tr_tally(t, t.strstart - t.match_start, t.match_length - E), t.lookahead -= t.match_length, t.match_length <= t.max_lazy_match && t.lookahead >= E) { t.match_length--; do { t.strstart++ , t.ins_h = (t.ins_h << t.hash_shift ^ t.window[t.strstart + E - 1]) & t.hash_mask, s = t.prev[t.strstart & t.w_mask] = t.head[t.ins_h], t.head[t.ins_h] = t.strstart } while (0 != --t.match_length); t.strstart++ } else t.strstart += t.match_length, t.match_length = 0, t.ins_h = t.window[t.strstart], t.ins_h = (t.ins_h << t.hash_shift ^ t.window[t.strstart + 1]) & t.hash_mask; else i = e._tr_tally(t, 0, t.window[t.strstart]), t.lookahead-- , t.strstart++; if (i && (tt(t, !1), 0 === t.strm.avail_out)) return Q } return t.insert = t.strstart < E - 1 ? t.strstart : E - 1, a === _ ? (tt(t, !0), 0 === t.strm.avail_out ? U : V) : t.last_lit && (tt(t, !1), 0 === t.strm.avail_out) ? Q : T } function lt(t, a) { for (var s, i, r; ;) { if (t.lookahead < K) { if (rt(t), t.lookahead < K && a === n) return Q; if (0 === t.lookahead) break } if (s = 0, t.lookahead >= E && (t.ins_h = (t.ins_h << t.hash_shift ^ t.window[t.strstart + E - 1]) & t.hash_mask, s = t.prev[t.strstart & t.w_mask] = t.head[t.ins_h], t.head[t.ins_h] = t.strstart), t.prev_length = t.match_length, t.prev_match = t.match_start, t.match_length = E - 1, 0 !== s && t.prev_length < t.max_lazy_match && t.strstart - s <= t.w_size - K && (t.match_length = it(t, s), t.match_length <= 5 && (t.strategy === m || t.match_length === E && t.strstart - t.match_start > 4096) && (t.match_length = E - 1)), t.prev_length >= E && t.match_length <= t.prev_length) { r = t.strstart + t.lookahead - E, i = e._tr_tally(t, t.strstart - 1 - t.prev_match, t.prev_length - E), t.lookahead -= t.prev_length - 1, t.prev_length -= 2; do { ++t.strstart <= r && (t.ins_h = (t.ins_h << t.hash_shift ^ t.window[t.strstart + E - 1]) & t.hash_mask, s = t.prev[t.strstart & t.w_mask] = t.head[t.ins_h], t.head[t.ins_h] = t.strstart) } while (0 != --t.prev_length); if (t.match_available = 0, t.match_length = E - 1, t.strstart++ , i && (tt(t, !1), 0 === t.strm.avail_out)) return Q } else if (t.match_available) { if ((i = e._tr_tally(t, 0, t.window[t.strstart - 1])) && tt(t, !1), t.strstart++ , t.lookahead-- , 0 === t.strm.avail_out) return Q } else t.match_available = 1, t.strstart++ , t.lookahead-- } return t.match_available && (i = e._tr_tally(t, 0, t.window[t.strstart - 1]), t.match_available = 0), t.insert = t.strstart < E - 1 ? t.strstart : E - 1, a === _ ? (tt(t, !0), 0 === t.strm.avail_out ? U : V) : t.last_lit && (tt(t, !1), 0 === t.strm.avail_out) ? Q : T } function _t(t, a) { for (var s, i, r, h, l = t.window; ;) { if (t.lookahead <= H) { if (rt(t), t.lookahead <= H && a === n) return Q; if (0 === t.lookahead) break } if (t.match_length = 0, t.lookahead >= E && t.strstart > 0 && (i = l[r = t.strstart - 1]) === l[++r] && i === l[++r] && i === l[++r]) { h = t.strstart + H; do { } while (i === l[++r] && i === l[++r] && i === l[++r] && i === l[++r] && i === l[++r] && i === l[++r] && i === l[++r] && i === l[++r] && r < h); t.match_length = H - (h - r), t.match_length > t.lookahead && (t.match_length = t.lookahead) } if (t.match_length >= E ? (s = e._tr_tally(t, 1, t.match_length - E), t.lookahead -= t.match_length, t.strstart += t.match_length, t.match_length = 0) : (s = e._tr_tally(t, 0, t.window[t.strstart]), t.lookahead-- , t.strstart++), s && (tt(t, !1), 0 === t.strm.avail_out)) return Q } return t.insert = 0, a === _ ? (tt(t, !0), 0 === t.strm.avail_out ? U : V) : t.last_lit && (tt(t, !1), 0 === t.strm.avail_out) ? Q : T } function dt(t, a) { for (var s; ;) { if (0 === t.lookahead && (rt(t), 0 === t.lookahead)) { if (a === n) return Q; break } if (t.match_length = 0, s = e._tr_tally(t, 0, t.window[t.strstart]), t.lookahead-- , t.strstart++ , s && (tt(t, !1), 0 === t.strm.avail_out)) return Q } return t.insert = 0, a === _ ? (tt(t, !0), 0 === t.strm.avail_out ? U : V) : t.last_lit && (tt(t, !1), 0 === t.strm.avail_out) ? Q : T } function ot(t, a, e, s, i) { this.good_length = t, this.max_lazy = a, this.nice_length = e, this.max_chain = s, this.func = i } function ut(a) { a.window_size = 2 * a.w_size, Z(a.head), a.max_lazy_match = t[a.level].max_lazy, a.good_match = t[a.level].good_length, a.nice_match = t[a.level].nice_length, a.max_chain_length = t[a.level].max_chain, a.strstart = 0, a.block_start = 0, a.lookahead = 0, a.insert = 0, a.match_length = a.prev_length = E - 1, a.match_available = 0, a.ins_h = 0 } function gt() { this.strm = null, this.status = 0, this.pending_buf = null, this.pending_buf_size = 0, this.pending_out = 0, this.pending = 0, this.wrap = 0, this.gzhead = null, this.gzindex = 0, this.method = x, this.last_flush = -1, this.w_size = 0, this.w_bits = 0, this.w_mask = 0, this.window = null, this.window_size = 0, this.prev = null, this.head = null, this.ins_h = 0, this.hash_size = 0, this.hash_bits = 0, this.hash_mask = 0, this.hash_shift = 0, this.block_start = 0, this.match_length = 0, this.prev_match = 0, this.match_available = 0, this.strstart = 0, this.match_start = 0, this.lookahead = 0, this.prev_length = 0, this.max_chain_length = 0, this.max_lazy_match = 0, this.level = 0, this.strategy = 0, this.good_match = 0, this.nice_match = 0, this.dyn_ltree = new a.Buf16(2 * j), this.dyn_dtree = new a.Buf16(2 * (2 * C + 1)), this.bl_tree = new a.Buf16(2 * (2 * R + 1)), Z(this.dyn_ltree), Z(this.dyn_dtree), Z(this.bl_tree), this.l_desc = null, this.d_desc = null, this.bl_desc = null, this.bl_count = new a.Buf16(D + 1), this.heap = new a.Buf16(2 * A + 1), Z(this.heap), this.heap_len = 0, this.heap_max = 0, this.depth = new a.Buf16(2 * A + 1), Z(this.depth), this.l_buf = 0, this.lit_bufsize = 0, this.last_lit = 0, this.d_buf = 0, this.opt_len = 0, this.static_len = 0, this.matches = 0, this.insert = 0, this.bi_buf = 0, this.bi_valid = 0 } function ft(t) { var a; return t && t.state ? (t.total_in = t.total_out = 0, t.data_type = b, (a = t.state).pending = 0, a.pending_out = 0, a.wrap < 0 && (a.wrap = -a.wrap), a.status = a.wrap ? F : O, t.adler = 2 === a.wrap ? 0 : 1, a.last_flush = n, e._tr_init(a), o) : X(t, g) } function ct(t) { var a = ft(t); return a === o && ut(t.state), a } function pt(t, a) { return t && t.state ? 2 !== t.state.wrap ? g : (t.state.gzhead = a, o) : g } function mt(t, e, s, i, r, n) { if (!t) return g; var h = 1; if (e === p && (e = 6), i < 0 ? (h = 0, i = -i) : i > 15 && (h = 2, i -= 16), r < 1 || r > y || s !== x || i < 8 || i > 15 || e < 0 || e > 9 || n < 0 || n > k) return X(t, g); 8 === i && (i = 9); var l = new gt; return t.state = l, l.strm = t, l.wrap = h, l.gzhead = null, l.w_bits = i, l.w_size = 1 << l.w_bits, l.w_mask = l.w_size - 1, l.hash_bits = r + 7, l.hash_size = 1 << l.hash_bits, l.hash_mask = l.hash_size - 1, l.hash_shift = ~~((l.hash_bits + E - 1) / E), l.window = new a.Buf8(2 * l.w_size), l.head = new a.Buf16(l.hash_size), l.prev = new a.Buf16(l.w_size), l.lit_bufsize = 1 << r + 6, l.pending_buf_size = 4 * l.lit_bufsize, l.pending_buf = new a.Buf8(l.pending_buf_size), l.d_buf = 1 * l.lit_bufsize, l.l_buf = 3 * l.lit_bufsize, l.level = e, l.strategy = n, l.method = s, ct(t) } function wt(t, a) { return mt(t, a, x, B, S, z) } function vt(a, s) { var r, f, p, m; if (!a || !a.state || s > d || s < 0) return a ? X(a, g) : g; if (f = a.state, !a.output || !a.input && 0 !== a.avail_in || f.status === P && s !== _) return X(a, 0 === a.avail_out ? c : g); if (f.strm = a, r = f.last_flush, f.last_flush = s, f.status === F) if (2 === f.wrap) a.adler = 0, at(f, 31), at(f, 139), at(f, 8), f.gzhead ? (at(f, (f.gzhead.text ? 1 : 0) + (f.gzhead.hcrc ? 2 : 0) + (f.gzhead.extra ? 4 : 0) + (f.gzhead.name ? 8 : 0) + (f.gzhead.comment ? 16 : 0)), at(f, 255 & f.gzhead.time), at(f, f.gzhead.time >> 8 & 255), at(f, f.gzhead.time >> 16 & 255), at(f, f.gzhead.time >> 24 & 255), at(f, 9 === f.level ? 2 : f.strategy >= w || f.level < 2 ? 4 : 0), at(f, 255 & f.gzhead.os), f.gzhead.extra && f.gzhead.extra.length && (at(f, 255 & f.gzhead.extra.length), at(f, f.gzhead.extra.length >> 8 & 255)), f.gzhead.hcrc && (a.adler = i(a.adler, f.pending_buf, f.pending, 0)), f.gzindex = 0, f.status = G) : (at(f, 0), at(f, 0), at(f, 0), at(f, 0), at(f, 0), at(f, 9 === f.level ? 2 : f.strategy >= w || f.level < 2 ? 4 : 0), at(f, W), f.status = O); else { var k = x + (f.w_bits - 8 << 4) << 8; k |= (f.strategy >= w || f.level < 2 ? 0 : f.level < 6 ? 1 : 6 === f.level ? 2 : 3) << 6, 0 !== f.strstart && (k |= N), k += 31 - k % 31, f.status = O, et(f, k), 0 !== f.strstart && (et(f, a.adler >>> 16), et(f, 65535 & a.adler)), a.adler = 1 } if (f.status === G) if (f.gzhead.extra) { for (p = f.pending; f.gzindex < (65535 & f.gzhead.extra.length) && (f.pending !== f.pending_buf_size || (f.gzhead.hcrc && f.pending > p && (a.adler = i(a.adler, f.pending_buf, f.pending - p, p)), $(a), p = f.pending, f.pending !== f.pending_buf_size));)at(f, 255 & f.gzhead.extra[f.gzindex]), f.gzindex++; f.gzhead.hcrc && f.pending > p && (a.adler = i(a.adler, f.pending_buf, f.pending - p, p)), f.gzindex === f.gzhead.extra.length && (f.gzindex = 0, f.status = J) } else f.status = J; if (f.status === J) if (f.gzhead.name) { p = f.pending; do { if (f.pending === f.pending_buf_size && (f.gzhead.hcrc && f.pending > p && (a.adler = i(a.adler, f.pending_buf, f.pending - p, p)), $(a), p = f.pending, f.pending === f.pending_buf_size)) { m = 1; break } m = f.gzindex < f.gzhead.name.length ? 255 & f.gzhead.name.charCodeAt(f.gzindex++) : 0, at(f, m) } while (0 !== m); f.gzhead.hcrc && f.pending > p && (a.adler = i(a.adler, f.pending_buf, f.pending - p, p)), 0 === m && (f.gzindex = 0, f.status = L) } else f.status = L; if (f.status === L) if (f.gzhead.comment) { p = f.pending; do { if (f.pending === f.pending_buf_size && (f.gzhead.hcrc && f.pending > p && (a.adler = i(a.adler, f.pending_buf, f.pending - p, p)), $(a), p = f.pending, f.pending === f.pending_buf_size)) { m = 1; break } m = f.gzindex < f.gzhead.comment.length ? 255 & f.gzhead.comment.charCodeAt(f.gzindex++) : 0, at(f, m) } while (0 !== m); f.gzhead.hcrc && f.pending > p && (a.adler = i(a.adler, f.pending_buf, f.pending - p, p)), 0 === m && (f.status = M) } else f.status = M; if (f.status === M && (f.gzhead.hcrc ? (f.pending + 2 > f.pending_buf_size && $(a), f.pending + 2 <= f.pending_buf_size && (at(f, 255 & a.adler), at(f, a.adler >> 8 & 255), a.adler = 0, f.status = O)) : f.status = O), 0 !== f.pending) { if ($(a), 0 === a.avail_out) return f.last_flush = -1, o } else if (0 === a.avail_in && Y(s) <= Y(r) && s !== _) return X(a, c); if (f.status === P && 0 !== a.avail_in) return X(a, c); if (0 !== a.avail_in || 0 !== f.lookahead || s !== n && f.status !== P) { var z = f.strategy === w ? dt(f, s) : f.strategy === v ? _t(f, s) : t[f.level].func(f, s); if (z !== U && z !== V || (f.status = P), z === Q || z === U) return 0 === a.avail_out && (f.last_flush = -1), o; if (z === T && (s === h ? e._tr_align(f) : s !== d && (e._tr_stored_block(f, 0, 0, !1), s === l && (Z(f.head), 0 === f.lookahead && (f.strstart = 0, f.block_start = 0, f.insert = 0))), $(a), 0 === a.avail_out)) return f.last_flush = -1, o } return s !== _ ? o : f.wrap <= 0 ? u : (2 === f.wrap ? (at(f, 255 & a.adler), at(f, a.adler >> 8 & 255), at(f, a.adler >> 16 & 255), at(f, a.adler >> 24 & 255), at(f, 255 & a.total_in), at(f, a.total_in >> 8 & 255), at(f, a.total_in >> 16 & 255), at(f, a.total_in >> 24 & 255)) : (et(f, a.adler >>> 16), et(f, 65535 & a.adler)), $(a), f.wrap > 0 && (f.wrap = -f.wrap), 0 !== f.pending ? o : u) } function kt(t) { var a; return t && t.state ? (a = t.state.status) !== F && a !== G && a !== J && a !== L && a !== M && a !== O && a !== P ? X(t, g) : (t.state = null, a === O ? X(t, f) : o) : g } function zt(t, e) { var i, r, n, h, l, _, d, u, f = e.length; if (!t || !t.state) return g; if (2 === (h = (i = t.state).wrap) || 1 === h && i.status !== F || i.lookahead) return g; for (1 === h && (t.adler = s(t.adler, e, f, 0)), i.wrap = 0, f >= i.w_size && (0 === h && (Z(i.head), i.strstart = 0, i.block_start = 0, i.insert = 0), u = new a.Buf8(i.w_size), a.arraySet(u, e, f - i.w_size, i.w_size, 0), e = u, f = i.w_size), l = t.avail_in, _ = t.next_in, d = t.input, t.avail_in = f, t.next_in = 0, t.input = e, rt(i); i.lookahead >= E;) { r = i.strstart, n = i.lookahead - (E - 1); do { i.ins_h = (i.ins_h << i.hash_shift ^ i.window[r + E - 1]) & i.hash_mask, i.prev[r & i.w_mask] = i.head[i.ins_h], i.head[i.ins_h] = r, r++ } while (--n); i.strstart = r, i.lookahead = E - 1, rt(i) } return i.strstart += i.lookahead, i.block_start = i.strstart, i.insert = i.lookahead, i.lookahead = 0, i.match_length = i.prev_length = E - 1, i.match_available = 0, t.next_in = _, t.input = d, t.avail_in = l, i.wrap = h, o } t = [new ot(0, 0, 0, 0, nt), new ot(4, 4, 8, 4, ht), new ot(4, 5, 16, 8, ht), new ot(4, 6, 32, 32, ht), new ot(4, 4, 16, 16, lt), new ot(8, 16, 32, 32, lt), new ot(8, 16, 128, 128, lt), new ot(8, 32, 128, 256, lt), new ot(32, 128, 258, 1024, lt), new ot(32, 258, 258, 4096, lt)], exports.deflateInit = wt, exports.deflateInit2 = mt, exports.deflateReset = ct, exports.deflateResetKeep = ft, exports.deflateSetHeader = pt, exports.deflate = vt, exports.deflateEnd = kt, exports.deflateSetDictionary = zt, exports.deflateInfo = "pako deflate (from Nodeca project)";
    }, { "../utils/common": "Cngu", "./trees": "Iy1V", "./adler32": "P885", "./crc32": "ntXC", "./messages": "spUl" }], "ZysO": [function (require, module, exports) {
        "use strict"; var i = 30, e = 12; module.exports = function (o, a) { var t, d, n, l, s, f, r, b, c, u, v, m, w, h, k, _, x, g, p, z, j, q, y, A, B; t = o.state, d = o.next_in, A = o.input, n = d + (o.avail_in - 5), l = o.next_out, B = o.output, s = l - (a - o.avail_out), f = l + (o.avail_out - 257), r = t.dmax, b = t.wsize, c = t.whave, u = t.wnext, v = t.window, m = t.hold, w = t.bits, h = t.lencode, k = t.distcode, _ = (1 << t.lenbits) - 1, x = (1 << t.distbits) - 1; i: do { w < 15 && (m += A[d++] << w, w += 8, m += A[d++] << w, w += 8), g = h[m & _]; e: for (; ;) { if (m >>>= p = g >>> 24, w -= p, 0 === (p = g >>> 16 & 255)) B[l++] = 65535 & g; else { if (!(16 & p)) { if (0 == (64 & p)) { g = h[(65535 & g) + (m & (1 << p) - 1)]; continue e } if (32 & p) { t.mode = e; break i } o.msg = "invalid literal/length code", t.mode = i; break i } z = 65535 & g, (p &= 15) && (w < p && (m += A[d++] << w, w += 8), z += m & (1 << p) - 1, m >>>= p, w -= p), w < 15 && (m += A[d++] << w, w += 8, m += A[d++] << w, w += 8), g = k[m & x]; o: for (; ;) { if (m >>>= p = g >>> 24, w -= p, !(16 & (p = g >>> 16 & 255))) { if (0 == (64 & p)) { g = k[(65535 & g) + (m & (1 << p) - 1)]; continue o } o.msg = "invalid distance code", t.mode = i; break i } if (j = 65535 & g, w < (p &= 15) && (m += A[d++] << w, (w += 8) < p && (m += A[d++] << w, w += 8)), (j += m & (1 << p) - 1) > r) { o.msg = "invalid distance too far back", t.mode = i; break i } if (m >>>= p, w -= p, j > (p = l - s)) { if ((p = j - p) > c && t.sane) { o.msg = "invalid distance too far back", t.mode = i; break i } if (q = 0, y = v, 0 === u) { if (q += b - p, p < z) { z -= p; do { B[l++] = v[q++] } while (--p); q = l - j, y = B } } else if (u < p) { if (q += b + u - p, (p -= u) < z) { z -= p; do { B[l++] = v[q++] } while (--p); if (q = 0, u < z) { z -= p = u; do { B[l++] = v[q++] } while (--p); q = l - j, y = B } } } else if (q += u - p, p < z) { z -= p; do { B[l++] = v[q++] } while (--p); q = l - j, y = B } for (; z > 2;)B[l++] = y[q++], B[l++] = y[q++], B[l++] = y[q++], z -= 3; z && (B[l++] = y[q++], z > 1 && (B[l++] = y[q++])) } else { q = l - j; do { B[l++] = B[q++], B[l++] = B[q++], B[l++] = B[q++], z -= 3 } while (z > 2); z && (B[l++] = B[q++], z > 1 && (B[l++] = B[q++])) } break } } break } } while (d < n && l < f); d -= z = w >> 3, m &= (1 << (w -= z << 3)) - 1, o.next_in = d, o.next_out = l, o.avail_in = d < n ? n - d + 5 : 5 - (d - n), o.avail_out = l < f ? f - l + 257 : 257 - (l - f), t.hold = m, t.bits = w };
    }, {}], "WdHS": [function (require, module, exports) {
        "use strict"; var r = require("../utils/common"), f = 15, i = 852, o = 592, e = 0, u = 1, t = 2, n = [3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0], l = [16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18, 19, 19, 19, 19, 20, 20, 20, 20, 21, 21, 21, 21, 16, 72, 78], s = [1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577, 0, 0], b = [16, 16, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 22, 23, 23, 24, 24, 25, 25, 26, 26, 27, 27, 28, 28, 29, 29, 64, 64]; module.exports = function (a, c, m, w, d, v, B, h) { var k, p, q, x, g, j, y, z, A, C = h.bits, D = 0, E = 0, F = 0, G = 0, H = 0, I = 0, J = 0, K = 0, L = 0, M = 0, N = null, O = 0, P = new r.Buf16(f + 1), Q = new r.Buf16(f + 1), R = null, S = 0; for (D = 0; D <= f; D++)P[D] = 0; for (E = 0; E < w; E++)P[c[m + E]]++; for (H = C, G = f; G >= 1 && 0 === P[G]; G--); if (H > G && (H = G), 0 === G) return d[v++] = 20971520, d[v++] = 20971520, h.bits = 1, 0; for (F = 1; F < G && 0 === P[F]; F++); for (H < F && (H = F), K = 1, D = 1; D <= f; D++)if (K <<= 1, (K -= P[D]) < 0) return -1; if (K > 0 && (a === e || 1 !== G)) return -1; for (Q[1] = 0, D = 1; D < f; D++)Q[D + 1] = Q[D] + P[D]; for (E = 0; E < w; E++)0 !== c[m + E] && (B[Q[c[m + E]]++] = E); if (a === e ? (N = R = B, j = 19) : a === u ? (N = n, O -= 257, R = l, S -= 257, j = 256) : (N = s, R = b, j = -1), M = 0, E = 0, D = F, g = v, I = H, J = 0, q = -1, x = (L = 1 << H) - 1, a === u && L > i || a === t && L > o) return 1; for (; ;) { y = D - J, B[E] < j ? (z = 0, A = B[E]) : B[E] > j ? (z = R[S + B[E]], A = N[O + B[E]]) : (z = 96, A = 0), k = 1 << D - J, F = p = 1 << I; do { d[g + (M >> J) + (p -= k)] = y << 24 | z << 16 | A | 0 } while (0 !== p); for (k = 1 << D - 1; M & k;)k >>= 1; if (0 !== k ? (M &= k - 1, M += k) : M = 0, E++ , 0 == --P[D]) { if (D === G) break; D = c[m + B[E]] } if (D > H && (M & x) !== q) { for (0 === J && (J = H), g += F, K = 1 << (I = D - J); I + J < G && !((K -= P[I + J]) <= 0);)I++ , K <<= 1; if (L += 1 << I, a === u && L > i || a === t && L > o) return 1; d[q = M & x] = H << 24 | I << 16 | g - v | 0 } } return 0 !== M && (d[g + M] = D - J << 24 | 64 << 16 | 0), h.bits = H, 0 };
    }, { "../utils/common": "Cngu" }], "3Geg": [function (require, module, exports) {
        "use strict"; var e = require("../utils/common"), a = require("./adler32"), t = require("./crc32"), i = require("./inffast"), s = require("./inftrees"), n = 0, r = 1, o = 2, d = 4, l = 5, f = 6, c = 0, h = 1, k = 2, b = -2, m = -3, w = -4, u = -5, g = 8, v = 1, x = 2, p = 3, _ = 4, y = 5, z = 6, B = 7, S = 8, q = 9, C = 10, I = 11, R = 12, j = 13, A = 14, D = 15, E = 16, G = 17, H = 18, K = 19, N = 20, F = 21, J = 22, L = 23, M = 24, O = 25, P = 26, Q = 27, T = 28, U = 29, V = 30, W = 31, X = 32, Y = 852, Z = 592, $ = 15, ee = $; function ae(e) { return (e >>> 24 & 255) + (e >>> 8 & 65280) + ((65280 & e) << 8) + ((255 & e) << 24) } function te() { this.mode = 0, this.last = !1, this.wrap = 0, this.havedict = !1, this.flags = 0, this.dmax = 0, this.check = 0, this.total = 0, this.head = null, this.wbits = 0, this.wsize = 0, this.whave = 0, this.wnext = 0, this.window = null, this.hold = 0, this.bits = 0, this.length = 0, this.offset = 0, this.extra = 0, this.lencode = null, this.distcode = null, this.lenbits = 0, this.distbits = 0, this.ncode = 0, this.nlen = 0, this.ndist = 0, this.have = 0, this.next = null, this.lens = new e.Buf16(320), this.work = new e.Buf16(288), this.lendyn = null, this.distdyn = null, this.sane = 0, this.back = 0, this.was = 0 } function ie(a) { var t; return a && a.state ? (t = a.state, a.total_in = a.total_out = t.total = 0, a.msg = "", t.wrap && (a.adler = 1 & t.wrap), t.mode = v, t.last = 0, t.havedict = 0, t.dmax = 32768, t.head = null, t.hold = 0, t.bits = 0, t.lencode = t.lendyn = new e.Buf32(Y), t.distcode = t.distdyn = new e.Buf32(Z), t.sane = 1, t.back = -1, c) : b } function se(e) { var a; return e && e.state ? ((a = e.state).wsize = 0, a.whave = 0, a.wnext = 0, ie(e)) : b } function ne(e, a) { var t, i; return e && e.state ? (i = e.state, a < 0 ? (t = 0, a = -a) : (t = 1 + (a >> 4), a < 48 && (a &= 15)), a && (a < 8 || a > 15) ? b : (null !== i.window && i.wbits !== a && (i.window = null), i.wrap = t, i.wbits = a, se(e))) : b } function re(e, a) { var t, i; return e ? (i = new te, e.state = i, i.window = null, (t = ne(e, a)) !== c && (e.state = null), t) : b } function oe(e) { return re(e, ee) } var de, le, fe = !0; function ce(a) { if (fe) { var t; for (de = new e.Buf32(512), le = new e.Buf32(32), t = 0; t < 144;)a.lens[t++] = 8; for (; t < 256;)a.lens[t++] = 9; for (; t < 280;)a.lens[t++] = 7; for (; t < 288;)a.lens[t++] = 8; for (s(r, a.lens, 0, 288, de, 0, a.work, { bits: 9 }), t = 0; t < 32;)a.lens[t++] = 5; s(o, a.lens, 0, 32, le, 0, a.work, { bits: 5 }), fe = !1 } a.lencode = de, a.lenbits = 9, a.distcode = le, a.distbits = 5 } function he(a, t, i, s) { var n, r = a.state; return null === r.window && (r.wsize = 1 << r.wbits, r.wnext = 0, r.whave = 0, r.window = new e.Buf8(r.wsize)), s >= r.wsize ? (e.arraySet(r.window, t, i - r.wsize, r.wsize, 0), r.wnext = 0, r.whave = r.wsize) : ((n = r.wsize - r.wnext) > s && (n = s), e.arraySet(r.window, t, i - s, n, r.wnext), (s -= n) ? (e.arraySet(r.window, t, i - s, s, 0), r.wnext = s, r.whave = r.wsize) : (r.wnext += n, r.wnext === r.wsize && (r.wnext = 0), r.whave < r.wsize && (r.whave += n))), 0 } function ke(Y, Z) { var $, ee, te, ie, se, ne, re, oe, de, le, fe, ke, be, me, we, ue, ge, ve, xe, pe, _e, ye, ze, Be, Se = 0, qe = new e.Buf8(4), Ce = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]; if (!Y || !Y.state || !Y.output || !Y.input && 0 !== Y.avail_in) return b; ($ = Y.state).mode === R && ($.mode = j), se = Y.next_out, te = Y.output, re = Y.avail_out, ie = Y.next_in, ee = Y.input, ne = Y.avail_in, oe = $.hold, de = $.bits, le = ne, fe = re, ye = c; e: for (; ;)switch ($.mode) { case v: if (0 === $.wrap) { $.mode = j; break } for (; de < 16;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if (2 & $.wrap && 35615 === oe) { $.check = 0, qe[0] = 255 & oe, qe[1] = oe >>> 8 & 255, $.check = t($.check, qe, 2, 0), oe = 0, de = 0, $.mode = x; break } if ($.flags = 0, $.head && ($.head.done = !1), !(1 & $.wrap) || (((255 & oe) << 8) + (oe >> 8)) % 31) { Y.msg = "incorrect header check", $.mode = V; break } if ((15 & oe) !== g) { Y.msg = "unknown compression method", $.mode = V; break } if (de -= 4, _e = 8 + (15 & (oe >>>= 4)), 0 === $.wbits) $.wbits = _e; else if (_e > $.wbits) { Y.msg = "invalid window size", $.mode = V; break } $.dmax = 1 << _e, Y.adler = $.check = 1, $.mode = 512 & oe ? C : R, oe = 0, de = 0; break; case x: for (; de < 16;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if ($.flags = oe, (255 & $.flags) !== g) { Y.msg = "unknown compression method", $.mode = V; break } if (57344 & $.flags) { Y.msg = "unknown header flags set", $.mode = V; break } $.head && ($.head.text = oe >> 8 & 1), 512 & $.flags && (qe[0] = 255 & oe, qe[1] = oe >>> 8 & 255, $.check = t($.check, qe, 2, 0)), oe = 0, de = 0, $.mode = p; case p: for (; de < 32;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } $.head && ($.head.time = oe), 512 & $.flags && (qe[0] = 255 & oe, qe[1] = oe >>> 8 & 255, qe[2] = oe >>> 16 & 255, qe[3] = oe >>> 24 & 255, $.check = t($.check, qe, 4, 0)), oe = 0, de = 0, $.mode = _; case _: for (; de < 16;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } $.head && ($.head.xflags = 255 & oe, $.head.os = oe >> 8), 512 & $.flags && (qe[0] = 255 & oe, qe[1] = oe >>> 8 & 255, $.check = t($.check, qe, 2, 0)), oe = 0, de = 0, $.mode = y; case y: if (1024 & $.flags) { for (; de < 16;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } $.length = oe, $.head && ($.head.extra_len = oe), 512 & $.flags && (qe[0] = 255 & oe, qe[1] = oe >>> 8 & 255, $.check = t($.check, qe, 2, 0)), oe = 0, de = 0 } else $.head && ($.head.extra = null); $.mode = z; case z: if (1024 & $.flags && ((ke = $.length) > ne && (ke = ne), ke && ($.head && (_e = $.head.extra_len - $.length, $.head.extra || ($.head.extra = new Array($.head.extra_len)), e.arraySet($.head.extra, ee, ie, ke, _e)), 512 & $.flags && ($.check = t($.check, ee, ke, ie)), ne -= ke, ie += ke, $.length -= ke), $.length)) break e; $.length = 0, $.mode = B; case B: if (2048 & $.flags) { if (0 === ne) break e; ke = 0; do { _e = ee[ie + ke++], $.head && _e && $.length < 65536 && ($.head.name += String.fromCharCode(_e)) } while (_e && ke < ne); if (512 & $.flags && ($.check = t($.check, ee, ke, ie)), ne -= ke, ie += ke, _e) break e } else $.head && ($.head.name = null); $.length = 0, $.mode = S; case S: if (4096 & $.flags) { if (0 === ne) break e; ke = 0; do { _e = ee[ie + ke++], $.head && _e && $.length < 65536 && ($.head.comment += String.fromCharCode(_e)) } while (_e && ke < ne); if (512 & $.flags && ($.check = t($.check, ee, ke, ie)), ne -= ke, ie += ke, _e) break e } else $.head && ($.head.comment = null); $.mode = q; case q: if (512 & $.flags) { for (; de < 16;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if (oe !== (65535 & $.check)) { Y.msg = "header crc mismatch", $.mode = V; break } oe = 0, de = 0 } $.head && ($.head.hcrc = $.flags >> 9 & 1, $.head.done = !0), Y.adler = $.check = 0, $.mode = R; break; case C: for (; de < 32;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } Y.adler = $.check = ae(oe), oe = 0, de = 0, $.mode = I; case I: if (0 === $.havedict) return Y.next_out = se, Y.avail_out = re, Y.next_in = ie, Y.avail_in = ne, $.hold = oe, $.bits = de, k; Y.adler = $.check = 1, $.mode = R; case R: if (Z === l || Z === f) break e; case j: if ($.last) { oe >>>= 7 & de, de -= 7 & de, $.mode = Q; break } for (; de < 3;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } switch ($.last = 1 & oe, de -= 1, 3 & (oe >>>= 1)) { case 0: $.mode = A; break; case 1: if (ce($), $.mode = N, Z === f) { oe >>>= 2, de -= 2; break e } break; case 2: $.mode = G; break; case 3: Y.msg = "invalid block type", $.mode = V }oe >>>= 2, de -= 2; break; case A: for (oe >>>= 7 & de, de -= 7 & de; de < 32;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if ((65535 & oe) != (oe >>> 16 ^ 65535)) { Y.msg = "invalid stored block lengths", $.mode = V; break } if ($.length = 65535 & oe, oe = 0, de = 0, $.mode = D, Z === f) break e; case D: $.mode = E; case E: if (ke = $.length) { if (ke > ne && (ke = ne), ke > re && (ke = re), 0 === ke) break e; e.arraySet(te, ee, ie, ke, se), ne -= ke, ie += ke, re -= ke, se += ke, $.length -= ke; break } $.mode = R; break; case G: for (; de < 14;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if ($.nlen = 257 + (31 & oe), oe >>>= 5, de -= 5, $.ndist = 1 + (31 & oe), oe >>>= 5, de -= 5, $.ncode = 4 + (15 & oe), oe >>>= 4, de -= 4, $.nlen > 286 || $.ndist > 30) { Y.msg = "too many length or distance symbols", $.mode = V; break } $.have = 0, $.mode = H; case H: for (; $.have < $.ncode;) { for (; de < 3;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } $.lens[Ce[$.have++]] = 7 & oe, oe >>>= 3, de -= 3 } for (; $.have < 19;)$.lens[Ce[$.have++]] = 0; if ($.lencode = $.lendyn, $.lenbits = 7, ze = { bits: $.lenbits }, ye = s(n, $.lens, 0, 19, $.lencode, 0, $.work, ze), $.lenbits = ze.bits, ye) { Y.msg = "invalid code lengths set", $.mode = V; break } $.have = 0, $.mode = K; case K: for (; $.have < $.nlen + $.ndist;) { for (; ue = (Se = $.lencode[oe & (1 << $.lenbits) - 1]) >>> 16 & 255, ge = 65535 & Se, !((we = Se >>> 24) <= de);) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if (ge < 16) oe >>>= we, de -= we, $.lens[$.have++] = ge; else { if (16 === ge) { for (Be = we + 2; de < Be;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if (oe >>>= we, de -= we, 0 === $.have) { Y.msg = "invalid bit length repeat", $.mode = V; break } _e = $.lens[$.have - 1], ke = 3 + (3 & oe), oe >>>= 2, de -= 2 } else if (17 === ge) { for (Be = we + 3; de < Be;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } de -= we, _e = 0, ke = 3 + (7 & (oe >>>= we)), oe >>>= 3, de -= 3 } else { for (Be = we + 7; de < Be;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } de -= we, _e = 0, ke = 11 + (127 & (oe >>>= we)), oe >>>= 7, de -= 7 } if ($.have + ke > $.nlen + $.ndist) { Y.msg = "invalid bit length repeat", $.mode = V; break } for (; ke--;)$.lens[$.have++] = _e } } if ($.mode === V) break; if (0 === $.lens[256]) { Y.msg = "invalid code -- missing end-of-block", $.mode = V; break } if ($.lenbits = 9, ze = { bits: $.lenbits }, ye = s(r, $.lens, 0, $.nlen, $.lencode, 0, $.work, ze), $.lenbits = ze.bits, ye) { Y.msg = "invalid literal/lengths set", $.mode = V; break } if ($.distbits = 6, $.distcode = $.distdyn, ze = { bits: $.distbits }, ye = s(o, $.lens, $.nlen, $.ndist, $.distcode, 0, $.work, ze), $.distbits = ze.bits, ye) { Y.msg = "invalid distances set", $.mode = V; break } if ($.mode = N, Z === f) break e; case N: $.mode = F; case F: if (ne >= 6 && re >= 258) { Y.next_out = se, Y.avail_out = re, Y.next_in = ie, Y.avail_in = ne, $.hold = oe, $.bits = de, i(Y, fe), se = Y.next_out, te = Y.output, re = Y.avail_out, ie = Y.next_in, ee = Y.input, ne = Y.avail_in, oe = $.hold, de = $.bits, $.mode === R && ($.back = -1); break } for ($.back = 0; ue = (Se = $.lencode[oe & (1 << $.lenbits) - 1]) >>> 16 & 255, ge = 65535 & Se, !((we = Se >>> 24) <= de);) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if (ue && 0 == (240 & ue)) { for (ve = we, xe = ue, pe = ge; ue = (Se = $.lencode[pe + ((oe & (1 << ve + xe) - 1) >> ve)]) >>> 16 & 255, ge = 65535 & Se, !(ve + (we = Se >>> 24) <= de);) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } oe >>>= ve, de -= ve, $.back += ve } if (oe >>>= we, de -= we, $.back += we, $.length = ge, 0 === ue) { $.mode = P; break } if (32 & ue) { $.back = -1, $.mode = R; break } if (64 & ue) { Y.msg = "invalid literal/length code", $.mode = V; break } $.extra = 15 & ue, $.mode = J; case J: if ($.extra) { for (Be = $.extra; de < Be;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } $.length += oe & (1 << $.extra) - 1, oe >>>= $.extra, de -= $.extra, $.back += $.extra } $.was = $.length, $.mode = L; case L: for (; ue = (Se = $.distcode[oe & (1 << $.distbits) - 1]) >>> 16 & 255, ge = 65535 & Se, !((we = Se >>> 24) <= de);) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if (0 == (240 & ue)) { for (ve = we, xe = ue, pe = ge; ue = (Se = $.distcode[pe + ((oe & (1 << ve + xe) - 1) >> ve)]) >>> 16 & 255, ge = 65535 & Se, !(ve + (we = Se >>> 24) <= de);) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } oe >>>= ve, de -= ve, $.back += ve } if (oe >>>= we, de -= we, $.back += we, 64 & ue) { Y.msg = "invalid distance code", $.mode = V; break } $.offset = ge, $.extra = 15 & ue, $.mode = M; case M: if ($.extra) { for (Be = $.extra; de < Be;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } $.offset += oe & (1 << $.extra) - 1, oe >>>= $.extra, de -= $.extra, $.back += $.extra } if ($.offset > $.dmax) { Y.msg = "invalid distance too far back", $.mode = V; break } $.mode = O; case O: if (0 === re) break e; if (ke = fe - re, $.offset > ke) { if ((ke = $.offset - ke) > $.whave && $.sane) { Y.msg = "invalid distance too far back", $.mode = V; break } ke > $.wnext ? (ke -= $.wnext, be = $.wsize - ke) : be = $.wnext - ke, ke > $.length && (ke = $.length), me = $.window } else me = te, be = se - $.offset, ke = $.length; ke > re && (ke = re), re -= ke, $.length -= ke; do { te[se++] = me[be++] } while (--ke); 0 === $.length && ($.mode = F); break; case P: if (0 === re) break e; te[se++] = $.length, re-- , $.mode = F; break; case Q: if ($.wrap) { for (; de < 32;) { if (0 === ne) break e; ne-- , oe |= ee[ie++] << de, de += 8 } if (fe -= re, Y.total_out += fe, $.total += fe, fe && (Y.adler = $.check = $.flags ? t($.check, te, fe, se - fe) : a($.check, te, fe, se - fe)), fe = re, ($.flags ? oe : ae(oe)) !== $.check) { Y.msg = "incorrect data check", $.mode = V; break } oe = 0, de = 0 } $.mode = T; case T: if ($.wrap && $.flags) { for (; de < 32;) { if (0 === ne) break e; ne-- , oe += ee[ie++] << de, de += 8 } if (oe !== (4294967295 & $.total)) { Y.msg = "incorrect length check", $.mode = V; break } oe = 0, de = 0 } $.mode = U; case U: ye = h; break e; case V: ye = m; break e; case W: return w; case X: default: return b }return Y.next_out = se, Y.avail_out = re, Y.next_in = ie, Y.avail_in = ne, $.hold = oe, $.bits = de, ($.wsize || fe !== Y.avail_out && $.mode < V && ($.mode < Q || Z !== d)) && he(Y, Y.output, Y.next_out, fe - Y.avail_out) ? ($.mode = W, w) : (le -= Y.avail_in, fe -= Y.avail_out, Y.total_in += le, Y.total_out += fe, $.total += fe, $.wrap && fe && (Y.adler = $.check = $.flags ? t($.check, te, fe, Y.next_out - fe) : a($.check, te, fe, Y.next_out - fe)), Y.data_type = $.bits + ($.last ? 64 : 0) + ($.mode === R ? 128 : 0) + ($.mode === N || $.mode === D ? 256 : 0), (0 === le && 0 === fe || Z === d) && ye === c && (ye = u), ye) } function be(e) { if (!e || !e.state) return b; var a = e.state; return a.window && (a.window = null), e.state = null, c } function me(e, a) { var t; return e && e.state ? 0 == (2 & (t = e.state).wrap) ? b : (t.head = a, a.done = !1, c) : b } function we(e, t) { var i, s = t.length; return e && e.state ? 0 !== (i = e.state).wrap && i.mode !== I ? b : i.mode === I && a(1, t, s, 0) !== i.check ? m : he(e, t, s, s) ? (i.mode = W, w) : (i.havedict = 1, c) : b } exports.inflateReset = se, exports.inflateReset2 = ne, exports.inflateResetKeep = ie, exports.inflateInit = oe, exports.inflateInit2 = re, exports.inflate = ke, exports.inflateEnd = be, exports.inflateGetHeader = me, exports.inflateSetDictionary = we, exports.inflateInfo = "pako inflate (from Nodeca project)";
    }, { "../utils/common": "Cngu", "./adler32": "P885", "./crc32": "ntXC", "./inffast": "ZysO", "./inftrees": "WdHS" }], "ecLr": [function (require, module, exports) {
        "use strict"; module.exports = { Z_NO_FLUSH: 0, Z_PARTIAL_FLUSH: 1, Z_SYNC_FLUSH: 2, Z_FULL_FLUSH: 3, Z_FINISH: 4, Z_BLOCK: 5, Z_TREES: 6, Z_OK: 0, Z_STREAM_END: 1, Z_NEED_DICT: 2, Z_ERRNO: -1, Z_STREAM_ERROR: -2, Z_DATA_ERROR: -3, Z_BUF_ERROR: -5, Z_NO_COMPRESSION: 0, Z_BEST_SPEED: 1, Z_BEST_COMPRESSION: 9, Z_DEFAULT_COMPRESSION: -1, Z_FILTERED: 1, Z_HUFFMAN_ONLY: 2, Z_RLE: 3, Z_FIXED: 4, Z_DEFAULT_STRATEGY: 0, Z_BINARY: 0, Z_TEXT: 1, Z_UNKNOWN: 2, Z_DEFLATED: 8 };
    }, {}], "MId7": [function (require, module, exports) {
        var Buffer = require("buffer").Buffer;
        var process = require("process");
        var t = require("buffer").Buffer, e = require("process"), s = require("assert"), r = require("pako/lib/zlib/zstream"), i = require("pako/lib/zlib/deflate.js"), o = require("pako/lib/zlib/inflate.js"), h = require("pako/lib/zlib/constants"); for (var n in h) exports[n] = h[n]; exports.NONE = 0, exports.DEFLATE = 1, exports.INFLATE = 2, exports.GZIP = 3, exports.GUNZIP = 4, exports.DEFLATERAW = 5, exports.INFLATERAW = 6, exports.UNZIP = 7; var a = 31, p = 139; function _(t) { if ("number" != typeof t || t < exports.DEFLATE || t > exports.UNZIP) throw new TypeError("Bad argument"); this.dictionary = null, this.err = 0, this.flush = 0, this.init_done = !1, this.level = 0, this.memLevel = 0, this.mode = t, this.strategy = 0, this.windowBits = 0, this.write_in_progress = !1, this.pending_close = !1, this.gzip_id_bytes_read = 0 } _.prototype.close = function () { this.write_in_progress ? this.pending_close = !0 : (this.pending_close = !1, s(this.init_done, "close before init"), s(this.mode <= exports.UNZIP), this.mode === exports.DEFLATE || this.mode === exports.GZIP || this.mode === exports.DEFLATERAW ? i.deflateEnd(this.strm) : this.mode !== exports.INFLATE && this.mode !== exports.GUNZIP && this.mode !== exports.INFLATERAW && this.mode !== exports.UNZIP || o.inflateEnd(this.strm), this.mode = exports.NONE, this.dictionary = null) }, _.prototype.write = function (t, e, s, r, i, o, h) { return this._write(!0, t, e, s, r, i, o, h) }, _.prototype.writeSync = function (t, e, s, r, i, o, h) { return this._write(!1, t, e, s, r, i, o, h) }, _.prototype._write = function (r, i, o, h, n, a, p, _) { if (s.equal(arguments.length, 8), s(this.init_done, "write before init"), s(this.mode !== exports.NONE, "already finalized"), s.equal(!1, this.write_in_progress, "write already in progress"), s.equal(!1, this.pending_close, "close is pending"), this.write_in_progress = !0, s.equal(!1, void 0 === i, "must provide flush value"), this.write_in_progress = !0, i !== exports.Z_NO_FLUSH && i !== exports.Z_PARTIAL_FLUSH && i !== exports.Z_SYNC_FLUSH && i !== exports.Z_FULL_FLUSH && i !== exports.Z_FINISH && i !== exports.Z_BLOCK) throw new Error("Invalid flush value"); if (null == o && (o = t.alloc(0), n = 0, h = 0), this.strm.avail_in = n, this.strm.input = o, this.strm.next_in = h, this.strm.avail_out = _, this.strm.output = a, this.strm.next_out = p, this.flush = i, !r) return this._process(), this._checkError() ? this._afterSync() : void 0; var l = this; return e.nextTick(function () { l._process(), l._after() }), this }, _.prototype._afterSync = function () { var t = this.strm.avail_out, e = this.strm.avail_in; return this.write_in_progress = !1, [e, t] }, _.prototype._process = function () { var t = null; switch (this.mode) { case exports.DEFLATE: case exports.GZIP: case exports.DEFLATERAW: this.err = i.deflate(this.strm, this.flush); break; case exports.UNZIP: switch (this.strm.avail_in > 0 && (t = this.strm.next_in), this.gzip_id_bytes_read) { case 0: if (null === t) break; if (this.strm.input[t] !== a) { this.mode = exports.INFLATE; break } if (this.gzip_id_bytes_read = 1, t++ , 1 === this.strm.avail_in) break; case 1: if (null === t) break; this.strm.input[t] === p ? (this.gzip_id_bytes_read = 2, this.mode = exports.GUNZIP) : this.mode = exports.INFLATE; break; default: throw new Error("invalid number of gzip magic number bytes read") }case exports.INFLATE: case exports.GUNZIP: case exports.INFLATERAW: for (this.err = o.inflate(this.strm, this.flush), this.err === exports.Z_NEED_DICT && this.dictionary && (this.err = o.inflateSetDictionary(this.strm, this.dictionary), this.err === exports.Z_OK ? this.err = o.inflate(this.strm, this.flush) : this.err === exports.Z_DATA_ERROR && (this.err = exports.Z_NEED_DICT)); this.strm.avail_in > 0 && this.mode === exports.GUNZIP && this.err === exports.Z_STREAM_END && 0 !== this.strm.next_in[0];)this.reset(), this.err = o.inflate(this.strm, this.flush); break; default: throw new Error("Unknown mode " + this.mode) } }, _.prototype._checkError = function () { switch (this.err) { case exports.Z_OK: case exports.Z_BUF_ERROR: if (0 !== this.strm.avail_out && this.flush === exports.Z_FINISH) return this._error("unexpected end of file"), !1; break; case exports.Z_STREAM_END: break; case exports.Z_NEED_DICT: return null == this.dictionary ? this._error("Missing dictionary") : this._error("Bad dictionary"), !1; default: return this._error("Zlib error"), !1 }return !0 }, _.prototype._after = function () { if (this._checkError()) { var t = this.strm.avail_out, e = this.strm.avail_in; this.write_in_progress = !1, this.callback(e, t), this.pending_close && this.close() } }, _.prototype._error = function (t) { this.strm.msg && (t = this.strm.msg), this.onerror(t, this.err), this.write_in_progress = !1, this.pending_close && this.close() }, _.prototype.init = function (t, e, r, i, o) { s(4 === arguments.length || 5 === arguments.length, "init(windowBits, level, memLevel, strategy, [dictionary])"), s(t >= 8 && t <= 15, "invalid windowBits"), s(e >= -1 && e <= 9, "invalid compression level"), s(r >= 1 && r <= 9, "invalid memlevel"), s(i === exports.Z_FILTERED || i === exports.Z_HUFFMAN_ONLY || i === exports.Z_RLE || i === exports.Z_FIXED || i === exports.Z_DEFAULT_STRATEGY, "invalid strategy"), this._init(e, t, r, i, o), this._setDictionary() }, _.prototype.params = function () { throw new Error("deflateParams Not supported") }, _.prototype.reset = function () { this._reset(), this._setDictionary() }, _.prototype._init = function (t, e, s, h, n) { switch (this.level = t, this.windowBits = e, this.memLevel = s, this.strategy = h, this.flush = exports.Z_NO_FLUSH, this.err = exports.Z_OK, this.mode !== exports.GZIP && this.mode !== exports.GUNZIP || (this.windowBits += 16), this.mode === exports.UNZIP && (this.windowBits += 32), this.mode !== exports.DEFLATERAW && this.mode !== exports.INFLATERAW || (this.windowBits = -1 * this.windowBits), this.strm = new r, this.mode) { case exports.DEFLATE: case exports.GZIP: case exports.DEFLATERAW: this.err = i.deflateInit2(this.strm, this.level, exports.Z_DEFLATED, this.windowBits, this.memLevel, this.strategy); break; case exports.INFLATE: case exports.GUNZIP: case exports.INFLATERAW: case exports.UNZIP: this.err = o.inflateInit2(this.strm, this.windowBits); break; default: throw new Error("Unknown mode " + this.mode) }this.err !== exports.Z_OK && this._error("Init error"), this.dictionary = n, this.write_in_progress = !1, this.init_done = !0 }, _.prototype._setDictionary = function () { if (null != this.dictionary) { switch (this.err = exports.Z_OK, this.mode) { case exports.DEFLATE: case exports.DEFLATERAW: this.err = i.deflateSetDictionary(this.strm, this.dictionary) }this.err !== exports.Z_OK && this._error("Failed to set dictionary") } }, _.prototype._reset = function () { switch (this.err = exports.Z_OK, this.mode) { case exports.DEFLATE: case exports.DEFLATERAW: case exports.GZIP: this.err = i.deflateReset(this.strm); break; case exports.INFLATE: case exports.INFLATERAW: case exports.GUNZIP: this.err = o.inflateReset(this.strm) }this.err !== exports.Z_OK && this._error("Failed to reset stream") }, exports.Zlib = _;
    }, { "assert": "DlZn", "pako/lib/zlib/zstream": "wru8", "pako/lib/zlib/deflate.js": "d27Y", "pako/lib/zlib/inflate.js": "3Geg", "pako/lib/zlib/constants": "ecLr", "buffer": "dskh", "process": "pBGv" }], "gfUn": [function (require, module, exports) {
        var global = arguments[3];
        var process = require("process");
        var e = arguments[3], t = require("process"), r = /%[sdj%]/g; exports.format = function (e) { if (!v(e)) { for (var t = [], n = 0; n < arguments.length; n++)t.push(i(arguments[n])); return t.join(" ") } n = 1; for (var o = arguments, s = o.length, u = String(e).replace(r, function (e) { if ("%%" === e) return "%"; if (n >= s) return e; switch (e) { case "%s": return String(o[n++]); case "%d": return Number(o[n++]); case "%j": try { return JSON.stringify(o[n++]) } catch (t) { return "[Circular]" } default: return e } }), c = o[n]; n < s; c = o[++n])h(c) || !z(c) ? u += " " + c : u += " " + i(c); return u }, exports.deprecate = function (r, n) { if (j(e.process)) return function () { return exports.deprecate(r, n).apply(this, arguments) }; if (!0 === t.noDeprecation) return r; var o = !1; return function () { if (!o) { if (t.throwDeprecation) throw new Error(n); t.traceDeprecation ? console.trace(n) : console.error(n), o = !0 } return r.apply(this, arguments) } }; var n, o = {}; function i(e, t) { var r = { seen: [], stylize: u }; return arguments.length >= 3 && (r.depth = arguments[2]), arguments.length >= 4 && (r.colors = arguments[3]), x(t) ? r.showHidden = t : t && exports._extend(r, t), j(r.showHidden) && (r.showHidden = !1), j(r.depth) && (r.depth = 2), j(r.colors) && (r.colors = !1), j(r.customInspect) && (r.customInspect = !0), r.colors && (r.stylize = s), p(r, e, r.depth) } function s(e, t) { var r = i.styles[t]; return r ? "[" + i.colors[r][0] + "m" + e + "[" + i.colors[r][1] + "m" : e } function u(e, t) { return e } function c(e) { var t = {}; return e.forEach(function (e, r) { t[e] = !0 }), t } function p(e, t, r) { if (e.customInspect && t && D(t.inspect) && t.inspect !== exports.inspect && (!t.constructor || t.constructor.prototype !== t)) { var n = t.inspect(r, e); return v(n) || (n = p(e, n, r)), n } var o = l(e, t); if (o) return o; var i = Object.keys(t), s = c(i); if (e.showHidden && (i = Object.getOwnPropertyNames(t)), E(t) && (i.indexOf("message") >= 0 || i.indexOf("description") >= 0)) return a(t); if (0 === i.length) { if (D(t)) { var u = t.name ? ": " + t.name : ""; return e.stylize("[Function" + u + "]", "special") } if (O(t)) return e.stylize(RegExp.prototype.toString.call(t), "regexp"); if (w(t)) return e.stylize(Date.prototype.toString.call(t), "date"); if (E(t)) return a(t) } var x, h = "", b = !1, m = ["{", "}"]; (d(t) && (b = !0, m = ["[", "]"]), D(t)) && (h = " [Function" + (t.name ? ": " + t.name : "") + "]"); return O(t) && (h = " " + RegExp.prototype.toString.call(t)), w(t) && (h = " " + Date.prototype.toUTCString.call(t)), E(t) && (h = " " + a(t)), 0 !== i.length || b && 0 != t.length ? r < 0 ? O(t) ? e.stylize(RegExp.prototype.toString.call(t), "regexp") : e.stylize("[Object]", "special") : (e.seen.push(t), x = b ? f(e, t, r, s, i) : i.map(function (n) { return g(e, t, r, s, n, b) }), e.seen.pop(), y(x, h, m)) : m[0] + h + m[1] } function l(e, t) { if (j(t)) return e.stylize("undefined", "undefined"); if (v(t)) { var r = "'" + JSON.stringify(t).replace(/^"|"$/g, "").replace(/'/g, "\\'").replace(/\\"/g, '"') + "'"; return e.stylize(r, "string") } return m(t) ? e.stylize("" + t, "number") : x(t) ? e.stylize("" + t, "boolean") : h(t) ? e.stylize("null", "null") : void 0 } function a(e) { return "[" + Error.prototype.toString.call(e) + "]" } function f(e, t, r, n, o) { for (var i = [], s = 0, u = t.length; s < u; ++s)$(t, String(s)) ? i.push(g(e, t, r, n, String(s), !0)) : i.push(""); return o.forEach(function (o) { o.match(/^\d+$/) || i.push(g(e, t, r, n, o, !0)) }), i } function g(e, t, r, n, o, i) { var s, u, c; if ((c = Object.getOwnPropertyDescriptor(t, o) || { value: t[o] }).get ? u = c.set ? e.stylize("[Getter/Setter]", "special") : e.stylize("[Getter]", "special") : c.set && (u = e.stylize("[Setter]", "special")), $(n, o) || (s = "[" + o + "]"), u || (e.seen.indexOf(c.value) < 0 ? (u = h(r) ? p(e, c.value, null) : p(e, c.value, r - 1)).indexOf("\n") > -1 && (u = i ? u.split("\n").map(function (e) { return "  " + e }).join("\n").substr(2) : "\n" + u.split("\n").map(function (e) { return "   " + e }).join("\n")) : u = e.stylize("[Circular]", "special")), j(s)) { if (i && o.match(/^\d+$/)) return u; (s = JSON.stringify("" + o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/) ? (s = s.substr(1, s.length - 2), s = e.stylize(s, "name")) : (s = s.replace(/'/g, "\\'").replace(/\\"/g, '"').replace(/(^"|"$)/g, "'"), s = e.stylize(s, "string")) } return s + ": " + u } function y(e, t, r) { return e.reduce(function (e, t) { return 0, t.indexOf("\n") >= 0 && 0, e + t.replace(/\u001b\[\d\d?m/g, "").length + 1 }, 0) > 60 ? r[0] + ("" === t ? "" : t + "\n ") + " " + e.join(",\n  ") + " " + r[1] : r[0] + t + " " + e.join(", ") + " " + r[1] } function d(e) { return Array.isArray(e) } function x(e) { return "boolean" == typeof e } function h(e) { return null === e } function b(e) { return null == e } function m(e) { return "number" == typeof e } function v(e) { return "string" == typeof e } function S(e) { return "symbol" == typeof e } function j(e) { return void 0 === e } function O(e) { return z(e) && "[object RegExp]" === A(e) } function z(e) { return "object" == typeof e && null !== e } function w(e) { return z(e) && "[object Date]" === A(e) } function E(e) { return z(e) && ("[object Error]" === A(e) || e instanceof Error) } function D(e) { return "function" == typeof e } function N(e) { return null === e || "boolean" == typeof e || "number" == typeof e || "string" == typeof e || "symbol" == typeof e || void 0 === e } function A(e) { return Object.prototype.toString.call(e) } function J(e) { return e < 10 ? "0" + e.toString(10) : e.toString(10) } exports.debuglog = function (e) { if (j(n) && (n = ""), e = e.toUpperCase(), !o[e]) if (new RegExp("\\b" + e + "\\b", "i").test(n)) { var r = t.pid; o[e] = function () { var t = exports.format.apply(exports, arguments); console.error("%s %d: %s", e, r, t) } } else o[e] = function () { }; return o[e] }, exports.inspect = i, i.colors = { bold: [1, 22], italic: [3, 23], underline: [4, 24], inverse: [7, 27], white: [37, 39], grey: [90, 39], black: [30, 39], blue: [34, 39], cyan: [36, 39], green: [32, 39], magenta: [35, 39], red: [31, 39], yellow: [33, 39] }, i.styles = { special: "cyan", number: "yellow", boolean: "yellow", undefined: "grey", null: "bold", string: "green", date: "magenta", regexp: "red" }, exports.isArray = d, exports.isBoolean = x, exports.isNull = h, exports.isNullOrUndefined = b, exports.isNumber = m, exports.isString = v, exports.isSymbol = S, exports.isUndefined = j, exports.isRegExp = O, exports.isObject = z, exports.isDate = w, exports.isError = E, exports.isFunction = D, exports.isPrimitive = N, exports.isBuffer = require("./support/isBuffer"); var R = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; function H() { var e = new Date, t = [J(e.getHours()), J(e.getMinutes()), J(e.getSeconds())].join(":"); return [e.getDate(), R[e.getMonth()], t].join(" ") } function $(e, t) { return Object.prototype.hasOwnProperty.call(e, t) } exports.log = function () { console.log("%s - %s", H(), exports.format.apply(exports, arguments)) }, exports.inherits = require("inherits"), exports._extend = function (e, t) { if (!t || !z(t)) return e; for (var r = Object.keys(t), n = r.length; n--;)e[r[n]] = t[r[n]]; return e };
    }, { "./support/isBuffer": "a7/e", "inherits": "4Bm0", "process": "pBGv" }], "a/TY": [function (require, module, exports) {

        var process = require("process");
        var e = require("process"), t = require("buffer").Buffer, n = require("stream").Transform, r = require("./binding"), i = require("util"), o = require("assert").ok, s = require("buffer").kMaxLength, f = "Cannot create final Buffer. It would be larger than 0x" + s.toString(16) + " bytes"; r.Z_MIN_WINDOWBITS = 8, r.Z_MAX_WINDOWBITS = 15, r.Z_DEFAULT_WINDOWBITS = 15, r.Z_MIN_CHUNK = 64, r.Z_MAX_CHUNK = 1 / 0, r.Z_DEFAULT_CHUNK = 16384, r.Z_MIN_MEMLEVEL = 1, r.Z_MAX_MEMLEVEL = 9, r.Z_DEFAULT_MEMLEVEL = 8, r.Z_MIN_LEVEL = -1, r.Z_MAX_LEVEL = 9, r.Z_DEFAULT_LEVEL = r.Z_DEFAULT_COMPRESSION; for (var l = Object.keys(r), _ = 0; _ < l.length; _++) { var u = l[_]; u.match(/^Z/) && Object.defineProperty(exports, u, { enumerable: !0, value: r[u], writable: !1 }) } for (var a = { Z_OK: r.Z_OK, Z_STREAM_END: r.Z_STREAM_END, Z_NEED_DICT: r.Z_NEED_DICT, Z_ERRNO: r.Z_ERRNO, Z_STREAM_ERROR: r.Z_STREAM_ERROR, Z_DATA_ERROR: r.Z_DATA_ERROR, Z_MEM_ERROR: r.Z_MEM_ERROR, Z_BUF_ERROR: r.Z_BUF_ERROR, Z_VERSION_ERROR: r.Z_VERSION_ERROR }, h = Object.keys(a), c = 0; c < h.length; c++) { var p = h[c]; a[a[p]] = p } function E(e, n, r) { var i = [], o = 0; function l() { for (var t; null !== (t = e.read());)i.push(t), o += t.length; e.once("readable", l) } function _() { var n, l = null; o >= s ? l = new RangeError(f) : n = t.concat(i, o), i = [], e.close(), r(l, n) } e.on("error", function (t) { e.removeListener("end", _), e.removeListener("readable", l), r(t) }), e.on("end", _), e.end(n), l() } function d(e, n) { if ("string" == typeof n && (n = t.from(n)), !t.isBuffer(n)) throw new TypeError("Not a string or buffer"); var r = e._finishFlushFlag; return e._processChunk(n, r) } function w(e) { if (!(this instanceof w)) return new w(e); S.call(this, e, r.DEFLATE) } function Z(e) { if (!(this instanceof Z)) return new Z(e); S.call(this, e, r.INFLATE) } function L(e) { if (!(this instanceof L)) return new L(e); S.call(this, e, r.GZIP) } function R(e) { if (!(this instanceof R)) return new R(e); S.call(this, e, r.GUNZIP) } function v(e) { if (!(this instanceof v)) return new v(e); S.call(this, e, r.DEFLATERAW) } function x(e) { if (!(this instanceof x)) return new x(e); S.call(this, e, r.INFLATERAW) } function I(e) { if (!(this instanceof I)) return new I(e); S.call(this, e, r.UNZIP) } function g(e) { return e === r.Z_NO_FLUSH || e === r.Z_PARTIAL_FLUSH || e === r.Z_SYNC_FLUSH || e === r.Z_FULL_FLUSH || e === r.Z_FINISH || e === r.Z_BLOCK } function S(e, i) { var o = this; if (this._opts = e = e || {}, this._chunkSize = e.chunkSize || exports.Z_DEFAULT_CHUNK, n.call(this, e), e.flush && !g(e.flush)) throw new Error("Invalid flush flag: " + e.flush); if (e.finishFlush && !g(e.finishFlush)) throw new Error("Invalid flush flag: " + e.finishFlush); if (this._flushFlag = e.flush || r.Z_NO_FLUSH, this._finishFlushFlag = void 0 !== e.finishFlush ? e.finishFlush : r.Z_FINISH, e.chunkSize && (e.chunkSize < exports.Z_MIN_CHUNK || e.chunkSize > exports.Z_MAX_CHUNK)) throw new Error("Invalid chunk size: " + e.chunkSize); if (e.windowBits && (e.windowBits < exports.Z_MIN_WINDOWBITS || e.windowBits > exports.Z_MAX_WINDOWBITS)) throw new Error("Invalid windowBits: " + e.windowBits); if (e.level && (e.level < exports.Z_MIN_LEVEL || e.level > exports.Z_MAX_LEVEL)) throw new Error("Invalid compression level: " + e.level); if (e.memLevel && (e.memLevel < exports.Z_MIN_MEMLEVEL || e.memLevel > exports.Z_MAX_MEMLEVEL)) throw new Error("Invalid memLevel: " + e.memLevel); if (e.strategy && e.strategy != exports.Z_FILTERED && e.strategy != exports.Z_HUFFMAN_ONLY && e.strategy != exports.Z_RLE && e.strategy != exports.Z_FIXED && e.strategy != exports.Z_DEFAULT_STRATEGY) throw new Error("Invalid strategy: " + e.strategy); if (e.dictionary && !t.isBuffer(e.dictionary)) throw new Error("Invalid dictionary: it should be a Buffer instance"); this._handle = new r.Zlib(i); var s = this; this._hadError = !1, this._handle.onerror = function (e, t) { y(s), s._hadError = !0; var n = new Error(e); n.errno = t, n.code = exports.codes[t], s.emit("error", n) }; var f = exports.Z_DEFAULT_COMPRESSION; "number" == typeof e.level && (f = e.level); var l = exports.Z_DEFAULT_STRATEGY; "number" == typeof e.strategy && (l = e.strategy), this._handle.init(e.windowBits || exports.Z_DEFAULT_WINDOWBITS, f, e.memLevel || exports.Z_DEFAULT_MEMLEVEL, l, e.dictionary), this._buffer = t.allocUnsafe(this._chunkSize), this._offset = 0, this._level = f, this._strategy = l, this.once("end", this.close), Object.defineProperty(this, "_closed", { get: function () { return !o._handle }, configurable: !0, enumerable: !0 }) } function y(t, n) { n && e.nextTick(n), t._handle && (t._handle.close(), t._handle = null) } function F(e) { e.emit("close") } Object.defineProperty(exports, "codes", { enumerable: !0, value: Object.freeze(a), writable: !1 }), exports.Deflate = w, exports.Inflate = Z, exports.Gzip = L, exports.Gunzip = R, exports.DeflateRaw = v, exports.InflateRaw = x, exports.Unzip = I, exports.createDeflate = function (e) { return new w(e) }, exports.createInflate = function (e) { return new Z(e) }, exports.createDeflateRaw = function (e) { return new v(e) }, exports.createInflateRaw = function (e) { return new x(e) }, exports.createGzip = function (e) { return new L(e) }, exports.createGunzip = function (e) { return new R(e) }, exports.createUnzip = function (e) { return new I(e) }, exports.deflate = function (e, t, n) { return "function" == typeof t && (n = t, t = {}), E(new w(t), e, n) }, exports.deflateSync = function (e, t) { return d(new w(t), e) }, exports.gzip = function (e, t, n) { return "function" == typeof t && (n = t, t = {}), E(new L(t), e, n) }, exports.gzipSync = function (e, t) { return d(new L(t), e) }, exports.deflateRaw = function (e, t, n) { return "function" == typeof t && (n = t, t = {}), E(new v(t), e, n) }, exports.deflateRawSync = function (e, t) { return d(new v(t), e) }, exports.unzip = function (e, t, n) { return "function" == typeof t && (n = t, t = {}), E(new I(t), e, n) }, exports.unzipSync = function (e, t) { return d(new I(t), e) }, exports.inflate = function (e, t, n) { return "function" == typeof t && (n = t, t = {}), E(new Z(t), e, n) }, exports.inflateSync = function (e, t) { return d(new Z(t), e) }, exports.gunzip = function (e, t, n) { return "function" == typeof t && (n = t, t = {}), E(new R(t), e, n) }, exports.gunzipSync = function (e, t) { return d(new R(t), e) }, exports.inflateRaw = function (e, t, n) { return "function" == typeof t && (n = t, t = {}), E(new x(t), e, n) }, exports.inflateRawSync = function (e, t) { return d(new x(t), e) }, i.inherits(S, n), S.prototype.params = function (t, n, i) { if (t < exports.Z_MIN_LEVEL || t > exports.Z_MAX_LEVEL) throw new RangeError("Invalid compression level: " + t); if (n != exports.Z_FILTERED && n != exports.Z_HUFFMAN_ONLY && n != exports.Z_RLE && n != exports.Z_FIXED && n != exports.Z_DEFAULT_STRATEGY) throw new TypeError("Invalid strategy: " + n); if (this._level !== t || this._strategy !== n) { var s = this; this.flush(r.Z_SYNC_FLUSH, function () { o(s._handle, "zlib binding closed"), s._handle.params(t, n), s._hadError || (s._level = t, s._strategy = n, i && i()) }) } else e.nextTick(i) }, S.prototype.reset = function () { return o(this._handle, "zlib binding closed"), this._handle.reset() }, S.prototype._flush = function (e) { this._transform(t.alloc(0), "", e) }, S.prototype.flush = function (n, i) { var o = this, s = this._writableState; ("function" == typeof n || void 0 === n && !i) && (i = n, n = r.Z_FULL_FLUSH), s.ended ? i && e.nextTick(i) : s.ending ? i && this.once("end", i) : s.needDrain ? i && this.once("drain", function () { return o.flush(n, i) }) : (this._flushFlag = n, this.write(t.alloc(0), "", i)) }, S.prototype.close = function (t) { y(this, t), e.nextTick(F, this) }, S.prototype._transform = function (e, n, i) { var o, s = this._writableState, f = (s.ending || s.ended) && (!e || s.length === e.length); return null === e || t.isBuffer(e) ? this._handle ? (f ? o = this._finishFlushFlag : (o = this._flushFlag, e.length >= s.length && (this._flushFlag = this._opts.flush || r.Z_NO_FLUSH)), void this._processChunk(e, o, i)) : i(new Error("zlib binding closed")) : i(new Error("invalid input")) }, S.prototype._processChunk = function (e, n, r) { var i = e && e.length, l = this._chunkSize - this._offset, _ = 0, u = this, a = "function" == typeof r; if (!a) { var h, c = [], p = 0; this.on("error", function (e) { h = e }), o(this._handle, "zlib binding closed"); do { var E = this._handle.writeSync(n, e, _, i, this._buffer, this._offset, l) } while (!this._hadError && Z(E[0], E[1])); if (this._hadError) throw h; if (p >= s) throw y(this), new RangeError(f); var d = t.concat(c, p); return y(this), d } o(this._handle, "zlib binding closed"); var w = this._handle.write(n, e, _, i, this._buffer, this._offset, l); function Z(s, f) { if (this && (this.buffer = null, this.callback = null), !u._hadError) { var h = l - f; if (o(h >= 0, "have should not go down"), h > 0) { var E = u._buffer.slice(u._offset, u._offset + h); u._offset += h, a ? u.push(E) : (c.push(E), p += E.length) } if ((0 === f || u._offset >= u._chunkSize) && (l = u._chunkSize, u._offset = 0, u._buffer = t.allocUnsafe(u._chunkSize)), 0 === f) { if (_ += i - s, i = s, !a) return !0; var d = u._handle.write(n, e, _, i, u._buffer, u._offset, u._chunkSize); return d.callback = Z, void (d.buffer = e) } if (!a) return !1; r() } } w.buffer = e, w.callback = Z }, i.inherits(w, S), i.inherits(Z, S), i.inherits(L, S), i.inherits(R, S), i.inherits(v, S), i.inherits(x, S), i.inherits(I, S);
    }, { "buffer": "dskh", "stream": "fnRj", "./binding": "MId7", "util": "gfUn", "assert": "DlZn", "process": "pBGv" }], "kHha": [function (require, module, exports) {
        module.exports = { _args: [["axios@0.18.0", "C:\\Users\\Matthew\\Documents\\git\\webshed"]], _from: "axios@0.18.0", _id: "axios@0.18.0", _inBundle: !1, _integrity: "sha1-MtU+SFHv3AoRmTts0AB4nXDAUQI=", _location: "/axios", _phantomChildren: {}, _requested: { type: "version", registry: !0, raw: "axios@0.18.0", name: "axios", escapedName: "axios", rawSpec: "0.18.0", saveSpec: null, fetchSpec: "0.18.0" }, _requiredBy: ["/"], _resolved: "http://registry.npmjs.org/axios/-/axios-0.18.0.tgz", _spec: "0.18.0", _where: "C:\\Users\\Matthew\\Documents\\git\\webshed", author: { name: "Matt Zabriskie" }, browser: { "./lib/adapters/http.js": "./lib/adapters/xhr.js" }, bugs: { url: "https://github.com/axios/axios/issues" }, bundlesize: [{ path: "./dist/axios.min.js", threshold: "5kB" }], dependencies: { "follow-redirects": "^1.3.0", "is-buffer": "^1.1.5" }, description: "Promise based HTTP client for the browser and node.js", devDependencies: { bundlesize: "^0.5.7", coveralls: "^2.11.9", "es6-promise": "^4.0.5", grunt: "^1.0.1", "grunt-banner": "^0.6.0", "grunt-cli": "^1.2.0", "grunt-contrib-clean": "^1.0.0", "grunt-contrib-nodeunit": "^1.0.0", "grunt-contrib-watch": "^1.0.0", "grunt-eslint": "^19.0.0", "grunt-karma": "^2.0.0", "grunt-ts": "^6.0.0-beta.3", "grunt-webpack": "^1.0.18", "istanbul-instrumenter-loader": "^1.0.0", "jasmine-core": "^2.4.1", karma: "^1.3.0", "karma-chrome-launcher": "^2.0.0", "karma-coverage": "^1.0.0", "karma-firefox-launcher": "^1.0.0", "karma-jasmine": "^1.0.2", "karma-jasmine-ajax": "^0.1.13", "karma-opera-launcher": "^1.0.0", "karma-safari-launcher": "^1.0.0", "karma-sauce-launcher": "^1.1.0", "karma-sinon": "^1.0.5", "karma-sourcemap-loader": "^0.3.7", "karma-webpack": "^1.7.0", "load-grunt-tasks": "^3.5.2", minimist: "^1.2.0", sinon: "^1.17.4", typescript: "^2.0.3", "url-search-params": "^0.6.1", webpack: "^1.13.1", "webpack-dev-server": "^1.14.1" }, homepage: "https://github.com/axios/axios", keywords: ["xhr", "http", "ajax", "promise", "node"], license: "MIT", main: "index.js", name: "axios", repository: { type: "git", url: "git+https://github.com/axios/axios.git" }, scripts: { build: "NODE_ENV=production grunt build", coveralls: "cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js", examples: "node ./examples/server.js", postversion: "git push && git push --tags", preversion: "npm test", start: "node ./sandbox/server.js", test: "grunt test && bundlesize", version: "npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json" }, typings: "./index.d.ts", version: "0.18.0" };
    }, {}], "bRJm": [function (require, module, exports) {
        var Buffer = require("buffer").Buffer;
        var process = require("process");
        var e = require("buffer").Buffer, t = require("process"), r = require("./../utils"), a = require("./../core/settle"), o = require("./../helpers/buildURL"), n = require("http"), s = require("https"), i = require("follow-redirects").http, u = require("follow-redirects").https, h = require("url"), p = require("zlib"), c = require("./../../package.json"), f = require("../core/createError"), d = require("../core/enhanceError"); module.exports = function (m) { return new Promise(function (l, g) { var v, x = m.data, q = m.headers; if (q["User-Agent"] || q["user-agent"] || (q["User-Agent"] = "axios/" + c.version), x && !r.isStream(x)) { if (e.isBuffer(x)); else if (r.isArrayBuffer(x)) x = new e(new Uint8Array(x)); else { if (!r.isString(x)) return g(f("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream", m)); x = new e(x, "utf-8") } q["Content-Length"] = x.length } var b = void 0; m.auth && (b = (m.auth.username || "") + ":" + (m.auth.password || "")); var w = h.parse(m.url), C = w.protocol || "http:"; if (!b && w.auth) { var y = w.auth.split(":"); b = (y[0] || "") + ":" + (y[1] || "") } b && delete q.Authorization; var A = "https:" === C, L = A ? m.httpsAgent : m.httpAgent, B = { path: o(w.path, m.params, m.paramsSerializer).replace(/^\?/, ""), method: m.method, headers: q, agent: L, auth: b }; m.socketPath ? B.socketPath = m.socketPath : (B.hostname = w.hostname, B.port = w.port); var T, z = m.proxy; if (!z && !1 !== z) { var S = C.slice(0, -1) + "_proxy", k = t.env[S] || t.env[S.toUpperCase()]; if (k) { var R = h.parse(k); if (z = { host: R.hostname, port: R.port }, R.auth) { var U = R.auth.split(":"); z.auth = { username: U[0], password: U[1] } } } } if (z && (B.hostname = z.host, B.host = z.host, B.headers.host = w.hostname + (w.port ? ":" + w.port : ""), B.port = z.port, B.path = C + "//" + w.hostname + (w.port ? ":" + w.port : "") + B.path, z.auth)) { var P = new e(z.auth.username + ":" + z.auth.password, "utf8").toString("base64"); B.headers["Proxy-Authorization"] = "Basic " + P } m.transport ? T = m.transport : 0 === m.maxRedirects ? T = A ? s : n : (m.maxRedirects && (B.maxRedirects = m.maxRedirects), T = A ? u : i), m.maxContentLength && m.maxContentLength > -1 && (B.maxBodyLength = m.maxContentLength); var E = T.request(B, function (t) { if (!E.aborted) { clearTimeout(v), v = null; var r = t; switch (t.headers["content-encoding"]) { case "gzip": case "compress": case "deflate": r = r.pipe(p.createUnzip()), delete t.headers["content-encoding"] }var o = t.req || E, n = { status: t.statusCode, statusText: t.statusMessage, headers: t.headers, config: m, request: o }; if ("stream" === m.responseType) n.data = r, a(l, g, n); else { var s = []; r.on("data", function (t) { s.push(t), m.maxContentLength > -1 && e.concat(s).length > m.maxContentLength && g(f("maxContentLength size of " + m.maxContentLength + " exceeded", m, null, o)) }), r.on("error", function (e) { E.aborted || g(d(e, m, null, o)) }), r.on("end", function () { var t = e.concat(s); "arraybuffer" !== m.responseType && (t = t.toString("utf8")), n.data = t, a(l, g, n) }) } } }); E.on("error", function (e) { E.aborted || g(d(e, m, null, E)) }), m.timeout && !v && (v = setTimeout(function () { E.abort(), g(f("timeout of " + m.timeout + "ms exceeded", m, "ECONNABORTED", E)) }, m.timeout)), m.cancelToken && m.cancelToken.promise.then(function (e) { E.aborted || (E.abort(), g(e)) }), r.isStream(x) ? x.pipe(E) : E.end(x) }) };
    }, { "./../utils": "S1cf", "./../core/settle": "aS8y", "./../helpers/buildURL": "H6Qo", "http": "KKrj", "https": "wVMl", "follow-redirects": "3JCP", "url": "Mej7", "zlib": "a/TY", "./../../package.json": "kHha", "../core/createError": "3bIi", "../core/enhanceError": "YdsM", "buffer": "dskh", "process": "pBGv" }], "BXyq": [function (require, module, exports) {
        var process = require("process");
        var e = require("process"), t = require("./utils"), r = require("./helpers/normalizeHeaderName"), n = { "Content-Type": "application/x-www-form-urlencoded" }; function a(e, r) { !t.isUndefined(e) && t.isUndefined(e["Content-Type"]) && (e["Content-Type"] = r) } function i() { var t; return "undefined" != typeof XMLHttpRequest ? t = require("./adapters/xhr") : void 0 !== e && (t = require("./adapters/http")), t } var o = { adapter: i(), transformRequest: [function (e, n) { return r(n, "Content-Type"), t.isFormData(e) || t.isArrayBuffer(e) || t.isBuffer(e) || t.isStream(e) || t.isFile(e) || t.isBlob(e) ? e : t.isArrayBufferView(e) ? e.buffer : t.isURLSearchParams(e) ? (a(n, "application/x-www-form-urlencoded;charset=utf-8"), e.toString()) : t.isObject(e) ? (a(n, "application/json;charset=utf-8"), JSON.stringify(e)) : e }], transformResponse: [function (e) { if ("string" == typeof e) try { e = JSON.parse(e) } catch (t) { } return e }], timeout: 0, xsrfCookieName: "XSRF-TOKEN", xsrfHeaderName: "X-XSRF-TOKEN", maxContentLength: -1, validateStatus: function (e) { return e >= 200 && e < 300 }, headers: { common: { Accept: "application/json, text/plain, */*" } } }; t.forEach(["delete", "get", "head"], function (e) { o.headers[e] = {} }), t.forEach(["post", "put", "patch"], function (e) { o.headers[e] = t.merge(n) }), module.exports = o;
    }, { "./utils": "S1cf", "./helpers/normalizeHeaderName": "M8l6", "./adapters/xhr": "KRuG", "./adapters/http": "bRJm", "process": "pBGv" }], "rj2i": [function (require, module, exports) {
        "use strict"; var t = require("./../utils"); function e() { this.handlers = [] } e.prototype.use = function (t, e) { return this.handlers.push({ fulfilled: t, rejected: e }), this.handlers.length - 1 }, e.prototype.eject = function (t) { this.handlers[t] && (this.handlers[t] = null) }, e.prototype.forEach = function (e) { t.forEach(this.handlers, function (t) { null !== t && e(t) }) }, module.exports = e;
    }, { "./../utils": "S1cf" }], "woEt": [function (require, module, exports) {
        "use strict"; var r = require("./../utils"); module.exports = function (t, u, e) { return r.forEach(e, function (r) { t = r(t, u) }), t };
    }, { "./../utils": "S1cf" }], "V3+0": [function (require, module, exports) {
        "use strict"; module.exports = function (t) { return !(!t || !t.__CANCEL__) };
    }, {}], "7/2Y": [function (require, module, exports) {
        "use strict"; module.exports = function (t) { return /^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t) };
    }, {}], "a2Uu": [function (require, module, exports) {
        "use strict"; module.exports = function (e, r) { return r ? e.replace(/\/+$/, "") + "/" + r.replace(/^\/+/, "") : e };
    }, {}], "uz6X": [function (require, module, exports) {
        "use strict"; var e = require("./../utils"), r = require("./transformData"), a = require("../cancel/isCancel"), s = require("../defaults"), t = require("./../helpers/isAbsoluteURL"), n = require("./../helpers/combineURLs"); function o(e) { e.cancelToken && e.cancelToken.throwIfRequested() } module.exports = function (d) { return o(d), d.baseURL && !t(d.url) && (d.url = n(d.baseURL, d.url)), d.headers = d.headers || {}, d.data = r(d.data, d.headers, d.transformRequest), d.headers = e.merge(d.headers.common || {}, d.headers[d.method] || {}, d.headers || {}), e.forEach(["delete", "get", "head", "post", "put", "patch", "common"], function (e) { delete d.headers[e] }), (d.adapter || s.adapter)(d).then(function (e) { return o(d), e.data = r(e.data, e.headers, d.transformResponse), e }, function (e) { return a(e) || (o(d), e && e.response && (e.response.data = r(e.response.data, e.response.headers, d.transformResponse))), Promise.reject(e) }) };
    }, { "./../utils": "S1cf", "./transformData": "woEt", "../cancel/isCancel": "V3+0", "../defaults": "BXyq", "./../helpers/isAbsoluteURL": "7/2Y", "./../helpers/combineURLs": "a2Uu" }], "OvAf": [function (require, module, exports) {
        "use strict"; var e = require("./../defaults"), t = require("./../utils"), r = require("./InterceptorManager"), o = require("./dispatchRequest"); function s(e) { this.defaults = e, this.interceptors = { request: new r, response: new r } } s.prototype.request = function (r) { "string" == typeof r && (r = t.merge({ url: arguments[0] }, arguments[1])), (r = t.merge(e, { method: "get" }, this.defaults, r)).method = r.method.toLowerCase(); var s = [o, void 0], u = Promise.resolve(r); for (this.interceptors.request.forEach(function (e) { s.unshift(e.fulfilled, e.rejected) }), this.interceptors.response.forEach(function (e) { s.push(e.fulfilled, e.rejected) }); s.length;)u = u.then(s.shift(), s.shift()); return u }, t.forEach(["delete", "get", "head", "options"], function (e) { s.prototype[e] = function (r, o) { return this.request(t.merge(o || {}, { method: e, url: r })) } }), t.forEach(["post", "put", "patch"], function (e) { s.prototype[e] = function (r, o, s) { return this.request(t.merge(s || {}, { method: e, url: r, data: o })) } }), module.exports = s;
    }, { "./../defaults": "BXyq", "./../utils": "S1cf", "./InterceptorManager": "rj2i", "./dispatchRequest": "uz6X" }], "mI+K": [function (require, module, exports) {
        "use strict"; function t(t) { this.message = t } t.prototype.toString = function () { return "Cancel" + (this.message ? ": " + this.message : "") }, t.prototype.__CANCEL__ = !0, module.exports = t;
    }, {}], "tsWd": [function (require, module, exports) {
        "use strict"; var e = require("./Cancel"); function n(n) { if ("function" != typeof n) throw new TypeError("executor must be a function."); var o; this.promise = new Promise(function (e) { o = e }); var r = this; n(function (n) { r.reason || (r.reason = new e(n), o(r.reason)) }) } n.prototype.throwIfRequested = function () { if (this.reason) throw this.reason }, n.source = function () { var e; return { token: new n(function (n) { e = n }), cancel: e } }, module.exports = n;
    }, { "./Cancel": "mI+K" }], "X8jb": [function (require, module, exports) {
        "use strict"; module.exports = function (n) { return function (t) { return n.apply(null, t) } };
    }, {}], "nUiQ": [function (require, module, exports) {
        "use strict"; var e = require("./utils"), r = require("./helpers/bind"), n = require("./core/Axios"), t = require("./defaults"); function u(t) { var u = new n(t), l = r(n.prototype.request, u); return e.extend(l, n.prototype, u), e.extend(l, u), l } var l = u(t); l.Axios = n, l.create = function (r) { return u(e.merge(t, r)) }, l.Cancel = require("./cancel/Cancel"), l.CancelToken = require("./cancel/CancelToken"), l.isCancel = require("./cancel/isCancel"), l.all = function (e) { return Promise.all(e) }, l.spread = require("./helpers/spread"), module.exports = l, module.exports.default = l;
    }, { "./utils": "S1cf", "./helpers/bind": "ED/T", "./core/Axios": "OvAf", "./defaults": "BXyq", "./cancel/Cancel": "mI+K", "./cancel/CancelToken": "tsWd", "./cancel/isCancel": "V3+0", "./helpers/spread": "X8jb" }], "dZBD": [function (require, module, exports) {
        module.exports = require("./lib/axios");
    }, { "./lib/axios": "nUiQ" }], "Asjh": [function (require, module, exports) {
        "use strict"; var _ = "SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"; module.exports = _;
    }, {}], "wVGV": [function (require, module, exports) {
        "use strict"; var e = require("fbjs/lib/emptyFunction"), r = require("fbjs/lib/invariant"), t = require("./lib/ReactPropTypesSecret"); module.exports = function () { function o(e, o, p, n, s, a) { a !== t && r(!1, "Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types") } function p() { return o } o.isRequired = o; var n = { array: o, bool: o, func: o, number: o, object: o, string: o, symbol: o, any: o, arrayOf: p, element: o, instanceOf: p, node: o, objectOf: p, oneOf: p, oneOfType: p, shape: p, exact: p }; return n.checkPropTypes = e, n.PropTypes = n, n };
    }, { "fbjs/lib/emptyFunction": "UQex", "fbjs/lib/invariant": "wRU+", "./lib/ReactPropTypesSecret": "Asjh" }], "5D9O": [function (require, module, exports) {
        var r, e, i; module.exports = require("./factoryWithThrowingShims")();
    }, { "./factoryWithThrowingShims": "wVGV" }], "C4qV": [function (require, module, exports) {
        var global = arguments[3];
        var t = arguments[3]; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = function () { if ("undefined" != typeof Map) return Map; function t(t, e) { var n = -1; return t.some(function (t, r) { return t[0] === e && (n = r, !0) }), n } return function () { function e() { this.__entries__ = [] } var n = { size: { configurable: !0 } }; return n.size.get = function () { return this.__entries__.length }, e.prototype.get = function (e) { var n = t(this.__entries__, e), r = this.__entries__[n]; return r && r[1] }, e.prototype.set = function (e, n) { var r = t(this.__entries__, e); ~r ? this.__entries__[r][1] = n : this.__entries__.push([e, n]) }, e.prototype.delete = function (e) { var n = this.__entries__, r = t(n, e); ~r && n.splice(r, 1) }, e.prototype.has = function (e) { return !!~t(this.__entries__, e) }, e.prototype.clear = function () { this.__entries__.splice(0) }, e.prototype.forEach = function (t, e) { void 0 === e && (e = null); for (var n = 0, r = this.__entries__; n < r.length; n += 1) { var i = r[n]; t.call(e, i[1], i[0]) } }, Object.defineProperties(e.prototype, n), e }() }(), n = "undefined" != typeof window && "undefined" != typeof document && window.document === document, r = void 0 !== t && t.Math === Math ? t : "undefined" != typeof self && self.Math === Math ? self : "undefined" != typeof window && window.Math === Math ? window : Function("return this")(), i = "function" == typeof requestAnimationFrame ? requestAnimationFrame.bind(r) : function (t) { return setTimeout(function () { return t(Date.now()) }, 1e3 / 60) }, o = 2, s = function (t, e) { var n = !1, r = !1, s = 0; function a() { n && (n = !1, t()), r && h() } function c() { i(a) } function h() { var t = Date.now(); if (n) { if (t - s < o) return; r = !0 } else n = !0, r = !1, setTimeout(c, e); s = t } return h }, a = 20, c = ["top", "right", "bottom", "left", "width", "height", "size", "weight"], h = "undefined" != typeof MutationObserver, u = function () { this.connected_ = !1, this.mutationEventsAdded_ = !1, this.mutationsObserver_ = null, this.observers_ = [], this.onTransitionEnd_ = this.onTransitionEnd_.bind(this), this.refresh = s(this.refresh.bind(this), a) }; u.prototype.addObserver = function (t) { ~this.observers_.indexOf(t) || this.observers_.push(t), this.connected_ || this.connect_() }, u.prototype.removeObserver = function (t) { var e = this.observers_, n = e.indexOf(t); ~n && e.splice(n, 1), !e.length && this.connected_ && this.disconnect_() }, u.prototype.refresh = function () { this.updateObservers_() && this.refresh() }, u.prototype.updateObservers_ = function () { var t = this.observers_.filter(function (t) { return t.gatherActive(), t.hasActive() }); return t.forEach(function (t) { return t.broadcastActive() }), t.length > 0 }, u.prototype.connect_ = function () { n && !this.connected_ && (document.addEventListener("transitionend", this.onTransitionEnd_), window.addEventListener("resize", this.refresh), h ? (this.mutationsObserver_ = new MutationObserver(this.refresh), this.mutationsObserver_.observe(document, { attributes: !0, childList: !0, characterData: !0, subtree: !0 })) : (document.addEventListener("DOMSubtreeModified", this.refresh), this.mutationEventsAdded_ = !0), this.connected_ = !0) }, u.prototype.disconnect_ = function () { n && this.connected_ && (document.removeEventListener("transitionend", this.onTransitionEnd_), window.removeEventListener("resize", this.refresh), this.mutationsObserver_ && this.mutationsObserver_.disconnect(), this.mutationEventsAdded_ && document.removeEventListener("DOMSubtreeModified", this.refresh), this.mutationsObserver_ = null, this.mutationEventsAdded_ = !1, this.connected_ = !1) }, u.prototype.onTransitionEnd_ = function (t) { var e = t.propertyName; void 0 === e && (e = ""), c.some(function (t) { return !!~e.indexOf(t) }) && this.refresh() }, u.getInstance = function () { return this.instance_ || (this.instance_ = new u), this.instance_ }, u.instance_ = null; var f = function (t, e) { for (var n = 0, r = Object.keys(e); n < r.length; n += 1) { var i = r[n]; Object.defineProperty(t, i, { value: e[i], enumerable: !1, writable: !1, configurable: !0 }) } return t }, d = function (t) { return t && t.ownerDocument && t.ownerDocument.defaultView || r }, v = E(0, 0, 0, 0); function p(t) { return parseFloat(t) || 0 } function _(t) { for (var e = [], n = arguments.length - 1; n-- > 0;)e[n] = arguments[n + 1]; return e.reduce(function (e, n) { return e + p(t["border-" + n + "-width"]) }, 0) } function l(t) { for (var e = {}, n = 0, r = ["top", "right", "bottom", "left"]; n < r.length; n += 1) { var i = r[n], o = t["padding-" + i]; e[i] = p(o) } return e } function b(t) { var e = t.getBBox(); return E(0, 0, e.width, e.height) } function m(t) { var e = t.clientWidth, n = t.clientHeight; if (!e && !n) return v; var r = d(t).getComputedStyle(t), i = l(r), o = i.left + i.right, s = i.top + i.bottom, a = p(r.width), c = p(r.height); if ("border-box" === r.boxSizing && (Math.round(a + o) !== e && (a -= _(r, "left", "right") + o), Math.round(c + s) !== n && (c -= _(r, "top", "bottom") + s)), !w(t)) { var h = Math.round(a + o) - e, u = Math.round(c + s) - n; 1 !== Math.abs(h) && (a -= h), 1 !== Math.abs(u) && (c -= u) } return E(i.left, i.top, a, c) } var y = "undefined" != typeof SVGGraphicsElement ? function (t) { return t instanceof d(t).SVGGraphicsElement } : function (t) { return t instanceof d(t).SVGElement && "function" == typeof t.getBBox }; function w(t) { return t === d(t).document.documentElement } function g(t) { return n ? y(t) ? b(t) : m(t) : v } function O(t) { var e = t.x, n = t.y, r = t.width, i = t.height, o = "undefined" != typeof DOMRectReadOnly ? DOMRectReadOnly : Object, s = Object.create(o.prototype); return f(s, { x: e, y: n, width: r, height: i, top: n, right: e + r, bottom: i + n, left: e }), s } function E(t, e, n, r) { return { x: t, y: e, width: n, height: r } } var M = function (t) { this.broadcastWidth = 0, this.broadcastHeight = 0, this.contentRect_ = E(0, 0, 0, 0), this.target = t }; M.prototype.isActive = function () { var t = g(this.target); return this.contentRect_ = t, t.width !== this.broadcastWidth || t.height !== this.broadcastHeight }, M.prototype.broadcastRect = function () { var t = this.contentRect_; return this.broadcastWidth = t.width, this.broadcastHeight = t.height, t }; var A = function (t, e) { var n = O(e); f(this, { target: t, contentRect: n }) }, x = function (t, n, r) { if (this.activeObservations_ = [], this.observations_ = new e, "function" != typeof t) throw new TypeError("The callback provided as parameter 1 is not a function."); this.callback_ = t, this.controller_ = n, this.callbackCtx_ = r }; x.prototype.observe = function (t) { if (!arguments.length) throw new TypeError("1 argument required, but only 0 present."); if ("undefined" != typeof Element && Element instanceof Object) { if (!(t instanceof d(t).Element)) throw new TypeError('parameter 1 is not of type "Element".'); var e = this.observations_; e.has(t) || (e.set(t, new M(t)), this.controller_.addObserver(this), this.controller_.refresh()) } }, x.prototype.unobserve = function (t) { if (!arguments.length) throw new TypeError("1 argument required, but only 0 present."); if ("undefined" != typeof Element && Element instanceof Object) { if (!(t instanceof d(t).Element)) throw new TypeError('parameter 1 is not of type "Element".'); var e = this.observations_; e.has(t) && (e.delete(t), e.size || this.controller_.removeObserver(this)) } }, x.prototype.disconnect = function () { this.clearActive(), this.observations_.clear(), this.controller_.removeObserver(this) }, x.prototype.gatherActive = function () { var t = this; this.clearActive(), this.observations_.forEach(function (e) { e.isActive() && t.activeObservations_.push(e) }) }, x.prototype.broadcastActive = function () { if (this.hasActive()) { var t = this.callbackCtx_, e = this.activeObservations_.map(function (t) { return new A(t.target, t.broadcastRect()) }); this.callback_.call(t, e, t), this.clearActive() } }, x.prototype.clearActive = function () { this.activeObservations_.splice(0) }, x.prototype.hasActive = function () { return this.activeObservations_.length > 0 }; var T = "undefined" != typeof WeakMap ? new WeakMap : new e, R = function (t) { if (!(this instanceof R)) throw new TypeError("Cannot call a class as a function."); if (!arguments.length) throw new TypeError("1 argument required, but only 0 present."); var e = u.getInstance(), n = new x(t, e, this); T.set(this, n) };["observe", "unobserve", "disconnect"].forEach(function (t) { R.prototype[t] = function () { return (e = T.get(this))[t].apply(e, arguments); var e } }); var z = void 0 !== r.ResizeObserver ? r.ResizeObserver : R, D = z; exports.default = D;
    }, {}], "4PZ+": [function (require, module, exports) {
        var global = arguments[3];
        var t = arguments[3], e = "Expected a function", n = NaN, r = "[object Symbol]", i = /^\s+|\s+$/g, o = /^[-+]0x[0-9a-f]+$/i, u = /^0b[01]+$/i, f = /^0o[0-7]+$/i, c = parseInt, a = "object" == typeof t && t && t.Object === Object && t, s = "object" == typeof self && self && self.Object === Object && self, v = a || s || Function("return this")(), l = Object.prototype, p = l.toString, b = Math.max, m = Math.min, y = function () { return v.Date.now() }; function d(t, n, r) { var i, o, u, f, c, a, s = 0, v = !1, l = !1, p = !0; if ("function" != typeof t) throw new TypeError(e); function d(e) { var n = i, r = o; return i = o = void 0, s = e, f = t.apply(r, n) } function g(t) { var e = t - a; return void 0 === a || e >= n || e < 0 || l && t - s >= u } function O() { var t = y(); if (g(t)) return x(t); c = setTimeout(O, function (t) { var e = n - (t - a); return l ? m(e, u - (t - s)) : e }(t)) } function x(t) { return c = void 0, p && i ? d(t) : (i = o = void 0, f) } function T() { var t = y(), e = g(t); if (i = arguments, o = this, a = t, e) { if (void 0 === c) return function (t) { return s = t, c = setTimeout(O, n), v ? d(t) : f }(a); if (l) return c = setTimeout(O, n), d(a) } return void 0 === c && (c = setTimeout(O, n)), f } return n = h(n) || 0, j(r) && (v = !!r.leading, u = (l = "maxWait" in r) ? b(h(r.maxWait) || 0, n) : u, p = "trailing" in r ? !!r.trailing : p), T.cancel = function () { void 0 !== c && clearTimeout(c), s = 0, i = a = o = c = void 0 }, T.flush = function () { return void 0 === c ? f : x(y()) }, T } function j(t) { var e = typeof t; return !!t && ("object" == e || "function" == e) } function g(t) { return !!t && "object" == typeof t } function O(t) { return "symbol" == typeof t || g(t) && p.call(t) == r } function h(t) { if ("number" == typeof t) return t; if (O(t)) return n; if (j(t)) { var e = "function" == typeof t.valueOf ? t.valueOf() : t; t = j(e) ? e + "" : e } if ("string" != typeof t) return 0 === t ? t : +t; t = t.replace(i, ""); var r = u.test(t); return r || f.test(t) ? c(t.slice(2), r ? 2 : 8) : o.test(t) ? n : +t } module.exports = d;
    }, {}], "FNy/": [function (require, module, exports) {
        var global = arguments[3];
        var t = arguments[3], n = "Expected a function", e = NaN, i = "[object Symbol]", r = /^\s+|\s+$/g, o = /^[-+]0x[0-9a-f]+$/i, u = /^0b[01]+$/i, f = /^0o[0-7]+$/i, a = parseInt, c = "object" == typeof t && t && t.Object === Object && t, l = "object" == typeof self && self && self.Object === Object && self, s = c || l || Function("return this")(), v = Object.prototype, p = v.toString, y = Math.max, d = Math.min, m = function () { return s.Date.now() }; function b(t, e, i) { var r, o, u, f, a, c, l = 0, s = !1, v = !1, p = !0; if ("function" != typeof t) throw new TypeError(n); function b(n) { var e = r, i = o; return r = o = void 0, l = n, f = t.apply(i, e) } function g(t) { var n = t - c; return void 0 === c || n >= e || n < 0 || v && t - l >= u } function h() { var t = m(); if (g(t)) return x(t); a = setTimeout(h, function (t) { var n = e - (t - c); return v ? d(n, u - (t - l)) : n }(t)) } function x(t) { return a = void 0, p && r ? b(t) : (r = o = void 0, f) } function T() { var t = m(), n = g(t); if (r = arguments, o = this, c = t, n) { if (void 0 === a) return function (t) { return l = t, a = setTimeout(h, e), s ? b(t) : f }(c); if (v) return a = setTimeout(h, e), b(c) } return void 0 === a && (a = setTimeout(h, e)), f } return e = O(e) || 0, j(i) && (s = !!i.leading, u = (v = "maxWait" in i) ? y(O(i.maxWait) || 0, e) : u, p = "trailing" in i ? !!i.trailing : p), T.cancel = function () { void 0 !== a && clearTimeout(a), l = 0, r = c = o = a = void 0 }, T.flush = function () { return void 0 === a ? f : x(m()) }, T } function g(t, e, i) { var r = !0, o = !0; if ("function" != typeof t) throw new TypeError(n); return j(i) && (r = "leading" in i ? !!i.leading : r, o = "trailing" in i ? !!i.trailing : o), b(t, e, { leading: r, maxWait: e, trailing: o }) } function j(t) { var n = typeof t; return !!t && ("object" == n || "function" == n) } function h(t) { return !!t && "object" == typeof t } function x(t) { return "symbol" == typeof t || h(t) && p.call(t) == i } function O(t) { if ("number" == typeof t) return t; if (x(t)) return e; if (j(t)) { var n = "function" == typeof t.valueOf ? t.valueOf() : t; t = j(n) ? n + "" : n } if ("string" != typeof t) return 0 === t ? t : +t; t = t.replace(r, ""); var i = u.test(t); return i || f.test(t) ? a(t.slice(2), i ? 2 : 8) : o.test(t) ? e : +t } module.exports = g;
    }, {}], "py0T": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = function () { function e(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, r, n) { return r && e(t.prototype, r), n && e(t, n), t } }(), t = require("react"), r = d(t), n = require("prop-types"), o = d(n), i = require("resize-observer-polyfill"), u = d(i), l = require("lodash.debounce"), a = d(l), s = require("lodash.throttle"), f = d(s); function d(e) { return e && e.__esModule ? e : { default: e } } function h(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function c(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function p(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var b = { debounce: a.default, throttle: f.default }, v = { position: "absolute", width: 0, height: 0, visibility: "hidden", display: "none" }, y = function (n) { function o(e) { h(this, o); var t = c(this, (o.__proto__ || Object.getPrototypeOf(o)).call(this, e)); t.createResizeObserver = function (e) { var r = t.props, n = r.handleWidth, o = r.handleHeight, i = r.onResize; e.forEach(function (e) { var r = e.contentRect, u = r.width, l = r.height, a = n && t.width !== u, s = o && t.height !== l; t.skipOnMount || !a && !s || i(u, l), t.width = u, t.height = l, t.skipOnMount = !1 }) }; var r = e.skipOnMount, n = e.refreshMode, i = e.refreshRate; t.width = void 0, t.height = void 0, t.skipOnMount = r; var l = b[n] && b[n](t.createResizeObserver, i) || t.createResizeObserver; return t.ro = new u.default(l), t } return p(o, t.PureComponent), e(o, [{ key: "componentDidMount", value: function () { var e = this.props.resizableElementId, t = e ? document.getElementById(e) : this.el.parentElement; this.ro.observe(t) } }, { key: "componentWillUnmount", value: function () { var e = this.props.resizableElementId, t = e ? document.getElementById(e) : this.el.parentElement; this.ro.unobserve(t) } }, { key: "render", value: function () { var e = this; return r.default.createElement("div", { style: v, ref: function (t) { e.el = t } }) } }]), o }(); exports.default = y, y.propTypes = { handleWidth: o.default.bool, handleHeight: o.default.bool, skipOnMount: o.default.bool, refreshRate: o.default.number, refreshMode: o.default.string, resizableElementId: o.default.string, onResize: o.default.func }, y.defaultProps = { handleWidth: !1, handleHeight: !1, skipOnMount: !1, refreshRate: 1e3, refreshMode: void 0, resizableElementId: "", onResize: function (e) { return e } };
    }, { "react": "1n8/", "prop-types": "5D9O", "resize-observer-polyfill": "C4qV", "lodash.debounce": "4PZ+", "lodash.throttle": "FNy/" }], "EoGa": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("./components/ResizeDetector"), t = r(e); function r(e) { return e && e.__esModule ? e : { default: e } } exports.default = t.default;
    }, { "./components/ResizeDetector": "py0T" }], "vwhv": [function (require, module, exports) {
        "use strict"; function e(e, t, x) { x = x || 2; var i, u, v, y, o, p, l, a = t && t.length, h = a ? t[0] * x : e.length, s = n(e, 0, h, x, !0), c = []; if (!s) return c; if (a && (s = f(e, t, s, x)), e.length > 80 * x) { i = v = e[0], u = y = e[1]; for (var Z = x; Z < h; Z += x)(o = e[Z]) < i && (i = o), (p = e[Z + 1]) < u && (u = p), o > v && (v = o), p > y && (y = p); l = 0 !== (l = Math.max(v - i, y - u)) ? 1 / l : 0 } return r(s, c, x, i, u, l), c } function n(e, n, t, r, x) { var i, u; if (x === A(e, n, t, r) > 0) for (i = n; i < t; i += r)u = k(i, e[i], e[i + 1], u); else for (i = t - r; i >= n; i -= r)u = k(i, e[i], e[i + 1], u); return u && g(u, u.next) && (j(u), u = u.next), u } function t(e, n) { if (!e) return e; n || (n = e); var t, r = e; do { if (t = !1, r.steiner || !g(r, r.next) && 0 !== d(r.prev, r, r.next)) r = r.next; else { if (j(r), (r = n = r.prev) === r.next) break; t = !0 } } while (t || r !== n); return n } function r(e, n, f, y, o, p, a) { if (e) { !a && p && l(e, y, o, p); for (var h, s, c = e; e.prev !== e.next;)if (h = e.prev, s = e.next, p ? i(e, y, o, p) : x(e)) n.push(h.i / f), n.push(e.i / f), n.push(s.i / f), j(e), e = s.next, c = s.next; else if ((e = s) === c) { a ? 1 === a ? r(e = u(e, n, f), n, f, y, o, p, 2) : 2 === a && v(e, n, f, y, o, p) : r(t(e), n, f, y, o, p, 1); break } } } function x(e) { var n = e.prev, t = e, r = e.next; if (d(n, t, r) >= 0) return !1; for (var x = e.next.next; x !== e.prev;) { if (c(n.x, n.y, t.x, t.y, r.x, r.y, x.x, x.y) && d(x.prev, x, x.next) >= 0) return !1; x = x.next } return !0 } function i(e, n, t, r) { var x = e.prev, i = e, u = e.next; if (d(x, i, u) >= 0) return !1; for (var v = x.x < i.x ? x.x < u.x ? x.x : u.x : i.x < u.x ? i.x : u.x, f = x.y < i.y ? x.y < u.y ? x.y : u.y : i.y < u.y ? i.y : u.y, y = x.x > i.x ? x.x > u.x ? x.x : u.x : i.x > u.x ? i.x : u.x, o = x.y > i.y ? x.y > u.y ? x.y : u.y : i.y > u.y ? i.y : u.y, p = h(v, f, n, t, r), l = h(y, o, n, t, r), a = e.prevZ, s = e.nextZ; a && a.z >= p && s && s.z <= l;) { if (a !== e.prev && a !== e.next && c(x.x, x.y, i.x, i.y, u.x, u.y, a.x, a.y) && d(a.prev, a, a.next) >= 0) return !1; if (a = a.prevZ, s !== e.prev && s !== e.next && c(x.x, x.y, i.x, i.y, u.x, u.y, s.x, s.y) && d(s.prev, s, s.next) >= 0) return !1; s = s.nextZ } for (; a && a.z >= p;) { if (a !== e.prev && a !== e.next && c(x.x, x.y, i.x, i.y, u.x, u.y, a.x, a.y) && d(a.prev, a, a.next) >= 0) return !1; a = a.prevZ } for (; s && s.z <= l;) { if (s !== e.prev && s !== e.next && c(x.x, x.y, i.x, i.y, u.x, u.y, s.x, s.y) && d(s.prev, s, s.next) >= 0) return !1; s = s.nextZ } return !0 } function u(e, n, t) { var r = e; do { var x = r.prev, i = r.next.next; !g(x, i) && w(x, r, r.next, i) && b(x, i) && b(i, x) && (n.push(x.i / t), n.push(r.i / t), n.push(i.i / t), j(r), j(r.next), r = e = i), r = r.next } while (r !== e); return r } function v(e, n, x, i, u, v) { var f = e; do { for (var y = f.next.next; y !== f.prev;) { if (f.i !== y.i && Z(f, y)) { var o = m(f, y); return f = t(f, f.next), o = t(o, o.next), r(f, n, x, i, u, v), void r(o, n, x, i, u, v) } y = y.next } f = f.next } while (f !== e) } function f(e, r, x, i) { var u, v, f, p = []; for (u = 0, v = r.length; u < v; u++)(f = n(e, r[u] * i, u < v - 1 ? r[u + 1] * i : e.length, i, !1)) === f.next && (f.steiner = !0), p.push(s(f)); for (p.sort(y), u = 0; u < p.length; u++)o(p[u], x), x = t(x, x.next); return x } function y(e, n) { return e.x - n.x } function o(e, n) { if (n = p(e, n)) { var r = m(n, e); t(r, r.next) } } function p(e, n) { var t, r = n, x = e.x, i = e.y, u = -1 / 0; do { if (i <= r.y && i >= r.next.y && r.next.y !== r.y) { var v = r.x + (i - r.y) * (r.next.x - r.x) / (r.next.y - r.y); if (v <= x && v > u) { if (u = v, v === x) { if (i === r.y) return r; if (i === r.next.y) return r.next } t = r.x < r.next.x ? r : r.next } } r = r.next } while (r !== n); if (!t) return null; if (x === u) return t.prev; var f, y = t, o = t.x, p = t.y, l = 1 / 0; for (r = t.next; r !== y;)x >= r.x && r.x >= o && x !== r.x && c(i < p ? x : u, i, o, p, i < p ? u : x, i, r.x, r.y) && ((f = Math.abs(i - r.y) / (x - r.x)) < l || f === l && r.x > t.x) && b(r, e) && (t = r, l = f), r = r.next; return t } function l(e, n, t, r) { var x = e; do { null === x.z && (x.z = h(x.x, x.y, n, t, r)), x.prevZ = x.prev, x.nextZ = x.next, x = x.next } while (x !== e); x.prevZ.nextZ = null, x.prevZ = null, a(x) } function a(e) { var n, t, r, x, i, u, v, f, y = 1; do { for (t = e, e = null, i = null, u = 0; t;) { for (u++ , r = t, v = 0, n = 0; n < y && (v++ , r = r.nextZ); n++); for (f = y; v > 0 || f > 0 && r;)0 !== v && (0 === f || !r || t.z <= r.z) ? (x = t, t = t.nextZ, v--) : (x = r, r = r.nextZ, f--), i ? i.nextZ = x : e = x, x.prevZ = i, i = x; t = r } i.nextZ = null, y *= 2 } while (u > 1); return e } function h(e, n, t, r, x) { return (e = 1431655765 & ((e = 858993459 & ((e = 252645135 & ((e = 16711935 & ((e = 32767 * (e - t) * x) | e << 8)) | e << 4)) | e << 2)) | e << 1)) | (n = 1431655765 & ((n = 858993459 & ((n = 252645135 & ((n = 16711935 & ((n = 32767 * (n - r) * x) | n << 8)) | n << 4)) | n << 2)) | n << 1)) << 1 } function s(e) { var n = e, t = e; do { n.x < t.x && (t = n), n = n.next } while (n !== e); return t } function c(e, n, t, r, x, i, u, v) { return (x - u) * (n - v) - (e - u) * (i - v) >= 0 && (e - u) * (r - v) - (t - u) * (n - v) >= 0 && (t - u) * (i - v) - (x - u) * (r - v) >= 0 } function Z(e, n) { return e.next.i !== n.i && e.prev.i !== n.i && !z(e, n) && b(e, n) && b(n, e) && M(e, n) } function d(e, n, t) { return (n.y - e.y) * (t.x - n.x) - (n.x - e.x) * (t.y - n.y) } function g(e, n) { return e.x === n.x && e.y === n.y } function w(e, n, t, r) { return !!(g(e, n) && g(t, r) || g(e, r) && g(t, n)) || d(e, n, t) > 0 != d(e, n, r) > 0 && d(t, r, e) > 0 != d(t, r, n) > 0 } function z(e, n) { var t = e; do { if (t.i !== e.i && t.next.i !== e.i && t.i !== n.i && t.next.i !== n.i && w(t, t.next, e, n)) return !0; t = t.next } while (t !== e); return !1 } function b(e, n) { return d(e.prev, e, e.next) < 0 ? d(e, n, e.next) >= 0 && d(e, e.prev, n) >= 0 : d(e, n, e.prev) < 0 || d(e, e.next, n) < 0 } function M(e, n) { var t = e, r = !1, x = (e.x + n.x) / 2, i = (e.y + n.y) / 2; do { t.y > i != t.next.y > i && t.next.y !== t.y && x < (t.next.x - t.x) * (i - t.y) / (t.next.y - t.y) + t.x && (r = !r), t = t.next } while (t !== e); return r } function m(e, n) { var t = new q(e.i, e.x, e.y), r = new q(n.i, n.x, n.y), x = e.next, i = n.prev; return e.next = n, n.prev = e, t.next = x, x.prev = t, r.next = t, t.prev = r, i.next = r, r.prev = i, r } function k(e, n, t, r) { var x = new q(e, n, t); return r ? (x.next = r.next, x.prev = r, r.next.prev = x, r.next = x) : (x.prev = x, x.next = x), x } function j(e) { e.next.prev = e.prev, e.prev.next = e.next, e.prevZ && (e.prevZ.nextZ = e.nextZ), e.nextZ && (e.nextZ.prevZ = e.prevZ) } function q(e, n, t) { this.i = e, this.x = n, this.y = t, this.prev = null, this.next = null, this.z = null, this.prevZ = null, this.nextZ = null, this.steiner = !1 } function A(e, n, t, r) { for (var x = 0, i = n, u = t - r; i < t; i += r)x += (e[u] - e[i]) * (e[i + 1] + e[u + 1]), u = i; return x } module.exports = e, module.exports.default = e, e.deviation = function (e, n, t, r) { var x = n && n.length, i = x ? n[0] * t : e.length, u = Math.abs(A(e, 0, i, t)); if (x) for (var v = 0, f = n.length; v < f; v++) { var y = n[v] * t, o = v < f - 1 ? n[v + 1] * t : e.length; u -= Math.abs(A(e, y, o, t)) } var p = 0; for (v = 0; v < r.length; v += 3) { var l = r[v] * t, a = r[v + 1] * t, h = r[v + 2] * t; p += Math.abs((e[l] - e[h]) * (e[a + 1] - e[l + 1]) - (e[l] - e[a]) * (e[h + 1] - e[l + 1])) } return 0 === u && 0 === p ? 0 : Math.abs((p - u) / u) }, e.flatten = function (e) { for (var n = e[0][0].length, t = { vertices: [], holes: [], dimensions: n }, r = 0, x = 0; x < e.length; x++) { for (var i = 0; i < e[x].length; i++)for (var u = 0; u < n; u++)t.vertices.push(e[x][i][u]); x > 0 && (r += e[x - 1].length, t.holes.push(r)) } return t };
    }, {}], "S+Ze": [function (require, module, exports) {
        var define;
        var global = arguments[3];
        var e, t = arguments[3]; !function (t, i) { var r = [], n = t.CANNON || this.CANNON, o = t.OIMO || this.OIMO, s = t.earcut || this.earcut; if ("object" == typeof exports && "object" == typeof module) { try { n = n || require("cannon") } catch (t) { } try { o = o || require("oimo") } catch (t) { } try { s = s || require("earcut") } catch (t) { } module.exports = i(n, o, s) } else if ("function" == typeof e && e.amd) require.specified && require.specified("cannon") && r.push("cannon"), require.specified && require.specified("oimo") && r.push("oimo"), require.specified && require.specified("earcut") && r.push("earcut"), e("babylonjs", r, i); else if ("object" == typeof exports) { try { n = n || require("cannon") } catch (t) { } try { o = o || require("oimo") } catch (t) { } try { s = s || require("earcut") } catch (t) { } exports.babylonjs = i(n, o, s) } else t.BABYLON = i(n, o, s) }(this, function (e, i, r) { e = e || this.CANNON, i = i || this.OIMO, r = r || this.earcut; var n, o, s, a, l, c, h, u, d, f, p, _, m, g, v, y, b = this && this.__decorate || function (e, t, i, r) { var n, o = arguments.length, s = o < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, i) : r; if ("object" == typeof Reflect && "function" == typeof Reflect.decorate) s = Reflect.decorate(e, t, i, r); else for (var a = e.length - 1; 0 <= a; a--)(n = e[a]) && (s = (o < 3 ? n(s) : 3 < o ? n(t, i, s) : n(t, i)) || s); return 3 < o && s && Object.defineProperty(t, i, s), s }, T = this && this.__extends || (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i]) }, function (e, t) { function i() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (i.prototype = t.prototype, new i) }); !function (e) { var t = function () { function e() { this._defines = {}, this._currentRank = 32, this._maxRank = -1 } return e.prototype.unBindMesh = function () { this._mesh = null }, e.prototype.addFallback = function (e, t) { this._defines[e] || (e < this._currentRank && (this._currentRank = e), e > this._maxRank && (this._maxRank = e), this._defines[e] = new Array), this._defines[e].push(t) }, e.prototype.addCPUSkinningFallback = function (e, t) { this._mesh = t, e < this._currentRank && (this._currentRank = e), e > this._maxRank && (this._maxRank = e) }, Object.defineProperty(e.prototype, "isMoreFallbacks", { get: function () { return this._currentRank <= this._maxRank }, enumerable: !0, configurable: !0 }), e.prototype.reduce = function (e, t) { if (this._mesh && this._mesh.computeBonesUsingShaders && 0 < this._mesh.numBoneInfluencers && this._mesh.material) { this._mesh.computeBonesUsingShaders = !1, e = e.replace("#define NUM_BONE_INFLUENCERS " + this._mesh.numBoneInfluencers, "#define NUM_BONE_INFLUENCERS 0"), t._bonesComputationForcedToCPU = !0; for (var i = this._mesh.getScene(), r = 0; r < i.meshes.length; r++) { var n = i.meshes[r]; if (n.material && n.computeBonesUsingShaders && 0 !== n.numBoneInfluencers) if (n.material.getEffect() === t) n.computeBonesUsingShaders = !1; else if (n.subMeshes) for (var o = 0, s = n.subMeshes; o < s.length; o++)if (s[o].effect === t) { n.computeBonesUsingShaders = !1; break } } } else { var a = this._defines[this._currentRank]; if (a) for (r = 0; r < a.length; r++)e = e.replace("#define " + a[r], ""); this._currentRank++ } return e }, e }(); e.EffectFallbacks = t; e.EffectCreationOptions = function () { }; var i = function () { function t(i, r, n, o, s, a, l, c, h, u) { void 0 === o && (o = null), void 0 === a && (a = null), void 0 === l && (l = null), void 0 === c && (c = null), void 0 === h && (h = null); var d, f, p = this; if (this.uniqueId = 0, this.onCompileObservable = new e.Observable, this.onErrorObservable = new e.Observable, this._bonesComputationForcedToCPU = !1, this._uniformBuffersNames = {}, this._isReady = !1, this._compilationError = "", this.name = i, r.attributes) { var _ = r; if (this._engine = n, this._attributesNames = _.attributes, this._uniformsNames = _.uniformsNames.concat(_.samplers), this._samplers = _.samplers.slice(), this.defines = _.defines, this.onError = _.onError, this.onCompiled = _.onCompiled, this._fallbacks = _.fallbacks, this._indexParameters = _.indexParameters, this._transformFeedbackVaryings = _.transformFeedbackVaryings, _.uniformBuffersNames) for (var m = 0; m < _.uniformBuffersNames.length; m++)this._uniformBuffersNames[_.uniformBuffersNames[m]] = m } else this._engine = s, this.defines = a, this._uniformsNames = n.concat(o), this._samplers = o ? o.slice() : [], this._attributesNames = r, this.onError = h, this.onCompiled = c, this._indexParameters = u, this._fallbacks = l; this.uniqueId = t._uniqueIdSeed++ , i.vertexElement ? (d = document.getElementById(i.vertexElement)) || (d = i.vertexElement) : d = i.vertex || i, i.fragmentElement ? (f = document.getElementById(i.fragmentElement)) || (f = i.fragmentElement) : f = i.fragment || i, this._loadVertexShader(d, function (e) { p._processIncludes(e, function (e) { p._processShaderConversion(e, !1, function (e) { p._loadFragmentShader(f, function (t) { p._processIncludes(t, function (t) { p._processShaderConversion(t, !0, function (t) { if (i) { var r = i.vertexElement || i.vertex || i, n = i.fragmentElement || i.fragment || i; p._vertexSourceCode = "#define SHADER_NAME vertex:" + r + "\n" + e, p._fragmentSourceCode = "#define SHADER_NAME fragment:" + n + "\n" + t } else p._vertexSourceCode = e, p._fragmentSourceCode = t; p._prepareEffect() }) }) }) }) }) }) } return Object.defineProperty(t.prototype, "onBindObservable", { get: function () { return this._onBindObservable || (this._onBindObservable = new e.Observable), this._onBindObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "key", { get: function () { return this._key }, enumerable: !0, configurable: !0 }), t.prototype.isReady = function () { return this._isReady }, t.prototype.getEngine = function () { return this._engine }, t.prototype.getProgram = function () { return this._program }, t.prototype.getAttributesNames = function () { return this._attributesNames }, t.prototype.getAttributeLocation = function (e) { return this._attributes[e] }, t.prototype.getAttributeLocationByName = function (e) { var t = this._attributesNames.indexOf(e); return this._attributes[t] }, t.prototype.getAttributesCount = function () { return this._attributes.length }, t.prototype.getUniformIndex = function (e) { return this._uniformsNames.indexOf(e) }, t.prototype.getUniform = function (e) { return this._uniforms[this._uniformsNames.indexOf(e)] }, t.prototype.getSamplers = function () { return this._samplers }, t.prototype.getCompilationError = function () { return this._compilationError }, t.prototype.executeWhenCompiled = function (e) { this.isReady() ? e(this) : this.onCompileObservable.add(function (t) { e(t) }) }, t.prototype._loadVertexShader = function (i, r) { var n; e.Tools.IsWindowObjectExist() && i instanceof HTMLElement ? r(e.Tools.GetDOMTextContent(i)) : "base64:" !== i.substr(0, 7) ? t.ShadersStore[i + "VertexShader"] ? r(t.ShadersStore[i + "VertexShader"]) : (n = "." === i[0] || "/" === i[0] || -1 < i.indexOf("http") ? i : e.Engine.ShadersRepository + i, this._engine._loadFile(n + ".vertex.fx", r)) : r(window.atob(i.substr(7))) }, t.prototype._loadFragmentShader = function (i, r) { var n; e.Tools.IsWindowObjectExist() && i instanceof HTMLElement ? r(e.Tools.GetDOMTextContent(i)) : "base64:" !== i.substr(0, 7) ? t.ShadersStore[i + "PixelShader"] ? r(t.ShadersStore[i + "PixelShader"]) : t.ShadersStore[i + "FragmentShader"] ? r(t.ShadersStore[i + "FragmentShader"]) : (n = "." === i[0] || "/" === i[0] || -1 < i.indexOf("http") ? i : e.Engine.ShadersRepository + i, this._engine._loadFile(n + ".fragment.fx", r)) : r(window.atob(i.substr(7))) }, t.prototype._dumpShadersSource = function (t, i, r) { var n = (1 < this._engine.webGLVersion ? "#version 300 es\n#define WEBGL2 \n" : "") + (r ? r + "\n" : ""); i = n + i; var o = 2, s = /\n/gm, a = "\n1\t" + (t = n + t).replace(s, function () { return "\n" + o++ + "\t" }); o = 2; var l = "\n1\t" + i.replace(s, function () { return "\n" + o++ + "\t" }); this.name.vertexElement ? (e.Tools.Error("Vertex shader: " + this.name.vertexElement + a), e.Tools.Error("Fragment shader: " + this.name.fragmentElement + l)) : this.name.vertex ? (e.Tools.Error("Vertex shader: " + this.name.vertex + a), e.Tools.Error("Fragment shader: " + this.name.fragment + l)) : (e.Tools.Error("Vertex shader: " + this.name + a), e.Tools.Error("Fragment shader: " + this.name + l)) }, t.prototype._processShaderConversion = function (e, t, i) { var r = this._processPrecision(e); if (1 != this._engine.webGLVersion) if (-1 === r.indexOf("#version 3")) { var n = -1 !== r.search(/#extension.+GL_EXT_draw_buffers.+require/), o = r.replace(/#extension.+(GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g, ""); o = (o = (o = o.replace(/varying(?![\n\r])\s/g, t ? "in " : "out ")).replace(/attribute[ \t]/g, "in ")).replace(/[ \t]attribute/g, " in"), t && (o = (o = (o = (o = (o = (o = (o = (o = o.replace(/texture2DLodEXT\s*\(/g, "textureLod(")).replace(/textureCubeLodEXT\s*\(/g, "textureLod(")).replace(/texture2D\s*\(/g, "texture(")).replace(/textureCube\s*\(/g, "texture(")).replace(/gl_FragDepthEXT/g, "gl_FragDepth")).replace(/gl_FragColor/g, "glFragColor")).replace(/gl_FragData/g, "glFragData")).replace(/void\s+?main\s*\(/g, (n ? "" : "out vec4 glFragColor;\n") + "void main(")), i(o) } else i(r.replace("#version 300 es", "")); else i(r) }, t.prototype._processIncludes = function (i, r) { for (var n = this, o = /#include<(.+)>(\((.*)\))*(\[(.*)\])*/g, s = o.exec(i), a = new String(i); null != s;) { var l = s[1]; if (-1 !== l.indexOf("__decl__") && (l = l.replace(/__decl__/, ""), this._engine.supportsUniformBuffers && (l = (l = l.replace(/Vertex/, "Ubo")).replace(/Fragment/, "Ubo")), l += "Declaration"), !t.IncludesShadersStore[l]) { var c = e.Engine.ShadersRepository + "ShadersInclude/" + l + ".fx"; return void this._engine._loadFile(c, function (e) { t.IncludesShadersStore[l] = e, n._processIncludes(a, r) }) } var h = t.IncludesShadersStore[l]; if (s[2]) for (var u = s[3].split(","), d = 0; d < u.length; d += 2) { var f = new RegExp(u[d], "g"), p = u[d + 1]; h = h.replace(f, p) } if (s[4]) { var _ = s[5]; if (-1 !== _.indexOf("..")) { var m = _.split(".."), g = parseInt(m[0]), v = parseInt(m[1]), y = h.slice(0); h = "", isNaN(v) && (v = this._indexParameters[m[1]]); for (var b = g; b < v; b++)this._engine.supportsUniformBuffers || (y = y.replace(/light\{X\}.(\w*)/g, function (e, t) { return t + "{X}" })), h += y.replace(/\{X\}/g, b.toString()) + "\n" } else this._engine.supportsUniformBuffers || (h = h.replace(/light\{X\}.(\w*)/g, function (e, t) { return t + "{X}" })), h = h.replace(/\{X\}/g, _) } a = a.replace(s[0], h), s = o.exec(i) } r(a) }, t.prototype._processPrecision = function (e) { return -1 === e.indexOf("precision highp float") ? e = this._engine.getCaps().highPrecisionShaderSupported ? "precision highp float;\n" + e : "precision mediump float;\n" + e : this._engine.getCaps().highPrecisionShaderSupported || (e = e.replace("precision highp float", "precision mediump float")), e }, t.prototype._rebuildProgram = function (t, i, r, n) { var o = this; this._isReady = !1, this._vertexSourceCodeOverride = t, this._fragmentSourceCodeOverride = i, this.onError = function (e, t) { n && n(t) }, this.onCompiled = function () { for (var t = o.getEngine().scenes, i = 0; i < t.length; i++)t[i].markAllMaterialsAsDirty(e.Material.TextureDirtyFlag); r && r(o._program) }, this._fallbacks = null, this._prepareEffect() }, t.prototype.getSpecificUniformLocations = function (e) { return this._engine.getUniforms(this._program, e) }, t.prototype._prepareEffect = function () { var t = this._attributesNames, i = this.defines, r = this._fallbacks; this._valueCache = {}; var n = this._program; try { var o, s = this._engine; if (this._vertexSourceCodeOverride && this._fragmentSourceCodeOverride ? this._program = s.createRawShaderProgram(this._vertexSourceCodeOverride, this._fragmentSourceCodeOverride, void 0, this._transformFeedbackVaryings) : this._program = s.createShaderProgram(this._vertexSourceCode, this._fragmentSourceCode, i, void 0, this._transformFeedbackVaryings), this._program.__SPECTOR_rebuildProgram = this._rebuildProgram.bind(this), s.supportsUniformBuffers) for (var a in this._uniformBuffersNames) this.bindUniformBlock(a, this._uniformBuffersNames[a]); for (this._uniforms = s.getUniforms(this._program, this._uniformsNames), this._attributes = s.getAttributes(this._program, t), o = 0; o < this._samplers.length; o++)null == this.getUniform(this._samplers[o]) && (this._samplers.splice(o, 1), o--); s.bindSamplers(this), this._compilationError = "", this._isReady = !0, this.onCompiled && this.onCompiled(this), this.onCompileObservable.notifyObservers(this), this.onCompileObservable.clear(), this._fallbacks && this._fallbacks.unBindMesh(), n && this.getEngine()._deleteProgram(n) } catch (i) { this._compilationError = i.message, e.Tools.Error("Unable to compile effect:"), e.Tools.Error("Uniforms: " + this._uniformsNames.map(function (e) { return " " + e })), e.Tools.Error("Attributes: " + t.map(function (e) { return " " + e })), e.Tools.Error("Error: " + this._compilationError), n && (this._program = n, this._isReady = !0, this.onError && this.onError(this, this._compilationError), this.onErrorObservable.notifyObservers(this)), r && r.isMoreFallbacks ? (e.Tools.Error("Trying next fallback."), this.defines = r.reduce(this.defines, this), this._prepareEffect()) : (this.onError && this.onError(this, this._compilationError), this.onErrorObservable.notifyObservers(this), this.onErrorObservable.clear(), this._fallbacks && this._fallbacks.unBindMesh()) } }, Object.defineProperty(t.prototype, "isSupported", { get: function () { return "" === this._compilationError }, enumerable: !0, configurable: !0 }), t.prototype._bindTexture = function (e, t) { this._engine._bindTexture(this._samplers.indexOf(e), t) }, t.prototype.setTexture = function (e, t) { this._engine.setTexture(this._samplers.indexOf(e), this.getUniform(e), t) }, t.prototype.setDepthStencilTexture = function (e, t) { this._engine.setDepthStencilTexture(this._samplers.indexOf(e), this.getUniform(e), t) }, t.prototype.setTextureArray = function (e, t) { if (-1 === this._samplers.indexOf(e + "Ex")) for (var i = this._samplers.indexOf(e), r = 1; r < t.length; r++)this._samplers.splice(i + r, 0, e + "Ex"); this._engine.setTextureArray(this._samplers.indexOf(e), this.getUniform(e), t) }, t.prototype.setTextureFromPostProcess = function (e, t) { this._engine.setTextureFromPostProcess(this._samplers.indexOf(e), t) }, t.prototype.setTextureFromPostProcessOutput = function (e, t) { this._engine.setTextureFromPostProcessOutput(this._samplers.indexOf(e), t) }, t.prototype._cacheMatrix = function (e, t) { var i = this._valueCache[e], r = t.updateFlag; return (void 0 === i || i !== r) && (this._valueCache[e] = r, !0) }, t.prototype._cacheFloat2 = function (e, t, i) { var r = this._valueCache[e]; if (!r) return r = [t, i], this._valueCache[e] = r, !0; var n = !1; return r[0] !== t && (r[0] = t, n = !0), r[1] !== i && (r[1] = i, n = !0), n }, t.prototype._cacheFloat3 = function (e, t, i, r) { var n = this._valueCache[e]; if (!n) return n = [t, i, r], this._valueCache[e] = n, !0; var o = !1; return n[0] !== t && (n[0] = t, o = !0), n[1] !== i && (n[1] = i, o = !0), n[2] !== r && (n[2] = r, o = !0), o }, t.prototype._cacheFloat4 = function (e, t, i, r, n) { var o = this._valueCache[e]; if (!o) return o = [t, i, r, n], this._valueCache[e] = o, !0; var s = !1; return o[0] !== t && (o[0] = t, s = !0), o[1] !== i && (o[1] = i, s = !0), o[2] !== r && (o[2] = r, s = !0), o[3] !== n && (o[3] = n, s = !0), s }, t.prototype.bindUniformBuffer = function (e, i) { var r = this._uniformBuffersNames[i]; void 0 !== r && t._baseCache[r] !== e && (t._baseCache[r] = e, this._engine.bindUniformBufferBase(e, r)) }, t.prototype.bindUniformBlock = function (e, t) { this._engine.bindUniformBlock(this._program, e, t) }, t.prototype.setInt = function (e, t) { var i = this._valueCache[e]; return void 0 !== i && i === t || (this._valueCache[e] = t, this._engine.setInt(this.getUniform(e), t)), this }, t.prototype.setIntArray = function (e, t) { return this._valueCache[e] = null, this._engine.setIntArray(this.getUniform(e), t), this }, t.prototype.setIntArray2 = function (e, t) { return this._valueCache[e] = null, this._engine.setIntArray2(this.getUniform(e), t), this }, t.prototype.setIntArray3 = function (e, t) { return this._valueCache[e] = null, this._engine.setIntArray3(this.getUniform(e), t), this }, t.prototype.setIntArray4 = function (e, t) { return this._valueCache[e] = null, this._engine.setIntArray4(this.getUniform(e), t), this }, t.prototype.setFloatArray = function (e, t) { return this._valueCache[e] = null, this._engine.setFloatArray(this.getUniform(e), t), this }, t.prototype.setFloatArray2 = function (e, t) { return this._valueCache[e] = null, this._engine.setFloatArray2(this.getUniform(e), t), this }, t.prototype.setFloatArray3 = function (e, t) { return this._valueCache[e] = null, this._engine.setFloatArray3(this.getUniform(e), t), this }, t.prototype.setFloatArray4 = function (e, t) { return this._valueCache[e] = null, this._engine.setFloatArray4(this.getUniform(e), t), this }, t.prototype.setArray = function (e, t) { return this._valueCache[e] = null, this._engine.setArray(this.getUniform(e), t), this }, t.prototype.setArray2 = function (e, t) { return this._valueCache[e] = null, this._engine.setArray2(this.getUniform(e), t), this }, t.prototype.setArray3 = function (e, t) { return this._valueCache[e] = null, this._engine.setArray3(this.getUniform(e), t), this }, t.prototype.setArray4 = function (e, t) { return this._valueCache[e] = null, this._engine.setArray4(this.getUniform(e), t), this }, t.prototype.setMatrices = function (e, t) { return t && (this._valueCache[e] = null, this._engine.setMatrices(this.getUniform(e), t)), this }, t.prototype.setMatrix = function (e, t) { return this._cacheMatrix(e, t) && this._engine.setMatrix(this.getUniform(e), t), this }, t.prototype.setMatrix3x3 = function (e, t) { return this._valueCache[e] = null, this._engine.setMatrix3x3(this.getUniform(e), t), this }, t.prototype.setMatrix2x2 = function (e, t) { return this._valueCache[e] = null, this._engine.setMatrix2x2(this.getUniform(e), t), this }, t.prototype.setFloat = function (e, t) { var i = this._valueCache[e]; return void 0 !== i && i === t || (this._valueCache[e] = t, this._engine.setFloat(this.getUniform(e), t)), this }, t.prototype.setBool = function (e, t) { var i = this._valueCache[e]; return void 0 !== i && i === t || (this._valueCache[e] = t, this._engine.setBool(this.getUniform(e), t ? 1 : 0)), this }, t.prototype.setVector2 = function (e, t) { return this._cacheFloat2(e, t.x, t.y) && this._engine.setFloat2(this.getUniform(e), t.x, t.y), this }, t.prototype.setFloat2 = function (e, t, i) { return this._cacheFloat2(e, t, i) && this._engine.setFloat2(this.getUniform(e), t, i), this }, t.prototype.setVector3 = function (e, t) { return this._cacheFloat3(e, t.x, t.y, t.z) && this._engine.setFloat3(this.getUniform(e), t.x, t.y, t.z), this }, t.prototype.setFloat3 = function (e, t, i, r) { return this._cacheFloat3(e, t, i, r) && this._engine.setFloat3(this.getUniform(e), t, i, r), this }, t.prototype.setVector4 = function (e, t) { return this._cacheFloat4(e, t.x, t.y, t.z, t.w) && this._engine.setFloat4(this.getUniform(e), t.x, t.y, t.z, t.w), this }, t.prototype.setFloat4 = function (e, t, i, r, n) { return this._cacheFloat4(e, t, i, r, n) && this._engine.setFloat4(this.getUniform(e), t, i, r, n), this }, t.prototype.setColor3 = function (e, t) { return this._cacheFloat3(e, t.r, t.g, t.b) && this._engine.setColor3(this.getUniform(e), t), this }, t.prototype.setColor4 = function (e, t, i) { return this._cacheFloat4(e, t.r, t.g, t.b, i) && this._engine.setColor4(this.getUniform(e), t, i), this }, t.prototype.setDirectColor4 = function (e, t) { return this._cacheFloat4(e, t.r, t.g, t.b, t.a) && this._engine.setDirectColor4(this.getUniform(e), t), this }, t.RegisterShader = function (e, i, r) { i && (t.ShadersStore[e + "PixelShader"] = i), r && (t.ShadersStore[e + "VertexShader"] = r) }, t.ResetCache = function () { t._baseCache = {} }, t._uniqueIdSeed = 0, t._baseCache = {}, t.ShadersStore = {}, t.IncludesShadersStore = {}, t }(); e.Effect = i }($a || ($a = {})), function (e) { var t = function () { function e() { } return e.KEYDOWN = 1, e.KEYUP = 2, e }(); e.KeyboardEventTypes = t; var i = function (e) { function t(t, i) { var r = e.call(this, t, i) || this; return r.type = t, r.event = i, r.skipOnPointerObservable = !1, r } return T(t, e), t }(e.KeyboardInfo = function (e, t) { this.type = e, this.event = t }); e.KeyboardInfoPre = i }($a || ($a = {})), function (e) { var t = function () { function e() { } return e.POINTERDOWN = 1, e.POINTERUP = 2, e.POINTERMOVE = 4, e.POINTERWHEEL = 8, e.POINTERPICK = 16, e.POINTERTAP = 32, e.POINTERDOUBLETAP = 64, e }(); e.PointerEventTypes = t; var i = function (e, t) { this.type = e, this.event = t }, r = function (t) { function i(i, r, n, o) { var s = t.call(this, i, r) || this; return s.ray = null, s.skipOnPointerObservable = !1, s.localPosition = new e.Vector2(n, o), s } return T(i, t), i }(e.PointerInfoBase = i); e.PointerInfoPre = r; var n = function (e) { function t(t, i, r) { var n = e.call(this, t, i) || this; return n.pickInfo = r, n } return T(t, e), t }(i); e.PointerInfo = n }($a || ($a = {})), function (e) { e.ToGammaSpace = 1 / 2.2, e.ToLinearSpace = 2.2, e.Epsilon = .001; var t = function () { function t(e, t, i) { void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = 0), this.r = e, this.g = t, this.b = i } return t.prototype.toString = function () { return "{R: " + this.r + " G:" + this.g + " B:" + this.b + "}" }, t.prototype.getClassName = function () { return "Color3" }, t.prototype.getHashCode = function () { var e = this.r || 0; return 397 * (e = 397 * e ^ (this.g || 0)) ^ (this.b || 0) }, t.prototype.toArray = function (e, t) { return void 0 === t && (t = 0), e[t] = this.r, e[t + 1] = this.g, e[t + 2] = this.b, this }, t.prototype.toColor4 = function (e) { return void 0 === e && (e = 1), new i(this.r, this.g, this.b, e) }, t.prototype.asArray = function () { var e = new Array; return this.toArray(e, 0), e }, t.prototype.toLuminance = function () { return .3 * this.r + .59 * this.g + .11 * this.b }, t.prototype.multiply = function (e) { return new t(this.r * e.r, this.g * e.g, this.b * e.b) }, t.prototype.multiplyToRef = function (e, t) { return t.r = this.r * e.r, t.g = this.g * e.g, t.b = this.b * e.b, this }, t.prototype.equals = function (e) { return e && this.r === e.r && this.g === e.g && this.b === e.b }, t.prototype.equalsFloats = function (e, t, i) { return this.r === e && this.g === t && this.b === i }, t.prototype.scale = function (e) { return new t(this.r * e, this.g * e, this.b * e) }, t.prototype.scaleToRef = function (e, t) { return t.r = this.r * e, t.g = this.g * e, t.b = this.b * e, this }, t.prototype.scaleAndAddToRef = function (e, t) { return t.r += this.r * e, t.g += this.g * e, t.b += this.b * e, this }, t.prototype.clampToRef = function (t, i, r) { return void 0 === t && (t = 0), void 0 === i && (i = 1), r.r = e.Scalar.Clamp(this.r, t, i), r.g = e.Scalar.Clamp(this.g, t, i), r.b = e.Scalar.Clamp(this.b, t, i), this }, t.prototype.add = function (e) { return new t(this.r + e.r, this.g + e.g, this.b + e.b) }, t.prototype.addToRef = function (e, t) { return t.r = this.r + e.r, t.g = this.g + e.g, t.b = this.b + e.b, this }, t.prototype.subtract = function (e) { return new t(this.r - e.r, this.g - e.g, this.b - e.b) }, t.prototype.subtractToRef = function (e, t) { return t.r = this.r - e.r, t.g = this.g - e.g, t.b = this.b - e.b, this }, t.prototype.clone = function () { return new t(this.r, this.g, this.b) }, t.prototype.copyFrom = function (e) { return this.r = e.r, this.g = e.g, this.b = e.b, this }, t.prototype.copyFromFloats = function (e, t, i) { return this.r = e, this.g = t, this.b = i, this }, t.prototype.set = function (e, t, i) { return this.copyFromFloats(e, t, i) }, t.prototype.toHexString = function () { var t = 255 * this.r | 0, i = 255 * this.g | 0, r = 255 * this.b | 0; return "#" + e.Scalar.ToHex(t) + e.Scalar.ToHex(i) + e.Scalar.ToHex(r) }, t.prototype.toLinearSpace = function () { var e = new t; return this.toLinearSpaceToRef(e), e }, t.prototype.toLinearSpaceToRef = function (t) { return t.r = Math.pow(this.r, e.ToLinearSpace), t.g = Math.pow(this.g, e.ToLinearSpace), t.b = Math.pow(this.b, e.ToLinearSpace), this }, t.prototype.toGammaSpace = function () { var e = new t; return this.toGammaSpaceToRef(e), e }, t.prototype.toGammaSpaceToRef = function (t) { return t.r = Math.pow(this.r, e.ToGammaSpace), t.g = Math.pow(this.g, e.ToGammaSpace), t.b = Math.pow(this.b, e.ToGammaSpace), this }, t.FromHexString = function (e) { if ("#" !== e.substring(0, 1) || 7 !== e.length) return new t(0, 0, 0); var i = parseInt(e.substring(1, 3), 16), r = parseInt(e.substring(3, 5), 16), n = parseInt(e.substring(5, 7), 16); return t.FromInts(i, r, n) }, t.FromArray = function (e, i) { return void 0 === i && (i = 0), new t(e[i], e[i + 1], e[i + 2]) }, t.FromInts = function (e, i, r) { return new t(e / 255, i / 255, r / 255) }, t.Lerp = function (e, i, r) { var n = new t(0, 0, 0); return t.LerpToRef(e, i, r, n), n }, t.LerpToRef = function (e, t, i, r) { r.r = e.r + (t.r - e.r) * i, r.g = e.g + (t.g - e.g) * i, r.b = e.b + (t.b - e.b) * i }, t.Red = function () { return new t(1, 0, 0) }, t.Green = function () { return new t(0, 1, 0) }, t.Blue = function () { return new t(0, 0, 1) }, t.Black = function () { return new t(0, 0, 0) }, t.White = function () { return new t(1, 1, 1) }, t.Purple = function () { return new t(.5, 0, .5) }, t.Magenta = function () { return new t(1, 0, 1) }, t.Yellow = function () { return new t(1, 1, 0) }, t.Gray = function () { return new t(.5, .5, .5) }, t.Teal = function () { return new t(0, 1, 1) }, t.Random = function () { return new t(Math.random(), Math.random(), Math.random()) }, t }(); e.Color3 = t; var i = function () { function t(e, t, i, r) { void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = 0), void 0 === r && (r = 1), this.r = e, this.g = t, this.b = i, this.a = r } return t.prototype.addInPlace = function (e) { return this.r += e.r, this.g += e.g, this.b += e.b, this.a += e.a, this }, t.prototype.asArray = function () { var e = new Array; return this.toArray(e, 0), e }, t.prototype.toArray = function (e, t) { return void 0 === t && (t = 0), e[t] = this.r, e[t + 1] = this.g, e[t + 2] = this.b, e[t + 3] = this.a, this }, t.prototype.add = function (e) { return new t(this.r + e.r, this.g + e.g, this.b + e.b, this.a + e.a) }, t.prototype.subtract = function (e) { return new t(this.r - e.r, this.g - e.g, this.b - e.b, this.a - e.a) }, t.prototype.subtractToRef = function (e, t) { return t.r = this.r - e.r, t.g = this.g - e.g, t.b = this.b - e.b, t.a = this.a - e.a, this }, t.prototype.scale = function (e) { return new t(this.r * e, this.g * e, this.b * e, this.a * e) }, t.prototype.scaleToRef = function (e, t) { return t.r = this.r * e, t.g = this.g * e, t.b = this.b * e, t.a = this.a * e, this }, t.prototype.scaleAndAddToRef = function (e, t) { return t.r += this.r * e, t.g += this.g * e, t.b += this.b * e, t.a += this.a * e, this }, t.prototype.clampToRef = function (t, i, r) { return void 0 === t && (t = 0), void 0 === i && (i = 1), r.r = e.Scalar.Clamp(this.r, t, i), r.g = e.Scalar.Clamp(this.g, t, i), r.b = e.Scalar.Clamp(this.b, t, i), r.a = e.Scalar.Clamp(this.a, t, i), this }, t.prototype.multiply = function (e) { return new t(this.r * e.r, this.g * e.g, this.b * e.b, this.a * e.a) }, t.prototype.multiplyToRef = function (e, t) { return t.r = this.r * e.r, t.g = this.g * e.g, t.b = this.b * e.b, t.a = this.a * e.a, t }, t.prototype.toString = function () { return "{R: " + this.r + " G:" + this.g + " B:" + this.b + " A:" + this.a + "}" }, t.prototype.getClassName = function () { return "Color4" }, t.prototype.getHashCode = function () { var e = this.r || 0; return 397 * (e = 397 * (e = 397 * e ^ (this.g || 0)) ^ (this.b || 0)) ^ (this.a || 0) }, t.prototype.clone = function () { return new t(this.r, this.g, this.b, this.a) }, t.prototype.copyFrom = function (e) { return this.r = e.r, this.g = e.g, this.b = e.b, this.a = e.a, this }, t.prototype.copyFromFloats = function (e, t, i, r) { return this.r = e, this.g = t, this.b = i, this.a = r, this }, t.prototype.set = function (e, t, i, r) { return this.copyFromFloats(e, t, i, r) }, t.prototype.toHexString = function () { var t = 255 * this.r | 0, i = 255 * this.g | 0, r = 255 * this.b | 0, n = 255 * this.a | 0; return "#" + e.Scalar.ToHex(t) + e.Scalar.ToHex(i) + e.Scalar.ToHex(r) + e.Scalar.ToHex(n) }, t.prototype.toLinearSpace = function () { var e = new t; return this.toLinearSpaceToRef(e), e }, t.prototype.toLinearSpaceToRef = function (t) { return t.r = Math.pow(this.r, e.ToLinearSpace), t.g = Math.pow(this.g, e.ToLinearSpace), t.b = Math.pow(this.b, e.ToLinearSpace), t.a = this.a, this }, t.prototype.toGammaSpace = function () { var e = new t; return this.toGammaSpaceToRef(e), e }, t.prototype.toGammaSpaceToRef = function (t) { return t.r = Math.pow(this.r, e.ToGammaSpace), t.g = Math.pow(this.g, e.ToGammaSpace), t.b = Math.pow(this.b, e.ToGammaSpace), t.a = this.a, this }, t.FromHexString = function (e) { if ("#" !== e.substring(0, 1) || 9 !== e.length) return new t(0, 0, 0, 0); var i = parseInt(e.substring(1, 3), 16), r = parseInt(e.substring(3, 5), 16), n = parseInt(e.substring(5, 7), 16), o = parseInt(e.substring(7, 9), 16); return t.FromInts(i, r, n, o) }, t.Lerp = function (e, i, r) { var n = new t(0, 0, 0, 0); return t.LerpToRef(e, i, r, n), n }, t.LerpToRef = function (e, t, i, r) { r.r = e.r + (t.r - e.r) * i, r.g = e.g + (t.g - e.g) * i, r.b = e.b + (t.b - e.b) * i, r.a = e.a + (t.a - e.a) * i }, t.FromColor3 = function (e, i) { return void 0 === i && (i = 1), new t(e.r, e.g, e.b, i) }, t.FromArray = function (e, i) { return void 0 === i && (i = 0), new t(e[i], e[i + 1], e[i + 2], e[i + 3]) }, t.FromInts = function (e, i, r, n) { return new t(e / 255, i / 255, r / 255, n / 255) }, t.CheckColors4 = function (e, t) { if (e.length === 3 * t) { for (var i = [], r = 0; r < e.length; r += 3) { var n = r / 3 * 4; i[n] = e[r], i[n + 1] = e[r + 1], i[n + 2] = e[r + 2], i[n + 3] = 1 } return i } return e }, t }(); e.Color4 = i; var r = function () { function t(e, t) { void 0 === e && (e = 0), void 0 === t && (t = 0), this.x = e, this.y = t } return t.prototype.toString = function () { return "{X: " + this.x + " Y:" + this.y + "}" }, t.prototype.getClassName = function () { return "Vector2" }, t.prototype.getHashCode = function () { var e = this.x || 0; return 397 * e ^ (this.y || 0) }, t.prototype.toArray = function (e, t) { return void 0 === t && (t = 0), e[t] = this.x, e[t + 1] = this.y, this }, t.prototype.asArray = function () { var e = new Array; return this.toArray(e, 0), e }, t.prototype.copyFrom = function (e) { return this.x = e.x, this.y = e.y, this }, t.prototype.copyFromFloats = function (e, t) { return this.x = e, this.y = t, this }, t.prototype.set = function (e, t) { return this.copyFromFloats(e, t) }, t.prototype.add = function (e) { return new t(this.x + e.x, this.y + e.y) }, t.prototype.addToRef = function (e, t) { return t.x = this.x + e.x, t.y = this.y + e.y, this }, t.prototype.addInPlace = function (e) { return this.x += e.x, this.y += e.y, this }, t.prototype.addVector3 = function (e) { return new t(this.x + e.x, this.y + e.y) }, t.prototype.subtract = function (e) { return new t(this.x - e.x, this.y - e.y) }, t.prototype.subtractToRef = function (e, t) { return t.x = this.x - e.x, t.y = this.y - e.y, this }, t.prototype.subtractInPlace = function (e) { return this.x -= e.x, this.y -= e.y, this }, t.prototype.multiplyInPlace = function (e) { return this.x *= e.x, this.y *= e.y, this }, t.prototype.multiply = function (e) { return new t(this.x * e.x, this.y * e.y) }, t.prototype.multiplyToRef = function (e, t) { return t.x = this.x * e.x, t.y = this.y * e.y, this }, t.prototype.multiplyByFloats = function (e, i) { return new t(this.x * e, this.y * i) }, t.prototype.divide = function (e) { return new t(this.x / e.x, this.y / e.y) }, t.prototype.divideToRef = function (e, t) { return t.x = this.x / e.x, t.y = this.y / e.y, this }, t.prototype.divideInPlace = function (e) { return this.divideToRef(e, this) }, t.prototype.negate = function () { return new t(-this.x, -this.y) }, t.prototype.scaleInPlace = function (e) { return this.x *= e, this.y *= e, this }, t.prototype.scale = function (e) { var i = new t(0, 0); return this.scaleToRef(e, i), i }, t.prototype.scaleToRef = function (e, t) { return t.x = this.x * e, t.y = this.y * e, this }, t.prototype.scaleAndAddToRef = function (e, t) { return t.x += this.x * e, t.y += this.y * e, this }, t.prototype.equals = function (e) { return e && this.x === e.x && this.y === e.y }, t.prototype.equalsWithEpsilon = function (t, i) { return void 0 === i && (i = e.Epsilon), t && e.Scalar.WithinEpsilon(this.x, t.x, i) && e.Scalar.WithinEpsilon(this.y, t.y, i) }, t.prototype.floor = function () { return new t(Math.floor(this.x), Math.floor(this.y)) }, t.prototype.fract = function () { return new t(this.x - Math.floor(this.x), this.y - Math.floor(this.y)) }, t.prototype.length = function () { return Math.sqrt(this.x * this.x + this.y * this.y) }, t.prototype.lengthSquared = function () { return this.x * this.x + this.y * this.y }, t.prototype.normalize = function () { var e = this.length(); if (0 === e) return this; var t = 1 / e; return this.x *= t, this.y *= t, this }, t.prototype.clone = function () { return new t(this.x, this.y) }, t.Zero = function () { return new t(0, 0) }, t.One = function () { return new t(1, 1) }, t.FromArray = function (e, i) { return void 0 === i && (i = 0), new t(e[i], e[i + 1]) }, t.FromArrayToRef = function (e, t, i) { i.x = e[t], i.y = e[t + 1] }, t.CatmullRom = function (e, i, r, n, o) { var s = o * o, a = o * s; return new t(.5 * (2 * i.x + (-e.x + r.x) * o + (2 * e.x - 5 * i.x + 4 * r.x - n.x) * s + (-e.x + 3 * i.x - 3 * r.x + n.x) * a), .5 * (2 * i.y + (-e.y + r.y) * o + (2 * e.y - 5 * i.y + 4 * r.y - n.y) * s + (-e.y + 3 * i.y - 3 * r.y + n.y) * a)) }, t.Clamp = function (e, i, r) { var n = e.x; n = (n = n > r.x ? r.x : n) < i.x ? i.x : n; var o = e.y; return new t(n, o = (o = o > r.y ? r.y : o) < i.y ? i.y : o) }, t.Hermite = function (e, i, r, n, o) { var s = o * o, a = o * s, l = 2 * a - 3 * s + 1, c = -2 * a + 3 * s, h = a - 2 * s + o, u = a - s; return new t(e.x * l + r.x * c + i.x * h + n.x * u, e.y * l + r.y * c + i.y * h + n.y * u) }, t.Lerp = function (e, i, r) { return new t(e.x + (i.x - e.x) * r, e.y + (i.y - e.y) * r) }, t.Dot = function (e, t) { return e.x * t.x + e.y * t.y }, t.Normalize = function (e) { var t = e.clone(); return t.normalize(), t }, t.Minimize = function (e, i) { return new t(e.x < i.x ? e.x : i.x, e.y < i.y ? e.y : i.y) }, t.Maximize = function (e, i) { return new t(e.x > i.x ? e.x : i.x, e.y > i.y ? e.y : i.y) }, t.Transform = function (e, i) { var r = t.Zero(); return t.TransformToRef(e, i, r), r }, t.TransformToRef = function (e, t, i) { var r = e.x * t.m[0] + e.y * t.m[4] + t.m[12], n = e.x * t.m[1] + e.y * t.m[5] + t.m[13]; i.x = r, i.y = n }, t.PointInTriangle = function (e, t, i, r) { var n = .5 * (-i.y * r.x + t.y * (-i.x + r.x) + t.x * (i.y - r.y) + i.x * r.y), o = n < 0 ? -1 : 1, s = (t.y * r.x - t.x * r.y + (r.y - t.y) * e.x + (t.x - r.x) * e.y) * o, a = (t.x * i.y - t.y * i.x + (t.y - i.y) * e.x + (i.x - t.x) * e.y) * o; return 0 < s && 0 < a && s + a < 2 * n * o }, t.Distance = function (e, i) { return Math.sqrt(t.DistanceSquared(e, i)) }, t.DistanceSquared = function (e, t) { var i = e.x - t.x, r = e.y - t.y; return i * i + r * r }, t.Center = function (e, t) { var i = e.add(t); return i.scaleInPlace(.5), i }, t.DistanceOfPointFromSegment = function (e, i, r) { var n = t.DistanceSquared(i, r); if (0 === n) return t.Distance(e, i); var o = r.subtract(i), s = Math.max(0, Math.min(1, t.Dot(e.subtract(i), o) / n)), a = i.add(o.multiplyByFloats(s, s)); return t.Distance(e, a) }, t }(); e.Vector2 = r; var n = function () { function t(e, t, i) { void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = 0), this.x = e, this.y = t, this.z = i } return t.prototype.toString = function () { return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + "}" }, t.prototype.getClassName = function () { return "Vector3" }, t.prototype.getHashCode = function () { var e = this.x || 0; return 397 * (e = 397 * e ^ (this.y || 0)) ^ (this.z || 0) }, t.prototype.asArray = function () { var e = []; return this.toArray(e, 0), e }, t.prototype.toArray = function (e, t) { return void 0 === t && (t = 0), e[t] = this.x, e[t + 1] = this.y, e[t + 2] = this.z, this }, t.prototype.toQuaternion = function () { return e.Quaternion.RotationYawPitchRoll(this.x, this.y, this.z) }, t.prototype.addInPlace = function (e) { return this.x += e.x, this.y += e.y, this.z += e.z, this }, t.prototype.add = function (e) { return new t(this.x + e.x, this.y + e.y, this.z + e.z) }, t.prototype.addToRef = function (e, t) { return t.x = this.x + e.x, t.y = this.y + e.y, t.z = this.z + e.z, this }, t.prototype.subtractInPlace = function (e) { return this.x -= e.x, this.y -= e.y, this.z -= e.z, this }, t.prototype.subtract = function (e) { return new t(this.x - e.x, this.y - e.y, this.z - e.z) }, t.prototype.subtractToRef = function (e, t) { return t.x = this.x - e.x, t.y = this.y - e.y, t.z = this.z - e.z, this }, t.prototype.subtractFromFloats = function (e, i, r) { return new t(this.x - e, this.y - i, this.z - r) }, t.prototype.subtractFromFloatsToRef = function (e, t, i, r) { return r.x = this.x - e, r.y = this.y - t, r.z = this.z - i, this }, t.prototype.negate = function () { return new t(-this.x, -this.y, -this.z) }, t.prototype.scaleInPlace = function (e) { return this.x *= e, this.y *= e, this.z *= e, this }, t.prototype.scale = function (e) { return new t(this.x * e, this.y * e, this.z * e) }, t.prototype.scaleToRef = function (e, t) { return t.x = this.x * e, t.y = this.y * e, t.z = this.z * e, this }, t.prototype.scaleAndAddToRef = function (e, t) { return t.x += this.x * e, t.y += this.y * e, t.z += this.z * e, this }, t.prototype.equals = function (e) { return e && this.x === e.x && this.y === e.y && this.z === e.z }, t.prototype.equalsWithEpsilon = function (t, i) { return void 0 === i && (i = e.Epsilon), t && e.Scalar.WithinEpsilon(this.x, t.x, i) && e.Scalar.WithinEpsilon(this.y, t.y, i) && e.Scalar.WithinEpsilon(this.z, t.z, i) }, t.prototype.equalsToFloats = function (e, t, i) { return this.x === e && this.y === t && this.z === i }, t.prototype.multiplyInPlace = function (e) { return this.x *= e.x, this.y *= e.y, this.z *= e.z, this }, t.prototype.multiply = function (e) { return new t(this.x * e.x, this.y * e.y, this.z * e.z) }, t.prototype.multiplyToRef = function (e, t) { return t.x = this.x * e.x, t.y = this.y * e.y, t.z = this.z * e.z, this }, t.prototype.multiplyByFloats = function (e, i, r) { return new t(this.x * e, this.y * i, this.z * r) }, t.prototype.divide = function (e) { return new t(this.x / e.x, this.y / e.y, this.z / e.z) }, t.prototype.divideToRef = function (e, t) { return t.x = this.x / e.x, t.y = this.y / e.y, t.z = this.z / e.z, this }, t.prototype.divideInPlace = function (e) { return this.divideToRef(e, this) }, t.prototype.minimizeInPlace = function (e) { return this.minimizeInPlaceFromFloats(e.x, e.y, e.z) }, t.prototype.maximizeInPlace = function (e) { return this.maximizeInPlaceFromFloats(e.x, e.y, e.z) }, t.prototype.minimizeInPlaceFromFloats = function (e, t, i) { return e < this.x && (this.x = e), t < this.y && (this.y = t), i < this.z && (this.z = i), this }, t.prototype.maximizeInPlaceFromFloats = function (e, t, i) { return e > this.x && (this.x = e), t > this.y && (this.y = t), i > this.z && (this.z = i), this }, Object.defineProperty(t.prototype, "isNonUniform", { get: function () { var e = Math.abs(this.x), t = Math.abs(this.y); if (e !== t) return !0; var i = Math.abs(this.z); return e !== i || t !== i }, enumerable: !0, configurable: !0 }), t.prototype.floor = function () { return new t(Math.floor(this.x), Math.floor(this.y), Math.floor(this.z)) }, t.prototype.fract = function () { return new t(this.x - Math.floor(this.x), this.y - Math.floor(this.y), this.z - Math.floor(this.z)) }, t.prototype.length = function () { return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z) }, t.prototype.lengthSquared = function () { return this.x * this.x + this.y * this.y + this.z * this.z }, t.prototype.normalize = function () { var e = this.length(); if (0 === e || 1 === e) return this; var t = 1 / e; return this.x *= t, this.y *= t, this.z *= t, this }, t.prototype.normalizeToNew = function () { var e = new t(0, 0, 0); return this.normalizeToRef(e), e }, t.prototype.normalizeToRef = function (e) { var t = this.length(); if (0 === t || 1 === t) return e.set(this.x, this.y, this.z), e; var i = 1 / t; return this.scaleToRef(i, e), e }, t.prototype.clone = function () { return new t(this.x, this.y, this.z) }, t.prototype.copyFrom = function (e) { return this.x = e.x, this.y = e.y, this.z = e.z, this }, t.prototype.copyFromFloats = function (e, t, i) { return this.x = e, this.y = t, this.z = i, this }, t.prototype.set = function (e, t, i) { return this.copyFromFloats(e, t, i) }, t.GetClipFactor = function (e, i, r, n) { var o = t.Dot(e, r) - n; return o / (o - (t.Dot(i, r) - n)) }, t.GetAngleBetweenVectors = function (e, i, r) { var n = A.Vector3[1].copyFrom(e).normalize(), o = A.Vector3[2].copyFrom(i).normalize(), s = t.Dot(n, o), a = A.Vector3[3]; return t.CrossToRef(n, o, a), 0 < t.Dot(a, r) ? Math.acos(s) : -Math.acos(s) }, t.FromArray = function (e, i) { return i || (i = 0), new t(e[i], e[i + 1], e[i + 2]) }, t.FromFloatArray = function (e, i) { return t.FromArray(e, i) }, t.FromArrayToRef = function (e, t, i) { i.x = e[t], i.y = e[t + 1], i.z = e[t + 2] }, t.FromFloatArrayToRef = function (e, i, r) { return t.FromArrayToRef(e, i, r) }, t.FromFloatsToRef = function (e, t, i, r) { r.x = e, r.y = t, r.z = i }, t.Zero = function () { return new t(0, 0, 0) }, t.One = function () { return new t(1, 1, 1) }, t.Up = function () { return new t(0, 1, 0) }, t.Down = function () { return new t(0, -1, 0) }, t.Forward = function () { return new t(0, 0, 1) }, t.Backward = function () { return new t(0, 0, -1) }, t.Right = function () { return new t(1, 0, 0) }, t.Left = function () { return new t(-1, 0, 0) }, t.TransformCoordinates = function (e, i) { var r = t.Zero(); return t.TransformCoordinatesToRef(e, i, r), r }, t.TransformCoordinatesToRef = function (e, t, i) { var r = e.x * t.m[0] + e.y * t.m[4] + e.z * t.m[8] + t.m[12], n = e.x * t.m[1] + e.y * t.m[5] + e.z * t.m[9] + t.m[13], o = e.x * t.m[2] + e.y * t.m[6] + e.z * t.m[10] + t.m[14], s = e.x * t.m[3] + e.y * t.m[7] + e.z * t.m[11] + t.m[15]; i.x = r / s, i.y = n / s, i.z = o / s }, t.TransformCoordinatesFromFloatsToRef = function (e, t, i, r, n) { var o = e * r.m[0] + t * r.m[4] + i * r.m[8] + r.m[12], s = e * r.m[1] + t * r.m[5] + i * r.m[9] + r.m[13], a = e * r.m[2] + t * r.m[6] + i * r.m[10] + r.m[14], l = e * r.m[3] + t * r.m[7] + i * r.m[11] + r.m[15]; n.x = o / l, n.y = s / l, n.z = a / l }, t.TransformNormal = function (e, i) { var r = t.Zero(); return t.TransformNormalToRef(e, i, r), r }, t.TransformNormalToRef = function (e, t, i) { var r = e.x * t.m[0] + e.y * t.m[4] + e.z * t.m[8], n = e.x * t.m[1] + e.y * t.m[5] + e.z * t.m[9], o = e.x * t.m[2] + e.y * t.m[6] + e.z * t.m[10]; i.x = r, i.y = n, i.z = o }, t.TransformNormalFromFloatsToRef = function (e, t, i, r, n) { n.x = e * r.m[0] + t * r.m[4] + i * r.m[8], n.y = e * r.m[1] + t * r.m[5] + i * r.m[9], n.z = e * r.m[2] + t * r.m[6] + i * r.m[10] }, t.CatmullRom = function (e, i, r, n, o) { var s = o * o, a = o * s; return new t(.5 * (2 * i.x + (-e.x + r.x) * o + (2 * e.x - 5 * i.x + 4 * r.x - n.x) * s + (-e.x + 3 * i.x - 3 * r.x + n.x) * a), .5 * (2 * i.y + (-e.y + r.y) * o + (2 * e.y - 5 * i.y + 4 * r.y - n.y) * s + (-e.y + 3 * i.y - 3 * r.y + n.y) * a), .5 * (2 * i.z + (-e.z + r.z) * o + (2 * e.z - 5 * i.z + 4 * r.z - n.z) * s + (-e.z + 3 * i.z - 3 * r.z + n.z) * a)) }, t.Clamp = function (e, i, r) { var n = e.x; n = (n = n > r.x ? r.x : n) < i.x ? i.x : n; var o = e.y; o = (o = o > r.y ? r.y : o) < i.y ? i.y : o; var s = e.z; return new t(n, o, s = (s = s > r.z ? r.z : s) < i.z ? i.z : s) }, t.Hermite = function (e, i, r, n, o) { var s = o * o, a = o * s, l = 2 * a - 3 * s + 1, c = -2 * a + 3 * s, h = a - 2 * s + o, u = a - s; return new t(e.x * l + r.x * c + i.x * h + n.x * u, e.y * l + r.y * c + i.y * h + n.y * u, e.z * l + r.z * c + i.z * h + n.z * u) }, t.Lerp = function (e, i, r) { var n = new t(0, 0, 0); return t.LerpToRef(e, i, r, n), n }, t.LerpToRef = function (e, t, i, r) { r.x = e.x + (t.x - e.x) * i, r.y = e.y + (t.y - e.y) * i, r.z = e.z + (t.z - e.z) * i }, t.Dot = function (e, t) { return e.x * t.x + e.y * t.y + e.z * t.z }, t.Cross = function (e, i) { var r = t.Zero(); return t.CrossToRef(e, i, r), r }, t.CrossToRef = function (e, t, i) { A.Vector3[0].x = e.y * t.z - e.z * t.y, A.Vector3[0].y = e.z * t.x - e.x * t.z, A.Vector3[0].z = e.x * t.y - e.y * t.x, i.copyFrom(A.Vector3[0]) }, t.Normalize = function (e) { var i = t.Zero(); return t.NormalizeToRef(e, i), i }, t.NormalizeToRef = function (e, t) { t.copyFrom(e), t.normalize() }, t.Project = function (e, i, r, n) { var o = n.width, s = n.height, a = n.x, c = n.y, h = t._viewportMatrixCache ? t._viewportMatrixCache : t._viewportMatrixCache = new l; l.FromValuesToRef(o / 2, 0, 0, 0, 0, -s / 2, 0, 0, 0, 0, .5, 0, a + o / 2, s / 2 + c, .5, 1, h); var u = A.Matrix[0]; return i.multiplyToRef(r, u), u.multiplyToRef(h, u), t.TransformCoordinates(e, u) }, t.UnprojectFromTransform = function (i, r, n, o, s) { var a = A.Matrix[0]; o.multiplyToRef(s, a), a.invert(), i.x = i.x / r * 2 - 1, i.y = -(i.y / n * 2 - 1); var l = t.TransformCoordinates(i, a), c = i.x * a.m[3] + i.y * a.m[7] + i.z * a.m[11] + a.m[15]; return e.Scalar.WithinEpsilon(c, 1) && (l = l.scale(1 / c)), l }, t.Unproject = function (e, i, r, n, o, s) { var a = t.Zero(); return t.UnprojectToRef(e, i, r, n, o, s, a), a }, t.UnprojectToRef = function (e, i, r, n, o, s, a) { t.UnprojectFloatsToRef(e.x, e.y, e.z, i, r, n, o, s, a) }, t.UnprojectFloatsToRef = function (i, r, n, o, s, a, l, c, h) { var u = A.Matrix[0]; a.multiplyToRef(l, u), u.multiplyToRef(c, u), u.invert(); var d = A.Vector3[0]; d.x = i / o * 2 - 1, d.y = -(r / s * 2 - 1), d.z = 2 * n - 1, t.TransformCoordinatesToRef(d, u, h); var f = d.x * u.m[3] + d.y * u.m[7] + d.z * u.m[11] + u.m[15]; e.Scalar.WithinEpsilon(f, 1) && h.scaleInPlace(1 / f) }, t.Minimize = function (e, t) { var i = e.clone(); return i.minimizeInPlace(t), i }, t.Maximize = function (e, t) { var i = e.clone(); return i.maximizeInPlace(t), i }, t.Distance = function (e, i) { return Math.sqrt(t.DistanceSquared(e, i)) }, t.DistanceSquared = function (e, t) { var i = e.x - t.x, r = e.y - t.y, n = e.z - t.z; return i * i + r * r + n * n }, t.Center = function (e, t) { var i = e.add(t); return i.scaleInPlace(.5), i }, t.RotationFromAxis = function (e, i, r) { var n = t.Zero(); return t.RotationFromAxisToRef(e, i, r, n), n }, t.RotationFromAxisToRef = function (e, t, i, r) { var n = A.Quaternion[0]; a.RotationQuaternionFromAxisToRef(e, t, i, n), n.toEulerAnglesToRef(r) }, t }(); e.Vector3 = n; var o = function () { function t(e, t, i, r) { this.x = e, this.y = t, this.z = i, this.w = r } return t.prototype.toString = function () { return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + " W:" + this.w + "}" }, t.prototype.getClassName = function () { return "Vector4" }, t.prototype.getHashCode = function () { var e = this.x || 0; return 397 * (e = 397 * (e = 397 * e ^ (this.y || 0)) ^ (this.z || 0)) ^ (this.w || 0) }, t.prototype.asArray = function () { var e = new Array; return this.toArray(e, 0), e }, t.prototype.toArray = function (e, t) { return void 0 === t && (t = 0), e[t] = this.x, e[t + 1] = this.y, e[t + 2] = this.z, e[t + 3] = this.w, this }, t.prototype.addInPlace = function (e) { return this.x += e.x, this.y += e.y, this.z += e.z, this.w += e.w, this }, t.prototype.add = function (e) { return new t(this.x + e.x, this.y + e.y, this.z + e.z, this.w + e.w) }, t.prototype.addToRef = function (e, t) { return t.x = this.x + e.x, t.y = this.y + e.y, t.z = this.z + e.z, t.w = this.w + e.w, this }, t.prototype.subtractInPlace = function (e) { return this.x -= e.x, this.y -= e.y, this.z -= e.z, this.w -= e.w, this }, t.prototype.subtract = function (e) { return new t(this.x - e.x, this.y - e.y, this.z - e.z, this.w - e.w) }, t.prototype.subtractToRef = function (e, t) { return t.x = this.x - e.x, t.y = this.y - e.y, t.z = this.z - e.z, t.w = this.w - e.w, this }, t.prototype.subtractFromFloats = function (e, i, r, n) { return new t(this.x - e, this.y - i, this.z - r, this.w - n) }, t.prototype.subtractFromFloatsToRef = function (e, t, i, r, n) { return n.x = this.x - e, n.y = this.y - t, n.z = this.z - i, n.w = this.w - r, this }, t.prototype.negate = function () { return new t(-this.x, -this.y, -this.z, -this.w) }, t.prototype.scaleInPlace = function (e) { return this.x *= e, this.y *= e, this.z *= e, this.w *= e, this }, t.prototype.scale = function (e) { return new t(this.x * e, this.y * e, this.z * e, this.w * e) }, t.prototype.scaleToRef = function (e, t) { return t.x = this.x * e, t.y = this.y * e, t.z = this.z * e, t.w = this.w * e, this }, t.prototype.scaleAndAddToRef = function (e, t) { return t.x += this.x * e, t.y += this.y * e, t.z += this.z * e, t.w += this.w * e, this }, t.prototype.equals = function (e) { return e && this.x === e.x && this.y === e.y && this.z === e.z && this.w === e.w }, t.prototype.equalsWithEpsilon = function (t, i) { return void 0 === i && (i = e.Epsilon), t && e.Scalar.WithinEpsilon(this.x, t.x, i) && e.Scalar.WithinEpsilon(this.y, t.y, i) && e.Scalar.WithinEpsilon(this.z, t.z, i) && e.Scalar.WithinEpsilon(this.w, t.w, i) }, t.prototype.equalsToFloats = function (e, t, i, r) { return this.x === e && this.y === t && this.z === i && this.w === r }, t.prototype.multiplyInPlace = function (e) { return this.x *= e.x, this.y *= e.y, this.z *= e.z, this.w *= e.w, this }, t.prototype.multiply = function (e) { return new t(this.x * e.x, this.y * e.y, this.z * e.z, this.w * e.w) }, t.prototype.multiplyToRef = function (e, t) { return t.x = this.x * e.x, t.y = this.y * e.y, t.z = this.z * e.z, t.w = this.w * e.w, this }, t.prototype.multiplyByFloats = function (e, i, r, n) { return new t(this.x * e, this.y * i, this.z * r, this.w * n) }, t.prototype.divide = function (e) { return new t(this.x / e.x, this.y / e.y, this.z / e.z, this.w / e.w) }, t.prototype.divideToRef = function (e, t) { return t.x = this.x / e.x, t.y = this.y / e.y, t.z = this.z / e.z, t.w = this.w / e.w, this }, t.prototype.divideInPlace = function (e) { return this.divideToRef(e, this) }, t.prototype.minimizeInPlace = function (e) { return e.x < this.x && (this.x = e.x), e.y < this.y && (this.y = e.y), e.z < this.z && (this.z = e.z), e.w < this.w && (this.w = e.w), this }, t.prototype.maximizeInPlace = function (e) { return e.x > this.x && (this.x = e.x), e.y > this.y && (this.y = e.y), e.z > this.z && (this.z = e.z), e.w > this.w && (this.w = e.w), this }, t.prototype.floor = function () { return new t(Math.floor(this.x), Math.floor(this.y), Math.floor(this.z), Math.floor(this.w)) }, t.prototype.fract = function () { return new t(this.x - Math.floor(this.x), this.y - Math.floor(this.y), this.z - Math.floor(this.z), this.w - Math.floor(this.w)) }, t.prototype.length = function () { return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w) }, t.prototype.lengthSquared = function () { return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w }, t.prototype.normalize = function () { var e = this.length(); if (0 === e) return this; var t = 1 / e; return this.x *= t, this.y *= t, this.z *= t, this.w *= t, this }, t.prototype.toVector3 = function () { return new n(this.x, this.y, this.z) }, t.prototype.clone = function () { return new t(this.x, this.y, this.z, this.w) }, t.prototype.copyFrom = function (e) { return this.x = e.x, this.y = e.y, this.z = e.z, this.w = e.w, this }, t.prototype.copyFromFloats = function (e, t, i, r) { return this.x = e, this.y = t, this.z = i, this.w = r, this }, t.prototype.set = function (e, t, i, r) { return this.copyFromFloats(e, t, i, r) }, t.FromArray = function (e, i) { return i || (i = 0), new t(e[i], e[i + 1], e[i + 2], e[i + 3]) }, t.FromArrayToRef = function (e, t, i) { i.x = e[t], i.y = e[t + 1], i.z = e[t + 2], i.w = e[t + 3] }, t.FromFloatArrayToRef = function (e, i, r) { t.FromArrayToRef(e, i, r) }, t.FromFloatsToRef = function (e, t, i, r, n) { n.x = e, n.y = t, n.z = i, n.w = r }, t.Zero = function () { return new t(0, 0, 0, 0) }, t.One = function () { return new t(1, 1, 1, 1) }, t.Normalize = function (e) { var i = t.Zero(); return t.NormalizeToRef(e, i), i }, t.NormalizeToRef = function (e, t) { t.copyFrom(e), t.normalize() }, t.Minimize = function (e, t) { var i = e.clone(); return i.minimizeInPlace(t), i }, t.Maximize = function (e, t) { var i = e.clone(); return i.maximizeInPlace(t), i }, t.Distance = function (e, i) { return Math.sqrt(t.DistanceSquared(e, i)) }, t.DistanceSquared = function (e, t) { var i = e.x - t.x, r = e.y - t.y, n = e.z - t.z, o = e.w - t.w; return i * i + r * r + n * n + o * o }, t.Center = function (e, t) { var i = e.add(t); return i.scaleInPlace(.5), i }, t.TransformNormal = function (e, i) { var r = t.Zero(); return t.TransformNormalToRef(e, i, r), r }, t.TransformNormalToRef = function (e, t, i) { var r = e.x * t.m[0] + e.y * t.m[4] + e.z * t.m[8], n = e.x * t.m[1] + e.y * t.m[5] + e.z * t.m[9], o = e.x * t.m[2] + e.y * t.m[6] + e.z * t.m[10]; i.x = r, i.y = n, i.z = o, i.w = e.w }, t.TransformNormalFromFloatsToRef = function (e, t, i, r, n, o) { o.x = e * n.m[0] + t * n.m[4] + i * n.m[8], o.y = e * n.m[1] + t * n.m[5] + i * n.m[9], o.z = e * n.m[2] + t * n.m[6] + i * n.m[10], o.w = r }, t }(); e.Vector4 = o; var s = function () { function e(e, t) { this.width = e, this.height = t } return e.prototype.toString = function () { return "{W: " + this.width + ", H: " + this.height + "}" }, e.prototype.getClassName = function () { return "Size" }, e.prototype.getHashCode = function () { var e = this.width || 0; return 397 * e ^ (this.height || 0) }, e.prototype.copyFrom = function (e) { this.width = e.width, this.height = e.height }, e.prototype.copyFromFloats = function (e, t) { return this.width = e, this.height = t, this }, e.prototype.set = function (e, t) { return this.copyFromFloats(e, t) }, e.prototype.multiplyByFloats = function (t, i) { return new e(this.width * t, this.height * i) }, e.prototype.clone = function () { return new e(this.width, this.height) }, e.prototype.equals = function (e) { return !!e && this.width === e.width && this.height === e.height }, Object.defineProperty(e.prototype, "surface", { get: function () { return this.width * this.height }, enumerable: !0, configurable: !0 }), e.Zero = function () { return new e(0, 0) }, e.prototype.add = function (t) { return new e(this.width + t.width, this.height + t.height) }, e.prototype.subtract = function (t) { return new e(this.width - t.width, this.height - t.height) }, e.Lerp = function (t, i, r) { return new e(t.width + (i.width - t.width) * r, t.height + (i.height - t.height) * r) }, e }(); e.Size = s; var a = function () { function e(e, t, i, r) { void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = 0), void 0 === r && (r = 1), this.x = e, this.y = t, this.z = i, this.w = r } return e.prototype.toString = function () { return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + " W:" + this.w + "}" }, e.prototype.getClassName = function () { return "Quaternion" }, e.prototype.getHashCode = function () { var e = this.x || 0; return 397 * (e = 397 * (e = 397 * e ^ (this.y || 0)) ^ (this.z || 0)) ^ (this.w || 0) }, e.prototype.asArray = function () { return [this.x, this.y, this.z, this.w] }, e.prototype.equals = function (e) { return e && this.x === e.x && this.y === e.y && this.z === e.z && this.w === e.w }, e.prototype.clone = function () { return new e(this.x, this.y, this.z, this.w) }, e.prototype.copyFrom = function (e) { return this.x = e.x, this.y = e.y, this.z = e.z, this.w = e.w, this }, e.prototype.copyFromFloats = function (e, t, i, r) { return this.x = e, this.y = t, this.z = i, this.w = r, this }, e.prototype.set = function (e, t, i, r) { return this.copyFromFloats(e, t, i, r) }, e.prototype.add = function (t) { return new e(this.x + t.x, this.y + t.y, this.z + t.z, this.w + t.w) }, e.prototype.addInPlace = function (e) { return this.x += e.x, this.y += e.y, this.z += e.z, this.w += e.w, this }, e.prototype.subtract = function (t) { return new e(this.x - t.x, this.y - t.y, this.z - t.z, this.w - t.w) }, e.prototype.scale = function (t) { return new e(this.x * t, this.y * t, this.z * t, this.w * t) }, e.prototype.scaleToRef = function (e, t) { return t.x = this.x * e, t.y = this.y * e, t.z = this.z * e, t.w = this.w * e, this }, e.prototype.scaleInPlace = function (e) { return this.x *= e, this.y *= e, this.z *= e, this.w *= e, this }, e.prototype.scaleAndAddToRef = function (e, t) { return t.x += this.x * e, t.y += this.y * e, t.z += this.z * e, t.w += this.w * e, this }, e.prototype.multiply = function (t) { var i = new e(0, 0, 0, 1); return this.multiplyToRef(t, i), i }, e.prototype.multiplyToRef = function (e, t) { var i = this.x * e.w + this.y * e.z - this.z * e.y + this.w * e.x, r = -this.x * e.z + this.y * e.w + this.z * e.x + this.w * e.y, n = this.x * e.y - this.y * e.x + this.z * e.w + this.w * e.z, o = -this.x * e.x - this.y * e.y - this.z * e.z + this.w * e.w; return t.copyFromFloats(i, r, n, o), this }, e.prototype.multiplyInPlace = function (e) { return this.multiplyToRef(e, this), this }, e.prototype.conjugateToRef = function (e) { return e.copyFromFloats(-this.x, -this.y, -this.z, this.w), this }, e.prototype.conjugateInPlace = function () { return this.x *= -1, this.y *= -1, this.z *= -1, this }, e.prototype.conjugate = function () { return new e(-this.x, -this.y, -this.z, this.w) }, e.prototype.length = function () { return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w) }, e.prototype.normalize = function () { var e = 1 / this.length(); return this.x *= e, this.y *= e, this.z *= e, this.w *= e, this }, e.prototype.toEulerAngles = function (e) { void 0 === e && (e = "YZX"); var t = n.Zero(); return this.toEulerAnglesToRef(t, e), t }, e.prototype.toEulerAnglesToRef = function (e, t) { void 0 === t && (t = "YZX"); var i = this.z, r = this.x, n = this.y, o = this.w, s = o * o, a = i * i, l = r * r, c = n * n, h = n * i - r * o; return h < -.4999999 ? (e.y = 2 * Math.atan2(n, o), e.x = Math.PI / 2, e.z = 0) : .4999999 < h ? (e.y = 2 * Math.atan2(n, o), e.x = -Math.PI / 2, e.z = 0) : (e.z = Math.atan2(2 * (r * n + i * o), -a - l + c + s), e.x = Math.asin(-2 * (i * n - r * o)), e.y = Math.atan2(2 * (i * r + n * o), a - l - c + s)), this }, e.prototype.toRotationMatrix = function (e) { var t = this.x * this.x, i = this.y * this.y, r = this.z * this.z, n = this.x * this.y, o = this.z * this.w, s = this.z * this.x, a = this.y * this.w, l = this.y * this.z, c = this.x * this.w; return e.m[0] = 1 - 2 * (i + r), e.m[1] = 2 * (n + o), e.m[2] = 2 * (s - a), e.m[3] = 0, e.m[4] = 2 * (n - o), e.m[5] = 1 - 2 * (r + t), e.m[6] = 2 * (l + c), e.m[7] = 0, e.m[8] = 2 * (s + a), e.m[9] = 2 * (l - c), e.m[10] = 1 - 2 * (i + t), e.m[11] = 0, e.m[12] = 0, e.m[13] = 0, e.m[14] = 0, e.m[15] = 1, e._markAsUpdated(), this }, e.prototype.fromRotationMatrix = function (t) { return e.FromRotationMatrixToRef(t, this), this }, e.FromRotationMatrix = function (t) { var i = new e; return e.FromRotationMatrixToRef(t, i), i }, e.FromRotationMatrixToRef = function (e, t) { var i, r = e.m, n = r[0], o = r[4], s = r[8], a = r[1], l = r[5], c = r[9], h = r[2], u = r[6], d = r[10], f = n + l + d; 0 < f ? (i = .5 / Math.sqrt(f + 1), t.w = .25 / i, t.x = (u - c) * i, t.y = (s - h) * i, t.z = (a - o) * i) : l < n && d < n ? (i = 2 * Math.sqrt(1 + n - l - d), t.w = (u - c) / i, t.x = .25 * i, t.y = (o + a) / i, t.z = (s + h) / i) : d < l ? (i = 2 * Math.sqrt(1 + l - n - d), t.w = (s - h) / i, t.x = (o + a) / i, t.y = .25 * i, t.z = (c + u) / i) : (i = 2 * Math.sqrt(1 + d - n - l), t.w = (a - o) / i, t.x = (s + h) / i, t.y = (c + u) / i, t.z = .25 * i) }, e.Dot = function (e, t) { return e.x * t.x + e.y * t.y + e.z * t.z + e.w * t.w }, e.AreClose = function (t, i) { return 0 <= e.Dot(t, i) }, e.Zero = function () { return new e(0, 0, 0, 0) }, e.Inverse = function (t) { return new e(-t.x, -t.y, -t.z, t.w) }, e.Identity = function () { return new e(0, 0, 0, 1) }, e.IsIdentity = function (e) { return e && 0 === e.x && 0 === e.y && 0 === e.z && 1 === e.w }, e.RotationAxis = function (t, i) { return e.RotationAxisToRef(t, i, new e) }, e.RotationAxisToRef = function (e, t, i) { var r = Math.sin(t / 2); return e.normalize(), i.w = Math.cos(t / 2), i.x = e.x * r, i.y = e.y * r, i.z = e.z * r, i }, e.FromArray = function (t, i) { return i || (i = 0), new e(t[i], t[i + 1], t[i + 2], t[i + 3]) }, e.RotationYawPitchRoll = function (t, i, r) { var n = new e; return e.RotationYawPitchRollToRef(t, i, r, n), n }, e.RotationYawPitchRollToRef = function (e, t, i, r) { var n = .5 * i, o = .5 * t, s = .5 * e, a = Math.sin(n), l = Math.cos(n), c = Math.sin(o), h = Math.cos(o), u = Math.sin(s), d = Math.cos(s); r.x = d * c * l + u * h * a, r.y = u * h * l - d * c * a, r.z = d * h * a - u * c * l, r.w = d * h * l + u * c * a }, e.RotationAlphaBetaGamma = function (t, i, r) { var n = new e; return e.RotationAlphaBetaGammaToRef(t, i, r, n), n }, e.RotationAlphaBetaGammaToRef = function (e, t, i, r) { var n = .5 * (i + e), o = .5 * (i - e), s = .5 * t; r.x = Math.cos(o) * Math.sin(s), r.y = Math.sin(o) * Math.sin(s), r.z = Math.sin(n) * Math.cos(s), r.w = Math.cos(n) * Math.cos(s) }, e.RotationQuaternionFromAxis = function (t, i, r) { var n = new e(0, 0, 0, 0); return e.RotationQuaternionFromAxisToRef(t, i, r, n), n }, e.RotationQuaternionFromAxisToRef = function (t, i, r, n) { var o = A.Matrix[0]; l.FromXYZAxesToRef(t.normalize(), i.normalize(), r.normalize(), o), e.FromRotationMatrixToRef(o, n) }, e.Slerp = function (t, i, r) { var n = e.Identity(); return e.SlerpToRef(t, i, r, n), n }, e.SlerpToRef = function (e, t, i, r) { var n, o, s = e.x * t.x + e.y * t.y + e.z * t.z + e.w * t.w, a = !1; if (s < 0 && (a = !0, s = -s), .999999 < s) o = 1 - i, n = a ? -i : i; else { var l = Math.acos(s), c = 1 / Math.sin(l); o = Math.sin((1 - i) * l) * c, n = a ? -Math.sin(i * l) * c : Math.sin(i * l) * c } r.x = o * e.x + n * t.x, r.y = o * e.y + n * t.y, r.z = o * e.z + n * t.z, r.w = o * e.w + n * t.w }, e.Hermite = function (t, i, r, n, o) { var s = o * o, a = o * s, l = 2 * a - 3 * s + 1, c = -2 * a + 3 * s, h = a - 2 * s + o, u = a - s; return new e(t.x * l + r.x * c + i.x * h + n.x * u, t.y * l + r.y * c + i.y * h + n.y * u, t.z * l + r.z * c + i.z * h + n.z * u, t.w * l + r.w * c + i.w * h + n.w * u) }, e }(); e.Quaternion = a; var l = function () { function e() { this._isIdentity = !1, this._isIdentityDirty = !0, this.m = new Float32Array(16), this._markAsUpdated() } return e.prototype._markAsUpdated = function () { this.updateFlag = e._updateFlagSeed++ , this._isIdentityDirty = !0 }, e.prototype.isIdentity = function (e) { return void 0 === e && (e = !1), this._isIdentityDirty && (this._isIdentityDirty = !1, 1 !== this.m[0] || 1 !== this.m[5] || 1 !== this.m[15] ? this._isIdentity = !1 : 0 !== this.m[1] || 0 !== this.m[2] || 0 !== this.m[3] || 0 !== this.m[4] || 0 !== this.m[6] || 0 !== this.m[7] || 0 !== this.m[8] || 0 !== this.m[9] || 0 !== this.m[11] || 0 !== this.m[12] || 0 !== this.m[13] || 0 !== this.m[14] ? this._isIdentity = !1 : this._isIdentity = !0, e || 1 === this.m[10] || (this._isIdentity = !1)), this._isIdentity }, e.prototype.determinant = function () { var e = this.m[10] * this.m[15] - this.m[11] * this.m[14], t = this.m[9] * this.m[15] - this.m[11] * this.m[13], i = this.m[9] * this.m[14] - this.m[10] * this.m[13], r = this.m[8] * this.m[15] - this.m[11] * this.m[12], n = this.m[8] * this.m[14] - this.m[10] * this.m[12], o = this.m[8] * this.m[13] - this.m[9] * this.m[12]; return this.m[0] * (this.m[5] * e - this.m[6] * t + this.m[7] * i) - this.m[1] * (this.m[4] * e - this.m[6] * r + this.m[7] * n) + this.m[2] * (this.m[4] * t - this.m[5] * r + this.m[7] * o) - this.m[3] * (this.m[4] * i - this.m[5] * n + this.m[6] * o) }, e.prototype.toArray = function () { return this.m }, e.prototype.asArray = function () { return this.toArray() }, e.prototype.invert = function () { return this.invertToRef(this), this }, e.prototype.reset = function () { for (var e = 0; e < 16; e++)this.m[e] = 0; return this._markAsUpdated(), this }, e.prototype.add = function (t) { var i = new e; return this.addToRef(t, i), i }, e.prototype.addToRef = function (e, t) { for (var i = 0; i < 16; i++)t.m[i] = this.m[i] + e.m[i]; return t._markAsUpdated(), this }, e.prototype.addToSelf = function (e) { for (var t = 0; t < 16; t++)this.m[t] += e.m[t]; return this._markAsUpdated(), this }, e.prototype.invertToRef = function (e) { var t = this.m[0], i = this.m[1], r = this.m[2], n = this.m[3], o = this.m[4], s = this.m[5], a = this.m[6], l = this.m[7], c = this.m[8], h = this.m[9], u = this.m[10], d = this.m[11], f = this.m[12], p = this.m[13], _ = this.m[14], m = this.m[15], g = u * m - d * _, v = h * m - d * p, y = h * _ - u * p, b = c * m - d * f, T = c * _ - u * f, E = c * p - h * f, x = s * g - a * v + l * y, P = -(o * g - a * b + l * T), A = o * v - s * b + l * E, S = -(o * y - s * T + a * E), M = 1 / (t * x + i * P + r * A + n * S), R = a * m - l * _, C = s * m - l * p, O = s * _ - a * p, D = o * m - l * f, I = o * _ - a * f, w = o * p - s * f, L = a * d - l * u, F = s * d - l * h, B = s * u - a * h, N = o * d - l * c, V = o * u - a * c, U = o * h - s * c; return e.m[0] = x * M, e.m[4] = P * M, e.m[8] = A * M, e.m[12] = S * M, e.m[1] = -(i * g - r * v + n * y) * M, e.m[5] = (t * g - r * b + n * T) * M, e.m[9] = -(t * v - i * b + n * E) * M, e.m[13] = (t * y - i * T + r * E) * M, e.m[2] = (i * R - r * C + n * O) * M, e.m[6] = -(t * R - r * D + n * I) * M, e.m[10] = (t * C - i * D + n * w) * M, e.m[14] = -(t * O - i * I + r * w) * M, e.m[3] = -(i * L - r * F + n * B) * M, e.m[7] = (t * L - r * N + n * V) * M, e.m[11] = -(t * F - i * N + n * U) * M, e.m[15] = (t * B - i * V + r * U) * M, e._markAsUpdated(), this }, e.prototype.setTranslationFromFloats = function (e, t, i) { return this.m[12] = e, this.m[13] = t, this.m[14] = i, this._markAsUpdated(), this }, e.prototype.setTranslation = function (e) { return this.m[12] = e.x, this.m[13] = e.y, this.m[14] = e.z, this._markAsUpdated(), this }, e.prototype.getTranslation = function () { return new n(this.m[12], this.m[13], this.m[14]) }, e.prototype.getTranslationToRef = function (e) { return e.x = this.m[12], e.y = this.m[13], e.z = this.m[14], this }, e.prototype.removeRotationAndScaling = function () { return this.setRowFromFloats(0, 1, 0, 0, 0), this.setRowFromFloats(1, 0, 1, 0, 0), this.setRowFromFloats(2, 0, 0, 1, 0), this }, e.prototype.multiply = function (t) { var i = new e; return this.multiplyToRef(t, i), i }, e.prototype.copyFrom = function (e) { for (var t = 0; t < 16; t++)this.m[t] = e.m[t]; return this._markAsUpdated(), this }, e.prototype.copyToArray = function (e, t) { void 0 === t && (t = 0); for (var i = 0; i < 16; i++)e[t + i] = this.m[i]; return this }, e.prototype.multiplyToRef = function (e, t) { return this.multiplyToArray(e, t.m, 0), t._markAsUpdated(), this }, e.prototype.multiplyToArray = function (e, t, i) { var r = this.m[0], n = this.m[1], o = this.m[2], s = this.m[3], a = this.m[4], l = this.m[5], c = this.m[6], h = this.m[7], u = this.m[8], d = this.m[9], f = this.m[10], p = this.m[11], _ = this.m[12], m = this.m[13], g = this.m[14], v = this.m[15], y = e.m[0], b = e.m[1], T = e.m[2], E = e.m[3], x = e.m[4], P = e.m[5], A = e.m[6], S = e.m[7], M = e.m[8], R = e.m[9], C = e.m[10], O = e.m[11], D = e.m[12], I = e.m[13], w = e.m[14], L = e.m[15]; return t[i] = r * y + n * x + o * M + s * D, t[i + 1] = r * b + n * P + o * R + s * I, t[i + 2] = r * T + n * A + o * C + s * w, t[i + 3] = r * E + n * S + o * O + s * L, t[i + 4] = a * y + l * x + c * M + h * D, t[i + 5] = a * b + l * P + c * R + h * I, t[i + 6] = a * T + l * A + c * C + h * w, t[i + 7] = a * E + l * S + c * O + h * L, t[i + 8] = u * y + d * x + f * M + p * D, t[i + 9] = u * b + d * P + f * R + p * I, t[i + 10] = u * T + d * A + f * C + p * w, t[i + 11] = u * E + d * S + f * O + p * L, t[i + 12] = _ * y + m * x + g * M + v * D, t[i + 13] = _ * b + m * P + g * R + v * I, t[i + 14] = _ * T + m * A + g * C + v * w, t[i + 15] = _ * E + m * S + g * O + v * L, this }, e.prototype.equals = function (e) { return e && this.m[0] === e.m[0] && this.m[1] === e.m[1] && this.m[2] === e.m[2] && this.m[3] === e.m[3] && this.m[4] === e.m[4] && this.m[5] === e.m[5] && this.m[6] === e.m[6] && this.m[7] === e.m[7] && this.m[8] === e.m[8] && this.m[9] === e.m[9] && this.m[10] === e.m[10] && this.m[11] === e.m[11] && this.m[12] === e.m[12] && this.m[13] === e.m[13] && this.m[14] === e.m[14] && this.m[15] === e.m[15] }, e.prototype.clone = function () { return e.FromValues(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5], this.m[6], this.m[7], this.m[8], this.m[9], this.m[10], this.m[11], this.m[12], this.m[13], this.m[14], this.m[15]) }, e.prototype.getClassName = function () { return "Matrix" }, e.prototype.getHashCode = function () { for (var e = this.m[0] || 0, t = 1; t < 16; t++)e = 397 * e ^ (this.m[t] || 0); return e }, e.prototype.decompose = function (t, i, r) { return r && (r.x = this.m[12], r.y = this.m[13], r.z = this.m[14]), (t = t || A.Vector3[0]).x = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1] + this.m[2] * this.m[2]), t.y = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5] + this.m[6] * this.m[6]), t.z = Math.sqrt(this.m[8] * this.m[8] + this.m[9] * this.m[9] + this.m[10] * this.m[10]), this.determinant() <= 0 && (t.y *= -1), 0 === t.x || 0 === t.y || 0 === t.z ? (i && (i.x = 0, i.y = 0, i.z = 0, i.w = 1), !1) : (i && (e.FromValuesToRef(this.m[0] / t.x, this.m[1] / t.x, this.m[2] / t.x, 0, this.m[4] / t.y, this.m[5] / t.y, this.m[6] / t.y, 0, this.m[8] / t.z, this.m[9] / t.z, this.m[10] / t.z, 0, 0, 0, 0, 1, A.Matrix[0]), a.FromRotationMatrixToRef(A.Matrix[0], i)), !0) }, e.prototype.getRow = function (e) { if (e < 0 || 3 < e) return null; var t = 4 * e; return new o(this.m[t + 0], this.m[t + 1], this.m[t + 2], this.m[t + 3]) }, e.prototype.setRow = function (e, t) { if (e < 0 || 3 < e) return this; var i = 4 * e; return this.m[i + 0] = t.x, this.m[i + 1] = t.y, this.m[i + 2] = t.z, this.m[i + 3] = t.w, this._markAsUpdated(), this }, e.prototype.transpose = function () { return e.Transpose(this) }, e.prototype.transposeToRef = function (t) { return e.TransposeToRef(this, t), this }, e.prototype.setRowFromFloats = function (e, t, i, r, n) { if (e < 0 || 3 < e) return this; var o = 4 * e; return this.m[o + 0] = t, this.m[o + 1] = i, this.m[o + 2] = r, this.m[o + 3] = n, this._markAsUpdated(), this }, e.prototype.scale = function (t) { var i = new e; return this.scaleToRef(t, i), i }, e.prototype.scaleToRef = function (e, t) { for (var i = 0; i < 16; i++)t.m[i] = this.m[i] * e; return t._markAsUpdated(), this }, e.prototype.scaleAndAddToRef = function (e, t) { for (var i = 0; i < 16; i++)t.m[i] += this.m[i] * e; return t._markAsUpdated(), this }, e.prototype.toNormalMatrix = function (t) { this.invertToRef(t), t.transpose(); var i = t.m; e.FromValuesToRef(i[0], i[1], i[2], 0, i[4], i[5], i[6], 0, i[8], i[9], i[10], 0, 0, 0, 0, 1, t) }, e.prototype.getRotationMatrix = function () { var t = e.Identity(); return this.getRotationMatrixToRef(t), t }, e.prototype.getRotationMatrixToRef = function (t) { var i = this.m, r = Math.sqrt(i[0] * i[0] + i[1] * i[1] + i[2] * i[2]), n = Math.sqrt(i[4] * i[4] + i[5] * i[5] + i[6] * i[6]), o = Math.sqrt(i[8] * i[8] + i[9] * i[9] + i[10] * i[10]); return this.determinant() <= 0 && (n *= -1), 0 === r || 0 === n || 0 === o ? e.IdentityToRef(t) : e.FromValuesToRef(i[0] / r, i[1] / r, i[2] / r, 0, i[4] / n, i[5] / n, i[6] / n, 0, i[8] / o, i[9] / o, i[10] / o, 0, 0, 0, 0, 1, t), this }, e.FromArray = function (t, i) { var r = new e; return i || (i = 0), e.FromArrayToRef(t, i, r), r }, e.FromArrayToRef = function (e, t, i) { for (var r = 0; r < 16; r++)i.m[r] = e[r + t]; i._markAsUpdated() }, e.FromFloat32ArrayToRefScaled = function (e, t, i, r) { for (var n = 0; n < 16; n++)r.m[n] = e[n + t] * i; r._markAsUpdated() }, e.FromValuesToRef = function (e, t, i, r, n, o, s, a, l, c, h, u, d, f, p, _, m) { m.m[0] = e, m.m[1] = t, m.m[2] = i, m.m[3] = r, m.m[4] = n, m.m[5] = o, m.m[6] = s, m.m[7] = a, m.m[8] = l, m.m[9] = c, m.m[10] = h, m.m[11] = u, m.m[12] = d, m.m[13] = f, m.m[14] = p, m.m[15] = _, m._markAsUpdated() }, Object.defineProperty(e, "IdentityReadOnly", { get: function () { return e._identityReadOnly }, enumerable: !0, configurable: !0 }), e.FromValues = function (t, i, r, n, o, s, a, l, c, h, u, d, f, p, _, m) { var g = new e; return g.m[0] = t, g.m[1] = i, g.m[2] = r, g.m[3] = n, g.m[4] = o, g.m[5] = s, g.m[6] = a, g.m[7] = l, g.m[8] = c, g.m[9] = h, g.m[10] = u, g.m[11] = d, g.m[12] = f, g.m[13] = p, g.m[14] = _, g.m[15] = m, g }, e.Compose = function (t, i, r) { var n = e.Identity(); return e.ComposeToRef(t, i, r, n), n }, e.ComposeToRef = function (t, i, r, n) { e.FromValuesToRef(t.x, 0, 0, 0, 0, t.y, 0, 0, 0, 0, t.z, 0, 0, 0, 0, 1, A.Matrix[1]), i.toRotationMatrix(A.Matrix[0]), A.Matrix[1].multiplyToRef(A.Matrix[0], n), n.setTranslation(r) }, e.Identity = function () { return e.FromValues(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) }, e.IdentityToRef = function (t) { e.FromValuesToRef(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, t) }, e.Zero = function () { return e.FromValues(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0) }, e.RotationX = function (t) { var i = new e; return e.RotationXToRef(t, i), i }, e.Invert = function (t) { var i = new e; return t.invertToRef(i), i }, e.RotationXToRef = function (e, t) { var i = Math.sin(e), r = Math.cos(e); t.m[0] = 1, t.m[15] = 1, t.m[5] = r, t.m[10] = r, t.m[9] = -i, t.m[6] = i, t.m[1] = 0, t.m[2] = 0, t.m[3] = 0, t.m[4] = 0, t.m[7] = 0, t.m[8] = 0, t.m[11] = 0, t.m[12] = 0, t.m[13] = 0, t.m[14] = 0, t._markAsUpdated() }, e.RotationY = function (t) { var i = new e; return e.RotationYToRef(t, i), i }, e.RotationYToRef = function (e, t) { var i = Math.sin(e), r = Math.cos(e); t.m[5] = 1, t.m[15] = 1, t.m[0] = r, t.m[2] = -i, t.m[8] = i, t.m[10] = r, t.m[1] = 0, t.m[3] = 0, t.m[4] = 0, t.m[6] = 0, t.m[7] = 0, t.m[9] = 0, t.m[11] = 0, t.m[12] = 0, t.m[13] = 0, t.m[14] = 0, t._markAsUpdated() }, e.RotationZ = function (t) { var i = new e; return e.RotationZToRef(t, i), i }, e.RotationZToRef = function (e, t) { var i = Math.sin(e), r = Math.cos(e); t.m[10] = 1, t.m[15] = 1, t.m[0] = r, t.m[1] = i, t.m[4] = -i, t.m[5] = r, t.m[2] = 0, t.m[3] = 0, t.m[6] = 0, t.m[7] = 0, t.m[8] = 0, t.m[9] = 0, t.m[11] = 0, t.m[12] = 0, t.m[13] = 0, t.m[14] = 0, t._markAsUpdated() }, e.RotationAxis = function (t, i) { var r = e.Zero(); return e.RotationAxisToRef(t, i, r), r }, e.RotationAxisToRef = function (e, t, i) { var r = Math.sin(-t), n = Math.cos(-t), o = 1 - n; e.normalize(), i.m[0] = e.x * e.x * o + n, i.m[1] = e.x * e.y * o - e.z * r, i.m[2] = e.x * e.z * o + e.y * r, i.m[3] = 0, i.m[4] = e.y * e.x * o + e.z * r, i.m[5] = e.y * e.y * o + n, i.m[6] = e.y * e.z * o - e.x * r, i.m[7] = 0, i.m[8] = e.z * e.x * o - e.y * r, i.m[9] = e.z * e.y * o + e.x * r, i.m[10] = e.z * e.z * o + n, i.m[11] = 0, i.m[15] = 1, i._markAsUpdated() }, e.RotationYawPitchRoll = function (t, i, r) { var n = new e; return e.RotationYawPitchRollToRef(t, i, r, n), n }, e.RotationYawPitchRollToRef = function (e, t, i, r) { a.RotationYawPitchRollToRef(e, t, i, this._tempQuaternion), this._tempQuaternion.toRotationMatrix(r) }, e.Scaling = function (t, i, r) { var n = e.Zero(); return e.ScalingToRef(t, i, r, n), n }, e.ScalingToRef = function (e, t, i, r) { r.m[0] = e, r.m[1] = 0, r.m[2] = 0, r.m[3] = 0, r.m[4] = 0, r.m[5] = t, r.m[6] = 0, r.m[7] = 0, r.m[8] = 0, r.m[9] = 0, r.m[10] = i, r.m[11] = 0, r.m[12] = 0, r.m[13] = 0, r.m[14] = 0, r.m[15] = 1, r._markAsUpdated() }, e.Translation = function (t, i, r) { var n = e.Identity(); return e.TranslationToRef(t, i, r, n), n }, e.TranslationToRef = function (t, i, r, n) { e.FromValuesToRef(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, t, i, r, 1, n) }, e.Lerp = function (t, i, r) { var n = e.Zero(); return e.LerpToRef(t, i, r, n), n }, e.LerpToRef = function (e, t, i, r) { for (var n = 0; n < 16; n++)r.m[n] = e.m[n] * (1 - i) + t.m[n] * i; r._markAsUpdated() }, e.DecomposeLerp = function (t, i, r) { var n = e.Zero(); return e.DecomposeLerpToRef(t, i, r, n), n }, e.DecomposeLerpToRef = function (t, i, r, o) { var s = A.Vector3[0], l = A.Quaternion[0], c = A.Vector3[1]; t.decompose(s, l, c); var h = A.Vector3[2], u = A.Quaternion[1], d = A.Vector3[3]; i.decompose(h, u, d); var f = A.Vector3[4]; n.LerpToRef(s, h, r, f); var p = A.Quaternion[2]; a.SlerpToRef(l, u, r, p); var _ = A.Vector3[5]; n.LerpToRef(c, d, r, _), e.ComposeToRef(f, p, _, o) }, e.LookAtLH = function (t, i, r) { var n = e.Zero(); return e.LookAtLHToRef(t, i, r, n), n }, e.LookAtLHToRef = function (t, i, r, o) { i.subtractToRef(t, this._zAxis), this._zAxis.normalize(), n.CrossToRef(r, this._zAxis, this._xAxis), 0 === this._xAxis.lengthSquared() ? this._xAxis.x = 1 : this._xAxis.normalize(), n.CrossToRef(this._zAxis, this._xAxis, this._yAxis), this._yAxis.normalize(); var s = -n.Dot(this._xAxis, t), a = -n.Dot(this._yAxis, t), l = -n.Dot(this._zAxis, t); return e.FromValuesToRef(this._xAxis.x, this._yAxis.x, this._zAxis.x, 0, this._xAxis.y, this._yAxis.y, this._zAxis.y, 0, this._xAxis.z, this._yAxis.z, this._zAxis.z, 0, s, a, l, 1, o) }, e.LookAtRH = function (t, i, r) { var n = e.Zero(); return e.LookAtRHToRef(t, i, r, n), n }, e.LookAtRHToRef = function (t, i, r, o) { t.subtractToRef(i, this._zAxis), this._zAxis.normalize(), n.CrossToRef(r, this._zAxis, this._xAxis), 0 === this._xAxis.lengthSquared() ? this._xAxis.x = 1 : this._xAxis.normalize(), n.CrossToRef(this._zAxis, this._xAxis, this._yAxis), this._yAxis.normalize(); var s = -n.Dot(this._xAxis, t), a = -n.Dot(this._yAxis, t), l = -n.Dot(this._zAxis, t); return e.FromValuesToRef(this._xAxis.x, this._yAxis.x, this._zAxis.x, 0, this._xAxis.y, this._yAxis.y, this._zAxis.y, 0, this._xAxis.z, this._yAxis.z, this._zAxis.z, 0, s, a, l, 1, o) }, e.OrthoLH = function (t, i, r, n) { var o = e.Zero(); return e.OrthoLHToRef(t, i, r, n, o), o }, e.OrthoLHToRef = function (t, i, r, n, o) { e.FromValuesToRef(2 / t, 0, 0, 0, 0, 2 / i, 0, 0, 0, 0, 2 / (n - r), 0, 0, 0, -(n + r) / (n - r), 1, o) }, e.OrthoOffCenterLH = function (t, i, r, n, o, s) { var a = e.Zero(); return e.OrthoOffCenterLHToRef(t, i, r, n, o, s, a), a }, e.OrthoOffCenterLHToRef = function (t, i, r, n, o, s, a) { e.FromValuesToRef(2 / (i - t), 0, 0, 0, 0, 2 / (n - r), 0, 0, 0, 0, 2 / (s - o), 0, (t + i) / (t - i), (n + r) / (r - n), -(s + o) / (s - o), 1, a) }, e.OrthoOffCenterRH = function (t, i, r, n, o, s) { var a = e.Zero(); return e.OrthoOffCenterRHToRef(t, i, r, n, o, s, a), a }, e.OrthoOffCenterRHToRef = function (t, i, r, n, o, s, a) { e.OrthoOffCenterLHToRef(t, i, r, n, o, s, a), a.m[10] *= -1 }, e.PerspectiveLH = function (t, i, r, n) { var o = e.Zero(); return e.FromValuesToRef(2 * r / t, 0, 0, 0, 0, 2 * r / i, 0, 0, 0, 0, (n + r) / (n - r), 1, 0, 0, -2 * n * r / (n - r), 0, o), o }, e.PerspectiveFovLH = function (t, i, r, n) { var o = e.Zero(); return e.PerspectiveFovLHToRef(t, i, r, n, o), o }, e.PerspectiveFovLHToRef = function (t, i, r, n, o, s) { void 0 === s && (s = !0); var a = r, l = n, c = 1 / Math.tan(.5 * t); e.FromValuesToRef(s ? c / i : c, 0, 0, 0, 0, s ? c : c * i, 0, 0, 0, 0, (l + a) / (l - a), 1, 0, 0, -2 * l * a / (l - a), 0, o) }, e.PerspectiveFovRH = function (t, i, r, n) { var o = e.Zero(); return e.PerspectiveFovRHToRef(t, i, r, n, o), o }, e.PerspectiveFovRHToRef = function (t, i, r, n, o, s) { void 0 === s && (s = !0); var a = r, l = n, c = 1 / Math.tan(.5 * t); e.FromValuesToRef(s ? c / i : c, 0, 0, 0, 0, s ? c : c * i, 0, 0, 0, 0, -(l + a) / (l - a), -1, 0, 0, -2 * l * a / (l - a), 0, o) }, e.PerspectiveFovWebVRToRef = function (e, t, i, r, n) { void 0 === n && (n = !1); var o = n ? -1 : 1, s = Math.tan(e.upDegrees * Math.PI / 180), a = Math.tan(e.downDegrees * Math.PI / 180), l = Math.tan(e.leftDegrees * Math.PI / 180), c = Math.tan(e.rightDegrees * Math.PI / 180), h = 2 / (l + c), u = 2 / (s + a); r.m[0] = h, r.m[1] = r.m[2] = r.m[3] = r.m[4] = 0, r.m[5] = u, r.m[6] = r.m[7] = 0, r.m[8] = (l - c) * h * .5, r.m[9] = -(s - a) * u * .5, r.m[10] = -i / (t - i), r.m[11] = 1 * o, r.m[12] = r.m[13] = r.m[15] = 0, r.m[14] = -2 * i * t / (i - t), r._markAsUpdated() }, e.GetFinalMatrix = function (t, i, r, n, o, s) { var a = t.width, l = t.height, c = t.x, h = t.y, u = e.FromValues(a / 2, 0, 0, 0, 0, -l / 2, 0, 0, 0, 0, s - o, 0, c + a / 2, l / 2 + h, o, 1); return i.multiply(r).multiply(n).multiply(u) }, e.GetAsMatrix2x2 = function (e) { return new Float32Array([e.m[0], e.m[1], e.m[4], e.m[5]]) }, e.GetAsMatrix3x3 = function (e) { return new Float32Array([e.m[0], e.m[1], e.m[2], e.m[4], e.m[5], e.m[6], e.m[8], e.m[9], e.m[10]]) }, e.Transpose = function (t) { var i = new e; return e.TransposeToRef(t, i), i }, e.TransposeToRef = function (e, t) { t.m[0] = e.m[0], t.m[1] = e.m[4], t.m[2] = e.m[8], t.m[3] = e.m[12], t.m[4] = e.m[1], t.m[5] = e.m[5], t.m[6] = e.m[9], t.m[7] = e.m[13], t.m[8] = e.m[2], t.m[9] = e.m[6], t.m[10] = e.m[10], t.m[11] = e.m[14], t.m[12] = e.m[3], t.m[13] = e.m[7], t.m[14] = e.m[11], t.m[15] = e.m[15] }, e.Reflection = function (t) { var i = new e; return e.ReflectionToRef(t, i), i }, e.ReflectionToRef = function (e, t) { e.normalize(); var i = e.normal.x, r = e.normal.y, n = e.normal.z, o = -2 * i, s = -2 * r, a = -2 * n; t.m[0] = o * i + 1, t.m[1] = s * i, t.m[2] = a * i, t.m[3] = 0, t.m[4] = o * r, t.m[5] = s * r + 1, t.m[6] = a * r, t.m[7] = 0, t.m[8] = o * n, t.m[9] = s * n, t.m[10] = a * n + 1, t.m[11] = 0, t.m[12] = o * e.d, t.m[13] = s * e.d, t.m[14] = a * e.d, t.m[15] = 1, t._markAsUpdated() }, e.FromXYZAxesToRef = function (e, t, i, r) { r.m[0] = e.x, r.m[1] = e.y, r.m[2] = e.z, r.m[3] = 0, r.m[4] = t.x, r.m[5] = t.y, r.m[6] = t.z, r.m[7] = 0, r.m[8] = i.x, r.m[9] = i.y, r.m[10] = i.z, r.m[11] = 0, r.m[12] = 0, r.m[13] = 0, r.m[14] = 0, r.m[15] = 1, r._markAsUpdated() }, e.FromQuaternionToRef = function (e, t) { var i = e.x * e.x, r = e.y * e.y, n = e.z * e.z, o = e.x * e.y, s = e.z * e.w, a = e.z * e.x, l = e.y * e.w, c = e.y * e.z, h = e.x * e.w; t.m[0] = 1 - 2 * (r + n), t.m[1] = 2 * (o + s), t.m[2] = 2 * (a - l), t.m[3] = 0, t.m[4] = 2 * (o - s), t.m[5] = 1 - 2 * (n + i), t.m[6] = 2 * (c + h), t.m[7] = 0, t.m[8] = 2 * (a + l), t.m[9] = 2 * (c - h), t.m[10] = 1 - 2 * (r + i), t.m[11] = 0, t.m[12] = 0, t.m[13] = 0, t.m[14] = 0, t.m[15] = 1, t._markAsUpdated() }, e._tempQuaternion = new a, e._xAxis = n.Zero(), e._yAxis = n.Zero(), e._zAxis = n.Zero(), e._updateFlagSeed = 0, e._identityReadOnly = e.Identity(), e }(); e.Matrix = l; var c = function () { function e(e, t, i, r) { this.normal = new n(e, t, i), this.d = r } return e.prototype.asArray = function () { return [this.normal.x, this.normal.y, this.normal.z, this.d] }, e.prototype.clone = function () { return new e(this.normal.x, this.normal.y, this.normal.z, this.d) }, e.prototype.getClassName = function () { return "Plane" }, e.prototype.getHashCode = function () { var e = this.normal.getHashCode(); return 397 * e ^ (this.d || 0) }, e.prototype.normalize = function () { var e = Math.sqrt(this.normal.x * this.normal.x + this.normal.y * this.normal.y + this.normal.z * this.normal.z), t = 0; return 0 !== e && (t = 1 / e), this.normal.x *= t, this.normal.y *= t, this.normal.z *= t, this.d *= t, this }, e.prototype.transform = function (t) { var i = l.Transpose(t), r = this.normal.x, n = this.normal.y, o = this.normal.z, s = this.d; return new e(r * i.m[0] + n * i.m[1] + o * i.m[2] + s * i.m[3], r * i.m[4] + n * i.m[5] + o * i.m[6] + s * i.m[7], r * i.m[8] + n * i.m[9] + o * i.m[10] + s * i.m[11], r * i.m[12] + n * i.m[13] + o * i.m[14] + s * i.m[15]) }, e.prototype.dotCoordinate = function (e) { return this.normal.x * e.x + this.normal.y * e.y + this.normal.z * e.z + this.d }, e.prototype.copyFromPoints = function (e, t, i) { var r, n = t.x - e.x, o = t.y - e.y, s = t.z - e.z, a = i.x - e.x, l = i.y - e.y, c = i.z - e.z, h = o * c - s * l, u = s * a - n * c, d = n * l - o * a, f = Math.sqrt(h * h + u * u + d * d); return r = 0 !== f ? 1 / f : 0, this.normal.x = h * r, this.normal.y = u * r, this.normal.z = d * r, this.d = -(this.normal.x * e.x + this.normal.y * e.y + this.normal.z * e.z), this }, e.prototype.isFrontFacingTo = function (e, t) { return n.Dot(this.normal, e) <= t }, e.prototype.signedDistanceTo = function (e) { return n.Dot(e, this.normal) + this.d }, e.FromArray = function (t) { return new e(t[0], t[1], t[2], t[3]) }, e.FromPoints = function (t, i, r) { var n = new e(0, 0, 0, 0); return n.copyFromPoints(t, i, r), n }, e.FromPositionAndNormal = function (t, i) { var r = new e(0, 0, 0, 0); return i.normalize(), r.normal = i, r.d = -(i.x * t.x + i.y * t.y + i.z * t.z), r }, e.SignedDistanceToPlaneFromPositionAndNormal = function (e, t, i) { var r = -(t.x * e.x + t.y * e.y + t.z * e.z); return n.Dot(i, t) + r }, e }(); e.Plane = c; var h = function () { function e(e, t, i, r) { this.x = e, this.y = t, this.width = i, this.height = r } return e.prototype.toGlobal = function (t, i) { if (t.getRenderWidth) { var r = t; return this.toGlobal(r.getRenderWidth(), r.getRenderHeight()) } var n = t; return new e(this.x * n, this.y * i, this.width * n, this.height * i) }, e.prototype.clone = function () { return new e(this.x, this.y, this.width, this.height) }, e }(); e.Viewport = h; var u, d = function () { function e() { } return e.GetPlanes = function (t) { for (var i = [], r = 0; r < 6; r++)i.push(new c(0, 0, 0, 0)); return e.GetPlanesToRef(t, i), i }, e.GetNearPlaneToRef = function (e, t) { t.normal.x = e.m[3] + e.m[2], t.normal.y = e.m[7] + e.m[6], t.normal.z = e.m[11] + e.m[10], t.d = e.m[15] + e.m[14], t.normalize() }, e.GetFarPlaneToRef = function (e, t) { t.normal.x = e.m[3] - e.m[2], t.normal.y = e.m[7] - e.m[6], t.normal.z = e.m[11] - e.m[10], t.d = e.m[15] - e.m[14], t.normalize() }, e.GetLeftPlaneToRef = function (e, t) { t.normal.x = e.m[3] + e.m[0], t.normal.y = e.m[7] + e.m[4], t.normal.z = e.m[11] + e.m[8], t.d = e.m[15] + e.m[12], t.normalize() }, e.GetRightPlaneToRef = function (e, t) { t.normal.x = e.m[3] - e.m[0], t.normal.y = e.m[7] - e.m[4], t.normal.z = e.m[11] - e.m[8], t.d = e.m[15] - e.m[12], t.normalize() }, e.GetTopPlaneToRef = function (e, t) { t.normal.x = e.m[3] - e.m[1], t.normal.y = e.m[7] - e.m[5], t.normal.z = e.m[11] - e.m[9], t.d = e.m[15] - e.m[13], t.normalize() }, e.GetBottomPlaneToRef = function (e, t) { t.normal.x = e.m[3] + e.m[1], t.normal.y = e.m[7] + e.m[5], t.normal.z = e.m[11] + e.m[9], t.d = e.m[15] + e.m[13], t.normalize() }, e.GetPlanesToRef = function (t, i) { e.GetNearPlaneToRef(t, i[0]), e.GetFarPlaneToRef(t, i[1]), e.GetLeftPlaneToRef(t, i[2]), e.GetRightPlaneToRef(t, i[3]), e.GetTopPlaneToRef(t, i[4]), e.GetBottomPlaneToRef(t, i[5]) }, e }(); e.Frustum = d, (u = e.Space || (e.Space = {}))[u.LOCAL = 0] = "LOCAL", u[u.WORLD = 1] = "WORLD", u[u.BONE = 2] = "BONE"; var f = function () { function e() { } return e.X = new n(1, 0, 0), e.Y = new n(0, 1, 0), e.Z = new n(0, 0, 1), e }(); e.Axis = f; var p, _, m = function () { function e() { } return e.Interpolate = function (e, t, i, r, n) { for (var o = 1 - 3 * r + 3 * t, s = 3 * r - 6 * t, a = 3 * t, l = e, c = 0; c < 5; c++) { var h = l * l; l -= 1 / (3 * o * h + 2 * s * l + a) * (o * (h * l) + s * h + a * l - e), l = Math.min(1, Math.max(0, l)) } return 3 * Math.pow(1 - l, 2) * l * i + 3 * (1 - l) * Math.pow(l, 2) * n + Math.pow(l, 3) }, e }(); e.BezierCurve = m, (_ = p = e.Orientation || (e.Orientation = {}))[_.CW = 0] = "CW", _[_.CCW = 1] = "CCW"; var g = function () { function e(e) { this._radians = e, this._radians < 0 && (this._radians += 2 * Math.PI) } return e.prototype.degrees = function () { return 180 * this._radians / Math.PI }, e.prototype.radians = function () { return this._radians }, e.BetweenTwoPoints = function (t, i) { var r = i.subtract(t); return new e(Math.atan2(r.y, r.x)) }, e.FromRadians = function (t) { return new e(t) }, e.FromDegrees = function (t) { return new e(t * Math.PI / 180) }, e }(); e.Angle = g; var v = function (e, t, i) { this.startPoint = e, this.midPoint = t, this.endPoint = i; var n = Math.pow(t.x, 2) + Math.pow(t.y, 2), o = (Math.pow(e.x, 2) + Math.pow(e.y, 2) - n) / 2, s = (n - Math.pow(i.x, 2) - Math.pow(i.y, 2)) / 2, a = (e.x - t.x) * (t.y - i.y) - (t.x - i.x) * (e.y - t.y); this.centerPoint = new r((o * (t.y - i.y) - s * (e.y - t.y)) / a, ((e.x - t.x) * s - (t.x - i.x) * o) / a), this.radius = this.centerPoint.subtract(this.startPoint).length(), this.startAngle = g.BetweenTwoPoints(this.centerPoint, this.startPoint); var l = this.startAngle.degrees(), c = g.BetweenTwoPoints(this.centerPoint, this.midPoint).degrees(), h = g.BetweenTwoPoints(this.centerPoint, this.endPoint).degrees(); 180 < c - l && (c -= 360), c - l < -180 && (c += 360), 180 < h - c && (h -= 360), h - c < -180 && (h += 360), this.orientation = c - l < 0 ? p.CW : p.CCW, this.angle = g.FromDegrees(this.orientation === p.CW ? l - h : h - l) }; e.Arc2 = v; var y = function () { function e(e, t) { this._points = new Array, this._length = 0, this.closed = !1, this._points.push(new r(e, t)) } return e.prototype.addLineTo = function (e, t) { if (this.closed) return this; var i = new r(e, t), n = this._points[this._points.length - 1]; return this._points.push(i), this._length += i.subtract(n).length(), this }, e.prototype.addArcTo = function (e, t, i, n, o) { if (void 0 === o && (o = 36), this.closed) return this; var s = this._points[this._points.length - 1], a = new r(e, t), l = new r(i, n), c = new v(s, a, l), h = c.angle.radians() / o; c.orientation === p.CW && (h *= -1); for (var u = c.startAngle.radians() + h, d = 0; d < o; d++) { var f = Math.cos(u) * c.radius + c.centerPoint.x, _ = Math.sin(u) * c.radius + c.centerPoint.y; this.addLineTo(f, _), u += h } return this }, e.prototype.close = function () { return this.closed = !0, this }, e.prototype.length = function () { var e = this._length; if (!this.closed) { var t = this._points[this._points.length - 1]; e += this._points[0].subtract(t).length() } return e }, e.prototype.getPoints = function () { return this._points }, e.prototype.getPointAtLengthPosition = function (e) { if (e < 0 || 1 < e) return r.Zero(); for (var t = e * this.length(), i = 0, n = 0; n < this._points.length; n++) { var o = (n + 1) % this._points.length, s = this._points[n], a = this._points[o].subtract(s), l = a.length() + i; if (i <= t && t <= l) { var c = a.normalize(), h = t - i; return new r(s.x + c.x * h, s.y + c.y * h) } i = l } return r.Zero() }, e.StartingAt = function (t, i) { return new e(t, i) }, e }(); e.Path2 = y; var b = function () { function t(e, t, i) { void 0 === t && (t = null), this.path = e, this._curve = new Array, this._distances = new Array, this._tangents = new Array, this._normals = new Array, this._binormals = new Array; for (var r = 0; r < e.length; r++)this._curve[r] = e[r].clone(); this._raw = i || !1, this._compute(t) } return t.prototype.getCurve = function () { return this._curve }, t.prototype.getTangents = function () { return this._tangents }, t.prototype.getNormals = function () { return this._normals }, t.prototype.getBinormals = function () { return this._binormals }, t.prototype.getDistances = function () { return this._distances }, t.prototype.update = function (e, t) { void 0 === t && (t = null); for (var i = 0; i < e.length; i++)this._curve[i].x = e[i].x, this._curve[i].y = e[i].y, this._curve[i].z = e[i].z; return this._compute(t), this }, t.prototype._compute = function (e) { var t = this._curve.length; this._tangents[0] = this._getFirstNonNullVector(0), this._raw || this._tangents[0].normalize(), this._tangents[t - 1] = this._curve[t - 1].subtract(this._curve[t - 2]), this._raw || this._tangents[t - 1].normalize(); var i, r, o, s, a = this._tangents[0], l = this._normalVector(this._curve[0], a, e); this._normals[0] = l, this._raw || this._normals[0].normalize(), this._binormals[0] = n.Cross(a, this._normals[0]), this._raw || this._binormals[0].normalize(), this._distances[0] = 0; for (var c = 1; c < t; c++)i = this._getLastNonNullVector(c), c < t - 1 && (r = this._getFirstNonNullVector(c), this._tangents[c] = i.add(r), this._tangents[c].normalize()), this._distances[c] = this._distances[c - 1] + i.length(), o = this._tangents[c], s = this._binormals[c - 1], this._normals[c] = n.Cross(s, o), this._raw || this._normals[c].normalize(), this._binormals[c] = n.Cross(o, this._normals[c]), this._raw || this._binormals[c].normalize() }, t.prototype._getFirstNonNullVector = function (e) { for (var t = 1, i = this._curve[e + t].subtract(this._curve[e]); 0 === i.length() && e + t + 1 < this._curve.length;)t++ , i = this._curve[e + t].subtract(this._curve[e]); return i }, t.prototype._getLastNonNullVector = function (e) { for (var t = 1, i = this._curve[e].subtract(this._curve[e - t]); 0 === i.length() && t + 1 < e;)t++ , i = this._curve[e].subtract(this._curve[e - t]); return i }, t.prototype._normalVector = function (t, i, r) { var o, s, a = i.length(); return 0 === a && (a = 1), null == r ? (s = e.Scalar.WithinEpsilon(Math.abs(i.y) / a, 1, e.Epsilon) ? e.Scalar.WithinEpsilon(Math.abs(i.x) / a, 1, e.Epsilon) ? e.Scalar.WithinEpsilon(Math.abs(i.z) / a, 1, e.Epsilon) ? n.Zero() : new n(0, 0, 1) : new n(1, 0, 0) : new n(0, -1, 0), o = n.Cross(i, s)) : (o = n.Cross(i, r), n.CrossToRef(o, i, o)), o.normalize(), o }, t }(); e.Path3D = b; var T = function () { function e(e) { this._length = 0, this._points = e, this._length = this._computeLength(e) } return e.CreateQuadraticBezier = function (t, i, r, o) { o = 2 < o ? o : 3; for (var s = new Array, a = function (e, t, i, r) { return (1 - e) * (1 - e) * t + 2 * e * (1 - e) * i + e * e * r }, l = 0; l <= o; l++)s.push(new n(a(l / o, t.x, i.x, r.x), a(l / o, t.y, i.y, r.y), a(l / o, t.z, i.z, r.z))); return new e(s) }, e.CreateCubicBezier = function (t, i, r, o, s) { s = 3 < s ? s : 4; for (var a = new Array, l = function (e, t, i, r, n) { return (1 - e) * (1 - e) * (1 - e) * t + 3 * e * (1 - e) * (1 - e) * i + 3 * e * e * (1 - e) * r + e * e * e * n }, c = 0; c <= s; c++)a.push(new n(l(c / s, t.x, i.x, r.x, o.x), l(c / s, t.y, i.y, r.y, o.y), l(c / s, t.z, i.z, r.z, o.z))); return new e(a) }, e.CreateHermiteSpline = function (t, i, r, o, s) { for (var a = new Array, l = 1 / s, c = 0; c <= s; c++)a.push(n.Hermite(t, i, r, o, c * l)); return new e(a) }, e.CreateCatmullRomSpline = function (t, i, r) { var o = new Array, s = 1 / i, a = 0; if (r) { for (var l = t.length, c = 0; c < l; c++)for (var h = a = 0; h < i; h++)o.push(n.CatmullRom(t[c % l], t[(c + 1) % l], t[(c + 2) % l], t[(c + 3) % l], a)), a += s; o.push(o[0]) } else { var u = new Array; for (u.push(t[0].clone()), Array.prototype.push.apply(u, t), u.push(t[t.length - 1].clone()), c = 0; c < u.length - 3; c++)for (h = a = 0; h < i; h++)o.push(n.CatmullRom(u[c], u[c + 1], u[c + 2], u[c + 3], a)), a += s; c-- , o.push(n.CatmullRom(u[c], u[c + 1], u[c + 2], u[c + 3], a)) } return new e(o) }, e.prototype.getPoints = function () { return this._points }, e.prototype.length = function () { return this._length }, e.prototype.continue = function (t) { for (var i = this._points[this._points.length - 1], r = this._points.slice(), n = t.getPoints(), o = 1; o < n.length; o++)r.push(n[o].subtract(n[0]).add(i)); return new e(r) }, e.prototype._computeLength = function (e) { for (var t = 0, i = 1; i < e.length; i++)t += e[i].subtract(e[i - 1]).length(); return t }, e }(); e.Curve3 = T; var E = function () { function e(e, t) { void 0 === e && (e = n.Zero()), void 0 === t && (t = n.Up()), this.position = e, this.normal = t } return e.prototype.clone = function () { return new e(this.position.clone(), this.normal.clone()) }, e }(); e.PositionNormalVertex = E; var x = function () { function e(e, t, i) { void 0 === e && (e = n.Zero()), void 0 === t && (t = n.Up()), void 0 === i && (i = r.Zero()), this.position = e, this.normal = t, this.uv = i } return e.prototype.clone = function () { return new e(this.position.clone(), this.normal.clone(), this.uv.clone()) }, e }(); e.PositionNormalTextureVertex = x; var P = function () { function e() { } return e.Color3 = [t.Black(), t.Black(), t.Black()], e.Color4 = [new i(0, 0, 0, 0), new i(0, 0, 0, 0)], e.Vector2 = [r.Zero(), r.Zero(), r.Zero()], e.Vector3 = [n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero()], e.Vector4 = [o.Zero(), o.Zero(), o.Zero()], e.Quaternion = [a.Zero(), a.Zero()], e.Matrix = [l.Zero(), l.Zero(), l.Zero(), l.Zero(), l.Zero(), l.Zero(), l.Zero(), l.Zero()], e }(); e.Tmp = P; var A = function () { function e() { } return e.Vector3 = [n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero()], e.Matrix = [l.Zero(), l.Zero()], e.Quaternion = [a.Zero(), a.Zero(), a.Zero()], e }() }($a || ($a = {})), o = $a || ($a = {}), s = function () { function e() { } return e.WithinEpsilon = function (e, t, i) { void 0 === i && (i = 1.401298e-45); var r = e - t; return -i <= r && r <= i }, e.ToHex = function (e) { var t = e.toString(16); return e <= 15 ? ("0" + t).toUpperCase() : t.toUpperCase() }, e.Sign = function (e) { return 0 == (e = +e) || isNaN(e) ? e : 0 < e ? 1 : -1 }, e.Clamp = function (e, t, i) { return void 0 === t && (t = 0), void 0 === i && (i = 1), Math.min(i, Math.max(t, e)) }, e.Log2 = function (e) { return Math.log(e) * Math.LOG2E }, e.Repeat = function (e, t) { return e - Math.floor(e / t) * t }, e.Normalize = function (e, t, i) { return (e - t) / (i - t) }, e.Denormalize = function (e, t, i) { return e * (i - t) + t }, e.DeltaAngle = function (t, i) { var r = e.Repeat(i - t, 360); return 180 < r && (r -= 360), r }, e.PingPong = function (t, i) { var r = e.Repeat(t, 2 * i); return i - Math.abs(r - i) }, e.SmoothStep = function (t, i, r) { var n = e.Clamp(r); return i * (n = -2 * n * n * n + 3 * n * n) + t * (1 - n) }, e.MoveTowards = function (t, i, r) { return Math.abs(i - t) <= r ? i : t + e.Sign(i - t) * r }, e.MoveTowardsAngle = function (t, i, r) { var n = e.DeltaAngle(t, i); return -r < n && n < r ? i : e.MoveTowards(t, i = t + n, r) }, e.Lerp = function (e, t, i) { return e + (t - e) * i }, e.LerpAngle = function (t, i, r) { var n = e.Repeat(i - t, 360); return 180 < n && (n -= 360), t + n * e.Clamp(r) }, e.InverseLerp = function (t, i, r) { return t != i ? e.Clamp((r - t) / (i - t)) : 0 }, e.Hermite = function (e, t, i, r, n) { var o = n * n, s = n * o; return e * (2 * s - 3 * o + 1) + i * (-2 * s + 3 * o) + t * (s - 2 * o + n) + r * (s - o) }, e.RandomRange = function (e, t) { return e === t ? e : Math.random() * (t - e) + e }, e.RangeToPercent = function (e, t, i) { return (e - t) / (i - t) }, e.PercentToRange = function (e, t, i) { return (i - t) * e + t }, e.NormalizeRadians = function (t) { return t - e.TwoPi * Math.floor((t + Math.PI) / e.TwoPi) }, e.TwoPi = 2 * Math.PI, e }(), o.Scalar = s, function (e) { var t = {}, i = {}, r = function (t, i, r) { var o = t(); e.Tags && e.Tags.AddTagsTo(o, i.tags); var s = n(o); for (var a in s) { var l = s[a], c = i[a], h = l.type; if (null != c) switch (h) { case 0: case 6: case 11: o[a] = c; break; case 1: o[a] = r || c.isRenderTarget ? c : c.clone(); break; case 2: case 3: case 4: case 5: case 7: case 10: o[a] = r ? c : c.clone() } } return o }; function n(e) { var r = e.getClassName(); if (i[r]) return i[r]; i[r] = {}; for (var n = i[r], o = e, s = r; s;) { var a = t[s]; for (var l in a) n[l] = a[l]; var c = void 0, h = !1; do { if (!(c = Object.getPrototypeOf(o)).getClassName) { h = !0; break } if (c.getClassName() !== s) break; o = c } while (c); if (h) break; s = c.getClassName(), o = c } return n } function o(e, i) { return function (r, n) { var o, s = (o = r.getClassName(), t[o] || (t[o] = {}), t[o]); s[n] || (s[n] = { type: e, sourceName: i }) } } e.expandToProperty = function (e, t) { return void 0 === t && (t = null), i = e, void 0 === (r = t) && (r = null), function (e, t) { var n = r || "_" + t; Object.defineProperty(e, t, { get: function () { return this[n] }, set: function (t) { this[n] !== t && (this[n] = t, e[i].apply(this)) }, enumerable: !0, configurable: !0 }) }; var i, r }, e.serialize = function (e) { return o(0, e) }, e.serializeAsTexture = function (e) { return o(1, e) }, e.serializeAsColor3 = function (e) { return o(2, e) }, e.serializeAsFresnelParameters = function (e) { return o(3, e) }, e.serializeAsVector2 = function (e) { return o(4, e) }, e.serializeAsVector3 = function (e) { return o(5, e) }, e.serializeAsMeshReference = function (e) { return o(6, e) }, e.serializeAsColorCurves = function (e) { return o(7, e) }, e.serializeAsColor4 = function (e) { return o(8, e) }, e.serializeAsImageProcessingConfiguration = function (e) { return o(9, e) }, e.serializeAsQuaternion = function (e) { return o(10, e) }, e.serializeAsCameraReference = function (e) { return o(11, e) }; var s = function () { function t() { } return t.Serialize = function (t, i) { i || (i = {}), e.Tags && (i.tags = e.Tags.GetTags(t)); var r = n(t); for (var o in r) { var s = r[o], a = s.sourceName || o, l = s.type, c = t[o]; if (null != c) switch (l) { case 0: i[a] = c; break; case 1: i[a] = c.serialize(); break; case 2: i[a] = c.asArray(); break; case 3: i[a] = c.serialize(); break; case 4: case 5: i[a] = c.asArray(); break; case 6: i[a] = c.id; break; case 7: i[a] = c.serialize(); break; case 8: i[a] = c.asArray(); break; case 9: i[a] = c.serialize(); break; case 10: i[a] = c.asArray(); break; case 11: i[a] = c.id } } return i }, t.Parse = function (t, i, r, o) { void 0 === o && (o = null); var s = t(); o || (o = ""), e.Tags && e.Tags.AddTagsTo(s, i.tags); var a = n(s); for (var l in a) { var c = a[l], h = i[c.sourceName || l], u = c.type; if (null != h) { var d = s; switch (u) { case 0: d[l] = h; break; case 1: r && (d[l] = e.Texture.Parse(h, r, o)); break; case 2: d[l] = e.Color3.FromArray(h); break; case 3: d[l] = e.FresnelParameters.Parse(h); break; case 4: d[l] = e.Vector2.FromArray(h); break; case 5: d[l] = e.Vector3.FromArray(h); break; case 6: r && (d[l] = r.getLastMeshByID(h)); break; case 7: d[l] = e.ColorCurves.Parse(h); break; case 8: d[l] = e.Color4.FromArray(h); break; case 9: d[l] = e.ImageProcessingConfiguration.Parse(h); break; case 10: d[l] = e.Quaternion.FromArray(h); break; case 11: r && (d[l] = r.getCameraByID(h)) } } } return s }, t.Clone = function (e, t) { return r(e, t, !1) }, t.Instanciate = function (e, t) { return r(e, t, !0) }, t }(); e.SerializationHelper = s }($a || ($a = {})), a = $a || ($a = {}), l = function () { function e() { var e = this; this.promise = new Promise(function (t, i) { e._resolve = t, e._reject = i }) } return Object.defineProperty(e.prototype, "resolve", { get: function () { return this._resolve }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "reject", { get: function () { return this._reject }, enumerable: !0, configurable: !0 }), e }(), a.Deferred = l, function (e) { var t = function () { function e(e, t, i, r) { void 0 === t && (t = !1), this.initalize(e, t, i, r) } return e.prototype.initalize = function (e, t, i, r) { return void 0 === t && (t = !1), this.mask = e, this.skipNextObservers = t, this.target = i, this.currentTarget = r, this }, e }(); e.EventState = t; var i = function (e, t, i) { void 0 === i && (i = null), this.callback = e, this.mask = t, this.scope = i, this._willBeUnregistered = !1, this.unregisterOnNextCall = !1 }; e.Observer = i; var r = function () { function e() { } return e.prototype.dispose = function () { if (this._observers && this._observables) for (var e = 0; e < this._observers.length; e++)this._observables[e].remove(this._observers[e]); this._observers = null, this._observables = null }, e.Watch = function (t, i, r, n) { void 0 === r && (r = -1), void 0 === n && (n = null); var o = new e; o._observers = new Array; for (var s = 0, a = o._observables = t; s < a.length; s++) { var l = a[s].add(i, r, !1, n); l && o._observers.push(l) } return o }, e }(); e.MultiObserver = r; var n = function () { function r(e) { this._observers = new Array, this._eventState = new t(0), e && (this._onObserverAdded = e) } return r.prototype.add = function (e, t, r, n, o) { if (void 0 === t && (t = -1), void 0 === r && (r = !1), void 0 === n && (n = null), void 0 === o && (o = !1), !e) return null; var s = new i(e, t, n); return s.unregisterOnNextCall = o, r ? this._observers.unshift(s) : this._observers.push(s), this._onObserverAdded && this._onObserverAdded(s), s }, r.prototype.addOnce = function (e) { return this.add(e, void 0, void 0, void 0, !0) }, r.prototype.remove = function (e) { return !!e && -1 !== this._observers.indexOf(e) && (this._deferUnregister(e), !0) }, r.prototype.removeCallback = function (e, t) { for (var i = 0; i < this._observers.length; i++)if (this._observers[i].callback === e && (!t || t === this._observers[i].scope)) return this._deferUnregister(this._observers[i]), !0; return !1 }, r.prototype._deferUnregister = function (t) { var i = this; t.unregisterOnNextCall = !1, t._willBeUnregistered = !0, e.Tools.SetImmediate(function () { i._remove(t) }) }, r.prototype._remove = function (e) { if (!e) return !1; var t = this._observers.indexOf(e); return -1 !== t && (this._observers.splice(t, 1), !0) }, r.prototype.notifyObservers = function (e, t, i, r) { if (void 0 === t && (t = -1), !this._observers.length) return !0; var n = this._eventState; n.mask = t, n.target = i, n.currentTarget = r, n.skipNextObservers = !1, n.lastReturnValue = e; for (var o = 0, s = this._observers; o < s.length; o++) { var a = s[o]; if (!a._willBeUnregistered && (a.mask & t && (a.scope ? n.lastReturnValue = a.callback.apply(a.scope, [e, n]) : n.lastReturnValue = a.callback(e, n), a.unregisterOnNextCall && this._deferUnregister(a)), n.skipNextObservers)) return !1 } return !0 }, r.prototype.notifyObserversWithPromise = function (e, t, i, r) { var n = this; void 0 === t && (t = -1); var o = Promise.resolve(e); if (!this._observers.length) return o; var s = this._eventState; return s.mask = t, s.target = i, s.currentTarget = r, s.skipNextObservers = !1, this._observers.forEach(function (i) { s.skipNextObservers || i._willBeUnregistered || i.mask & t && (o = i.scope ? o.then(function (t) { return s.lastReturnValue = t, i.callback.apply(i.scope, [e, s]) }) : o.then(function (t) { return s.lastReturnValue = t, i.callback(e, s) }), i.unregisterOnNextCall && n._deferUnregister(i)) }), o.then(function () { return e }) }, r.prototype.notifyObserver = function (e, t, i) { void 0 === i && (i = -1); var r = this._eventState; r.mask = i, r.skipNextObservers = !1, e.callback(t, r) }, r.prototype.hasObservers = function () { return 0 < this._observers.length }, r.prototype.clear = function () { this._observers = new Array, this._onObserverAdded = null }, r.prototype.clone = function () { var e = new r; return e._observers = this._observers.slice(0), e }, r.prototype.hasSpecificMask = function (e) { void 0 === e && (e = -1); for (var t = 0, i = this._observers; t < i.length; t++) { var r = i[t]; if (r.mask & e || r.mask === e) return !0 } return !1 }, r }(); e.Observable = n }($a || ($a = {})), c = $a || ($a = {}), h = function () { function e(t) { this.length = 0, this.data = new Array(t), this._id = e._GlobalId++ } return e.prototype.push = function (e) { this.data[this.length++] = e, this.length > this.data.length && (this.data.length *= 2) }, e.prototype.forEach = function (e) { for (var t = 0; t < this.length; t++)e(this.data[t]) }, e.prototype.sort = function (e) { this.data.sort(e) }, e.prototype.reset = function () { this.length = 0 }, e.prototype.dispose = function () { this.reset(), this.data && (this.data.length = 0, this.data = []) }, e.prototype.concat = function (e) { if (0 !== e.length) { this.length + e.length > this.data.length && (this.data.length = 2 * (this.length + e.length)); for (var t = 0; t < e.length; t++)this.data[this.length++] = (e.data || e)[t] } }, e.prototype.indexOf = function (e) { var t = this.data.indexOf(e); return t >= this.length ? -1 : t }, e.prototype.contains = function (e) { return -1 !== this.indexOf(e) }, e._GlobalId = 0, e }(), u = function (e) { function t() { var t = null !== e && e.apply(this, arguments) || this; return t._duplicateId = 0, t } return T(t, e), t.prototype.push = function (t) { e.prototype.push.call(this, t), t.__smartArrayFlags || (t.__smartArrayFlags = {}), t.__smartArrayFlags[this._id] = this._duplicateId }, t.prototype.pushNoDuplicate = function (e) { return !(e.__smartArrayFlags && e.__smartArrayFlags[this._id] === this._duplicateId || (this.push(e), 0)) }, t.prototype.reset = function () { e.prototype.reset.call(this), this._duplicateId++ }, t.prototype.concatWithNoDuplicate = function (e) { if (0 !== e.length) { this.length + e.length > this.data.length && (this.data.length = 2 * (this.length + e.length)); for (var t = 0; t < e.length; t++) { var i = (e.data || e)[t]; this.pushNoDuplicate(i) } } }, t }(c.SmartArray = h), c.SmartArrayNoDuplicate = u, function (e) { var t = function () { function t() { } return t.prototype.getColorToRef = function (t) { this.color2 ? e.Color4.LerpToRef(this.color1, this.color2, Math.random(), t) : t.copyFrom(this.color1) }, t }(); e.ColorGradient = t; e.Color3Gradient = function () { }; var i = function () { function t() { } return t.prototype.getFactor = function () { return void 0 === this.factor2 ? this.factor1 : e.Scalar.Lerp(this.factor1, this.factor2, Math.random()) }, t }(); e.FactorGradient = i; var r = function (e) { function t(i, r) { var n = e.call(this, i) || this; return n.request = r, n.name = "LoadFileError", t._setPrototypeOf(n, t.prototype), n } return T(t, e), t._setPrototypeOf = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, t }(Error); e.LoadFileError = r; var n, o = function () { function e() { } return e.ExponentialBackoff = function (e, t) { return void 0 === e && (e = 3), void 0 === t && (t = 500), function (i, r, n) { return 0 !== r.status || e <= n || -1 !== i.indexOf("file:") ? -1 : Math.pow(2, n) * t } }, e }(); e.RetryStrategy = o; var s = function (t, i) { return t ? t instanceof e.Mesh ? null : t instanceof e.SubMesh ? t.clone(i) : t.clone ? t.clone() : null : null }, a = function () { function t() { } return t.FetchToRef = function (e, t, i, r, n, o) { var s = 4 * ((Math.abs(e) * i % i | 0) + (Math.abs(t) * r % r | 0) * i); o.r = n[s] / 255, o.g = n[s + 1] / 255, o.b = n[s + 2] / 255, o.a = n[s + 3] / 255 }, t.Mix = function (e, t, i) { return e * (1 - i) + t * i }, t.Instantiate = function (e) { if (t.RegisteredExternalClasses && t.RegisteredExternalClasses[e]) return t.RegisteredExternalClasses[e]; for (var i = e.split("."), r = window || this, n = 0, o = i.length; n < o; n++)r = r[i[n]]; return "function" != typeof r ? null : r }, t.Slice = function (e, t, i) { return e.slice ? e.slice(t, i) : Array.prototype.slice.call(e, t, i) }, t.SetImmediate = function (e) { t.IsWindowObjectExist() && window.setImmediate ? window.setImmediate(e) : setTimeout(e, 1) }, t.IsExponentOfTwo = function (e) { for (var t = 1; (t *= 2) < e;); return t === e }, t.FloatRound = function (e) { return Math.fround ? Math.fround(e) : t._tmpFloatArray[0] = e }, t.CeilingPOT = function (e) { return e-- , e |= e >> 1, e |= e >> 2, e |= e >> 4, e |= e >> 8, e |= e >> 16, ++e }, t.FloorPOT = function (e) { return e |= e >> 1, e |= e >> 2, e |= e >> 4, e |= e >> 8, (e |= e >> 16) - (e >> 1) }, t.NearestPOT = function (e) { var i = t.CeilingPOT(e), r = t.FloorPOT(e); return e - r < i - e ? r : i }, t.GetExponentOfTwo = function (i, r, n) { var o; switch (void 0 === n && (n = e.Engine.SCALEMODE_NEAREST), n) { case e.Engine.SCALEMODE_FLOOR: o = t.FloorPOT(i); break; case e.Engine.SCALEMODE_NEAREST: o = t.NearestPOT(i); break; case e.Engine.SCALEMODE_CEILING: default: o = t.CeilingPOT(i) }return Math.min(o, r) }, t.GetFilename = function (e) { var t = e.lastIndexOf("/"); return t < 0 ? e : e.substring(t + 1) }, t.GetFolderPath = function (e, t) { void 0 === t && (t = !1); var i = e.lastIndexOf("/"); return i < 0 ? t ? e : "" : e.substring(0, i + 1) }, t.GetDOMTextContent = function (e) { for (var t = "", i = e.firstChild; i;)3 === i.nodeType && (t += i.textContent), i = i.nextSibling; return t }, t.ToDegrees = function (e) { return 180 * e / Math.PI }, t.ToRadians = function (e) { return e * Math.PI / 180 }, t.EncodeArrayBufferTobase64 = function (e) { for (var t, i, r, n, o, s, a, l = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", c = "", h = 0, u = new Uint8Array(e); h < u.length;)n = (t = u[h++]) >> 2, o = (3 & t) << 4 | (i = h < u.length ? u[h++] : Number.NaN) >> 4, s = (15 & i) << 2 | (r = h < u.length ? u[h++] : Number.NaN) >> 6, a = 63 & r, isNaN(i) ? s = a = 64 : isNaN(r) && (a = 64), c += l.charAt(n) + l.charAt(o) + l.charAt(s) + l.charAt(a); return "data:image/png;base64," + c }, t.ExtractMinAndMaxIndexed = function (t, i, r, n, o) { void 0 === o && (o = null); for (var s = new e.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), a = new e.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), l = r; l < r + n; l++) { var c = 3 * i[l], h = t[c], u = t[c + 1], d = t[c + 2]; s.minimizeInPlaceFromFloats(h, u, d), a.maximizeInPlaceFromFloats(h, u, d) } return o && (s.x -= s.x * o.x + o.y, s.y -= s.y * o.x + o.y, s.z -= s.z * o.x + o.y, a.x += a.x * o.x + o.y, a.y += a.y * o.x + o.y, a.z += a.z * o.x + o.y), { minimum: s, maximum: a } }, t.ExtractMinAndMax = function (t, i, r, n, o) { void 0 === n && (n = null); var s = new e.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), a = new e.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE); o || (o = 3); for (var l = i, c = i * o; l < i + r; l++ , c += o) { var h = t[c], u = t[c + 1], d = t[c + 2]; s.minimizeInPlaceFromFloats(h, u, d), a.maximizeInPlaceFromFloats(h, u, d) } return n && (s.x -= s.x * n.x + n.y, s.y -= s.y * n.x + n.y, s.z -= s.z * n.x + n.y, a.x += a.x * n.x + n.y, a.y += a.y * n.x + n.y, a.z += a.z * n.x + n.y), { minimum: s, maximum: a } }, t.MakeArray = function (e, t) { return !0 === t || void 0 !== e && null != e ? Array.isArray(e) ? e : [e] : null }, t.GetPointerPrefix = function () { var e = "pointer"; return !t.IsWindowObjectExist() || window.PointerEvent || navigator.pointerEnabled || (e = "mouse"), e }, t.QueueNewFrame = function (e, i) { return t.IsWindowObjectExist() ? (i || (i = window), i.requestAnimationFrame ? i.requestAnimationFrame(e) : i.msRequestAnimationFrame ? i.msRequestAnimationFrame(e) : i.webkitRequestAnimationFrame ? i.webkitRequestAnimationFrame(e) : i.mozRequestAnimationFrame ? i.mozRequestAnimationFrame(e) : i.oRequestAnimationFrame ? i.oRequestAnimationFrame(e) : window.setTimeout(e, 16)) : setTimeout(e, 16) }, t.RequestFullscreen = function (e) { var t = e.requestFullscreen || e.msRequestFullscreen || e.webkitRequestFullscreen || e.mozRequestFullScreen; t && t.call(e) }, t.ExitFullscreen = function () { document.exitFullscreen ? document.exitFullscreen() : document.mozCancelFullScreen ? document.mozCancelFullScreen() : document.webkitCancelFullScreen ? document.webkitCancelFullScreen() : document.msCancelFullScreen && document.msCancelFullScreen() }, t.SetCorsBehavior = function (e, i) { if ((!e || 0 !== e.indexOf("data:")) && t.CorsBehavior) if ("string" == typeof t.CorsBehavior || t.CorsBehavior instanceof String) i.crossOrigin = t.CorsBehavior; else { var r = t.CorsBehavior(e); r && (i.crossOrigin = r) } }, t.CleanUrl = function (e) { return e.replace(/#/gm, "%23") }, t.LoadImage = function (i, r, n, o) { var s, a = !1; i instanceof ArrayBuffer ? (s = URL.createObjectURL(new Blob([i])), a = !0) : i instanceof Blob ? (s = URL.createObjectURL(i), a = !0) : (s = t.CleanUrl(i), s = t.PreprocessUrl(i)); var l = new Image; t.SetCorsBehavior(s, l); var c = function () { a && l.src && URL.revokeObjectURL(l.src), l.removeEventListener("load", c), l.removeEventListener("error", h), r(l) }, h = function (e) { a && l.src && URL.revokeObjectURL(l.src), l.removeEventListener("load", c), l.removeEventListener("error", h), t.Error("Error while trying to load image: " + i), n && n("Error while trying to load image: " + i, e) }; l.addEventListener("load", c), l.addEventListener("error", h); var u = function () { l.src = s }; if ("data:" !== s.substr(0, 5) && o && o.enableTexturesOffline && e.Database.IsUASupportingBlobStorage) o.openAsync(function () { o && o.loadImageFromDB(s, l) }, u); else { if (-1 !== s.indexOf("file:")) { var d = decodeURIComponent(s.substring(5).toLowerCase()); if (e.FilesInput.FilesToLoad[d]) { try { var f; try { f = URL.createObjectURL(e.FilesInput.FilesToLoad[d]) } catch (r) { f = URL.createObjectURL(e.FilesInput.FilesToLoad[d]) } l.src = f, a = !0 } catch (r) { l.src = "" } return l } } u() } return l }, t.LoadFile = function (i, n, o, s, a, l) { if (i = t.CleanUrl(i), -1 !== (i = t.PreprocessUrl(i)).indexOf("file:")) { var c = decodeURIComponent(i.substring(5).toLowerCase()); if (e.FilesInput.FilesToLoad[c]) return t.ReadFile(e.FilesInput.FilesToLoad[c], n, o, a) } var h = t.BaseUrl + i, u = !1, d = { onCompleteObservable: new e.Observable, abort: function () { return u = !0 } }, f = function () { var e = new XMLHttpRequest, i = null; d.abort = function () { u = !0, e.readyState !== (XMLHttpRequest.DONE || 4) && e.abort(), null !== i && (clearTimeout(i), i = null) }; var s = function (c) { e.open("GET", h, !0), a && (e.responseType = "arraybuffer"), o && e.addEventListener("progress", o); var f = function () { e.removeEventListener("loadend", f), d.onCompleteObservable.notifyObservers(d), d.onCompleteObservable.clear() }; e.addEventListener("loadend", f); var p = function () { if (!u && e.readyState === (XMLHttpRequest.DONE || 4)) { if (e.removeEventListener("readystatechange", p), 200 <= e.status && e.status < 300 || 0 === e.status && (!t.IsWindowObjectExist() || t.IsFileURL())) return void n(a ? e.response : e.responseText, e.responseURL); var o = t.DefaultRetryStrategy; if (o) { var d = o(h, e, c); if (-1 !== d) return e.removeEventListener("loadend", f), e = new XMLHttpRequest, void (i = setTimeout(function () { return s(c + 1) }, d)) } var _ = new r("Error status: " + e.status + " " + e.statusText + " - Unable to load " + h, e); if (!l) throw _; l(e, _) } }; e.addEventListener("readystatechange", p), e.send() }; s(0) }; if (s && s.enableSceneOffline) { var p = function (e) { e && 400 < e.status ? l && l(e) : u || f() }; s.openAsync(function () { u || s && s.loadFileFromDB(i, function (e) { u || n(e), d.onCompleteObservable.notifyObservers(d) }, o ? function (e) { u || o(e) } : void 0, p, a) }, p) } else f(); return d }, t.LoadScript = function (e, i, r) { if (t.IsWindowObjectExist()) { var n = document.getElementsByTagName("head")[0], o = document.createElement("script"); o.type = "text/javascript", o.src = e, o.onload = function () { i && i() }, o.onerror = function (t) { r && r("Unable to load script '" + e + "'", t) }, n.appendChild(o) } }, t.ReadFileAsDataURL = function (t, i, r) { var n = new FileReader, o = { onCompleteObservable: new e.Observable, abort: function () { return n.abort() } }; return n.onloadend = function (e) { o.onCompleteObservable.notifyObservers(o) }, n.onload = function (e) { i(e.target.result) }, n.onprogress = r, n.readAsDataURL(t), o }, t.ReadFile = function (i, r, n, o) { var s = new FileReader, a = { onCompleteObservable: new e.Observable, abort: function () { return s.abort() } }; return s.onloadend = function (e) { return a.onCompleteObservable.notifyObservers(a) }, s.onerror = function (e) { t.Log("Error while reading file: " + i.name), r(JSON.stringify({ autoClear: !0, clearColor: [1, 0, 0], ambientColor: [0, 0, 0], gravity: [0, -9.807, 0], meshes: [], cameras: [], lights: [] })) }, s.onload = function (e) { r(e.target.result) }, n && (s.onprogress = n), o ? s.readAsArrayBuffer(i) : s.readAsText(i), a }, t.FileAsURL = function (e) { var t = new Blob([e]); return (window.URL || window.webkitURL).createObjectURL(t) }, t.Format = function (e, t) { return void 0 === t && (t = 2), e.toFixed(t) }, t.CheckExtends = function (e, t, i) { e.x < t.x && (t.x = e.x), e.y < t.y && (t.y = e.y), e.z < t.z && (t.z = e.z), e.x > i.x && (i.x = e.x), e.y > i.y && (i.y = e.y), e.z > i.z && (i.z = e.z) }, t.DeepCopy = function (e, t, i, r) { for (var n in e) if (("_" !== n[0] || r && -1 !== r.indexOf(n)) && (!i || -1 === i.indexOf(n))) { var o = e[n], a = typeof o; if ("function" !== a) try { if ("object" === a) if (o instanceof Array) { if (t[n] = [], 0 < o.length) if ("object" == typeof o[0]) for (var l = 0; l < o.length; l++) { var c = s(o[l], t); -1 === t[n].indexOf(c) && t[n].push(c) } else t[n] = o.slice(0) } else t[n] = s(o, t); else t[n] = o } catch (e) { } } }, t.IsEmpty = function (e) { for (var t in e) if (e.hasOwnProperty(t)) return !1; return !0 }, t.RegisterTopRootEvents = function (e) { for (var t = 0; t < e.length; t++) { var i = e[t]; window.addEventListener(i.name, i.handler, !1); try { window.parent && window.parent.addEventListener(i.name, i.handler, !1) } catch (e) { } } }, t.UnregisterTopRootEvents = function (e) { for (var t = 0; t < e.length; t++) { var i = e[t]; window.removeEventListener(i.name, i.handler); try { window.parent && window.parent.removeEventListener(i.name, i.handler) } catch (e) { } } }, t.DumpFramebuffer = function (e, i, r, o, s, a) { void 0 === s && (s = "image/png"); for (var l = 4 * e, c = i / 2, h = r.readPixels(0, 0, e, i), u = 0; u < c; u++)for (var d = 0; d < l; d++) { var f = d + u * l, p = d + (i - u - 1) * l, _ = h[f]; h[f] = h[p], h[p] = _ } n || (n = document.createElement("canvas")), n.width = e, n.height = i; var m = n.getContext("2d"); if (m) { var g = m.createImageData(e, i); g.data.set(h), m.putImageData(g, 0, 0), t.EncodeScreenshotCanvasData(o, s, a) } }, t.ToBlob = function (e, t, i) { void 0 === i && (i = "image/png"), e.toBlob || (e.toBlob = function (e, t, i) { var r = this; setTimeout(function () { for (var n = atob(r.toDataURL(t, i).split(",")[1]), o = n.length, s = new Uint8Array(o), a = 0; a < o; a++)s[a] = n.charCodeAt(a); e(new Blob([s])) }) }), e.toBlob(function (e) { t(e) }, i) }, t.EncodeScreenshotCanvasData = function (e, i, r) { void 0 === i && (i = "image/png"), e ? e(n.toDataURL(i)) : this.ToBlob(n, function (e) { if ("download" in document.createElement("a")) { if (!r) { var i = new Date, n = (i.getFullYear() + "-" + (i.getMonth() + 1)).slice(2) + "-" + i.getDate() + "_" + i.getHours() + "-" + ("0" + i.getMinutes()).slice(-2); r = "screenshot_" + n + ".png" } t.Download(e, r) } else { var o = URL.createObjectURL(e), s = window.open(""); if (!s) return; var a = s.document.createElement("img"); a.onload = function () { URL.revokeObjectURL(o) }, a.src = o, s.document.body.appendChild(a) } }, i) }, t.Download = function (e, t) { if (navigator && navigator.msSaveBlob) navigator.msSaveBlob(e, t); else { var i = window.URL.createObjectURL(e), r = document.createElement("a"); document.body.appendChild(r), r.style.display = "none", r.href = i, r.download = t, r.addEventListener("click", function () { r.parentElement && r.parentElement.removeChild(r) }), r.click(), window.URL.revokeObjectURL(i) } }, t.CreateScreenshot = function (e, i, r, o, s) { var a, l; if (void 0 === s && (s = "image/png"), r.precision) a = Math.round(e.getRenderWidth() * r.precision), l = Math.round(a / e.getAspectRatio(i)); else if (r.width && r.height) a = r.width, l = r.height; else if (r.width && !r.height) a = r.width, l = Math.round(a / e.getAspectRatio(i)); else if (r.height && !r.width) l = r.height, a = Math.round(l * e.getAspectRatio(i)); else { if (isNaN(r)) return void t.Error("Invalid 'size' parameter !"); a = l = r } n || (n = document.createElement("canvas")), n.width = a, n.height = l; var c = n.getContext("2d"), h = e.getRenderWidth() / e.getRenderHeight(), u = a, d = u / h; l < d && (u = (d = l) * h); var f = Math.max(0, a - u) / 2, p = Math.max(0, l - d) / 2, _ = e.getRenderingCanvas(); c && _ && c.drawImage(_, f, p, u, d), t.EncodeScreenshotCanvasData(o, s) }, t.CreateScreenshotUsingRenderTarget = function (i, r, n, o, s, a, l, c) { var h, u; if (void 0 === s && (s = "image/png"), void 0 === a && (a = 1), void 0 === l && (l = !1), n.precision) h = Math.round(i.getRenderWidth() * n.precision), u = Math.round(h / i.getAspectRatio(r)), n = { width: h, height: u }; else if (n.width && n.height) h = n.width, u = n.height; else if (n.width && !n.height) h = n.width, u = Math.round(h / i.getAspectRatio(r)), n = { width: h, height: u }; else if (n.height && !n.width) u = n.height, n = { width: h = Math.round(u * i.getAspectRatio(r)), height: u }; else { if (isNaN(n)) return void t.Error("Invalid 'size' parameter !"); h = u = n } var d = r.getScene(), f = null; d.activeCamera !== r && (f = d.activeCamera, d.activeCamera = r); var p = new e.RenderTargetTexture("screenShot", n, d, !1, !1, e.Engine.TEXTURETYPE_UNSIGNED_INT, !1, e.Texture.NEAREST_SAMPLINGMODE); p.renderList = null, p.samples = a, l && p.addPostProcess(new e.FxaaPostProcess("antialiasing", 1, d.activeCamera)), p.onAfterRenderObservable.add(function () { t.DumpFramebuffer(h, u, i, o, s, c) }), d.incrementRenderId(), d.resetCachedMaterial(), p.render(!0), p.dispose(), f && (d.activeCamera = f), r.getProjectionMatrix(!0) }, t.ValidateXHRData = function (t, i) { void 0 === i && (i = 7); try { if (1 & i) { if (t.responseText && 0 < t.responseText.length) return !0; if (1 === i) return !1 } if (2 & i) { var r = e.TGATools.GetTGAHeader(t.response); if (r.width && r.height && 0 < r.width && 0 < r.height) return !0; if (2 === i) return !1 } if (4 & i) { var n = new Uint8Array(t.response, 0, 3); return 68 === n[0] && 68 === n[1] && 83 === n[2] } } catch (t) { } return !1 }, t.RandomId = function () { return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (e) { var t = 16 * Math.random() | 0; return ("x" === e ? t : 3 & t | 8).toString(16) }) }, t.IsBase64 = function (e) { return !(e.length < 5) && "data:" === e.substr(0, 5) }, t.DecodeBase64 = function (e) { for (var t = atob(e.split(",")[1]), i = t.length, r = new Uint8Array(new ArrayBuffer(i)), n = 0; n < i; n++)r[n] = t.charCodeAt(n); return r.buffer }, t._AddLogEntry = function (e) { t._LogCache = e + t._LogCache, t.OnNewCacheEntry && t.OnNewCacheEntry(e) }, t._FormatMessage = function (e) { var t = function (e) { return e < 10 ? "0" + e : "" + e }, i = new Date; return "[" + t(i.getHours()) + ":" + t(i.getMinutes()) + ":" + t(i.getSeconds()) + "]: " + e }, t._LogDisabled = function (e) { }, t._LogEnabled = function (e) { var i = t._FormatMessage(e); console.log("BJS - " + i), t._AddLogEntry("<div style='color:white'>" + i + "</div><br>") }, t._WarnDisabled = function (e) { }, t._WarnEnabled = function (e) { var i = t._FormatMessage(e); console.warn("BJS - " + i), t._AddLogEntry("<div style='color:orange'>" + i + "</div><br>") }, t._ErrorDisabled = function (e) { }, t._ErrorEnabled = function (e) { t.errorsCount++; var i = t._FormatMessage(e); console.error("BJS - " + i), t._AddLogEntry("<div style='color:red'>" + i + "</div><br>") }, Object.defineProperty(t, "LogCache", { get: function () { return t._LogCache }, enumerable: !0, configurable: !0 }), t.ClearLogCache = function () { t._LogCache = "", t.errorsCount = 0 }, Object.defineProperty(t, "LogLevels", { set: function (e) { t.Log = (e & t.MessageLogLevel) === t.MessageLogLevel ? t._LogEnabled : t._LogDisabled, t.Warn = (e & t.WarningLogLevel) === t.WarningLogLevel ? t._WarnEnabled : t._WarnDisabled, t.Error = (e & t.ErrorLogLevel) === t.ErrorLogLevel ? t._ErrorEnabled : t._ErrorDisabled }, enumerable: !0, configurable: !0 }), t.IsFileURL = function () { return "file:" === location.protocol }, t.IsWindowObjectExist = function () { return "undefined" != typeof window }, Object.defineProperty(t, "PerformanceLogLevel", { set: function (e) { return (e & t.PerformanceUserMarkLogLevel) === t.PerformanceUserMarkLogLevel ? (t.StartPerformanceCounter = t._StartUserMark, void (t.EndPerformanceCounter = t._EndUserMark)) : (e & t.PerformanceConsoleLogLevel) === t.PerformanceConsoleLogLevel ? (t.StartPerformanceCounter = t._StartPerformanceConsole, void (t.EndPerformanceCounter = t._EndPerformanceConsole)) : (t.StartPerformanceCounter = t._StartPerformanceCounterDisabled, void (t.EndPerformanceCounter = t._EndPerformanceCounterDisabled)) }, enumerable: !0, configurable: !0 }), t._StartPerformanceCounterDisabled = function (e, t) { }, t._EndPerformanceCounterDisabled = function (e, t) { }, t._StartUserMark = function (e, i) { if (void 0 === i && (i = !0), !t._performance) { if (!t.IsWindowObjectExist()) return; t._performance = window.performance } i && t._performance.mark && t._performance.mark(e + "-Begin") }, t._EndUserMark = function (e, i) { void 0 === i && (i = !0), i && t._performance.mark && (t._performance.mark(e + "-End"), t._performance.measure(e, e + "-Begin", e + "-End")) }, t._StartPerformanceConsole = function (e, i) { void 0 === i && (i = !0), i && (t._StartUserMark(e, i), console.time && console.time(e)) }, t._EndPerformanceConsole = function (e, i) { void 0 === i && (i = !0), i && (t._EndUserMark(e, i), console.time && console.timeEnd(e)) }, Object.defineProperty(t, "Now", { get: function () { return t.IsWindowObjectExist() && window.performance && window.performance.now ? window.performance.now() : Date.now() }, enumerable: !0, configurable: !0 }), t.GetClassName = function (e, t) { void 0 === t && (t = !1); var i = null; return !t && e.getClassName ? i = e.getClassName() : (e instanceof Object && (i = (t ? e : Object.getPrototypeOf(e)).constructor.__bjsclassName__), i || (i = typeof e)), i }, t.First = function (e, t) { for (var i = 0, r = e; i < r.length; i++) { var n = r[i]; if (t(n)) return n } return null }, t.getFullClassName = function (e, t) { void 0 === t && (t = !1); var i = null, r = null; if (!t && e.getClassName) i = e.getClassName(); else { if (e instanceof Object) { var n = t ? e : Object.getPrototypeOf(e); i = n.constructor.__bjsclassName__, r = n.constructor.__bjsmoduleName__ } i || (i = typeof e) } return i ? (null != r ? r + "." : "") + i : null }, t.DelayAsync = function (e) { return new Promise(function (t) { setTimeout(function () { t() }, e) }) }, t.GetCurrentGradient = function (e, t, i) { for (var r = 0; r < t.length - 1; r++) { var n = t[r], o = t[r + 1]; if (e >= n.gradient && e <= o.gradient) return void i(n, o, (e - n.gradient) / (o.gradient - n.gradient)) } var s = t.length - 1; i(t[s], t[s], 1) }, t.BaseUrl = "", t.DefaultRetryStrategy = o.ExponentialBackoff(), t.CorsBehavior = "anonymous", t.UseFallbackTexture = !0, t.RegisteredExternalClasses = {}, t.fallbackTexture = "data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z", t._tmpFloatArray = new Float32Array(1), t.PreprocessUrl = function (e) { return e }, t.NoneLogLevel = 0, t.MessageLogLevel = 1, t.WarningLogLevel = 2, t.ErrorLogLevel = 4, t.AllLogLevel = 7, t._LogCache = "", t.errorsCount = 0, t.Log = t._LogEnabled, t.Warn = t._WarnEnabled, t.Error = t._ErrorEnabled, t.PerformanceNoneLogLevel = 0, t.PerformanceUserMarkLogLevel = 1, t.PerformanceConsoleLogLevel = 2, t.StartPerformanceCounter = t._StartPerformanceCounterDisabled, t.EndPerformanceCounter = t._EndPerformanceCounterDisabled, t }(); e.Tools = a; var l = function () { function e() { this._startMonitoringTime = 0, this._min = 0, this._max = 0, this._average = 0, this._lastSecAverage = 0, this._current = 0, this._totalValueCount = 0, this._totalAccumulated = 0, this._lastSecAccumulated = 0, this._lastSecTime = 0, this._lastSecValueCount = 0 } return Object.defineProperty(e.prototype, "min", { get: function () { return this._min }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "max", { get: function () { return this._max }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "average", { get: function () { return this._average }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "lastSecAverage", { get: function () { return this._lastSecAverage }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "current", { get: function () { return this._current }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "total", { get: function () { return this._totalAccumulated }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "count", { get: function () { return this._totalValueCount }, enumerable: !0, configurable: !0 }), e.prototype.fetchNewFrame = function () { this._totalValueCount++ , this._current = 0, this._lastSecValueCount++ }, e.prototype.addCount = function (t, i) { e.Enabled && (this._current += t, i && this._fetchResult()) }, e.prototype.beginMonitoring = function () { e.Enabled && (this._startMonitoringTime = a.Now) }, e.prototype.endMonitoring = function (t) { if (void 0 === t && (t = !0), e.Enabled) { t && this.fetchNewFrame(); var i = a.Now; this._current = i - this._startMonitoringTime, t && this._fetchResult() } }, e.prototype._fetchResult = function () { this._totalAccumulated += this._current, this._lastSecAccumulated += this._current, this._min = Math.min(this._min, this._current), this._max = Math.max(this._max, this._current), this._average = this._totalAccumulated / this._totalValueCount; var e = a.Now; 1e3 < e - this._lastSecTime && (this._lastSecAverage = this._lastSecAccumulated / this._lastSecValueCount, this._lastSecTime = e, this._lastSecAccumulated = 0, this._lastSecValueCount = 0) }, e.Enabled = !0, e }(); e.PerfCounter = l, e.className = function (e, t) { return function (i) { i.__bjsclassName__ = e, i.__bjsmoduleName__ = null != t ? t : null } }; var c = function () { function e(e, t, i, r) { void 0 === r && (r = 0), this.iterations = e, this.index = r - 1, this._done = !1, this._fn = t, this._successCallback = i } return e.prototype.executeNext = function () { this._done || (this.index + 1 < this.iterations ? (++this.index, this._fn(this)) : this.breakLoop()) }, e.prototype.breakLoop = function () { this._done = !0, this._successCallback() }, e.Run = function (t, i, r, n) { void 0 === n && (n = 0); var o = new e(t, i, r, n); return o.executeNext(), o }, e.SyncAsyncForLoop = function (t, i, r, n, o, s) { return void 0 === s && (s = 0), e.Run(Math.ceil(t / i), function (e) { o && o() ? e.breakLoop() : setTimeout(function () { for (var n = 0; n < i; ++n) { var s = e.index * i + n; if (t <= s) break; if (r(s), o && o()) { e.breakLoop(); break } } e.executeNext() }, s) }, n) }, e }(); e.AsyncLoop = c }($a || ($a = {})), function (e) { var t, i; (i = t || (t = {}))[i.Pending = 0] = "Pending", i[i.Fulfilled = 1] = "Fulfilled", i[i.Rejected = 2] = "Rejected"; var r = function () { this.count = 0, this.target = 0, this.results = [] }, n = function () { function i(e) { var i = this; if (this._state = t.Pending, this._children = new Array, this._rejectWasConsumed = !1, e) try { e(function (e) { i._resolve(e) }, function (e) { i._reject(e) }) } catch (e) { this._reject(e) } } return Object.defineProperty(i.prototype, "_result", { get: function () { return this._resultValue }, set: function (e) { this._resultValue = e, this._parent && void 0 === this._parent._result && (this._parent._result = e) }, enumerable: !0, configurable: !0 }), i.prototype.catch = function (e) { return this.then(void 0, e) }, i.prototype.then = function (r, n) { var o = this, s = new i; return s._onFulfilled = r, s._onRejected = n, this._children.push(s), (s._parent = this)._state !== t.Pending && e.Tools.SetImmediate(function () { if (o._state === t.Fulfilled || o._rejectWasConsumed) { var e = s._resolve(o._result); if (null != e) if (void 0 !== e._state) { var i = e; s._children.push(i), i._parent = s, s = i } else s._result = e } else s._reject(o._reason) }), s }, i.prototype._moveChildren = function (e) { var i, r = this; if ((i = this._children).push.apply(i, e.splice(0, e.length)), this._children.forEach(function (e) { e._parent = r }), this._state === t.Fulfilled) for (var n = 0, o = this._children; n < o.length; n++)o[n]._resolve(this._result); else if (this._state === t.Rejected) for (var s = 0, a = this._children; s < a.length; s++)a[s]._reject(this._reason) }, i.prototype._resolve = function (e) { try { this._state = t.Fulfilled; var i = null; if (this._onFulfilled && (i = this._onFulfilled(e)), null != i) if (void 0 !== i._state) { var r = i; r._parent = this, r._moveChildren(this._children), e = r._result } else e = i; this._result = e; for (var n = 0, o = this._children; n < o.length; n++)o[n]._resolve(e); this._children.length = 0, delete this._onFulfilled, delete this._onRejected } catch (e) { this._reject(e, !0) } }, i.prototype._reject = function (e, i) { if (void 0 === i && (i = !1), this._state = t.Rejected, this._reason = e, this._onRejected && !i) try { this._onRejected(e), this._rejectWasConsumed = !0 } catch (i) { e = i } for (var r = 0, n = this._children; r < n.length; r++) { var o = n[r]; this._rejectWasConsumed ? o._resolve(null) : o._reject(e) } this._children.length = 0, delete this._onFulfilled, delete this._onRejected }, i.resolve = function (e) { var t = new i; return t._resolve(e), t }, i._RegisterForFulfillment = function (e, i, r) { e.then(function (e) { return i.results[r] = e, i.count++ , i.count === i.target && i.rootPromise._resolve(i.results), null }, function (e) { i.rootPromise._state !== t.Rejected && i.rootPromise._reject(e) }) }, i.all = function (e) { var t = new i, n = new r; if (n.target = e.length, n.rootPromise = t, e.length) for (var o = 0; o < e.length; o++)i._RegisterForFulfillment(e[o], n, o); else t._resolve([]); return t }, i.race = function (e) { var t = new i; if (e.length) for (var r = 0, n = e; r < n.length; r++)n[r].then(function (e) { return t && (t._resolve(e), t = null), null }, function (e) { t && (t._reject(e), t = null) }); return t }, i }(), o = function () { function e() { } return e.Apply = function (e) { void 0 === e && (e = !1), (e || "undefined" == typeof Promise) && (window.Promise = n) }, e }(); e.PromisePolyfill = o }($a || ($a = {})), d = $a || ($a = {}), f = function () { function e(e) { this._pendingActions = new Array, this._workerInfos = e.map(function (e) { return { worker: e, active: !1 } }) } return e.prototype.dispose = function () { for (var e = 0, t = this._workerInfos; e < t.length; e++)t[e].worker.terminate(); delete this._workerInfos, delete this._pendingActions }, e.prototype.push = function (e) { for (var t = 0, i = this._workerInfos; t < i.length; t++) { var r = i[t]; if (!r.active) return void this._execute(r, e) } this._pendingActions.push(e) }, e.prototype._execute = function (e, t) { var i = this; e.active = !0, t(e.worker, function () { e.active = !1; var t = i._pendingActions.shift(); t && i._execute(e, t) }) }, e }(), d.WorkerPool = f, p = $a || ($a = {}), _ = function () { function e() { this._isAlphaBlendDirty = !1, this._isBlendFunctionParametersDirty = !1, this._isBlendEquationParametersDirty = !1, this._isBlendConstantsDirty = !1, this._alphaBlend = !1, this._blendFunctionParameters = new Array(4), this._blendEquationParameters = new Array(2), this._blendConstants = new Array(4), this.reset() } return Object.defineProperty(e.prototype, "isDirty", { get: function () { return this._isAlphaBlendDirty || this._isBlendFunctionParametersDirty }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "alphaBlend", { get: function () { return this._alphaBlend }, set: function (e) { this._alphaBlend !== e && (this._alphaBlend = e, this._isAlphaBlendDirty = !0) }, enumerable: !0, configurable: !0 }), e.prototype.setAlphaBlendConstants = function (e, t, i, r) { this._blendConstants[0] === e && this._blendConstants[1] === t && this._blendConstants[2] === i && this._blendConstants[3] === r || (this._blendConstants[0] = e, this._blendConstants[1] = t, this._blendConstants[2] = i, this._blendConstants[3] = r, this._isBlendConstantsDirty = !0) }, e.prototype.setAlphaBlendFunctionParameters = function (e, t, i, r) { this._blendFunctionParameters[0] === e && this._blendFunctionParameters[1] === t && this._blendFunctionParameters[2] === i && this._blendFunctionParameters[3] === r || (this._blendFunctionParameters[0] = e, this._blendFunctionParameters[1] = t, this._blendFunctionParameters[2] = i, this._blendFunctionParameters[3] = r, this._isBlendFunctionParametersDirty = !0) }, e.prototype.setAlphaEquationParameters = function (e, t) { this._blendEquationParameters[0] === e && this._blendEquationParameters[1] === t || (this._blendEquationParameters[0] = e, this._blendEquationParameters[1] = t, this._isBlendEquationParametersDirty = !0) }, e.prototype.reset = function () { this._alphaBlend = !1, this._blendFunctionParameters[0] = null, this._blendFunctionParameters[1] = null, this._blendFunctionParameters[2] = null, this._blendFunctionParameters[3] = null, this._blendEquationParameters[0] = null, this._blendEquationParameters[1] = null, this._blendConstants[0] = null, this._blendConstants[1] = null, this._blendConstants[2] = null, this._blendConstants[3] = null, this._isAlphaBlendDirty = !0, this._isBlendFunctionParametersDirty = !1, this._isBlendEquationParametersDirty = !1, this._isBlendConstantsDirty = !1 }, e.prototype.apply = function (e) { this.isDirty && (this._isAlphaBlendDirty && (this._alphaBlend ? e.enable(e.BLEND) : e.disable(e.BLEND), this._isAlphaBlendDirty = !1), this._isBlendFunctionParametersDirty && (e.blendFuncSeparate(this._blendFunctionParameters[0], this._blendFunctionParameters[1], this._blendFunctionParameters[2], this._blendFunctionParameters[3]), this._isBlendFunctionParametersDirty = !1), this._isBlendEquationParametersDirty && (e.blendEquationSeparate(this._blendEquationParameters[0], this._blendEquationParameters[1]), this._isBlendEquationParametersDirty = !1), this._isBlendConstantsDirty && (e.blendColor(this._blendConstants[0], this._blendConstants[1], this._blendConstants[2], this._blendConstants[3]), this._isBlendConstantsDirty = !1)) }, e }(), p._AlphaState = _, m = $a || ($a = {}), g = function () { function e() { this._isDepthTestDirty = !1, this._isDepthMaskDirty = !1, this._isDepthFuncDirty = !1, this._isCullFaceDirty = !1, this._isCullDirty = !1, this._isZOffsetDirty = !1, this._isFrontFaceDirty = !1, this.reset() } return Object.defineProperty(e.prototype, "isDirty", { get: function () { return this._isDepthFuncDirty || this._isDepthTestDirty || this._isDepthMaskDirty || this._isCullFaceDirty || this._isCullDirty || this._isZOffsetDirty || this._isFrontFaceDirty }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "zOffset", { get: function () { return this._zOffset }, set: function (e) { this._zOffset !== e && (this._zOffset = e, this._isZOffsetDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "cullFace", { get: function () { return this._cullFace }, set: function (e) { this._cullFace !== e && (this._cullFace = e, this._isCullFaceDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "cull", { get: function () { return this._cull }, set: function (e) { this._cull !== e && (this._cull = e, this._isCullDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "depthFunc", { get: function () { return this._depthFunc }, set: function (e) { this._depthFunc !== e && (this._depthFunc = e, this._isDepthFuncDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "depthMask", { get: function () { return this._depthMask }, set: function (e) { this._depthMask !== e && (this._depthMask = e, this._isDepthMaskDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "depthTest", { get: function () { return this._depthTest }, set: function (e) { this._depthTest !== e && (this._depthTest = e, this._isDepthTestDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "frontFace", { get: function () { return this._frontFace }, set: function (e) { this._frontFace !== e && (this._frontFace = e, this._isFrontFaceDirty = !0) }, enumerable: !0, configurable: !0 }), e.prototype.reset = function () { this._depthMask = !0, this._depthTest = !0, this._depthFunc = null, this._cullFace = null, this._cull = null, this._zOffset = 0, this._frontFace = null, this._isDepthTestDirty = !0, this._isDepthMaskDirty = !0, this._isDepthFuncDirty = !1, this._isCullFaceDirty = !1, this._isCullDirty = !1, this._isZOffsetDirty = !1, this._isFrontFaceDirty = !1 }, e.prototype.apply = function (e) { this.isDirty && (this._isCullDirty && (this.cull ? e.enable(e.CULL_FACE) : e.disable(e.CULL_FACE), this._isCullDirty = !1), this._isCullFaceDirty && (e.cullFace(this.cullFace), this._isCullFaceDirty = !1), this._isDepthMaskDirty && (e.depthMask(this.depthMask), this._isDepthMaskDirty = !1), this._isDepthTestDirty && (this.depthTest ? e.enable(e.DEPTH_TEST) : e.disable(e.DEPTH_TEST), this._isDepthTestDirty = !1), this._isDepthFuncDirty && (e.depthFunc(this.depthFunc), this._isDepthFuncDirty = !1), this._isZOffsetDirty && (this.zOffset ? (e.enable(e.POLYGON_OFFSET_FILL), e.polygonOffset(this.zOffset, 0)) : e.disable(e.POLYGON_OFFSET_FILL), this._isZOffsetDirty = !1), this._isFrontFaceDirty && (e.frontFace(this.frontFace), this._isFrontFaceDirty = !1)) }, e }(), m._DepthCullingState = g, v = $a || ($a = {}), y = function () { function e() { this._isStencilTestDirty = !1, this._isStencilMaskDirty = !1, this._isStencilFuncDirty = !1, this._isStencilOpDirty = !1, this.reset() } return Object.defineProperty(e.prototype, "isDirty", { get: function () { return this._isStencilTestDirty || this._isStencilMaskDirty || this._isStencilFuncDirty || this._isStencilOpDirty }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "stencilFunc", { get: function () { return this._stencilFunc }, set: function (e) { this._stencilFunc !== e && (this._stencilFunc = e, this._isStencilFuncDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "stencilFuncRef", { get: function () { return this._stencilFuncRef }, set: function (e) { this._stencilFuncRef !== e && (this._stencilFuncRef = e, this._isStencilFuncDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "stencilFuncMask", { get: function () { return this._stencilFuncMask }, set: function (e) { this._stencilFuncMask !== e && (this._stencilFuncMask = e, this._isStencilFuncDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "stencilOpStencilFail", { get: function () { return this._stencilOpStencilFail }, set: function (e) { this._stencilOpStencilFail !== e && (this._stencilOpStencilFail = e, this._isStencilOpDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "stencilOpDepthFail", { get: function () { return this._stencilOpDepthFail }, set: function (e) { this._stencilOpDepthFail !== e && (this._stencilOpDepthFail = e, this._isStencilOpDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "stencilOpStencilDepthPass", { get: function () { return this._stencilOpStencilDepthPass }, set: function (e) { this._stencilOpStencilDepthPass !== e && (this._stencilOpStencilDepthPass = e, this._isStencilOpDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "stencilMask", { get: function () { return this._stencilMask }, set: function (e) { this._stencilMask !== e && (this._stencilMask = e, this._isStencilMaskDirty = !0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "stencilTest", { get: function () { return this._stencilTest }, set: function (e) { this._stencilTest !== e && (this._stencilTest = e, this._isStencilTestDirty = !0) }, enumerable: !0, configurable: !0 }), e.prototype.reset = function () { this._stencilTest = !1, this._stencilMask = 255, this._stencilFunc = v.Engine.ALWAYS, this._stencilFuncRef = 1, this._stencilFuncMask = 255, this._stencilOpStencilFail = v.Engine.KEEP, this._stencilOpDepthFail = v.Engine.KEEP, this._stencilOpStencilDepthPass = v.Engine.REPLACE, this._isStencilTestDirty = !0, this._isStencilMaskDirty = !0, this._isStencilFuncDirty = !0, this._isStencilOpDirty = !0 }, e.prototype.apply = function (e) { this.isDirty && (this._isStencilTestDirty && (this.stencilTest ? e.enable(e.STENCIL_TEST) : e.disable(e.STENCIL_TEST), this._isStencilTestDirty = !1), this._isStencilMaskDirty && (e.stencilMask(this.stencilMask), this._isStencilMaskDirty = !1), this._isStencilFuncDirty && (e.stencilFunc(this.stencilFunc, this.stencilFuncRef, this.stencilFuncMask), this._isStencilFuncDirty = !1), this._isStencilOpDirty && (e.stencilOp(this.stencilOpStencilFail, this.stencilOpDepthFail, this.stencilOpStencilDepthPass), this._isStencilOpDirty = !1)) }, e }(), v._StencilState = y; var E, x, P, A, S, M, R, C, O, D, I, w, L, F, B, N, V, U, z, G, k, W, H, X, j, Y, K, Q, Z, q, J, $, ee, te, ie, re, ne, oe, se, ae, le, ce, he, ue, de, fe, pe, _e, me, ge, ve, ye, be, Te, Ee, xe, Pe, Ae, Se, Me, Re, Ce, Oe, De, Ie, we, Le, Fe, Be, Ne, Ve, Ue, ze, Ge, ke, We, He, Xe, je, Ye, Ke, Qe, Ze, qe, Je, $e, et, tt, it, rt, nt, ot, st, at, lt, ct, ht, ut, dt, ft, pt, _t, mt, gt, vt, yt, bt, Tt, Et, xt, Pt, At, St, Mt, Rt, Ct, Ot, Dt, It, wt, Lt, Ft, Bt, Nt, Vt, Ut, zt, Gt, kt, Wt, Ht, Xt, jt, Yt, Kt, Qt, Zt, qt, Jt, $t, ei, ti, ii, ri, ni, oi, si, ai, li, ci, hi, ui, di, fi, pi, _i, mi, gi, vi, yi, bi, Ti, Ei, xi, Pi, Ai, Si, Mi, Ri, Ci, Oi, Di, Ii, wi, Li, Fi, Bi, Ni, Vi, Ui, zi, Gi, ki, Wi, Hi, Xi, ji, Yi, Ki, Qi, Zi, qi, Ji, $i, er, tr, ir, rr, nr, or, sr, ar, lr, cr, hr, ur, dr, fr, pr, _r, mr, gr, vr, yr, br, Tr, Er, xr, Pr, Ar, Sr, Mr, Rr, Cr, Or, Dr, Ir, wr, Lr, Fr, Br, Nr, Vr, Ur, zr, Gr, kr, Wr, Hr, Xr, jr, Yr, Kr, Qr, Zr, qr, Jr, $r, en, tn, rn, nn, on, sn, an, ln, cn, hn, un, dn, fn, pn, _n, mn, gn, vn, yn, bn, Tn, En, xn, Pn, An, Sn, Mn, Rn, Cn, On, Dn, In, wn, Ln, Fn, Bn, Nn, Vn, Un, zn, Gn, kn, Wn, Hn, Xn, jn, Yn, Kn, Qn, Zn, qn, Jn, $n, eo, to, io, ro, no, oo, so, ao, lo, co, ho, uo, fo, po, _o, mo, go, vo, yo, bo, To, Eo, xo, Po, Ao, So, Mo, Ro, Co, Oo, Do, Io, wo, Lo, Fo, Bo, No, Vo, Uo, zo, Go, ko, Wo, Ho, Xo, jo, Yo, Ko, Qo, Zo, qo, Jo, $o, es, ts, is, rs, ns, os, ss, as, ls, cs, hs, us, ds, fs, ps, _s, ms, gs, vs, ys, bs, Ts, Es, xs, Ps, As, Ss, Ms, Rs, Cs, Os, Ds, Is, ws, Ls, Fs, Bs, Ns, Vs, Us, zs, Gs, ks, Ws, Hs, Xs, js, Ys, Ks, Qs, Zs, qs, Js, $s, ea, ta, ia, ra, na, oa, sa, aa, la, ca, ha, ua, da, fa, pa, _a, ma, ga, va, ya, ba, Ta, Ea, xa, Pa, Aa, Sa, Ma, Ra, Ca, Oa, Da, Ia, wa, La, Fa, Ba, Na, Va, Ua, za, Ga, ka, Wa, Ha, Xa, ja, Ya, Ka, Qa, Za, qa, Ja, $a, el, tl = this && this.__assign || function () { return (tl = Object.assign || function (e) { for (var t, i = 1, r = arguments.length; i < r; i++)for (var n in t = arguments[i]) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]); return e }).apply(this, arguments) }; !function (e) { var t = function () { }; e.InstancingAttributeInfo = function () { }; var i = function () { }; e.RenderTargetCreationOptions = i; e.DepthTextureCreationOptions = function () { }; var r = function () { }; e.EngineCapabilities = r; var n = function () { function n(i, r, o, s) { void 0 === s && (s = !1); var a = this; this.forcePOTTextures = !1, this.isFullscreen = !1, this.isPointerLock = !1, this.cullBackFaces = !0, this.renderEvenInBackground = !0, this.preventCacheWipeBetweenFrames = !1, this.enableOfflineSupport = !1, this.disableManifestCheck = !1, this.scenes = new Array, this.postProcesses = new Array, this.validateShaderPrograms = !1, this.onResizeObservable = new e.Observable, this.onCanvasBlurObservable = new e.Observable, this.onCanvasFocusObservable = new e.Observable, this.onCanvasPointerOutObservable = new e.Observable, this.onBeforeTextureInitObservable = new e.Observable, this._vrDisplay = void 0, this._vrSupported = !1, this._vrExclusivePointerMode = !1, this.disableUniformBuffers = !1, this._uniformBuffers = new Array, this.onBeginFrameObservable = new e.Observable, this.onEndFrameObservable = new e.Observable, this.onBeforeShaderCompilationObservable = new e.Observable, this.onAfterShaderCompilationObservable = new e.Observable, this._windowIsBackground = !1, this._webGLVersion = 1, this._badOS = !1, this._badDesktopOS = !1, this.disableTextureBindingOptimization = !1, this.onVRDisplayChangedObservable = new e.Observable, this.onVRRequestPresentComplete = new e.Observable, this.onVRRequestPresentStart = new e.Observable, this._colorWrite = !0, this._drawCalls = new e.PerfCounter, this._textureCollisions = new e.PerfCounter, this._renderingQueueLaunched = !1, this._activeRenderLoops = new Array, this._deterministicLockstep = !1, this._lockstepMaxSteps = 4, this.onContextLostObservable = new e.Observable, this.onContextRestoredObservable = new e.Observable, this._contextWasLost = !1, this._doNotHandleContextLost = !1, this._performanceMonitor = new e.PerformanceMonitor, this._fps = 60, this._deltaTime = 0, this.disablePerformanceMonitorInBackground = !1, this._depthCullingState = new e._DepthCullingState, this._stencilState = new e._StencilState, this._alphaState = new e._AlphaState, this._alphaMode = n.ALPHA_DISABLE, this._internalTexturesCache = new Array, this._activeChannel = 0, this._currentTextureChannel = -1, this._boundTexturesCache = {}, this._compiledEffects = {}, this._vertexAttribArraysEnabled = [], this._uintIndicesCurrentlySet = !1, this._currentBoundBuffer = new Array, this._currentFramebuffer = null, this._currentBufferPointers = new Array, this._currentInstanceLocations = new Array, this._currentInstanceBuffers = new Array, this._firstBoundInternalTextureTracker = new e.DummyInternalTextureTracker, this._lastBoundInternalTextureTracker = new e.DummyInternalTextureTracker, this._vaoRecordInProgress = !1, this._mustWipeVertexAttributes = !1, this._nextFreeTextureSlots = new Array, this._maxSimultaneousTextures = 0, this._activeRequests = new Array, this._texturesSupported = new Array, this.premultipliedAlpha = !0, this._viewportCached = new e.Vector4(0, 0, 0, 0), this._onVRFullScreenTriggered = function () { if (a._vrDisplay && a._vrDisplay.isPresenting) { a._oldSize = new e.Size(a.getRenderWidth(), a.getRenderHeight()), a._oldHardwareScaleFactor = a.getHardwareScalingLevel(); var t = a._vrDisplay.getEyeParameters("left"); a.setHardwareScalingLevel(1), a.setSize(2 * t.renderWidth, t.renderHeight) } else a.setHardwareScalingLevel(a._oldHardwareScaleFactor), a.setSize(a._oldSize.width, a._oldSize.height) }, this._unpackFlipYCached = null, this.enableUnpackFlipYCached = !0, this._boundUniforms = {}, e.PromisePolyfill.Apply(); var l = null; if (n.Instances.push(this), i) { if (o = o || {}, i.getContext) { if (l = i, this._renderingCanvas = l, null != r && (o.antialias = r), void 0 === o.deterministicLockstep && (o.deterministicLockstep = !1), void 0 === o.lockstepMaxSteps && (o.lockstepMaxSteps = 4), void 0 === o.preserveDrawingBuffer && (o.preserveDrawingBuffer = !1), void 0 === o.audioEngine && (o.audioEngine = !0), void 0 === o.stencil && (o.stencil = !0), !1 === o.premultipliedAlpha && (this.premultipliedAlpha = !1), this._deterministicLockstep = o.deterministicLockstep, this._lockstepMaxSteps = o.lockstepMaxSteps, this._doNotHandleContextLost = !!o.doNotHandleContextLost, navigator && navigator.userAgent) for (var c = navigator.userAgent, h = 0, u = n.ExceptionList; h < u.length; h++) { var d = u[h], f = d.key, p = d.targets; if (-1 < c.indexOf(f)) { if (d.capture && d.captureConstraint) { var _ = d.capture, m = d.captureConstraint, g = new RegExp(_).exec(c); if (g && 0 < g.length && m <= parseInt(g[g.length - 1])) continue } for (var v = 0, y = p; v < y.length; v++)switch (y[v]) { case "uniformBuffer": this.disableUniformBuffers = !0; break; case "textureBindingOptimization": this.disableTextureBindingOptimization = !0 } } } if (!o.disableWebGL2Support) try { this._gl = l.getContext("webgl2", o) || l.getContext("experimental-webgl2", o), this._gl && (this._webGLVersion = 2, this._gl.deleteQuery || (this._webGLVersion = 1)) } catch (i) { } if (!this._gl) { if (!l) throw new Error("The provided canvas is null or undefined."); try { this._gl = l.getContext("webgl", o) || l.getContext("experimental-webgl", o) } catch (i) { throw new Error("WebGL not supported") } } if (!this._gl) throw new Error("WebGL not supported"); this._onCanvasFocus = function () { a.onCanvasFocusObservable.notifyObservers(a) }, this._onCanvasBlur = function () { a.onCanvasBlurObservable.notifyObservers(a) }, l.addEventListener("focus", this._onCanvasFocus), l.addEventListener("blur", this._onCanvasBlur), this._onBlur = function () { a.disablePerformanceMonitorInBackground && a._performanceMonitor.disable(), a._windowIsBackground = !0 }, this._onFocus = function () { a.disablePerformanceMonitorInBackground && a._performanceMonitor.enable(), a._windowIsBackground = !1 }, this._onCanvasPointerOut = function (e) { a.onCanvasPointerOutObservable.notifyObservers(e) }, window.addEventListener("blur", this._onBlur), window.addEventListener("focus", this._onFocus), l.addEventListener("pointerout", this._onCanvasPointerOut), this._doNotHandleContextLost || (this._onContextLost = function (t) { t.preventDefault(), a._contextWasLost = !0, e.Tools.Warn("WebGL context lost."), a.onContextLostObservable.notifyObservers(a) }, this._onContextRestored = function (t) { setTimeout(function () { a._initGLContext(), a._rebuildEffects(), a._rebuildInternalTextures(), a._rebuildBuffers(), a.wipeCaches(!0), e.Tools.Warn("WebGL context successfully restored."), a.onContextRestoredObservable.notifyObservers(a), a._contextWasLost = !1 }, 0) }, l.addEventListener("webglcontextlost", this._onContextLost, !1), l.addEventListener("webglcontextrestored", this._onContextRestored, !1)) } else { this._gl = i, this._renderingCanvas = this._gl.canvas, this._gl.renderbufferStorageMultisample && (this._webGLVersion = 2); var b = this._gl.getContextAttributes(); b && (o.stencil = b.stencil) } var T = o.limitDeviceRatio || window.devicePixelRatio || 1; this._hardwareScalingLevel = s ? 1 / Math.min(T, window.devicePixelRatio || 1) : 1, this.resize(), this._isStencilEnable = !!o.stencil, this._initGLContext(), l && (this._onFullscreenChange = function () { void 0 !== document.fullscreen ? a.isFullscreen = document.fullscreen : void 0 !== document.mozFullScreen ? a.isFullscreen = document.mozFullScreen : void 0 !== document.webkitIsFullScreen ? a.isFullscreen = document.webkitIsFullScreen : void 0 !== document.msIsFullScreen && (a.isFullscreen = document.msIsFullScreen), a.isFullscreen && a._pointerLockRequested && l && (l.requestPointerLock = l.requestPointerLock || l.msRequestPointerLock || l.mozRequestPointerLock || l.webkitRequestPointerLock, l.requestPointerLock && l.requestPointerLock()) }, document.addEventListener("fullscreenchange", this._onFullscreenChange, !1), document.addEventListener("mozfullscreenchange", this._onFullscreenChange, !1), document.addEventListener("webkitfullscreenchange", this._onFullscreenChange, !1), document.addEventListener("msfullscreenchange", this._onFullscreenChange, !1), this._onPointerLockChange = function () { a.isPointerLock = document.mozPointerLockElement === l || document.webkitPointerLockElement === l || document.msPointerLockElement === l || document.pointerLockElement === l }, document.addEventListener("pointerlockchange", this._onPointerLockChange, !1), document.addEventListener("mspointerlockchange", this._onPointerLockChange, !1), document.addEventListener("mozpointerlockchange", this._onPointerLockChange, !1), document.addEventListener("webkitpointerlockchange", this._onPointerLockChange, !1), this._onVRDisplayPointerRestricted = function () { l && l.requestPointerLock() }, this._onVRDisplayPointerUnrestricted = function () { document.exitPointerLock() }, window.addEventListener("vrdisplaypointerrestricted", this._onVRDisplayPointerRestricted, !1), window.addEventListener("vrdisplaypointerunrestricted", this._onVRDisplayPointerUnrestricted, !1)), !n.audioEngine && o.audioEngine && n.AudioEngineFactory && (n.audioEngine = n.AudioEngineFactory(this.getRenderingCanvas())); for (var E = 0; E < this._caps.maxVertexAttribs; E++)this._currentBufferPointers[E] = new t; this._linkTrackers(this._firstBoundInternalTextureTracker, this._lastBoundInternalTextureTracker), o.autoEnableWebVR && this.initWebVR(), this._badOS = /iPad/i.test(navigator.userAgent) || /iPhone/i.test(navigator.userAgent), this._badDesktopOS = /^((?!chrome|android).)*safari/i.test(navigator.userAgent), console.log("Babylon.js engine (v" + n.Version + ") launched"), this.enableOfflineSupport = void 0 !== e.Database } } return Object.defineProperty(n, "LastCreatedEngine", { get: function () { return 0 === n.Instances.length ? null : n.Instances[n.Instances.length - 1] }, enumerable: !0, configurable: !0 }), Object.defineProperty(n, "LastCreatedScene", { get: function () { var e = n.LastCreatedEngine; return e ? 0 === e.scenes.length ? null : e.scenes[e.scenes.length - 1] : null }, enumerable: !0, configurable: !0 }), n.MarkAllMaterialsAsDirty = function (e, t) { for (var i = 0; i < n.Instances.length; i++)for (var r = n.Instances[i], o = 0; o < r.scenes.length; o++)r.scenes[o].markAllMaterialsAsDirty(e, t) }, Object.defineProperty(n, "Version", { get: function () { return "3.3.0" }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "isInVRExclusivePointerMode", { get: function () { return this._vrExclusivePointerMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "supportsUniformBuffers", { get: function () { return 1 < this.webGLVersion && !this.disableUniformBuffers }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "needPOTTextures", { get: function () { return this._webGLVersion < 2 || this.forcePOTTextures }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "doNotHandleContextLost", { get: function () { return this._doNotHandleContextLost }, set: function (e) { this._doNotHandleContextLost = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "performanceMonitor", { get: function () { return this._performanceMonitor }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "texturesSupported", { get: function () { return this._texturesSupported }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "textureFormatInUse", { get: function () { return this._textureFormatInUse }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "currentViewport", { get: function () { return this._cachedViewport }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "emptyTexture", { get: function () { return this._emptyTexture || (this._emptyTexture = this.createRawTexture(new Uint8Array(4), 1, 1, n.TEXTUREFORMAT_RGBA, !1, !1, n.TEXTURE_NEAREST_SAMPLINGMODE)), this._emptyTexture }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "emptyTexture3D", { get: function () { return this._emptyTexture3D || (this._emptyTexture3D = this.createRawTexture3D(new Uint8Array(4), 1, 1, 1, n.TEXTUREFORMAT_RGBA, !1, !1, n.TEXTURE_NEAREST_SAMPLINGMODE)), this._emptyTexture3D }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "emptyCubeTexture", { get: function () { if (!this._emptyCubeTexture) { var e = new Uint8Array(4), t = [e, e, e, e, e, e]; this._emptyCubeTexture = this.createRawCubeTexture(t, 1, n.TEXTUREFORMAT_RGBA, n.TEXTURETYPE_UNSIGNED_INT, !1, !1, n.TEXTURE_NEAREST_SAMPLINGMODE) } return this._emptyCubeTexture }, enumerable: !0, configurable: !0 }), n.prototype._rebuildInternalTextures = function () { for (var e = 0, t = this._internalTexturesCache.slice(); e < t.length; e++)t[e]._rebuild() }, n.prototype._rebuildEffects = function () { for (var t in this._compiledEffects) this._compiledEffects[t]._prepareEffect(); e.Effect.ResetCache() }, n.prototype._rebuildBuffers = function () { for (var e = 0, t = this.scenes; e < t.length; e++) { var i = t[e]; i.resetCachedMaterial(), i._rebuildGeometries(), i._rebuildTextures() } for (var r = 0, n = this._uniformBuffers; r < n.length; r++)n[r]._rebuild() }, n.prototype._initGLContext = function () { this._caps = new r, this._caps.maxTexturesImageUnits = this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS), this._caps.maxCombinedTexturesImageUnits = this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS), this._caps.maxVertexTextureImageUnits = this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS), this._caps.maxTextureSize = this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE), this._caps.maxCubemapTextureSize = this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE), this._caps.maxRenderTextureSize = this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE), this._caps.maxVertexAttribs = this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS), this._caps.maxVaryingVectors = this._gl.getParameter(this._gl.MAX_VARYING_VECTORS), this._caps.maxFragmentUniformVectors = this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS), this._caps.maxVertexUniformVectors = this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS), this._glVersion = this._gl.getParameter(this._gl.VERSION); var e = this._gl.getExtension("WEBGL_debug_renderer_info"); if (null != e && (this._glRenderer = this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL), this._glVendor = this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)), this._glVendor || (this._glVendor = "Unknown vendor"), this._glRenderer || (this._glRenderer = "Unknown renderer"), this._gl.HALF_FLOAT_OES = 36193, 34842 !== this._gl.RGBA16F && (this._gl.RGBA16F = 34842), 34836 !== this._gl.RGBA32F && (this._gl.RGBA32F = 34836), 35056 !== this._gl.DEPTH24_STENCIL8 && (this._gl.DEPTH24_STENCIL8 = 35056), this._caps.standardDerivatives = 1 < this._webGLVersion || null !== this._gl.getExtension("OES_standard_derivatives"), this._caps.astc = this._gl.getExtension("WEBGL_compressed_texture_astc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"), this._caps.s3tc = this._gl.getExtension("WEBGL_compressed_texture_s3tc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"), this._caps.pvrtc = this._gl.getExtension("WEBGL_compressed_texture_pvrtc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"), this._caps.etc1 = this._gl.getExtension("WEBGL_compressed_texture_etc1") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"), this._caps.etc2 = this._gl.getExtension("WEBGL_compressed_texture_etc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc") || this._gl.getExtension("WEBGL_compressed_texture_es3_0"), this._caps.textureAnisotropicFilterExtension = this._gl.getExtension("EXT_texture_filter_anisotropic") || this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic") || this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"), this._caps.maxAnisotropy = this._caps.textureAnisotropicFilterExtension ? this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0, this._caps.uintIndices = 1 < this._webGLVersion || null !== this._gl.getExtension("OES_element_index_uint"), this._caps.fragmentDepthSupported = 1 < this._webGLVersion || null !== this._gl.getExtension("EXT_frag_depth"), this._caps.highPrecisionShaderSupported = !0, this._caps.timerQuery = this._gl.getExtension("EXT_disjoint_timer_query_webgl2") || this._gl.getExtension("EXT_disjoint_timer_query"), this._caps.timerQuery && (1 === this._webGLVersion && (this._gl.getQuery = this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)), this._caps.canUseTimestampForTimerQuery = 0 < this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT, this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)), this._caps.colorBufferFloat = 1 < this._webGLVersion && this._gl.getExtension("EXT_color_buffer_float"), this._caps.textureFloat = !!(1 < this._webGLVersion || this._gl.getExtension("OES_texture_float")), this._caps.textureFloatLinearFiltering = !(!this._caps.textureFloat || !this._gl.getExtension("OES_texture_float_linear")), this._caps.textureFloatRender = !(!this._caps.textureFloat || !this._canRenderToFloatFramebuffer()), this._caps.textureHalfFloat = !!(1 < this._webGLVersion || this._gl.getExtension("OES_texture_half_float")), this._caps.textureHalfFloatLinearFiltering = !!(1 < this._webGLVersion || this._caps.textureHalfFloat && this._gl.getExtension("OES_texture_half_float_linear")), 1 < this._webGLVersion && (this._gl.HALF_FLOAT_OES = 5131), this._caps.textureHalfFloatRender = this._caps.textureHalfFloat && this._canRenderToHalfFloatFramebuffer(), this._caps.textureLOD = !!(1 < this._webGLVersion || this._gl.getExtension("EXT_shader_texture_lod")), 1 < this._webGLVersion) this._caps.drawBuffersExtension = !0; else { var t = this._gl.getExtension("WEBGL_draw_buffers"); if (null !== t) { this._caps.drawBuffersExtension = !0, this._gl.drawBuffers = t.drawBuffersWEBGL.bind(t), this._gl.DRAW_FRAMEBUFFER = this._gl.FRAMEBUFFER; for (var i = 0; i < 16; i++)this._gl["COLOR_ATTACHMENT" + i + "_WEBGL"] = t["COLOR_ATTACHMENT" + i + "_WEBGL"] } else this._caps.drawBuffersExtension = !1 } if (1 < this._webGLVersion) this._caps.depthTextureExtension = !0; else { var n = this._gl.getExtension("WEBGL_depth_texture"); null != n && (this._caps.depthTextureExtension = !0, this._gl.UNSIGNED_INT_24_8 = n.UNSIGNED_INT_24_8_WEBGL) } if (1 < this._webGLVersion) this._caps.vertexArrayObject = !0; else { var o = this._gl.getExtension("OES_vertex_array_object"); null != o ? (this._caps.vertexArrayObject = !0, this._gl.createVertexArray = o.createVertexArrayOES.bind(o), this._gl.bindVertexArray = o.bindVertexArrayOES.bind(o), this._gl.deleteVertexArray = o.deleteVertexArrayOES.bind(o)) : this._caps.vertexArrayObject = !1 } if (1 < this._webGLVersion) this._caps.instancedArrays = !0; else { var s = this._gl.getExtension("ANGLE_instanced_arrays"); null != s ? (this._caps.instancedArrays = !0, this._gl.drawArraysInstanced = s.drawArraysInstancedANGLE.bind(s), this._gl.drawElementsInstanced = s.drawElementsInstancedANGLE.bind(s), this._gl.vertexAttribDivisor = s.vertexAttribDivisorANGLE.bind(s)) : this._caps.instancedArrays = !1 } if (this._caps.astc && this.texturesSupported.push("-astc.ktx"), this._caps.s3tc && this.texturesSupported.push("-dxt.ktx"), this._caps.pvrtc && this.texturesSupported.push("-pvrtc.ktx"), this._caps.etc2 && this.texturesSupported.push("-etc2.ktx"), this._caps.etc1 && this.texturesSupported.push("-etc1.ktx"), this._gl.getShaderPrecisionFormat) { var a = this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER, this._gl.HIGH_FLOAT); a && (this._caps.highPrecisionShaderSupported = 0 !== a.precision) } this.setDepthBuffer(!0), this.setDepthFunctionToLessOrEqual(), this.setDepthWrite(!0), this._maxSimultaneousTextures = this._caps.maxCombinedTexturesImageUnits; for (var l = 0; l < this._maxSimultaneousTextures; l++)this._nextFreeTextureSlots.push(l) }, Object.defineProperty(n.prototype, "webGLVersion", { get: function () { return this._webGLVersion }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "isStencilEnable", { get: function () { return this._isStencilEnable }, enumerable: !0, configurable: !0 }), n.prototype._prepareWorkingCanvas = function () { if (!this._workingCanvas) { this._workingCanvas = document.createElement("canvas"); var e = this._workingCanvas.getContext("2d"); e && (this._workingContext = e) } }, n.prototype.resetTextureCache = function () { for (var e in this._boundTexturesCache) if (this._boundTexturesCache.hasOwnProperty(e)) { var t = this._boundTexturesCache[e]; t && this._removeDesignatedSlot(t), this._boundTexturesCache[e] = null } if (!this.disableTextureBindingOptimization) { this._nextFreeTextureSlots = []; for (var i = 0; i < this._maxSimultaneousTextures; i++)this._nextFreeTextureSlots.push(i) } this._currentTextureChannel = -1 }, n.prototype.isDeterministicLockStep = function () { return this._deterministicLockstep }, n.prototype.getLockstepMaxSteps = function () { return this._lockstepMaxSteps }, n.prototype.getGlInfo = function () { return { vendor: this._glVendor, renderer: this._glRenderer, version: this._glVersion } }, n.prototype.getAspectRatio = function (e, t) { void 0 === t && (t = !1); var i = e.viewport; return this.getRenderWidth(t) * i.width / (this.getRenderHeight(t) * i.height) }, n.prototype.getScreenAspectRatio = function () { return this.getRenderWidth(!0) / this.getRenderHeight(!0) }, n.prototype.getRenderWidth = function (e) { return void 0 === e && (e = !1), !e && this._currentRenderTarget ? this._currentRenderTarget.width : this._gl.drawingBufferWidth }, n.prototype.getRenderHeight = function (e) { return void 0 === e && (e = !1), !e && this._currentRenderTarget ? this._currentRenderTarget.height : this._gl.drawingBufferHeight }, n.prototype.getRenderingCanvas = function () { return this._renderingCanvas }, n.prototype.getRenderingCanvasClientRect = function () { return this._renderingCanvas ? this._renderingCanvas.getBoundingClientRect() : null }, n.prototype.setHardwareScalingLevel = function (e) { this._hardwareScalingLevel = e, this.resize() }, n.prototype.getHardwareScalingLevel = function () { return this._hardwareScalingLevel }, n.prototype.getLoadedTexturesCache = function () { return this._internalTexturesCache }, n.prototype.getCaps = function () { return this._caps }, Object.defineProperty(n.prototype, "drawCalls", { get: function () { return e.Tools.Warn("drawCalls is deprecated. Please use SceneInstrumentation class"), 0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "drawCallsPerfCounter", { get: function () { return e.Tools.Warn("drawCallsPerfCounter is deprecated. Please use SceneInstrumentation class"), null }, enumerable: !0, configurable: !0 }), n.prototype.getDepthFunction = function () { return this._depthCullingState.depthFunc }, n.prototype.setDepthFunction = function (e) { this._depthCullingState.depthFunc = e }, n.prototype.setDepthFunctionToGreater = function () { this._depthCullingState.depthFunc = this._gl.GREATER }, n.prototype.setDepthFunctionToGreaterOrEqual = function () { this._depthCullingState.depthFunc = this._gl.GEQUAL }, n.prototype.setDepthFunctionToLess = function () { this._depthCullingState.depthFunc = this._gl.LESS }, n.prototype.setDepthFunctionToLessOrEqual = function () { this._depthCullingState.depthFunc = this._gl.LEQUAL }, n.prototype.getStencilBuffer = function () { return this._stencilState.stencilTest }, n.prototype.setStencilBuffer = function (e) { this._stencilState.stencilTest = e }, n.prototype.getStencilMask = function () { return this._stencilState.stencilMask }, n.prototype.setStencilMask = function (e) { this._stencilState.stencilMask = e }, n.prototype.getStencilFunction = function () { return this._stencilState.stencilFunc }, n.prototype.getStencilFunctionReference = function () { return this._stencilState.stencilFuncRef }, n.prototype.getStencilFunctionMask = function () { return this._stencilState.stencilFuncMask }, n.prototype.setStencilFunction = function (e) { this._stencilState.stencilFunc = e }, n.prototype.setStencilFunctionReference = function (e) { this._stencilState.stencilFuncRef = e }, n.prototype.setStencilFunctionMask = function (e) { this._stencilState.stencilFuncMask = e }, n.prototype.getStencilOperationFail = function () { return this._stencilState.stencilOpStencilFail }, n.prototype.getStencilOperationDepthFail = function () { return this._stencilState.stencilOpDepthFail }, n.prototype.getStencilOperationPass = function () { return this._stencilState.stencilOpStencilDepthPass }, n.prototype.setStencilOperationFail = function (e) { this._stencilState.stencilOpStencilFail = e }, n.prototype.setStencilOperationDepthFail = function (e) { this._stencilState.stencilOpDepthFail = e }, n.prototype.setStencilOperationPass = function (e) { this._stencilState.stencilOpStencilDepthPass = e }, n.prototype.setDitheringState = function (e) { e ? this._gl.enable(this._gl.DITHER) : this._gl.disable(this._gl.DITHER) }, n.prototype.setRasterizerState = function (e) { e ? this._gl.disable(this._gl.RASTERIZER_DISCARD) : this._gl.enable(this._gl.RASTERIZER_DISCARD) }, n.prototype.stopRenderLoop = function (e) { if (e) { var t = this._activeRenderLoops.indexOf(e); 0 <= t && this._activeRenderLoops.splice(t, 1) } else this._activeRenderLoops = [] }, n.prototype._renderLoop = function () { if (!this._contextWasLost) { var t = !0; if (!this.renderEvenInBackground && this._windowIsBackground && (t = !1), t) { this.beginFrame(); for (var i = 0; i < this._activeRenderLoops.length; i++)(0, this._activeRenderLoops[i])(); this.endFrame() } } if (0 < this._activeRenderLoops.length) { var r = null; this._vrDisplay && this._vrDisplay.isPresenting && (r = this._vrDisplay), this._frameHandler = e.Tools.QueueNewFrame(this._bindedRenderFunction, r) } else this._renderingQueueLaunched = !1 }, n.prototype.runRenderLoop = function (t) { -1 === this._activeRenderLoops.indexOf(t) && (this._activeRenderLoops.push(t), this._renderingQueueLaunched || (this._renderingQueueLaunched = !0, this._bindedRenderFunction = this._renderLoop.bind(this), this._frameHandler = e.Tools.QueueNewFrame(this._bindedRenderFunction))) }, n.prototype.switchFullscreen = function (t) { this.isFullscreen ? e.Tools.ExitFullscreen() : (this._pointerLockRequested = t, this._renderingCanvas && e.Tools.RequestFullscreen(this._renderingCanvas)) }, n.prototype.clear = function (e, t, i, r) { void 0 === r && (r = !1), this.applyStates(); var n = 0; t && e && (this._gl.clearColor(e.r, e.g, e.b, void 0 !== e.a ? e.a : 1), n |= this._gl.COLOR_BUFFER_BIT), i && (this._gl.clearDepth(1), n |= this._gl.DEPTH_BUFFER_BIT), r && (this._gl.clearStencil(0), n |= this._gl.STENCIL_BUFFER_BIT), this._gl.clear(n) }, n.prototype.scissorClear = function (e, t, i, r, n) { var o = this._gl, s = o.getParameter(o.SCISSOR_TEST), a = o.getParameter(o.SCISSOR_BOX); o.enable(o.SCISSOR_TEST), o.scissor(e, t, i, r), this.clear(n, !0, !0, !0), o.scissor(a[0], a[1], a[2], a[3]), !0 === s ? o.enable(o.SCISSOR_TEST) : o.disable(o.SCISSOR_TEST) }, n.prototype._viewport = function (e, t, i, r) { e === this._viewportCached.x && t === this._viewportCached.y && i === this._viewportCached.z && r === this._viewportCached.w || (this._viewportCached.x = e, this._viewportCached.y = t, this._viewportCached.z = i, this._viewportCached.w = r, this._gl.viewport(e, t, i, r)) }, n.prototype.setViewport = function (e, t, i) { var r = t || this.getRenderWidth(), n = i || this.getRenderHeight(), o = e.x || 0, s = e.y || 0; this._cachedViewport = e, this._viewport(o * r, s * n, r * e.width, n * e.height) }, n.prototype.setDirectViewport = function (e, t, i, r) { var n = this._cachedViewport; return this._cachedViewport = null, this._viewport(e, t, i, r), n }, n.prototype.beginFrame = function () { this.onBeginFrameObservable.notifyObservers(this), this._measureFps() }, n.prototype.endFrame = function () { this._badOS && this.flushFramebuffer(), this._vrDisplay && this._vrDisplay.isPresenting && this._vrDisplay.submitFrame(), this.onEndFrameObservable.notifyObservers(this) }, n.prototype.resize = function () { if (!this._vrDisplay || !this._vrDisplay.isPresenting) { var e = this._renderingCanvas ? this._renderingCanvas.clientWidth : window.innerWidth, t = this._renderingCanvas ? this._renderingCanvas.clientHeight : window.innerHeight; this.setSize(e / this._hardwareScalingLevel, t / this._hardwareScalingLevel) } }, n.prototype.setSize = function (e, t) { if (this._renderingCanvas && (this._renderingCanvas.width !== e || this._renderingCanvas.height !== t)) { this._renderingCanvas.width = e, this._renderingCanvas.height = t; for (var i = 0; i < this.scenes.length; i++)for (var r = this.scenes[i], n = 0; n < r.cameras.length; n++)r.cameras[n]._currentRenderId = 0; this.onResizeObservable.hasObservers && this.onResizeObservable.notifyObservers(this) } }, n.prototype.isVRDevicePresent = function () { return !!this._vrDisplay }, n.prototype.getVRDevice = function () { return this._vrDisplay }, n.prototype.initWebVR = function () { return this.initWebVRAsync(), this.onVRDisplayChangedObservable }, n.prototype.initWebVRAsync = function () { var t = this, i = function () { var e = { vrDisplay: t._vrDisplay, vrSupported: t._vrSupported }; t.onVRDisplayChangedObservable.notifyObservers(e), t._webVRInitPromise = new Promise(function (t) { t(e) }) }; return this._onVrDisplayConnect || (this._onVrDisplayConnect = function (e) { t._vrDisplay = e.display, i() }, this._onVrDisplayDisconnect = function () { t._vrDisplay.cancelAnimationFrame(t._frameHandler), t._vrDisplay = void 0, t._frameHandler = e.Tools.QueueNewFrame(t._bindedRenderFunction), i() }, this._onVrDisplayPresentChange = function () { t._vrExclusivePointerMode = t._vrDisplay && t._vrDisplay.isPresenting }, window.addEventListener("vrdisplayconnect", this._onVrDisplayConnect), window.addEventListener("vrdisplaydisconnect", this._onVrDisplayDisconnect), window.addEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange)), this._webVRInitPromise = this._webVRInitPromise || this._getVRDisplaysAsync(), this._webVRInitPromise.then(i), this._webVRInitPromise }, n.prototype.enableVR = function () { var e = this; this._vrDisplay && !this._vrDisplay.isPresenting && (this.onVRRequestPresentStart.notifyObservers(this), this._vrDisplay.requestPresent([{ source: this.getRenderingCanvas() }]).then(function () { e.onVRRequestPresentComplete.notifyObservers(!0), e._onVRFullScreenTriggered() }).catch(function () { e.onVRRequestPresentComplete.notifyObservers(!1) })) }, n.prototype.disableVR = function () { this._vrDisplay && this._vrDisplay.isPresenting && this._vrDisplay.exitPresent().then(this._onVRFullScreenTriggered).catch(this._onVRFullScreenTriggered) }, n.prototype._getVRDisplaysAsync = function () { var e = this; return new Promise(function (t, i) { navigator.getVRDisplays ? navigator.getVRDisplays().then(function (i) { e._vrSupported = !0, e._vrDisplay = i[0], t({ vrDisplay: e._vrDisplay, vrSupported: e._vrSupported }) }) : (e._vrDisplay = void 0, e._vrSupported = !1, t({ vrDisplay: e._vrDisplay, vrSupported: e._vrSupported })) }) }, n.prototype.bindFramebuffer = function (e, t, i, r, n, o, s) { void 0 === s && (s = 0), this._currentRenderTarget && this.unBindFramebuffer(this._currentRenderTarget), this._currentRenderTarget = e, this.bindUnboundFramebuffer(e._MSAAFramebuffer ? e._MSAAFramebuffer : e._framebuffer); var a = this._gl; e.isCube && (void 0 === t && (t = 0), a.framebufferTexture2D(a.FRAMEBUFFER, a.COLOR_ATTACHMENT0, a.TEXTURE_CUBE_MAP_POSITIVE_X + t, e._webGLTexture, s), o && (o._generateStencilBuffer ? a.framebufferTexture2D(a.FRAMEBUFFER, a.DEPTH_STENCIL_ATTACHMENT, a.TEXTURE_CUBE_MAP_POSITIVE_X + t, o._webGLTexture, s) : a.framebufferTexture2D(a.FRAMEBUFFER, a.DEPTH_ATTACHMENT, a.TEXTURE_CUBE_MAP_POSITIVE_X + t, o._webGLTexture, s))), this._cachedViewport && !n ? this.setViewport(this._cachedViewport, i, r) : (i || (i = e.width, s && (i /= Math.pow(2, s))), r || (r = e.height, s && (r /= Math.pow(2, s))), this._viewport(0, 0, i, r)), this.wipeCaches() }, n.prototype.bindUnboundFramebuffer = function (e) { this._currentFramebuffer !== e && (this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, e), this._currentFramebuffer = e) }, n.prototype.unBindFramebuffer = function (e, t, i) { void 0 === t && (t = !1), this._currentRenderTarget = null; var r = this._gl; e._MSAAFramebuffer && (r.bindFramebuffer(r.READ_FRAMEBUFFER, e._MSAAFramebuffer), r.bindFramebuffer(r.DRAW_FRAMEBUFFER, e._framebuffer), r.blitFramebuffer(0, 0, e.width, e.height, 0, 0, e.width, e.height, r.COLOR_BUFFER_BIT, r.NEAREST)), !e.generateMipMaps || t || e.isCube || (this._bindTextureDirectly(r.TEXTURE_2D, e, !0), r.generateMipmap(r.TEXTURE_2D), this._bindTextureDirectly(r.TEXTURE_2D, null)), i && (e._MSAAFramebuffer && this.bindUnboundFramebuffer(e._framebuffer), i()), this.bindUnboundFramebuffer(null) }, n.prototype.unBindMultiColorAttachmentFramebuffer = function (e, t, i) { void 0 === t && (t = !1), this._currentRenderTarget = null; var r = this._gl; if (e[0]._MSAAFramebuffer) { r.bindFramebuffer(r.READ_FRAMEBUFFER, e[0]._MSAAFramebuffer), r.bindFramebuffer(r.DRAW_FRAMEBUFFER, e[0]._framebuffer); var n = e[0]._attachments; n || (n = new Array(e.length), e[0]._attachments = n); for (var o = 0; o < e.length; o++) { for (var s = e[o], a = 0; a < n.length; a++)n[a] = r.NONE; n[o] = r[1 < this.webGLVersion ? "COLOR_ATTACHMENT" + o : "COLOR_ATTACHMENT" + o + "_WEBGL"], r.readBuffer(n[o]), r.drawBuffers(n), r.blitFramebuffer(0, 0, s.width, s.height, 0, 0, s.width, s.height, r.COLOR_BUFFER_BIT, r.NEAREST) } for (o = 0; o < n.length; o++)n[o] = r[1 < this.webGLVersion ? "COLOR_ATTACHMENT" + o : "COLOR_ATTACHMENT" + o + "_WEBGL"]; r.drawBuffers(n) } for (o = 0; o < e.length; o++)!(s = e[o]).generateMipMaps || t || s.isCube || (this._bindTextureDirectly(r.TEXTURE_2D, s), r.generateMipmap(r.TEXTURE_2D), this._bindTextureDirectly(r.TEXTURE_2D, null)); i && (e[0]._MSAAFramebuffer && this.bindUnboundFramebuffer(e[0]._framebuffer), i()), this.bindUnboundFramebuffer(null) }, n.prototype.generateMipMapsForCubemap = function (e) { if (e.generateMipMaps) { var t = this._gl; this._bindTextureDirectly(t.TEXTURE_CUBE_MAP, e, !0), t.generateMipmap(t.TEXTURE_CUBE_MAP), this._bindTextureDirectly(t.TEXTURE_CUBE_MAP, null) } }, n.prototype.flushFramebuffer = function () { this._gl.flush() }, n.prototype.restoreDefaultFramebuffer = function () { this._currentRenderTarget ? this.unBindFramebuffer(this._currentRenderTarget) : this.bindUnboundFramebuffer(null), this._cachedViewport && this.setViewport(this._cachedViewport), this.wipeCaches() }, n.prototype.createUniformBuffer = function (e) { var t = this._gl.createBuffer(); if (!t) throw new Error("Unable to create uniform buffer"); return this.bindUniformBuffer(t), e instanceof Float32Array ? this._gl.bufferData(this._gl.UNIFORM_BUFFER, e, this._gl.STATIC_DRAW) : this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(e), this._gl.STATIC_DRAW), this.bindUniformBuffer(null), t.references = 1, t }, n.prototype.createDynamicUniformBuffer = function (e) { var t = this._gl.createBuffer(); if (!t) throw new Error("Unable to create dynamic uniform buffer"); return this.bindUniformBuffer(t), e instanceof Float32Array ? this._gl.bufferData(this._gl.UNIFORM_BUFFER, e, this._gl.DYNAMIC_DRAW) : this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(e), this._gl.DYNAMIC_DRAW), this.bindUniformBuffer(null), t.references = 1, t }, n.prototype.updateUniformBuffer = function (e, t, i, r) { this.bindUniformBuffer(e), void 0 === i && (i = 0), void 0 === r ? t instanceof Float32Array ? this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, i, t) : this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, i, new Float32Array(t)) : t instanceof Float32Array ? this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, t.subarray(i, i + r)) : this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, new Float32Array(t).subarray(i, i + r)), this.bindUniformBuffer(null) }, n.prototype._resetVertexBufferBinding = function () { this.bindArrayBuffer(null), this._cachedVertexBuffers = null }, n.prototype.createVertexBuffer = function (e) { var t = this._gl.createBuffer(); if (!t) throw new Error("Unable to create vertex buffer"); return this.bindArrayBuffer(t), e instanceof Array ? this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(e), this._gl.STATIC_DRAW) : this._gl.bufferData(this._gl.ARRAY_BUFFER, e, this._gl.STATIC_DRAW), this._resetVertexBufferBinding(), t.references = 1, t }, n.prototype.createDynamicVertexBuffer = function (e) { var t = this._gl.createBuffer(); if (!t) throw new Error("Unable to create dynamic vertex buffer"); return this.bindArrayBuffer(t), e instanceof Array ? this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(e), this._gl.DYNAMIC_DRAW) : this._gl.bufferData(this._gl.ARRAY_BUFFER, e, this._gl.DYNAMIC_DRAW), this._resetVertexBufferBinding(), t.references = 1, t }, n.prototype.updateDynamicIndexBuffer = function (e, t, i) { var r; void 0 === i && (i = 0), this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER] = null, this.bindIndexBuffer(e), r = t instanceof Uint16Array || t instanceof Uint32Array ? t : e.is32Bits ? new Uint32Array(t) : new Uint16Array(t), this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, r, this._gl.DYNAMIC_DRAW), this._resetIndexBufferBinding() }, n.prototype.updateDynamicVertexBuffer = function (e, t, i, r) { this.bindArrayBuffer(e), void 0 === i && (i = 0), void 0 === r ? t instanceof Array ? this._gl.bufferSubData(this._gl.ARRAY_BUFFER, i, new Float32Array(t)) : this._gl.bufferSubData(this._gl.ARRAY_BUFFER, i, t) : t instanceof Array ? this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, new Float32Array(t).subarray(i, i + r)) : (t = t instanceof ArrayBuffer ? new Uint8Array(t, i, r) : new Uint8Array(t.buffer, t.byteOffset + i, r), this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, t)), this._resetVertexBufferBinding() }, n.prototype._resetIndexBufferBinding = function () { this.bindIndexBuffer(null), this._cachedIndexBuffer = null }, n.prototype.createIndexBuffer = function (e, t) { var i, r = this._gl.createBuffer(); if (!r) throw new Error("Unable to create index buffer"); this.bindIndexBuffer(r); var n = !1; if (e instanceof Uint16Array) i = e; else if (this._caps.uintIndices) if (e instanceof Uint32Array) i = e, n = !0; else { for (var o = 0; o < e.length; o++)if (65535 < e[o]) { n = !0; break } i = n ? new Uint32Array(e) : new Uint16Array(e) } else i = new Uint16Array(e); return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, i, t ? this._gl.DYNAMIC_DRAW : this._gl.STATIC_DRAW), this._resetIndexBufferBinding(), r.references = 1, r.is32Bits = n, r }, n.prototype.bindArrayBuffer = function (e) { this._vaoRecordInProgress || this._unbindVertexArrayObject(), this.bindBuffer(e, this._gl.ARRAY_BUFFER) }, n.prototype.bindUniformBuffer = function (e) { this._gl.bindBuffer(this._gl.UNIFORM_BUFFER, e) }, n.prototype.bindUniformBufferBase = function (e, t) { this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER, t, e) }, n.prototype.bindUniformBlock = function (e, t, i) { var r = this._gl.getUniformBlockIndex(e, t); this._gl.uniformBlockBinding(e, r, i) }, n.prototype.bindIndexBuffer = function (e) { this._vaoRecordInProgress || this._unbindVertexArrayObject(), this.bindBuffer(e, this._gl.ELEMENT_ARRAY_BUFFER) }, n.prototype.bindBuffer = function (e, t) { (this._vaoRecordInProgress || this._currentBoundBuffer[t] !== e) && (this._gl.bindBuffer(t, e), this._currentBoundBuffer[t] = e) }, n.prototype.updateArrayBuffer = function (e) { this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, e) }, n.prototype._vertexAttribPointer = function (e, t, i, r, n, o, s) { var a = this._currentBufferPointers[t], l = !1; a.active ? (a.buffer !== e && (a.buffer = e, l = !0), a.size !== i && (a.size = i, l = !0), a.type !== r && (a.type = r, l = !0), a.normalized !== n && (a.normalized = n, l = !0), a.stride !== o && (a.stride = o, l = !0), a.offset !== s && (a.offset = s, l = !0)) : (l = !0, a.active = !0, a.index = t, a.size = i, a.type = r, a.normalized = n, a.stride = o, a.offset = s, a.buffer = e), (l || this._vaoRecordInProgress) && (this.bindArrayBuffer(e), this._gl.vertexAttribPointer(t, i, r, n, o, s)) }, n.prototype._bindIndexBufferWithCache = function (e) { null != e && this._cachedIndexBuffer !== e && (this._cachedIndexBuffer = e, this.bindIndexBuffer(e), this._uintIndicesCurrentlySet = e.is32Bits) }, n.prototype._bindVertexBuffersAttributes = function (e, t) { var i = t.getAttributesNames(); this._vaoRecordInProgress || this._unbindVertexArrayObject(), this.unbindAllAttributes(); for (var r = 0; r < i.length; r++) { var n = t.getAttributeLocation(r); if (0 <= n) { var o = e[i[r]]; if (!o) continue; this._gl.enableVertexAttribArray(n), this._vaoRecordInProgress || (this._vertexAttribArraysEnabled[n] = !0); var s = o.getBuffer(); s && (this._vertexAttribPointer(s, n, o.getSize(), o.type, o.normalized, o.byteStride, o.byteOffset), o.getIsInstanced() && (this._gl.vertexAttribDivisor(n, o.getInstanceDivisor()), this._vaoRecordInProgress || (this._currentInstanceLocations.push(n), this._currentInstanceBuffers.push(s)))) } } }, n.prototype.recordVertexArrayObject = function (e, t, i) { var r = this._gl.createVertexArray(); return this._vaoRecordInProgress = !0, this._gl.bindVertexArray(r), this._mustWipeVertexAttributes = !0, this._bindVertexBuffersAttributes(e, i), this.bindIndexBuffer(t), this._vaoRecordInProgress = !1, this._gl.bindVertexArray(null), r }, n.prototype.bindVertexArrayObject = function (e, t) { this._cachedVertexArrayObject !== e && (this._cachedVertexArrayObject = e, this._gl.bindVertexArray(e), this._cachedVertexBuffers = null, this._cachedIndexBuffer = null, this._uintIndicesCurrentlySet = null != t && t.is32Bits, this._mustWipeVertexAttributes = !0) }, n.prototype.bindBuffersDirectly = function (e, t, i, r, n) { if (this._cachedVertexBuffers !== e || this._cachedEffectForVertexBuffers !== n) { this._cachedVertexBuffers = e; var o = (this._cachedEffectForVertexBuffers = n).getAttributesCount(); this._unbindVertexArrayObject(), this.unbindAllAttributes(); for (var s = 0, a = 0; a < o; a++)if (a < i.length) { var l = n.getAttributeLocation(a); 0 <= l && (this._gl.enableVertexAttribArray(l), this._vertexAttribArraysEnabled[l] = !0, this._vertexAttribPointer(e, l, i[a], this._gl.FLOAT, !1, r, s)), s += 4 * i[a] } } this._bindIndexBufferWithCache(t) }, n.prototype._unbindVertexArrayObject = function () { this._cachedVertexArrayObject && (this._cachedVertexArrayObject = null, this._gl.bindVertexArray(null)) }, n.prototype.bindBuffers = function (e, t, i) { this._cachedVertexBuffers === e && this._cachedEffectForVertexBuffers === i || (this._cachedVertexBuffers = e, this._cachedEffectForVertexBuffers = i, this._bindVertexBuffersAttributes(e, i)), this._bindIndexBufferWithCache(t) }, n.prototype.unbindInstanceAttributes = function () { for (var e, t = 0, i = this._currentInstanceLocations.length; t < i; t++) { var r = this._currentInstanceBuffers[t]; e != r && r.references && (e = r, this.bindArrayBuffer(r)); var n = this._currentInstanceLocations[t]; this._gl.vertexAttribDivisor(n, 0) } this._currentInstanceBuffers.length = 0, this._currentInstanceLocations.length = 0 }, n.prototype.releaseVertexArrayObject = function (e) { this._gl.deleteVertexArray(e) }, n.prototype._releaseBuffer = function (e) { return e.references-- , 0 === e.references && (this._gl.deleteBuffer(e), !0) }, n.prototype.createInstancesBuffer = function (e) { var t = this._gl.createBuffer(); if (!t) throw new Error("Unable to create instance buffer"); return t.capacity = e, this.bindArrayBuffer(t), this._gl.bufferData(this._gl.ARRAY_BUFFER, e, this._gl.DYNAMIC_DRAW), t }, n.prototype.deleteInstancesBuffer = function (e) { this._gl.deleteBuffer(e) }, n.prototype.updateAndBindInstancesBuffer = function (e, t, i) { if (this.bindArrayBuffer(e), t && this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, t), void 0 !== i[0].index) { for (var r = 0, n = 0; n < i.length; n++)r += 4 * (o = i[n]).attributeSize; for (n = 0; n < i.length; n++) { var o = i[n]; this._vertexAttribArraysEnabled[o.index] || (this._gl.enableVertexAttribArray(o.index), this._vertexAttribArraysEnabled[o.index] = !0), this._vertexAttribPointer(e, o.index, o.attributeSize, o.attribyteType || this._gl.FLOAT, o.normalized || !1, r, o.offset), this._gl.vertexAttribDivisor(o.index, 1), this._currentInstanceLocations.push(o.index), this._currentInstanceBuffers.push(e) } } else for (var s = 0; s < 4; s++) { var a = i[s]; this._vertexAttribArraysEnabled[a] || (this._gl.enableVertexAttribArray(a), this._vertexAttribArraysEnabled[a] = !0), this._vertexAttribPointer(e, a, 4, this._gl.FLOAT, !1, 64, 16 * s), this._gl.vertexAttribDivisor(a, 1), this._currentInstanceLocations.push(a), this._currentInstanceBuffers.push(e) } }, n.prototype.applyStates = function () { this._depthCullingState.apply(this._gl), this._stencilState.apply(this._gl), this._alphaState.apply(this._gl) }, n.prototype.draw = function (t, i, r, n) { this.drawElementsType(t ? e.Material.TriangleFillMode : e.Material.WireFrameFillMode, i, r, n) }, n.prototype.drawPointClouds = function (t, i, r) { this.drawArraysType(e.Material.PointFillMode, t, i, r) }, n.prototype.drawUnIndexed = function (t, i, r, n) { this.drawArraysType(t ? e.Material.TriangleFillMode : e.Material.WireFrameFillMode, i, r, n) }, n.prototype.drawElementsType = function (e, t, i, r) { this.applyStates(), this._drawCalls.addCount(1, !1); var n = this._drawMode(e), o = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT, s = this._uintIndicesCurrentlySet ? 4 : 2; r ? this._gl.drawElementsInstanced(n, i, o, t * s, r) : this._gl.drawElements(n, i, o, t * s) }, n.prototype.drawArraysType = function (e, t, i, r) { this.applyStates(), this._drawCalls.addCount(1, !1); var n = this._drawMode(e); r ? this._gl.drawArraysInstanced(n, t, i, r) : this._gl.drawArrays(n, t, i) }, n.prototype._drawMode = function (t) { switch (t) { case e.Material.TriangleFillMode: return this._gl.TRIANGLES; case e.Material.PointFillMode: return this._gl.POINTS; case e.Material.WireFrameFillMode: return this._gl.LINES; case e.Material.PointListDrawMode: return this._gl.POINTS; case e.Material.LineListDrawMode: return this._gl.LINES; case e.Material.LineLoopDrawMode: return this._gl.LINE_LOOP; case e.Material.LineStripDrawMode: return this._gl.LINE_STRIP; case e.Material.TriangleStripDrawMode: return this._gl.TRIANGLE_STRIP; case e.Material.TriangleFanDrawMode: return this._gl.TRIANGLE_FAN; default: return this._gl.TRIANGLES } }, n.prototype._releaseEffect = function (e) { this._compiledEffects[e._key] && (delete this._compiledEffects[e._key], this._deleteProgram(e.getProgram())) }, n.prototype._deleteProgram = function (e) { e && (e.__SPECTOR_rebuildProgram = null, e.transformFeedback && (this.deleteTransformFeedback(e.transformFeedback), e.transformFeedback = null), this._gl.deleteProgram(e)) }, n.prototype.createEffect = function (t, i, r, n, o, s, a, l, c) { var h = (t.vertexElement || t.vertex || t) + "+" + (t.fragmentElement || t.fragment || t) + "@" + (o || i.defines); if (this._compiledEffects[h]) { var u = this._compiledEffects[h]; return a && u.isReady() && a(u), u } var d = new e.Effect(t, i, r, n, this, o, s, a, l, c); return d._key = h, this._compiledEffects[h] = d }, n.prototype._compileShader = function (e, t, i, r) { return this._compileRawShader(r + (i ? i + "\n" : "") + e, t) }, n.prototype._compileRawShader = function (e, t) { var i = this._gl, r = i.createShader("vertex" === t ? i.VERTEX_SHADER : i.FRAGMENT_SHADER); if (!r) throw new Error("Something went wrong while compile the shader."); if (i.shaderSource(r, e), i.compileShader(r), !i.getShaderParameter(r, i.COMPILE_STATUS)) { var n = i.getShaderInfoLog(r); if (n) throw new Error(n) } return r }, n.prototype.createRawShaderProgram = function (e, t, i, r) { void 0 === r && (r = null), i = i || this._gl; var n = this._compileRawShader(e, "vertex"), o = this._compileRawShader(t, "fragment"); return this._createShaderProgram(n, o, i, r) }, n.prototype.createShaderProgram = function (e, t, i, r, n) { void 0 === n && (n = null), r = r || this._gl, this.onBeforeShaderCompilationObservable.notifyObservers(this); var o = 1 < this._webGLVersion ? "#version 300 es\n#define WEBGL2 \n" : "", s = this._compileShader(e, "vertex", i, o), a = this._compileShader(t, "fragment", i, o), l = this._createShaderProgram(s, a, r, n); return this.onAfterShaderCompilationObservable.notifyObservers(this), l }, n.prototype._createShaderProgram = function (e, t, i, r) { void 0 === r && (r = null); var n, o = i.createProgram(); if (!o) throw new Error("Unable to create program"); if (i.attachShader(o, e), i.attachShader(o, t), 1 < this.webGLVersion && r) { var s = this.createTransformFeedback(); this.bindTransformFeedback(s), this.setTranformFeedbackVaryings(o, r), o.transformFeedback = s } if (i.linkProgram(o), 1 < this.webGLVersion && r && this.bindTransformFeedback(null), !i.getProgramParameter(o, i.LINK_STATUS) && (n = i.getProgramInfoLog(o))) throw new Error(n); if (this.validateShaderPrograms && (i.validateProgram(o), !i.getProgramParameter(o, i.VALIDATE_STATUS) && (n = i.getProgramInfoLog(o)))) throw new Error(n); return i.deleteShader(e), i.deleteShader(t), o }, n.prototype.getUniforms = function (e, t) { for (var i = new Array, r = 0; r < t.length; r++)i.push(this._gl.getUniformLocation(e, t[r])); return i }, n.prototype.getAttributes = function (e, t) { for (var i = [], r = 0; r < t.length; r++)try { i.push(this._gl.getAttribLocation(e, t[r])) } catch (e) { i.push(-1) } return i }, n.prototype.enableEffect = function (e) { e && e !== this._currentEffect && (this.bindSamplers(e), (this._currentEffect = e).onBind && e.onBind(e), e._onBindObservable && e._onBindObservable.notifyObservers(e)) }, n.prototype.setIntArray = function (e, t) { e && this._gl.uniform1iv(e, t) }, n.prototype.setIntArray2 = function (e, t) { e && t.length % 2 == 0 && this._gl.uniform2iv(e, t) }, n.prototype.setIntArray3 = function (e, t) { e && t.length % 3 == 0 && this._gl.uniform3iv(e, t) }, n.prototype.setIntArray4 = function (e, t) { e && t.length % 4 == 0 && this._gl.uniform4iv(e, t) }, n.prototype.setFloatArray = function (e, t) { e && this._gl.uniform1fv(e, t) }, n.prototype.setFloatArray2 = function (e, t) { e && t.length % 2 == 0 && this._gl.uniform2fv(e, t) }, n.prototype.setFloatArray3 = function (e, t) { e && t.length % 3 == 0 && this._gl.uniform3fv(e, t) }, n.prototype.setFloatArray4 = function (e, t) { e && t.length % 4 == 0 && this._gl.uniform4fv(e, t) }, n.prototype.setArray = function (e, t) { e && this._gl.uniform1fv(e, t) }, n.prototype.setArray2 = function (e, t) { e && t.length % 2 == 0 && this._gl.uniform2fv(e, t) }, n.prototype.setArray3 = function (e, t) { e && t.length % 3 == 0 && this._gl.uniform3fv(e, t) }, n.prototype.setArray4 = function (e, t) { e && t.length % 4 == 0 && this._gl.uniform4fv(e, t) }, n.prototype.setMatrices = function (e, t) { e && this._gl.uniformMatrix4fv(e, !1, t) }, n.prototype.setMatrix = function (e, t) { e && this._gl.uniformMatrix4fv(e, !1, t.toArray()) }, n.prototype.setMatrix3x3 = function (e, t) { e && this._gl.uniformMatrix3fv(e, !1, t) }, n.prototype.setMatrix2x2 = function (e, t) { e && this._gl.uniformMatrix2fv(e, !1, t) }, n.prototype.setInt = function (e, t) { e && this._gl.uniform1i(e, t) }, n.prototype.setFloat = function (e, t) { e && this._gl.uniform1f(e, t) }, n.prototype.setFloat2 = function (e, t, i) { e && this._gl.uniform2f(e, t, i) }, n.prototype.setFloat3 = function (e, t, i, r) { e && this._gl.uniform3f(e, t, i, r) }, n.prototype.setBool = function (e, t) { e && this._gl.uniform1i(e, t) }, n.prototype.setFloat4 = function (e, t, i, r, n) { e && this._gl.uniform4f(e, t, i, r, n) }, n.prototype.setColor3 = function (e, t) { e && this._gl.uniform3f(e, t.r, t.g, t.b) }, n.prototype.setColor4 = function (e, t, i) { e && this._gl.uniform4f(e, t.r, t.g, t.b, i) }, n.prototype.setDirectColor4 = function (e, t) { e && this._gl.uniform4f(e, t.r, t.g, t.b, t.a) }, n.prototype.setState = function (e, t, i, r) { void 0 === t && (t = 0), void 0 === r && (r = !1), (this._depthCullingState.cull !== e || i) && (this._depthCullingState.cull = e); var n = this.cullBackFaces ? this._gl.BACK : this._gl.FRONT; (this._depthCullingState.cullFace !== n || i) && (this._depthCullingState.cullFace = n), this.setZOffset(t); var o = r ? this._gl.CW : this._gl.CCW; (this._depthCullingState.frontFace !== o || i) && (this._depthCullingState.frontFace = o) }, n.prototype.setZOffset = function (e) { this._depthCullingState.zOffset = e }, n.prototype.getZOffset = function () { return this._depthCullingState.zOffset }, n.prototype.setDepthBuffer = function (e) { this._depthCullingState.depthTest = e }, n.prototype.getDepthWrite = function () { return this._depthCullingState.depthMask }, n.prototype.setDepthWrite = function (e) { this._depthCullingState.depthMask = e }, n.prototype.setColorWrite = function (e) { this._gl.colorMask(e, e, e, e), this._colorWrite = e }, n.prototype.getColorWrite = function () { return this._colorWrite }, n.prototype.setAlphaConstants = function (e, t, i, r) { this._alphaState.setAlphaBlendConstants(e, t, i, r) }, n.prototype.setAlphaMode = function (e, t) { if (void 0 === t && (t = !1), this._alphaMode !== e) { switch (e) { case n.ALPHA_DISABLE: this._alphaState.alphaBlend = !1; break; case n.ALPHA_PREMULTIPLIED: this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0; break; case n.ALPHA_PREMULTIPLIED_PORTERDUFF: this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA), this._alphaState.alphaBlend = !0; break; case n.ALPHA_COMBINE: this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0; break; case n.ALPHA_ONEONE: this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE, this._gl.ZERO, this._gl.ONE), this._alphaState.alphaBlend = !0; break; case n.ALPHA_ADD: this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE, this._gl.ZERO, this._gl.ONE), this._alphaState.alphaBlend = !0; break; case n.ALPHA_SUBTRACT: this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0; break; case n.ALPHA_MULTIPLY: this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR, this._gl.ZERO, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0; break; case n.ALPHA_MAXIMIZED: this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0; break; case n.ALPHA_INTERPOLATE: this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR, this._gl.ONE_MINUS_CONSTANT_COLOR, this._gl.CONSTANT_ALPHA, this._gl.ONE_MINUS_CONSTANT_ALPHA), this._alphaState.alphaBlend = !0; break; case n.ALPHA_SCREENMODE: this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA), this._alphaState.alphaBlend = !0 }t || this.setDepthWrite(e === n.ALPHA_DISABLE), this._alphaMode = e } }, n.prototype.getAlphaMode = function () { return this._alphaMode }, n.prototype.clearInternalTexturesCache = function () { this._internalTexturesCache = [] }, n.prototype.wipeCaches = function (e) { this.preventCacheWipeBetweenFrames && !e || (this._currentEffect = null, this._viewportCached.x = 0, this._viewportCached.y = 0, this._viewportCached.z = 0, this._viewportCached.w = 0, e && (this.resetTextureCache(), this._currentProgram = null, this._stencilState.reset(), this._depthCullingState.reset(), this.setDepthFunctionToLessOrEqual(), this._alphaState.reset(), this._unpackFlipYCached = null), this._resetVertexBufferBinding(), this._cachedIndexBuffer = null, this._cachedEffectForVertexBuffers = null, this._unbindVertexArrayObject(), this.bindIndexBuffer(null)) }, n.prototype.setTextureFormatToUse = function (e) { for (var t = 0, i = this.texturesSupported.length; t < i; t++)for (var r = 0, n = e.length; r < n; r++)if (this._texturesSupported[t] === e[r].toLowerCase()) return this._textureFormatInUse = this._texturesSupported[t]; return this._textureFormatInUse = null }, n.prototype._getSamplingParameters = function (e, t) { var i = this._gl, r = i.NEAREST, o = i.NEAREST; switch (e) { case n.TEXTURE_BILINEAR_SAMPLINGMODE: r = i.LINEAR, o = t ? i.LINEAR_MIPMAP_NEAREST : i.LINEAR; break; case n.TEXTURE_TRILINEAR_SAMPLINGMODE: r = i.LINEAR, o = t ? i.LINEAR_MIPMAP_LINEAR : i.LINEAR; break; case n.TEXTURE_NEAREST_SAMPLINGMODE: r = i.NEAREST, o = t ? i.NEAREST_MIPMAP_LINEAR : i.NEAREST; break; case n.TEXTURE_NEAREST_NEAREST_MIPNEAREST: r = i.NEAREST, o = t ? i.NEAREST_MIPMAP_NEAREST : i.NEAREST; break; case n.TEXTURE_NEAREST_LINEAR_MIPNEAREST: r = i.NEAREST, o = t ? i.LINEAR_MIPMAP_NEAREST : i.LINEAR; break; case n.TEXTURE_NEAREST_LINEAR_MIPLINEAR: r = i.NEAREST, o = t ? i.LINEAR_MIPMAP_LINEAR : i.LINEAR; break; case n.TEXTURE_NEAREST_LINEAR: r = i.NEAREST, o = i.LINEAR; break; case n.TEXTURE_NEAREST_NEAREST: r = i.NEAREST, o = i.NEAREST; break; case n.TEXTURE_LINEAR_NEAREST_MIPNEAREST: r = i.LINEAR, o = t ? i.NEAREST_MIPMAP_NEAREST : i.NEAREST; break; case n.TEXTURE_LINEAR_NEAREST_MIPLINEAR: r = i.LINEAR, o = t ? i.NEAREST_MIPMAP_LINEAR : i.NEAREST; break; case n.TEXTURE_LINEAR_LINEAR: r = i.LINEAR, o = i.LINEAR; break; case n.TEXTURE_LINEAR_NEAREST: r = i.LINEAR, o = i.NEAREST }return { min: o, mag: r } }, n.prototype._partialLoadImg = function (t, i, r, n, o, s) { var a; void 0 === s && (s = null), a = e.Tools.LoadImage(t, function () { r[i] = a, r._internalCount++ , n && n._removePendingData(a), 6 === r._internalCount && o(r) }, function (e, t) { n && n._removePendingData(a), s && s(e, t) }, n ? n.database : null), n && n._addPendingData(a) }, n.prototype._cascadeLoadImgs = function (e, t, i, r, n) { void 0 === n && (n = null); for (var o = [], s = o._internalCount = 0; s < 6; s++)this._partialLoadImg(r[s], s, o, t, i, n) }, n.prototype._createTexture = function () { var e = this._gl.createTexture(); if (!e) throw new Error("Unable to create texture"); return e }, n.prototype.createTexture = function (t, i, r, o, s, a, l, c, h, u, d) { var f = this; void 0 === s && (s = n.TEXTURE_TRILINEAR_SAMPLINGMODE), void 0 === a && (a = null), void 0 === l && (l = null), void 0 === c && (c = null), void 0 === h && (h = null), void 0 === u && (u = null), void 0 === d && (d = null); for (var p = String(t), _ = "data:" === p.substr(0, 5), m = "blob:" === p.substr(0, 5), g = _ && -1 !== p.indexOf(";base64,"), v = h || new e.InternalTexture(this, e.InternalTexture.DATASOURCE_URL), y = p.lastIndexOf("."), b = d || (-1 < y ? p.substring(y).toLowerCase() : ""), T = null, E = 0, x = n._TextureLoaders; E < x.length; E++) { var P = x[E]; if (P.canLoad(b, this._textureFormatInUse, h, g, !!c)) { T = P; break } } T && (p = T.transformUrl(p, this._textureFormatInUse)), o && o._addPendingData(v), v.url = p, v.generateMipMaps = !i, v.samplingMode = s, v.invertY = r, this._doNotHandleContextLost || (v._buffer = c); var A = null; a && !h && (A = v.onLoadedObservable.add(a)), h || this._internalTexturesCache.push(v); var S = function (n, a) { o && o._removePendingData(v); var h = !1; T && T.getFallbackTextureUrl(p, f._textureFormatInUse) && (h = !0, f.createTexture(t, i, r, o, s, null, l, c, v)), h || (A && v.onLoadedObservable.remove(A), e.Tools.UseFallbackTexture && f.createTexture(e.Tools.fallbackTexture, i, r, o, s, null, l, c, v)), l && l(n || "Unknown error", a) }; if (T) { var M = function (e) { T.loadData(e, v, function (e, t, i, n, a) { f._prepareWebGLTexture(v, o, e, t, r, !i, n, function () { return a(), !1 }, s) }) }; c ? M(c) : this._loadFile(p, M, void 0, o ? o.database : void 0, !0, function (e, t) { S("Unable to load " + (e && e.responseURL, t)) }) } else { var R = function (t) { m && !f._doNotHandleContextLost && (v._buffer = t), f._prepareWebGLTexture(v, o, t.width, t.height, r, i, !1, function (i, r, n) { var s = f._gl, a = t.width === i && t.height === r, l = u ? f._getInternalFormat(u) : ".jpg" === b ? s.RGB : s.RGBA; if (a) return s.texImage2D(s.TEXTURE_2D, 0, l, l, s.UNSIGNED_BYTE, t), !1; var c = f._caps.maxTextureSize; if (t.width > c || t.height > c) return f._prepareWorkingCanvas(), f._workingCanvas && f._workingContext && (f._workingCanvas.width = i, f._workingCanvas.height = r, f._workingContext.drawImage(t, 0, 0, t.width, t.height, 0, 0, i, r), s.texImage2D(s.TEXTURE_2D, 0, l, l, s.UNSIGNED_BYTE, f._workingCanvas), v.width = i, v.height = r), !1; var h = new e.InternalTexture(f, e.InternalTexture.DATASOURCE_TEMP); return f._bindTextureDirectly(s.TEXTURE_2D, h, !0), s.texImage2D(s.TEXTURE_2D, 0, l, l, s.UNSIGNED_BYTE, t), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_MAG_FILTER, s.LINEAR), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_MIN_FILTER, s.LINEAR), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_WRAP_S, s.CLAMP_TO_EDGE), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_WRAP_T, s.CLAMP_TO_EDGE), f._rescaleTexture(h, v, o, l, function () { f._releaseTexture(h), f._bindTextureDirectly(s.TEXTURE_2D, v, !0), n() }), !0 }, s) }; !_ || g ? c instanceof HTMLImageElement ? R(c) : e.Tools.LoadImage(p, R, S, o ? o.database : null) : "string" == typeof c || c instanceof ArrayBuffer || c instanceof Blob ? e.Tools.LoadImage(c, R, S, o ? o.database : null) : R(c) } return v }, n.prototype._rescaleTexture = function (t, i, r, o, s) { var a = this, l = this.createRenderTargetTexture({ width: i.width, height: i.height }, { generateMipMaps: !1, type: n.TEXTURETYPE_UNSIGNED_INT, samplingMode: n.TEXTURE_BILINEAR_SAMPLINGMODE, generateDepthBuffer: !1, generateStencilBuffer: !1 }); this._rescalePostProcess || (this._rescalePostProcess = new e.PassPostProcess("rescale", 1, null, n.TEXTURE_BILINEAR_SAMPLINGMODE, this, !1, n.TEXTURETYPE_UNSIGNED_INT)), this._rescalePostProcess.getEffect().executeWhenCompiled(function () { a._rescalePostProcess.onApply = function (e) { e._bindTexture("textureSampler", t) }; var e = r; e || (e = a.scenes[a.scenes.length - 1]), e.postProcessManager.directRender([a._rescalePostProcess], l, !0), a._bindTextureDirectly(a._gl.TEXTURE_2D, i, !0), a._gl.copyTexImage2D(a._gl.TEXTURE_2D, 0, o, 0, 0, i.width, i.height, 0), a.unBindFramebuffer(l), a._releaseTexture(l), s && s() }) }, n.prototype.updateRawTexture = function (e, t, i, r, o, s) { if (void 0 === o && (o = null), void 0 === s && (s = n.TEXTURETYPE_UNSIGNED_INT), e) { var a = this._getRGBABufferInternalSizedFormat(s, i), l = this._getInternalFormat(i), c = this._getWebGLTextureType(s); this._bindTextureDirectly(this._gl.TEXTURE_2D, e, !0), this._unpackFlipY(void 0 === r || !!r), this._doNotHandleContextLost || (e._bufferView = t, e.format = i, e.type = s, e.invertY = r, e._compression = o), e.width % 4 != 0 && this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT, 1), o && t ? this._gl.compressedTexImage2D(this._gl.TEXTURE_2D, 0, this.getCaps().s3tc[o], e.width, e.height, 0, t) : this._gl.texImage2D(this._gl.TEXTURE_2D, 0, a, e.width, e.height, 0, l, c, t), e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._bindTextureDirectly(this._gl.TEXTURE_2D, null), e.isReady = !0 } }, n.prototype.createRawTexture = function (t, i, r, o, s, a, l, c, h) { void 0 === c && (c = null), void 0 === h && (h = n.TEXTURETYPE_UNSIGNED_INT); var u = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_RAW); u.baseWidth = i, u.baseHeight = r, u.width = i, u.height = r, u.format = o, u.generateMipMaps = s, u.samplingMode = l, u.invertY = a, u._compression = c, u.type = h, this._doNotHandleContextLost || (u._bufferView = t), this.updateRawTexture(u, t, o, a, c, h), this._bindTextureDirectly(this._gl.TEXTURE_2D, u, !0); var d = this._getSamplingParameters(l, s); return this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, d.mag), this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, d.min), s && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._bindTextureDirectly(this._gl.TEXTURE_2D, null), this._internalTexturesCache.push(u), u }, n.prototype._unpackFlipY = function (e) { this._unpackFlipYCached !== e && (this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, e ? 1 : 0), this.enableUnpackFlipYCached && (this._unpackFlipYCached = e)) }, n.prototype._getUnpackAlignement = function () { return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT) }, n.prototype.createDynamicTexture = function (t, i, r, n) { var o = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_DYNAMIC); return o.baseWidth = t, o.baseHeight = i, r && (t = this.needPOTTextures ? e.Tools.GetExponentOfTwo(t, this._caps.maxTextureSize) : t, i = this.needPOTTextures ? e.Tools.GetExponentOfTwo(i, this._caps.maxTextureSize) : i), o.width = t, o.height = i, o.isReady = !1, o.generateMipMaps = r, o.samplingMode = n, this.updateTextureSamplingMode(n, o), this._internalTexturesCache.push(o), o }, n.prototype.updateTextureSamplingMode = function (e, t) { var i = this._getSamplingParameters(e, t.generateMipMaps); t.isCube ? (this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_MAG_FILTER, i.mag, t), this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_MIN_FILTER, i.min), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null)) : t.is3D ? (this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_MAG_FILTER, i.mag, t), this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_MIN_FILTER, i.min), this._bindTextureDirectly(this._gl.TEXTURE_3D, null)) : (this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, i.mag, t), this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, i.min), this._bindTextureDirectly(this._gl.TEXTURE_2D, null)), t.samplingMode = e }, n.prototype.updateDynamicTexture = function (e, t, i, r, n) { if (void 0 === r && (r = !1), e) { this._bindTextureDirectly(this._gl.TEXTURE_2D, e, !0), this._unpackFlipY(i), r && this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1); var o = n ? this._getInternalFormat(n) : this._gl.RGBA; this._gl.texImage2D(this._gl.TEXTURE_2D, 0, o, o, this._gl.UNSIGNED_BYTE, t), e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._bindTextureDirectly(this._gl.TEXTURE_2D, null), r && this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0), e.isReady = !0 } }, n.prototype.updateVideoTexture = function (e, t, i) { if (e && !e._isDisabled) { var r = this._bindTextureDirectly(this._gl.TEXTURE_2D, e, !0); this._unpackFlipY(!i); try { if (void 0 === this._videoTextureSupported && (this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, t), 0 !== this._gl.getError() ? this._videoTextureSupported = !1 : this._videoTextureSupported = !0), this._videoTextureSupported) this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, t); else { if (!e._workingCanvas) { e._workingCanvas = document.createElement("canvas"); var n = e._workingCanvas.getContext("2d"); if (!n) throw new Error("Unable to get 2d context"); e._workingContext = n, e._workingCanvas.width = e.width, e._workingCanvas.height = e.height } e._workingContext.drawImage(t, 0, 0, t.videoWidth, t.videoHeight, 0, 0, e.width, e.height), this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, e._workingCanvas) } e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), r || this._bindTextureDirectly(this._gl.TEXTURE_2D, null), e.isReady = !0 } catch (t) { e._isDisabled = !0 } } }, n.prototype.updateTextureComparisonFunction = function (t, i) { if (1 !== this.webGLVersion) { var r = this._gl; t.isCube ? (this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, t, !0), 0 === i ? (r.texParameteri(r.TEXTURE_CUBE_MAP, r.TEXTURE_COMPARE_FUNC, n.LEQUAL), r.texParameteri(r.TEXTURE_CUBE_MAP, r.TEXTURE_COMPARE_MODE, r.NONE)) : (r.texParameteri(r.TEXTURE_CUBE_MAP, r.TEXTURE_COMPARE_FUNC, i), r.texParameteri(r.TEXTURE_CUBE_MAP, r.TEXTURE_COMPARE_MODE, r.COMPARE_REF_TO_TEXTURE)), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null)) : (this._bindTextureDirectly(this._gl.TEXTURE_2D, t, !0), 0 === i ? (r.texParameteri(r.TEXTURE_2D, r.TEXTURE_COMPARE_FUNC, n.LEQUAL), r.texParameteri(r.TEXTURE_2D, r.TEXTURE_COMPARE_MODE, r.NONE)) : (r.texParameteri(r.TEXTURE_2D, r.TEXTURE_COMPARE_FUNC, i), r.texParameteri(r.TEXTURE_2D, r.TEXTURE_COMPARE_MODE, r.COMPARE_REF_TO_TEXTURE)), this._bindTextureDirectly(this._gl.TEXTURE_2D, null)), t._comparisonFunction = i } else e.Tools.Error("WebGL 1 does not support texture comparison.") }, n.prototype._setupDepthStencilTexture = function (e, t, i, r, o) { var s = t.width || t, a = t.height || t; e.baseWidth = s, e.baseHeight = a, e.width = s, e.height = a, e.isReady = !0, e.samples = 1, e.generateMipMaps = !1, e._generateDepthBuffer = !0, e._generateStencilBuffer = i, e.samplingMode = r ? n.TEXTURE_BILINEAR_SAMPLINGMODE : n.TEXTURE_NEAREST_SAMPLINGMODE, e.type = n.TEXTURETYPE_UNSIGNED_INT, e._comparisonFunction = o; var l = this._gl, c = e.isCube ? l.TEXTURE_CUBE_MAP : l.TEXTURE_2D, h = this._getSamplingParameters(e.samplingMode, !1); l.texParameteri(c, l.TEXTURE_MAG_FILTER, h.mag), l.texParameteri(c, l.TEXTURE_MIN_FILTER, h.min), l.texParameteri(c, l.TEXTURE_WRAP_S, l.CLAMP_TO_EDGE), l.texParameteri(c, l.TEXTURE_WRAP_T, l.CLAMP_TO_EDGE), 0 === o ? (l.texParameteri(c, l.TEXTURE_COMPARE_FUNC, n.LEQUAL), l.texParameteri(c, l.TEXTURE_COMPARE_MODE, l.NONE)) : (l.texParameteri(c, l.TEXTURE_COMPARE_FUNC, o), l.texParameteri(c, l.TEXTURE_COMPARE_MODE, l.COMPARE_REF_TO_TEXTURE)) }, n.prototype.createDepthStencilTexture = function (e, t) { if (t.isCube) { var i = e.width || e; return this._createDepthStencilCubeTexture(i, t) } return this._createDepthStencilTexture(e, t) }, n.prototype._createDepthStencilTexture = function (t, i) { var r = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_DEPTHTEXTURE); if (!this._caps.depthTextureExtension) return e.Tools.Error("Depth texture is not supported by your browser or hardware."), r; var n = tl({ bilinearFiltering: !1, comparisonFunction: 0, generateStencil: !1 }, i), o = this._gl; return this._bindTextureDirectly(o.TEXTURE_2D, r, !0), this._setupDepthStencilTexture(r, t, n.generateStencil, n.bilinearFiltering, n.comparisonFunction), 1 < this.webGLVersion ? n.generateStencil ? o.texImage2D(o.TEXTURE_2D, 0, o.DEPTH24_STENCIL8, r.width, r.height, 0, o.DEPTH_STENCIL, o.UNSIGNED_INT_24_8, null) : o.texImage2D(o.TEXTURE_2D, 0, o.DEPTH_COMPONENT24, r.width, r.height, 0, o.DEPTH_COMPONENT, o.UNSIGNED_INT, null) : n.generateStencil ? o.texImage2D(o.TEXTURE_2D, 0, o.DEPTH_STENCIL, r.width, r.height, 0, o.DEPTH_STENCIL, o.UNSIGNED_INT_24_8, null) : o.texImage2D(o.TEXTURE_2D, 0, o.DEPTH_COMPONENT, r.width, r.height, 0, o.DEPTH_COMPONENT, o.UNSIGNED_INT, null), this._bindTextureDirectly(o.TEXTURE_2D, null), r }, n.prototype._createDepthStencilCubeTexture = function (t, i) { var r = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_UNKNOWN); if (r.isCube = !0, 1 === this.webGLVersion) return e.Tools.Error("Depth cube texture is not supported by WebGL 1."), r; var n = tl({ bilinearFiltering: !1, comparisonFunction: 0, generateStencil: !1 }, i), o = this._gl; this._bindTextureDirectly(o.TEXTURE_CUBE_MAP, r, !0), this._setupDepthStencilTexture(r, t, n.generateStencil, n.bilinearFiltering, n.comparisonFunction); for (var s = 0; s < 6; s++)n.generateStencil ? o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X + s, 0, o.DEPTH24_STENCIL8, t, t, 0, o.DEPTH_STENCIL, o.UNSIGNED_INT_24_8, null) : o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X + s, 0, o.DEPTH_COMPONENT24, t, t, 0, o.DEPTH_COMPONENT, o.UNSIGNED_INT, null); return this._bindTextureDirectly(o.TEXTURE_CUBE_MAP, null), r }, n.prototype.setFrameBufferDepthStencilTexture = function (e) { var t = e.getInternalTexture(); if (t && t._framebuffer && e.depthStencilTexture) { var i = this._gl, r = e.depthStencilTexture; this.bindUnboundFramebuffer(t._framebuffer), r.isCube ? r._generateStencilBuffer ? i.framebufferTexture2D(i.FRAMEBUFFER, i.DEPTH_STENCIL_ATTACHMENT, i.TEXTURE_CUBE_MAP_POSITIVE_X, r._webGLTexture, 0) : i.framebufferTexture2D(i.FRAMEBUFFER, i.DEPTH_ATTACHMENT, i.TEXTURE_CUBE_MAP_POSITIVE_X, r._webGLTexture, 0) : r._generateStencilBuffer ? i.framebufferTexture2D(i.FRAMEBUFFER, i.DEPTH_STENCIL_ATTACHMENT, i.TEXTURE_2D, r._webGLTexture, 0) : i.framebufferTexture2D(i.FRAMEBUFFER, i.DEPTH_ATTACHMENT, i.TEXTURE_2D, r._webGLTexture, 0), this.bindUnboundFramebuffer(null) } }, n.prototype.createRenderTargetTexture = function (t, r) { var o = new i; void 0 !== r && "object" == typeof r ? (o.generateMipMaps = r.generateMipMaps, o.generateDepthBuffer = void 0 === r.generateDepthBuffer || r.generateDepthBuffer, o.generateStencilBuffer = o.generateDepthBuffer && r.generateStencilBuffer, o.type = void 0 === r.type ? n.TEXTURETYPE_UNSIGNED_INT : r.type, o.samplingMode = void 0 === r.samplingMode ? n.TEXTURE_TRILINEAR_SAMPLINGMODE : r.samplingMode, o.format = void 0 === r.format ? n.TEXTUREFORMAT_RGBA : r.format) : (o.generateMipMaps = r, o.generateDepthBuffer = !0, o.generateStencilBuffer = !1, o.type = n.TEXTURETYPE_UNSIGNED_INT, o.samplingMode = n.TEXTURE_TRILINEAR_SAMPLINGMODE, o.format = n.TEXTUREFORMAT_RGBA), (o.type !== n.TEXTURETYPE_FLOAT || this._caps.textureFloatLinearFiltering) && (o.type !== n.TEXTURETYPE_HALF_FLOAT || this._caps.textureHalfFloatLinearFiltering) || (o.samplingMode = n.TEXTURE_NEAREST_SAMPLINGMODE); var s = this._gl, a = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_RENDERTARGET); this._bindTextureDirectly(s.TEXTURE_2D, a, !0); var l = t.width || t, c = t.height || t, h = this._getSamplingParameters(o.samplingMode, !!o.generateMipMaps); o.type !== n.TEXTURETYPE_FLOAT || this._caps.textureFloat || (o.type = n.TEXTURETYPE_UNSIGNED_INT, e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_MAG_FILTER, h.mag), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_MIN_FILTER, h.min), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_WRAP_S, s.CLAMP_TO_EDGE), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_WRAP_T, s.CLAMP_TO_EDGE), s.texImage2D(s.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(o.type, o.format), l, c, 0, this._getInternalFormat(o.format), this._getWebGLTextureType(o.type), null); var u = this._currentFramebuffer, d = s.createFramebuffer(); return this.bindUnboundFramebuffer(d), s.framebufferTexture2D(s.FRAMEBUFFER, s.COLOR_ATTACHMENT0, s.TEXTURE_2D, a._webGLTexture, 0), a._depthStencilBuffer = this._setupFramebufferDepthAttachments(!!o.generateStencilBuffer, o.generateDepthBuffer, l, c), o.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._bindTextureDirectly(s.TEXTURE_2D, null), s.bindRenderbuffer(s.RENDERBUFFER, null), this.bindUnboundFramebuffer(u), a._framebuffer = d, a.baseWidth = l, a.baseHeight = c, a.width = l, a.height = c, a.isReady = !0, a.samples = 1, a.generateMipMaps = !!o.generateMipMaps, a.samplingMode = o.samplingMode, a.type = o.type, a.format = o.format, a._generateDepthBuffer = o.generateDepthBuffer, a._generateStencilBuffer = !!o.generateStencilBuffer, this._internalTexturesCache.push(a), a }, n.prototype.createMultipleRenderTarget = function (t, i) { var r = !1, o = !0, s = !1, a = !1, l = 1, c = n.TEXTURETYPE_UNSIGNED_INT, h = n.TEXTURE_TRILINEAR_SAMPLINGMODE, u = new Array, d = new Array; void 0 !== i && (r = void 0 !== i.generateMipMaps && i.generateMipMaps, o = void 0 === i.generateDepthBuffer || i.generateDepthBuffer, s = void 0 !== i.generateStencilBuffer && i.generateStencilBuffer, a = void 0 !== i.generateDepthTexture && i.generateDepthTexture, l = i.textureCount || 1, i.types && (u = i.types), i.samplingModes && (d = i.samplingModes)); var f = this._gl, p = f.createFramebuffer(); this.bindUnboundFramebuffer(p); for (var _ = t.width || t, m = t.height || t, g = [], v = [], y = this._setupFramebufferDepthAttachments(s, o, _, m), b = 0; b < l; b++) { var T = d[b] || h, E = u[b] || c; (E !== n.TEXTURETYPE_FLOAT || this._caps.textureFloatLinearFiltering) && (E !== n.TEXTURETYPE_HALF_FLOAT || this._caps.textureHalfFloatLinearFiltering) || (T = n.TEXTURE_NEAREST_SAMPLINGMODE); var x = this._getSamplingParameters(T, r); E !== n.TEXTURETYPE_FLOAT || this._caps.textureFloat || (E = n.TEXTURETYPE_UNSIGNED_INT, e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")); var P = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_MULTIRENDERTARGET), A = f[1 < this.webGLVersion ? "COLOR_ATTACHMENT" + b : "COLOR_ATTACHMENT" + b + "_WEBGL"]; g.push(P), v.push(A), f.activeTexture(f["TEXTURE" + b]), f.bindTexture(f.TEXTURE_2D, P._webGLTexture), f.texParameteri(f.TEXTURE_2D, f.TEXTURE_MAG_FILTER, x.mag), f.texParameteri(f.TEXTURE_2D, f.TEXTURE_MIN_FILTER, x.min), f.texParameteri(f.TEXTURE_2D, f.TEXTURE_WRAP_S, f.CLAMP_TO_EDGE), f.texParameteri(f.TEXTURE_2D, f.TEXTURE_WRAP_T, f.CLAMP_TO_EDGE), f.texImage2D(f.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(E), _, m, 0, f.RGBA, this._getWebGLTextureType(E), null), f.framebufferTexture2D(f.DRAW_FRAMEBUFFER, A, f.TEXTURE_2D, P._webGLTexture, 0), r && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._bindTextureDirectly(f.TEXTURE_2D, null), P._framebuffer = p, P._depthStencilBuffer = y, P.baseWidth = _, P.baseHeight = m, P.width = _, P.height = m, P.isReady = !0, P.samples = 1, P.generateMipMaps = r, P.samplingMode = T, P.type = E, P._generateDepthBuffer = o, P._generateStencilBuffer = s, P._attachments = v, this._internalTexturesCache.push(P) } if (a && this._caps.depthTextureExtension) { var S = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_MULTIRENDERTARGET); f.activeTexture(f.TEXTURE0), f.bindTexture(f.TEXTURE_2D, S._webGLTexture), f.texParameteri(f.TEXTURE_2D, f.TEXTURE_MAG_FILTER, f.NEAREST), f.texParameteri(f.TEXTURE_2D, f.TEXTURE_MIN_FILTER, f.NEAREST), f.texParameteri(f.TEXTURE_2D, f.TEXTURE_WRAP_S, f.CLAMP_TO_EDGE), f.texParameteri(f.TEXTURE_2D, f.TEXTURE_WRAP_T, f.CLAMP_TO_EDGE), f.texImage2D(f.TEXTURE_2D, 0, this.webGLVersion < 2 ? f.DEPTH_COMPONENT : f.DEPTH_COMPONENT16, _, m, 0, f.DEPTH_COMPONENT, f.UNSIGNED_SHORT, null), f.framebufferTexture2D(f.FRAMEBUFFER, f.DEPTH_ATTACHMENT, f.TEXTURE_2D, S._webGLTexture, 0), S._framebuffer = p, S.baseWidth = _, S.baseHeight = m, S.width = _, S.height = m, S.isReady = !0, S.samples = 1, S.generateMipMaps = r, S.samplingMode = f.NEAREST, S._generateDepthBuffer = o, S._generateStencilBuffer = s, g.push(S), this._internalTexturesCache.push(S) } return f.drawBuffers(v), f.bindRenderbuffer(f.RENDERBUFFER, null), this.bindUnboundFramebuffer(null), this.resetTextureCache(), g }, n.prototype._setupFramebufferDepthAttachments = function (e, t, i, r, n) { void 0 === n && (n = 1); var o = null, s = this._gl; return e ? (o = s.createRenderbuffer(), s.bindRenderbuffer(s.RENDERBUFFER, o), 1 < n ? s.renderbufferStorageMultisample(s.RENDERBUFFER, n, s.DEPTH24_STENCIL8, i, r) : s.renderbufferStorage(s.RENDERBUFFER, s.DEPTH_STENCIL, i, r), s.framebufferRenderbuffer(s.FRAMEBUFFER, s.DEPTH_STENCIL_ATTACHMENT, s.RENDERBUFFER, o)) : t && (o = s.createRenderbuffer(), s.bindRenderbuffer(s.RENDERBUFFER, o), 1 < n ? s.renderbufferStorageMultisample(s.RENDERBUFFER, n, s.DEPTH_COMPONENT16, i, r) : s.renderbufferStorage(s.RENDERBUFFER, s.DEPTH_COMPONENT16, i, r), s.framebufferRenderbuffer(s.FRAMEBUFFER, s.DEPTH_ATTACHMENT, s.RENDERBUFFER, o)), o }, n.prototype.updateRenderTargetTextureSampleCount = function (e, t) { if (this.webGLVersion < 2 || !e) return 1; if (e.samples === t) return t; var i = this._gl; if (t = Math.min(t, i.getParameter(i.MAX_SAMPLES)), e._depthStencilBuffer && (i.deleteRenderbuffer(e._depthStencilBuffer), e._depthStencilBuffer = null), e._MSAAFramebuffer && (i.deleteFramebuffer(e._MSAAFramebuffer), e._MSAAFramebuffer = null), e._MSAARenderBuffer && (i.deleteRenderbuffer(e._MSAARenderBuffer), e._MSAARenderBuffer = null), 1 < t) { var r = i.createFramebuffer(); if (!r) throw new Error("Unable to create multi sampled framebuffer"); e._MSAAFramebuffer = r, this.bindUnboundFramebuffer(e._MSAAFramebuffer); var n = i.createRenderbuffer(); if (!n) throw new Error("Unable to create multi sampled framebuffer"); i.bindRenderbuffer(i.RENDERBUFFER, n), i.renderbufferStorageMultisample(i.RENDERBUFFER, t, this._getRGBAMultiSampleBufferFormat(e.type), e.width, e.height), i.framebufferRenderbuffer(i.FRAMEBUFFER, i.COLOR_ATTACHMENT0, i.RENDERBUFFER, n), e._MSAARenderBuffer = n } else this.bindUnboundFramebuffer(e._framebuffer); return e.samples = t, e._depthStencilBuffer = this._setupFramebufferDepthAttachments(e._generateStencilBuffer, e._generateDepthBuffer, e.width, e.height, t), i.bindRenderbuffer(i.RENDERBUFFER, null), this.bindUnboundFramebuffer(null), t }, n.prototype.updateMultipleRenderTargetTextureSampleCount = function (e, t) { if (this.webGLVersion < 2 || !e || 0 == e.length) return 1; if (e[0].samples === t) return t; var i = this._gl; t = Math.min(t, i.getParameter(i.MAX_SAMPLES)), e[0]._depthStencilBuffer && (i.deleteRenderbuffer(e[0]._depthStencilBuffer), e[0]._depthStencilBuffer = null), e[0]._MSAAFramebuffer && (i.deleteFramebuffer(e[0]._MSAAFramebuffer), e[0]._MSAAFramebuffer = null); for (var r = 0; r < e.length; r++)e[r]._MSAARenderBuffer && (i.deleteRenderbuffer(e[r]._MSAARenderBuffer), e[r]._MSAARenderBuffer = null); if (1 < t) { var n = i.createFramebuffer(); if (!n) throw new Error("Unable to create multi sampled framebuffer"); this.bindUnboundFramebuffer(n); var o = this._setupFramebufferDepthAttachments(e[0]._generateStencilBuffer, e[0]._generateDepthBuffer, e[0].width, e[0].height, t), s = []; for (r = 0; r < e.length; r++) { var a = e[r], l = i[1 < this.webGLVersion ? "COLOR_ATTACHMENT" + r : "COLOR_ATTACHMENT" + r + "_WEBGL"], c = i.createRenderbuffer(); if (!c) throw new Error("Unable to create multi sampled framebuffer"); i.bindRenderbuffer(i.RENDERBUFFER, c), i.renderbufferStorageMultisample(i.RENDERBUFFER, t, this._getRGBAMultiSampleBufferFormat(a.type), a.width, a.height), i.framebufferRenderbuffer(i.FRAMEBUFFER, l, i.RENDERBUFFER, c), a._MSAAFramebuffer = n, a._MSAARenderBuffer = c, a.samples = t, a._depthStencilBuffer = o, i.bindRenderbuffer(i.RENDERBUFFER, null), s.push(l) } i.drawBuffers(s) } else this.bindUnboundFramebuffer(e[0]._framebuffer); return this.bindUnboundFramebuffer(null), t }, n.prototype._uploadCompressedDataToTextureDirectly = function (e, t, i, r, n, o, s) { void 0 === o && (o = 0), void 0 === s && (s = 0); var a = this._gl, l = a.TEXTURE_2D; e.isCube && (l = a.TEXTURE_CUBE_MAP_POSITIVE_X + o), this._gl.compressedTexImage2D(l, s, t, i, r, 0, n) }, n.prototype._uploadDataToTextureDirectly = function (t, i, r, n) { void 0 === r && (r = 0), void 0 === n && (n = 0); var o = this._gl, s = this._getWebGLTextureType(t.type), a = this._getInternalFormat(t.format), l = this._getRGBABufferInternalSizedFormat(t.type, a); this._unpackFlipY(t.invertY); var c = o.TEXTURE_2D; t.isCube && (c = o.TEXTURE_CUBE_MAP_POSITIVE_X + r); var h = Math.round(e.Scalar.Log2(t.width)), u = Math.round(e.Scalar.Log2(t.height)), d = Math.pow(2, Math.max(h - n, 0)), f = Math.pow(2, Math.max(u - n, 0)); o.texImage2D(c, n, l, d, f, 0, a, s, i) }, n.prototype._uploadArrayBufferViewToTexture = function (e, t, i, r) { void 0 === i && (i = 0), void 0 === r && (r = 0); var n = this._gl, o = e.isCube ? n.TEXTURE_CUBE_MAP : n.TEXTURE_2D; this._bindTextureDirectly(o, e, !0), this._uploadDataToTextureDirectly(e, t, i, r), this._bindTextureDirectly(o, null, !0) }, n.prototype._uploadImageToTexture = function (e, t, i, r) { void 0 === i && (i = 0), void 0 === r && (r = 0); var n = this._gl, o = this._getWebGLTextureType(e.type), s = this._getInternalFormat(e.format), a = this._getRGBABufferInternalSizedFormat(e.type, s), l = e.isCube ? n.TEXTURE_CUBE_MAP : n.TEXTURE_2D; this._bindTextureDirectly(l, e, !0), this._unpackFlipY(e.invertY); var c = n.TEXTURE_2D; e.isCube && (c = n.TEXTURE_CUBE_MAP_POSITIVE_X + i), n.texImage2D(c, r, a, s, o, t), this._bindTextureDirectly(l, null, !0) }, n.prototype.createRenderTargetCubeTexture = function (t, i) { var r = tl({ generateMipMaps: !0, generateDepthBuffer: !0, generateStencilBuffer: !1, type: n.TEXTURETYPE_UNSIGNED_INT, samplingMode: n.TEXTURE_TRILINEAR_SAMPLINGMODE, format: n.TEXTUREFORMAT_RGBA }, i); r.generateStencilBuffer = r.generateDepthBuffer && r.generateStencilBuffer, (r.type !== n.TEXTURETYPE_FLOAT || this._caps.textureFloatLinearFiltering) && (r.type !== n.TEXTURETYPE_HALF_FLOAT || this._caps.textureHalfFloatLinearFiltering) || (r.samplingMode = n.TEXTURE_NEAREST_SAMPLINGMODE); var o = this._gl, s = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_RENDERTARGET); this._bindTextureDirectly(o.TEXTURE_CUBE_MAP, s, !0); var a = this._getSamplingParameters(r.samplingMode, r.generateMipMaps); r.type !== n.TEXTURETYPE_FLOAT || this._caps.textureFloat || (r.type = n.TEXTURETYPE_UNSIGNED_INT, e.Tools.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")), o.texParameteri(o.TEXTURE_CUBE_MAP, o.TEXTURE_MAG_FILTER, a.mag), o.texParameteri(o.TEXTURE_CUBE_MAP, o.TEXTURE_MIN_FILTER, a.min), o.texParameteri(o.TEXTURE_CUBE_MAP, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_CUBE_MAP, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE); for (var l = 0; l < 6; l++)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X + l, 0, this._getRGBABufferInternalSizedFormat(r.type, r.format), t, t, 0, this._getInternalFormat(r.format), this._getWebGLTextureType(r.type), null); var c = o.createFramebuffer(); return this.bindUnboundFramebuffer(c), s._depthStencilBuffer = this._setupFramebufferDepthAttachments(r.generateStencilBuffer, r.generateDepthBuffer, t, t), r.generateMipMaps && o.generateMipmap(o.TEXTURE_CUBE_MAP), this._bindTextureDirectly(o.TEXTURE_CUBE_MAP, null), o.bindRenderbuffer(o.RENDERBUFFER, null), this.bindUnboundFramebuffer(null), s._framebuffer = c, s.width = t, s.height = t, s.isReady = !0, s.isCube = !0, s.samples = 1, s.generateMipMaps = r.generateMipMaps, s.samplingMode = r.samplingMode, s.type = r.type, s.format = r.format, s._generateDepthBuffer = r.generateDepthBuffer, s._generateStencilBuffer = r.generateStencilBuffer, this._internalTexturesCache.push(s), s }, n.prototype.createPrefilteredCubeTexture = function (t, i, r, n, o, s, a, l, c) { var h = this; return void 0 === o && (o = null), void 0 === s && (s = null), void 0 === l && (l = null), void 0 === c && (c = !0), this.createCubeTexture(t, i, null, !1, function (t) { if (t) { var s = t.texture; if (c ? t.info.sphericalPolynomial && (s._sphericalPolynomial = t.info.sphericalPolynomial) : s._sphericalPolynomial = new e.SphericalPolynomial, s._dataSource = e.InternalTexture.DATASOURCE_CUBEPREFILTERED, h._caps.textureLOD) o && o(s); else { var a = h._gl, l = t.width; if (l) { for (var u = [], d = 0; d < 3; d++) { var f = 1 - d / 2, p = n, _ = e.Scalar.Log2(l) * r + n, m = p + (_ - p) * f, g = Math.round(Math.min(Math.max(m, 0), _)), v = new e.InternalTexture(h, e.InternalTexture.DATASOURCE_TEMP); if (v.type = s.type, v.format = s.format, v.width = Math.pow(2, Math.max(e.Scalar.Log2(l) - g, 0)), v.height = v.width, v.isCube = !0, h._bindTextureDirectly(a.TEXTURE_CUBE_MAP, v, !0), a.texParameteri(a.TEXTURE_CUBE_MAP, a.TEXTURE_MAG_FILTER, a.LINEAR), a.texParameteri(a.TEXTURE_CUBE_MAP, a.TEXTURE_MIN_FILTER, a.LINEAR), a.texParameteri(a.TEXTURE_CUBE_MAP, a.TEXTURE_WRAP_S, a.CLAMP_TO_EDGE), a.texParameteri(a.TEXTURE_CUBE_MAP, a.TEXTURE_WRAP_T, a.CLAMP_TO_EDGE), t.isDDS) { var y = t.info, b = t.data; h._unpackFlipY(y.isCompressed), e.DDSTools.UploadDDSLevels(h, v, b, y, !0, 6, g) } else e.Tools.Warn("DDS is the only prefiltered cube map supported so far."); h._bindTextureDirectly(a.TEXTURE_CUBE_MAP, null); var T = new e.BaseTexture(i); T.isCube = !0, (T._texture = v).isReady = !0, u.push(T) } s._lodTextureHigh = u[2], s._lodTextureMid = u[1], s._lodTextureLow = u[0], o && o(s) } } } else o && o(null) }, s, a, l, c, r, n) }, n.prototype.createCubeTexture = function (t, i, r, o, s, a, l, c, h, u, d, f) { var p = this; void 0 === s && (s = null), void 0 === a && (a = null), void 0 === c && (c = null), void 0 === h && (h = !1), void 0 === u && (u = 0), void 0 === d && (d = 0), void 0 === f && (f = null); var _ = this._gl, m = f || new e.InternalTexture(this, e.InternalTexture.DATASOURCE_CUBE); m.isCube = !0, m.url = t, m.generateMipMaps = !o, m._lodGenerationScale = u, m._lodGenerationOffset = d, this._doNotHandleContextLost || (m._extension = c, m._files = r); for (var g = t.lastIndexOf("."), v = c || (-1 < g ? t.substring(g).toLowerCase() : ""), y = null, b = 0, T = n._TextureLoaders; b < T.length; b++) { var E = T[b]; if (E.canLoad(v, this._textureFormatInUse, f, !1, !1)) { y = E; break } } if (y) { t = y.transformUrl(t, this._textureFormatInUse); var x = function (e) { p._bindTextureDirectly(_.TEXTURE_CUBE_MAP, m, !0), y.loadCubeData(e, m, h, s, a) }; r && 6 === r.length ? y.supportCascades ? this._cascadeLoadFiles(i, x, r, a) : a && a("Textures type does not support cascades.") : this._loadFile(t, x, void 0, void 0, !0, function (e, n) { if (y) { var c = y.getFallbackTextureUrl(t, p._textureFormatInUse); c && p.createCubeTexture(c, i, r, o, s, a, l, v, h, u, d, m) } a && e && a(e.status + " " + e.statusText, n) }) } else { if (!r) throw new Error("Cannot load cubemap because files were not defined"); this._cascadeLoadImgs(t, i, function (t) { var i = p.needPOTTextures ? e.Tools.GetExponentOfTwo(t[0].width, p._caps.maxCubemapTextureSize) : t[0].width, r = i; if (p._prepareWorkingCanvas(), p._workingCanvas && p._workingContext) { p._workingCanvas.width = i, p._workingCanvas.height = r; var n = [_.TEXTURE_CUBE_MAP_POSITIVE_X, _.TEXTURE_CUBE_MAP_POSITIVE_Y, _.TEXTURE_CUBE_MAP_POSITIVE_Z, _.TEXTURE_CUBE_MAP_NEGATIVE_X, _.TEXTURE_CUBE_MAP_NEGATIVE_Y, _.TEXTURE_CUBE_MAP_NEGATIVE_Z]; p._bindTextureDirectly(_.TEXTURE_CUBE_MAP, m, !0), p._unpackFlipY(!1); for (var a = l ? p._getInternalFormat(l) : p._gl.RGBA, c = 0; c < n.length; c++)p._workingContext.drawImage(t[c], 0, 0, t[c].width, t[c].height, 0, 0, i, r), _.texImage2D(n[c], 0, a, a, _.UNSIGNED_BYTE, p._workingCanvas); o || _.generateMipmap(_.TEXTURE_CUBE_MAP), p._setCubeMapTextureParams(!o), m.width = i, m.height = r, m.isReady = !0, l && (m.format = l), m.onLoadedObservable.notifyObservers(m), m.onLoadedObservable.clear(), s && s() } }, r, a) } return this._internalTexturesCache.push(m), m }, n.prototype._setCubeMapTextureParams = function (e) { var t = this._gl; t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_MAG_FILTER, t.LINEAR), t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_MIN_FILTER, e ? t.LINEAR_MIPMAP_LINEAR : t.LINEAR), t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE), t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE), this._bindTextureDirectly(t.TEXTURE_CUBE_MAP, null) }, n.prototype.updateRawCubeTexture = function (t, i, r, n, o, s, a) { void 0 === s && (s = null), void 0 === a && (a = 0), t._bufferViewArray = i, t.format = r, t.type = n, t.invertY = o, t._compression = s; var l = this._gl, c = this._getWebGLTextureType(n), h = this._getInternalFormat(r), u = this._getRGBABufferInternalSizedFormat(n), d = !1; h === l.RGB && (h = l.RGBA, d = !0), this._bindTextureDirectly(l.TEXTURE_CUBE_MAP, t, !0), this._unpackFlipY(void 0 === o || !!o), t.width % 4 != 0 && l.pixelStorei(l.UNPACK_ALIGNMENT, 1); for (var f = 0; f < 6; f++) { var p = i[f]; s ? l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X + f, a, this.getCaps().s3tc[s], t.width, t.height, 0, p) : (d && (p = this._convertRGBtoRGBATextureData(p, t.width, t.height, n)), l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X + f, a, u, t.width, t.height, 0, h, c, p)) } (!this.needPOTTextures || e.Tools.IsExponentOfTwo(t.width) && e.Tools.IsExponentOfTwo(t.height)) && t.generateMipMaps && 0 === a && this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null), t.isReady = !0 }, n.prototype.createRawCubeTexture = function (t, i, r, o, s, a, l, c) { void 0 === c && (c = null); var h = this._gl, u = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_CUBERAW); u.isCube = !0, u.format = r, u.type = o, this._doNotHandleContextLost || (u._bufferViewArray = t); var d = this._getWebGLTextureType(o), f = this._getInternalFormat(r); f === h.RGB && (f = h.RGBA), d !== h.FLOAT || this._caps.textureFloatLinearFiltering ? d !== this._gl.HALF_FLOAT_OES || this._caps.textureHalfFloatLinearFiltering ? d !== h.FLOAT || this._caps.textureFloatRender ? d !== h.HALF_FLOAT || this._caps.colorBufferFloat || (s = !1, e.Tools.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")) : (s = !1, e.Tools.Warn("Render to float textures is not supported. Mipmap generation forced to false.")) : (s = !1, l = n.TEXTURE_NEAREST_SAMPLINGMODE, e.Tools.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")) : (s = !1, l = n.TEXTURE_NEAREST_SAMPLINGMODE, e.Tools.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")); var p = i, _ = p; u.width = p, u.height = _, !this.needPOTTextures || e.Tools.IsExponentOfTwo(u.width) && e.Tools.IsExponentOfTwo(u.height) || (s = !1), t && this.updateRawCubeTexture(u, t, r, o, a, c), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, u, !0), t && s && this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP); var m = this._getSamplingParameters(l, s); return h.texParameteri(h.TEXTURE_CUBE_MAP, h.TEXTURE_MAG_FILTER, m.mag), h.texParameteri(h.TEXTURE_CUBE_MAP, h.TEXTURE_MIN_FILTER, m.min), h.texParameteri(h.TEXTURE_CUBE_MAP, h.TEXTURE_WRAP_S, h.CLAMP_TO_EDGE), h.texParameteri(h.TEXTURE_CUBE_MAP, h.TEXTURE_WRAP_T, h.CLAMP_TO_EDGE), this._bindTextureDirectly(h.TEXTURE_CUBE_MAP, null), u.generateMipMaps = s, u }, n.prototype.createRawCubeTextureFromUrl = function (e, t, i, r, o, s, a, l, c, h, u, d) { var f = this; void 0 === c && (c = null), void 0 === h && (h = null), void 0 === u && (u = n.TEXTURE_TRILINEAR_SAMPLINGMODE), void 0 === d && (d = !1); var p = this._gl, _ = this.createRawCubeTexture(null, i, r, o, !s, d, u); return t._addPendingData(_), _.url = e, this._internalTexturesCache.push(_), this._loadFile(e, function (e) { !function (e) { var i = _.width, n = a(e); if (n) { if (l) { var s = f._getWebGLTextureType(o), h = f._getInternalFormat(r), u = f._getRGBABufferInternalSizedFormat(o), m = !1; h === p.RGB && (h = p.RGBA, m = !0), f._bindTextureDirectly(p.TEXTURE_CUBE_MAP, _, !0), f._unpackFlipY(!1); for (var g = l(n), v = 0; v < g.length; v++)for (var y = i >> v, b = 0; b < 6; b++) { var T = g[v][b]; m && (T = f._convertRGBtoRGBATextureData(T, y, y, o)), p.texImage2D(b, v, u, y, y, 0, h, s, T) } f._bindTextureDirectly(p.TEXTURE_CUBE_MAP, null) } else f.updateRawCubeTexture(_, n, r, o, d); _.isReady = !0, t._removePendingData(_), c && c() } }(e) }, void 0, t.database, !0, function (e, i) { t._removePendingData(_), h && e && h(e.status + " " + e.statusText, i) }), _ }, n.prototype.updateRawTexture3D = function (e, t, i, r, o, s) { void 0 === o && (o = null), void 0 === s && (s = n.TEXTURETYPE_UNSIGNED_INT); var a = this._getWebGLTextureType(s), l = this._getInternalFormat(i), c = this._getRGBABufferInternalSizedFormat(s, i); this._bindTextureDirectly(this._gl.TEXTURE_3D, e, !0), this._unpackFlipY(void 0 === r || !!r), this._doNotHandleContextLost || (e._bufferView = t, e.format = i, e.invertY = r, e._compression = o), e.width % 4 != 0 && this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT, 1), o && t ? this._gl.compressedTexImage3D(this._gl.TEXTURE_3D, 0, this.getCaps().s3tc[o], e.width, e.height, e.depth, 0, t) : this._gl.texImage3D(this._gl.TEXTURE_3D, 0, c, e.width, e.height, e.depth, 0, l, a, t), e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_3D), this._bindTextureDirectly(this._gl.TEXTURE_3D, null), e.isReady = !0 }, n.prototype.createRawTexture3D = function (t, i, r, o, s, a, l, c, h, u) { void 0 === h && (h = null), void 0 === u && (u = n.TEXTURETYPE_UNSIGNED_INT); var d = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_RAW3D); d.baseWidth = i, d.baseHeight = r, d.baseDepth = o, d.width = i, d.height = r, d.depth = o, d.format = s, d.type = u, d.generateMipMaps = a, d.samplingMode = c, d.is3D = !0, this._doNotHandleContextLost || (d._bufferView = t), this.updateRawTexture3D(d, t, s, l, h, u), this._bindTextureDirectly(this._gl.TEXTURE_3D, d, !0); var f = this._getSamplingParameters(c, a); return this._gl.texParameteri(this._gl.TEXTURE_3D, this._gl.TEXTURE_MAG_FILTER, f.mag), this._gl.texParameteri(this._gl.TEXTURE_3D, this._gl.TEXTURE_MIN_FILTER, f.min), a && this._gl.generateMipmap(this._gl.TEXTURE_3D), this._bindTextureDirectly(this._gl.TEXTURE_3D, null), this._internalTexturesCache.push(d), d }, n.prototype._prepareWebGLTextureContinuation = function (e, t, i, r, n) { var o = this._gl; if (o) { var s = this._getSamplingParameters(n, !i); o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, s.mag), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, s.min), i || r || o.generateMipmap(o.TEXTURE_2D), this._bindTextureDirectly(o.TEXTURE_2D, null), t && t._removePendingData(e), e.onLoadedObservable.notifyObservers(e), e.onLoadedObservable.clear() } }, n.prototype._prepareWebGLTexture = function (t, i, r, o, s, a, l, c, h) { var u = this; void 0 === h && (h = n.TEXTURE_TRILINEAR_SAMPLINGMODE); var d = this.getCaps().maxTextureSize, f = Math.min(d, this.needPOTTextures ? e.Tools.GetExponentOfTwo(r, d) : r), p = Math.min(d, this.needPOTTextures ? e.Tools.GetExponentOfTwo(o, d) : o), _ = this._gl; _ && (t._webGLTexture ? (this._bindTextureDirectly(_.TEXTURE_2D, t, !0), this._unpackFlipY(void 0 === s || !!s), t.baseWidth = r, t.baseHeight = o, t.width = f, t.height = p, t.isReady = !0, c(f, p, function () { u._prepareWebGLTextureContinuation(t, i, a, l, h) }) || this._prepareWebGLTextureContinuation(t, i, a, l, h)) : i && i._removePendingData(t)) }, n.prototype._convertRGBtoRGBATextureData = function (e, t, i, r) { var o; o = r === n.TEXTURETYPE_FLOAT ? new Float32Array(t * i * 4) : new Uint32Array(t * i * 4); for (var s = 0; s < t; s++)for (var a = 0; a < i; a++) { var l = 3 * (a * t + s), c = 4 * (a * t + s); o[c + 0] = e[l + 0], o[c + 1] = e[l + 1], o[c + 2] = e[l + 2], o[c + 3] = 1 } return o }, n.prototype._releaseFramebufferObjects = function (e) { var t = this._gl; e._framebuffer && (t.deleteFramebuffer(e._framebuffer), e._framebuffer = null), e._depthStencilBuffer && (t.deleteRenderbuffer(e._depthStencilBuffer), e._depthStencilBuffer = null), e._MSAAFramebuffer && (t.deleteFramebuffer(e._MSAAFramebuffer), e._MSAAFramebuffer = null), e._MSAARenderBuffer && (t.deleteRenderbuffer(e._MSAARenderBuffer), e._MSAARenderBuffer = null) }, n.prototype._releaseTexture = function (e) { var t = this._gl; this._releaseFramebufferObjects(e), t.deleteTexture(e._webGLTexture), this.unbindAllTextures(); var i = this._internalTexturesCache.indexOf(e); -1 !== i && this._internalTexturesCache.splice(i, 1), e._lodTextureHigh && e._lodTextureHigh.dispose(), e._lodTextureMid && e._lodTextureMid.dispose(), e._lodTextureLow && e._lodTextureLow.dispose(), this.scenes.forEach(function (t) { t.postProcesses.forEach(function (t) { t._outputTexture == e && (t._outputTexture = null) }), t.cameras.forEach(function (t) { t._postProcesses.forEach(function (t) { t && t._outputTexture == e && (t._outputTexture = null) }) }) }) }, n.prototype.setProgram = function (e) { this._currentProgram !== e && (this._gl.useProgram(e), this._currentProgram = e) }, n.prototype.bindSamplers = function (e) { this.setProgram(e.getProgram()); for (var t = e.getSamplers(), i = 0; i < t.length; i++) { var r = e.getUniform(t[i]); r && (this._boundUniforms[i] = r) } this._currentEffect = null }, n.prototype._moveBoundTextureOnTop = function (e) { this.disableTextureBindingOptimization || this._lastBoundInternalTextureTracker.previous === e || (this._linkTrackers(e.previous, e.next), this._linkTrackers(this._lastBoundInternalTextureTracker.previous, e), this._linkTrackers(e, this._lastBoundInternalTextureTracker)) }, n.prototype._getCorrectTextureChannel = function (e, t) { if (!t) return -1; if (t._initialSlot = e, this.disableTextureBindingOptimization) e !== t._designatedSlot && this._textureCollisions.addCount(1, !1); else if (e !== t._designatedSlot) return -1 < t._designatedSlot ? t._designatedSlot : this._nextFreeTextureSlots.length ? this._nextFreeTextureSlots[0] : (this._textureCollisions.addCount(1, !1), this._removeDesignatedSlot(this._firstBoundInternalTextureTracker.next)); return e }, n.prototype._linkTrackers = function (e, t) { (e.next = t).previous = e }, n.prototype._removeDesignatedSlot = function (e) { var t = e._designatedSlot; return -1 === t ? -1 : (e._designatedSlot = -1, this.disableTextureBindingOptimization ? -1 : (this._linkTrackers(e.previous, e.next), this._boundTexturesCache[t] = null, this._nextFreeTextureSlots.push(t), t)) }, n.prototype._activateCurrentTexture = function () { this._currentTextureChannel !== this._activeChannel && (this._gl.activeTexture(this._gl.TEXTURE0 + this._activeChannel), this._currentTextureChannel = this._activeChannel) }, n.prototype._bindTextureDirectly = function (e, t, i, r) { void 0 === i && (i = !1), void 0 === r && (r = !1); var n = !1; i && t && -1 < t._designatedSlot && (this._activeChannel = t._designatedSlot); var o = this._boundTexturesCache[this._activeChannel], s = t && -1 < t._initialSlot; if (o !== t || r) { if (o && this._removeDesignatedSlot(o), this._activateCurrentTexture(), this._gl.bindTexture(e, t ? t._webGLTexture : null), this._boundTexturesCache[this._activeChannel] = t) { if (!this.disableTextureBindingOptimization) { var a = this._nextFreeTextureSlots.indexOf(this._activeChannel); -1 < a && this._nextFreeTextureSlots.splice(a, 1), this._linkTrackers(this._lastBoundInternalTextureTracker.previous, t), this._linkTrackers(t, this._lastBoundInternalTextureTracker) } t._designatedSlot = this._activeChannel } } else i && (n = !0, this._activateCurrentTexture()); return s && !i && this._bindSamplerUniformToChannel(t._initialSlot, this._activeChannel), n }, n.prototype._bindTexture = function (e, t) { e < 0 || (t && (e = this._getCorrectTextureChannel(e, t)), this._activeChannel = e, this._bindTextureDirectly(this._gl.TEXTURE_2D, t)) }, n.prototype.setTextureFromPostProcess = function (e, t) { this._bindTexture(e, t ? t._textures.data[t._currentRenderTextureInd] : null) }, n.prototype.setTextureFromPostProcessOutput = function (e, t) { this._bindTexture(e, t ? t._outputTexture : null) }, n.prototype.unbindAllTextures = function () { for (var e = 0; e < this._maxSimultaneousTextures; e++)this._activeChannel = e, this._bindTextureDirectly(this._gl.TEXTURE_2D, null), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null), 1 < this.webGLVersion && this._bindTextureDirectly(this._gl.TEXTURE_3D, null) }, n.prototype.setTexture = function (e, t, i) { e < 0 || (t && (this._boundUniforms[e] = t), this._setTexture(e, i)) }, n.prototype.setDepthStencilTexture = function (e, t, i) { e < 0 || (t && (this._boundUniforms[e] = t), i && i.depthStencilTexture ? this._setTexture(e, i, !1, !0) : this._setTexture(e, null)) }, n.prototype._bindSamplerUniformToChannel = function (e, t) { var i = this._boundUniforms[e]; i._currentState !== t && (this._gl.uniform1i(i, t), i._currentState = t) }, n.prototype._getTextureWrapMode = function (e) { switch (e) { case n.TEXTURE_WRAP_ADDRESSMODE: return this._gl.REPEAT; case n.TEXTURE_CLAMP_ADDRESSMODE: return this._gl.CLAMP_TO_EDGE; case n.TEXTURE_MIRROR_ADDRESSMODE: return this._gl.MIRRORED_REPEAT }return this._gl.REPEAT }, n.prototype._setTexture = function (e, t, i, r) { if (void 0 === i && (i = !1), void 0 === r && (r = !1), !t) return null != this._boundTexturesCache[e] && (this._activeChannel = e, this._bindTextureDirectly(this._gl.TEXTURE_2D, null), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null), 1 < this.webGLVersion && this._bindTextureDirectly(this._gl.TEXTURE_3D, null)), !1; if (t.video) this._activeChannel = e, t.update(); else if (t.delayLoadState === n.DELAYLOADSTATE_NOTLOADED) return t.delayLoad(), !1; var o; o = r ? t.depthStencilTexture : t.isReady() ? t.getInternalTexture() : t.isCube ? this.emptyCubeTexture : t.is3D ? this.emptyTexture3D : this.emptyTexture, i || (e = this._getCorrectTextureChannel(e, o)); var s = !0; if (this._boundTexturesCache[e] === o && (this._moveBoundTextureOnTop(o), i || this._bindSamplerUniformToChannel(o._initialSlot, e), s = !1), this._activeChannel = e, o && o.is3D) s && this._bindTextureDirectly(this._gl.TEXTURE_3D, o, i), o && o._cachedWrapU !== t.wrapU && (o._cachedWrapU = t.wrapU, this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(t.wrapU), o)), o && o._cachedWrapV !== t.wrapV && (o._cachedWrapV = t.wrapV, this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(t.wrapV), o)), o && o._cachedWrapR !== t.wrapR && (o._cachedWrapR = t.wrapR, this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(t.wrapR), o)), this._setAnisotropicLevel(this._gl.TEXTURE_3D, t); else if (o && o.isCube) { if (s && this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, o, i), o._cachedCoordinatesMode !== t.coordinatesMode) { o._cachedCoordinatesMode = t.coordinatesMode; var a = t.coordinatesMode !== n.TEXTURE_CUBIC_MODE && t.coordinatesMode !== n.TEXTURE_SKYBOX_MODE ? this._gl.REPEAT : this._gl.CLAMP_TO_EDGE; this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_S, a, o), this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_T, a) } this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP, t) } else s && this._bindTextureDirectly(this._gl.TEXTURE_2D, o, i), o && o._cachedWrapU !== t.wrapU && (o._cachedWrapU = t.wrapU, this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(t.wrapU), o)), o && o._cachedWrapV !== t.wrapV && (o._cachedWrapV = t.wrapV, this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(t.wrapV), o)), this._setAnisotropicLevel(this._gl.TEXTURE_2D, t); return !0 }, n.prototype.setTextureArray = function (e, t, i) { if (!(e < 0) && t) { this._textureUnits && this._textureUnits.length === i.length || (this._textureUnits = new Int32Array(i.length)); for (var r = 0; r < i.length; r++)this._textureUnits[r] = this._getCorrectTextureChannel(e + r, i[r].getInternalTexture()); this._gl.uniform1iv(t, this._textureUnits); for (var n = 0; n < i.length; n++)this._setTexture(this._textureUnits[n], i[n], !0) } }, n.prototype._setAnisotropicLevel = function (e, t) { var i = t.getInternalTexture(); if (i) { var r = this._caps.textureAnisotropicFilterExtension, o = t.anisotropicFilteringLevel; i.samplingMode !== n.TEXTURE_LINEAR_LINEAR_MIPNEAREST && i.samplingMode !== n.TEXTURE_LINEAR_LINEAR_MIPLINEAR && i.samplingMode !== n.TEXTURE_LINEAR_LINEAR && (o = 1), r && i._cachedAnisotropicFilteringLevel !== o && (this._setTextureParameterFloat(e, r.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(o, this._caps.maxAnisotropy), i), i._cachedAnisotropicFilteringLevel = o) } }, n.prototype._setTextureParameterFloat = function (e, t, i, r) { this._bindTextureDirectly(e, r, !0, !0), this._gl.texParameterf(e, t, i) }, n.prototype._setTextureParameterInteger = function (e, t, i, r) { r && this._bindTextureDirectly(e, r, !0, !0), this._gl.texParameteri(e, t, i) }, n.prototype.readPixels = function (e, t, i, r) { var n = new Uint8Array(r * i * 4); return this._gl.readPixels(e, t, i, r, this._gl.RGBA, this._gl.UNSIGNED_BYTE, n), n }, n.prototype.addExternalData = function (t, i) { return this._externalData || (this._externalData = new e.StringDictionary), this._externalData.add(t, i) }, n.prototype.getExternalData = function (t) { return this._externalData || (this._externalData = new e.StringDictionary), this._externalData.get(t) }, n.prototype.getOrAddExternalDataWithFactory = function (t, i) { return this._externalData || (this._externalData = new e.StringDictionary), this._externalData.getOrAddWithFactory(t, i) }, n.prototype.removeExternalData = function (t) { return this._externalData || (this._externalData = new e.StringDictionary), this._externalData.remove(t) }, n.prototype.unbindAllAttributes = function () { if (this._mustWipeVertexAttributes) { this._mustWipeVertexAttributes = !1; for (var e = 0; e < this._caps.maxVertexAttribs; e++)this._gl.disableVertexAttribArray(e), this._vertexAttribArraysEnabled[e] = !1, this._currentBufferPointers[e].active = !1 } else { e = 0; for (var t = this._vertexAttribArraysEnabled.length; e < t; e++)e >= this._caps.maxVertexAttribs || !this._vertexAttribArraysEnabled[e] || (this._gl.disableVertexAttribArray(e), this._vertexAttribArraysEnabled[e] = !1, this._currentBufferPointers[e].active = !1) } }, n.prototype.releaseEffects = function () { for (var e in this._compiledEffects) this._deleteProgram(this._compiledEffects[e]._program); this._compiledEffects = {} }, n.prototype.dispose = function () { for (this.hideLoadingUI(), this.stopRenderLoop(); this.postProcesses.length;)this.postProcesses[0].dispose(); for (this._emptyTexture && (this._releaseTexture(this._emptyTexture), this._emptyTexture = null), this._emptyCubeTexture && (this._releaseTexture(this._emptyCubeTexture), this._emptyCubeTexture = null), this._rescalePostProcess && this._rescalePostProcess.dispose(); this.scenes.length;)this.scenes[0].dispose(); 1 === n.Instances.length && n.audioEngine && n.audioEngine.dispose(), this.releaseEffects(), this.unbindAllAttributes(), this._boundUniforms = [], this._dummyFramebuffer && this._gl.deleteFramebuffer(this._dummyFramebuffer), this.disableVR(), e.Tools.IsWindowObjectExist() && (window.removeEventListener("blur", this._onBlur), window.removeEventListener("focus", this._onFocus), window.removeEventListener("vrdisplaypointerrestricted", this._onVRDisplayPointerRestricted), window.removeEventListener("vrdisplaypointerunrestricted", this._onVRDisplayPointerUnrestricted), this._renderingCanvas && (this._renderingCanvas.removeEventListener("focus", this._onCanvasFocus), this._renderingCanvas.removeEventListener("blur", this._onCanvasBlur), this._renderingCanvas.removeEventListener("pointerout", this._onCanvasPointerOut), this._doNotHandleContextLost || (this._renderingCanvas.removeEventListener("webglcontextlost", this._onContextLost), this._renderingCanvas.removeEventListener("webglcontextrestored", this._onContextRestored))), document.removeEventListener("fullscreenchange", this._onFullscreenChange), document.removeEventListener("mozfullscreenchange", this._onFullscreenChange), document.removeEventListener("webkitfullscreenchange", this._onFullscreenChange), document.removeEventListener("msfullscreenchange", this._onFullscreenChange), document.removeEventListener("pointerlockchange", this._onPointerLockChange), document.removeEventListener("mspointerlockchange", this._onPointerLockChange), document.removeEventListener("mozpointerlockchange", this._onPointerLockChange), document.removeEventListener("webkitpointerlockchange", this._onPointerLockChange), this._onVrDisplayConnect && (window.removeEventListener("vrdisplayconnect", this._onVrDisplayConnect), this._onVrDisplayDisconnect && window.removeEventListener("vrdisplaydisconnect", this._onVrDisplayDisconnect), this._onVrDisplayPresentChange && window.removeEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange), this._onVrDisplayConnect = null, this._onVrDisplayDisconnect = null)); var t = n.Instances.indexOf(this); 0 <= t && n.Instances.splice(t, 1), this._workingCanvas = null, this._workingContext = null, this._currentBufferPointers = [], this._renderingCanvas = null, this._currentProgram = null, this._bindedRenderFunction = null, this.onResizeObservable.clear(), this.onCanvasBlurObservable.clear(), this.onCanvasFocusObservable.clear(), this.onCanvasPointerOutObservable.clear(), this.onBeginFrameObservable.clear(), this.onEndFrameObservable.clear(), e.Effect.ResetCache(); for (var i = 0, r = this._activeRequests; i < r.length; i++)r[i].abort() }, n.prototype.displayLoadingUI = function () { if (e.Tools.IsWindowObjectExist()) { var t = this.loadingScreen; t && t.displayLoadingUI() } }, n.prototype.hideLoadingUI = function () { if (e.Tools.IsWindowObjectExist()) { var t = this.loadingScreen; t && t.hideLoadingUI() } }, Object.defineProperty(n.prototype, "loadingScreen", { get: function () { return !this._loadingScreen && e.DefaultLoadingScreen && this._renderingCanvas && (this._loadingScreen = new e.DefaultLoadingScreen(this._renderingCanvas)), this._loadingScreen }, set: function (e) { this._loadingScreen = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "loadingUIText", { set: function (e) { this.loadingScreen.loadingUIText = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "loadingUIBackgroundColor", { set: function (e) { this.loadingScreen.loadingUIBackgroundColor = e }, enumerable: !0, configurable: !0 }), n.prototype.attachContextLostEvent = function (e) { this._renderingCanvas && this._renderingCanvas.addEventListener("webglcontextlost", e, !1) }, n.prototype.attachContextRestoredEvent = function (e) { this._renderingCanvas && this._renderingCanvas.addEventListener("webglcontextrestored", e, !1) }, n.prototype.getVertexShaderSource = function (e) { var t = this._gl.getAttachedShaders(e); return t ? this._gl.getShaderSource(t[0]) : null }, n.prototype.getFragmentShaderSource = function (e) { var t = this._gl.getAttachedShaders(e); return t ? this._gl.getShaderSource(t[1]) : null }, n.prototype.getError = function () { return this._gl.getError() }, n.prototype.getFps = function () { return this._fps }, n.prototype.getDeltaTime = function () { return this._deltaTime }, n.prototype._measureFps = function () { this._performanceMonitor.sampleFrame(), this._fps = this._performanceMonitor.averageFPS, this._deltaTime = this._performanceMonitor.instantaneousFrameTime || 0 }, n.prototype._readTexturePixels = function (e, t, i, r, n, o) { void 0 === r && (r = -1), void 0 === n && (n = 0), void 0 === o && (o = null); var s = this._gl; if (!this._dummyFramebuffer) { var a = s.createFramebuffer(); if (!a) throw new Error("Unable to create dummy framebuffer"); this._dummyFramebuffer = a } s.bindFramebuffer(s.FRAMEBUFFER, this._dummyFramebuffer), -1 < r ? s.framebufferTexture2D(s.FRAMEBUFFER, s.COLOR_ATTACHMENT0, s.TEXTURE_CUBE_MAP_POSITIVE_X + r, e._webGLTexture, n) : s.framebufferTexture2D(s.FRAMEBUFFER, s.COLOR_ATTACHMENT0, s.TEXTURE_2D, e._webGLTexture, n); var l = void 0 !== e.type ? this._getWebGLTextureType(e.type) : s.UNSIGNED_BYTE; switch (l) { case s.UNSIGNED_BYTE: o || (o = new Uint8Array(4 * t * i)), l = s.UNSIGNED_BYTE; break; default: o || (o = new Float32Array(4 * t * i)), l = s.FLOAT }return s.readPixels(0, 0, t, i, s.RGBA, l, o), s.bindFramebuffer(s.FRAMEBUFFER, this._currentFramebuffer), o }, n.prototype._canRenderToFloatFramebuffer = function () { return 1 < this._webGLVersion ? this._caps.colorBufferFloat : this._canRenderToFramebuffer(n.TEXTURETYPE_FLOAT) }, n.prototype._canRenderToHalfFloatFramebuffer = function () { return 1 < this._webGLVersion ? this._caps.colorBufferFloat : this._canRenderToFramebuffer(n.TEXTURETYPE_HALF_FLOAT) }, n.prototype._canRenderToFramebuffer = function (e) { for (var t = this._gl; t.getError() !== t.NO_ERROR;); var i = !0, r = t.createTexture(); t.bindTexture(t.TEXTURE_2D, r), t.texImage2D(t.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(e), 1, 1, 0, t.RGBA, this._getWebGLTextureType(e), null), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.NEAREST), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, t.NEAREST); var n = t.createFramebuffer(); t.bindFramebuffer(t.FRAMEBUFFER, n), t.framebufferTexture2D(t.FRAMEBUFFER, t.COLOR_ATTACHMENT0, t.TEXTURE_2D, r, 0); var o = t.checkFramebufferStatus(t.FRAMEBUFFER); if ((i = (i = i && o === t.FRAMEBUFFER_COMPLETE) && t.getError() === t.NO_ERROR) && (t.clear(t.COLOR_BUFFER_BIT), i = i && t.getError() === t.NO_ERROR), i) { t.bindFramebuffer(t.FRAMEBUFFER, null); var s = t.RGBA, a = t.UNSIGNED_BYTE, l = new Uint8Array(4); t.readPixels(0, 0, 1, 1, s, a, l), i = i && t.getError() === t.NO_ERROR } for (t.deleteTexture(r), t.deleteFramebuffer(n), t.bindFramebuffer(t.FRAMEBUFFER, null); !i && t.getError() !== t.NO_ERROR;); return i }, n.prototype._getWebGLTextureType = function (e) { if (1 === this._webGLVersion) { switch (e) { case n.TEXTURETYPE_FLOAT: return this._gl.FLOAT; case n.TEXTURETYPE_HALF_FLOAT: return this._gl.HALF_FLOAT_OES; case n.TEXTURETYPE_UNSIGNED_BYTE: return this._gl.UNSIGNED_BYTE }return this._gl.UNSIGNED_BYTE } switch (e) { case n.TEXTURETYPE_BYTE: return this._gl.BYTE; case n.TEXTURETYPE_UNSIGNED_BYTE: return this._gl.UNSIGNED_BYTE; case n.TEXTURETYPE_SHORT: return this._gl.SHORT; case n.TEXTURETYPE_UNSIGNED_SHORT: return this._gl.UNSIGNED_SHORT; case n.TEXTURETYPE_INT: return this._gl.INT; case n.TEXTURETYPE_UNSIGNED_INTEGER: return this._gl.UNSIGNED_INT; case n.TEXTURETYPE_FLOAT: return this._gl.FLOAT; case n.TEXTURETYPE_HALF_FLOAT: return this._gl.HALF_FLOAT; case n.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4: return this._gl.UNSIGNED_SHORT_4_4_4_4; case n.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1: return this._gl.UNSIGNED_SHORT_5_5_5_1; case n.TEXTURETYPE_UNSIGNED_SHORT_5_6_5: return this._gl.UNSIGNED_SHORT_5_6_5; case n.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV: return this._gl.UNSIGNED_INT_2_10_10_10_REV; case n.TEXTURETYPE_UNSIGNED_INT_24_8: return this._gl.UNSIGNED_INT_24_8; case n.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV: return this._gl.UNSIGNED_INT_10F_11F_11F_REV; case n.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV: return this._gl.UNSIGNED_INT_5_9_9_9_REV; case n.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV: return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV }return this._gl.UNSIGNED_BYTE }, n.prototype._getInternalFormat = function (e) { var t = this._gl.RGBA; switch (e) { case n.TEXTUREFORMAT_ALPHA: t = this._gl.ALPHA; break; case n.TEXTUREFORMAT_LUMINANCE: t = this._gl.LUMINANCE; break; case n.TEXTUREFORMAT_LUMINANCE_ALPHA: t = this._gl.LUMINANCE_ALPHA; break; case n.TEXTUREFORMAT_RED: t = this._gl.RED; break; case n.TEXTUREFORMAT_RG: t = this._gl.RG; break; case n.TEXTUREFORMAT_RGB: t = this._gl.RGB; break; case n.TEXTUREFORMAT_RGBA: t = this._gl.RGBA }if (1 < this._webGLVersion) switch (e) { case n.TEXTUREFORMAT_RED_INTEGER: t = this._gl.RED_INTEGER; break; case n.TEXTUREFORMAT_RG_INTEGER: t = this._gl.RG_INTEGER; break; case n.TEXTUREFORMAT_RGB_INTEGER: t = this._gl.RGB_INTEGER; break; case n.TEXTUREFORMAT_RGBA_INTEGER: t = this._gl.RGBA_INTEGER }return t }, n.prototype._getRGBABufferInternalSizedFormat = function (e, t) { if (1 === this._webGLVersion) { if (void 0 !== t) switch (t) { case n.TEXTUREFORMAT_ALPHA: return this._gl.ALPHA; case n.TEXTUREFORMAT_LUMINANCE: return this._gl.LUMINANCE; case n.TEXTUREFORMAT_LUMINANCE_ALPHA: return this._gl.LUMINANCE_ALPHA }return this._gl.RGBA } switch (e) { case n.TEXTURETYPE_BYTE: switch (t) { case n.TEXTUREFORMAT_RED: return this._gl.R8_SNORM; case n.TEXTUREFORMAT_RG: return this._gl.RG8_SNORM; case n.TEXTUREFORMAT_RGB: return this._gl.RGB8_SNORM; case n.TEXTUREFORMAT_RED_INTEGER: return this._gl.R8I; case n.TEXTUREFORMAT_RG_INTEGER: return this._gl.RG8I; case n.TEXTUREFORMAT_RGB_INTEGER: return this._gl.RGB8I; case n.TEXTUREFORMAT_RGBA_INTEGER: return this._gl.RGBA8I; default: return this._gl.RGBA8_SNORM }case n.TEXTURETYPE_UNSIGNED_BYTE: switch (t) { case n.TEXTUREFORMAT_RED: return this._gl.R8; case n.TEXTUREFORMAT_RG: return this._gl.RG8; case n.TEXTUREFORMAT_RGB: return this._gl.RGB8; case n.TEXTUREFORMAT_RGBA: return this._gl.RGBA8; case n.TEXTUREFORMAT_RED_INTEGER: return this._gl.R8UI; case n.TEXTUREFORMAT_RG_INTEGER: return this._gl.RG8UI; case n.TEXTUREFORMAT_RGB_INTEGER: return this._gl.RGB8UI; case n.TEXTUREFORMAT_RGBA_INTEGER: return this._gl.RGBA8UI; default: return this._gl.RGBA8 }case n.TEXTURETYPE_SHORT: switch (t) { case n.TEXTUREFORMAT_RED_INTEGER: return this._gl.R16I; case n.TEXTUREFORMAT_RG_INTEGER: return this._gl.RG16I; case n.TEXTUREFORMAT_RGB_INTEGER: return this._gl.RGB16I; case n.TEXTUREFORMAT_RGBA_INTEGER: default: return this._gl.RGBA16I }case n.TEXTURETYPE_UNSIGNED_SHORT: switch (t) { case n.TEXTUREFORMAT_RED_INTEGER: return this._gl.R16UI; case n.TEXTUREFORMAT_RG_INTEGER: return this._gl.RG16UI; case n.TEXTUREFORMAT_RGB_INTEGER: return this._gl.RGB16UI; case n.TEXTUREFORMAT_RGBA_INTEGER: default: return this._gl.RGBA16UI }case n.TEXTURETYPE_INT: switch (t) { case n.TEXTUREFORMAT_RED_INTEGER: return this._gl.R32I; case n.TEXTUREFORMAT_RG_INTEGER: return this._gl.RG32I; case n.TEXTUREFORMAT_RGB_INTEGER: return this._gl.RGB32I; case n.TEXTUREFORMAT_RGBA_INTEGER: default: return this._gl.RGBA32I }case n.TEXTURETYPE_UNSIGNED_INTEGER: switch (t) { case n.TEXTUREFORMAT_RED_INTEGER: return this._gl.R32UI; case n.TEXTUREFORMAT_RG_INTEGER: return this._gl.RG32UI; case n.TEXTUREFORMAT_RGB_INTEGER: return this._gl.RGB32UI; case n.TEXTUREFORMAT_RGBA_INTEGER: default: return this._gl.RGBA32UI }case n.TEXTURETYPE_FLOAT: switch (t) { case n.TEXTUREFORMAT_RED: return this._gl.R32F; case n.TEXTUREFORMAT_RG: return this._gl.RG32F; case n.TEXTUREFORMAT_RGB: return this._gl.RGB32F; case n.TEXTUREFORMAT_RGBA: default: return this._gl.RGBA32F }case n.TEXTURETYPE_HALF_FLOAT: switch (t) { case n.TEXTUREFORMAT_RED: return this._gl.R16F; case n.TEXTUREFORMAT_RG: return this._gl.RG16F; case n.TEXTUREFORMAT_RGB: return this._gl.RGB16F; case n.TEXTUREFORMAT_RGBA: default: return this._gl.RGBA16F }case n.TEXTURETYPE_UNSIGNED_SHORT_5_6_5: return this._gl.RGB565; case n.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV: return this._gl.R11F_G11F_B10F; case n.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV: return this._gl.RGB9_E5; case n.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4: return this._gl.RGBA4; case n.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1: return this._gl.RGB5_A1; case n.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV: switch (t) { case n.TEXTUREFORMAT_RGBA: return this._gl.RGB10_A2; case n.TEXTUREFORMAT_RGBA_INTEGER: return this._gl.RGB10_A2UI; default: return this._gl.RGB10_A2 } }return this._gl.RGBA8 }, n.prototype._getRGBAMultiSampleBufferFormat = function (e) { return e === n.TEXTURETYPE_FLOAT ? this._gl.RGBA32F : e === n.TEXTURETYPE_HALF_FLOAT ? this._gl.RGBA16F : this._gl.RGBA8 }, n.prototype._loadFile = function (t, i, r, n, o, s) { var a = this, l = e.Tools.LoadFile(t, i, r, n, o, s); return this._activeRequests.push(l), l.onCompleteObservable.add(function (e) { a._activeRequests.splice(a._activeRequests.indexOf(e), 1) }), l }, n.prototype._loadFileAsync = function (e, t, i) { var r = this; return new Promise(function (n, o) { r._loadFile(e, function (e) { n(e) }, void 0, t, i, function (e, t) { o(t) }) }) }, n.prototype._partialLoadFile = function (e, t, i, r, n, o) { void 0 === o && (o = null), this._loadFile(e, function (e) { i[t] = e, i._internalCount++ , 6 === i._internalCount && n(i) }, void 0, void 0, !0, function (e, t) { o && e && o(e.status + " " + e.statusText, t) }) }, n.prototype._cascadeLoadFiles = function (e, t, i, r) { void 0 === r && (r = null); for (var n = [], o = n._internalCount = 0; o < 6; o++)this._partialLoadFile(i[o], o, n, e, t, r) }, n.isSupported = function () { try { var e = document.createElement("canvas"); return null != (e.getContext("webgl") || e.getContext("experimental-webgl")) && !!window.WebGLRenderingContext } catch (e) { return !1 } }, n.ExceptionList = [{ key: "Chrome/63.0", capture: "63\\.0\\.3239\\.(\\d+)", captureConstraint: 108, targets: ["uniformBuffer"] }, { key: "Firefox/58", capture: null, captureConstraint: null, targets: ["uniformBuffer"] }, { key: "Firefox/59", capture: null, captureConstraint: null, targets: ["uniformBuffer"] }, { key: "Macintosh", capture: null, captureConstraint: null, targets: ["textureBindingOptimization"] }, { key: "iPhone", capture: null, captureConstraint: null, targets: ["textureBindingOptimization"] }, { key: "iPad", capture: null, captureConstraint: null, targets: ["textureBindingOptimization"] }], n.Instances = new Array, n._TextureLoaders = [], n.ALPHA_DISABLE = 0, n.ALPHA_ADD = 1, n.ALPHA_COMBINE = 2, n.ALPHA_SUBTRACT = 3, n.ALPHA_MULTIPLY = 4, n.ALPHA_MAXIMIZED = 5, n.ALPHA_ONEONE = 6, n.ALPHA_PREMULTIPLIED = 7, n.ALPHA_PREMULTIPLIED_PORTERDUFF = 8, n.ALPHA_INTERPOLATE = 9, n.ALPHA_SCREENMODE = 10, n.DELAYLOADSTATE_NONE = 0, n.DELAYLOADSTATE_LOADED = 1, n.DELAYLOADSTATE_LOADING = 2, n.DELAYLOADSTATE_NOTLOADED = 4, n.NEVER = 512, n.ALWAYS = 519, n.LESS = 513, n.EQUAL = 514, n.LEQUAL = 515, n.GREATER = 516, n.GEQUAL = 518, n.NOTEQUAL = 517, n.KEEP = 7680, n.REPLACE = 7681, n.INCR = 7682, n.DECR = 7683, n.INVERT = 5386, n.INCR_WRAP = 34055, n.DECR_WRAP = 34056, n.TEXTURE_CLAMP_ADDRESSMODE = 0, n.TEXTURE_WRAP_ADDRESSMODE = 1, n.TEXTURE_MIRROR_ADDRESSMODE = 2, n.TEXTUREFORMAT_ALPHA = 0, n.TEXTUREFORMAT_LUMINANCE = 1, n.TEXTUREFORMAT_LUMINANCE_ALPHA = 2, n.TEXTUREFORMAT_RGB = 4, n.TEXTUREFORMAT_RGBA = 5, n.TEXTUREFORMAT_RED = 6, n.TEXTUREFORMAT_R = 6, n.TEXTUREFORMAT_RG = 7, n.TEXTUREFORMAT_RED_INTEGER = 8, n.TEXTUREFORMAT_R_INTEGER = 8, n.TEXTUREFORMAT_RG_INTEGER = 9, n.TEXTUREFORMAT_RGB_INTEGER = 10, n.TEXTUREFORMAT_RGBA_INTEGER = 11, n.TEXTURETYPE_UNSIGNED_BYTE = 0, n.TEXTURETYPE_UNSIGNED_INT = 0, n.TEXTURETYPE_FLOAT = 1, n.TEXTURETYPE_HALF_FLOAT = 2, n.TEXTURETYPE_BYTE = 3, n.TEXTURETYPE_SHORT = 4, n.TEXTURETYPE_UNSIGNED_SHORT = 5, n.TEXTURETYPE_INT = 6, n.TEXTURETYPE_UNSIGNED_INTEGER = 7, n.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 = 8, n.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 = 9, n.TEXTURETYPE_UNSIGNED_SHORT_5_6_5 = 10, n.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV = 11, n.TEXTURETYPE_UNSIGNED_INT_24_8 = 12, n.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV = 13, n.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV = 14, n.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV = 15, n.TEXTURE_NEAREST_SAMPLINGMODE = 1, n.TEXTURE_BILINEAR_SAMPLINGMODE = 2, n.TEXTURE_TRILINEAR_SAMPLINGMODE = 3, n.TEXTURE_NEAREST_NEAREST_MIPLINEAR = 1, n.TEXTURE_LINEAR_LINEAR_MIPNEAREST = 2, n.TEXTURE_LINEAR_LINEAR_MIPLINEAR = 3, n.TEXTURE_NEAREST_NEAREST_MIPNEAREST = 4, n.TEXTURE_NEAREST_LINEAR_MIPNEAREST = 5, n.TEXTURE_NEAREST_LINEAR_MIPLINEAR = 6, n.TEXTURE_NEAREST_LINEAR = 7, n.TEXTURE_NEAREST_NEAREST = 8, n.TEXTURE_LINEAR_NEAREST_MIPNEAREST = 9, n.TEXTURE_LINEAR_NEAREST_MIPLINEAR = 10, n.TEXTURE_LINEAR_LINEAR = 11, n.TEXTURE_LINEAR_NEAREST = 12, n.TEXTURE_EXPLICIT_MODE = 0, n.TEXTURE_SPHERICAL_MODE = 1, n.TEXTURE_PLANAR_MODE = 2, n.TEXTURE_CUBIC_MODE = 3, n.TEXTURE_PROJECTION_MODE = 4, n.TEXTURE_SKYBOX_MODE = 5, n.TEXTURE_INVCUBIC_MODE = 6, n.TEXTURE_EQUIRECTANGULAR_MODE = 7, n.TEXTURE_FIXED_EQUIRECTANGULAR_MODE = 8, n.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE = 9, n.SCALEMODE_FLOOR = 1, n.SCALEMODE_NEAREST = 2, n.SCALEMODE_CEILING = 3, n.CollisionsEpsilon = .001, n.CodeRepository = "src/", n.ShadersRepository = "src/Shaders/", n }(); e.Engine = n }($a || ($a = {})), E = $a || ($a = {}), x = function () { function e(e, t) { void 0 === t && (t = null), this.state = "", this.metadata = null, this.doNotSerialize = !1, this._isDisposed = !1, this.animations = new Array, this._ranges = {}, this._isEnabled = !0, this._isParentEnabled = !0, this._isReady = !0, this._currentRenderId = -1, this._parentRenderId = -1, this._childRenderId = -1, this._worldMatrix = E.Matrix.Identity(), this._worldMatrixDeterminant = 0, this._sceneRootNodesIndex = -1, this._animationPropertiesOverride = null, this.onDisposeObservable = new E.Observable, this._behaviors = new Array, this.name = e, this.id = e, this._scene = t || E.Engine.LastCreatedScene, this.uniqueId = this._scene.getUniqueId(), this._initCache(), this.addToSceneRootNodes() } return e.AddNodeConstructor = function (e, t) { this._NodeConstructors[e] = t }, e.Construct = function (e, t, i, r) { var n = this._NodeConstructors[e]; return n ? n(t, i, r) : null }, e.prototype.isDisposed = function () { return this._isDisposed }, Object.defineProperty(e.prototype, "parent", { get: function () { return this._parentNode }, set: function (e) { if (this._parentNode !== e) { var t = this._parentNode; if (this._parentNode && void 0 !== this._parentNode._children && null !== this._parentNode._children) { var i = this._parentNode._children.indexOf(this); -1 !== i && this._parentNode._children.splice(i, 1), e || this.addToSceneRootNodes() } this._parentNode = e, this._parentNode && (void 0 !== this._parentNode._children && null !== this._parentNode._children || (this._parentNode._children = new Array), this._parentNode._children.push(this), t || this.removeFromSceneRootNodes()), this._syncParentEnabledState() } }, enumerable: !0, configurable: !0 }), e.prototype.addToSceneRootNodes = function () { -1 === this._sceneRootNodesIndex && (this._sceneRootNodesIndex = this._scene.rootNodes.length, this._scene.rootNodes.push(this)) }, e.prototype.removeFromSceneRootNodes = function () { if (-1 !== this._sceneRootNodesIndex) { var e = this._scene.rootNodes, t = e.length - 1; e[this._sceneRootNodesIndex] = e[t], e[this._sceneRootNodesIndex]._sceneRootNodesIndex = this._sceneRootNodesIndex, this._scene.rootNodes.pop(), this._sceneRootNodesIndex = -1 } }, Object.defineProperty(e.prototype, "animationPropertiesOverride", { get: function () { return this._animationPropertiesOverride ? this._animationPropertiesOverride : this._scene.animationPropertiesOverride }, set: function (e) { this._animationPropertiesOverride = e }, enumerable: !0, configurable: !0 }), e.prototype.getClassName = function () { return "Node" }, Object.defineProperty(e.prototype, "onDispose", { set: function (e) { this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e) }, enumerable: !0, configurable: !0 }), e.prototype.getScene = function () { return this._scene }, e.prototype.getEngine = function () { return this._scene.getEngine() }, e.prototype.addBehavior = function (e, t) { var i = this; return void 0 === t && (t = !1), -1 !== this._behaviors.indexOf(e) || (e.init(), this._scene.isLoading && !t ? this._scene.onDataLoadedObservable.addOnce(function () { e.attach(i) }) : e.attach(this), this._behaviors.push(e)), this }, e.prototype.removeBehavior = function (e) { var t = this._behaviors.indexOf(e); return -1 === t || (this._behaviors[t].detach(), this._behaviors.splice(t, 1)), this }, Object.defineProperty(e.prototype, "behaviors", { get: function () { return this._behaviors }, enumerable: !0, configurable: !0 }), e.prototype.getBehaviorByName = function (e) { for (var t = 0, i = this._behaviors; t < i.length; t++) { var r = i[t]; if (r.name === e) return r } return null }, e.prototype.getWorldMatrix = function () { return this._currentRenderId !== this._scene.getRenderId() && this.computeWorldMatrix(), this._worldMatrix }, e.prototype._getWorldMatrixDeterminant = function () { return this._worldMatrixDeterminant }, Object.defineProperty(e.prototype, "worldMatrixFromCache", { get: function () { return this._worldMatrix }, enumerable: !0, configurable: !0 }), e.prototype._initCache = function () { this._cache = {}, this._cache.parent = void 0 }, e.prototype.updateCache = function (e) { !e && this.isSynchronized() || (this._cache.parent = this.parent, this._updateCache()) }, e.prototype._updateCache = function (e) { }, e.prototype._isSynchronized = function () { return !0 }, e.prototype._markSyncedWithParent = function () { this._parentNode && (this._parentRenderId = this._parentNode._childRenderId) }, e.prototype.isSynchronizedWithParent = function () { return !this._parentNode || this._parentRenderId === this._parentNode._childRenderId && this._parentNode.isSynchronized() }, e.prototype.isSynchronized = function () { return this._cache.parent != this._parentNode ? (this._cache.parent = this._parentNode, !1) : !(this._parentNode && !this.isSynchronizedWithParent()) && this._isSynchronized() }, e.prototype.isReady = function (e) { return void 0 === e && (e = !1), this._isReady }, e.prototype.isEnabled = function (e) { return void 0 === e && (e = !0), !1 === e ? this._isEnabled : !!this._isEnabled && this._isParentEnabled }, e.prototype._syncParentEnabledState = function () { this._isParentEnabled = !this._parentNode || this._parentNode.isEnabled(), this._children && this._children.forEach(function (e) { e._syncParentEnabledState() }) }, e.prototype.setEnabled = function (e) { this._isEnabled = e, this._syncParentEnabledState() }, e.prototype.isDescendantOf = function (e) { return !!this.parent && (this.parent === e || this.parent.isDescendantOf(e)) }, e.prototype._getDescendants = function (e, t, i) { if (void 0 === t && (t = !1), this._children) for (var r = 0; r < this._children.length; r++) { var n = this._children[r]; i && !i(n) || e.push(n), t || n._getDescendants(e, !1, i) } }, e.prototype.getDescendants = function (e, t) { var i = new Array; return this._getDescendants(i, e, t), i }, e.prototype.getChildMeshes = function (e, t) { var i = []; return this._getDescendants(i, e, function (e) { return (!t || t(e)) && e instanceof E.AbstractMesh }), i }, e.prototype.getChildTransformNodes = function (e, t) { var i = []; return this._getDescendants(i, e, function (e) { return (!t || t(e)) && e instanceof E.TransformNode }), i }, e.prototype.getChildren = function (e) { return this.getDescendants(!0, e) }, e.prototype._setReady = function (e) { e !== this._isReady && (e ? (this.onReady && this.onReady(this), this._isReady = !0) : this._isReady = !1) }, e.prototype.getAnimationByName = function (e) { for (var t = 0; t < this.animations.length; t++) { var i = this.animations[t]; if (i.name === e) return i } return null }, e.prototype.createAnimationRange = function (e, t, i) { if (!this._ranges[e]) { this._ranges[e] = new E.AnimationRange(e, t, i); for (var r = 0, n = this.animations.length; r < n; r++)this.animations[r] && this.animations[r].createRange(e, t, i) } }, e.prototype.deleteAnimationRange = function (e, t) { void 0 === t && (t = !0); for (var i = 0, r = this.animations.length; i < r; i++)this.animations[i] && this.animations[i].deleteRange(e, t); this._ranges[e] = null }, e.prototype.getAnimationRange = function (e) { return this._ranges[e] }, e.prototype.beginAnimation = function (e, t, i, r) { var n = this.getAnimationRange(e); return n ? this._scene.beginAnimation(this, n.from, n.to, t, i, r) : null }, e.prototype.serializeAnimationRanges = function () { var e = []; for (var t in this._ranges) { var i = this._ranges[t]; if (i) { var r = {}; r.name = t, r.from = i.from, r.to = i.to, e.push(r) } } return e }, e.prototype.computeWorldMatrix = function (e) { return this._worldMatrix || (this._worldMatrix = E.Matrix.Identity()), this._worldMatrix }, e.prototype.dispose = function (e, t) { if (void 0 === t && (t = !1), e) for (var i = 0, r = this.getChildTransformNodes(!0); i < r.length; i++) { var n = r[i]; n.parent = null, n.computeWorldMatrix(!0) } else for (var o = 0, s = this.getDescendants(!0); o < s.length; o++)s[o].dispose(e, t); this.parent ? this.parent = null : this.removeFromSceneRootNodes(), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear(); for (var a = 0, l = this._behaviors; a < l.length; a++)l[a].detach(); this._behaviors = [], this._isDisposed = !0 }, e.ParseAnimationRanges = function (e, t, i) { if (t.ranges) for (var r = 0; r < t.ranges.length; r++) { var n = t.ranges[r]; e.createAnimationRange(n.name, n.from, n.to) } }, e._NodeConstructors = {}, b([E.serialize()], e.prototype, "name", void 0), b([E.serialize()], e.prototype, "id", void 0), b([E.serialize()], e.prototype, "uniqueId", void 0), b([E.serialize()], e.prototype, "state", void 0), b([E.serialize()], e.prototype, "metadata", void 0), e }(), E.Node = x, P = $a || ($a = {}), A = P.Matrix.Identity(), S = function () { function e(e, t) { this.center = P.Vector3.Zero(), this.centerWorld = P.Vector3.Zero(), this.minimum = P.Vector3.Zero(), this.maximum = P.Vector3.Zero(), this.reConstruct(e, t) } return e.prototype.reConstruct = function (e, t) { this.minimum.copyFrom(e), this.maximum.copyFrom(t); var i = P.Vector3.Distance(e, t); P.Vector3.LerpToRef(e, t, .5, this.center), this.radius = .5 * i, this.centerWorld.set(0, 0, 0), this._update(A) }, e.prototype.scale = function (e) { var t = this.radius * e, i = P.Tmp.Vector3[0].set(t, t, t), r = P.Tmp.Vector3[1].copyFrom(this.center).subtractInPlace(i), n = P.Tmp.Vector3[2].copyFrom(this.center).addInPlace(i); return this.reConstruct(r, n), this }, e.prototype._update = function (e) { P.Vector3.TransformCoordinatesToRef(this.center, e, this.centerWorld); var t = P.Tmp.Vector3[0]; P.Vector3.TransformNormalFromFloatsToRef(1, 1, 1, e, t), this.radiusWorld = Math.max(Math.abs(t.x), Math.abs(t.y), Math.abs(t.z)) * this.radius }, e.prototype.isInFrustum = function (e) { for (var t = 0; t < 6; t++)if (e[t].dotCoordinate(this.centerWorld) <= -this.radiusWorld) return !1; return !0 }, e.prototype.intersectsPoint = function (e) { var t = this.centerWorld.x - e.x, i = this.centerWorld.y - e.y, r = this.centerWorld.z - e.z, n = Math.sqrt(t * t + i * i + r * r); return !(this.radiusWorld < n) }, e.Intersects = function (e, t) { var i = e.centerWorld.x - t.centerWorld.x, r = e.centerWorld.y - t.centerWorld.y, n = e.centerWorld.z - t.centerWorld.z, o = Math.sqrt(i * i + r * r + n * n); return !(e.radiusWorld + t.radiusWorld < o) }, e }(), P.BoundingSphere = S, M = $a || ($a = {}), R = function () { function e(e, t) { this.vectors = [M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero()], this.center = M.Vector3.Zero(), this.centerWorld = M.Vector3.Zero(), this.extendSize = M.Vector3.Zero(), this.extendSizeWorld = M.Vector3.Zero(), this.directions = [M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero()], this.vectorsWorld = [M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero(), M.Vector3.Zero()], this.minimumWorld = M.Vector3.Zero(), this.maximumWorld = M.Vector3.Zero(), this.minimum = M.Vector3.Zero(), this.maximum = M.Vector3.Zero(), this.reConstruct(e, t) } return e.prototype.reConstruct = function (e, t) { this.minimum.copyFrom(e), this.maximum.copyFrom(t), this.vectors[0].copyFrom(this.minimum), this.vectors[1].copyFrom(this.maximum), this.vectors[2].copyFrom(this.minimum), this.vectors[3].copyFrom(this.minimum), this.vectors[4].copyFrom(this.minimum), this.vectors[5].copyFrom(this.maximum), this.vectors[6].copyFrom(this.maximum), this.vectors[7].copyFrom(this.maximum), this.vectors[2].x = this.maximum.x, this.vectors[3].y = this.maximum.y, this.vectors[4].z = this.maximum.z, this.vectors[5].z = this.minimum.z, this.vectors[6].x = this.minimum.x, this.vectors[7].y = this.minimum.y, this.center.copyFrom(this.maximum).addInPlace(this.minimum).scaleInPlace(.5), this.extendSize.copyFrom(this.maximum).subtractInPlace(this.minimum).scaleInPlace(.5); for (var i = 0; i < 3; i++)this.directions[i].copyFromFloats(0, 0, 0); for (i = 0; i < 8; i++)this.vectorsWorld[i].copyFromFloats(0, 0, 0); this.minimumWorld.copyFromFloats(0, 0, 0), this.maximumWorld.copyFromFloats(0, 0, 0), this.centerWorld.copyFromFloats(0, 0, 0), this.extendSizeWorld.copyFromFloats(0, 0, 0), this._update(this._worldMatrix || M.Matrix.Identity()) }, e.prototype.scale = function (e) { var t = M.Tmp.Vector3[0].copyFrom(this.maximum).subtractInPlace(this.minimum), i = t.length() * e; t.normalize(); var r = t.scaleInPlace(.5 * i), n = M.Tmp.Vector3[1].copyFrom(this.center).subtractInPlace(r), o = M.Tmp.Vector3[2].copyFrom(this.center).addInPlace(r); return this.reConstruct(n, o), this }, e.prototype.getWorldMatrix = function () { return this._worldMatrix }, e.prototype.setWorldMatrix = function (e) { return this._worldMatrix.copyFrom(e), this }, e.prototype._update = function (e) { M.Vector3.FromFloatsToRef(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, this.minimumWorld), M.Vector3.FromFloatsToRef(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE, this.maximumWorld); for (var t = 0; t < 8; t++) { var i = this.vectorsWorld[t]; M.Vector3.TransformCoordinatesToRef(this.vectors[t], e, i), this.minimumWorld.minimizeInPlace(i), this.maximumWorld.maximizeInPlace(i) } this.maximumWorld.subtractToRef(this.minimumWorld, this.extendSizeWorld), this.extendSizeWorld.scaleInPlace(.5), this.maximumWorld.addToRef(this.minimumWorld, this.centerWorld), this.centerWorld.scaleInPlace(.5), M.Vector3.FromFloatArrayToRef(e.m, 0, this.directions[0]), M.Vector3.FromFloatArrayToRef(e.m, 4, this.directions[1]), M.Vector3.FromFloatArrayToRef(e.m, 8, this.directions[2]), this._worldMatrix = e }, e.prototype.isInFrustum = function (t) { return e.IsInFrustum(this.vectorsWorld, t) }, e.prototype.isCompletelyInFrustum = function (t) { return e.IsCompletelyInFrustum(this.vectorsWorld, t) }, e.prototype.intersectsPoint = function (e) { var t = -M.Epsilon; return !(this.maximumWorld.x - e.x < t || t > e.x - this.minimumWorld.x || this.maximumWorld.y - e.y < t || t > e.y - this.minimumWorld.y || this.maximumWorld.z - e.z < t || t > e.z - this.minimumWorld.z) }, e.prototype.intersectsSphere = function (t) { return e.IntersectsSphere(this.minimumWorld, this.maximumWorld, t.centerWorld, t.radiusWorld) }, e.prototype.intersectsMinMax = function (e, t) { return !(this.maximumWorld.x < e.x || this.minimumWorld.x > t.x || this.maximumWorld.y < e.y || this.minimumWorld.y > t.y || this.maximumWorld.z < e.z || this.minimumWorld.z > t.z) }, e.Intersects = function (e, t) { return !(e.maximumWorld.x < t.minimumWorld.x || e.minimumWorld.x > t.maximumWorld.x || e.maximumWorld.y < t.minimumWorld.y || e.minimumWorld.y > t.maximumWorld.y || e.maximumWorld.z < t.minimumWorld.z || e.minimumWorld.z > t.maximumWorld.z) }, e.IntersectsSphere = function (e, t, i, r) { var n = M.Vector3.Clamp(i, e, t); return M.Vector3.DistanceSquared(i, n) <= r * r }, e.IsCompletelyInFrustum = function (e, t) { for (var i = 0; i < 6; i++)for (var r = 0; r < 8; r++)if (t[i].dotCoordinate(e[r]) < 0) return !1; return !0 }, e.IsInFrustum = function (e, t) { for (var i = 0; i < 6; i++) { for (var r = 8, n = 0; n < 8 && t[i].dotCoordinate(e[n]) < 0; n++)--r; if (0 === r) return !1 } return !0 }, e }(), M.BoundingBox = R, C = $a || ($a = {}), O = function (e, t) { var i = C.Vector3.Dot(t.centerWorld, e), r = Math.abs(C.Vector3.Dot(t.directions[0], e)) * t.extendSize.x + Math.abs(C.Vector3.Dot(t.directions[1], e)) * t.extendSize.y + Math.abs(C.Vector3.Dot(t.directions[2], e)) * t.extendSize.z; return { min: i - r, max: i + r } }, D = function (e, t, i) { var r, n, o, s = O(e, t), a = O(e, i); return r = s.min, n = s.max, o = a.min, !(a.max < r || n < o) }, I = function () { function e(e, t) { this._isLocked = !1, this.boundingBox = new C.BoundingBox(e, t), this.boundingSphere = new C.BoundingSphere(e, t) } return Object.defineProperty(e.prototype, "minimum", { get: function () { return this.boundingBox.minimum }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "maximum", { get: function () { return this.boundingBox.maximum }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "isLocked", { get: function () { return this._isLocked }, set: function (e) { this._isLocked = e }, enumerable: !0, configurable: !0 }), e.prototype.update = function (e) { this._isLocked || (this.boundingBox._update(e), this.boundingSphere._update(e)) }, e.prototype.centerOn = function (e, t) { var i = C.Tmp.Vector3[0].copyFrom(e).subtractInPlace(t), r = C.Tmp.Vector3[1].copyFrom(e).addInPlace(t); return this.boundingBox.reConstruct(i, r), this.boundingSphere.reConstruct(i, r), this }, e.prototype.scale = function (e) { return this.boundingBox.scale(e), this.boundingSphere.scale(e), this }, e.prototype.isInFrustum = function (e, t) { return void 0 === t && (t = C.AbstractMesh.CULLINGSTRATEGY_STANDARD), !!this.boundingSphere.isInFrustum(e) && (t === C.AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY || this.boundingBox.isInFrustum(e)) }, Object.defineProperty(e.prototype, "diagonalLength", { get: function () { var e = this.boundingBox; return e.maximumWorld.subtract(e.minimumWorld).length() }, enumerable: !0, configurable: !0 }), e.prototype.isCompletelyInFrustum = function (e) { return this.boundingBox.isCompletelyInFrustum(e) }, e.prototype._checkCollision = function (e) { return e._canDoCollision(this.boundingSphere.centerWorld, this.boundingSphere.radiusWorld, this.boundingBox.minimumWorld, this.boundingBox.maximumWorld) }, e.prototype.intersectsPoint = function (e) { return !!this.boundingSphere.centerWorld && !!this.boundingSphere.intersectsPoint(e) && !!this.boundingBox.intersectsPoint(e) }, e.prototype.intersects = function (e, t) { if (!this.boundingSphere.centerWorld || !e.boundingSphere.centerWorld) return !1; if (!C.BoundingSphere.Intersects(this.boundingSphere, e.boundingSphere)) return !1; if (!C.BoundingBox.Intersects(this.boundingBox, e.boundingBox)) return !1; if (!t) return !0; var i = this.boundingBox, r = e.boundingBox; return !!(D(i.directions[0], i, r) && D(i.directions[1], i, r) && D(i.directions[2], i, r) && D(r.directions[0], i, r) && D(r.directions[1], i, r) && D(r.directions[2], i, r) && D(C.Vector3.Cross(i.directions[0], r.directions[0]), i, r) && D(C.Vector3.Cross(i.directions[0], r.directions[1]), i, r) && D(C.Vector3.Cross(i.directions[0], r.directions[2]), i, r) && D(C.Vector3.Cross(i.directions[1], r.directions[0]), i, r) && D(C.Vector3.Cross(i.directions[1], r.directions[1]), i, r) && D(C.Vector3.Cross(i.directions[1], r.directions[2]), i, r) && D(C.Vector3.Cross(i.directions[2], r.directions[0]), i, r) && D(C.Vector3.Cross(i.directions[2], r.directions[1]), i, r) && D(C.Vector3.Cross(i.directions[2], r.directions[2]), i, r)) }, e }(), C.BoundingInfo = I, L = function (e) { function t(i, r, n) { void 0 === r && (r = null), void 0 === n && (n = !0); var o = e.call(this, i, r) || this; return o._forward = new w.Vector3(0, 0, 1), o._forwardInverted = new w.Vector3(0, 0, -1), o._up = new w.Vector3(0, 1, 0), o._right = new w.Vector3(1, 0, 0), o._rightInverted = new w.Vector3(-1, 0, 0), o._position = w.Vector3.Zero(), o._rotation = w.Vector3.Zero(), o._scaling = w.Vector3.One(), o._isDirty = !1, o.billboardMode = t.BILLBOARDMODE_NONE, o.scalingDeterminant = 1, o.infiniteDistance = !1, o.ignoreNonUniformScaling = !1, o._localWorld = w.Matrix.Zero(), o._absolutePosition = w.Vector3.Zero(), o._pivotMatrix = w.Matrix.Identity(), o._postMultiplyPivotMatrix = !1, o._isWorldMatrixFrozen = !1, o.onAfterWorldMatrixUpdateObservable = new w.Observable, o._nonUniformScaling = !1, n && o.getScene().addTransformNode(o), o } return T(t, e), t.prototype.getClassName = function () { return "TransformNode" }, Object.defineProperty(t.prototype, "position", { get: function () { return this._position }, set: function (e) { this._position = e, this._isDirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "rotation", { get: function () { return this._rotation }, set: function (e) { this._rotation = e, this._isDirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "scaling", { get: function () { return this._scaling }, set: function (e) { this._scaling = e, this._isDirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "rotationQuaternion", { get: function () { return this._rotationQuaternion }, set: function (e) { (this._rotationQuaternion = e) && this.rotation.length() && this.rotation.copyFromFloats(0, 0, 0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "forward", { get: function () { return w.Vector3.Normalize(w.Vector3.TransformNormal(this.getScene().useRightHandedSystem ? this._forwardInverted : this._forward, this.getWorldMatrix())) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "up", { get: function () { return w.Vector3.Normalize(w.Vector3.TransformNormal(this._up, this.getWorldMatrix())) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "right", { get: function () { return w.Vector3.Normalize(w.Vector3.TransformNormal(this.getScene().useRightHandedSystem ? this._rightInverted : this._right, this.getWorldMatrix())) }, enumerable: !0, configurable: !0 }), t.prototype.updatePoseMatrix = function (e) { return this._poseMatrix.copyFrom(e), this }, t.prototype.getPoseMatrix = function () { return this._poseMatrix }, t.prototype._isSynchronized = function () { return !(this._isDirty || this.billboardMode !== this._cache.billboardMode || this.billboardMode !== t.BILLBOARDMODE_NONE || this._cache.pivotMatrixUpdated || this.infiniteDistance || !this._cache.position.equals(this._position) || this._rotationQuaternion && !this._cache.rotationQuaternion.equals(this._rotationQuaternion) || !this._cache.rotation.equals(this._rotation) || !this._cache.scaling.equals(this._scaling)) }, t.prototype._initCache = function () { e.prototype._initCache.call(this), this._cache.localMatrixUpdated = !1, this._cache.position = w.Vector3.Zero(), this._cache.scaling = w.Vector3.Zero(), this._cache.rotation = w.Vector3.Zero(), this._cache.rotationQuaternion = new w.Quaternion(0, 0, 0, 0), this._cache.billboardMode = -1 }, t.prototype.markAsDirty = function (e) { return "rotation" === e && (this.rotationQuaternion = null), this._currentRenderId = Number.MAX_VALUE, this._isDirty = !0, this }, Object.defineProperty(t.prototype, "absolutePosition", { get: function () { return this._absolutePosition }, enumerable: !0, configurable: !0 }), t.prototype.setPreTransformMatrix = function (e) { return this.setPivotMatrix(e, !1) }, t.prototype.setPivotMatrix = function (e, t) { return void 0 === t && (t = !0), this._pivotMatrix = e.clone(), this._cache.pivotMatrixUpdated = !0, this._postMultiplyPivotMatrix = t, this._postMultiplyPivotMatrix && (this._pivotMatrixInverse ? this._pivotMatrix.invertToRef(this._pivotMatrixInverse) : this._pivotMatrixInverse = w.Matrix.Invert(this._pivotMatrix)), this }, t.prototype.getPivotMatrix = function () { return this._pivotMatrix }, t.prototype.freezeWorldMatrix = function () { return this._isWorldMatrixFrozen = !1, this.computeWorldMatrix(!0), this._isWorldMatrixFrozen = !0, this }, t.prototype.unfreezeWorldMatrix = function () { return this._isWorldMatrixFrozen = !1, this.computeWorldMatrix(!0), this }, Object.defineProperty(t.prototype, "isWorldMatrixFrozen", { get: function () { return this._isWorldMatrixFrozen }, enumerable: !0, configurable: !0 }), t.prototype.getAbsolutePosition = function () { return this.computeWorldMatrix(), this._absolutePosition }, t.prototype.setAbsolutePosition = function (e) { if (!e) return this; var t, i, r; if (void 0 === e.x) { if (arguments.length < 3) return this; t = e, i = arguments[1], r = arguments[2] } else t = e.x, i = e.y, r = e.z; if (this.parent) { var n = this.parent.getWorldMatrix().clone(); n.invert(); var o = new w.Vector3(t, i, r); this.position = w.Vector3.TransformCoordinates(o, n) } else this.position.x = t, this.position.y = i, this.position.z = r; return this }, t.prototype.setPositionWithLocalVector = function (e) { return this.computeWorldMatrix(), this.position = w.Vector3.TransformNormal(e, this._localWorld), this }, t.prototype.getPositionExpressedInLocalSpace = function () { this.computeWorldMatrix(); var e = this._localWorld.clone(); return e.invert(), w.Vector3.TransformNormal(this.position, e) }, t.prototype.locallyTranslate = function (e) { return this.computeWorldMatrix(!0), this.position = w.Vector3.TransformCoordinates(e, this._localWorld), this }, t.prototype.lookAt = function (e, i, r, n, o) { void 0 === i && (i = 0), void 0 === r && (r = 0), void 0 === n && (n = 0), void 0 === o && (o = w.Space.LOCAL); var s = t._lookAtVectorCache, a = o === w.Space.LOCAL ? this.position : this.getAbsolutePosition(); e.subtractToRef(a, s); var l = -Math.atan2(s.z, s.x) - Math.PI / 2, c = Math.sqrt(s.x * s.x + s.z * s.z), h = Math.atan2(s.y, c); return this.rotationQuaternion ? w.Quaternion.RotationYawPitchRollToRef(l + i, h + r, n, this.rotationQuaternion) : (this.rotation.x = h + r, this.rotation.y = l + i, this.rotation.z = n), this }, t.prototype.getDirection = function (e) { var t = w.Vector3.Zero(); return this.getDirectionToRef(e, t), t }, t.prototype.getDirectionToRef = function (e, t) { return w.Vector3.TransformNormalToRef(e, this.getWorldMatrix(), t), this }, t.prototype.setPivotPoint = function (e, t) { void 0 === t && (t = w.Space.LOCAL), 0 == this.getScene().getRenderId() && this.computeWorldMatrix(!0); var i = this.getWorldMatrix(); if (t == w.Space.WORLD) { var r = w.Tmp.Matrix[0]; i.invertToRef(r), e = w.Vector3.TransformCoordinates(e, r) } return this.setPivotMatrix(w.Matrix.Translation(-e.x, -e.y, -e.z), !0) }, t.prototype.getPivotPoint = function () { var e = w.Vector3.Zero(); return this.getPivotPointToRef(e), e }, t.prototype.getPivotPointToRef = function (e) { return e.x = -this._pivotMatrix.m[12], e.y = -this._pivotMatrix.m[13], e.z = -this._pivotMatrix.m[14], this }, t.prototype.getAbsolutePivotPoint = function () { var e = w.Vector3.Zero(); return this.getAbsolutePivotPointToRef(e), e }, t.prototype.getAbsolutePivotPointToRef = function (e) { return e.x = this._pivotMatrix.m[12], e.y = this._pivotMatrix.m[13], e.z = this._pivotMatrix.m[14], this.getPivotPointToRef(e), w.Vector3.TransformCoordinatesToRef(e, this.getWorldMatrix(), e), this }, t.prototype.setParent = function (e) { if (!e && !this.parent) return this; if (e) { r = w.Tmp.Quaternion[0], n = w.Tmp.Vector3[0], o = w.Tmp.Vector3[1]; var t = w.Tmp.Matrix[0], i = w.Tmp.Matrix[1]; this.computeWorldMatrix(!0), e.computeWorldMatrix(!0), e.getWorldMatrix().invertToRef(i), this.getWorldMatrix().multiplyToRef(i, t), t.decompose(o, r, n), this.rotationQuaternion ? this.rotationQuaternion.copyFrom(r) : r.toEulerAnglesToRef(this.rotation), this.position.x = n.x, this.position.y = n.y, this.position.z = n.z, this.scaling.x = o.x, this.scaling.y = o.y, this.scaling.z = o.z } else { var r = w.Tmp.Quaternion[0], n = w.Tmp.Vector3[0], o = w.Tmp.Vector3[1]; this.parent && this.parent.computeWorldMatrix && this.parent.computeWorldMatrix(!0), this.computeWorldMatrix(!0), this.getWorldMatrix().decompose(o, r, n), this.rotationQuaternion ? this.rotationQuaternion.copyFrom(r) : r.toEulerAnglesToRef(this.rotation), this.scaling.x = o.x, this.scaling.y = o.y, this.scaling.z = o.z, this.position.x = n.x, this.position.y = n.y, this.position.z = n.z } return this.parent = e, this }, Object.defineProperty(t.prototype, "nonUniformScaling", { get: function () { return this._nonUniformScaling }, enumerable: !0, configurable: !0 }), t.prototype._updateNonUniformScalingState = function (e) { return this._nonUniformScaling !== e && (this._nonUniformScaling = e, !0) }, t.prototype.attachToBone = function (e, t) { return this._transformToBoneReferal = t, (this.parent = e).getWorldMatrix().determinant() < 0 && (this.scalingDeterminant *= -1), this }, t.prototype.detachFromBone = function () { return this.parent && (this.parent.getWorldMatrix().determinant() < 0 && (this.scalingDeterminant *= -1), this._transformToBoneReferal = null, this.parent = null), this }, t.prototype.rotate = function (e, i, r) { var n; if (e.normalize(), this.rotationQuaternion || (this.rotationQuaternion = w.Quaternion.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z), this.rotation = w.Vector3.Zero()), r && r !== w.Space.LOCAL) { if (this.parent) { var o = this.parent.getWorldMatrix().clone(); o.invert(), e = w.Vector3.TransformNormal(e, o) } (n = w.Quaternion.RotationAxisToRef(e, i, t._rotationAxisCache)).multiplyToRef(this.rotationQuaternion, this.rotationQuaternion) } else n = w.Quaternion.RotationAxisToRef(e, i, t._rotationAxisCache), this.rotationQuaternion.multiplyToRef(n, this.rotationQuaternion); return this }, t.prototype.rotateAround = function (e, t, i) { return t.normalize(), this.rotationQuaternion || (this.rotationQuaternion = w.Quaternion.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z), this.rotation.copyFromFloats(0, 0, 0)), e.subtractToRef(this.position, w.Tmp.Vector3[0]), w.Matrix.TranslationToRef(w.Tmp.Vector3[0].x, w.Tmp.Vector3[0].y, w.Tmp.Vector3[0].z, w.Tmp.Matrix[0]), w.Tmp.Matrix[0].invertToRef(w.Tmp.Matrix[2]), w.Matrix.RotationAxisToRef(t, i, w.Tmp.Matrix[1]), w.Tmp.Matrix[2].multiplyToRef(w.Tmp.Matrix[1], w.Tmp.Matrix[2]), w.Tmp.Matrix[2].multiplyToRef(w.Tmp.Matrix[0], w.Tmp.Matrix[2]), w.Tmp.Matrix[2].decompose(w.Tmp.Vector3[0], w.Tmp.Quaternion[0], w.Tmp.Vector3[1]), this.position.addInPlace(w.Tmp.Vector3[1]), w.Tmp.Quaternion[0].multiplyToRef(this.rotationQuaternion, this.rotationQuaternion), this }, t.prototype.translate = function (e, t, i) { var r = e.scale(t); if (i && i !== w.Space.LOCAL) this.setAbsolutePosition(this.getAbsolutePosition().add(r)); else { var n = this.getPositionExpressedInLocalSpace().add(r); this.setPositionWithLocalVector(n) } return this }, t.prototype.addRotation = function (e, t, i) { var r; this.rotationQuaternion ? r = this.rotationQuaternion : (r = w.Tmp.Quaternion[1], w.Quaternion.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, r)); var n = w.Tmp.Quaternion[0]; return w.Quaternion.RotationYawPitchRollToRef(t, e, i, n), r.multiplyInPlace(n), this.rotationQuaternion || r.toEulerAnglesToRef(this.rotation), this }, t.prototype.computeWorldMatrix = function (e) { if (this._isWorldMatrixFrozen) return this._worldMatrix; if (!e && this.isSynchronized()) return this._currentRenderId = this.getScene().getRenderId(), this._worldMatrix; this._updateCache(), this._cache.position.copyFrom(this.position), this._cache.scaling.copyFrom(this.scaling), this._cache.pivotMatrixUpdated = !1, this._cache.billboardMode = this.billboardMode, this._currentRenderId = this.getScene().getRenderId(), this._childRenderId = this.getScene().getRenderId(), this._isDirty = !1, w.Matrix.ScalingToRef(this.scaling.x * this.scalingDeterminant, this.scaling.y * this.scalingDeterminant, this.scaling.z * this.scalingDeterminant, w.Tmp.Matrix[1]), this.rotationQuaternion && this.rotation.length() && (this.rotationQuaternion.multiplyInPlace(w.Quaternion.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z)), this.rotation.copyFromFloats(0, 0, 0)), this.rotationQuaternion ? (this.rotationQuaternion.toRotationMatrix(w.Tmp.Matrix[0]), this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)) : (w.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, w.Tmp.Matrix[0]), this._cache.rotation.copyFrom(this.rotation)); var i = this.getScene().activeCamera; if (this.infiniteDistance && !this.parent && i) { var r = i.getWorldMatrix(), n = new w.Vector3(r.m[12], r.m[13], r.m[14]); w.Matrix.TranslationToRef(this.position.x + n.x, this.position.y + n.y, this.position.z + n.z, w.Tmp.Matrix[2]) } else w.Matrix.TranslationToRef(this.position.x, this.position.y, this.position.z, w.Tmp.Matrix[2]); if (this._pivotMatrix.multiplyToRef(w.Tmp.Matrix[1], w.Tmp.Matrix[4]), w.Tmp.Matrix[4].multiplyToRef(w.Tmp.Matrix[0], w.Tmp.Matrix[5]), this.billboardMode !== t.BILLBOARDMODE_NONE && i) { if ((this.billboardMode & t.BILLBOARDMODE_ALL) !== t.BILLBOARDMODE_ALL) { var o = w.Tmp.Vector3[3]; this.parent && this.parent.getWorldMatrix ? this._transformToBoneReferal ? (this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), w.Tmp.Matrix[6]), w.Vector3.TransformCoordinatesToRef(this.position, w.Tmp.Matrix[6], o)) : w.Vector3.TransformCoordinatesToRef(this.position, this.parent.getWorldMatrix(), o) : o.copyFrom(this.position), o.subtractInPlace(i.globalPosition); var s = w.Tmp.Vector3[4].copyFromFloats(0, 0, 0); (this.billboardMode & t.BILLBOARDMODE_X) === t.BILLBOARDMODE_X && (s.x = Math.atan2(-o.y, o.z)), (this.billboardMode & t.BILLBOARDMODE_Y) === t.BILLBOARDMODE_Y && (s.y = Math.atan2(o.x, o.z)), (this.billboardMode & t.BILLBOARDMODE_Z) === t.BILLBOARDMODE_Z && (s.z = Math.atan2(o.y, o.x)), w.Matrix.RotationYawPitchRollToRef(s.y, s.x, s.z, w.Tmp.Matrix[0]) } else w.Tmp.Matrix[1].copyFrom(i.getViewMatrix()), w.Tmp.Matrix[1].setTranslationFromFloats(0, 0, 0), w.Tmp.Matrix[1].invertToRef(w.Tmp.Matrix[0]); w.Tmp.Matrix[1].copyFrom(w.Tmp.Matrix[5]), w.Tmp.Matrix[1].multiplyToRef(w.Tmp.Matrix[0], w.Tmp.Matrix[5]) } return this._postMultiplyPivotMatrix && w.Tmp.Matrix[5].multiplyToRef(this._pivotMatrixInverse, w.Tmp.Matrix[5]), w.Tmp.Matrix[5].multiplyToRef(w.Tmp.Matrix[2], this._localWorld), this.parent && this.parent.getWorldMatrix ? (this.billboardMode !== t.BILLBOARDMODE_NONE ? (this._transformToBoneReferal ? (this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), w.Tmp.Matrix[6]), w.Tmp.Matrix[5].copyFrom(w.Tmp.Matrix[6])) : w.Tmp.Matrix[5].copyFrom(this.parent.getWorldMatrix()), this._localWorld.getTranslationToRef(w.Tmp.Vector3[5]), w.Vector3.TransformCoordinatesToRef(w.Tmp.Vector3[5], w.Tmp.Matrix[5], w.Tmp.Vector3[5]), this._worldMatrix.copyFrom(this._localWorld), this._worldMatrix.setTranslation(w.Tmp.Vector3[5])) : this._transformToBoneReferal ? (this._localWorld.multiplyToRef(this.parent.getWorldMatrix(), w.Tmp.Matrix[6]), w.Tmp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), this._worldMatrix)) : this._localWorld.multiplyToRef(this.parent.getWorldMatrix(), this._worldMatrix), this._markSyncedWithParent()) : this._worldMatrix.copyFrom(this._localWorld), this.ignoreNonUniformScaling ? this._updateNonUniformScalingState(!1) : this.scaling.isNonUniform ? this._updateNonUniformScalingState(!0) : this.parent && this.parent._nonUniformScaling ? this._updateNonUniformScalingState(this.parent._nonUniformScaling) : this._updateNonUniformScalingState(!1), this._afterComputeWorldMatrix(), this._absolutePosition.copyFromFloats(this._worldMatrix.m[12], this._worldMatrix.m[13], this._worldMatrix.m[14]), this.onAfterWorldMatrixUpdateObservable.notifyObservers(this), this._poseMatrix || (this._poseMatrix = w.Matrix.Invert(this._worldMatrix)), this._worldMatrixDeterminant = this._worldMatrix.determinant(), this._worldMatrix }, t.prototype._afterComputeWorldMatrix = function () { }, t.prototype.registerAfterWorldMatrixUpdate = function (e) { return this.onAfterWorldMatrixUpdateObservable.add(e), this }, t.prototype.unregisterAfterWorldMatrixUpdate = function (e) { return this.onAfterWorldMatrixUpdateObservable.removeCallback(e), this }, t.prototype.clone = function (e, i, r) { var n = this, o = w.SerializationHelper.Clone(function () { return new t(e, n.getScene()) }, this); if (o.name = e, o.id = e, i && (o.parent = i), !r) for (var s = this.getDescendants(!0), a = 0; a < s.length; a++) { var l = s[a]; l.clone && l.clone(e + "." + l.name, o) } return o }, t.prototype.serialize = function (e) { var t = w.SerializationHelper.Serialize(this, e); return t.type = this.getClassName(), this.parent && (t.parentId = this.parent.id), w.Tags && w.Tags.HasTags(this) && (t.tags = w.Tags.GetTags(this)), t.localMatrix = this.getPivotMatrix().asArray(), t.isEnabled = this.isEnabled(), this.parent && (t.parentId = this.parent.id), t }, t.Parse = function (e, i, r) { var n = w.SerializationHelper.Parse(function () { return new t(e.name, i) }, e, i, r); return w.Tags && w.Tags.AddTagsTo(n, e.tags), e.localMatrix ? n.setPreTransformMatrix(w.Matrix.FromArray(e.localMatrix)) : e.pivotMatrix && n.setPivotMatrix(w.Matrix.FromArray(e.pivotMatrix)), n.setEnabled(e.isEnabled), e.parentId && (n._waitingParentId = e.parentId), n }, t.prototype.dispose = function (t, i) { void 0 === i && (i = !1), this.getScene().stopAnimation(this), this.getScene().removeTransformNode(this), this.onAfterWorldMatrixUpdateObservable.clear(), e.prototype.dispose.call(this, t, i) }, t.BILLBOARDMODE_NONE = 0, t.BILLBOARDMODE_X = 1, t.BILLBOARDMODE_Y = 2, t.BILLBOARDMODE_Z = 4, t.BILLBOARDMODE_ALL = 7, t._lookAtVectorCache = new w.Vector3(0, 0, 0), t._rotationAxisCache = new w.Quaternion, b([w.serializeAsVector3("position")], t.prototype, "_position", void 0), b([w.serializeAsVector3("rotation")], t.prototype, "_rotation", void 0), b([w.serializeAsQuaternion("rotationQuaternion")], t.prototype, "_rotationQuaternion", void 0), b([w.serializeAsVector3("scaling")], t.prototype, "_scaling", void 0), b([w.serialize()], t.prototype, "billboardMode", void 0), b([w.serialize()], t.prototype, "scalingDeterminant", void 0), b([w.serialize()], t.prototype, "infiniteDistance", void 0), b([w.serialize()], t.prototype, "ignoreNonUniformScaling", void 0), t }((w = $a || ($a = {})).Node), w.TransformNode = L, F = $a || ($a = {}), B = function () { this.facetNb = 0, this.partitioningSubdivisions = 10, this.partitioningBBoxRatio = 1.01, this.facetDataEnabled = !1, this.facetParameters = {}, this.bbSize = F.Vector3.Zero(), this.subDiv = { max: 1, X: 1, Y: 1, Z: 1 }, this.facetDepthSort = !1, this.facetDepthSortEnabled = !1 }, N = function (e) { function t(i, r) { void 0 === r && (r = null); var n = e.call(this, i, r, !1) || this; return n._facetData = new B, n.cullingStrategy = t.CULLINGSTRATEGY_STANDARD, n.onCollideObservable = new F.Observable, n.onCollisionPositionChangeObservable = new F.Observable, n.onMaterialChangedObservable = new F.Observable, n.definedFacingForward = !0, n._visibility = 1, n.alphaIndex = Number.MAX_VALUE, n.isVisible = !0, n.isPickable = !0, n.showSubMeshesBoundingBox = !1, n.isBlocker = !1, n.enablePointerMoveEvents = !1, n.renderingGroupId = 0, n._receiveShadows = !1, n.outlineColor = F.Color3.Red(), n.outlineWidth = .02, n.overlayColor = F.Color3.Red(), n.overlayAlpha = .5, n._hasVertexAlpha = !1, n._useVertexColors = !0, n._computeBonesUsingShaders = !0, n._numBoneInfluencers = 4, n._applyFog = !0, n.useOctreeForRenderingSelection = !0, n.useOctreeForPicking = !0, n.useOctreeForCollisions = !0, n._layerMask = 268435455, n.alwaysSelectAsActiveMesh = !1, n.actionManager = null, n._checkCollisions = !1, n._collisionMask = -1, n._collisionGroup = -1, n.ellipsoid = new F.Vector3(.5, 1, .5), n.ellipsoidOffset = new F.Vector3(0, 0, 0), n._oldPositionForCollisions = new F.Vector3(0, 0, 0), n._diffPositionForCollisions = new F.Vector3(0, 0, 0), n.edgesWidth = 1, n.edgesColor = new F.Color4(1, 0, 0, 1), n._renderId = 0, n._intersectionsInProgress = new Array, n._unIndexed = !1, n._lightSources = new Array, n.onRebuildObservable = new F.Observable, n._onCollisionPositionChange = function (e, t, i) { void 0 === i && (i = null), n.getScene().workerCollisions && t.multiplyInPlace(n._collider._radius), t.subtractToRef(n._oldPositionForCollisions, n._diffPositionForCollisions), n._diffPositionForCollisions.length() > F.Engine.CollisionsEpsilon && n.position.addInPlace(n._diffPositionForCollisions), i && n.onCollideObservable.notifyObservers(i), n.onCollisionPositionChangeObservable.notifyObservers(n.position) }, n.getScene().addMesh(n), n._resyncLightSources(), n } return T(t, e), Object.defineProperty(t, "BILLBOARDMODE_NONE", { get: function () { return F.TransformNode.BILLBOARDMODE_NONE }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "BILLBOARDMODE_X", { get: function () { return F.TransformNode.BILLBOARDMODE_X }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "BILLBOARDMODE_Y", { get: function () { return F.TransformNode.BILLBOARDMODE_Y }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "BILLBOARDMODE_Z", { get: function () { return F.TransformNode.BILLBOARDMODE_Z }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "BILLBOARDMODE_ALL", { get: function () { return F.TransformNode.BILLBOARDMODE_ALL }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "facetNb", { get: function () { return this._facetData.facetNb }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "partitioningSubdivisions", { get: function () { return this._facetData.partitioningSubdivisions }, set: function (e) { this._facetData.partitioningSubdivisions = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "partitioningBBoxRatio", { get: function () { return this._facetData.partitioningBBoxRatio }, set: function (e) { this._facetData.partitioningBBoxRatio = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "mustDepthSortFacets", { get: function () { return this._facetData.facetDepthSort }, set: function (e) { this._facetData.facetDepthSort = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "facetDepthSortFrom", { get: function () { return this._facetData.facetDepthSortFrom }, set: function (e) { this._facetData.facetDepthSortFrom = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "isFacetDataEnabled", { get: function () { return this._facetData.facetDataEnabled }, enumerable: !0, configurable: !0 }), t.prototype._updateNonUniformScalingState = function (t) { return !!e.prototype._updateNonUniformScalingState.call(this, t) && (this._markSubMeshesAsMiscDirty(), !0) }, Object.defineProperty(t.prototype, "onCollide", { set: function (e) { this._onCollideObserver && this.onCollideObservable.remove(this._onCollideObserver), this._onCollideObserver = this.onCollideObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onCollisionPositionChange", { set: function (e) { this._onCollisionPositionChangeObserver && this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver), this._onCollisionPositionChangeObserver = this.onCollisionPositionChangeObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "visibility", { get: function () { return this._visibility }, set: function (e) { this._visibility !== e && (this._visibility = e, this._markSubMeshesAsMiscDirty()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "material", { get: function () { return this._material }, set: function (e) { this._material !== e && (this._material = e, this.onMaterialChangedObservable.hasObservers && this.onMaterialChangedObservable.notifyObservers(this), this.subMeshes && this._unBindEffect()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "receiveShadows", { get: function () { return this._receiveShadows }, set: function (e) { this._receiveShadows !== e && (this._receiveShadows = e, this._markSubMeshesAsLightDirty()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "hasVertexAlpha", { get: function () { return this._hasVertexAlpha }, set: function (e) { this._hasVertexAlpha !== e && (this._hasVertexAlpha = e, this._markSubMeshesAsAttributesDirty(), this._markSubMeshesAsMiscDirty()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "useVertexColors", { get: function () { return this._useVertexColors }, set: function (e) { this._useVertexColors !== e && (this._useVertexColors = e, this._markSubMeshesAsAttributesDirty()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "computeBonesUsingShaders", { get: function () { return this._computeBonesUsingShaders }, set: function (e) { this._computeBonesUsingShaders !== e && (this._computeBonesUsingShaders = e, this._markSubMeshesAsAttributesDirty()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "numBoneInfluencers", { get: function () { return this._numBoneInfluencers }, set: function (e) { this._numBoneInfluencers !== e && (this._numBoneInfluencers = e, this._markSubMeshesAsAttributesDirty()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "applyFog", { get: function () { return this._applyFog }, set: function (e) { this._applyFog !== e && (this._applyFog = e, this._markSubMeshesAsMiscDirty()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "layerMask", { get: function () { return this._layerMask }, set: function (e) { e !== this._layerMask && (this._layerMask = e, this._resyncLightSources()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "collisionMask", { get: function () { return this._collisionMask }, set: function (e) { this._collisionMask = isNaN(e) ? -1 : e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "collisionGroup", { get: function () { return this._collisionGroup }, set: function (e) { this._collisionGroup = isNaN(e) ? -1 : e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "_positions", { get: function () { return null }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "skeleton", { get: function () { return this._skeleton }, set: function (e) { this._skeleton && this._skeleton.needInitialSkinMatrix && this._skeleton._unregisterMeshWithPoseMatrix(this), e && e.needInitialSkinMatrix && e._registerMeshWithPoseMatrix(this), this._skeleton = e, this._skeleton || (this._bonesTransformMatrices = null), this._markSubMeshesAsAttributesDirty() }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "AbstractMesh" }, t.prototype.toString = function (e) { var t = "Name: " + this.name + ", isInstance: " + (this instanceof F.InstancedMesh ? "YES" : "NO"); return t += ", # of submeshes: " + (this.subMeshes ? this.subMeshes.length : 0), this._skeleton && (t += ", skeleton: " + this._skeleton.name), e && (t += ", billboard mode: " + ["NONE", "X", "Y", null, "Z", null, null, "ALL"][this.billboardMode], t += ", freeze wrld mat: " + (this._isWorldMatrixFrozen || this._waitingFreezeWorldMatrix ? "YES" : "NO")), t }, t.prototype._rebuild = function () { if (this.onRebuildObservable.notifyObservers(this), this._occlusionQuery && (this._occlusionQuery = null), this.subMeshes) for (var e = 0, t = this.subMeshes; e < t.length; e++)t[e]._rebuild() }, t.prototype._resyncLightSources = function () { for (var e = this._lightSources.length = 0, t = this.getScene().lights; e < t.length; e++) { var i = t[e]; i.isEnabled() && i.canAffectMesh(this) && this._lightSources.push(i) } this._markSubMeshesAsLightDirty() }, t.prototype._resyncLighSource = function (e) { var t = e.isEnabled() && e.canAffectMesh(this), i = this._lightSources.indexOf(e); if (-1 === i) { if (!t) return; this._lightSources.push(e) } else { if (t) return; this._lightSources.splice(i, 1) } this._markSubMeshesAsLightDirty() }, t.prototype._unBindEffect = function () { for (var e = 0, t = this.subMeshes; e < t.length; e++)t[e].setEffect(null) }, t.prototype._removeLightSource = function (e) { var t = this._lightSources.indexOf(e); -1 !== t && (this._lightSources.splice(t, 1), this._markSubMeshesAsLightDirty()) }, t.prototype._markSubMeshesAsDirty = function (e) { if (this.subMeshes) for (var t = 0, i = this.subMeshes; t < i.length; t++) { var r = i[t]; r._materialDefines && e(r._materialDefines) } }, t.prototype._markSubMeshesAsLightDirty = function () { this._markSubMeshesAsDirty(function (e) { return e.markAsLightDirty() }) }, t.prototype._markSubMeshesAsAttributesDirty = function () { this._markSubMeshesAsDirty(function (e) { return e.markAsAttributesDirty() }) }, t.prototype._markSubMeshesAsMiscDirty = function () { if (this.subMeshes) for (var e = 0, t = this.subMeshes; e < t.length; e++) { var i = t[e].getMaterial(); i && i.markAsDirty(F.Material.MiscDirtyFlag) } }, Object.defineProperty(t.prototype, "scaling", { get: function () { return this._scaling }, set: function (e) { this._scaling = e, this.physicsImpostor && this.physicsImpostor.forceUpdate() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "isBlocked", { get: function () { return !1 }, enumerable: !0, configurable: !0 }), t.prototype.getLOD = function (e) { return this }, t.prototype.getTotalVertices = function () { return 0 }, t.prototype.getIndices = function () { return null }, t.prototype.getVerticesData = function (e) { return null }, t.prototype.setVerticesData = function (e, t, i, r) { return this }, t.prototype.updateVerticesData = function (e, t, i, r) { return this }, t.prototype.setIndices = function (e, t) { return this }, t.prototype.isVerticesDataPresent = function (e) { return !1 }, t.prototype.getBoundingInfo = function () { return this._masterMesh ? this._masterMesh.getBoundingInfo() : (this._boundingInfo || this._updateBoundingInfo(), this._boundingInfo) }, t.prototype.normalizeToUnitCube = function (e) { void 0 === e && (e = !0); var t = this.getHierarchyBoundingVectors(e), i = t.max.subtract(t.min), r = Math.max(i.x, i.y, i.z); if (0 === r) return this; var n = 1 / r; return this.scaling.scaleInPlace(n), this }, t.prototype.setBoundingInfo = function (e) { return this._boundingInfo = e, this }, Object.defineProperty(t.prototype, "useBones", { get: function () { return this.skeleton && this.getScene().skeletonsEnabled && this.isVerticesDataPresent(F.VertexBuffer.MatricesIndicesKind) && this.isVerticesDataPresent(F.VertexBuffer.MatricesWeightsKind) }, enumerable: !0, configurable: !0 }), t.prototype._preActivate = function () { }, t.prototype._preActivateForIntermediateRendering = function (e) { }, t.prototype._activate = function (e) { this._renderId = e }, t.prototype.getWorldMatrix = function () { return this._masterMesh ? this._masterMesh.getWorldMatrix() : e.prototype.getWorldMatrix.call(this) }, t.prototype._getWorldMatrixDeterminant = function () { return this._masterMesh ? this._masterMesh._getWorldMatrixDeterminant() : e.prototype._getWorldMatrixDeterminant.call(this) }, t.prototype.movePOV = function (e, t, i) { return this.position.addInPlace(this.calcMovePOV(e, t, i)), this }, t.prototype.calcMovePOV = function (e, t, i) { var r = new F.Matrix; (this.rotationQuaternion ? this.rotationQuaternion : F.Quaternion.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z)).toRotationMatrix(r); var n = F.Vector3.Zero(), o = this.definedFacingForward ? -1 : 1; return F.Vector3.TransformCoordinatesFromFloatsToRef(e * o, t, i * o, r, n), n }, t.prototype.rotatePOV = function (e, t, i) { return this.rotation.addInPlace(this.calcRotatePOV(e, t, i)), this }, t.prototype.calcRotatePOV = function (e, t, i) { var r = this.definedFacingForward ? 1 : -1; return new F.Vector3(e * r, t, i * r) }, t.prototype.getHierarchyBoundingVectors = function (e, t) { var i, r; void 0 === e && (e = !0), void 0 === t && (t = null), this.getScene().incrementRenderId(), this.computeWorldMatrix(!0); var n = this.getBoundingInfo(); if (this.subMeshes ? (i = n.boundingBox.minimumWorld, r = n.boundingBox.maximumWorld) : (i = new F.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), r = new F.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE)), e) for (var o = 0, s = this.getDescendants(!1); o < s.length; o++) { var a = s[o]; if (a.computeWorldMatrix(!0), (!t || t(a)) && a.getBoundingInfo && 0 !== a.getTotalVertices()) { var l = a.getBoundingInfo().boundingBox, c = l.minimumWorld, h = l.maximumWorld; F.Tools.CheckExtends(c, i, r), F.Tools.CheckExtends(h, i, r) } } return { min: i, max: r } }, t.prototype._updateBoundingInfo = function () { return this._boundingInfo = this._boundingInfo || new F.BoundingInfo(this.absolutePosition, this.absolutePosition), this._boundingInfo.update(this.worldMatrixFromCache), this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache), this }, t.prototype._updateSubMeshesBoundingInfo = function (e) { if (!this.subMeshes) return this; for (var t = this.subMeshes.length, i = 0; i < t; i++) { var r = this.subMeshes[i]; (1 < t || !r.IsGlobal) && r.updateBoundingInfo(e) } return this }, t.prototype._afterComputeWorldMatrix = function () { this._updateBoundingInfo() }, t.prototype.isInFrustum = function (e) { return null !== this._boundingInfo && this._boundingInfo.isInFrustum(e, this.cullingStrategy) }, t.prototype.isCompletelyInFrustum = function (e) { return null !== this._boundingInfo && this._boundingInfo.isCompletelyInFrustum(e) }, t.prototype.intersectsMesh = function (e, t, i) { if (void 0 === t && (t = !1), !this._boundingInfo || !e._boundingInfo) return !1; if (this._boundingInfo.intersects(e._boundingInfo, t)) return !0; if (i) for (var r = 0, n = this.getChildMeshes(); r < n.length; r++)if (n[r].intersectsMesh(e, t, !0)) return !0; return !1 }, t.prototype.intersectsPoint = function (e) { return !!this._boundingInfo && this._boundingInfo.intersectsPoint(e) }, t.prototype.getPositionInCameraSpace = function (e) { return void 0 === e && (e = null), e || (e = this.getScene().activeCamera), F.Vector3.TransformCoordinates(this.absolutePosition, e.getViewMatrix()) }, t.prototype.getDistanceToCamera = function (e) { return void 0 === e && (e = null), e || (e = this.getScene().activeCamera), this.absolutePosition.subtract(e.position).length() }, Object.defineProperty(t.prototype, "checkCollisions", { get: function () { return this._checkCollisions }, set: function (e) { this._checkCollisions = e, this.getScene().workerCollisions && this.getScene().collisionCoordinator.onMeshUpdated(this) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "collider", { get: function () { return this._collider }, enumerable: !0, configurable: !0 }), t.prototype.moveWithCollisions = function (e) { return this.getAbsolutePosition().addToRef(this.ellipsoidOffset, this._oldPositionForCollisions), this._collider || (this._collider = new F.Collider), this._collider._radius = this.ellipsoid, this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions, e, this._collider, 3, this, this._onCollisionPositionChange, this.uniqueId), this }, t.prototype._collideForSubMesh = function (e, t, i) { if (this._generatePointsArray(), !this._positions) return this; if (!e._lastColliderWorldVertices || !e._lastColliderTransformMatrix.equals(t)) { e._lastColliderTransformMatrix = t.clone(), e._lastColliderWorldVertices = [], e._trianglePlanes = []; for (var r = e.verticesStart, n = e.verticesStart + e.verticesCount, o = r; o < n; o++)e._lastColliderWorldVertices.push(F.Vector3.TransformCoordinates(this._positions[o], t)) } return i._collide(e._trianglePlanes, e._lastColliderWorldVertices, this.getIndices(), e.indexStart, e.indexStart + e.indexCount, e.verticesStart, !!e.getMaterial()), i.collisionFound && (i.collidedMesh = this), this }, t.prototype._processCollisionsForSubMeshes = function (e, t) { for (var i = this._scene.getCollidingSubMeshCandidates(this, e), r = i.length, n = 0; n < r; n++) { var o = i.data[n]; 1 < r && !o._checkCollision(e) || this._collideForSubMesh(o, t, e) } return this }, t.prototype._checkCollision = function (e) { if (!this._boundingInfo || !this._boundingInfo._checkCollision(e)) return this; var t = F.Tmp.Matrix[0], i = F.Tmp.Matrix[1]; return F.Matrix.ScalingToRef(1 / e._radius.x, 1 / e._radius.y, 1 / e._radius.z, t), this.worldMatrixFromCache.multiplyToRef(t, i), this._processCollisionsForSubMeshes(e, i), this }, t.prototype._generatePointsArray = function () { return !1 }, t.prototype.intersects = function (e, t) { var i = new F.PickingInfo; if (!(this.subMeshes && this._boundingInfo && e.intersectsSphere(this._boundingInfo.boundingSphere) && e.intersectsBox(this._boundingInfo.boundingBox))) return i; if (!this._generatePointsArray()) return i; for (var r = null, n = this._scene.getIntersectingSubMeshCandidates(this, e), o = n.length, s = 0; s < o; s++) { var a = n.data[s]; if (!(1 < o) || a.canIntersects(e)) { var l = a.intersects(e, this._positions, this.getIndices(), t); if (l && (t || !r || l.distance < r.distance) && ((r = l).subMeshId = s, t)) break } } if (r) { var c = this.getWorldMatrix(), h = F.Vector3.TransformCoordinates(e.origin, c), u = e.direction.clone(); u = u.scale(r.distance); var d = F.Vector3.TransformNormal(u, c), f = h.add(d); return i.hit = !0, i.distance = F.Vector3.Distance(h, f), i.pickedPoint = f, i.pickedMesh = this, i.bu = r.bu || 0, i.bv = r.bv || 0, i.faceId = r.faceId, i.subMeshId = r.subMeshId, i } return i }, t.prototype.clone = function (e, t, i) { return null }, t.prototype.releaseSubMeshes = function () { if (this.subMeshes) for (; this.subMeshes.length;)this.subMeshes[0].dispose(); else this.subMeshes = new Array; return this }, t.prototype.dispose = function (t, i) { var r, n = this; for (void 0 === i && (i = !1), this.getScene().freeActiveMeshes(), this.getScene().freeRenderingGroups(), void 0 !== this.actionManager && null !== this.actionManager && (this.actionManager.dispose(), this.actionManager = null), this._skeleton = null, r = 0; r < this._intersectionsInProgress.length; r++) { var o = this._intersectionsInProgress[r], s = o._intersectionsInProgress.indexOf(this); o._intersectionsInProgress.splice(s, 1) } this._intersectionsInProgress = [], this.getScene().lights.forEach(function (e) { var t = e.includedOnlyMeshes.indexOf(n); -1 !== t && e.includedOnlyMeshes.splice(t, 1), -1 !== (t = e.excludedMeshes.indexOf(n)) && e.excludedMeshes.splice(t, 1); var i = e.getShadowGenerator(); if (i) { var r = i.getShadowMap(); r && r.renderList && -1 !== (t = r.renderList.indexOf(n)) && r.renderList.splice(t, 1) } }), "InstancedMesh" !== this.getClassName() && this.releaseSubMeshes(); var a = this.getScene().getEngine(); if (this._occlusionQuery && (this.isOcclusionQueryInProgress = !1, a.deleteQuery(this._occlusionQuery), this._occlusionQuery = null), a.wipeCaches(), this.getScene().removeMesh(this), i && this.material && this.material.dispose(!1, !0), !t) for (r = 0; r < this.getScene().particleSystems.length; r++)this.getScene().particleSystems[r].emitter === this && (this.getScene().particleSystems[r].dispose(), r--); this._facetData.facetDataEnabled && this.disableFacetData(), this.onAfterWorldMatrixUpdateObservable.clear(), this.onCollideObservable.clear(), this.onCollisionPositionChangeObservable.clear(), this.onRebuildObservable.clear(), e.prototype.dispose.call(this, t, i) }, t.prototype.addChild = function (e) { return e.setParent(this), this }, t.prototype.removeChild = function (e) { return e.setParent(null), this }, t.prototype._initFacetData = function () { var e = this._facetData; e.facetNormals || (e.facetNormals = new Array), e.facetPositions || (e.facetPositions = new Array), e.facetPartitioning || (e.facetPartitioning = new Array), e.facetNb = this.getIndices().length / 3 | 0, e.partitioningSubdivisions = e.partitioningSubdivisions ? e.partitioningSubdivisions : 10, e.partitioningBBoxRatio = e.partitioningBBoxRatio ? e.partitioningBBoxRatio : 1.01; for (var t = 0; t < e.facetNb; t++)e.facetNormals[t] = F.Vector3.Zero(), e.facetPositions[t] = F.Vector3.Zero(); return e.facetDataEnabled = !0, this }, t.prototype.updateFacetData = function () { var e = this._facetData; e.facetDataEnabled || this._initFacetData(); var t = this.getVerticesData(F.VertexBuffer.PositionKind), i = this.getIndices(), r = this.getVerticesData(F.VertexBuffer.NormalKind), n = this.getBoundingInfo(); if (e.facetDepthSort && !e.facetDepthSortEnabled) { if (e.facetDepthSortEnabled = !0, i instanceof Uint16Array) e.depthSortedIndices = new Uint16Array(i); else if (i instanceof Uint32Array) e.depthSortedIndices = new Uint32Array(i); else { for (var o = !1, s = 0; s < i.length; s++)if (65535 < i[s]) { o = !0; break } e.depthSortedIndices = o ? new Uint32Array(i) : new Uint16Array(i) } if (e.facetDepthSortFunction = function (e, t) { return t.sqDistance - e.sqDistance }, !e.facetDepthSortFrom) { var a = this.getScene().activeCamera; e.facetDepthSortFrom = a ? a.position : F.Vector3.Zero() } e.depthSortedFacets = []; for (var l = 0; l < e.facetNb; l++) { var c = { ind: 3 * l, sqDistance: 0 }; e.depthSortedFacets.push(c) } e.invertedMatrix = F.Matrix.Identity(), e.facetDepthSortOrigin = F.Vector3.Zero() } e.bbSize.x = n.maximum.x - n.minimum.x > F.Epsilon ? n.maximum.x - n.minimum.x : F.Epsilon, e.bbSize.y = n.maximum.y - n.minimum.y > F.Epsilon ? n.maximum.y - n.minimum.y : F.Epsilon, e.bbSize.z = n.maximum.z - n.minimum.z > F.Epsilon ? n.maximum.z - n.minimum.z : F.Epsilon; var h = e.bbSize.x > e.bbSize.y ? e.bbSize.x : e.bbSize.y; if (h = h > e.bbSize.z ? h : e.bbSize.z, e.subDiv.max = e.partitioningSubdivisions, e.subDiv.X = Math.floor(e.subDiv.max * e.bbSize.x / h), e.subDiv.Y = Math.floor(e.subDiv.max * e.bbSize.y / h), e.subDiv.Z = Math.floor(e.subDiv.max * e.bbSize.z / h), e.subDiv.X = e.subDiv.X < 1 ? 1 : e.subDiv.X, e.subDiv.Y = e.subDiv.Y < 1 ? 1 : e.subDiv.Y, e.subDiv.Z = e.subDiv.Z < 1 ? 1 : e.subDiv.Z, e.facetParameters.facetNormals = this.getFacetLocalNormals(), e.facetParameters.facetPositions = this.getFacetLocalPositions(), e.facetParameters.facetPartitioning = this.getFacetLocalPartitioning(), e.facetParameters.bInfo = n, e.facetParameters.bbSize = e.bbSize, e.facetParameters.subDiv = e.subDiv, e.facetParameters.ratio = this.partitioningBBoxRatio, e.facetParameters.depthSort = e.facetDepthSort, e.facetDepthSort && e.facetDepthSortEnabled && (this.computeWorldMatrix(!0), this._worldMatrix.invertToRef(e.invertedMatrix), F.Vector3.TransformCoordinatesToRef(e.facetDepthSortFrom, e.invertedMatrix, e.facetDepthSortOrigin), e.facetParameters.distanceTo = e.facetDepthSortOrigin), e.facetParameters.depthSortedFacets = e.depthSortedFacets, F.VertexData.ComputeNormals(t, i, r, e.facetParameters), e.facetDepthSort && e.facetDepthSortEnabled) { e.depthSortedFacets.sort(e.facetDepthSortFunction); var u = e.depthSortedIndices.length / 3 | 0; for (l = 0; l < u; l++) { var d = e.depthSortedFacets[l].ind; e.depthSortedIndices[3 * l] = i[d], e.depthSortedIndices[3 * l + 1] = i[d + 1], e.depthSortedIndices[3 * l + 2] = i[d + 2] } this.updateIndices(e.depthSortedIndices) } return this }, t.prototype.getFacetLocalNormals = function () { return this._facetData.facetNormals || this.updateFacetData(), this._facetData.facetNormals }, t.prototype.getFacetLocalPositions = function () { return this._facetData.facetPositions || this.updateFacetData(), this._facetData.facetPositions }, t.prototype.getFacetLocalPartitioning = function () { return this._facetData.facetPartitioning || this.updateFacetData(), this._facetData.facetPartitioning }, t.prototype.getFacetPosition = function (e) { var t = F.Vector3.Zero(); return this.getFacetPositionToRef(e, t), t }, t.prototype.getFacetPositionToRef = function (e, t) { var i = this.getFacetLocalPositions()[e], r = this.getWorldMatrix(); return F.Vector3.TransformCoordinatesToRef(i, r, t), this }, t.prototype.getFacetNormal = function (e) { var t = F.Vector3.Zero(); return this.getFacetNormalToRef(e, t), t }, t.prototype.getFacetNormalToRef = function (e, t) { var i = this.getFacetLocalNormals()[e]; return F.Vector3.TransformNormalToRef(i, this.getWorldMatrix(), t), this }, t.prototype.getFacetsAtLocalCoordinates = function (e, t, i) { var r = this.getBoundingInfo(), n = this._facetData, o = Math.floor((e - r.minimum.x * n.partitioningBBoxRatio) * n.subDiv.X * n.partitioningBBoxRatio / n.bbSize.x), s = Math.floor((t - r.minimum.y * n.partitioningBBoxRatio) * n.subDiv.Y * n.partitioningBBoxRatio / n.bbSize.y), a = Math.floor((i - r.minimum.z * n.partitioningBBoxRatio) * n.subDiv.Z * n.partitioningBBoxRatio / n.bbSize.z); return o < 0 || o > n.subDiv.max || s < 0 || s > n.subDiv.max || a < 0 || a > n.subDiv.max ? null : n.facetPartitioning[o + n.subDiv.max * s + n.subDiv.max * n.subDiv.max * a] }, t.prototype.getClosestFacetAtCoordinates = function (e, t, i, r, n, o) { void 0 === n && (n = !1), void 0 === o && (o = !0); var s = this.getWorldMatrix(), a = F.Tmp.Matrix[5]; s.invertToRef(a); var l = F.Tmp.Vector3[8]; F.Vector3.TransformCoordinatesFromFloatsToRef(e, t, i, a, l); var c = this.getClosestFacetAtLocalCoordinates(l.x, l.y, l.z, r, n, o); return r && F.Vector3.TransformCoordinatesFromFloatsToRef(r.x, r.y, r.z, s, r), c }, t.prototype.getClosestFacetAtLocalCoordinates = function (e, t, i, r, n, o) { void 0 === n && (n = !1), void 0 === o && (o = !0); var s = null, a = 0, l = 0, c = 0, h = 0, u = 0, d = 0, f = 0, p = 0, _ = this.getFacetLocalPositions(), m = this.getFacetLocalNormals(), g = this.getFacetsAtLocalCoordinates(e, t, i); if (!g) return null; for (var v, y, b, T = Number.MAX_VALUE, E = T, x = 0; x < g.length; x++)y = m[v = g[x]], h = (e - (b = _[v]).x) * y.x + (t - b.y) * y.y + (i - b.z) * y.z, (!n || n && o && 0 <= h || n && !o && h <= 0) && (h = y.x * b.x + y.y * b.y + y.z * b.z, u = -(y.x * e + y.y * t + y.z * i - h) / (y.x * y.x + y.y * y.y + y.z * y.z), (E = (a = (d = e + y.x * u) - e) * a + (l = (f = t + y.y * u) - t) * l + (c = (p = i + y.z * u) - i) * c) < T && (T = E, s = v, r && (r.x = d, r.y = f, r.z = p))); return s }, t.prototype.getFacetDataParameters = function () { return this._facetData.facetParameters }, t.prototype.disableFacetData = function () { return this._facetData.facetDataEnabled && (this._facetData.facetDataEnabled = !1, this._facetData.facetPositions = new Array, this._facetData.facetNormals = new Array, this._facetData.facetPartitioning = new Array, this._facetData.facetParameters = null, this._facetData.depthSortedIndices = new Uint32Array(0)), this }, t.prototype.updateIndices = function (e) { return this }, t.prototype.createNormals = function (e) { var t, i = this.getVerticesData(F.VertexBuffer.PositionKind), r = this.getIndices(); return t = this.isVerticesDataPresent(F.VertexBuffer.NormalKind) ? this.getVerticesData(F.VertexBuffer.NormalKind) : [], F.VertexData.ComputeNormals(i, r, t, { useRightHandedSystem: this.getScene().useRightHandedSystem }), this.setVerticesData(F.VertexBuffer.NormalKind, t, e), this }, t.prototype.alignWithNormal = function (e, t) { t || (t = F.Axis.Y); var i = F.Tmp.Vector3[0], r = F.Tmp.Vector3[1]; return F.Vector3.CrossToRef(t, e, r), F.Vector3.CrossToRef(e, r, i), this.rotationQuaternion ? F.Quaternion.RotationQuaternionFromAxisToRef(i, e, r, this.rotationQuaternion) : F.Vector3.RotationFromAxisToRef(i, e, r, this.rotation), this }, t.prototype._checkOcclusionQuery = function () { return !1 }, t.OCCLUSION_TYPE_NONE = 0, t.OCCLUSION_TYPE_OPTIMISTIC = 1, t.OCCLUSION_TYPE_STRICT = 2, t.OCCLUSION_ALGORITHM_TYPE_ACCURATE = 0, t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE = 1, t.CULLINGSTRATEGY_STANDARD = 0, t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY = 1, t }(F.TransformNode), F.AbstractMesh = N, U = function (e) { function t(i, r) { var n = e.call(this, i, r) || this; return n.diffuse = new V.Color3(1, 1, 1), n.specular = new V.Color3(1, 1, 1), n.falloffType = t.FALLOFF_DEFAULT, n.intensity = 1, n._range = Number.MAX_VALUE, n._inverseSquaredRange = 0, n._photometricScale = 1, n._intensityMode = t.INTENSITYMODE_AUTOMATIC, n._radius = 1e-5, n.renderPriority = 0, n._shadowEnabled = !0, n._excludeWithLayerMask = 0, n._includeOnlyWithLayerMask = 0, n._lightmapMode = 0, n._excludedMeshesIds = new Array, n._includedOnlyMeshesIds = new Array, n.getScene().addLight(n), n._uniformBuffer = new V.UniformBuffer(n.getScene().getEngine()), n._buildUniformLayout(), n.includedOnlyMeshes = new Array, n.excludedMeshes = new Array, n._resyncMeshes(), n } return T(t, e), Object.defineProperty(t.prototype, "range", { get: function () { return this._range }, set: function (e) { this._range = e, this._inverseSquaredRange = 1 / (this.range * this.range) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "intensityMode", { get: function () { return this._intensityMode }, set: function (e) { this._intensityMode = e, this._computePhotometricScale() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "radius", { get: function () { return this._radius }, set: function (e) { this._radius = e, this._computePhotometricScale() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "shadowEnabled", { get: function () { return this._shadowEnabled }, set: function (e) { this._shadowEnabled !== e && (this._shadowEnabled = e, this._markMeshesAsLightDirty()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "includedOnlyMeshes", { get: function () { return this._includedOnlyMeshes }, set: function (e) { this._includedOnlyMeshes = e, this._hookArrayForIncludedOnly(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "excludedMeshes", { get: function () { return this._excludedMeshes }, set: function (e) { this._excludedMeshes = e, this._hookArrayForExcluded(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "excludeWithLayerMask", { get: function () { return this._excludeWithLayerMask }, set: function (e) { this._excludeWithLayerMask = e, this._resyncMeshes() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "includeOnlyWithLayerMask", { get: function () { return this._includeOnlyWithLayerMask }, set: function (e) { this._includeOnlyWithLayerMask = e, this._resyncMeshes() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "lightmapMode", { get: function () { return this._lightmapMode }, set: function (e) { this._lightmapMode !== e && (this._lightmapMode = e, this._markMeshesAsLightDirty()) }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "Light" }, t.prototype.toString = function (e) { var t = "Name: " + this.name; if (t += ", type: " + ["Point", "Directional", "Spot", "Hemispheric"][this.getTypeID()], this.animations) for (var i = 0; i < this.animations.length; i++)t += ", animation[0]: " + this.animations[i].toString(e); return t }, t.prototype._syncParentEnabledState = function () { e.prototype._syncParentEnabledState.call(this), this._resyncMeshes() }, t.prototype.setEnabled = function (t) { e.prototype.setEnabled.call(this, t), this._resyncMeshes() }, t.prototype.getShadowGenerator = function () { return this._shadowGenerator }, t.prototype.getAbsolutePosition = function () { return V.Vector3.Zero() }, t.prototype.canAffectMesh = function (e) { return !(e && (this.includedOnlyMeshes && 0 < this.includedOnlyMeshes.length && -1 === this.includedOnlyMeshes.indexOf(e) || this.excludedMeshes && 0 < this.excludedMeshes.length && -1 !== this.excludedMeshes.indexOf(e) || 0 !== this.includeOnlyWithLayerMask && 0 == (this.includeOnlyWithLayerMask & e.layerMask) || 0 !== this.excludeWithLayerMask && this.excludeWithLayerMask & e.layerMask)) }, t.CompareLightsPriority = function (e, t) { return e.shadowEnabled !== t.shadowEnabled ? (t.shadowEnabled ? 1 : 0) - (e.shadowEnabled ? 1 : 0) : t.renderPriority - e.renderPriority }, t.prototype.dispose = function (t, i) { void 0 === i && (i = !1), this._shadowGenerator && (this._shadowGenerator.dispose(), this._shadowGenerator = null), this.getScene().stopAnimation(this); for (var r = 0, n = this.getScene().meshes; r < n.length; r++)n[r]._removeLightSource(this); this._uniformBuffer.dispose(), this.getScene().removeLight(this), e.prototype.dispose.call(this, t, i) }, t.prototype.getTypeID = function () { return 0 }, t.prototype.getScaledIntensity = function () { return this._photometricScale * this.intensity }, t.prototype.clone = function (e) { var i = t.GetConstructorFromName(this.getTypeID(), e, this.getScene()); return i ? V.SerializationHelper.Clone(i, this) : null }, t.prototype.serialize = function () { var e = V.SerializationHelper.Serialize(this); return e.type = this.getTypeID(), this.parent && (e.parentId = this.parent.id), 0 < this.excludedMeshes.length && (e.excludedMeshesIds = [], this.excludedMeshes.forEach(function (t) { e.excludedMeshesIds.push(t.id) })), 0 < this.includedOnlyMeshes.length && (e.includedOnlyMeshesIds = [], this.includedOnlyMeshes.forEach(function (t) { e.includedOnlyMeshesIds.push(t.id) })), V.Animation.AppendSerializedAnimations(this, e), e.ranges = this.serializeAnimationRanges(), e }, t.GetConstructorFromName = function (e, t, i) { return V.Node.Construct("Light_Type_" + e, t, i) || null }, t.Parse = function (e, i) { var r = t.GetConstructorFromName(e.type, e.name, i); if (!r) return null; var n = V.SerializationHelper.Parse(r, e, i); if (e.excludedMeshesIds && (n._excludedMeshesIds = e.excludedMeshesIds), e.includedOnlyMeshesIds && (n._includedOnlyMeshesIds = e.includedOnlyMeshesIds), e.parentId && (n._waitingParentId = e.parentId), e.animations) { for (var o = 0; o < e.animations.length; o++) { var s = e.animations[o]; n.animations.push(V.Animation.Parse(s)) } V.Node.ParseAnimationRanges(n, e, i) } return e.autoAnimate && i.beginAnimation(n, e.autoAnimateFrom, e.autoAnimateTo, e.autoAnimateLoop, e.autoAnimateSpeed || 1), n }, t.prototype._hookArrayForExcluded = function (e) { var t = this, i = e.push; e.push = function () { for (var r = [], n = 0; n < arguments.length; n++)r[n] = arguments[n]; for (var o = i.apply(e, r), s = 0, a = r; s < a.length; s++)a[s]._resyncLighSource(t); return o }; var r = e.splice; e.splice = function (i, n) { for (var o = r.apply(e, [i, n]), s = 0, a = o; s < a.length; s++)a[s]._resyncLighSource(t); return o }; for (var n = 0, o = e; n < o.length; n++)o[n]._resyncLighSource(this) }, t.prototype._hookArrayForIncludedOnly = function (e) { var t = this, i = e.push; e.push = function () { for (var r = [], n = 0; n < arguments.length; n++)r[n] = arguments[n]; var o = i.apply(e, r); return t._resyncMeshes(), o }; var r = e.splice; e.splice = function (i, n) { var o = r.apply(e, [i, n]); return t._resyncMeshes(), o }, this._resyncMeshes() }, t.prototype._resyncMeshes = function () { for (var e = 0, t = this.getScene().meshes; e < t.length; e++)t[e]._resyncLighSource(this) }, t.prototype._markMeshesAsLightDirty = function () { for (var e = 0, t = this.getScene().meshes; e < t.length; e++) { var i = t[e]; -1 !== i._lightSources.indexOf(this) && i._markSubMeshesAsLightDirty() } }, t.prototype._computePhotometricScale = function () { this._photometricScale = this._getPhotometricScale(), this.getScene().resetCachedMaterial() }, t.prototype._getPhotometricScale = function () { var e = 0, i = this.getTypeID(), r = this.intensityMode; switch (r === t.INTENSITYMODE_AUTOMATIC && (r = i === t.LIGHTTYPEID_DIRECTIONALLIGHT ? t.INTENSITYMODE_ILLUMINANCE : t.INTENSITYMODE_LUMINOUSINTENSITY), i) { case t.LIGHTTYPEID_POINTLIGHT: case t.LIGHTTYPEID_SPOTLIGHT: switch (r) { case t.INTENSITYMODE_LUMINOUSPOWER: e = 1 / (4 * Math.PI); break; case t.INTENSITYMODE_LUMINOUSINTENSITY: e = 1; break; case t.INTENSITYMODE_LUMINANCE: e = this.radius * this.radius }break; case t.LIGHTTYPEID_DIRECTIONALLIGHT: switch (r) { case t.INTENSITYMODE_ILLUMINANCE: e = 1; break; case t.INTENSITYMODE_LUMINANCE: var n = this.radius; n = Math.max(n, .001), e = 2 * Math.PI * (1 - Math.cos(n)) }break; case t.LIGHTTYPEID_HEMISPHERICLIGHT: e = 1 }return e }, t.prototype._reorderLightsInScene = function () { var e = this.getScene(); 0 != this._renderPriority && (e.requireLightSorting = !0), this.getScene().sortLightsByPriority() }, t.FALLOFF_DEFAULT = 0, t.FALLOFF_PHYSICAL = 1, t.FALLOFF_GLTF = 2, t.FALLOFF_STANDARD = 3, t.LIGHTMAP_DEFAULT = 0, t.LIGHTMAP_SPECULAR = 1, t.LIGHTMAP_SHADOWSONLY = 2, t.INTENSITYMODE_AUTOMATIC = 0, t.INTENSITYMODE_LUMINOUSPOWER = 1, t.INTENSITYMODE_LUMINOUSINTENSITY = 2, t.INTENSITYMODE_ILLUMINANCE = 3, t.INTENSITYMODE_LUMINANCE = 4, t.LIGHTTYPEID_POINTLIGHT = 0, t.LIGHTTYPEID_DIRECTIONALLIGHT = 1, t.LIGHTTYPEID_SPOTLIGHT = 2, t.LIGHTTYPEID_HEMISPHERICLIGHT = 3, b([V.serializeAsColor3()], t.prototype, "diffuse", void 0), b([V.serializeAsColor3()], t.prototype, "specular", void 0), b([V.serialize()], t.prototype, "falloffType", void 0), b([V.serialize()], t.prototype, "intensity", void 0), b([V.serialize()], t.prototype, "range", null), b([V.serialize()], t.prototype, "intensityMode", null), b([V.serialize()], t.prototype, "radius", null), b([V.serialize()], t.prototype, "_renderPriority", void 0), b([V.expandToProperty("_reorderLightsInScene")], t.prototype, "renderPriority", void 0), b([V.serialize("shadowEnabled")], t.prototype, "_shadowEnabled", void 0), b([V.serialize("excludeWithLayerMask")], t.prototype, "_excludeWithLayerMask", void 0), b([V.serialize("includeOnlyWithLayerMask")], t.prototype, "_includeOnlyWithLayerMask", void 0), b([V.serialize("lightmapMode")], t.prototype, "_lightmapMode", void 0), t }((V = $a || ($a = {})).Node), V.Light = U, G = function (e) { function t(i, r, n, o) { void 0 === o && (o = !0); var s = e.call(this, i, n) || this; return s.upVector = z.Vector3.Up(), s.orthoLeft = null, s.orthoRight = null, s.orthoBottom = null, s.orthoTop = null, s.fov = .8, s.minZ = 1, s.maxZ = 1e4, s.inertia = .9, s.mode = t.PERSPECTIVE_CAMERA, s.isIntermediate = !1, s.viewport = new z.Viewport(0, 0, 1, 1), s.layerMask = 268435455, s.fovMode = t.FOVMODE_VERTICAL_FIXED, s.cameraRigMode = t.RIG_MODE_NONE, s.customRenderTargets = new Array, s.onViewMatrixChangedObservable = new z.Observable, s.onProjectionMatrixChangedObservable = new z.Observable, s.onAfterCheckInputsObservable = new z.Observable, s.onRestoreStateObservable = new z.Observable, s._rigCameras = new Array, s._webvrViewMatrix = z.Matrix.Identity(), s._skipRendering = !1, s._projectionMatrix = new z.Matrix, s._postProcesses = new Array, s._activeMeshes = new z.SmartArray(256), s._globalPosition = z.Vector3.Zero(), s._computedViewMatrix = z.Matrix.Identity(), s._doNotComputeProjectionMatrix = !1, s._transformMatrix = z.Matrix.Zero(), s._refreshFrustumPlanes = !0, s.getScene().addCamera(s), o && !s.getScene().activeCamera && (s.getScene().activeCamera = s), s.position = r, s } return T(t, e), t.prototype.storeState = function () { return this._stateStored = !0, this._storedFov = this.fov, this }, t.prototype._restoreStateValues = function () { return !!this._stateStored && (this.fov = this._storedFov, !0) }, t.prototype.restoreState = function () { return !!this._restoreStateValues() && (this.onRestoreStateObservable.notifyObservers(this), !0) }, t.prototype.getClassName = function () { return "Camera" }, t.prototype.toString = function (e) { var t = "Name: " + this.name; if (t += ", type: " + this.getClassName(), this.animations) for (var i = 0; i < this.animations.length; i++)t += ", animation[0]: " + this.animations[i].toString(e); return t }, Object.defineProperty(t.prototype, "globalPosition", { get: function () { return this._globalPosition }, enumerable: !0, configurable: !0 }), t.prototype.getActiveMeshes = function () { return this._activeMeshes }, t.prototype.isActiveMesh = function (e) { return -1 !== this._activeMeshes.indexOf(e) }, t.prototype.isReady = function (t) { if (void 0 === t && (t = !1), t) for (var i = 0, r = this._postProcesses; i < r.length; i++) { var n = r[i]; if (n && !n.isReady()) return !1 } return e.prototype.isReady.call(this, t) }, t.prototype._initCache = function () { e.prototype._initCache.call(this), this._cache.position = new z.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.upVector = new z.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.mode = void 0, this._cache.minZ = void 0, this._cache.maxZ = void 0, this._cache.fov = void 0, this._cache.fovMode = void 0, this._cache.aspectRatio = void 0, this._cache.orthoLeft = void 0, this._cache.orthoRight = void 0, this._cache.orthoBottom = void 0, this._cache.orthoTop = void 0, this._cache.renderWidth = void 0, this._cache.renderHeight = void 0 }, t.prototype._updateCache = function (t) { t || e.prototype._updateCache.call(this), this._cache.position.copyFrom(this.position), this._cache.upVector.copyFrom(this.upVector) }, t.prototype._isSynchronized = function () { return this._isSynchronizedViewMatrix() && this._isSynchronizedProjectionMatrix() }, t.prototype._isSynchronizedViewMatrix = function () { return !!e.prototype._isSynchronized.call(this) && this._cache.position.equals(this.position) && this._cache.upVector.equals(this.upVector) && this.isSynchronizedWithParent() }, t.prototype._isSynchronizedProjectionMatrix = function () { var e = this._cache.mode === this.mode && this._cache.minZ === this.minZ && this._cache.maxZ === this.maxZ; if (!e) return !1; var i = this.getEngine(); return this.mode === t.PERSPECTIVE_CAMERA ? this._cache.fov === this.fov && this._cache.fovMode === this.fovMode && this._cache.aspectRatio === i.getAspectRatio(this) : this._cache.orthoLeft === this.orthoLeft && this._cache.orthoRight === this.orthoRight && this._cache.orthoBottom === this.orthoBottom && this._cache.orthoTop === this.orthoTop && this._cache.renderWidth === i.getRenderWidth() && this._cache.renderHeight === i.getRenderHeight() }, t.prototype.attachControl = function (e, t) { }, t.prototype.detachControl = function (e) { }, t.prototype.update = function () { this._checkInputs(), this.cameraRigMode !== t.RIG_MODE_NONE && this._updateRigCameras() }, t.prototype._checkInputs = function () { this.onAfterCheckInputsObservable.notifyObservers(this) }, Object.defineProperty(t.prototype, "rigCameras", { get: function () { return this._rigCameras }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "rigPostProcess", { get: function () { return this._rigPostProcess }, enumerable: !0, configurable: !0 }), t.prototype._getFirstPostProcess = function () { for (var e = 0; e < this._postProcesses.length; e++)if (null !== this._postProcesses[e]) return this._postProcesses[e]; return null }, t.prototype._cascadePostProcessesToRigCams = function () { var e = this._getFirstPostProcess(); e && e.markTextureDirty(); for (var t = 0, i = this._rigCameras.length; t < i; t++) { var r = this._rigCameras[t], n = r._rigPostProcess; n ? (n instanceof z.PassPostProcess && (r.isIntermediate = 0 === this._postProcesses.length), r._postProcesses = this._postProcesses.slice(0).concat(n), n.markTextureDirty()) : r._postProcesses = this._postProcesses.slice(0) } }, t.prototype.attachPostProcess = function (e, t) { return void 0 === t && (t = null), !e.isReusable() && -1 < this._postProcesses.indexOf(e) ? (z.Tools.Error("You're trying to reuse a post process not defined as reusable."), 0) : (null == t || t < 0 ? this._postProcesses.push(e) : null === this._postProcesses[t] ? this._postProcesses[t] = e : this._postProcesses.splice(t, 0, e), this._cascadePostProcessesToRigCams(), this._postProcesses.indexOf(e)) }, t.prototype.detachPostProcess = function (e) { var t = this._postProcesses.indexOf(e); -1 !== t && (this._postProcesses[t] = null), this._cascadePostProcessesToRigCams() }, t.prototype.getWorldMatrix = function () { return this._isSynchronizedViewMatrix() || this.getViewMatrix(), this._worldMatrix }, t.prototype._getViewMatrix = function () { return z.Matrix.Identity() }, t.prototype.getViewMatrix = function (e) { return !e && this._isSynchronizedViewMatrix() || (this.updateCache(), this._computedViewMatrix = this._getViewMatrix(), this._currentRenderId = this.getScene().getRenderId(), this._childRenderId = this._currentRenderId, this._refreshFrustumPlanes = !0, this._cameraRigParams && this._cameraRigParams.vrPreViewMatrix && this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix, this._computedViewMatrix), this.onViewMatrixChangedObservable.notifyObservers(this), this._computedViewMatrix.invertToRef(this._worldMatrix)), this._computedViewMatrix }, t.prototype.freezeProjectionMatrix = function (e) { this._doNotComputeProjectionMatrix = !0, void 0 !== e && (this._projectionMatrix = e) }, t.prototype.unfreezeProjectionMatrix = function () { this._doNotComputeProjectionMatrix = !1 }, t.prototype.getProjectionMatrix = function (e) { if (this._doNotComputeProjectionMatrix || !e && this._isSynchronizedProjectionMatrix()) return this._projectionMatrix; this._cache.mode = this.mode, this._cache.minZ = this.minZ, this._cache.maxZ = this.maxZ, this._refreshFrustumPlanes = !0; var i = this.getEngine(), r = this.getScene(); if (this.mode === t.PERSPECTIVE_CAMERA) this._cache.fov = this.fov, this._cache.fovMode = this.fovMode, this._cache.aspectRatio = i.getAspectRatio(this), this.minZ <= 0 && (this.minZ = .1), r.useRightHandedSystem ? z.Matrix.PerspectiveFovRHToRef(this.fov, i.getAspectRatio(this), this.minZ, this.maxZ, this._projectionMatrix, this.fovMode === t.FOVMODE_VERTICAL_FIXED) : z.Matrix.PerspectiveFovLHToRef(this.fov, i.getAspectRatio(this), this.minZ, this.maxZ, this._projectionMatrix, this.fovMode === t.FOVMODE_VERTICAL_FIXED); else { var n = i.getRenderWidth() / 2, o = i.getRenderHeight() / 2; r.useRightHandedSystem ? z.Matrix.OrthoOffCenterRHToRef(this.orthoLeft || -n, this.orthoRight || n, this.orthoBottom || -o, this.orthoTop || o, this.minZ, this.maxZ, this._projectionMatrix) : z.Matrix.OrthoOffCenterLHToRef(this.orthoLeft || -n, this.orthoRight || n, this.orthoBottom || -o, this.orthoTop || o, this.minZ, this.maxZ, this._projectionMatrix), this._cache.orthoLeft = this.orthoLeft, this._cache.orthoRight = this.orthoRight, this._cache.orthoBottom = this.orthoBottom, this._cache.orthoTop = this.orthoTop, this._cache.renderWidth = i.getRenderWidth(), this._cache.renderHeight = i.getRenderHeight() } return this.onProjectionMatrixChangedObservable.notifyObservers(this), this._projectionMatrix }, t.prototype.getTransformationMatrix = function () { return this._computedViewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix), this._transformMatrix }, t.prototype._updateFrustumPlanes = function () { this._refreshFrustumPlanes && (this.getTransformationMatrix(), this._frustumPlanes ? z.Frustum.GetPlanesToRef(this._transformMatrix, this._frustumPlanes) : this._frustumPlanes = z.Frustum.GetPlanes(this._transformMatrix), this._refreshFrustumPlanes = !1) }, t.prototype.isInFrustum = function (e) { return this._updateFrustumPlanes(), e.isInFrustum(this._frustumPlanes) }, t.prototype.isCompletelyInFrustum = function (e) { return this._updateFrustumPlanes(), e.isCompletelyInFrustum(this._frustumPlanes) }, t.prototype.getForwardRay = function (e, t, i) { void 0 === e && (e = 100), t || (t = this.getWorldMatrix()), i || (i = this.position); var r = this._scene.useRightHandedSystem ? new z.Vector3(0, 0, -1) : new z.Vector3(0, 0, 1), n = z.Vector3.TransformNormal(r, t), o = z.Vector3.Normalize(n); return new z.Ray(i, o, e) }, t.prototype.dispose = function (i, r) { for (void 0 === r && (r = !1), this.onViewMatrixChangedObservable.clear(), this.onProjectionMatrixChangedObservable.clear(), this.onAfterCheckInputsObservable.clear(), this.onRestoreStateObservable.clear(), this.inputs && this.inputs.clear(), this.getScene().stopAnimation(this), this.getScene().removeCamera(this); 0 < this._rigCameras.length;) { var n = this._rigCameras.pop(); n && n.dispose() } if (this._rigPostProcess) this._rigPostProcess.dispose(this), this._rigPostProcess = null, this._postProcesses = []; else if (this.cameraRigMode !== t.RIG_MODE_NONE) this._rigPostProcess = null, this._postProcesses = []; else for (var o = this._postProcesses.length; 0 <= --o;) { var s = this._postProcesses[o]; s && s.dispose(this) } for (o = this.customRenderTargets.length; 0 <= --o;)this.customRenderTargets[o].dispose(); this.customRenderTargets = [], this._activeMeshes.dispose(), e.prototype.dispose.call(this, i, r) }, Object.defineProperty(t.prototype, "leftCamera", { get: function () { return this._rigCameras.length < 1 ? null : this._rigCameras[0] }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "rightCamera", { get: function () { return this._rigCameras.length < 2 ? null : this._rigCameras[1] }, enumerable: !0, configurable: !0 }), t.prototype.getLeftTarget = function () { return this._rigCameras.length < 1 ? null : this._rigCameras[0].getTarget() }, t.prototype.getRightTarget = function () { return this._rigCameras.length < 2 ? null : this._rigCameras[1].getTarget() }, t.prototype.setCameraRigMode = function (e, i) { if (this.cameraRigMode !== e) { for (; 0 < this._rigCameras.length;) { var r = this._rigCameras.pop(); r && r.dispose() } if (this.cameraRigMode = e, this._cameraRigParams = {}, this._cameraRigParams.interaxialDistance = i.interaxialDistance || .0637, this._cameraRigParams.stereoHalfAngle = z.Tools.ToRadians(this._cameraRigParams.interaxialDistance / .0637), this.cameraRigMode !== t.RIG_MODE_NONE) { var n = this.createRigCamera(this.name + "_L", 0), o = this.createRigCamera(this.name + "_R", 1); n && o && (this._rigCameras.push(n), this._rigCameras.push(o)) } switch (this.cameraRigMode) { case t.RIG_MODE_STEREOSCOPIC_ANAGLYPH: this._rigCameras[0]._rigPostProcess = new z.PassPostProcess(this.name + "_passthru", 1, this._rigCameras[0]), this._rigCameras[1]._rigPostProcess = new z.AnaglyphPostProcess(this.name + "_anaglyph", 1, this._rigCameras); break; case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL: case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED: case t.RIG_MODE_STEREOSCOPIC_OVERUNDER: var s = this.cameraRigMode === t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL || this.cameraRigMode === t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED; this._rigCameras[0]._rigPostProcess = new z.PassPostProcess(this.name + "_passthru", 1, this._rigCameras[0]), this._rigCameras[1]._rigPostProcess = new z.StereoscopicInterlacePostProcess(this.name + "_stereoInterlace", this._rigCameras, s); break; case t.RIG_MODE_VR: var a = i.vrCameraMetrics || z.VRCameraMetrics.GetDefault(); this._rigCameras[0]._cameraRigParams.vrMetrics = a, this._rigCameras[0].viewport = new z.Viewport(0, 0, .5, 1), this._rigCameras[0]._cameraRigParams.vrWorkMatrix = new z.Matrix, this._rigCameras[0]._cameraRigParams.vrHMatrix = a.leftHMatrix, this._rigCameras[0]._cameraRigParams.vrPreViewMatrix = a.leftPreViewMatrix, this._rigCameras[0].getProjectionMatrix = this._rigCameras[0]._getVRProjectionMatrix, this._rigCameras[1]._cameraRigParams.vrMetrics = a, this._rigCameras[1].viewport = new z.Viewport(.5, 0, .5, 1), this._rigCameras[1]._cameraRigParams.vrWorkMatrix = new z.Matrix, this._rigCameras[1]._cameraRigParams.vrHMatrix = a.rightHMatrix, this._rigCameras[1]._cameraRigParams.vrPreViewMatrix = a.rightPreViewMatrix, this._rigCameras[1].getProjectionMatrix = this._rigCameras[1]._getVRProjectionMatrix, a.compensateDistortion && (this._rigCameras[0]._rigPostProcess = new z.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left", this._rigCameras[0], !1, a), this._rigCameras[1]._rigPostProcess = new z.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right", this._rigCameras[1], !0, a)); break; case t.RIG_MODE_WEBVR: if (i.vrDisplay) { var l = i.vrDisplay.getEyeParameters("left"), c = i.vrDisplay.getEyeParameters("right"); this._rigCameras[0].viewport = new z.Viewport(0, 0, .5, 1), this._rigCameras[0].setCameraRigParameter("left", !0), this._rigCameras[0].setCameraRigParameter("specs", i.specs), this._rigCameras[0].setCameraRigParameter("eyeParameters", l), this._rigCameras[0].setCameraRigParameter("frameData", i.frameData), this._rigCameras[0].setCameraRigParameter("parentCamera", i.parentCamera), this._rigCameras[0]._cameraRigParams.vrWorkMatrix = new z.Matrix, this._rigCameras[0].getProjectionMatrix = this._getWebVRProjectionMatrix, (this._rigCameras[0].parent = this)._rigCameras[0]._getViewMatrix = this._getWebVRViewMatrix, this._rigCameras[1].viewport = new z.Viewport(.5, 0, .5, 1), this._rigCameras[1].setCameraRigParameter("eyeParameters", c), this._rigCameras[1].setCameraRigParameter("specs", i.specs), this._rigCameras[1].setCameraRigParameter("frameData", i.frameData), this._rigCameras[1].setCameraRigParameter("parentCamera", i.parentCamera), this._rigCameras[1]._cameraRigParams.vrWorkMatrix = new z.Matrix, this._rigCameras[1].getProjectionMatrix = this._getWebVRProjectionMatrix, (this._rigCameras[1].parent = this)._rigCameras[1]._getViewMatrix = this._getWebVRViewMatrix, t.UseAlternateWebVRRendering && (this._rigCameras[1]._skipRendering = !0, this._rigCameras[0]._alternateCamera = this._rigCameras[1]) } }this._cascadePostProcessesToRigCams(), this.update() } }, t.prototype._getVRProjectionMatrix = function () { return z.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov, this._cameraRigParams.vrMetrics.aspectRatio, this.minZ, this.maxZ, this._cameraRigParams.vrWorkMatrix), this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix, this._projectionMatrix), this._projectionMatrix }, t.prototype._updateCameraRotationMatrix = function () { }, t.prototype._updateWebVRCameraRotationMatrix = function () { }, t.prototype._getWebVRProjectionMatrix = function () { return z.Matrix.Identity() }, t.prototype._getWebVRViewMatrix = function () { return z.Matrix.Identity() }, t.prototype.setCameraRigParameter = function (e, t) { this._cameraRigParams || (this._cameraRigParams = {}), this._cameraRigParams[e] = t, "interaxialDistance" === e && (this._cameraRigParams.stereoHalfAngle = z.Tools.ToRadians(t / .0637)) }, t.prototype.createRigCamera = function (e, t) { return null }, t.prototype._updateRigCameras = function () { for (var e = 0; e < this._rigCameras.length; e++)this._rigCameras[e].minZ = this.minZ, this._rigCameras[e].maxZ = this.maxZ, this._rigCameras[e].fov = this.fov; this.cameraRigMode === t.RIG_MODE_STEREOSCOPIC_ANAGLYPH && (this._rigCameras[0].viewport = this._rigCameras[1].viewport = this.viewport) }, t.prototype._setupInputs = function () { }, t.prototype.serialize = function () { var e = z.SerializationHelper.Serialize(this); return e.type = this.getClassName(), this.parent && (e.parentId = this.parent.id), this.inputs && this.inputs.serialize(e), z.Animation.AppendSerializedAnimations(this, e), e.ranges = this.serializeAnimationRanges(), e }, t.prototype.clone = function (e) { return z.SerializationHelper.Clone(t.GetConstructorFromName(this.getClassName(), e, this.getScene(), this.interaxialDistance, this.isStereoscopicSideBySide), this) }, t.prototype.getDirection = function (e) { var t = z.Vector3.Zero(); return this.getDirectionToRef(e, t), t }, t.prototype.getDirectionToRef = function (e, t) { z.Vector3.TransformNormalToRef(e, this.getWorldMatrix(), t) }, t.GetConstructorFromName = function (e, t, i, r, n) { return void 0 === r && (r = 0), void 0 === n && (n = !0), z.Node.Construct(e, t, i, { interaxial_distance: r, isStereoscopicSideBySide: n }) || function () { return new z.UniversalCamera(t, z.Vector3.Zero(), i) } }, t.prototype.computeWorldMatrix = function () { return this.getWorldMatrix() }, t.Parse = function (e, i) { var r = e.type, n = t.GetConstructorFromName(r, e.name, i, e.interaxial_distance, e.isStereoscopicSideBySide), o = z.SerializationHelper.Parse(n, e, i); if (e.parentId && (o._waitingParentId = e.parentId), o.inputs && (o.inputs.parse(e), o._setupInputs()), o.setPosition && (o.position.copyFromFloats(0, 0, 0), o.setPosition(z.Vector3.FromArray(e.position))), e.target && o.setTarget && o.setTarget(z.Vector3.FromArray(e.target)), e.cameraRigMode) { var s = e.interaxial_distance ? { interaxialDistance: e.interaxial_distance } : {}; o.setCameraRigMode(e.cameraRigMode, s) } if (e.animations) { for (var a = 0; a < e.animations.length; a++) { var l = e.animations[a]; o.animations.push(z.Animation.Parse(l)) } z.Node.ParseAnimationRanges(o, e, i) } return e.autoAnimate && i.beginAnimation(o, e.autoAnimateFrom, e.autoAnimateTo, e.autoAnimateLoop, e.autoAnimateSpeed || 1), o }, t.PERSPECTIVE_CAMERA = 0, t.ORTHOGRAPHIC_CAMERA = 1, t.FOVMODE_VERTICAL_FIXED = 0, t.FOVMODE_HORIZONTAL_FIXED = 1, t.RIG_MODE_NONE = 0, t.RIG_MODE_STEREOSCOPIC_ANAGLYPH = 10, t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL = 11, t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED = 12, t.RIG_MODE_STEREOSCOPIC_OVERUNDER = 13, t.RIG_MODE_VR = 20, t.RIG_MODE_WEBVR = 21, t.ForceAttachControlToAlwaysPreventDefault = !1, t.UseAlternateWebVRRendering = !1, b([z.serializeAsVector3()], t.prototype, "position", void 0), b([z.serializeAsVector3()], t.prototype, "upVector", void 0), b([z.serialize()], t.prototype, "orthoLeft", void 0), b([z.serialize()], t.prototype, "orthoRight", void 0), b([z.serialize()], t.prototype, "orthoBottom", void 0), b([z.serialize()], t.prototype, "orthoTop", void 0), b([z.serialize()], t.prototype, "fov", void 0), b([z.serialize()], t.prototype, "minZ", void 0), b([z.serialize()], t.prototype, "maxZ", void 0), b([z.serialize()], t.prototype, "inertia", void 0), b([z.serialize()], t.prototype, "mode", void 0), b([z.serialize()], t.prototype, "layerMask", void 0), b([z.serialize()], t.prototype, "fovMode", void 0), b([z.serialize()], t.prototype, "cameraRigMode", void 0), b([z.serialize()], t.prototype, "interaxialDistance", void 0), b([z.serialize()], t.prototype, "isStereoscopicSideBySide", void 0), t }((z = $a || ($a = {})).Node), z.Camera = G, k = $a || ($a = {}), W = function () { function e(t) { this._useSceneAutoClearSetup = !1, this._renderingGroups = new Array, this._autoClearDepthStencil = {}, this._customOpaqueSortCompareFn = {}, this._customAlphaTestSortCompareFn = {}, this._customTransparentSortCompareFn = {}, this._renderingGroupInfo = new k.RenderingGroupInfo, this._scene = t; for (var i = e.MIN_RENDERINGGROUPS; i < e.MAX_RENDERINGGROUPS; i++)this._autoClearDepthStencil[i] = { autoClear: !0, depth: !0, stencil: !0 } } return e.prototype._clearDepthStencilBuffer = function (e, t) { void 0 === e && (e = !0), void 0 === t && (t = !0), this._depthStencilBufferAlreadyCleaned || (this._scene.getEngine().clear(null, !1, e, t), this._depthStencilBufferAlreadyCleaned = !0) }, e.prototype.render = function (t, i, r, n) { var o = this._renderingGroupInfo; if (o.scene = this._scene, o.camera = this._scene.activeCamera, this._scene.spriteManagers && n) for (var s = 0; s < this._scene.spriteManagers.length; s++) { var a = this._scene.spriteManagers[s]; this.dispatchSprites(a) } for (s = e.MIN_RENDERINGGROUPS; s < e.MAX_RENDERINGGROUPS; s++) { this._depthStencilBufferAlreadyCleaned = s === e.MIN_RENDERINGGROUPS; var l = this._renderingGroups[s]; if (l) { var c = Math.pow(2, s); if (o.renderingGroupId = s, this._scene.onBeforeRenderingGroupObservable.notifyObservers(o, c), e.AUTOCLEAR) { var h = this._useSceneAutoClearSetup ? this._scene.getAutoClearDepthStencilSetup(s) : this._autoClearDepthStencil[s]; h && h.autoClear && this._clearDepthStencilBuffer(h.depth, h.stencil) } for (var u = 0, d = this._scene._beforeRenderingGroupDrawStage; u < d.length; u++)d[u].action(s); l.render(t, n, r, i); for (var f = 0, p = this._scene._afterRenderingGroupDrawStage; f < p.length; f++)p[f].action(s); this._scene.onAfterRenderingGroupObservable.notifyObservers(o, c) } } }, e.prototype.reset = function () { for (var t = e.MIN_RENDERINGGROUPS; t < e.MAX_RENDERINGGROUPS; t++) { var i = this._renderingGroups[t]; i && i.prepare() } }, e.prototype.dispose = function () { this.freeRenderingGroups(), this._renderingGroups.length = 0, this._renderingGroupInfo = null }, e.prototype.freeRenderingGroups = function () { for (var t = e.MIN_RENDERINGGROUPS; t < e.MAX_RENDERINGGROUPS; t++) { var i = this._renderingGroups[t]; i && i.dispose() } }, e.prototype._prepareRenderingGroup = function (e) { void 0 === this._renderingGroups[e] && (this._renderingGroups[e] = new k.RenderingGroup(e, this._scene, this._customOpaqueSortCompareFn[e], this._customAlphaTestSortCompareFn[e], this._customTransparentSortCompareFn[e])) }, e.prototype.dispatchSprites = function (e) { var t = e.renderingGroupId || 0; this._prepareRenderingGroup(t), this._renderingGroups[t].dispatchSprites(e) }, e.prototype.dispatchParticles = function (e) { var t = e.renderingGroupId || 0; this._prepareRenderingGroup(t), this._renderingGroups[t].dispatchParticles(e) }, e.prototype.dispatch = function (e, t, i) { void 0 === t && (t = e.getMesh()); var r = t.renderingGroupId || 0; this._prepareRenderingGroup(r), this._renderingGroups[r].dispatch(e, t, i) }, e.prototype.setRenderingOrder = function (e, t, i, r) { if (void 0 === t && (t = null), void 0 === i && (i = null), void 0 === r && (r = null), this._customOpaqueSortCompareFn[e] = t, this._customAlphaTestSortCompareFn[e] = i, this._customTransparentSortCompareFn[e] = r, this._renderingGroups[e]) { var n = this._renderingGroups[e]; n.opaqueSortCompareFn = this._customOpaqueSortCompareFn[e], n.alphaTestSortCompareFn = this._customAlphaTestSortCompareFn[e], n.transparentSortCompareFn = this._customTransparentSortCompareFn[e] } }, e.prototype.setRenderingAutoClearDepthStencil = function (e, t, i, r) { void 0 === i && (i = !0), void 0 === r && (r = !0), this._autoClearDepthStencil[e] = { autoClear: t, depth: i, stencil: r } }, e.prototype.getAutoClearDepthStencilSetup = function (e) { return this._autoClearDepthStencil[e] }, e.MAX_RENDERINGGROUPS = 4, e.MIN_RENDERINGGROUPS = 0, e.AUTOCLEAR = !0, e }(), k.RenderingManager = W, H = $a || ($a = {}), X = function () { function e(e, t, i, r, n) { void 0 === i && (i = null), void 0 === r && (r = null), void 0 === n && (n = null), this.index = e, this._opaqueSubMeshes = new H.SmartArray(256), this._transparentSubMeshes = new H.SmartArray(256), this._alphaTestSubMeshes = new H.SmartArray(256), this._depthOnlySubMeshes = new H.SmartArray(256), this._particleSystems = new H.SmartArray(256), this._spriteManagers = new H.SmartArray(256), this._edgesRenderers = new H.SmartArray(16), this._scene = t, this.opaqueSortCompareFn = i, this.alphaTestSortCompareFn = r, this.transparentSortCompareFn = n } return Object.defineProperty(e.prototype, "opaqueSortCompareFn", { set: function (t) { this._opaqueSortCompareFn = t, this._renderOpaque = t ? this.renderOpaqueSorted : e.renderUnsorted }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "alphaTestSortCompareFn", { set: function (t) { this._alphaTestSortCompareFn = t, this._renderAlphaTest = t ? this.renderAlphaTestSorted : e.renderUnsorted }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "transparentSortCompareFn", { set: function (t) { this._transparentSortCompareFn = t || e.defaultTransparentSortCompare, this._renderTransparent = this.renderTransparentSorted }, enumerable: !0, configurable: !0 }), e.prototype.render = function (e, t, i, r) { if (e) e(this._opaqueSubMeshes, this._alphaTestSubMeshes, this._transparentSubMeshes, this._depthOnlySubMeshes); else { var n = this._scene.getEngine(); 0 !== this._depthOnlySubMeshes.length && (n.setColorWrite(!1), this._renderAlphaTest(this._depthOnlySubMeshes), n.setColorWrite(!0)), 0 !== this._opaqueSubMeshes.length && this._renderOpaque(this._opaqueSubMeshes), 0 !== this._alphaTestSubMeshes.length && this._renderAlphaTest(this._alphaTestSubMeshes); var o = n.getStencilBuffer(); if (n.setStencilBuffer(!1), t && this._renderSprites(), i && this._renderParticles(r), this.onBeforeTransparentRendering && this.onBeforeTransparentRendering(), 0 !== this._transparentSubMeshes.length && (this._renderTransparent(this._transparentSubMeshes), n.setAlphaMode(H.Engine.ALPHA_DISABLE)), n.setStencilBuffer(!1), this._edgesRenderers.length) { for (var s = 0; s < this._edgesRenderers.length; s++)this._edgesRenderers.data[s].render(); n.setAlphaMode(H.Engine.ALPHA_DISABLE) } n.setStencilBuffer(o) } }, e.prototype.renderOpaqueSorted = function (t) { return e.renderSorted(t, this._opaqueSortCompareFn, this._scene.activeCamera, !1) }, e.prototype.renderAlphaTestSorted = function (t) { return e.renderSorted(t, this._alphaTestSortCompareFn, this._scene.activeCamera, !1) }, e.prototype.renderTransparentSorted = function (t) { return e.renderSorted(t, this._transparentSortCompareFn, this._scene.activeCamera, !0) }, e.renderSorted = function (e, t, i, r) { for (var n, o = 0, s = i ? i.globalPosition : H.Vector3.Zero(); o < e.length; o++)(n = e.data[o])._alphaIndex = n.getMesh().alphaIndex, n._distanceToCamera = n.getBoundingInfo().boundingSphere.centerWorld.subtract(s).length(); var a = e.data.slice(0, e.length); for (t && a.sort(t), o = 0; o < a.length; o++) { if (n = a[o], r) { var l = n.getMaterial(); if (l && l.needDepthPrePass) { var c = l.getScene().getEngine(); c.setColorWrite(!1), c.setAlphaMode(H.Engine.ALPHA_DISABLE), n.render(!1), c.setColorWrite(!0) } } n.render(r) } }, e.renderUnsorted = function (e) { for (var t = 0; t < e.length; t++)e.data[t].render(!1) }, e.defaultTransparentSortCompare = function (t, i) { return t._alphaIndex > i._alphaIndex ? 1 : t._alphaIndex < i._alphaIndex ? -1 : e.backToFrontSortCompare(t, i) }, e.backToFrontSortCompare = function (e, t) { return e._distanceToCamera < t._distanceToCamera ? 1 : e._distanceToCamera > t._distanceToCamera ? -1 : 0 }, e.frontToBackSortCompare = function (e, t) { return e._distanceToCamera < t._distanceToCamera ? -1 : e._distanceToCamera > t._distanceToCamera ? 1 : 0 }, e.prototype.prepare = function () { this._opaqueSubMeshes.reset(), this._transparentSubMeshes.reset(), this._alphaTestSubMeshes.reset(), this._depthOnlySubMeshes.reset(), this._particleSystems.reset(), this._spriteManagers.reset(), this._edgesRenderers.reset() }, e.prototype.dispose = function () { this._opaqueSubMeshes.dispose(), this._transparentSubMeshes.dispose(), this._alphaTestSubMeshes.dispose(), this._depthOnlySubMeshes.dispose(), this._particleSystems.dispose(), this._spriteManagers.dispose(), this._edgesRenderers.dispose() }, e.prototype.dispatch = function (e, t, i) { void 0 === t && (t = e.getMesh()), void 0 === i && (i = e.getMaterial()), null != i && (i.needAlphaBlendingForMesh(t) ? this._transparentSubMeshes.push(e) : i.needAlphaTesting() ? (i.needDepthPrePass && this._depthOnlySubMeshes.push(e), this._alphaTestSubMeshes.push(e)) : (i.needDepthPrePass && this._depthOnlySubMeshes.push(e), this._opaqueSubMeshes.push(e)), t._edgesRenderer && t._edgesRenderer.isEnabled && this._edgesRenderers.push(t._edgesRenderer)) }, e.prototype.dispatchSprites = function (e) { this._spriteManagers.push(e) }, e.prototype.dispatchParticles = function (e) { this._particleSystems.push(e) }, e.prototype._renderParticles = function (e) { if (0 !== this._particleSystems.length) { var t = this._scene.activeCamera; this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene); for (var i = 0; i < this._particleSystems.length; i++) { var r = this._particleSystems.data[i]; if (0 !== (t && t.layerMask & r.layerMask)) { var n = r.emitter; n.position && e && -1 === e.indexOf(n) || this._scene._activeParticles.addCount(r.render(), !1) } } this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene) } }, e.prototype._renderSprites = function () { if (this._scene.spritesEnabled && 0 !== this._spriteManagers.length) { var e = this._scene.activeCamera; this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene); for (var t = 0; t < this._spriteManagers.length; t++) { var i = this._spriteManagers.data[t]; 0 !== (e && e.layerMask & i.layerMask) && i.render() } this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene) } }, e }(), H.RenderingGroup = X, function (e) { var t = function () { function e() { } return e.NAME_EFFECTLAYER = "EffectLayer", e.NAME_LAYER = "Layer", e.NAME_LENSFLARESYSTEM = "LensFlareSystem", e.NAME_BOUNDINGBOXRENDERER = "BoundingBoxRenderer", e.NAME_PARTICLESYSTEM = "ParticleSystem", e.NAME_GAMEPAD = "Gamepad", e.NAME_SIMPLIFICATIONQUEUE = "SimplificationQueue", e.NAME_GEOMETRYBUFFERRENDERER = "GeometryBufferRenderer", e.NAME_DEPTHRENDERER = "DepthRenderer", e.NAME_POSTPROCESSRENDERPIPELINEMANAGER = "PostProcessRenderPipelineManager", e.NAME_SPRITE = "Sprite", e.NAME_OUTLINERENDERER = "Outline", e.NAME_PROCEDURALTEXTURE = "ProceduralTexture", e.NAME_SHADOWGENERATOR = "ShadowGenerator", e.NAME_OCTREE = "Octree", e.NAME_PHYSICSENGINE = "PhysicsEngine", e.NAME_AUDIO = "Audio", e.STEP_ISREADYFORMESH_EFFECTLAYER = 0, e.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER = 0, e.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER = 0, e.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER = 0, e.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER = 1, e.STEP_BEFORECAMERADRAW_EFFECTLAYER = 0, e.STEP_BEFORECAMERADRAW_LAYER = 1, e.STEP_BEFORERENDERINGMESH_OUTLINE = 0, e.STEP_AFTERRENDERINGMESH_OUTLINE = 0, e.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW = 0, e.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER = 1, e.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE = 0, e.STEP_BEFORECAMERAUPDATE_GAMEPAD = 1, e.STEP_BEFORECLEAR_PROCEDURALTEXTURE = 0, e.STEP_AFTERCAMERADRAW_EFFECTLAYER = 0, e.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM = 1, e.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW = 2, e.STEP_AFTERCAMERADRAW_LAYER = 3, e.STEP_AFTERRENDER_AUDIO = 0, e.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR = 0, e.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER = 1, e.STEP_GATHERRENDERTARGETS_DEPTHRENDERER = 2, e.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER = 3, e.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER = 0, e.STEP_POINTERMOVE_SPRITE = 0, e.STEP_POINTERDOWN_SPRITE = 0, e.STEP_POINTERUP_SPRITE = 0, e }(); e.SceneComponentConstants = t; var i = function (e) { function t(t) { return e.apply(this, t) || this } return T(t, e), t.Create = function () { return Object.create(t.prototype) }, t.prototype.registerStep = function (e, t, i) { var r = 0; for (Number.MAX_VALUE; r < this.length && !(e < this[r].index); r++); this.splice(r, 0, { index: e, component: t, action: i.bind(t) }) }, t.prototype.clear = function () { this.length = 0 }, t }(Array); e.Stage = i }($a || ($a = {})), j = $a || ($a = {}), Y = function () { function e() { this.rootNodes = new Array, this.cameras = new Array, this.lights = new Array, this.meshes = new Array, this.skeletons = new Array, this.particleSystems = new Array, this.animations = [], this.animationGroups = new Array, this.multiMaterials = new Array, this.materials = new Array, this.morphTargetManagers = new Array, this.geometries = new Array, this.transformNodes = new Array, this.actionManagers = new Array, this.textures = new Array } return e.AddParser = function (e, t) { this._BabylonFileParsers[e] = t }, e.GetParser = function (e) { return this._BabylonFileParsers[e] ? this._BabylonFileParsers[e] : null }, e.AddIndividualParser = function (e, t) { this._IndividualBabylonFileParsers[e] = t }, e.GetIndividualParser = function (e) { return this._IndividualBabylonFileParsers[e] ? this._IndividualBabylonFileParsers[e] : null }, e.Parse = function (e, t, i, r) { for (var n in this._BabylonFileParsers) this._BabylonFileParsers.hasOwnProperty(n) && this._BabylonFileParsers[n](e, t, i, r) }, e._BabylonFileParsers = {}, e._IndividualBabylonFileParsers = {}, e }(), j.AbstractScene = Y, function (e) { var t = function () { function e() { this._singleClick = !1, this._doubleClick = !1, this._hasSwiped = !1, this._ignore = !1 } return Object.defineProperty(e.prototype, "singleClick", { get: function () { return this._singleClick }, set: function (e) { this._singleClick = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "doubleClick", { get: function () { return this._doubleClick }, set: function (e) { this._doubleClick = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "hasSwiped", { get: function () { return this._hasSwiped }, set: function (e) { this._hasSwiped = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "ignore", { get: function () { return this._ignore }, set: function (e) { this._ignore = e }, enumerable: !0, configurable: !0 }), e }(); e.RenderingGroupInfo = function () { }; var i = function (i) { function r(t) { var n = i.call(this) || this; return n.autoClear = !0, n.autoClearDepthAndStencil = !0, n.clearColor = new e.Color4(.2, .2, .3, 1), n.ambientColor = new e.Color3(0, 0, 0), n._forceWireframe = !1, n._forcePointsCloud = !1, n.animationsEnabled = !0, n._animationPropertiesOverride = null, n.useConstantAnimationDeltaTime = !1, n.constantlyUpdateMeshUnderPointer = !1, n.hoverCursor = "pointer", n.defaultCursor = "", n.preventDefaultOnPointerDown = !0, n.metadata = null, n.disableOfflineSupportExceptionRules = new Array, n.onDisposeObservable = new e.Observable, n._onDisposeObserver = null, n.onBeforeRenderObservable = new e.Observable, n._onBeforeRenderObserver = null, n.onAfterRenderObservable = new e.Observable, n._onAfterRenderObserver = null, n.onBeforeAnimationsObservable = new e.Observable, n.onAfterAnimationsObservable = new e.Observable, n.onBeforeDrawPhaseObservable = new e.Observable, n.onAfterDrawPhaseObservable = new e.Observable, n.onReadyObservable = new e.Observable, n.onBeforeCameraRenderObservable = new e.Observable, n._onBeforeCameraRenderObserver = null, n.onAfterCameraRenderObservable = new e.Observable, n._onAfterCameraRenderObserver = null, n.onBeforeActiveMeshesEvaluationObservable = new e.Observable, n.onAfterActiveMeshesEvaluationObservable = new e.Observable, n.onBeforeParticlesRenderingObservable = new e.Observable, n.onAfterParticlesRenderingObservable = new e.Observable, n.onDataLoadedObservable = new e.Observable, n.onNewCameraAddedObservable = new e.Observable, n.onCameraRemovedObservable = new e.Observable, n.onNewLightAddedObservable = new e.Observable, n.onLightRemovedObservable = new e.Observable, n.onNewGeometryAddedObservable = new e.Observable, n.onGeometryRemovedObservable = new e.Observable, n.onNewTransformNodeAddedObservable = new e.Observable, n.onTransformNodeRemovedObservable = new e.Observable, n.onNewMeshAddedObservable = new e.Observable, n.onMeshRemovedObservable = new e.Observable, n.onNewMaterialAddedObservable = new e.Observable, n.onMaterialRemovedObservable = new e.Observable, n.onNewTextureAddedObservable = new e.Observable, n.onTextureRemovedObservable = new e.Observable, n.onBeforeRenderTargetsRenderObservable = new e.Observable, n.onAfterRenderTargetsRenderObservable = new e.Observable, n.onBeforeStepObservable = new e.Observable, n.onAfterStepObservable = new e.Observable, n.onBeforeRenderingGroupObservable = new e.Observable, n.onAfterRenderingGroupObservable = new e.Observable, n.onMeshImportedObservable = new e.Observable, n._registeredForLateAnimationBindings = new e.SmartArrayNoDuplicate(256), n.onPrePointerObservable = new e.Observable, n.onPointerObservable = new e.Observable, n._meshPickProceed = !1, n._currentPickResult = null, n._previousPickResult = null, n._totalPointersPressed = 0, n._doubleClickOccured = !1, n.cameraToUseForPointers = null, n._pointerX = 0, n._pointerY = 0, n._startingPointerPosition = new e.Vector2(0, 0), n._previousStartingPointerPosition = new e.Vector2(0, 0), n._startingPointerTime = 0, n._previousStartingPointerTime = 0, n._pointerCaptures = {}, n._timeAccumulator = 0, n._currentStepId = 0, n._currentInternalStep = 0, n.onPreKeyboardObservable = new e.Observable, n.onKeyboardObservable = new e.Observable, n._useRightHandedSystem = !1, n._fogEnabled = !0, n._fogMode = r.FOGMODE_NONE, n.fogColor = new e.Color3(.2, .2, .3), n.fogDensity = .1, n.fogStart = 0, n.fogEnd = 1e3, n._shadowsEnabled = !0, n._lightsEnabled = !0, n.activeCameras = new Array, n._texturesEnabled = !0, n.particlesEnabled = !0, n.spritesEnabled = !0, n._skeletonsEnabled = !0, n.lensFlaresEnabled = !0, n.collisionsEnabled = !0, n.gravity = new e.Vector3(0, -9.807, 0), n.postProcessesEnabled = !0, n.postProcesses = new Array, n.renderTargetsEnabled = !0, n.dumpNextRenderTargets = !1, n.customRenderTargets = new Array, n.importedMeshesFiles = new Array, n.probesEnabled = !0, n._meshesForIntersections = new e.SmartArrayNoDuplicate(256), n.proceduralTexturesEnabled = !0, n._totalVertices = new e.PerfCounter, n._activeIndices = new e.PerfCounter, n._activeParticles = new e.PerfCounter, n._activeBones = new e.PerfCounter, n._animationTime = 0, n.animationTimeScale = 1, n._renderId = 0, n._frameId = 0, n._executeWhenReadyTimeoutId = -1, n._intermediateRendering = !1, n._viewUpdateFlag = -1, n._projectionUpdateFlag = -1, n._alternateViewUpdateFlag = -1, n._alternateProjectionUpdateFlag = -1, n._toBeDisposed = new Array(256), n._activeRequests = new Array, n._pendingData = new Array, n._isDisposed = !1, n.dispatchAllSubMeshesOfActiveMeshes = !1, n._activeMeshes = new e.SmartArray(256), n._processedMaterials = new e.SmartArray(256), n._renderTargets = new e.SmartArrayNoDuplicate(256), n._activeParticleSystems = new e.SmartArray(256), n._activeSkeletons = new e.SmartArrayNoDuplicate(32), n._softwareSkinnedMeshes = new e.SmartArrayNoDuplicate(32), n._activeAnimatables = new Array, n._transformMatrix = e.Matrix.Zero(), n._useAlternateCameraConfiguration = !1, n._alternateRendering = !1, n.requireLightSorting = !1, n._components = [], n._serializableComponents = [], n._transientComponents = [], n._beforeCameraUpdateStage = e.Stage.Create(), n._beforeClearStage = e.Stage.Create(), n._gatherRenderTargetsStage = e.Stage.Create(), n._gatherActiveCameraRenderTargetsStage = e.Stage.Create(), n._isReadyForMeshStage = e.Stage.Create(), n._beforeEvaluateActiveMeshStage = e.Stage.Create(), n._evaluateSubMeshStage = e.Stage.Create(), n._activeMeshStage = e.Stage.Create(), n._cameraDrawRenderTargetStage = e.Stage.Create(), n._beforeCameraDrawStage = e.Stage.Create(), n._beforeRenderingGroupDrawStage = e.Stage.Create(), n._beforeRenderingMeshStage = e.Stage.Create(), n._afterRenderingMeshStage = e.Stage.Create(), n._afterRenderingGroupDrawStage = e.Stage.Create(), n._afterCameraDrawStage = e.Stage.Create(), n._afterRenderStage = e.Stage.Create(), n._pointerMoveStage = e.Stage.Create(), n._pointerDownStage = e.Stage.Create(), n._pointerUpStage = e.Stage.Create(), n._defaultMeshCandidates = { data: [], length: 0 }, n._defaultSubMeshCandidates = { data: [], length: 0 }, n._activeMeshesFrozen = !1, n._allowPostProcessClearColor = !0, n.getDeterministicFrameTime = function () { return 1e3 / 60 }, n._tempPickingRay = e.Ray ? e.Ray.Zero() : null, n._blockMaterialDirtyMechanism = !1, n._engine = t || e.Engine.LastCreatedEngine, n._engine.scenes.push(n), n._uid = null, n._renderingManager = new e.RenderingManager(n), e.PostProcessManager && (n.postProcessManager = new e.PostProcessManager(n)), e.Tools.IsWindowObjectExist() && n.attachControl(), n.workerCollisions = !1, n._createUbo(), e.ImageProcessingConfiguration && (n._imageProcessingConfiguration = new e.ImageProcessingConfiguration), n.setDefaultCandidateProviders(), n } return T(r, i), Object.defineProperty(r.prototype, "environmentTexture", { get: function () { return this._environmentTexture }, set: function (t) { this._environmentTexture !== t && (this._environmentTexture = t, this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "imageProcessingConfiguration", { get: function () { return this._imageProcessingConfiguration }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "forceWireframe", { get: function () { return this._forceWireframe }, set: function (t) { this._forceWireframe !== t && (this._forceWireframe = t, this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "forcePointsCloud", { get: function () { return this._forcePointsCloud }, set: function (t) { this._forcePointsCloud !== t && (this._forcePointsCloud = t, this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "animationPropertiesOverride", { get: function () { return this._animationPropertiesOverride }, set: function (e) { this._animationPropertiesOverride = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "onDispose", { set: function (e) { this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "beforeRender", { set: function (e) { this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver), e && (this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "afterRender", { set: function (e) { this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver), e && (this._onAfterRenderObserver = this.onAfterRenderObservable.add(e)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "beforeCameraRender", { set: function (e) { this._onBeforeCameraRenderObserver && this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver), this._onBeforeCameraRenderObserver = this.onBeforeCameraRenderObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "afterCameraRender", { set: function (e) { this._onAfterCameraRenderObserver && this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver), this._onAfterCameraRenderObserver = this.onAfterCameraRenderObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "unTranslatedPointer", { get: function () { return new e.Vector2(this._unTranslatedPointerX, this._unTranslatedPointerY) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "useRightHandedSystem", { get: function () { return this._useRightHandedSystem }, set: function (t) { this._useRightHandedSystem !== t && (this._useRightHandedSystem = t, this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), r.prototype.setStepId = function (e) { this._currentStepId = e }, r.prototype.getStepId = function () { return this._currentStepId }, r.prototype.getInternalStep = function () { return this._currentInternalStep }, Object.defineProperty(r.prototype, "fogEnabled", { get: function () { return this._fogEnabled }, set: function (t) { this._fogEnabled !== t && (this._fogEnabled = t, this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "fogMode", { get: function () { return this._fogMode }, set: function (t) { this._fogMode !== t && (this._fogMode = t, this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "shadowsEnabled", { get: function () { return this._shadowsEnabled }, set: function (t) { this._shadowsEnabled !== t && (this._shadowsEnabled = t, this.markAllMaterialsAsDirty(e.Material.LightDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "lightsEnabled", { get: function () { return this._lightsEnabled }, set: function (t) { this._lightsEnabled !== t && (this._lightsEnabled = t, this.markAllMaterialsAsDirty(e.Material.LightDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "defaultMaterial", { get: function () { return this._defaultMaterial || (this._defaultMaterial = new e.StandardMaterial("default material", this)), this._defaultMaterial }, set: function (e) { this._defaultMaterial = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "texturesEnabled", { get: function () { return this._texturesEnabled }, set: function (t) { this._texturesEnabled !== t && (this._texturesEnabled = t, this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "skeletonsEnabled", { get: function () { return this._skeletonsEnabled }, set: function (t) { this._skeletonsEnabled !== t && (this._skeletonsEnabled = t, this.markAllMaterialsAsDirty(e.Material.AttributesDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "_isAlternateRenderingEnabled", { get: function () { return this._alternateRendering }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "frustumPlanes", { get: function () { return this._frustumPlanes }, enumerable: !0, configurable: !0 }), r.prototype._registerTransientComponents = function () { if (0 < this._transientComponents.length) { for (var e = 0, t = this._transientComponents; e < t.length; e++)t[e].register(); this._transientComponents = [] } }, r.prototype._addComponent = function (e) { this._components.push(e), this._transientComponents.push(e); var t = e; t.addFromContainer && this._serializableComponents.push(t) }, r.prototype._getComponent = function (e) { for (var t = 0, i = this._components; t < i.length; t++) { var r = i[t]; if (r.name === e) return r } return null }, r.prototype._getDefaultMeshCandidates = function () { return this._defaultMeshCandidates.data = this.meshes, this._defaultMeshCandidates.length = this.meshes.length, this._defaultMeshCandidates }, r.prototype._getDefaultSubMeshCandidates = function (e) { return this._defaultSubMeshCandidates.data = e.subMeshes, this._defaultSubMeshCandidates.length = e.subMeshes.length, this._defaultSubMeshCandidates }, r.prototype.setDefaultCandidateProviders = function () { this.getActiveMeshCandidates = this._getDefaultMeshCandidates.bind(this), this.getActiveSubMeshCandidates = this._getDefaultSubMeshCandidates.bind(this), this.getIntersectingSubMeshCandidates = this._getDefaultSubMeshCandidates.bind(this), this.getCollidingSubMeshCandidates = this._getDefaultSubMeshCandidates.bind(this) }, Object.defineProperty(r.prototype, "workerCollisions", { get: function () { return this._workerCollisions }, set: function (t) { e.CollisionCoordinatorLegacy && (t = t && !!Worker && !!e.CollisionWorker, this._workerCollisions = t, this.collisionCoordinator && this.collisionCoordinator.destroy(), this.collisionCoordinator = t ? new e.CollisionCoordinatorWorker : new e.CollisionCoordinatorLegacy, this.collisionCoordinator.init(this)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "meshUnderPointer", { get: function () { return this._pointerOverMesh }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "pointerX", { get: function () { return this._pointerX }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "pointerY", { get: function () { return this._pointerY }, enumerable: !0, configurable: !0 }), r.prototype.getCachedMaterial = function () { return this._cachedMaterial }, r.prototype.getCachedEffect = function () { return this._cachedEffect }, r.prototype.getCachedVisibility = function () { return this._cachedVisibility }, r.prototype.isCachedMaterialInvalid = function (e, t, i) { return void 0 === i && (i = 1), this._cachedEffect !== t || this._cachedMaterial !== e || this._cachedVisibility !== i }, r.prototype.getEngine = function () { return this._engine }, r.prototype.getTotalVertices = function () { return this._totalVertices.current }, Object.defineProperty(r.prototype, "totalVerticesPerfCounter", { get: function () { return this._totalVertices }, enumerable: !0, configurable: !0 }), r.prototype.getActiveIndices = function () { return this._activeIndices.current }, Object.defineProperty(r.prototype, "totalActiveIndicesPerfCounter", { get: function () { return this._activeIndices }, enumerable: !0, configurable: !0 }), r.prototype.getActiveParticles = function () { return this._activeParticles.current }, Object.defineProperty(r.prototype, "activeParticlesPerfCounter", { get: function () { return this._activeParticles }, enumerable: !0, configurable: !0 }), r.prototype.getActiveBones = function () { return this._activeBones.current }, Object.defineProperty(r.prototype, "activeBonesPerfCounter", { get: function () { return this._activeBones }, enumerable: !0, configurable: !0 }), r.prototype.getInterFramePerfCounter = function () { return e.Tools.Warn("getInterFramePerfCounter is deprecated. Please use SceneInstrumentation class"), 0 }, Object.defineProperty(r.prototype, "interFramePerfCounter", { get: function () { return e.Tools.Warn("interFramePerfCounter is deprecated. Please use SceneInstrumentation class"), null }, enumerable: !0, configurable: !0 }), r.prototype.getLastFrameDuration = function () { return e.Tools.Warn("getLastFrameDuration is deprecated. Please use SceneInstrumentation class"), 0 }, Object.defineProperty(r.prototype, "lastFramePerfCounter", { get: function () { return e.Tools.Warn("lastFramePerfCounter is deprecated. Please use SceneInstrumentation class"), null }, enumerable: !0, configurable: !0 }), r.prototype.getEvaluateActiveMeshesDuration = function () { return e.Tools.Warn("getEvaluateActiveMeshesDuration is deprecated. Please use SceneInstrumentation class"), 0 }, Object.defineProperty(r.prototype, "evaluateActiveMeshesDurationPerfCounter", { get: function () { return e.Tools.Warn("evaluateActiveMeshesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"), null }, enumerable: !0, configurable: !0 }), r.prototype.getActiveMeshes = function () { return this._activeMeshes }, r.prototype.getRenderTargetsDuration = function () { return e.Tools.Warn("getRenderTargetsDuration is deprecated. Please use SceneInstrumentation class"), 0 }, r.prototype.getRenderDuration = function () { return e.Tools.Warn("getRenderDuration is deprecated. Please use SceneInstrumentation class"), 0 }, Object.defineProperty(r.prototype, "renderDurationPerfCounter", { get: function () { return e.Tools.Warn("renderDurationPerfCounter is deprecated. Please use SceneInstrumentation class"), null }, enumerable: !0, configurable: !0 }), r.prototype.getParticlesDuration = function () { return e.Tools.Warn("getParticlesDuration is deprecated. Please use SceneInstrumentation class"), 0 }, Object.defineProperty(r.prototype, "particlesDurationPerfCounter", { get: function () { return e.Tools.Warn("particlesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"), null }, enumerable: !0, configurable: !0 }), r.prototype.getSpritesDuration = function () { return e.Tools.Warn("getSpritesDuration is deprecated. Please use SceneInstrumentation class"), 0 }, Object.defineProperty(r.prototype, "spriteDuractionPerfCounter", { get: function () { return e.Tools.Warn("spriteDuractionPerfCounter is deprecated. Please use SceneInstrumentation class"), null }, enumerable: !0, configurable: !0 }), r.prototype.getAnimationRatio = function () { return void 0 !== this._animationRatio ? this._animationRatio : 1 }, r.prototype.getRenderId = function () { return this._renderId }, r.prototype.getFrameId = function () { return this._frameId }, r.prototype.incrementRenderId = function () { this._renderId++ }, r.prototype._updatePointerPosition = function (e) { var t = this._engine.getRenderingCanvasClientRect(); t && (this._pointerX = e.clientX - t.left, this._pointerY = e.clientY - t.top, this._unTranslatedPointerX = this._pointerX, this._unTranslatedPointerY = this._pointerY) }, r.prototype._createUbo = function () { this._sceneUbo = new e.UniformBuffer(this._engine, void 0, !0), this._sceneUbo.addUniform("viewProjection", 16), this._sceneUbo.addUniform("view", 16) }, r.prototype._createAlternateUbo = function () { this._alternateSceneUbo = new e.UniformBuffer(this._engine, void 0, !0), this._alternateSceneUbo.addUniform("viewProjection", 16), this._alternateSceneUbo.addUniform("view", 16) }, r.prototype._setRayOnPointerInfo = function (t) { t.pickInfo && (t.pickInfo.ray || (t.pickInfo.ray = this.createPickingRay(t.event.offsetX, t.event.offsetY, e.Matrix.Identity(), this.activeCamera))) }, r.prototype.simulatePointerMove = function (t, i) { var r = new PointerEvent("pointermove", i); return this._checkPrePointerObservable(t, r, e.PointerEventTypes.POINTERMOVE) ? this : this._processPointerMove(t, r) }, r.prototype._processPointerMove = function (t, i) { var r = this._engine.getRenderingCanvas(); if (!r) return this; r.style.cursor = this.defaultCursor; var n = !!(t && t.hit && t.pickedMesh); n ? (this.setPointerOverMesh(t.pickedMesh), this._pointerOverMesh && this._pointerOverMesh.actionManager && this._pointerOverMesh.actionManager.hasPointerTriggers && (this._pointerOverMesh.actionManager.hoverCursor ? r.style.cursor = this._pointerOverMesh.actionManager.hoverCursor : r.style.cursor = this.hoverCursor)) : this.setPointerOverMesh(null); for (var o = 0, s = this._pointerMoveStage; o < s.length; o++)t = s[o].action(this._unTranslatedPointerX, this._unTranslatedPointerY, t, n, r); if (t) { var a = "mousewheel" === i.type || "DOMMouseScroll" === i.type ? e.PointerEventTypes.POINTERWHEEL : e.PointerEventTypes.POINTERMOVE; if (this.onPointerMove && this.onPointerMove(i, t, a), this.onPointerObservable.hasObservers()) { var l = new e.PointerInfo(a, i, t); this._setRayOnPointerInfo(l), this.onPointerObservable.notifyObservers(l, a) } } return this }, r.prototype._checkPrePointerObservable = function (t, i, r) { var n = new e.PointerInfoPre(r, i, this._unTranslatedPointerX, this._unTranslatedPointerY); return t && (n.ray = t.ray), this.onPrePointerObservable.notifyObservers(n, r), !!n.skipOnPointerObservable }, r.prototype.simulatePointerDown = function (t, i) { var r = new PointerEvent("pointerdown", i); return this._checkPrePointerObservable(t, r, e.PointerEventTypes.POINTERDOWN) ? this : this._processPointerDown(t, r) }, r.prototype._processPointerDown = function (t, i) { var n = this; if (t && t.hit && t.pickedMesh) { this._pickedDownMesh = t.pickedMesh; var o = t.pickedMesh.actionManager; if (o) { if (o.hasPickTriggers) switch (o.processTrigger(e.ActionManager.OnPickDownTrigger, e.ActionEvent.CreateNew(t.pickedMesh, i)), i.button) { case 0: o.processTrigger(e.ActionManager.OnLeftPickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, i)); break; case 1: o.processTrigger(e.ActionManager.OnCenterPickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, i)); break; case 2: o.processTrigger(e.ActionManager.OnRightPickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, i)) }o.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger) && window.setTimeout(function () { var t = n.pick(n._unTranslatedPointerX, n._unTranslatedPointerY, function (t) { return t.isPickable && t.isVisible && t.isReady() && t.actionManager && t.actionManager.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger) && t == n._pickedDownMesh }, !1, n.cameraToUseForPointers); t && t.hit && t.pickedMesh && o && 0 !== n._totalPointersPressed && Date.now() - n._startingPointerTime > r.LongPressDelay && !n._isPointerSwiping() && (n._startingPointerTime = 0, o.processTrigger(e.ActionManager.OnLongPressTrigger, e.ActionEvent.CreateNew(t.pickedMesh, i))) }, r.LongPressDelay) } } else for (var s = 0, a = this._pointerDownStage; s < a.length; s++)t = a[s].action(this._unTranslatedPointerX, this._unTranslatedPointerY, t, i); if (t) { var l = e.PointerEventTypes.POINTERDOWN; if (this.onPointerDown && this.onPointerDown(i, t, l), this.onPointerObservable.hasObservers()) { var c = new e.PointerInfo(l, i, t); this._setRayOnPointerInfo(c), this.onPointerObservable.notifyObservers(c, l) } } return this }, r.prototype.simulatePointerUp = function (i, r) { var n = new PointerEvent("pointerup", r), o = new t; return o.singleClick = !0, o.ignore = !0, this._checkPrePointerObservable(i, n, e.PointerEventTypes.POINTERUP) ? this : this._processPointerUp(i, n, o) }, r.prototype._processPointerUp = function (t, i, r) { if (t && t && t.pickedMesh) { if (this._pickedUpMesh = t.pickedMesh, this._pickedDownMesh === this._pickedUpMesh && (this.onPointerPick && this.onPointerPick(i, t), r.singleClick && !r.ignore && this.onPointerObservable.hasObservers())) { var n = e.PointerEventTypes.POINTERPICK, o = new e.PointerInfo(n, i, t); this._setRayOnPointerInfo(o), this.onPointerObservable.notifyObservers(o, n) } t.pickedMesh.actionManager && (r.ignore && t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger, e.ActionEvent.CreateNew(t.pickedMesh, i)), r.hasSwiped || r.ignore || !r.singleClick || t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, i)), r.doubleClick && !r.ignore && t.pickedMesh.actionManager.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger) && t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnDoublePickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, i))) } else if (!r.ignore) for (var s = 0, a = this._pointerUpStage; s < a.length; s++)t = a[s].action(this._unTranslatedPointerX, this._unTranslatedPointerY, t, i); this._pickedDownMesh && this._pickedDownMesh.actionManager && this._pickedDownMesh.actionManager.hasSpecificTrigger(e.ActionManager.OnPickOutTrigger) && this._pickedDownMesh !== this._pickedUpMesh && this._pickedDownMesh.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger, e.ActionEvent.CreateNew(this._pickedDownMesh, i)); var l = e.PointerEventTypes.POINTERUP; if (this.onPointerObservable.hasObservers()) if (r.ignore) o = new e.PointerInfo(l, i, t), this._setRayOnPointerInfo(o), this.onPointerObservable.notifyObservers(o, l); else if (!r.hasSwiped) { if (r.singleClick && this.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP)) { var c = e.PointerEventTypes.POINTERTAP; o = new e.PointerInfo(c, i, t); this._setRayOnPointerInfo(o), this.onPointerObservable.notifyObservers(o, c) } if (r.doubleClick && this.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)) { var h = e.PointerEventTypes.POINTERDOUBLETAP; o = new e.PointerInfo(h, i, t), this._setRayOnPointerInfo(o), this.onPointerObservable.notifyObservers(o, h) } } return this.onPointerUp && this.onPointerUp(i, t, l), this }, r.prototype.isPointerCaptured = function (e) { return void 0 === e && (e = 0), this._pointerCaptures[e] }, r.prototype._isPointerSwiping = function () { return Math.abs(this._startingPointerPosition.x - this._pointerX) > r.DragMovementThreshold || Math.abs(this._startingPointerPosition.y - this._pointerY) > r.DragMovementThreshold }, r.prototype.attachControl = function (i, n, o) { var s = this; void 0 === i && (i = !0), void 0 === n && (n = !0), void 0 === o && (o = !0), this._initActionManager = function (e, t) { if (!s._meshPickProceed) { var i = s.pick(s._unTranslatedPointerX, s._unTranslatedPointerY, s.pointerDownPredicate, !1, s.cameraToUseForPointers); (s._currentPickResult = i) && (e = i.hit && i.pickedMesh ? i.pickedMesh.actionManager : null), s._meshPickProceed = !0 } return e }, this._delayedSimpleClick = function (e, t, i) { (Date.now() - s._previousStartingPointerTime > r.DoubleClickDelay && !s._doubleClickOccured || e !== s._previousButtonPressed) && (s._doubleClickOccured = !1, t.singleClick = !0, t.ignore = !1, i(t, s._currentPickResult)) }, this._initClickEvent = function (i, n, o, a) { var l = new t, c = s._currentPickResult = null, h = i.hasSpecificMask(e.PointerEventTypes.POINTERPICK) || n.hasSpecificMask(e.PointerEventTypes.POINTERPICK) || i.hasSpecificMask(e.PointerEventTypes.POINTERTAP) || n.hasSpecificMask(e.PointerEventTypes.POINTERTAP) || i.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP) || n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP); if (!h && e.ActionManager && e.ActionManager.HasPickTriggers && (c = s._initActionManager(c, l)) && (h = c.hasPickTriggers), h) { var u = o.button; if (l.hasSwiped = s._isPointerSwiping(), !l.hasSwiped) { var d = !r.ExclusiveDoubleClickMode; d || (d = !i.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP) && !n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)) && !e.ActionManager.HasSpecificTrigger(e.ActionManager.OnDoublePickTrigger) && (c = s._initActionManager(c, l)) && (d = !c.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)), d ? (Date.now() - s._previousStartingPointerTime > r.DoubleClickDelay || u !== s._previousButtonPressed) && (l.singleClick = !0, a(l, s._currentPickResult)) : (s._previousDelayedSimpleClickTimeout = s._delayedSimpleClickTimeout, s._delayedSimpleClickTimeout = window.setTimeout(s._delayedSimpleClick.bind(s, u, l, a), r.DoubleClickDelay)); var f = i.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP) || n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP); !f && e.ActionManager.HasSpecificTrigger(e.ActionManager.OnDoublePickTrigger) && (c = s._initActionManager(c, l)) && (f = c.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)), f && (u === s._previousButtonPressed && Date.now() - s._previousStartingPointerTime < r.DoubleClickDelay && !s._doubleClickOccured ? l.hasSwiped || s._isPointerSwiping() ? (s._doubleClickOccured = !1, s._previousStartingPointerTime = s._startingPointerTime, s._previousStartingPointerPosition.x = s._startingPointerPosition.x, s._previousStartingPointerPosition.y = s._startingPointerPosition.y, s._previousButtonPressed = u, r.ExclusiveDoubleClickMode ? (s._previousDelayedSimpleClickTimeout && clearTimeout(s._previousDelayedSimpleClickTimeout), s._previousDelayedSimpleClickTimeout = s._delayedSimpleClickTimeout, a(l, s._previousPickResult)) : a(l, s._currentPickResult)) : (s._previousStartingPointerTime = 0, s._doubleClickOccured = !0, l.doubleClick = !0, l.ignore = !1, r.ExclusiveDoubleClickMode && s._previousDelayedSimpleClickTimeout && clearTimeout(s._previousDelayedSimpleClickTimeout), s._previousDelayedSimpleClickTimeout = s._delayedSimpleClickTimeout, a(l, s._currentPickResult)) : (s._doubleClickOccured = !1, s._previousStartingPointerTime = s._startingPointerTime, s._previousStartingPointerPosition.x = s._startingPointerPosition.x, s._previousStartingPointerPosition.y = s._startingPointerPosition.y, s._previousButtonPressed = u)) } } l.ignore = !0, a(l, s._currentPickResult) }, this._onPointerMove = function (t) { if (s._updatePointerPosition(t), !s._checkPrePointerObservable(null, t, "mousewheel" === t.type || "DOMMouseScroll" === t.type ? e.PointerEventTypes.POINTERWHEEL : e.PointerEventTypes.POINTERMOVE) && (s.cameraToUseForPointers || s.activeCamera)) { s.pointerMovePredicate || (s.pointerMovePredicate = function (e) { return e.isPickable && e.isVisible && e.isReady() && e.isEnabled() && (e.enablePointerMoveEvents || s.constantlyUpdateMeshUnderPointer || null !== e.actionManager && void 0 !== e.actionManager) }); var i = s.pick(s._unTranslatedPointerX, s._unTranslatedPointerY, s.pointerMovePredicate, !1, s.cameraToUseForPointers); s._processPointerMove(i, t) } }, this._onPointerDown = function (t) { if (s._totalPointersPressed++ , s._pickedDownMesh = null, s._meshPickProceed = !1, s._updatePointerPosition(t), s.preventDefaultOnPointerDown && c && (t.preventDefault(), c.focus()), !s._checkPrePointerObservable(null, t, e.PointerEventTypes.POINTERDOWN) && (s.cameraToUseForPointers || s.activeCamera)) { s._pointerCaptures[t.pointerId] = !0, s._startingPointerPosition.x = s._pointerX, s._startingPointerPosition.y = s._pointerY, s._startingPointerTime = Date.now(), s.pointerDownPredicate || (s.pointerDownPredicate = function (e) { return e.isPickable && e.isVisible && e.isReady() && e.isEnabled() }), s._pickedDownMesh = null; var i = s.pick(s._unTranslatedPointerX, s._unTranslatedPointerY, s.pointerDownPredicate, !1, s.cameraToUseForPointers); s._processPointerDown(i, t) } }, this._onPointerUp = function (t) { 0 !== s._totalPointersPressed && (s._totalPointersPressed-- , s._pickedUpMesh = null, s._meshPickProceed = !1, s._updatePointerPosition(t), s._initClickEvent(s.onPrePointerObservable, s.onPointerObservable, t, function (i, r) { if (s.onPrePointerObservable.hasObservers()) if (i.ignore) { if (s._checkPrePointerObservable(null, t, e.PointerEventTypes.POINTERUP)) return } else if (!i.hasSwiped) { if (i.singleClick && s.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP) && s._checkPrePointerObservable(null, t, e.PointerEventTypes.POINTERTAP)) return; if (i.doubleClick && s.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP) && s._checkPrePointerObservable(null, t, e.PointerEventTypes.POINTERDOUBLETAP)) return } (s.cameraToUseForPointers || s.activeCamera) && (s._pointerCaptures[t.pointerId] = !1, s.pointerUpPredicate || (s.pointerUpPredicate = function (e) { return e.isPickable && e.isVisible && e.isReady() && e.isEnabled() }), !s._meshPickProceed && (e.ActionManager && e.ActionManager.HasTriggers || s.onPointerObservable.hasObservers()) && s._initActionManager(null, i), r || (r = s._currentPickResult), s._processPointerUp(r, t, i), s._previousPickResult = s._currentPickResult) })) }, this._onKeyDown = function (t) { var i = e.KeyboardEventTypes.KEYDOWN; if (s.onPreKeyboardObservable.hasObservers()) { var r = new e.KeyboardInfoPre(i, t); if (s.onPreKeyboardObservable.notifyObservers(r, i), r.skipOnPointerObservable) return } s.onKeyboardObservable.hasObservers() && (r = new e.KeyboardInfo(i, t), s.onKeyboardObservable.notifyObservers(r, i)), s.actionManager && s.actionManager.processTrigger(e.ActionManager.OnKeyDownTrigger, e.ActionEvent.CreateNewFromScene(s, t)) }, this._onKeyUp = function (t) { var i = e.KeyboardEventTypes.KEYUP; if (s.onPreKeyboardObservable.hasObservers()) { var r = new e.KeyboardInfoPre(i, t); if (s.onPreKeyboardObservable.notifyObservers(r, i), r.skipOnPointerObservable) return } s.onKeyboardObservable.hasObservers() && (r = new e.KeyboardInfo(i, t), s.onKeyboardObservable.notifyObservers(r, i)), s.actionManager && s.actionManager.processTrigger(e.ActionManager.OnKeyUpTrigger, e.ActionEvent.CreateNewFromScene(s, t)) }; var a = this.getEngine(); this._onCanvasFocusObserver = a.onCanvasFocusObservable.add(function () { c && (c.addEventListener("keydown", s._onKeyDown, !1), c.addEventListener("keyup", s._onKeyUp, !1)) }), this._onCanvasBlurObserver = a.onCanvasBlurObservable.add(function () { c && (c.removeEventListener("keydown", s._onKeyDown), c.removeEventListener("keyup", s._onKeyUp)) }); var l = e.Tools.GetPointerPrefix(), c = this._engine.getRenderingCanvas(); c && (o && (c.addEventListener(l + "move", this._onPointerMove, !1), c.addEventListener("mousewheel", this._onPointerMove, !1), c.addEventListener("DOMMouseScroll", this._onPointerMove, !1)), n && c.addEventListener(l + "down", this._onPointerDown, !1), i && window.addEventListener(l + "up", this._onPointerUp, !1), c.tabIndex = 1) }, r.prototype.detachControl = function () { var t = this.getEngine(), i = e.Tools.GetPointerPrefix(), r = t.getRenderingCanvas(); r && (r.removeEventListener(i + "move", this._onPointerMove), r.removeEventListener(i + "down", this._onPointerDown), window.removeEventListener(i + "up", this._onPointerUp), this._onCanvasBlurObserver && t.onCanvasBlurObservable.remove(this._onCanvasBlurObserver), this._onCanvasFocusObserver && t.onCanvasFocusObservable.remove(this._onCanvasFocusObserver), r.removeEventListener("mousewheel", this._onPointerMove), r.removeEventListener("DOMMouseScroll", this._onPointerMove), r.removeEventListener("keydown", this._onKeyDown), r.removeEventListener("keyup", this._onKeyUp), this.onKeyboardObservable.clear(), this.onPreKeyboardObservable.clear(), this.onPointerObservable.clear(), this.onPrePointerObservable.clear()) }, r.prototype.isReady = function () { if (this._isDisposed) return !1; if (0 < this._pendingData.length) return !1; var t, i = this.getEngine(); for (t = 0; t < this.geometries.length; t++)if (this.geometries[t].delayLoadState === e.Engine.DELAYLOADSTATE_LOADING) return !1; for (t = 0; t < this.meshes.length; t++) { var r = this.meshes[t]; if (r.isEnabled() && r.subMeshes && 0 !== r.subMeshes.length) { if (!r.isReady(!0)) return !1; for (var n = "InstancedMesh" === r.getClassName() || i.getCaps().instancedArrays && 0 < r.instances.length, o = 0, s = this._isReadyForMeshStage; o < s.length; o++)if (!s[o].action(r, n)) return !1 } } if (this.activeCameras && 0 < this.activeCameras.length) { for (var a = 0, l = this.activeCameras; a < l.length; a++)if (!l[a].isReady(!0)) return !1 } else if (this.activeCamera && !this.activeCamera.isReady(!0)) return !1; for (var c = 0, h = this.particleSystems; c < h.length; c++)if (!h[c].isReady()) return !1; return !0 }, r.prototype.resetCachedMaterial = function () { this._cachedMaterial = null, this._cachedEffect = null, this._cachedVisibility = null }, r.prototype.registerBeforeRender = function (e) { this.onBeforeRenderObservable.add(e) }, r.prototype.unregisterBeforeRender = function (e) { this.onBeforeRenderObservable.removeCallback(e) }, r.prototype.registerAfterRender = function (e) { this.onAfterRenderObservable.add(e) }, r.prototype.unregisterAfterRender = function (e) { this.onAfterRenderObservable.removeCallback(e) }, r.prototype._executeOnceBeforeRender = function (e) { var t = this, i = function () { e(), setTimeout(function () { t.unregisterBeforeRender(i) }) }; this.registerBeforeRender(i) }, r.prototype.executeOnceBeforeRender = function (e, t) { var i = this; void 0 !== t ? setTimeout(function () { i._executeOnceBeforeRender(e) }, t) : this._executeOnceBeforeRender(e) }, r.prototype._addPendingData = function (e) { this._pendingData.push(e) }, r.prototype._removePendingData = function (e) { var t = this.isLoading, i = this._pendingData.indexOf(e); -1 !== i && this._pendingData.splice(i, 1), t && !this.isLoading && this.onDataLoadedObservable.notifyObservers(this) }, r.prototype.getWaitingItemsCount = function () { return this._pendingData.length }, Object.defineProperty(r.prototype, "isLoading", { get: function () { return 0 < this._pendingData.length }, enumerable: !0, configurable: !0 }), r.prototype.executeWhenReady = function (e) { var t = this; this.onReadyObservable.add(e), -1 === this._executeWhenReadyTimeoutId && (this._executeWhenReadyTimeoutId = setTimeout(function () { t._checkIsReady() }, 150)) }, r.prototype.whenReadyAsync = function () { var e = this; return new Promise(function (t) { e.executeWhenReady(function () { t() }) }) }, r.prototype._checkIsReady = function () { var e = this; if (this._registerTransientComponents(), this.isReady()) return this.onReadyObservable.notifyObservers(this), this.onReadyObservable.clear(), void (this._executeWhenReadyTimeoutId = -1); this._executeWhenReadyTimeoutId = setTimeout(function () { e._checkIsReady() }, 150) }, r.prototype.beginWeightedAnimation = function (e, t, i, r, n, o, s, a, l) { void 0 === r && (r = 1), void 0 === o && (o = 1); var c = this.beginAnimation(e, t, i, n, o, s, a, !1, l); return c.weight = r, c }, r.prototype.beginAnimation = function (t, i, r, n, o, s, a, l, c) { void 0 === o && (o = 1), void 0 === l && (l = !0), r < i && 0 < o && (o *= -1), l && this.stopAnimation(t, void 0, c), a || (a = new e.Animatable(this, t, i, r, n, o, s)); var h = !c || c(t); if (t.animations && h && a.appendAnimations(t, t.animations), t.getAnimatables) for (var u = t.getAnimatables(), d = 0; d < u.length; d++)this.beginAnimation(u[d], i, r, n, o, s, a, l, c); return a.reset(), a }, r.prototype.beginDirectAnimation = function (t, i, r, n, o, s, a) { return void 0 === s && (s = 1), new e.Animatable(this, t, r, n, o, s, a, i) }, r.prototype.beginDirectHierarchyAnimation = function (e, t, i, r, n, o, s, a) { var l = e.getDescendants(t), c = []; c.push(this.beginDirectAnimation(e, i, r, n, o, s, a)); for (var h = 0, u = l; h < u.length; h++) { var d = u[h]; c.push(this.beginDirectAnimation(d, i, r, n, o, s, a)) } return c }, r.prototype.getAnimatableByTarget = function (e) { for (var t = 0; t < this._activeAnimatables.length; t++)if (this._activeAnimatables[t].target === e) return this._activeAnimatables[t]; return null }, r.prototype.getAllAnimatablesByTarget = function (e) { for (var t = [], i = 0; i < this._activeAnimatables.length; i++)this._activeAnimatables[i].target === e && t.push(this._activeAnimatables[i]); return t }, Object.defineProperty(r.prototype, "animatables", { get: function () { return this._activeAnimatables }, enumerable: !0, configurable: !0 }), r.prototype.stopAnimation = function (e, t, i) { for (var r = 0, n = this.getAllAnimatablesByTarget(e); r < n.length; r++)n[r].stop(t, i) }, r.prototype.stopAllAnimations = function () { if (this._activeAnimatables) { for (var e = 0; e < this._activeAnimatables.length; e++)this._activeAnimatables[e].stop(); this._activeAnimatables = [] } for (var t = 0, i = this.animationGroups; t < i.length; t++)i[t].stop() }, r.prototype._animate = function () { if (this.animationsEnabled && 0 !== this._activeAnimatables.length) { var t = e.Tools.Now; if (!this._animationTimeLast) { if (0 < this._pendingData.length) return; this._animationTimeLast = t } var i = this.useConstantAnimationDeltaTime ? 16 : (t - this._animationTimeLast) * this.animationTimeScale; this._animationTime += i, this._animationTimeLast = t; for (var r = 0; r < this._activeAnimatables.length; r++)this._activeAnimatables[r]._animate(this._animationTime); this._processLateAnimationBindings() } }, r.prototype._registerTargetForLateAnimationBinding = function (e, t) { var i = e.target; this._registeredForLateAnimationBindings.pushNoDuplicate(i), i._lateAnimationHolders || (i._lateAnimationHolders = {}), i._lateAnimationHolders[e.targetPath] || (i._lateAnimationHolders[e.targetPath] = { totalWeight: 0, animations: [], originalValue: t }), i._lateAnimationHolders[e.targetPath].animations.push(e), i._lateAnimationHolders[e.targetPath].totalWeight += e.weight }, r.prototype._processLateAnimationBindingsForMatrices = function (t) { var i = 1, r = e.Tmp.Vector3[0], n = e.Tmp.Vector3[1], o = e.Tmp.Quaternion[0], s = 0, a = t.animations[0], l = t.originalValue, c = 1; if (t.totalWeight < 1) l.decompose(n, o, r), c = 1 - t.totalWeight; else if (s = 1, i = t.totalWeight, a.currentValue.decompose(n, o, r), 1 == (c = a.weight / i)) return a.currentValue; n.scaleInPlace(c), r.scaleInPlace(c), o.scaleInPlace(c); for (var h = s; h < t.animations.length; h++) { var u = t.animations[h], d = (c = u.weight / i, e.Tmp.Vector3[2]), f = e.Tmp.Vector3[3], p = e.Tmp.Quaternion[1]; u.currentValue.decompose(f, p, d), f.scaleAndAddToRef(c, n), p.scaleAndAddToRef(c, o), d.scaleAndAddToRef(c, r) } return e.Matrix.ComposeToRef(n, o, r, a._workValue), a._workValue }, r.prototype._processLateAnimationBindingsForQuaternions = function (t, i) { var r = t.animations[0], n = t.originalValue; if (1 === t.animations.length) return e.Quaternion.SlerpToRef(n, r.currentValue, Math.min(1, t.totalWeight), i), i; var o, s, a = 1; if (t.totalWeight < 1) { var l = 1 - t.totalWeight; s = [], (o = []).push(n), s.push(l) } else { if (2 === t.animations.length) return e.Quaternion.SlerpToRef(t.animations[0].currentValue, t.animations[1].currentValue, t.animations[1].weight / t.totalWeight, i), i; o = [], s = [], a = t.totalWeight } for (var c = 0; c < t.animations.length; c++) { var h = t.animations[c]; o.push(h.currentValue), s.push(h.weight / a) } for (var u = 0, d = null, f = 0; f < o.length;)d ? (u += s[f], e.Quaternion.SlerpToRef(d, o[f], s[f] / u, d), f++) : (e.Quaternion.SlerpToRef(o[f], o[f + 1], s[f + 1] / (s[f] + s[f + 1]), i), d = i, u = s[f] + s[f + 1], f += 2); return d }, r.prototype._processLateAnimationBindings = function () { if (this._registeredForLateAnimationBindings.length) { for (var t = 0; t < this._registeredForLateAnimationBindings.length; t++) { var i = this._registeredForLateAnimationBindings.data[t]; for (var r in i._lateAnimationHolders) { var n = i._lateAnimationHolders[r], o = n.animations[0], s = n.originalValue, a = e.Animation.AllowMatrixDecomposeForInterpolation && s.m, l = i[r]; if (a) l = this._processLateAnimationBindingsForMatrices(n); else if (void 0 !== s.w) l = this._processLateAnimationBindingsForQuaternions(n, l || e.Quaternion.Identity()); else { var c = 0, h = 1; if (n.totalWeight < 1) l = s.scale ? s.scale(1 - n.totalWeight) : s * (1 - n.totalWeight); else { h = n.totalWeight; var u = o.weight / h; l = 1 !== u ? o.currentValue.scale ? o.currentValue.scale(u) : o.currentValue * u : o.currentValue, c = 1 } for (var d = c; d < n.animations.length; d++) { var f = n.animations[d], p = f.weight / h; f.currentValue.scaleAndAddToRef ? f.currentValue.scaleAndAddToRef(p, l) : l += f.currentValue * p } } i[r] = l } i._lateAnimationHolders = {} } this._registeredForLateAnimationBindings.reset() } }, r.prototype._switchToAlternateCameraConfiguration = function (e) { this._useAlternateCameraConfiguration = e }, r.prototype.getViewMatrix = function () { return this._useAlternateCameraConfiguration ? this._alternateViewMatrix : this._viewMatrix }, r.prototype.getProjectionMatrix = function () { return this._useAlternateCameraConfiguration ? this._alternateProjectionMatrix : this._projectionMatrix }, r.prototype.getTransformMatrix = function () { return this._useAlternateCameraConfiguration ? this._alternateTransformMatrix : this._transformMatrix }, r.prototype.setTransformMatrix = function (t, i) { if (this._viewUpdateFlag !== t.updateFlag || this._projectionUpdateFlag !== i.updateFlag) { if (this._viewUpdateFlag = t.updateFlag, this._projectionUpdateFlag = i.updateFlag, this._viewMatrix = t, this._projectionMatrix = i, this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix), this._frustumPlanes ? e.Frustum.GetPlanesToRef(this._transformMatrix, this._frustumPlanes) : this._frustumPlanes = e.Frustum.GetPlanes(this._transformMatrix), this.activeCamera && this.activeCamera._alternateCamera) { var r = this.activeCamera._alternateCamera; r.getViewMatrix().multiplyToRef(r.getProjectionMatrix(), e.Tmp.Matrix[0]), e.Frustum.GetRightPlaneToRef(e.Tmp.Matrix[0], this._frustumPlanes[3]) } this._sceneUbo.useUbo && (this._sceneUbo.updateMatrix("viewProjection", this._transformMatrix), this._sceneUbo.updateMatrix("view", this._viewMatrix), this._sceneUbo.update()) } }, r.prototype._setAlternateTransformMatrix = function (t, i) { this._alternateViewUpdateFlag === t.updateFlag && this._alternateProjectionUpdateFlag === i.updateFlag || (this._alternateViewUpdateFlag = t.updateFlag, this._alternateProjectionUpdateFlag = i.updateFlag, this._alternateViewMatrix = t, this._alternateProjectionMatrix = i, this._alternateTransformMatrix || (this._alternateTransformMatrix = e.Matrix.Zero()), this._alternateViewMatrix.multiplyToRef(this._alternateProjectionMatrix, this._alternateTransformMatrix), this._alternateSceneUbo || this._createAlternateUbo(), this._alternateSceneUbo.useUbo && (this._alternateSceneUbo.updateMatrix("viewProjection", this._alternateTransformMatrix), this._alternateSceneUbo.updateMatrix("view", this._alternateViewMatrix), this._alternateSceneUbo.update())) }, r.prototype.getSceneUniformBuffer = function () { return this._useAlternateCameraConfiguration ? this._alternateSceneUbo : this._sceneUbo }, r.prototype.getUniqueId = function () { var e = r._uniqueIdCounter; return r._uniqueIdCounter++ , e }, r.prototype.addMesh = function (e, t) { var i = this; void 0 === t && (t = !1), this.meshes.push(e), this.collisionCoordinator && this.collisionCoordinator.onMeshAdded(e), e._resyncLightSources(), this.onNewMeshAddedObservable.notifyObservers(e), t && e.getChildMeshes().forEach(function (e) { i.addMesh(e) }) }, r.prototype.removeMesh = function (e, t) { var i = this; void 0 === t && (t = !1); var r = this.meshes.indexOf(e); return -1 !== r && this.meshes.splice(r, 1), this.onMeshRemovedObservable.notifyObservers(e), t && e.getChildMeshes().forEach(function (e) { i.removeMesh(e) }), r }, r.prototype.addTransformNode = function (e) { this.transformNodes.push(e), this.onNewTransformNodeAddedObservable.notifyObservers(e) }, r.prototype.removeTransformNode = function (e) { var t = this.transformNodes.indexOf(e); return -1 !== t && this.transformNodes.splice(t, 1), this.onTransformNodeRemovedObservable.notifyObservers(e), t }, r.prototype.removeSkeleton = function (e) { var t = this.skeletons.indexOf(e); return -1 !== t && this.skeletons.splice(t, 1), t }, r.prototype.removeMorphTargetManager = function (e) { var t = this.morphTargetManagers.indexOf(e); return -1 !== t && this.morphTargetManagers.splice(t, 1), t }, r.prototype.removeLight = function (e) { var t = this.lights.indexOf(e); if (-1 !== t) { for (var i = 0, r = this.meshes; i < r.length; i++)r[i]._removeLightSource(e); this.lights.splice(t, 1), this.sortLightsByPriority() } return this.onLightRemovedObservable.notifyObservers(e), t }, r.prototype.removeCamera = function (e) { var t = this.cameras.indexOf(e); -1 !== t && this.cameras.splice(t, 1); var i = this.activeCameras.indexOf(e); return -1 !== i && this.activeCameras.splice(i, 1), this.activeCamera === e && (0 < this.cameras.length ? this.activeCamera = this.cameras[0] : this.activeCamera = null), this.onCameraRemovedObservable.notifyObservers(e), t }, r.prototype.removeParticleSystem = function (e) { var t = this.particleSystems.indexOf(e); return -1 !== t && this.particleSystems.splice(t, 1), t }, r.prototype.removeAnimation = function (e) { var t = this.animations.indexOf(e); return -1 !== t && this.animations.splice(t, 1), t }, r.prototype.removeAnimationGroup = function (e) { var t = this.animationGroups.indexOf(e); return -1 !== t && this.animationGroups.splice(t, 1), t }, r.prototype.removeMultiMaterial = function (e) { var t = this.multiMaterials.indexOf(e); return -1 !== t && this.multiMaterials.splice(t, 1), t }, r.prototype.removeMaterial = function (e) { var t = this.materials.indexOf(e); return -1 !== t && this.materials.splice(t, 1), this.onMaterialRemovedObservable.notifyObservers(e), t }, r.prototype.removeActionManager = function (e) { var t = this.actionManagers.indexOf(e); return -1 !== t && this.actionManagers.splice(t, 1), t }, r.prototype.removeTexture = function (e) { var t = this.textures.indexOf(e); return -1 !== t && this.textures.splice(t, 1), this.onTextureRemovedObservable.notifyObservers(e), t }, r.prototype.addLight = function (e) { this.lights.push(e), this.sortLightsByPriority(); for (var t = 0, i = this.meshes; t < i.length; t++) { var r = i[t]; -1 === r._lightSources.indexOf(e) && (r._lightSources.push(e), r._resyncLightSources()) } this.onNewLightAddedObservable.notifyObservers(e) }, r.prototype.sortLightsByPriority = function () { this.requireLightSorting && this.lights.sort(e.Light.CompareLightsPriority) }, r.prototype.addCamera = function (e) { this.cameras.push(e), this.onNewCameraAddedObservable.notifyObservers(e) }, r.prototype.addSkeleton = function (e) { this.skeletons.push(e) }, r.prototype.addParticleSystem = function (e) { this.particleSystems.push(e) }, r.prototype.addAnimation = function (e) { this.animations.push(e) }, r.prototype.addAnimationGroup = function (e) { this.animationGroups.push(e) }, r.prototype.addMultiMaterial = function (e) { this.multiMaterials.push(e) }, r.prototype.addMaterial = function (e) { this.materials.push(e), this.onNewMaterialAddedObservable.notifyObservers(e) }, r.prototype.addMorphTargetManager = function (e) { this.morphTargetManagers.push(e) }, r.prototype.addGeometry = function (e) { this.geometries.push(e) }, r.prototype.addActionManager = function (e) { this.actionManagers.push(e) }, r.prototype.addTexture = function (e) { this.textures.push(e), this.onNewTextureAddedObservable.notifyObservers(e) }, r.prototype.switchActiveCamera = function (e, t) { void 0 === t && (t = !0); var i = this._engine.getRenderingCanvas(); i && (this.activeCamera && this.activeCamera.detachControl(i), this.activeCamera = e, t && e.attachControl(i)) }, r.prototype.setActiveCameraByID = function (e) { var t = this.getCameraByID(e); return t ? this.activeCamera = t : null }, r.prototype.setActiveCameraByName = function (e) { var t = this.getCameraByName(e); return t ? this.activeCamera = t : null }, r.prototype.getAnimationGroupByName = function (e) { for (var t = 0; t < this.animationGroups.length; t++)if (this.animationGroups[t].name === e) return this.animationGroups[t]; return null }, r.prototype.getMaterialByID = function (e) { for (var t = 0; t < this.materials.length; t++)if (this.materials[t].id === e) return this.materials[t]; return null }, r.prototype.getMaterialByName = function (e) { for (var t = 0; t < this.materials.length; t++)if (this.materials[t].name === e) return this.materials[t]; return null }, r.prototype.getCameraByID = function (e) { for (var t = 0; t < this.cameras.length; t++)if (this.cameras[t].id === e) return this.cameras[t]; return null }, r.prototype.getCameraByUniqueID = function (e) { for (var t = 0; t < this.cameras.length; t++)if (this.cameras[t].uniqueId === e) return this.cameras[t]; return null }, r.prototype.getCameraByName = function (e) { for (var t = 0; t < this.cameras.length; t++)if (this.cameras[t].name === e) return this.cameras[t]; return null }, r.prototype.getBoneByID = function (e) { for (var t = 0; t < this.skeletons.length; t++)for (var i = this.skeletons[t], r = 0; r < i.bones.length; r++)if (i.bones[r].id === e) return i.bones[r]; return null }, r.prototype.getBoneByName = function (e) { for (var t = 0; t < this.skeletons.length; t++)for (var i = this.skeletons[t], r = 0; r < i.bones.length; r++)if (i.bones[r].name === e) return i.bones[r]; return null }, r.prototype.getLightByName = function (e) { for (var t = 0; t < this.lights.length; t++)if (this.lights[t].name === e) return this.lights[t]; return null }, r.prototype.getLightByID = function (e) { for (var t = 0; t < this.lights.length; t++)if (this.lights[t].id === e) return this.lights[t]; return null }, r.prototype.getLightByUniqueID = function (e) { for (var t = 0; t < this.lights.length; t++)if (this.lights[t].uniqueId === e) return this.lights[t]; return null }, r.prototype.getParticleSystemByID = function (e) { for (var t = 0; t < this.particleSystems.length; t++)if (this.particleSystems[t].id === e) return this.particleSystems[t]; return null }, r.prototype.getGeometryByID = function (e) { for (var t = 0; t < this.geometries.length; t++)if (this.geometries[t].id === e) return this.geometries[t]; return null }, r.prototype.pushGeometry = function (e, t) { return !(!t && this.getGeometryByID(e.id) || (this.geometries.push(e), this.collisionCoordinator && this.collisionCoordinator.onGeometryAdded(e), this.onNewGeometryAddedObservable.notifyObservers(e), 0)) }, r.prototype.removeGeometry = function (e) { var t = this.geometries.indexOf(e); return -1 < t && (this.geometries.splice(t, 1), this.collisionCoordinator && this.collisionCoordinator.onGeometryDeleted(e), this.onGeometryRemovedObservable.notifyObservers(e), !0) }, r.prototype.getGeometries = function () { return this.geometries }, r.prototype.getMeshByID = function (e) { for (var t = 0; t < this.meshes.length; t++)if (this.meshes[t].id === e) return this.meshes[t]; return null }, r.prototype.getMeshesByID = function (e) { return this.meshes.filter(function (t) { return t.id === e }) }, r.prototype.getTransformNodeByID = function (e) { for (var t = 0; t < this.transformNodes.length; t++)if (this.transformNodes[t].id === e) return this.transformNodes[t]; return null }, r.prototype.getTransformNodesByID = function (e) { return this.transformNodes.filter(function (t) { return t.id === e }) }, r.prototype.getMeshByUniqueID = function (e) { for (var t = 0; t < this.meshes.length; t++)if (this.meshes[t].uniqueId === e) return this.meshes[t]; return null }, r.prototype.getLastMeshByID = function (e) { for (var t = this.meshes.length - 1; 0 <= t; t--)if (this.meshes[t].id === e) return this.meshes[t]; return null }, r.prototype.getLastEntryByID = function (e) { var t; for (t = this.meshes.length - 1; 0 <= t; t--)if (this.meshes[t].id === e) return this.meshes[t]; for (t = this.transformNodes.length - 1; 0 <= t; t--)if (this.transformNodes[t].id === e) return this.transformNodes[t]; for (t = this.cameras.length - 1; 0 <= t; t--)if (this.cameras[t].id === e) return this.cameras[t]; for (t = this.lights.length - 1; 0 <= t; t--)if (this.lights[t].id === e) return this.lights[t]; return null }, r.prototype.getNodeByID = function (e) { var t = this.getMeshByID(e); if (t) return t; var i = this.getLightByID(e); return i || (this.getCameraByID(e) || this.getBoneByID(e)) }, r.prototype.getNodeByName = function (e) { var t = this.getMeshByName(e); if (t) return t; var i = this.getLightByName(e); return i || (this.getCameraByName(e) || this.getBoneByName(e)) }, r.prototype.getMeshByName = function (e) { for (var t = 0; t < this.meshes.length; t++)if (this.meshes[t].name === e) return this.meshes[t]; return null }, r.prototype.getTransformNodeByName = function (e) { for (var t = 0; t < this.transformNodes.length; t++)if (this.transformNodes[t].name === e) return this.transformNodes[t]; return null }, r.prototype.getLastSkeletonByID = function (e) { for (var t = this.skeletons.length - 1; 0 <= t; t--)if (this.skeletons[t].id === e) return this.skeletons[t]; return null }, r.prototype.getSkeletonById = function (e) { for (var t = 0; t < this.skeletons.length; t++)if (this.skeletons[t].id === e) return this.skeletons[t]; return null }, r.prototype.getSkeletonByName = function (e) { for (var t = 0; t < this.skeletons.length; t++)if (this.skeletons[t].name === e) return this.skeletons[t]; return null }, r.prototype.getMorphTargetManagerById = function (e) { for (var t = 0; t < this.morphTargetManagers.length; t++)if (this.morphTargetManagers[t].uniqueId === e) return this.morphTargetManagers[t]; return null }, r.prototype.isActiveMesh = function (e) { return -1 !== this._activeMeshes.indexOf(e) }, Object.defineProperty(r.prototype, "uid", { get: function () { return this._uid || (this._uid = e.Tools.RandomId()), this._uid }, enumerable: !0, configurable: !0 }), r.prototype.addExternalData = function (t, i) { return this._externalData || (this._externalData = new e.StringDictionary), this._externalData.add(t, i) }, r.prototype.getExternalData = function (e) { return this._externalData ? this._externalData.get(e) : null }, r.prototype.getOrAddExternalDataWithFactory = function (t, i) { return this._externalData || (this._externalData = new e.StringDictionary), this._externalData.getOrAddWithFactory(t, i) }, r.prototype.removeExternalData = function (e) { return this._externalData.remove(e) }, r.prototype._evaluateSubMesh = function (e, t) { if (this.dispatchAllSubMeshesOfActiveMeshes || t.alwaysSelectAsActiveMesh || 1 === t.subMeshes.length || e.isInFrustum(this._frustumPlanes)) { for (var i = 0, r = this._evaluateSubMeshStage; i < r.length; i++)r[i].action(t, e); var n = e.getMaterial(); null != n && (n.hasRenderTargetTextures && void 0 !== n.getRenderTargetTextures && -1 === this._processedMaterials.indexOf(n) && (this._processedMaterials.push(n), this._renderTargets.concatWithNoDuplicate(n.getRenderTargetTextures())), this._activeIndices.addCount(e.indexCount, !1), this._renderingManager.dispatch(e, t, n)) } }, r.prototype.freeProcessedMaterials = function () { this._processedMaterials.dispose() }, r.prototype.freeActiveMeshes = function () { if (this._activeMeshes.dispose(), this.activeCamera && this.activeCamera._activeMeshes && this.activeCamera._activeMeshes.dispose(), this.activeCameras) for (var e = 0; e < this.activeCameras.length; e++) { var t = this.activeCameras[e]; t && t._activeMeshes && t._activeMeshes.dispose() } }, r.prototype.freeRenderingGroups = function () { if (this._renderingManager && this._renderingManager.freeRenderingGroups(), this.textures) for (var e = 0; e < this.textures.length; e++) { var t = this.textures[e]; t && t.renderList && t.freeRenderingGroups() } }, r.prototype._isInIntermediateRendering = function () { return this._intermediateRendering }, r.prototype.freezeActiveMeshes = function () { return this.activeCamera && (this._frustumPlanes || this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix()), this._evaluateActiveMeshes(), this._activeMeshesFrozen = !0), this }, r.prototype.unfreezeActiveMeshes = function () { return this._activeMeshesFrozen = !1, this }, r.prototype._evaluateActiveMeshes = function () { if ((!this._activeMeshesFrozen || !this._activeMeshes.length) && this.activeCamera) { this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this), this.activeCamera._activeMeshes.reset(), this._activeMeshes.reset(), this._renderingManager.reset(), this._processedMaterials.reset(), this._activeParticleSystems.reset(), this._activeSkeletons.reset(), this._softwareSkinnedMeshes.reset(); for (var t = 0, i = this._beforeEvaluateActiveMeshStage; t < i.length; t++)i[t].action(); for (var r = this.getActiveMeshCandidates(), n = r.length, o = 0; o < n; o++) { var s = r.data[o]; if (!s.isBlocked && (this._totalVertices.addCount(s.getTotalVertices(), !1), s.isReady() && s.isEnabled())) { s.computeWorldMatrix(), s.actionManager && s.actionManager.hasSpecificTriggers2(e.ActionManager.OnIntersectionEnterTrigger, e.ActionManager.OnIntersectionExitTrigger) && this._meshesForIntersections.pushNoDuplicate(s); var a = s.getLOD(this.activeCamera); null != a && (s._preActivate(), s.isVisible && 0 < s.visibility && (s.alwaysSelectAsActiveMesh || 0 != (s.layerMask & this.activeCamera.layerMask) && s.isInFrustum(this._frustumPlanes)) && (this._activeMeshes.push(s), this.activeCamera._activeMeshes.push(s), s._activate(this._renderId), a !== s && a._activate(this._renderId), this._activeMesh(s, a))) } } if (this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this), this.particlesEnabled) { this.onBeforeParticlesRenderingObservable.notifyObservers(this); for (var l = 0; l < this.particleSystems.length; l++) { var c = this.particleSystems[l]; if (c.isStarted() && c.emitter) { var h = c.emitter; h.position && !h.isEnabled() || (this._activeParticleSystems.push(c), c.animate(), this._renderingManager.dispatchParticles(c)) } } this.onAfterParticlesRenderingObservable.notifyObservers(this) } } }, r.prototype._activeMesh = function (e, t) { this._skeletonsEnabled && null !== t.skeleton && void 0 !== t.skeleton && (this._activeSkeletons.pushNoDuplicate(t.skeleton) && t.skeleton.prepare(), t.computeBonesUsingShaders || this._softwareSkinnedMeshes.pushNoDuplicate(t)); for (var i = 0, r = this._activeMeshStage; i < r.length; i++)r[i].action(e, t); if (null != t && void 0 !== t.subMeshes && null !== t.subMeshes && 0 < t.subMeshes.length) for (var n = this.getActiveSubMeshCandidates(t), o = n.length, s = 0; s < o; s++) { var a = n.data[s]; this._evaluateSubMesh(a, t) } }, r.prototype.updateTransformMatrix = function (e) { this.activeCamera && this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix(e)) }, r.prototype.updateAlternateTransformMatrix = function (e) { this._setAlternateTransformMatrix(e.getViewMatrix(), e.getProjectionMatrix()) }, r.prototype._renderForCamera = function (t, i) { if (!t || !t._skipRendering) { var r = this._engine; if (this.activeCamera = t, !this.activeCamera) throw new Error("Active camera not set"); r.setViewport(this.activeCamera.viewport), this.resetCachedMaterial(), this._renderId++ , this.updateTransformMatrix(), t._alternateCamera && (this.updateAlternateTransformMatrix(t._alternateCamera), this._alternateRendering = !0), this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera), this._evaluateActiveMeshes(); for (var n = 0; n < this._softwareSkinnedMeshes.length; n++) { var o = this._softwareSkinnedMeshes.data[n]; o.applySkeleton(o.skeleton) } this.onBeforeRenderTargetsRenderObservable.notifyObservers(this), t.customRenderTargets && 0 < t.customRenderTargets.length && this._renderTargets.concatWithNoDuplicate(t.customRenderTargets), i && i.customRenderTargets && 0 < i.customRenderTargets.length && this._renderTargets.concatWithNoDuplicate(i.customRenderTargets); for (var s = 0, a = this._gatherActiveCameraRenderTargetsStage; s < a.length; s++)a[s].action(this._renderTargets); if (this.renderTargetsEnabled) { if (this._intermediateRendering = !0, 0 < this._renderTargets.length) { e.Tools.StartPerformanceCounter("Render targets", 0 < this._renderTargets.length); for (var l = 0; l < this._renderTargets.length; l++) { var c = this._renderTargets.data[l]; if (c._shouldRender()) { this._renderId++; var h = c.activeCamera && c.activeCamera !== this.activeCamera; c.render(h, this.dumpNextRenderTargets) } } e.Tools.EndPerformanceCounter("Render targets", 0 < this._renderTargets.length), this._renderId++ } for (var u = 0, d = this._cameraDrawRenderTargetStage; u < d.length; u++)d[u].action(this.activeCamera); this._intermediateRendering = !1, r.restoreDefaultFramebuffer() } this.onAfterRenderTargetsRenderObservable.notifyObservers(this), this.postProcessManager && this.postProcessManager._prepareFrame(); for (var f = 0, p = this._beforeCameraDrawStage; f < p.length; f++)p[f].action(this.activeCamera); this.onBeforeDrawPhaseObservable.notifyObservers(this), this._renderingManager.render(null, null, !0, !0), this.onAfterDrawPhaseObservable.notifyObservers(this); for (var _ = 0, m = this._afterCameraDrawStage; _ < m.length; _++)m[_].action(this.activeCamera); this.postProcessManager && this.postProcessManager._finalizeFrame(t.isIntermediate), this._renderTargets.reset(), this._alternateRendering = !1, this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera) } }, r.prototype._processSubCameras = function (t) { if (t.cameraRigMode !== e.Camera.RIG_MODE_NONE) { for (var i = 0; i < t._rigCameras.length; i++)this._renderForCamera(t._rigCameras[i], t); this.activeCamera = t, this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix()) } else this._renderForCamera(t) }, r.prototype._checkIntersections = function () { for (var t = 0; t < this._meshesForIntersections.length; t++) { var i = this._meshesForIntersections.data[t]; if (i.actionManager) for (var r = 0; r < i.actionManager.actions.length; r++) { var n = i.actionManager.actions[r]; if (n.trigger === e.ActionManager.OnIntersectionEnterTrigger || n.trigger === e.ActionManager.OnIntersectionExitTrigger) { var o = n.getTriggerParameter(), s = o instanceof e.AbstractMesh ? o : o.mesh, a = s.intersectsMesh(i, o.usePreciseIntersection), l = i._intersectionsInProgress.indexOf(s); a && -1 === l ? n.trigger === e.ActionManager.OnIntersectionEnterTrigger ? (n._executeCurrent(e.ActionEvent.CreateNew(i, void 0, s)), i._intersectionsInProgress.push(s)) : n.trigger === e.ActionManager.OnIntersectionExitTrigger && i._intersectionsInProgress.push(s) : !a && -1 < l && (n.trigger === e.ActionManager.OnIntersectionExitTrigger && n._executeCurrent(e.ActionEvent.CreateNew(i, void 0, s)), i.actionManager.hasSpecificTrigger(e.ActionManager.OnIntersectionExitTrigger, function (t) { var i = t instanceof e.AbstractMesh ? t : t.mesh; return s === i }) && n.trigger !== e.ActionManager.OnIntersectionExitTrigger || i._intersectionsInProgress.splice(l, 1)) } } } }, r.prototype._advancePhysicsEngineStep = function (e) { }, r.prototype.render = function (t) { if (void 0 === t && (t = !0), !this.isDisposed) { if (this._frameId++ , this._registerTransientComponents(), this._activeParticles.fetchNewFrame(), this._totalVertices.fetchNewFrame(), this._activeIndices.fetchNewFrame(), this._activeBones.fetchNewFrame(), this._meshesForIntersections.reset(), this.resetCachedMaterial(), this.onBeforeAnimationsObservable.notifyObservers(this), this.actionManager && this.actionManager.processTrigger(e.ActionManager.OnEveryFrameTrigger), this._engine.isDeterministicLockStep()) { var i = Math.max(r.MinDeltaTime, Math.min(this._engine.getDeltaTime(), r.MaxDeltaTime)) + this._timeAccumulator, n = this.getDeterministicFrameTime(), o = 0, s = this._engine.getLockstepMaxSteps(), a = Math.floor(i / 60); for (a = Math.min(a, s); this.onBeforeStepObservable.notifyObservers(this), this._animationRatio = .06 * n, this._animate(), this.onAfterAnimationsObservable.notifyObservers(this), this._advancePhysicsEngineStep(n), this.onAfterStepObservable.notifyObservers(this), this._currentStepId++ , 0 < (i -= n) && ++o < a;); this._timeAccumulator = i < 0 ? 0 : i } else i = this.useConstantAnimationDeltaTime ? 16 : Math.max(r.MinDeltaTime, Math.min(this._engine.getDeltaTime(), r.MaxDeltaTime)), this._animationRatio = .06 * i, this._animate(), this.onAfterAnimationsObservable.notifyObservers(this), this._advancePhysicsEngineStep(i); for (var l = 0, c = this._beforeCameraUpdateStage; l < c.length; l++)c[l].action(); if (t) if (0 < this.activeCameras.length) for (var h = 0; h < this.activeCameras.length; h++) { var u = this.activeCameras[h]; if (u.update(), u.cameraRigMode !== e.Camera.RIG_MODE_NONE) for (var d = 0; d < u._rigCameras.length; d++)u._rigCameras[d].update() } else if (this.activeCamera && (this.activeCamera.update(), this.activeCamera.cameraRigMode !== e.Camera.RIG_MODE_NONE)) for (d = 0; d < this.activeCamera._rigCameras.length; d++)this.activeCamera._rigCameras[d].update(); this.onBeforeRenderObservable.notifyObservers(this), this.onBeforeRenderTargetsRenderObservable.notifyObservers(this); var f = this.getEngine(), p = this.activeCamera; if (this.renderTargetsEnabled) { e.Tools.StartPerformanceCounter("Custom render targets", 0 < this.customRenderTargets.length), this._intermediateRendering = !0; for (var _ = 0; _ < this.customRenderTargets.length; _++) { var m = this.customRenderTargets[_]; if (m._shouldRender()) { if (this._renderId++ , this.activeCamera = m.activeCamera || this.activeCamera, !this.activeCamera) throw new Error("Active camera not set"); f.setViewport(this.activeCamera.viewport), this.updateTransformMatrix(), m.render(p !== this.activeCamera, this.dumpNextRenderTargets) } } e.Tools.EndPerformanceCounter("Custom render targets", 0 < this.customRenderTargets.length), this._intermediateRendering = !1, this._renderId++ } 0 < this.customRenderTargets.length && f.restoreDefaultFramebuffer(), this.onAfterRenderTargetsRenderObservable.notifyObservers(this), this.activeCamera = p; for (var g = 0, v = this._beforeClearStage; g < v.length; g++)v[g].action(); (this.autoClearDepthAndStencil || this.autoClear) && this._engine.clear(this.clearColor, this.autoClear || this.forceWireframe || this.forcePointsCloud, this.autoClearDepthAndStencil, this.autoClearDepthAndStencil); for (var y = 0, b = this._gatherRenderTargetsStage; y < b.length; y++)b[y].action(this._renderTargets); if (0 < this.activeCameras.length) for (h = 0; h < this.activeCameras.length; h++)0 < h && this._engine.clear(null, !1, !0, !0), this._processSubCameras(this.activeCameras[h]); else { if (!this.activeCamera) throw new Error("No camera defined"); this._processSubCameras(this.activeCamera) } this._checkIntersections(); for (var T = 0, E = this._afterRenderStage; T < E.length; T++)E[T].action(); if (this.afterRender && this.afterRender(), this.onAfterRenderObservable.notifyObservers(this), this._toBeDisposed.length) { for (d = 0; d < this._toBeDisposed.length; d++) { var x = this._toBeDisposed[d]; x && x.dispose() } this._toBeDisposed = [] } this.dumpNextRenderTargets && (this.dumpNextRenderTargets = !1), this._activeBones.addCount(0, !0), this._activeIndices.addCount(0, !0), this._activeParticles.addCount(0, !0) } }, r.prototype.freezeMaterials = function () { for (var e = 0; e < this.materials.length; e++)this.materials[e].freeze() }, r.prototype.unfreezeMaterials = function () { for (var e = 0; e < this.materials.length; e++)this.materials[e].unfreeze() }, r.prototype.dispose = function () { this.beforeRender = null, this.afterRender = null, this.skeletons = [], this.morphTargetManagers = [], this._transientComponents = [], this._isReadyForMeshStage.clear(), this._beforeEvaluateActiveMeshStage.clear(), this._evaluateSubMeshStage.clear(), this._activeMeshStage.clear(), this._cameraDrawRenderTargetStage.clear(), this._beforeCameraDrawStage.clear(), this._beforeRenderingGroupDrawStage.clear(), this._beforeRenderingMeshStage.clear(), this._afterRenderingMeshStage.clear(), this._afterRenderingGroupDrawStage.clear(), this._afterCameraDrawStage.clear(), this._afterRenderStage.clear(), this._beforeCameraUpdateStage.clear(), this._beforeClearStage.clear(), this._gatherRenderTargetsStage.clear(), this._gatherActiveCameraRenderTargetsStage.clear(), this._pointerMoveStage.clear(), this._pointerDownStage.clear(), this._pointerUpStage.clear(); for (var e = 0, t = this._components; e < t.length; e++)t[e].dispose(); this.importedMeshesFiles = new Array, this.stopAllAnimations(), this.resetCachedMaterial(), this.activeCamera && (this.activeCamera._activeMeshes.dispose(), this.activeCamera = null), this._activeMeshes.dispose(), this._renderingManager.dispose(), this._processedMaterials.dispose(), this._activeParticleSystems.dispose(), this._activeSkeletons.dispose(), this._softwareSkinnedMeshes.dispose(), this._renderTargets.dispose(), this._registeredForLateAnimationBindings.dispose(), this._meshesForIntersections.dispose(), this._toBeDisposed = []; for (var i = 0, r = this._activeRequests; i < r.length; i++)r[i].abort(); this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear(), this.onBeforeRenderObservable.clear(), this.onAfterRenderObservable.clear(), this.onBeforeRenderTargetsRenderObservable.clear(), this.onAfterRenderTargetsRenderObservable.clear(), this.onAfterStepObservable.clear(), this.onBeforeStepObservable.clear(), this.onBeforeActiveMeshesEvaluationObservable.clear(), this.onAfterActiveMeshesEvaluationObservable.clear(), this.onBeforeParticlesRenderingObservable.clear(), this.onAfterParticlesRenderingObservable.clear(), this.onBeforeDrawPhaseObservable.clear(), this.onAfterDrawPhaseObservable.clear(), this.onBeforeAnimationsObservable.clear(), this.onAfterAnimationsObservable.clear(), this.onDataLoadedObservable.clear(), this.onBeforeRenderingGroupObservable.clear(), this.onAfterRenderingGroupObservable.clear(), this.onMeshImportedObservable.clear(), this.onBeforeCameraRenderObservable.clear(), this.onAfterCameraRenderObservable.clear(), this.onReadyObservable.clear(), this.onNewCameraAddedObservable.clear(), this.onCameraRemovedObservable.clear(), this.onNewLightAddedObservable.clear(), this.onLightRemovedObservable.clear(), this.onNewGeometryAddedObservable.clear(), this.onGeometryRemovedObservable.clear(), this.onNewTransformNodeAddedObservable.clear(), this.onTransformNodeRemovedObservable.clear(), this.onNewMeshAddedObservable.clear(), this.onMeshRemovedObservable.clear(), this.onNewMaterialAddedObservable.clear(), this.onMaterialRemovedObservable.clear(), this.onNewTextureAddedObservable.clear(), this.onTextureRemovedObservable.clear(), this.onPrePointerObservable.clear(), this.onPointerObservable.clear(), this.onPreKeyboardObservable.clear(), this.onKeyboardObservable.clear(), this.detachControl(); var n, o = this._engine.getRenderingCanvas(); if (o) for (n = 0; n < this.cameras.length; n++)this.cameras[n].detachControl(o); for (; this.animationGroups.length;)this.animationGroups[0].dispose(); for (; this.lights.length;)this.lights[0].dispose(); for (; this.meshes.length;)this.meshes[0].dispose(!0); for (; this.transformNodes.length;)this.removeTransformNode(this.transformNodes[0]); for (; this.cameras.length;)this.cameras[0].dispose(); for (this.defaultMaterial && this.defaultMaterial.dispose(); this.multiMaterials.length;)this.multiMaterials[0].dispose(); for (; this.materials.length;)this.materials[0].dispose(); for (; this.particleSystems.length;)this.particleSystems[0].dispose(); for (; this.postProcesses.length;)this.postProcesses[0].dispose(); for (; this.textures.length;)this.textures[0].dispose(); this._sceneUbo.dispose(), this._alternateSceneUbo && this._alternateSceneUbo.dispose(), this.postProcessManager.dispose(), -1 < (n = this._engine.scenes.indexOf(this)) && this._engine.scenes.splice(n, 1), this._engine.wipeCaches(!0), this._isDisposed = !0 }, Object.defineProperty(r.prototype, "isDisposed", { get: function () { return this._isDisposed }, enumerable: !0, configurable: !0 }), r.prototype.clearCachedVertexData = function () { for (var e = 0; e < this.meshes.length; e++) { var t = this.meshes[e].geometry; if (t) for (var i in t._indices = [], t._vertexBuffers) t._vertexBuffers.hasOwnProperty(i) && (t._vertexBuffers[i]._buffer._data = null) } }, r.prototype.cleanCachedTextureBuffer = function () { for (var e = 0, t = this.textures; e < t.length; e++) { var i = t[e]; i._buffer && (i._buffer = null) } }, r.prototype.getWorldExtends = function (t) { var i = new e.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), r = new e.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE); return t = t || function () { return !0 }, this.meshes.filter(t).forEach(function (t) { if (t.computeWorldMatrix(!0), t.subMeshes && 0 !== t.subMeshes.length && !t.infiniteDistance) { var n = t.getBoundingInfo(), o = n.boundingBox.minimumWorld, s = n.boundingBox.maximumWorld; e.Tools.CheckExtends(o, i, r), e.Tools.CheckExtends(s, i, r) } }), { min: i, max: r } }, r.prototype.createPickingRay = function (t, i, r, n, o) { void 0 === o && (o = !1); var s = e.Ray.Zero(); return this.createPickingRayToRef(t, i, r, s, n, o), s }, r.prototype.createPickingRayToRef = function (t, i, r, n, o, s) { void 0 === s && (s = !1); var a = this._engine; if (!o) { if (!this.activeCamera) throw new Error("Active camera not set"); o = this.activeCamera } var l = o.viewport.toGlobal(a.getRenderWidth(), a.getRenderHeight()); return t = t / this._engine.getHardwareScalingLevel() - l.x, i = i / this._engine.getHardwareScalingLevel() - (this._engine.getRenderHeight() - l.y - l.height), n.update(t, i, l.width, l.height, r || e.Matrix.Identity(), s ? e.Matrix.Identity() : o.getViewMatrix(), o.getProjectionMatrix()), this }, r.prototype.createPickingRayInCameraSpace = function (t, i, r) { var n = e.Ray.Zero(); return this.createPickingRayInCameraSpaceToRef(t, i, n, r), n }, r.prototype.createPickingRayInCameraSpaceToRef = function (t, i, r, n) { if (!e.PickingInfo) return this; var o = this._engine; if (!n) { if (!this.activeCamera) throw new Error("Active camera not set"); n = this.activeCamera } var s = n.viewport.toGlobal(o.getRenderWidth(), o.getRenderHeight()), a = e.Matrix.Identity(); return t = t / this._engine.getHardwareScalingLevel() - s.x, i = i / this._engine.getHardwareScalingLevel() - (this._engine.getRenderHeight() - s.y - s.height), r.update(t, i, s.width, s.height, a, a, n.getProjectionMatrix()), this }, r.prototype._internalPick = function (t, i, r) { if (!e.PickingInfo) return null; for (var n = null, o = 0; o < this.meshes.length; o++) { var s = this.meshes[o]; if (i) { if (!i(s)) continue } else if (!s.isEnabled() || !s.isVisible || !s.isPickable) continue; var a = t(s.getWorldMatrix()), l = s.intersects(a, r); if (l && l.hit && (r || null == n || !(l.distance >= n.distance)) && (n = l, r)) break } return n || new e.PickingInfo }, r.prototype._internalMultiPick = function (t, i) { if (!e.PickingInfo) return null; for (var r = new Array, n = 0; n < this.meshes.length; n++) { var o = this.meshes[n]; if (i) { if (!i(o)) continue } else if (!o.isEnabled() || !o.isVisible || !o.isPickable) continue; var s = t(o.getWorldMatrix()), a = o.intersects(s, !1); a && a.hit && r.push(a) } return r }, r.prototype.pick = function (t, i, r, n, o) { var s = this; if (!e.PickingInfo) return null; var a = this._internalPick(function (e) { return s.createPickingRayToRef(t, i, e, s._tempPickingRay, o || null), s._tempPickingRay }, r, n); return a && (a.ray = this.createPickingRay(t, i, e.Matrix.Identity(), o || null)), a }, r.prototype.pickWithRay = function (t, i, r) { var n = this, o = this._internalPick(function (i) { return n._pickWithRayInverseMatrix || (n._pickWithRayInverseMatrix = e.Matrix.Identity()), i.invertToRef(n._pickWithRayInverseMatrix), n._cachedRayForTransform || (n._cachedRayForTransform = e.Ray.Zero()), e.Ray.TransformToRef(t, n._pickWithRayInverseMatrix, n._cachedRayForTransform), n._cachedRayForTransform }, i, r); return o && (o.ray = t), o }, r.prototype.multiPick = function (e, t, i, r) { var n = this; return this._internalMultiPick(function (i) { return n.createPickingRay(e, t, i, r || null) }, i) }, r.prototype.multiPickWithRay = function (t, i) { var r = this; return this._internalMultiPick(function (i) { return r._pickWithRayInverseMatrix || (r._pickWithRayInverseMatrix = e.Matrix.Identity()), i.invertToRef(r._pickWithRayInverseMatrix), r._cachedRayForTransform || (r._cachedRayForTransform = e.Ray.Zero()), e.Ray.TransformToRef(t, r._pickWithRayInverseMatrix, r._cachedRayForTransform), r._cachedRayForTransform }, i) }, r.prototype.setPointerOverMesh = function (t) { this._pointerOverMesh !== t && (this._pointerOverMesh && this._pointerOverMesh.actionManager && this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger, e.ActionEvent.CreateNew(this._pointerOverMesh)), this._pointerOverMesh = t, this._pointerOverMesh && this._pointerOverMesh.actionManager && this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger, e.ActionEvent.CreateNew(this._pointerOverMesh))) }, r.prototype.getPointerOverMesh = function () { return this._pointerOverMesh }, r.prototype._rebuildGeometries = function () { for (var e = 0, t = this.geometries; e < t.length; e++)t[e]._rebuild(); for (var i = 0, r = this.meshes; i < r.length; i++)r[i]._rebuild(); this.postProcessManager && this.postProcessManager._rebuild(); for (var n = 0, o = this._components; n < o.length; n++)o[n].rebuild(); for (var s = 0, a = this.particleSystems; s < a.length; s++)a[s].rebuild() }, r.prototype._rebuildTextures = function () { for (var t = 0, i = this.textures; t < i.length; t++)i[t]._rebuild(); this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag) }, r.prototype._getByTags = function (t, i, r) { if (void 0 === i) return t; var n = []; for (var o in r = r || function (e) { }, t) { var s = t[o]; e.Tags && e.Tags.MatchesQuery(s, i) && (n.push(s), r(s)) } return n }, r.prototype.getMeshesByTags = function (e, t) { return this._getByTags(this.meshes, e, t) }, r.prototype.getCamerasByTags = function (e, t) { return this._getByTags(this.cameras, e, t) }, r.prototype.getLightsByTags = function (e, t) { return this._getByTags(this.lights, e, t) }, r.prototype.getMaterialByTags = function (e, t) { return this._getByTags(this.materials, e, t).concat(this._getByTags(this.multiMaterials, e, t)) }, r.prototype.setRenderingOrder = function (e, t, i, r) { void 0 === t && (t = null), void 0 === i && (i = null), void 0 === r && (r = null), this._renderingManager.setRenderingOrder(e, t, i, r) }, r.prototype.setRenderingAutoClearDepthStencil = function (e, t, i, r) { void 0 === i && (i = !0), void 0 === r && (r = !0), this._renderingManager.setRenderingAutoClearDepthStencil(e, t, i, r) }, r.prototype.getAutoClearDepthStencilSetup = function (e) { return this._renderingManager.getAutoClearDepthStencilSetup(e) }, Object.defineProperty(r.prototype, "blockMaterialDirtyMechanism", { get: function () { return this._blockMaterialDirtyMechanism }, set: function (t) { this._blockMaterialDirtyMechanism !== t && ((this._blockMaterialDirtyMechanism = t) || this.markAllMaterialsAsDirty(e.Material.AllDirtyFlag)) }, enumerable: !0, configurable: !0 }), r.prototype.markAllMaterialsAsDirty = function (e, t) { if (!this._blockMaterialDirtyMechanism) for (var i = 0, r = this.materials; i < r.length; i++) { var n = r[i]; t && !t(n) || n.markAsDirty(e) } }, r.prototype._loadFile = function (t, i, r, n, o, s) { var a = this, l = e.Tools.LoadFile(t, i, r, n ? this.database : void 0, o, s); return this._activeRequests.push(l), l.onCompleteObservable.add(function (e) { a._activeRequests.splice(a._activeRequests.indexOf(e), 1) }), l }, r.prototype._loadFileAsync = function (e, t, i) { var r = this; return new Promise(function (n, o) { r._loadFile(e, function (e) { n(e) }, void 0, t, i, function (e, t) { o(t) }) }) }, r._uniqueIdCounter = 0, r.FOGMODE_NONE = 0, r.FOGMODE_EXP = 1, r.FOGMODE_EXP2 = 2, r.FOGMODE_LINEAR = 3, r.MinDeltaTime = 1, r.MaxDeltaTime = 1e3, r.DragMovementThreshold = 10, r.LongPressDelay = 500, r.DoubleClickDelay = 300, r.ExclusiveDoubleClickMode = !1, r }(e.AbstractScene); e.Scene = i }($a || ($a = {})), function (e) { var t = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t }(e.AbstractScene); e.KeepAssets = t; var i = function (i) { function r(e) { var t = i.call(this) || this; return t.scene = e, t } return T(r, i), r.prototype.addAllToScene = function () { var e = this; this.cameras.forEach(function (t) { e.scene.addCamera(t) }), this.lights.forEach(function (t) { e.scene.addLight(t) }), this.meshes.forEach(function (t) { e.scene.addMesh(t) }), this.skeletons.forEach(function (t) { e.scene.addSkeleton(t) }), this.animations.forEach(function (t) { e.scene.addAnimation(t) }), this.animationGroups.forEach(function (t) { e.scene.addAnimationGroup(t) }), this.multiMaterials.forEach(function (t) { e.scene.addMultiMaterial(t) }), this.materials.forEach(function (t) { e.scene.addMaterial(t) }), this.morphTargetManagers.forEach(function (t) { e.scene.addMorphTargetManager(t) }), this.geometries.forEach(function (t) { e.scene.addGeometry(t) }), this.transformNodes.forEach(function (t) { e.scene.addTransformNode(t) }), this.actionManagers.forEach(function (t) { e.scene.addActionManager(t) }), this.textures.forEach(function (t) { e.scene.addTexture(t) }); for (var t = 0, i = this.scene._serializableComponents; t < i.length; t++)i[t].addFromContainer(this.scene) }, r.prototype.removeAllFromScene = function () { var e = this; this.cameras.forEach(function (t) { e.scene.removeCamera(t) }), this.lights.forEach(function (t) { e.scene.removeLight(t) }), this.meshes.forEach(function (t) { e.scene.removeMesh(t) }), this.skeletons.forEach(function (t) { e.scene.removeSkeleton(t) }), this.animations.forEach(function (t) { e.scene.removeAnimation(t) }), this.animationGroups.forEach(function (t) { e.scene.removeAnimationGroup(t) }), this.multiMaterials.forEach(function (t) { e.scene.removeMultiMaterial(t) }), this.materials.forEach(function (t) { e.scene.removeMaterial(t) }), this.morphTargetManagers.forEach(function (t) { e.scene.removeMorphTargetManager(t) }), this.geometries.forEach(function (t) { e.scene.removeGeometry(t) }), this.transformNodes.forEach(function (t) { e.scene.removeTransformNode(t) }), this.actionManagers.forEach(function (t) { e.scene.removeActionManager(t) }), this.textures.forEach(function (t) { e.scene.removeTexture(t) }); for (var t = 0, i = this.scene._serializableComponents; t < i.length; t++)i[t].removeFromContainer(this.scene) }, r.prototype._moveAssets = function (e, t, i) { if (e) for (var r = 0, n = e; r < n.length; r++) { var o = n[r], s = !0; if (i) for (var a = 0, l = i; a < l.length; a++)if (o === l[a]) { s = !1; break } s && t.push(o) } }, r.prototype.moveAllFromScene = function (e) { for (var i in void 0 === e && (e = new t), this) this.hasOwnProperty(i) && (this[i] = this[i] || [], this._moveAssets(this.scene[i], this[i], e[i])); this.removeAllFromScene() }, r.prototype.createRootMesh = function () { var t = new e.Mesh("assetContainerRootMesh", this.scene); return this.meshes.forEach(function (e) { e.parent || t.addChild(e) }), this.meshes.unshift(t), t }, r }(e.AbstractScene); e.AssetContainer = i }($a || ($a = {})), K = $a || ($a = {}), Q = function () { function e(e, t, i, r, n, o, s) { void 0 === r && (r = 0), void 0 === n && (n = !1), void 0 === o && (o = !1), void 0 === s && (s = !1), e instanceof K.Mesh ? this._engine = e.getScene().getEngine() : this._engine = e, this._updatable = i, this._instanced = o, this._data = t, this.byteStride = s ? r : r * Float32Array.BYTES_PER_ELEMENT, n || this.create() } return e.prototype.createVertexBuffer = function (e, t, i, r, n, o) { void 0 === o && (o = !1); var s = o ? t : t * Float32Array.BYTES_PER_ELEMENT, a = r ? o ? r : r * Float32Array.BYTES_PER_ELEMENT : this.byteStride; return new K.VertexBuffer(this._engine, this, e, this._updatable, !0, a, void 0 === n ? this._instanced : n, s, i, void 0, void 0, !0) }, e.prototype.isUpdatable = function () { return this._updatable }, e.prototype.getData = function () { return this._data }, e.prototype.getBuffer = function () { return this._buffer }, e.prototype.getStrideSize = function () { return this.byteStride / Float32Array.BYTES_PER_ELEMENT }, e.prototype.create = function (e) { void 0 === e && (e = null), !e && this._buffer || (e = e || this._data) && (this._buffer ? this._updatable && (this._engine.updateDynamicVertexBuffer(this._buffer, e), this._data = e) : this._updatable ? (this._buffer = this._engine.createDynamicVertexBuffer(e), this._data = e) : this._buffer = this._engine.createVertexBuffer(e)) }, e.prototype._rebuild = function () { this._buffer = null, this.create(this._data) }, e.prototype.update = function (e) { this.create(e) }, e.prototype.updateDirectly = function (e, t, i, r) { void 0 === r && (r = !1), this._buffer && this._updatable && (this._engine.updateDynamicVertexBuffer(this._buffer, e, r ? t : t * Float32Array.BYTES_PER_ELEMENT, i ? i * this.byteStride : void 0), this._data = null) }, e.prototype.dispose = function () { this._buffer && this._engine._releaseBuffer(this._buffer) && (this._buffer = null) }, e }(), K.Buffer = Q, Z = $a || ($a = {}), q = function () { function e(t, i, r, n, o, s, a, l, c, h, u, d) { if (void 0 === u && (u = !1), void 0 === d && (d = !1), i instanceof Z.Buffer ? (this._buffer = i, this._ownsBuffer = !1) : (this._buffer = new Z.Buffer(t, i, n, s, o, a, d), this._ownsBuffer = !0), this._kind = r, null == h) { var f = this.getData(); this.type = e.FLOAT, f instanceof Int8Array ? this.type = e.BYTE : f instanceof Uint8Array ? this.type = e.UNSIGNED_BYTE : f instanceof Int16Array ? this.type = e.SHORT : f instanceof Uint16Array ? this.type = e.UNSIGNED_SHORT : f instanceof Int32Array ? this.type = e.INT : f instanceof Uint32Array && (this.type = e.UNSIGNED_INT) } else this.type = h; var p = e.GetTypeByteLength(this.type); d ? (this._size = c || (s ? s / p : e.DeduceStride(r)), this.byteStride = s || this._buffer.byteStride || this._size * p, this.byteOffset = l || 0) : (this._size = c || s || e.DeduceStride(r), this.byteStride = s ? s * p : this._buffer.byteStride || this._size * p, this.byteOffset = (l || 0) * p), this.normalized = u, this._instanced = void 0 !== a && a, this._instanceDivisor = a ? 1 : 0 } return Object.defineProperty(e.prototype, "instanceDivisor", { get: function () { return this._instanceDivisor }, set: function (e) { this._instanceDivisor = e, this._instanced = 0 != e }, enumerable: !0, configurable: !0 }), e.prototype._rebuild = function () { this._buffer && this._buffer._rebuild() }, e.prototype.getKind = function () { return this._kind }, e.prototype.isUpdatable = function () { return this._buffer.isUpdatable() }, e.prototype.getData = function () { return this._buffer.getData() }, e.prototype.getBuffer = function () { return this._buffer.getBuffer() }, e.prototype.getStrideSize = function () { return this.byteStride / e.GetTypeByteLength(this.type) }, e.prototype.getOffset = function () { return this.byteOffset / e.GetTypeByteLength(this.type) }, e.prototype.getSize = function () { return this._size }, e.prototype.getIsInstanced = function () { return this._instanced }, e.prototype.getInstanceDivisor = function () { return this._instanceDivisor }, e.prototype.create = function (e) { this._buffer.create(e) }, e.prototype.update = function (e) { this._buffer.update(e) }, e.prototype.updateDirectly = function (e, t, i) { void 0 === i && (i = !1), this._buffer.updateDirectly(e, t, void 0, i) }, e.prototype.dispose = function () { this._ownsBuffer && this._buffer.dispose() }, e.prototype.forEach = function (t, i) { e.ForEach(this._buffer.getData(), this.byteOffset, this.byteStride, this._size, this.type, t, this.normalized, i) }, e.DeduceStride = function (t) { switch (t) { case e.UVKind: case e.UV2Kind: case e.UV3Kind: case e.UV4Kind: case e.UV5Kind: case e.UV6Kind: return 2; case e.NormalKind: case e.PositionKind: return 3; case e.ColorKind: case e.MatricesIndicesKind: case e.MatricesIndicesExtraKind: case e.MatricesWeightsKind: case e.MatricesWeightsExtraKind: case e.TangentKind: return 4; default: throw new Error("Invalid kind '" + t + "'") } }, e.GetTypeByteLength = function (t) { switch (t) { case e.BYTE: case e.UNSIGNED_BYTE: return 1; case e.SHORT: case e.UNSIGNED_SHORT: return 2; case e.INT: case e.FLOAT: return 4; default: throw new Error("Invalid type '" + t + "'") } }, e.ForEach = function (t, i, r, n, o, s, a, l) { if (t instanceof Array) for (var c = i / 4, h = r / 4, u = 0; u < s; u += n) { for (var d = 0; d < n; d++)l(t[c + d], u + d); c += h } else { var f = t instanceof ArrayBuffer ? new DataView(t) : new DataView(t.buffer, t.byteOffset, t.byteLength), p = e.GetTypeByteLength(o); for (u = 0; u < s; u += n) { var _ = i; for (d = 0; d < n; d++)l(e._GetFloatValue(f, o, _, a), u + d), _ += p; i += r } } }, e._GetFloatValue = function (t, i, r, n) { switch (i) { case e.BYTE: var o = t.getInt8(r); return n && (o = Math.max(o / 127, -1)), o; case e.UNSIGNED_BYTE: return o = t.getUint8(r), n && (o /= 255), o; case e.SHORT: return o = t.getInt16(r, !0), n && (o = Math.max(o / 16383, -1)), o; case e.UNSIGNED_SHORT: return o = t.getUint16(r, !0), n && (o /= 65535), o; case e.FLOAT: return t.getFloat32(r, !0); default: throw new Error("Invalid component type " + i) } }, e.BYTE = 5120, e.UNSIGNED_BYTE = 5121, e.SHORT = 5122, e.UNSIGNED_SHORT = 5123, e.INT = 5124, e.UNSIGNED_INT = 5125, e.FLOAT = 5126, e.PositionKind = "position", e.NormalKind = "normal", e.TangentKind = "tangent", e.UVKind = "uv", e.UV2Kind = "uv2", e.UV3Kind = "uv3", e.UV4Kind = "uv4", e.UV5Kind = "uv5", e.UV6Kind = "uv6", e.ColorKind = "color", e.MatricesIndicesKind = "matricesIndices", e.MatricesWeightsKind = "matricesWeights", e.MatricesIndicesExtraKind = "matricesIndicesExtra", e.MatricesWeightsExtraKind = "matricesWeightsExtra", e }(), Z.VertexBuffer = q, J = function () { this.previous = null, this.next = null }, ($a || ($a = {})).DummyInternalTextureTracker = J, $ = $a || ($a = {}), ee = function () { function e(t, i) { this.onLoadedObservable = new $.Observable, this.previous = null, this.next = null, this._initialSlot = -1, this._designatedSlot = -1, this._dataSource = e.DATASOURCE_UNKNOWN, this._comparisonFunction = 0, this._sphericalPolynomial = null, this._lodGenerationScale = 0, this._lodGenerationOffset = 0, this._isRGBD = !1, this._references = 1, this._engine = t, this._dataSource = i, this._webGLTexture = t._createTexture() } return e.prototype.getEngine = function () { return this._engine }, Object.defineProperty(e.prototype, "dataSource", { get: function () { return this._dataSource }, enumerable: !0, configurable: !0 }), e.prototype.incrementReferences = function () { this._references++ }, e.prototype.updateSize = function (e, t, i) { void 0 === i && (i = 1), this.width = e, this.height = t, this.depth = i, this.baseWidth = e, this.baseHeight = t, this.baseDepth = i, this._size = e * t * i }, e.prototype._rebuild = function () { var t, i = this; switch (this.isReady = !1, this._cachedCoordinatesMode = null, this._cachedWrapU = null, this._cachedWrapV = null, this._cachedAnisotropicFilteringLevel = null, this._dataSource) { case e.DATASOURCE_TEMP: return; case e.DATASOURCE_URL: return void (t = this._engine.createTexture(this.url, !this.generateMipMaps, this.invertY, null, this.samplingMode, function () { i.isReady = !0 }, null, this._buffer, void 0, this.format))._swapAndDie(this); case e.DATASOURCE_RAW: return (t = this._engine.createRawTexture(this._bufferView, this.baseWidth, this.baseHeight, this.format, this.generateMipMaps, this.invertY, this.samplingMode, this._compression))._swapAndDie(this), void (this.isReady = !0); case e.DATASOURCE_RAW3D: return (t = this._engine.createRawTexture3D(this._bufferView, this.baseWidth, this.baseHeight, this.baseDepth, this.format, this.generateMipMaps, this.invertY, this.samplingMode, this._compression))._swapAndDie(this), void (this.isReady = !0); case e.DATASOURCE_DYNAMIC: return void (t = this._engine.createDynamicTexture(this.baseWidth, this.baseHeight, this.generateMipMaps, this.samplingMode))._swapAndDie(this); case e.DATASOURCE_RENDERTARGET: var r = new $.RenderTargetCreationOptions; if (r.generateDepthBuffer = this._generateDepthBuffer, r.generateMipMaps = this.generateMipMaps, r.generateStencilBuffer = this._generateStencilBuffer, r.samplingMode = this.samplingMode, r.type = this.type, this.isCube) t = this._engine.createRenderTargetCubeTexture(this.width, r); else { var n = { width: this.width, height: this.height }; t = this._engine.createRenderTargetTexture(n, r) } return t._swapAndDie(this), void (this.isReady = !0); case e.DATASOURCE_DEPTHTEXTURE: var o = { bilinearFiltering: this.samplingMode !== $.Texture.BILINEAR_SAMPLINGMODE, comparisonFunction: this._comparisonFunction, generateStencil: this._generateStencilBuffer, isCube: this.isCube }; return (t = this._engine.createDepthStencilTexture({ width: this.width, height: this.height }, o))._swapAndDie(this), void (this.isReady = !0); case e.DATASOURCE_CUBE: return void (t = this._engine.createCubeTexture(this.url, null, this._files, !this.generateMipMaps, function () { i.isReady = !0 }, null, this.format, this._extension))._swapAndDie(this); case e.DATASOURCE_CUBERAW: return (t = this._engine.createRawCubeTexture(this._bufferViewArray, this.width, this.format, this.type, this.generateMipMaps, this.invertY, this.samplingMode, this._compression))._swapAndDie(this), void (this.isReady = !0); case e.DATASOURCE_CUBERAW_RGBD: return t = this._engine.createRawCubeTexture(null, this.width, this.format, this.type, this.generateMipMaps, this.invertY, this.samplingMode, this._compression), $.RawCubeTexture._UpdateRGBDAsync(t, this._bufferViewArrayArray, this._sphericalPolynomial, this._lodGenerationScale, this._lodGenerationOffset).then(function () { i.isReady = !0 }), void t._swapAndDie(this); case e.DATASOURCE_CUBEPREFILTERED: return void ((t = this._engine.createPrefilteredCubeTexture(this.url, null, this._lodGenerationScale, this._lodGenerationOffset, function (e) { e && e._swapAndDie(i), i.isReady = !0 }, null, this.format, this._extension))._sphericalPolynomial = this._sphericalPolynomial) } }, e.prototype._swapAndDie = function (e) { e._webGLTexture = this._webGLTexture, this._framebuffer && (e._framebuffer = this._framebuffer), this._depthStencilBuffer && (e._depthStencilBuffer = this._depthStencilBuffer), this._lodTextureHigh && (e._lodTextureHigh && e._lodTextureHigh.dispose(), e._lodTextureHigh = this._lodTextureHigh), this._lodTextureMid && (e._lodTextureMid && e._lodTextureMid.dispose(), e._lodTextureMid = this._lodTextureMid), this._lodTextureLow && (e._lodTextureLow && e._lodTextureLow.dispose(), e._lodTextureLow = this._lodTextureLow); var t = this._engine.getLoadedTexturesCache(), i = t.indexOf(this); -1 !== i && t.splice(i, 1) }, e.prototype.dispose = function () { this._webGLTexture && (this._references-- , 0 === this._references && (this._engine._releaseTexture(this), this._webGLTexture = null, this.previous = null, this.next = null)) }, e.DATASOURCE_UNKNOWN = 0, e.DATASOURCE_URL = 1, e.DATASOURCE_TEMP = 2, e.DATASOURCE_RAW = 3, e.DATASOURCE_DYNAMIC = 4, e.DATASOURCE_RENDERTARGET = 5, e.DATASOURCE_MULTIRENDERTARGET = 6, e.DATASOURCE_CUBE = 7, e.DATASOURCE_CUBERAW = 8, e.DATASOURCE_CUBEPREFILTERED = 9, e.DATASOURCE_RAW3D = 10, e.DATASOURCE_DEPTHTEXTURE = 11, e.DATASOURCE_CUBERAW_RGBD = 12, e }(), $.InternalTexture = ee, te = $a || ($a = {}), ie = function () { function e(t) { this._hasAlpha = !1, this.getAlphaFromRGB = !1, this.level = 1, this.coordinatesIndex = 0, this._coordinatesMode = te.Texture.EXPLICIT_MODE, this.wrapU = te.Texture.WRAP_ADDRESSMODE, this.wrapV = te.Texture.WRAP_ADDRESSMODE, this.wrapR = te.Texture.WRAP_ADDRESSMODE, this.anisotropicFilteringLevel = e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL, this.isCube = !1, this.is3D = !1, this.gammaSpace = !0, this.invertZ = !1, this.lodLevelInAlpha = !1, this.isRenderTarget = !1, this.animations = new Array, this.onDisposeObservable = new te.Observable, this.delayLoadState = te.Engine.DELAYLOADSTATE_NONE, this._cachedSize = te.Size.Zero(), this._scene = t || te.Engine.LastCreatedScene, this._scene && (this._scene.textures.push(this), this._scene.onNewTextureAddedObservable.notifyObservers(this)), this._uid = null } return Object.defineProperty(e.prototype, "hasAlpha", { get: function () { return this._hasAlpha }, set: function (e) { this._hasAlpha !== e && (this._hasAlpha = e, this._scene && this._scene.markAllMaterialsAsDirty(te.Material.TextureDirtyFlag | te.Material.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "coordinatesMode", { get: function () { return this._coordinatesMode }, set: function (e) { this._coordinatesMode !== e && (this._coordinatesMode = e, this._scene && this._scene.markAllMaterialsAsDirty(te.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "isRGBD", { get: function () { return null != this._texture && this._texture._isRGBD }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "lodGenerationOffset", { get: function () { return this._texture ? this._texture._lodGenerationOffset : 0 }, set: function (e) { this._texture && (this._texture._lodGenerationOffset = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "lodGenerationScale", { get: function () { return this._texture ? this._texture._lodGenerationScale : 0 }, set: function (e) { this._texture && (this._texture._lodGenerationScale = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "uid", { get: function () { return this._uid || (this._uid = te.Tools.RandomId()), this._uid }, enumerable: !0, configurable: !0 }), e.prototype.toString = function () { return this.name }, e.prototype.getClassName = function () { return "BaseTexture" }, Object.defineProperty(e.prototype, "onDispose", { set: function (e) { this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "isBlocking", { get: function () { return !0 }, enumerable: !0, configurable: !0 }), e.prototype.getScene = function () { return this._scene }, e.prototype.getTextureMatrix = function () { return te.Matrix.IdentityReadOnly }, e.prototype.getReflectionTextureMatrix = function () { return te.Matrix.IdentityReadOnly }, e.prototype.getInternalTexture = function () { return this._texture }, e.prototype.isReadyOrNotBlocking = function () { return !this.isBlocking || this.isReady() }, e.prototype.isReady = function () { return this.delayLoadState === te.Engine.DELAYLOADSTATE_NOTLOADED ? (this.delayLoad(), !1) : !!this._texture && this._texture.isReady }, e.prototype.getSize = function () { if (this._texture) { if (this._texture.width) return this._cachedSize.width = this._texture.width, this._cachedSize.height = this._texture.height, this._cachedSize; if (this._texture._size) return this._cachedSize.width = this._texture._size, this._cachedSize.height = this._texture._size, this._cachedSize } return this._cachedSize }, e.prototype.getBaseSize = function () { return this.isReady() && this._texture ? this._texture._size ? new te.Size(this._texture._size, this._texture._size) : new te.Size(this._texture.baseWidth, this._texture.baseHeight) : te.Size.Zero() }, e.prototype.scale = function (e) { }, Object.defineProperty(e.prototype, "canRescale", { get: function () { return !1 }, enumerable: !0, configurable: !0 }), e.prototype._getFromCache = function (e, t, i) { if (!this._scene) return null; for (var r = this._scene.getEngine().getLoadedTexturesCache(), n = 0; n < r.length; n++) { var o = r[n]; if (o.url === e && o.generateMipMaps === !t && (!i || i === o.samplingMode)) return o.incrementReferences(), o } return null }, e.prototype._rebuild = function () { }, e.prototype.delayLoad = function () { }, e.prototype.clone = function () { return null }, Object.defineProperty(e.prototype, "textureType", { get: function () { return this._texture && void 0 !== this._texture.type ? this._texture.type : te.Engine.TEXTURETYPE_UNSIGNED_INT }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "textureFormat", { get: function () { return this._texture && void 0 !== this._texture.format ? this._texture.format : te.Engine.TEXTUREFORMAT_RGBA }, enumerable: !0, configurable: !0 }), e.prototype.readPixels = function (e, t, i) { if (void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = null), !this._texture) return null; var r = this.getSize(), n = r.width, o = r.height, s = this.getScene(); if (!s) return null; var a = s.getEngine(); return 0 != t && (n /= Math.pow(2, t), o /= Math.pow(2, t), n = Math.round(n), o = Math.round(o)), this._texture.isCube ? a._readTexturePixels(this._texture, n, o, e, t, i) : a._readTexturePixels(this._texture, n, o, -1, t, i) }, e.prototype.releaseInternalTexture = function () { this._texture && (this._texture.dispose(), this._texture = null) }, Object.defineProperty(e.prototype, "sphericalPolynomial", { get: function () { return this._texture && te.CubeMapToSphericalPolynomialTools && this.isReady() ? (this._texture._sphericalPolynomial || (this._texture._sphericalPolynomial = te.CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial(this)), this._texture._sphericalPolynomial) : null }, set: function (e) { this._texture && (this._texture._sphericalPolynomial = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "_lodTextureHigh", { get: function () { return this._texture ? this._texture._lodTextureHigh : null }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "_lodTextureMid", { get: function () { return this._texture ? this._texture._lodTextureMid : null }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "_lodTextureLow", { get: function () { return this._texture ? this._texture._lodTextureLow : null }, enumerable: !0, configurable: !0 }), e.prototype.dispose = function () { if (this._scene) { this._scene.stopAnimation(this), this._scene._removePendingData(this); var e = this._scene.textures.indexOf(this); 0 <= e && this._scene.textures.splice(e, 1), this._scene.onTextureRemovedObservable.notifyObservers(this), void 0 !== this._texture && (this.releaseInternalTexture(), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear()) } }, e.prototype.serialize = function () { if (!this.name) return null; var e = te.SerializationHelper.Serialize(this); return te.Animation.AppendSerializedAnimations(this, e), e }, e.WhenAllReady = function (e, t) { var i = e.length; if (0 !== i) for (var r, n, o = function () { if ((r = e[s]).isReady()) 0 == --i && t(); else { n = r.onLoadObservable; var o = function () { n.removeCallback(o), 0 == --i && t() }; n.add(o) } }, s = 0; s < e.length; s++)o(); else t() }, e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL = 4, b([te.serialize()], e.prototype, "name", void 0), b([te.serialize("hasAlpha")], e.prototype, "_hasAlpha", void 0), b([te.serialize()], e.prototype, "getAlphaFromRGB", void 0), b([te.serialize()], e.prototype, "level", void 0), b([te.serialize()], e.prototype, "coordinatesIndex", void 0), b([te.serialize("coordinatesMode")], e.prototype, "_coordinatesMode", void 0), b([te.serialize()], e.prototype, "wrapU", void 0), b([te.serialize()], e.prototype, "wrapV", void 0), b([te.serialize()], e.prototype, "wrapR", void 0), b([te.serialize()], e.prototype, "anisotropicFilteringLevel", void 0), b([te.serialize()], e.prototype, "isCube", void 0), b([te.serialize()], e.prototype, "is3D", void 0), b([te.serialize()], e.prototype, "gammaSpace", void 0), b([te.serialize()], e.prototype, "invertZ", void 0), b([te.serialize()], e.prototype, "lodLevelInAlpha", void 0), b([te.serialize()], e.prototype, "lodGenerationOffset", null), b([te.serialize()], e.prototype, "lodGenerationScale", null), b([te.serialize()], e.prototype, "isRenderTarget", void 0), e }(), te.BaseTexture = ie, ne = function (e) { function t(i, r, n, o, s, a, l, c, h, u) { void 0 === n && (n = !1), void 0 === o && (o = !0), void 0 === s && (s = t.TRILINEAR_SAMPLINGMODE), void 0 === a && (a = null), void 0 === l && (l = null), void 0 === c && (c = null), void 0 === h && (h = !1); var d = e.call(this, r) || this; if (d.uOffset = 0, d.vOffset = 0, d.uScale = 1, d.vScale = 1, d.uAng = 0, d.vAng = 0, d.wAng = 0, d.uRotationCenter = .5, d.vRotationCenter = .5, d.wRotationCenter = .5, d.onLoadObservable = new re.Observable, d._isBlocking = !0, d.name = i || "", d.url = i, d._noMipmap = n, d._invertY = o, d._samplingMode = s, d._buffer = c, d._deleteBuffer = h, u && (d._format = u), !(r = d.getScene())) return d; r.getEngine().onBeforeTextureInitObservable.notifyObservers(d); var f = function () { d.onLoadObservable.hasObservers() && d.onLoadObservable.notifyObservers(d), a && a(), !d.isBlocking && r && r.resetCachedMaterial() }; return d.url ? (d._texture = d._getFromCache(d.url, n, s), d._texture ? d._texture.isReady ? re.Tools.SetImmediate(function () { return f() }) : d._texture.onLoadedObservable.add(f) : r.useDelayedTextureLoading ? (d.delayLoadState = re.Engine.DELAYLOADSTATE_NOTLOADED, d._delayedOnLoad = f, d._delayedOnError = l) : (d._texture = r.getEngine().createTexture(d.url, n, o, r, d._samplingMode, f, l, d._buffer, void 0, d._format), h && delete d._buffer)) : (d._delayedOnLoad = f, d._delayedOnError = l), d } return T(t, e), Object.defineProperty(t.prototype, "noMipmap", { get: function () { return this._noMipmap }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "isBlocking", { get: function () { return this._isBlocking }, set: function (e) { this._isBlocking = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "samplingMode", { get: function () { return this._samplingMode }, enumerable: !0, configurable: !0 }), t.prototype.updateURL = function (e, t) { if (void 0 === t && (t = null), this.url) throw new Error("URL is already set"); this.url = e, this._buffer = t, this.delayLoadState = re.Engine.DELAYLOADSTATE_NOTLOADED, this.delayLoad() }, t.prototype.delayLoad = function () { if (this.delayLoadState === re.Engine.DELAYLOADSTATE_NOTLOADED) { var e = this.getScene(); e && (this.delayLoadState = re.Engine.DELAYLOADSTATE_LOADED, this._texture = this._getFromCache(this.url, this._noMipmap, this._samplingMode), this._texture ? this._delayedOnLoad && (this._texture.isReady ? re.Tools.SetImmediate(this._delayedOnLoad) : this._texture.onLoadedObservable.add(this._delayedOnLoad)) : (this._texture = e.getEngine().createTexture(this.url, this._noMipmap, this._invertY, e, this._samplingMode, this._delayedOnLoad, this._delayedOnError, this._buffer, null, this._format), this._deleteBuffer && delete this._buffer), this._delayedOnLoad = null, this._delayedOnError = null) } }, t.prototype.updateSamplingMode = function (e) { if (this._texture) { var t = this.getScene(); t && (this._samplingMode = e, t.getEngine().updateTextureSamplingMode(e, this._texture)) } }, t.prototype._prepareRowForTextureGeneration = function (e, t, i, r) { e *= this.uScale, t *= this.vScale, e -= this.uRotationCenter * this.uScale, t -= this.vRotationCenter * this.vScale, i -= this.wRotationCenter, re.Vector3.TransformCoordinatesFromFloatsToRef(e, t, i, this._rowGenerationMatrix, r), r.x += this.uRotationCenter * this.uScale + this.uOffset, r.y += this.vRotationCenter * this.vScale + this.vOffset, r.z += this.wRotationCenter }, t.prototype.getTextureMatrix = function () { var e = this; if (this.uOffset === this._cachedUOffset && this.vOffset === this._cachedVOffset && this.uScale === this._cachedUScale && this.vScale === this._cachedVScale && this.uAng === this._cachedUAng && this.vAng === this._cachedVAng && this.wAng === this._cachedWAng) return this._cachedTextureMatrix; this._cachedUOffset = this.uOffset, this._cachedVOffset = this.vOffset, this._cachedUScale = this.uScale, this._cachedVScale = this.vScale, this._cachedUAng = this.uAng, this._cachedVAng = this.vAng, this._cachedWAng = this.wAng, this._cachedTextureMatrix || (this._cachedTextureMatrix = re.Matrix.Zero(), this._rowGenerationMatrix = new re.Matrix, this._t0 = re.Vector3.Zero(), this._t1 = re.Vector3.Zero(), this._t2 = re.Vector3.Zero()), re.Matrix.RotationYawPitchRollToRef(this.vAng, this.uAng, this.wAng, this._rowGenerationMatrix), this._prepareRowForTextureGeneration(0, 0, 0, this._t0), this._prepareRowForTextureGeneration(1, 0, 0, this._t1), this._prepareRowForTextureGeneration(0, 1, 0, this._t2), this._t1.subtractInPlace(this._t0), this._t2.subtractInPlace(this._t0), re.Matrix.IdentityToRef(this._cachedTextureMatrix), this._cachedTextureMatrix.m[0] = this._t1.x, this._cachedTextureMatrix.m[1] = this._t1.y, this._cachedTextureMatrix.m[2] = this._t1.z, this._cachedTextureMatrix.m[4] = this._t2.x, this._cachedTextureMatrix.m[5] = this._t2.y, this._cachedTextureMatrix.m[6] = this._t2.z, this._cachedTextureMatrix.m[8] = this._t0.x, this._cachedTextureMatrix.m[9] = this._t0.y, this._cachedTextureMatrix.m[10] = this._t0.z; var t = this.getScene(); return t && t.markAllMaterialsAsDirty(re.Material.TextureDirtyFlag, function (t) { return t.hasTexture(e) }), this._cachedTextureMatrix }, t.prototype.getReflectionTextureMatrix = function () { var e = this, i = this.getScene(); if (!i) return this._cachedTextureMatrix; if (this.uOffset === this._cachedUOffset && this.vOffset === this._cachedVOffset && this.uScale === this._cachedUScale && this.vScale === this._cachedVScale && this.coordinatesMode === this._cachedCoordinatesMode) { if (this.coordinatesMode !== t.PROJECTION_MODE) return this._cachedTextureMatrix; if (this._cachedProjectionMatrixId === i.getProjectionMatrix().updateFlag) return this._cachedTextureMatrix } switch (this._cachedTextureMatrix || (this._cachedTextureMatrix = re.Matrix.Zero()), this._projectionModeMatrix || (this._projectionModeMatrix = re.Matrix.Zero()), this._cachedUOffset = this.uOffset, this._cachedVOffset = this.vOffset, this._cachedUScale = this.uScale, this._cachedVScale = this.vScale, this._cachedCoordinatesMode = this.coordinatesMode, this.coordinatesMode) { case t.PLANAR_MODE: re.Matrix.IdentityToRef(this._cachedTextureMatrix), this._cachedTextureMatrix[0] = this.uScale, this._cachedTextureMatrix[5] = this.vScale, this._cachedTextureMatrix[12] = this.uOffset, this._cachedTextureMatrix[13] = this.vOffset; break; case t.PROJECTION_MODE: re.Matrix.IdentityToRef(this._projectionModeMatrix), this._projectionModeMatrix.m[0] = .5, this._projectionModeMatrix.m[5] = -.5, this._projectionModeMatrix.m[10] = 0, this._projectionModeMatrix.m[12] = .5, this._projectionModeMatrix.m[13] = .5, this._projectionModeMatrix.m[14] = 1, this._projectionModeMatrix.m[15] = 1; var r = i.getProjectionMatrix(); this._cachedProjectionMatrixId = r.updateFlag, r.multiplyToRef(this._projectionModeMatrix, this._cachedTextureMatrix); break; default: re.Matrix.IdentityToRef(this._cachedTextureMatrix) }return i.markAllMaterialsAsDirty(re.Material.TextureDirtyFlag, function (t) { return -1 !== t.getActiveTextures().indexOf(e) }), this._cachedTextureMatrix }, t.prototype.clone = function () { var e = this; return re.SerializationHelper.Clone(function () { return new t(e._texture ? e._texture.url : null, e.getScene(), e._noMipmap, e._invertY, e._samplingMode) }, this) }, t.prototype.serialize = function () { var t = e.prototype.serialize.call(this); return "string" == typeof this._buffer && "data:" === this._buffer.substr(0, 5) && (t.base64String = this._buffer, t.name = t.name.replace("data:", "")), t.invertY = this._invertY, t.samplingMode = this.samplingMode, t }, t.prototype.getClassName = function () { return "Texture" }, t.prototype.dispose = function () { e.prototype.dispose.call(this), this.onLoadObservable.clear(), this._delayedOnLoad = null, this._delayedOnError = null }, t.Parse = function (e, i, r) { if (e.customType) { var n = re.Tools.Instantiate(e.customType).Parse(e, i, r); return e.samplingMode && n.updateSamplingMode && n._samplingMode && n._samplingMode !== e.samplingMode && n.updateSamplingMode(e.samplingMode), n } if (e.isCube) return re.CubeTexture.Parse(e, i, r); if (!e.name && !e.isRenderTarget) return null; var o = re.SerializationHelper.Parse(function () { var n, o = !0; if (e.noMipmap && (o = !1), e.mirrorPlane) { var s = new re.MirrorTexture(e.name, e.renderTargetSize, i, o); return s._waitingRenderList = e.renderList, s.mirrorPlane = re.Plane.FromArray(e.mirrorPlane), s } if (e.isRenderTarget) { var a = new re.RenderTargetTexture(e.name, e.renderTargetSize, i, o); return a._waitingRenderList = e.renderList, a } if (e.base64String) n = t.CreateFromBase64String(e.base64String, e.name, i, !o); else { var l = r + e.name; t.UseSerializedUrlIfAny && e.url && (l = e.url), n = new t(l, i, !o, e.invertY) } return n }, e, i); if (e.samplingMode) { var s = e.samplingMode; o._samplingMode !== s && o.updateSamplingMode(s) } if (e.animations) for (var a = 0; a < e.animations.length; a++) { var l = e.animations[a]; o.animations.push(re.Animation.Parse(l)) } return o }, t.CreateFromBase64String = function (e, i, r, n, o, s, a, l, c) { return void 0 === s && (s = t.TRILINEAR_SAMPLINGMODE), void 0 === a && (a = null), void 0 === l && (l = null), void 0 === c && (c = re.Engine.TEXTUREFORMAT_RGBA), new t("data:" + i, r, n, o, s, a, l, e, !1, c) }, t.LoadFromDataString = function (e, i, r, n, o, s, a, l, c, h) { return void 0 === n && (n = !1), void 0 === o && (o = !1), void 0 === s && (s = !0), void 0 === a && (a = t.TRILINEAR_SAMPLINGMODE), void 0 === l && (l = null), void 0 === c && (c = null), void 0 === h && (h = re.Engine.TEXTUREFORMAT_RGBA), "data:" !== e.substr(0, 5) && (e = "data:" + e), new t(e, r, o, s, a, l, c, i, n, h) }, t.NEAREST_SAMPLINGMODE = re.Engine.TEXTURE_NEAREST_SAMPLINGMODE, t.NEAREST_NEAREST_MIPLINEAR = re.Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR, t.BILINEAR_SAMPLINGMODE = re.Engine.TEXTURE_BILINEAR_SAMPLINGMODE, t.LINEAR_LINEAR_MIPNEAREST = re.Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST, t.TRILINEAR_SAMPLINGMODE = re.Engine.TEXTURE_TRILINEAR_SAMPLINGMODE, t.LINEAR_LINEAR_MIPLINEAR = re.Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR, t.NEAREST_NEAREST_MIPNEAREST = re.Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST, t.NEAREST_LINEAR_MIPNEAREST = re.Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST, t.NEAREST_LINEAR_MIPLINEAR = re.Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR, t.NEAREST_LINEAR = re.Engine.TEXTURE_NEAREST_LINEAR, t.NEAREST_NEAREST = re.Engine.TEXTURE_NEAREST_NEAREST, t.LINEAR_NEAREST_MIPNEAREST = re.Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST, t.LINEAR_NEAREST_MIPLINEAR = re.Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR, t.LINEAR_LINEAR = re.Engine.TEXTURE_LINEAR_LINEAR, t.LINEAR_NEAREST = re.Engine.TEXTURE_LINEAR_NEAREST, t.EXPLICIT_MODE = re.Engine.TEXTURE_EXPLICIT_MODE, t.SPHERICAL_MODE = re.Engine.TEXTURE_SPHERICAL_MODE, t.PLANAR_MODE = re.Engine.TEXTURE_PLANAR_MODE, t.CUBIC_MODE = re.Engine.TEXTURE_CUBIC_MODE, t.PROJECTION_MODE = re.Engine.TEXTURE_PROJECTION_MODE, t.SKYBOX_MODE = re.Engine.TEXTURE_SKYBOX_MODE, t.INVCUBIC_MODE = re.Engine.TEXTURE_INVCUBIC_MODE, t.EQUIRECTANGULAR_MODE = re.Engine.TEXTURE_EQUIRECTANGULAR_MODE, t.FIXED_EQUIRECTANGULAR_MODE = re.Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MODE, t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE = re.Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE, t.CLAMP_ADDRESSMODE = re.Engine.TEXTURE_CLAMP_ADDRESSMODE, t.WRAP_ADDRESSMODE = re.Engine.TEXTURE_WRAP_ADDRESSMODE, t.MIRROR_ADDRESSMODE = re.Engine.TEXTURE_MIRROR_ADDRESSMODE, t.UseSerializedUrlIfAny = !1, b([re.serialize()], t.prototype, "url", void 0), b([re.serialize()], t.prototype, "uOffset", void 0), b([re.serialize()], t.prototype, "vOffset", void 0), b([re.serialize()], t.prototype, "uScale", void 0), b([re.serialize()], t.prototype, "vScale", void 0), b([re.serialize()], t.prototype, "uAng", void 0), b([re.serialize()], t.prototype, "vAng", void 0), b([re.serialize()], t.prototype, "wAng", void 0), b([re.serialize()], t.prototype, "uRotationCenter", void 0), b([re.serialize()], t.prototype, "vRotationCenter", void 0), b([re.serialize()], t.prototype, "wRotationCenter", void 0), b([re.serialize()], t.prototype, "isBlocking", null), t }((re = $a || ($a = {})).BaseTexture), re.Texture = ne, function (e) { e._CreationDataStorage = function () { }; var t = function () { this.visibleInstances = {}, this.renderIdForInstances = new Array, this.batchCache = new i, this.instancesBufferSize = 2048 }, i = function () { this.mustReturn = !1, this.visibleInstances = new Array, this.renderSelf = new Array }; e._InstancesBatch = i; var r = function (i) { function r(n, o, s, a, l, c) { void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === c && (c = !0); var h = i.call(this, n, o) || this; if (h.delayLoadState = e.Engine.DELAYLOADSTATE_NONE, h.instances = new Array, h._LODLevels = new Array, h._instanceDataStorage = new t, h._originalBuilderSideOrientation = r.DEFAULTSIDE, h.overrideMaterialSideOrientation = null, h._areNormalsFrozen = !1, h._source = null, o = h.getScene(), a) { if (a._geometry && a._geometry.applyToMesh(h), e.Tools.DeepCopy(a, h, ["name", "material", "skeleton", "instances", "parent", "uniqueId", "source", "metadata", "hasLODLevels", "geometry", "isBlocked", "areNormalsFrozen", "onBeforeDrawObservable", "onBeforeRenderObservable", "onAfterRenderObservable", "onBeforeDraw"], ["_poseMatrix"]), h._source = a, h._originalBuilderSideOrientation = a._originalBuilderSideOrientation, h._creationDataStorage = a._creationDataStorage, h._source._ranges) { var u = h._source._ranges; for (var n in u) u.hasOwnProperty(n) && u[n] && h.createAnimationRange(n, u[n].from, u[n].to) } var d; if (a.metadata && a.metadata.clone ? h.metadata = a.metadata.clone() : h.metadata = a.metadata, e.Tags && e.Tags.HasTags(a) && e.Tags.AddTagsTo(h, e.Tags.GetTags(a, !0)), h.parent = a.parent, h.setPivotMatrix(a.getPivotMatrix()), h.id = n + "." + a.id, h.material = a.material, !l) for (var f = a.getDescendants(!0), p = 0; p < f.length; p++) { var _ = f[p]; _.clone && _.clone(n + "." + _.name, h) } var m = h.getScene().getPhysicsEngine(); if (c && m) { var g = m.getImpostorForPhysicsObject(a); g && (h.physicsImpostor = g.clone(h)) } for (d = 0; d < o.particleSystems.length; d++) { var v = o.particleSystems[d]; v.emitter === a && v.clone(v.name, h) } h.refreshBoundingInfo(), h.computeWorldMatrix(!0) } return null !== s && (h.parent = s), h } return T(r, i), Object.defineProperty(r.prototype, "onBeforeRenderObservable", { get: function () { return this._onBeforeRenderObservable || (this._onBeforeRenderObservable = new e.Observable), this._onBeforeRenderObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "onAfterRenderObservable", { get: function () { return this._onAfterRenderObservable || (this._onAfterRenderObservable = new e.Observable), this._onAfterRenderObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "onBeforeDrawObservable", { get: function () { return this._onBeforeDrawObservable || (this._onBeforeDrawObservable = new e.Observable), this._onBeforeDrawObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "onBeforeDraw", { set: function (e) { this._onBeforeDrawObserver && this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver), this._onBeforeDrawObserver = this.onBeforeDrawObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "morphTargetManager", { get: function () { return this._morphTargetManager }, set: function (e) { this._morphTargetManager !== e && (this._morphTargetManager = e, this._syncGeometryWithMorphTargetManager()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "source", { get: function () { return this._source }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "isUnIndexed", { get: function () { return this._unIndexed }, set: function (e) { this._unIndexed !== e && (this._unIndexed = e, this._markSubMeshesAsAttributesDirty()) }, enumerable: !0, configurable: !0 }), r.prototype.getClassName = function () { return "Mesh" }, r.prototype.toString = function (t) { var r = i.prototype.toString.call(this, t); if (r += ", n vertices: " + this.getTotalVertices(), r += ", parent: " + (this._waitingParentId ? this._waitingParentId : this.parent ? this.parent.name : "NONE"), this.animations) for (var n = 0; n < this.animations.length; n++)r += ", animation[0]: " + this.animations[n].toString(t); if (t) if (this._geometry) { var o = this.getIndices(), s = this.getVerticesData(e.VertexBuffer.PositionKind); s && o && (r += ", flat shading: " + (s.length / 3 === o.length ? "YES" : "NO")) } else r += ", flat shading: UNKNOWN"; return r }, r.prototype._unBindEffect = function () { i.prototype._unBindEffect.call(this); for (var e = 0, t = this.instances; e < t.length; e++)t[e]._unBindEffect() }, Object.defineProperty(r.prototype, "hasLODLevels", { get: function () { return 0 < this._LODLevels.length }, enumerable: !0, configurable: !0 }), r.prototype.getLODLevels = function () { return this._LODLevels }, r.prototype._sortLODLevels = function () { this._LODLevels.sort(function (e, t) { return e.distance < t.distance ? 1 : e.distance > t.distance ? -1 : 0 }) }, r.prototype.addLODLevel = function (t, i) { if (i && i._masterMesh) return e.Tools.Warn("You cannot use a mesh as LOD level twice"), this; var r = new e.MeshLODLevel(t, i); return this._LODLevels.push(r), i && (i._masterMesh = this), this._sortLODLevels(), this }, r.prototype.getLODLevelAtDistance = function (e) { for (var t = 0; t < this._LODLevels.length; t++) { var i = this._LODLevels[t]; if (i.distance === e) return i.mesh } return null }, r.prototype.removeLODLevel = function (e) { for (var t = 0; t < this._LODLevels.length; t++)this._LODLevels[t].mesh === e && (this._LODLevels.splice(t, 1), e && (e._masterMesh = null)); return this._sortLODLevels(), this }, r.prototype.getLOD = function (e, t) { if (!this._LODLevels || 0 === this._LODLevels.length) return this; var i = (t || this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.globalPosition).length(); if (this._LODLevels[this._LODLevels.length - 1].distance > i) return this.onLODLevelSelection && this.onLODLevelSelection(i, this, this._LODLevels[this._LODLevels.length - 1].mesh), this; for (var r = 0; r < this._LODLevels.length; r++) { var n = this._LODLevels[r]; if (n.distance < i) return n.mesh && (n.mesh._preActivate(), n.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)), this.onLODLevelSelection && this.onLODLevelSelection(i, this, n.mesh), n.mesh } return this.onLODLevelSelection && this.onLODLevelSelection(i, this, this), this }, Object.defineProperty(r.prototype, "geometry", { get: function () { return this._geometry }, enumerable: !0, configurable: !0 }), r.prototype.getTotalVertices = function () { return null === this._geometry || void 0 === this._geometry ? 0 : this._geometry.getTotalVertices() }, r.prototype.getVerticesData = function (e, t, i) { return this._geometry ? this._geometry.getVerticesData(e, t, i) : null }, r.prototype.getVertexBuffer = function (e) { return this._geometry ? this._geometry.getVertexBuffer(e) : null }, r.prototype.isVerticesDataPresent = function (e) { return this._geometry ? this._geometry.isVerticesDataPresent(e) : !!this._delayInfo && -1 !== this._delayInfo.indexOf(e) }, r.prototype.isVertexBufferUpdatable = function (e) { return this._geometry ? this._geometry.isVertexBufferUpdatable(e) : !!this._delayInfo && -1 !== this._delayInfo.indexOf(e) }, r.prototype.getVerticesDataKinds = function () { if (!this._geometry) { var e = new Array; return this._delayInfo && this._delayInfo.forEach(function (t, i, r) { e.push(t) }), e } return this._geometry.getVerticesDataKinds() }, r.prototype.getTotalIndices = function () { return this._geometry ? this._geometry.getTotalIndices() : 0 }, r.prototype.getIndices = function (e, t) { return this._geometry ? this._geometry.getIndices(e, t) : [] }, Object.defineProperty(r.prototype, "isBlocked", { get: function () { return null !== this._masterMesh && void 0 !== this._masterMesh }, enumerable: !0, configurable: !0 }), r.prototype.isReady = function (t, r) { if (void 0 === t && (t = !1), void 0 === r && (r = !1), this.delayLoadState === e.Engine.DELAYLOADSTATE_LOADING) return !1; if (!i.prototype.isReady.call(this, t)) return !1; if (!this.subMeshes || 0 === this.subMeshes.length) return !0; if (!t) return !0; var n = this.getEngine(), o = this.getScene(), s = r || n.getCaps().instancedArrays && 0 < this.instances.length; this.computeWorldMatrix(); var a = this.material || o.defaultMaterial; if (a) if (a.storeEffectOnSubMeshes) for (var l = 0, c = this.subMeshes; l < c.length; l++) { var h = (m = c[l]).getMaterial(); if (h) if (h.storeEffectOnSubMeshes) { if (!h.isReadyForSubMesh(this, m, s)) return !1 } else if (!h.isReady(this, s)) return !1 } else if (!a.isReady(this, s)) return !1; for (var u = 0, d = this._lightSources; u < d.length; u++) { var f = d[u].getShadowGenerator(); if (f) for (var p = 0, _ = this.subMeshes; p < _.length; p++) { var m = _[p]; if (!f.isReady(m, s)) return !1 } } for (var g = 0, v = this._LODLevels; g < v.length; g++) { var y = v[g]; if (y.mesh && !y.mesh.isReady(s)) return !1 } return !0 }, Object.defineProperty(r.prototype, "areNormalsFrozen", { get: function () { return this._areNormalsFrozen }, enumerable: !0, configurable: !0 }), r.prototype.freezeNormals = function () { return this._areNormalsFrozen = !0, this }, r.prototype.unfreezeNormals = function () { return this._areNormalsFrozen = !1, this }, Object.defineProperty(r.prototype, "overridenInstanceCount", { set: function (e) { this._instanceDataStorage.overridenInstanceCount = e }, enumerable: !0, configurable: !0 }), r.prototype._preActivate = function () { var e = this.getScene().getRenderId(); return this._preActivateId === e || (this._preActivateId = e, this._instanceDataStorage.visibleInstances = null), this }, r.prototype._preActivateForIntermediateRendering = function (e) { return this._instanceDataStorage.visibleInstances && (this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId = e), this }, r.prototype._registerInstanceForRenderId = function (e, t) { return this._instanceDataStorage.visibleInstances || (this._instanceDataStorage.visibleInstances = {}, this._instanceDataStorage.visibleInstances.defaultRenderId = t, this._instanceDataStorage.visibleInstances.selfDefaultRenderId = this._renderId), this._instanceDataStorage.visibleInstances[t] || (this._instanceDataStorage.visibleInstances[t] = new Array), this._instanceDataStorage.visibleInstances[t].push(e), this }, r.prototype.refreshBoundingInfo = function () { return this._refreshBoundingInfo(!1) }, r.prototype._refreshBoundingInfo = function (t) { if (this._boundingInfo && this._boundingInfo.isLocked) return this; var i = this._getPositionData(t); if (i) { var r = this.geometry ? this.geometry.boundingBias : null, n = e.Tools.ExtractMinAndMax(i, 0, this.getTotalVertices(), r); this._boundingInfo = new e.BoundingInfo(n.minimum, n.maximum) } if (this.subMeshes) for (var o = 0; o < this.subMeshes.length; o++)this.subMeshes[o].refreshBoundingInfo(); return this._updateBoundingInfo(), this }, r.prototype._getPositionData = function (t) { var i = this.getVerticesData(e.VertexBuffer.PositionKind); if (i && t && this.skeleton) { i = e.Tools.Slice(i); var r = this.getVerticesData(e.VertexBuffer.MatricesIndicesKind), n = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind); if (n && r) for (var o = 4 < this.numBoneInfluencers, s = o ? this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind) : null, a = o ? this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind) : null, l = this.skeleton.getTransformMatrices(this), c = e.Tmp.Vector3[0], h = e.Tmp.Matrix[0], u = e.Tmp.Matrix[1], d = 0, f = 0; f < i.length; f += 3, d += 4) { var p, _; for (h.reset(), p = 0; p < 4; p++)0 < (_ = n[d + p]) && (e.Matrix.FromFloat32ArrayToRefScaled(l, Math.floor(16 * r[d + p]), _, u), h.addToSelf(u)); if (o) for (p = 0; p < 4; p++)0 < (_ = a[d + p]) && (e.Matrix.FromFloat32ArrayToRefScaled(l, Math.floor(16 * s[d + p]), _, u), h.addToSelf(u)); e.Vector3.TransformCoordinatesFromFloatsToRef(i[f], i[f + 1], i[f + 2], h, c), c.toArray(i, f) } } return i }, r.prototype._createGlobalSubMesh = function (t) { var i = this.getTotalVertices(); if (!i || !this.getIndices()) return null; if (this.subMeshes && 0 < this.subMeshes.length) { var r = this.getIndices(); if (!r) return null; var n = r.length, o = !1; if (t) o = !0; else for (var s = 0, a = this.subMeshes; s < a.length; s++) { var l = a[s]; if (l.indexStart + l.indexCount >= n) { o = !0; break } if (l.verticesStart + l.verticesCount >= i) { o = !0; break } } if (!o) return this.subMeshes[0] } return this.releaseSubMeshes(), new e.SubMesh(0, 0, i, 0, this.getTotalIndices(), this) }, r.prototype.subdivide = function (t) { if (!(t < 1)) { for (var i = this.getTotalIndices(), r = i / t | 0, n = 0; r % 3 != 0;)r++; this.releaseSubMeshes(); for (var o = 0; o < t && !(i <= n); o++)e.SubMesh.CreateFromIndices(0, n, Math.min(r, i - n), this), n += r; this.synchronizeInstances() } }, r.prototype.setVerticesData = function (t, i, r, n) { if (void 0 === r && (r = !1), this._geometry) this._geometry.setVerticesData(t, i, r, n); else { var o = new e.VertexData; o.set(i, t); var s = this.getScene(); new e.Geometry(e.Geometry.RandomId(), s, o, r, this) } return this }, r.prototype.markVerticesDataAsUpdatable = function (e, t) { void 0 === t && (t = !0); var i = this.getVertexBuffer(e); i && i.isUpdatable() !== t && this.setVerticesData(e, this.getVerticesData(e), t) }, r.prototype.setVerticesBuffer = function (t) { return this._geometry || (this._geometry = e.Geometry.CreateGeometryForMesh(this)), this._geometry.setVerticesBuffer(t), this }, r.prototype.updateVerticesData = function (e, t, i, r) { return this._geometry && (r ? (this.makeGeometryUnique(), this.updateVerticesData(e, t, i, !1)) : this._geometry.updateVerticesData(e, t, i)), this }, r.prototype.updateMeshPositions = function (t, i) { void 0 === i && (i = !0); var r = this.getVerticesData(e.VertexBuffer.PositionKind); if (!r) return this; if (t(r), this.updateVerticesData(e.VertexBuffer.PositionKind, r, !1, !1), i) { var n = this.getIndices(), o = this.getVerticesData(e.VertexBuffer.NormalKind); if (!o) return this; e.VertexData.ComputeNormals(r, n, o), this.updateVerticesData(e.VertexBuffer.NormalKind, o, !1, !1) } return this }, r.prototype.makeGeometryUnique = function () { if (!this._geometry) return this; var t = this._geometry, i = this._geometry.copy(e.Geometry.RandomId()); return t.releaseForMesh(this, !0), i.applyToMesh(this), this }, r.prototype.setIndices = function (t, i, r) { if (void 0 === i && (i = null), void 0 === r && (r = !1), this._geometry) this._geometry.setIndices(t, i, r); else { var n = new e.VertexData; n.indices = t; var o = this.getScene(); new e.Geometry(e.Geometry.RandomId(), o, n, r, this) } return this }, r.prototype.updateIndices = function (e, t) { return this._geometry && this._geometry.updateIndices(e, t), this }, r.prototype.toLeftHanded = function () { return this._geometry && this._geometry.toLeftHanded(), this }, r.prototype._bind = function (t, i, r) { if (!this._geometry) return this; var n, o = this.getScene().getEngine(); if (this._unIndexed) n = null; else switch (r) { case e.Material.PointFillMode: n = null; break; case e.Material.WireFrameFillMode: n = t._getLinesIndexBuffer(this.getIndices(), o); break; default: case e.Material.TriangleFillMode: n = this._unIndexed ? null : this._geometry.getIndexBuffer() }return this._geometry._bind(i, n), this }, r.prototype._draw = function (t, i, r, n) { if (void 0 === n && (n = !1), !this._geometry || !this._geometry.getVertexBuffers() || !this._unIndexed && !this._geometry.getIndexBuffer()) return this; this._onBeforeDrawObservable && this._onBeforeDrawObservable.notifyObservers(this); var o = this.getScene(), s = o.getEngine(); if (this._unIndexed || i == e.Material.PointFillMode ? s.drawArraysType(i, t.verticesStart, t.verticesCount, r) : i == e.Material.WireFrameFillMode ? s.drawElementsType(i, 0, t._linesIndexCount, r) : s.drawElementsType(i, t.indexStart, t.indexCount, r), o._isAlternateRenderingEnabled && !n) { var a = t.effect || this._effectiveMaterial.getEffect(); if (!a || !o.activeCamera) return this; o._switchToAlternateCameraConfiguration(!0), this._effectiveMaterial.bindView(a), this._effectiveMaterial.bindViewProjection(a), s.setViewport(o.activeCamera._alternateCamera.viewport), this._draw(t, i, r, !0), s.setViewport(o.activeCamera.viewport), o._switchToAlternateCameraConfiguration(!1), this._effectiveMaterial.bindView(a), this._effectiveMaterial.bindViewProjection(a) } return this }, r.prototype.registerBeforeRender = function (e) { return this.onBeforeRenderObservable.add(e), this }, r.prototype.unregisterBeforeRender = function (e) { return this.onBeforeRenderObservable.removeCallback(e), this }, r.prototype.registerAfterRender = function (e) { return this.onAfterRenderObservable.add(e), this }, r.prototype.unregisterAfterRender = function (e) { return this.onAfterRenderObservable.removeCallback(e), this }, r.prototype._getInstancesRenderList = function (e) { var t = this.getScene(), i = this._instanceDataStorage.batchCache; if (i.mustReturn = !1, i.renderSelf[e] = this.isEnabled() && this.isVisible, i.visibleInstances[e] = null, this._instanceDataStorage.visibleInstances) { var r = this._instanceDataStorage.visibleInstances, n = t.getRenderId(), o = t._isInIntermediateRendering() ? r.intermediateDefaultRenderId : r.defaultRenderId; i.visibleInstances[e] = r[n]; var s = this._renderId; !i.visibleInstances[e] && o && (i.visibleInstances[e] = r[o], n = Math.max(o, n), s = Math.max(r.selfDefaultRenderId, n)); var a = i.visibleInstances[e]; if (a && a.length) { if (this._instanceDataStorage.renderIdForInstances[e] === n) return i.mustReturn = !0, i; n !== s && (i.renderSelf[e] = !1) } this._instanceDataStorage.renderIdForInstances[e] = n } return i }, r.prototype._renderWithInstances = function (t, i, r, n, o) { var s = r.visibleInstances[t._id]; if (!s) return this; for (var a = 16 * (s.length + 1) * 4, l = this._instanceDataStorage, c = l.instancesBufferSize, h = l.instancesBuffer; l.instancesBufferSize < a;)l.instancesBufferSize *= 2; l.instancesData && c == l.instancesBufferSize || (l.instancesData = new Float32Array(l.instancesBufferSize / 4)); var u = 0, d = 0, f = this.getWorldMatrix(); if (r.renderSelf[t._id] && (f.copyToArray(l.instancesData, u), u += 16, d++), s) for (var p = 0; p < s.length; p++)s[p].getWorldMatrix().copyToArray(l.instancesData, u), u += 16, d++; return h && c == l.instancesBufferSize ? h.updateDirectly(l.instancesData, 0, d) : (h && h.dispose(), h = new e.Buffer(o, l.instancesData, !0, 16, !1, !0), l.instancesBuffer = h, this.setVerticesBuffer(h.createVertexBuffer("world0", 0, 4)), this.setVerticesBuffer(h.createVertexBuffer("world1", 4, 4)), this.setVerticesBuffer(h.createVertexBuffer("world2", 8, 4)), this.setVerticesBuffer(h.createVertexBuffer("world3", 12, 4))), this._bind(t, n, i), this._draw(t, i, d), o.unbindInstanceAttributes(), this }, r.prototype._processRendering = function (e, t, i, r, n, o, s) { var a = this.getScene().getEngine(); if (n) this._renderWithInstances(e, i, r, t, a); else { r.renderSelf[e._id] && (o && o(!1, this.getWorldMatrix(), s), this._draw(e, i, this._instanceDataStorage.overridenInstanceCount)); var l = r.visibleInstances[e._id]; if (l) for (var c = 0; c < l.length; c++) { var h = l[c].getWorldMatrix(); o && o(!0, h, s), this._draw(e, i) } } return this }, r.prototype.render = function (t, i) { if (this._checkOcclusionQuery()) return this; var r = this.getScene(), n = this._getInstancesRenderList(t._id); if (n.mustReturn) return this; if (!this._geometry || !this._geometry.getVertexBuffers() || !this._unIndexed && !this._geometry.getIndexBuffer()) return this; this._onBeforeRenderObservable && this._onBeforeRenderObservable.notifyObservers(this); var o, s = r.getEngine(), a = s.getCaps().instancedArrays && null !== n.visibleInstances[t._id] && void 0 !== n.visibleInstances[t._id], l = t.getMaterial(); if (!l) return this; if (this._effectiveMaterial = l, this._effectiveMaterial.storeEffectOnSubMeshes) { if (!this._effectiveMaterial.isReadyForSubMesh(this, t, a)) return this } else if (!this._effectiveMaterial.isReady(this, a)) return this; i && s.setAlphaMode(this._effectiveMaterial.alphaMode); for (var c = 0, h = r._beforeRenderingMeshStage; c < h.length; c++)h[c].action(this, t, n); if (!(o = this._effectiveMaterial.storeEffectOnSubMeshes ? t.effect : this._effectiveMaterial.getEffect())) return this; var u = this.overrideMaterialSideOrientation; null == u && (u = this._effectiveMaterial.sideOrientation, this._getWorldMatrixDeterminant() < 0 && (u = u === e.Material.ClockWiseSideOrientation ? e.Material.CounterClockWiseSideOrientation : e.Material.ClockWiseSideOrientation)); var d = this._effectiveMaterial._preBind(o, u); this._effectiveMaterial.forceDepthWrite && s.setDepthWrite(!0); var f = r.forcePointsCloud ? e.Material.PointFillMode : r.forceWireframe ? e.Material.WireFrameFillMode : this._effectiveMaterial.fillMode; a || this._bind(t, o, f); var p = this.getWorldMatrix(); this._effectiveMaterial.storeEffectOnSubMeshes ? this._effectiveMaterial.bindForSubMesh(p, this, t) : this._effectiveMaterial.bind(p, this), !this._effectiveMaterial.backFaceCulling && this._effectiveMaterial.separateCullingPass && (s.setState(!0, this._effectiveMaterial.zOffset, !1, !d), this._processRendering(t, o, f, n, a, this._onBeforeDraw, this._effectiveMaterial), s.setState(!0, this._effectiveMaterial.zOffset, !1, d)), this._processRendering(t, o, f, n, a, this._onBeforeDraw, this._effectiveMaterial), this._effectiveMaterial.unbind(); for (var _ = 0, m = r._afterRenderingMeshStage; _ < m.length; _++)m[_].action(this, t, n); return this._onAfterRenderObservable && this._onAfterRenderObservable.notifyObservers(this), this }, r.prototype._onBeforeDraw = function (e, t, i) { e && i && i.bindOnlyWorldMatrix(t) }, r.prototype.cleanMatrixWeights = function () { this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind) && (this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsExtraKind) ? this.normalizeSkinWeightsAndExtra() : this.normalizeSkinFourWeights()) }, r.prototype.normalizeSkinFourWeights = function () { for (var t = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind), i = t.length, r = 0; r < i; r += 4) { var n = t[r] + t[r + 1] + t[r + 2] + t[r + 3]; if (0 === n) t[r] = 1; else { var o = 1 / n; t[r] *= o, t[r + 1] *= o, t[r + 2] *= o, t[r + 3] *= o } } this.setVerticesData(e.VertexBuffer.MatricesWeightsKind, t) }, r.prototype.normalizeSkinWeightsAndExtra = function () { for (var t = this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind), i = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind), r = i.length, n = 0; n < r; n += 4) { var o = i[n] + i[n + 1] + i[n + 2] + i[n + 3]; if (0 === (o += t[n] + t[n + 1] + t[n + 2] + t[n + 3])) i[n] = 1; else { var s = 1 / o; i[n] *= s, i[n + 1] *= s, i[n + 2] *= s, i[n + 3] *= s, t[n] *= s, t[n + 1] *= s, t[n + 2] *= s, t[n + 3] *= s } } this.setVerticesData(e.VertexBuffer.MatricesWeightsKind, i), this.setVerticesData(e.VertexBuffer.MatricesWeightsKind, t) }, r.prototype.validateSkinning = function () { var t = this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind), i = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind); if (null === i || null == this.skeleton) return { skinned: !1, valid: !0, report: "not skinned" }; for (var r = i.length, n = 0, o = 0, s = 0, a = 0, l = null === t ? 4 : 8, c = new Array, h = 0; h <= l; h++)c[h] = 0; for (h = 0; h < r; h += 4) { for (var u = i[h], d = u, f = 0 === d ? 0 : 1, p = 1; p < l; p++) { var _ = p < 4 ? i[h + p] : t[h + p - 4]; u < _ && n++ , 0 !== _ && f++ , d += _, u = _ } if (c[f]++ , s < f && (s = f), 0 === d) o++; else { var m = 1 / d, g = 0; for (p = 0; p < l; p++)g += p < 4 ? Math.abs(i[h + p] - i[h + p] * m) : Math.abs(t[h + p - 4] - t[h + p - 4] * m); .001 < g && a++ } } var v = this.skeleton.bones.length, y = this.getVerticesData(e.VertexBuffer.MatricesIndicesKind), b = this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind), T = 0; for (h = 0; h < r; h++)for (p = 0; p < l; p++) { var E = p < 4 ? y[p] : b[p - 4]; (v <= E || E < 0) && T++ } return { skinned: !0, valid: 0 === o && 0 === a && 0 === T, report: "Number of Weights = " + r / 4 + "\nMaximum influences = " + s + "\nMissing Weights = " + o + "\nNot Sorted = " + n + "\nNot Normalized = " + a + "\nWeightCounts = [" + c + "]\nNumber of bones = " + v + "\nBad Bone Indices = " + T } }, r.prototype._checkDelayState = function () { var t = this.getScene(); return this._geometry ? this._geometry.load(t) : this.delayLoadState === e.Engine.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = e.Engine.DELAYLOADSTATE_LOADING, this._queueLoad(t)), this }, r.prototype._queueLoad = function (t) { var i = this; t._addPendingData(this); var r = -1 !== this.delayLoadingFile.indexOf(".babylonbinarymeshdata"); return e.Tools.LoadFile(this.delayLoadingFile, function (r) { r instanceof ArrayBuffer ? i._delayLoadingFunction(r, i) : i._delayLoadingFunction(JSON.parse(r), i), i.instances.forEach(function (e) { e._syncSubMeshes() }), i.delayLoadState = e.Engine.DELAYLOADSTATE_LOADED, t._removePendingData(i) }, function () { }, t.database, r), this }, r.prototype.isInFrustum = function (t) { return this.delayLoadState !== e.Engine.DELAYLOADSTATE_LOADING && !!i.prototype.isInFrustum.call(this, t) && (this._checkDelayState(), !0) }, r.prototype.setMaterialByID = function (e) { var t, i = this.getScene().materials; for (t = i.length - 1; -1 < t; t--)if (i[t].id === e) return this.material = i[t], this; var r = this.getScene().multiMaterials; for (t = r.length - 1; -1 < t; t--)if (r[t].id === e) return this.material = r[t], this; return this }, r.prototype.getAnimatables = function () { var e = new Array; return this.material && e.push(this.material), this.skeleton && e.push(this.skeleton), e }, r.prototype.bakeTransformIntoVertices = function (t) { if (!this.isVerticesDataPresent(e.VertexBuffer.PositionKind)) return this; var i = this.subMeshes.splice(0); this._resetPointsArrayCache(); var r, n = this.getVerticesData(e.VertexBuffer.PositionKind), o = new Array; for (r = 0; r < n.length; r += 3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(n, r), t).toArray(o, r); if (this.setVerticesData(e.VertexBuffer.PositionKind, o, this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()), this.isVerticesDataPresent(e.VertexBuffer.NormalKind)) { for (n = this.getVerticesData(e.VertexBuffer.NormalKind), o = [], r = 0; r < n.length; r += 3)e.Vector3.TransformNormal(e.Vector3.FromArray(n, r), t).normalize().toArray(o, r); this.setVerticesData(e.VertexBuffer.NormalKind, o, this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable()) } return t.m[0] * t.m[5] * t.m[10] < 0 && this.flipFaces(), this.releaseSubMeshes(), this.subMeshes = i, this }, r.prototype.bakeCurrentTransformIntoVertices = function () { return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)), this.scaling.copyFromFloats(1, 1, 1), this.position.copyFromFloats(0, 0, 0), this.rotation.copyFromFloats(0, 0, 0), this.rotationQuaternion && (this.rotationQuaternion = e.Quaternion.Identity()), this._worldMatrix = e.Matrix.Identity(), this }, Object.defineProperty(r.prototype, "_positions", { get: function () { return this._geometry ? this._geometry._positions : null }, enumerable: !0, configurable: !0 }), r.prototype._resetPointsArrayCache = function () { return this._geometry && this._geometry._resetPointsArrayCache(), this }, r.prototype._generatePointsArray = function () { return !!this._geometry && this._geometry._generatePointsArray() }, r.prototype.clone = function (e, t, i, n) { return void 0 === e && (e = ""), void 0 === n && (n = !0), new r(e, this.getScene(), t, this, i, n) }, r.prototype.dispose = function (e, t) { var r = this; for (void 0 === t && (t = !1), this.morphTargetManager = null, this._geometry && this._geometry.releaseForMesh(this, !0), this._onBeforeDrawObservable && this._onBeforeDrawObservable.clear(), this._onBeforeRenderObservable && this._onBeforeRenderObservable.clear(), this._onAfterRenderObservable && this._onAfterRenderObservable.clear(), this.getScene().meshes.forEach(function (e) { var t = e; t._source && t._source === r && (t._source = null) }), this._source = null, this._instanceDataStorage.instancesBuffer && (this._instanceDataStorage.instancesBuffer.dispose(), this._instanceDataStorage.instancesBuffer = null); this.instances.length;)this.instances[0].dispose(); i.prototype.dispose.call(this, e, t) }, r.prototype.applyDisplacementMap = function (t, i, r, n, o, s, a) { var l = this; void 0 === a && (a = !1); var c = this.getScene(); return e.Tools.LoadImage(t, function (e) { var t = document.createElement("canvas"), c = t.getContext("2d"), h = e.width, u = e.height; t.width = h, t.height = u, c.drawImage(e, 0, 0); var d = c.getImageData(0, 0, h, u).data; l.applyDisplacementMapFromBuffer(d, h, u, i, r, o, s, a), n && n(l) }, function () { }, c.database), this }, r.prototype.applyDisplacementMapFromBuffer = function (t, i, r, n, o, s, a, l) { if (void 0 === l && (l = !1), !this.isVerticesDataPresent(e.VertexBuffer.PositionKind) || !this.isVerticesDataPresent(e.VertexBuffer.NormalKind) || !this.isVerticesDataPresent(e.VertexBuffer.UVKind)) return e.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"), this; var c = this.getVerticesData(e.VertexBuffer.PositionKind, !0, !0), h = this.getVerticesData(e.VertexBuffer.NormalKind), u = this.getVerticesData(e.VertexBuffer.UVKind), d = e.Vector3.Zero(), f = e.Vector3.Zero(), p = e.Vector2.Zero(); s = s || e.Vector2.Zero(), a = a || new e.Vector2(1, 1); for (var _ = 0; _ < c.length; _ += 3) { e.Vector3.FromArrayToRef(c, _, d), e.Vector3.FromArrayToRef(h, _, f), e.Vector2.FromArrayToRef(u, _ / 3 * 2, p); var m = 4 * ((Math.abs(p.x * a.x + s.x) * i % i | 0) + (Math.abs(p.y * a.y + s.y) * r % r | 0) * i), g = t[m] / 255 * .3 + t[m + 1] / 255 * .59 + t[m + 2] / 255 * .11; f.normalize(), f.scaleInPlace(n + (o - n) * g), (d = d.add(f)).toArray(c, _) } return e.VertexData.ComputeNormals(c, this.getIndices(), h), l ? (this.setVerticesData(e.VertexBuffer.PositionKind, c), this.setVerticesData(e.VertexBuffer.NormalKind, h)) : (this.updateVerticesData(e.VertexBuffer.PositionKind, c), this.updateVerticesData(e.VertexBuffer.NormalKind, h)), this }, r.prototype.convertToFlatShadedMesh = function () { var t, i, r = this.getVerticesDataKinds(), n = {}, o = {}, s = {}, a = !1; for (t = 0; t < r.length; t++) { i = r[t]; var l = this.getVertexBuffer(i); i !== e.VertexBuffer.NormalKind ? (n[i] = l, o[i] = n[i].getData(), s[i] = []) : (a = l.isUpdatable(), r.splice(t, 1), t--) } var c, h = this.subMeshes.slice(0), u = this.getIndices(), d = this.getTotalIndices(); for (c = 0; c < d; c++) { var f = u[c]; for (t = 0; t < r.length; t++)for (var p = n[i = r[t]].getStrideSize(), _ = 0; _ < p; _++)s[i].push(o[i][f * p + _]) } var m = [], g = s[e.VertexBuffer.PositionKind]; for (c = 0; c < d; c += 3) { u[c] = c, u[c + 1] = c + 1, u[c + 2] = c + 2; for (var v = e.Vector3.FromArray(g, 3 * c), y = e.Vector3.FromArray(g, 3 * (c + 1)), b = e.Vector3.FromArray(g, 3 * (c + 2)), T = v.subtract(y), E = b.subtract(y), x = e.Vector3.Normalize(e.Vector3.Cross(T, E)), P = 0; P < 3; P++)m.push(x.x), m.push(x.y), m.push(x.z) } for (this.setIndices(u), this.setVerticesData(e.VertexBuffer.NormalKind, m, a), t = 0; t < r.length; t++)i = r[t], this.setVerticesData(i, s[i], n[i].isUpdatable()); this.releaseSubMeshes(); for (var A = 0; A < h.length; A++) { var S = h[A]; e.SubMesh.AddToMesh(S.materialIndex, S.indexStart, S.indexCount, S.indexStart, S.indexCount, this) } return this.synchronizeInstances(), this }, r.prototype.convertToUnIndexedMesh = function () { var t, i, r = this.getVerticesDataKinds(), n = {}, o = {}, s = {}; for (t = 0; t < r.length; t++) { i = r[t]; var a = this.getVertexBuffer(i); n[i] = a, o[i] = n[i].getData(), s[i] = [] } var l, c = this.subMeshes.slice(0), h = this.getIndices(), u = this.getTotalIndices(); for (l = 0; l < u; l++) { var d = h[l]; for (t = 0; t < r.length; t++)for (var f = n[i = r[t]].getStrideSize(), p = 0; p < f; p++)s[i].push(o[i][d * f + p]) } for (l = 0; l < u; l += 3)h[l] = l, h[l + 1] = l + 1, h[l + 2] = l + 2; for (this.setIndices(h), t = 0; t < r.length; t++)i = r[t], this.setVerticesData(i, s[i], n[i].isUpdatable()); this.releaseSubMeshes(); for (var _ = 0; _ < c.length; _++) { var m = c[_]; e.SubMesh.AddToMesh(m.materialIndex, m.indexStart, m.indexCount, m.indexStart, m.indexCount, this) } return this._unIndexed = !0, this.synchronizeInstances(), this }, r.prototype.flipFaces = function (t) { void 0 === t && (t = !1); var i, r, n = e.VertexData.ExtractFromMesh(this); if (t && this.isVerticesDataPresent(e.VertexBuffer.NormalKind) && n.normals) for (i = 0; i < n.normals.length; i++)n.normals[i] *= -1; if (n.indices) for (i = 0; i < n.indices.length; i += 3)r = n.indices[i + 1], n.indices[i + 1] = n.indices[i + 2], n.indices[i + 2] = r; return n.applyToMesh(this), this }, r.prototype.createInstance = function (t) { return new e.InstancedMesh(t, this) }, r.prototype.synchronizeInstances = function () { for (var e = 0; e < this.instances.length; e++)this.instances[e]._syncSubMeshes(); return this }, r.prototype.optimizeIndices = function (t) { var i = this, r = this.getIndices(), n = this.getVerticesData(e.VertexBuffer.PositionKind); if (!n || !r) return this; for (var o = new Array, s = 0; s < n.length; s += 3)o.push(e.Vector3.FromArray(n, s)); var a = new Array; return e.AsyncLoop.SyncAsyncForLoop(o.length, 40, function (e) { for (var t = o.length - 1 - e, i = o[t], r = 0; r < t; ++r) { var n = o[r]; if (i.equals(n)) { a[t] = r; break } } }, function () { for (var e = 0; e < r.length; ++e)r[e] = a[r[e]] || r[e]; var n = i.subMeshes.slice(0); i.setIndices(r), i.subMeshes = n, t && t(i) }), this }, r.prototype.serialize = function (t) { t.name = this.name, t.id = this.id, t.type = this.getClassName(), e.Tags && e.Tags.HasTags(this) && (t.tags = e.Tags.GetTags(this)), t.position = this.position.asArray(), this.rotationQuaternion ? t.rotationQuaternion = this.rotationQuaternion.asArray() : this.rotation && (t.rotation = this.rotation.asArray()), t.scaling = this.scaling.asArray(), t.localMatrix = this.getPivotMatrix().asArray(), t.isEnabled = this.isEnabled(!1), t.isVisible = this.isVisible, t.infiniteDistance = this.infiniteDistance, t.pickable = this.isPickable, t.receiveShadows = this.receiveShadows, t.billboardMode = this.billboardMode, t.visibility = this.visibility, t.checkCollisions = this.checkCollisions, t.isBlocker = this.isBlocker, this.parent && (t.parentId = this.parent.id), t.isUnIndexed = this.isUnIndexed; var i = this._geometry; if (i) { var r = i.id; t.geometryId = r, t.subMeshes = []; for (var n = 0; n < this.subMeshes.length; n++) { var o = this.subMeshes[n]; t.subMeshes.push({ materialIndex: o.materialIndex, verticesStart: o.verticesStart, verticesCount: o.verticesCount, indexStart: o.indexStart, indexCount: o.indexCount }) } } this.material ? t.materialId = this.material.id : this.material = null, this.morphTargetManager && (t.morphTargetManagerId = this.morphTargetManager.uniqueId), this.skeleton && (t.skeletonId = this.skeleton.id); var s = this.getPhysicsImpostor(); s && (t.physicsMass = s.getParam("mass"), t.physicsFriction = s.getParam("friction"), t.physicsRestitution = s.getParam("mass"), t.physicsImpostor = s.type), this.metadata && (t.metadata = this.metadata), t.instances = []; for (var a = 0; a < this.instances.length; a++) { var l = this.instances[a]; if (!l.doNotSerialize) { var c = { name: l.name, id: l.id, position: l.position.asArray(), scaling: l.scaling.asArray() }; l.parent && (c.parentId = l.parent.id), l.rotationQuaternion ? c.rotationQuaternion = l.rotationQuaternion.asArray() : l.rotation && (c.rotation = l.rotation.asArray()), t.instances.push(c), e.Animation.AppendSerializedAnimations(l, c), c.ranges = l.serializeAnimationRanges() } } e.Animation.AppendSerializedAnimations(this, t), t.ranges = this.serializeAnimationRanges(), t.layerMask = this.layerMask, t.alphaIndex = this.alphaIndex, t.hasVertexAlpha = this.hasVertexAlpha, t.overlayAlpha = this.overlayAlpha, t.overlayColor = this.overlayColor.asArray(), t.renderOverlay = this.renderOverlay, t.applyFog = this.applyFog, this.actionManager && (t.actions = this.actionManager.serialize(this.name)) }, r.prototype._syncGeometryWithMorphTargetManager = function () { if (this.geometry) { this._markSubMeshesAsAttributesDirty(); var t = this._morphTargetManager; if (t && t.vertexCount) { if (t.vertexCount !== this.getTotalVertices()) return e.Tools.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."), void (this.morphTargetManager = null); for (var i = 0; i < t.numInfluencers; i++) { var r = t.getActiveTarget(i), n = r.getPositions(); if (!n) return void e.Tools.Error("Invalid morph target. Target must have positions."); this.geometry.setVerticesData(e.VertexBuffer.PositionKind + i, n, !1, 3); var o = r.getNormals(); o && this.geometry.setVerticesData(e.VertexBuffer.NormalKind + i, o, !1, 3); var s = r.getTangents(); s && this.geometry.setVerticesData(e.VertexBuffer.TangentKind + i, s, !1, 3) } } else for (i = 0; this.geometry.isVerticesDataPresent(e.VertexBuffer.PositionKind + i);)this.geometry.removeVerticesData(e.VertexBuffer.PositionKind + i), this.geometry.isVerticesDataPresent(e.VertexBuffer.NormalKind + i) && this.geometry.removeVerticesData(e.VertexBuffer.NormalKind + i), this.geometry.isVerticesDataPresent(e.VertexBuffer.TangentKind + i) && this.geometry.removeVerticesData(e.VertexBuffer.TangentKind + i), i++ } }, r.Parse = function (t, i, n) { var o; if ((o = t.type && "GroundMesh" === t.type ? e.GroundMesh.Parse(t, i) : new r(t.name, i)).id = t.id, e.Tags && e.Tags.AddTagsTo(o, t.tags), o.position = e.Vector3.FromArray(t.position), void 0 !== t.metadata && (o.metadata = t.metadata), t.rotationQuaternion ? o.rotationQuaternion = e.Quaternion.FromArray(t.rotationQuaternion) : t.rotation && (o.rotation = e.Vector3.FromArray(t.rotation)), o.scaling = e.Vector3.FromArray(t.scaling), t.localMatrix ? o.setPreTransformMatrix(e.Matrix.FromArray(t.localMatrix)) : t.pivotMatrix && o.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)), o.setEnabled(t.isEnabled), o.isVisible = t.isVisible, o.infiniteDistance = t.infiniteDistance, o.showBoundingBox = t.showBoundingBox, o.showSubMeshesBoundingBox = t.showSubMeshesBoundingBox, void 0 !== t.applyFog && (o.applyFog = t.applyFog), void 0 !== t.pickable && (o.isPickable = t.pickable), void 0 !== t.alphaIndex && (o.alphaIndex = t.alphaIndex), o.receiveShadows = t.receiveShadows, o.billboardMode = t.billboardMode, void 0 !== t.visibility && (o.visibility = t.visibility), o.checkCollisions = t.checkCollisions, void 0 !== t.isBlocker && (o.isBlocker = t.isBlocker), o._shouldGenerateFlatShading = t.useFlatShading, t.freezeWorldMatrix && (o._waitingFreezeWorldMatrix = t.freezeWorldMatrix), t.parentId && (o._waitingParentId = t.parentId), void 0 !== t.actions && (o._waitingActions = t.actions), void 0 !== t.overlayAlpha && (o.overlayAlpha = t.overlayAlpha), void 0 !== t.overlayColor && (o.overlayColor = e.Color3.FromArray(t.overlayColor)), void 0 !== t.renderOverlay && (o.renderOverlay = t.renderOverlay), o.isUnIndexed = !!t.isUnIndexed, o.hasVertexAlpha = t.hasVertexAlpha, t.delayLoadingFile ? (o.delayLoadState = e.Engine.DELAYLOADSTATE_NOTLOADED, o.delayLoadingFile = n + t.delayLoadingFile, o._boundingInfo = new e.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum), e.Vector3.FromArray(t.boundingBoxMaximum)), t._binaryInfo && (o._binaryInfo = t._binaryInfo), o._delayInfo = [], t.hasUVs && o._delayInfo.push(e.VertexBuffer.UVKind), t.hasUVs2 && o._delayInfo.push(e.VertexBuffer.UV2Kind), t.hasUVs3 && o._delayInfo.push(e.VertexBuffer.UV3Kind), t.hasUVs4 && o._delayInfo.push(e.VertexBuffer.UV4Kind), t.hasUVs5 && o._delayInfo.push(e.VertexBuffer.UV5Kind), t.hasUVs6 && o._delayInfo.push(e.VertexBuffer.UV6Kind), t.hasColors && o._delayInfo.push(e.VertexBuffer.ColorKind), t.hasMatricesIndices && o._delayInfo.push(e.VertexBuffer.MatricesIndicesKind), t.hasMatricesWeights && o._delayInfo.push(e.VertexBuffer.MatricesWeightsKind), o._delayLoadingFunction = e.Geometry._ImportGeometry, e.SceneLoader.ForceFullSceneLoadingForIncremental && o._checkDelayState()) : e.Geometry._ImportGeometry(t, o), t.materialId ? o.setMaterialByID(t.materialId) : o.material = null, -1 < t.morphTargetManagerId && (o.morphTargetManager = i.getMorphTargetManagerById(t.morphTargetManagerId)), -1 < t.skeletonId && (o.skeleton = i.getLastSkeletonByID(t.skeletonId), t.numBoneInfluencers && (o.numBoneInfluencers = t.numBoneInfluencers)), t.animations) { for (var s = 0; s < t.animations.length; s++) { var a = t.animations[s]; o.animations.push(e.Animation.Parse(a)) } e.Node.ParseAnimationRanges(o, t, i) } if (t.autoAnimate && i.beginAnimation(o, t.autoAnimateFrom, t.autoAnimateTo, t.autoAnimateLoop, t.autoAnimateSpeed || 1), t.layerMask && !isNaN(t.layerMask) ? o.layerMask = Math.abs(parseInt(t.layerMask)) : o.layerMask = 268435455, t.physicsImpostor && (o.physicsImpostor = new e.PhysicsImpostor(o, t.physicsImpostor, { mass: t.physicsMass, friction: t.physicsFriction, restitution: t.physicsRestitution }, i)), t.instances) for (var l = 0; l < t.instances.length; l++) { var c = t.instances[l], h = o.createInstance(c.name); if (c.id && (h.id = c.id), e.Tags && (c.tags ? e.Tags.AddTagsTo(h, c.tags) : e.Tags.AddTagsTo(h, t.tags)), h.position = e.Vector3.FromArray(c.position), c.parentId && (h._waitingParentId = c.parentId), c.rotationQuaternion ? h.rotationQuaternion = e.Quaternion.FromArray(c.rotationQuaternion) : c.rotation && (h.rotation = e.Vector3.FromArray(c.rotation)), h.scaling = e.Vector3.FromArray(c.scaling), null != c.checkCollisions && null != c.checkCollisions && (h.checkCollisions = c.checkCollisions), null != c.pickable && null != c.pickable && (h.isPickable = c.pickable), null != c.showBoundingBox && null != c.showBoundingBox && (h.showBoundingBox = c.showBoundingBox), null != c.showSubMeshesBoundingBox && null != c.showSubMeshesBoundingBox && (h.showSubMeshesBoundingBox = c.showSubMeshesBoundingBox), null != c.alphaIndex && null != c.showSubMeshesBoundingBox && (h.alphaIndex = c.alphaIndex), c.physicsImpostor && (h.physicsImpostor = new e.PhysicsImpostor(h, c.physicsImpostor, { mass: c.physicsMass, friction: c.physicsFriction, restitution: c.physicsRestitution }, i)), c.animations) { for (s = 0; s < c.animations.length; s++)a = c.animations[s], h.animations.push(e.Animation.Parse(a)); e.Node.ParseAnimationRanges(h, c, i), c.autoAnimate && i.beginAnimation(h, c.autoAnimateFrom, c.autoAnimateTo, c.autoAnimateLoop, c.autoAnimateSpeed || 1) } } return o }, r.CreateRibbon = function (t, i, r, n, o, s, a, l, c) { return void 0 === r && (r = !1), void 0 === a && (a = !1), e.MeshBuilder.CreateRibbon(t, { pathArray: i, closeArray: r, closePath: n, offset: o, updatable: a, sideOrientation: l, instance: c }, s) }, r.CreateDisc = function (t, i, r, n, o, s) { void 0 === n && (n = null); var a = { radius: i, tessellation: r, sideOrientation: s, updatable: o }; return e.MeshBuilder.CreateDisc(t, a, n) }, r.CreateBox = function (t, i, r, n, o) { void 0 === r && (r = null); var s = { size: i, sideOrientation: o, updatable: n }; return e.MeshBuilder.CreateBox(t, s, r) }, r.CreateSphere = function (t, i, r, n, o, s) { var a = { segments: i, diameterX: r, diameterY: r, diameterZ: r, sideOrientation: s, updatable: o }; return e.MeshBuilder.CreateSphere(t, a, n) }, r.CreateCylinder = function (t, i, n, o, s, a, l, c, h) { void 0 !== l && l instanceof e.Scene || (void 0 !== l && (h = c || r.DEFAULTSIDE, c = l), l = a, a = 1); var u = { height: i, diameterTop: n, diameterBottom: o, tessellation: s, subdivisions: a, sideOrientation: h, updatable: c }; return e.MeshBuilder.CreateCylinder(t, u, l) }, r.CreateTorus = function (t, i, r, n, o, s, a) { var l = { diameter: i, thickness: r, tessellation: n, sideOrientation: a, updatable: s }; return e.MeshBuilder.CreateTorus(t, l, o) }, r.CreateTorusKnot = function (t, i, r, n, o, s, a, l, c, h) { var u = { radius: i, tube: r, radialSegments: n, tubularSegments: o, p: s, q: a, sideOrientation: h, updatable: c }; return e.MeshBuilder.CreateTorusKnot(t, u, l) }, r.CreateLines = function (t, i, r, n, o) { void 0 === r && (r = null), void 0 === n && (n = !1), void 0 === o && (o = null); var s = { points: i, updatable: n, instance: o }; return e.MeshBuilder.CreateLines(t, s, r) }, r.CreateDashedLines = function (t, i, r, n, o, s, a, l) { void 0 === s && (s = null); var c = { points: i, dashSize: r, gapSize: n, dashNb: o, updatable: a, instance: l }; return e.MeshBuilder.CreateDashedLines(t, c, s) }, r.CreatePolygon = function (t, i, r, n, o, s) { var a = { shape: i, holes: n, updatable: o, sideOrientation: s }; return e.MeshBuilder.CreatePolygon(t, a, r) }, r.ExtrudePolygon = function (t, i, r, n, o, s, a) { var l = { shape: i, holes: o, depth: r, updatable: s, sideOrientation: a }; return e.MeshBuilder.ExtrudePolygon(t, l, n) }, r.ExtrudeShape = function (t, i, n, o, s, a, l, c, h, u) { void 0 === l && (l = null); var d = { shape: i, path: n, scale: o, rotation: s, cap: 0 === a ? 0 : a || r.NO_CAP, sideOrientation: h, instance: u, updatable: c }; return e.MeshBuilder.ExtrudeShape(t, d, l) }, r.ExtrudeShapeCustom = function (t, i, n, o, s, a, l, c, h, u, d, f) { var p = { shape: i, path: n, scaleFunction: o, rotationFunction: s, ribbonCloseArray: a, ribbonClosePath: l, cap: 0 === c ? 0 : c || r.NO_CAP, sideOrientation: d, instance: f, updatable: u }; return e.MeshBuilder.ExtrudeShapeCustom(t, p, h) }, r.CreateLathe = function (t, i, r, n, o, s, a) { var l = { shape: i, radius: r, tessellation: n, sideOrientation: a, updatable: s }; return e.MeshBuilder.CreateLathe(t, l, o) }, r.CreatePlane = function (t, i, r, n, o) { var s = { size: i, width: i, height: i, sideOrientation: o, updatable: n }; return e.MeshBuilder.CreatePlane(t, s, r) }, r.CreateGround = function (t, i, r, n, o, s) { var a = { width: i, height: r, subdivisions: n, updatable: s }; return e.MeshBuilder.CreateGround(t, a, o) }, r.CreateTiledGround = function (t, i, r, n, o, s, a, l, c) { var h = { xmin: i, zmin: r, xmax: n, zmax: o, subdivisions: s, precision: a, updatable: c }; return e.MeshBuilder.CreateTiledGround(t, h, l) }, r.CreateGroundFromHeightMap = function (t, i, r, n, o, s, a, l, c, h, u) { var d = { width: r, height: n, subdivisions: o, minHeight: s, maxHeight: a, updatable: c, onReady: h, alphaFilter: u }; return e.MeshBuilder.CreateGroundFromHeightMap(t, i, d, l) }, r.CreateTube = function (t, i, r, n, o, s, a, l, c, h) { var u = { path: i, radius: r, tessellation: n, radiusFunction: o, arc: 1, cap: s, updatable: l, sideOrientation: c, instance: h }; return e.MeshBuilder.CreateTube(t, u, a) }, r.CreatePolyhedron = function (t, i, r) { return e.MeshBuilder.CreatePolyhedron(t, i, r) }, r.CreateIcoSphere = function (t, i, r) { return e.MeshBuilder.CreateIcoSphere(t, i, r) }, r.CreateDecal = function (t, i, r, n, o, s) { var a = { position: r, normal: n, size: o, angle: s }; return e.MeshBuilder.CreateDecal(t, i, a) }, r.prototype.setPositionsForCPUSkinning = function () { if (!this._sourcePositions) { var t = this.getVerticesData(e.VertexBuffer.PositionKind); if (!t) return this._sourcePositions; this._sourcePositions = new Float32Array(t), this.isVertexBufferUpdatable(e.VertexBuffer.PositionKind) || this.setVerticesData(e.VertexBuffer.PositionKind, t, !0) } return this._sourcePositions }, r.prototype.setNormalsForCPUSkinning = function () { if (!this._sourceNormals) { var t = this.getVerticesData(e.VertexBuffer.NormalKind); if (!t) return this._sourceNormals; this._sourceNormals = new Float32Array(t), this.isVertexBufferUpdatable(e.VertexBuffer.NormalKind) || this.setVerticesData(e.VertexBuffer.NormalKind, t, !0) } return this._sourceNormals }, r.prototype.applySkeleton = function (t) { if (!this.geometry) return this; if (this.geometry._softwareSkinningFrameId == this.getScene().getFrameId()) return this; if (this.geometry._softwareSkinningFrameId = this.getScene().getFrameId(), !this.isVerticesDataPresent(e.VertexBuffer.PositionKind)) return this; if (!this.isVerticesDataPresent(e.VertexBuffer.NormalKind)) return this; if (!this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)) return this; if (!this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)) return this; if (!this._sourcePositions) { var i = this.subMeshes.slice(); this.setPositionsForCPUSkinning(), this.subMeshes = i } this._sourceNormals || this.setNormalsForCPUSkinning(); var r = this.getVerticesData(e.VertexBuffer.PositionKind); if (!r) return this; r instanceof Float32Array || (r = new Float32Array(r)); var n = this.getVerticesData(e.VertexBuffer.NormalKind); if (!n) return this; n instanceof Float32Array || (n = new Float32Array(n)); var o = this.getVerticesData(e.VertexBuffer.MatricesIndicesKind), s = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind); if (!s || !o) return this; for (var a, l = 4 < this.numBoneInfluencers, c = l ? this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind) : null, h = l ? this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind) : null, u = t.getTransformMatrices(this), d = e.Vector3.Zero(), f = new e.Matrix, p = new e.Matrix, _ = 0, m = 0; m < r.length; m += 3, _ += 4) { var g; for (a = 0; a < 4; a++)0 < (g = s[_ + a]) && (e.Matrix.FromFloat32ArrayToRefScaled(u, Math.floor(16 * o[_ + a]), g, p), f.addToSelf(p)); if (l) for (a = 0; a < 4; a++)0 < (g = h[_ + a]) && (e.Matrix.FromFloat32ArrayToRefScaled(u, Math.floor(16 * c[_ + a]), g, p), f.addToSelf(p)); e.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[m], this._sourcePositions[m + 1], this._sourcePositions[m + 2], f, d), d.toArray(r, m), e.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[m], this._sourceNormals[m + 1], this._sourceNormals[m + 2], f, d), d.toArray(n, m), f.reset() } return this.updateVerticesData(e.VertexBuffer.PositionKind, r), this.updateVerticesData(e.VertexBuffer.NormalKind, n), this }, r.MinMax = function (t) { var i = null, r = null; return t.forEach(function (e, t, n) { var o = e.getBoundingInfo().boundingBox; i && r ? (i.minimizeInPlace(o.minimumWorld), r.maximizeInPlace(o.maximumWorld)) : (i = o.minimumWorld, r = o.maximumWorld) }), i && r ? { min: i, max: r } : { min: e.Vector3.Zero(), max: e.Vector3.Zero() } }, r.Center = function (t) { var i = t instanceof Array ? r.MinMax(t) : t; return e.Vector3.Center(i.min, i.max) }, r.MergeMeshes = function (t, i, n, o, s) { var a; if (void 0 === i && (i = !0), !n) { var l = 0; for (a = 0; a < t.length; a++)if (t[a] && 65536 < (l += t[a].getTotalVertices())) return e.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"), null } var c, h = null, u = new Array, d = null; for (a = 0; a < t.length; a++)if (t[a]) { var f = t[a].computeWorldMatrix(!0); (c = e.VertexData.ExtractFromMesh(t[a], !0, !0)).transform(f), h ? h.merge(c, n) : (h = c, d = t[a]), s && u.push(t[a].getTotalIndices()) } if (d = d, o || (o = new r(d.name + "_merged", d.getScene())), h.applyToMesh(o), o.material = d.material, o.checkCollisions = d.checkCollisions, i) for (a = 0; a < t.length; a++)t[a] && t[a].dispose(); if (s) { o.releaseSubMeshes(); for (var p = a = 0; a < u.length;)e.SubMesh.CreateFromIndices(0, p, u[a], o), p += u[a], a++ } return o }, r.FRONTSIDE = 0, r.BACKSIDE = 1, r.DOUBLESIDE = 2, r.DEFAULTSIDE = 0, r.NO_CAP = 0, r.CAP_START = 1, r.CAP_END = 2, r.CAP_ALL = 3, r }(e.AbstractMesh); e.Mesh = r }($a || ($a = {})), oe = $a || ($a = {}), se = function () { function e() { } return Object.defineProperty(e.prototype, "effect", { get: function () { return this._materialEffect }, enumerable: !0, configurable: !0 }), e.prototype.setEffect = function (e, t) { void 0 === t && (t = null), this._materialEffect !== e ? (this._materialDefines = t, this._materialEffect = e) : e || (this._materialDefines = null) }, e }(), ae = function (e) { function t(t, i, r, n, o, s, a, l) { void 0 === l && (l = !0); var c = e.call(this) || this; return c.materialIndex = t, c.verticesStart = i, c.verticesCount = r, c.indexStart = n, c.indexCount = o, c._renderId = 0, c._mesh = s, c._renderingMesh = a || s, s.subMeshes.push(c), c._trianglePlanes = [], c._id = s.subMeshes.length - 1, l && (c.refreshBoundingInfo(), s.computeWorldMatrix(!0)), c } return T(t, e), t.AddToMesh = function (e, i, r, n, o, s, a, l) { return void 0 === l && (l = !0), new t(e, i, r, n, o, s, a, l) }, Object.defineProperty(t.prototype, "IsGlobal", { get: function () { return 0 === this.verticesStart && this.verticesCount === this._mesh.getTotalVertices() }, enumerable: !0, configurable: !0 }), t.prototype.getBoundingInfo = function () { return this.IsGlobal ? this._mesh.getBoundingInfo() : this._boundingInfo }, t.prototype.setBoundingInfo = function (e) { return this._boundingInfo = e, this }, t.prototype.getMesh = function () { return this._mesh }, t.prototype.getRenderingMesh = function () { return this._renderingMesh }, t.prototype.getMaterial = function () { var e = this._renderingMesh.material; if (null == e) return this._mesh.getScene().defaultMaterial; if (e.getSubMaterial) { var t = e.getSubMaterial(this.materialIndex); return this._currentMaterial !== t && (this._currentMaterial = t, this._materialDefines = null), t } return e }, t.prototype.refreshBoundingInfo = function () { if (this._lastColliderWorldVertices = null, this.IsGlobal || !this._renderingMesh || !this._renderingMesh.geometry) return this; var e = this._renderingMesh.getVerticesData(oe.VertexBuffer.PositionKind); if (!e) return this._boundingInfo = this._mesh.getBoundingInfo(), this; var t, i = this._renderingMesh.getIndices(); if (0 === this.indexStart && this.indexCount === i.length) { var r = this._renderingMesh.getBoundingInfo(); t = { minimum: r.minimum.clone(), maximum: r.maximum.clone() } } else t = oe.Tools.ExtractMinAndMaxIndexed(e, i, this.indexStart, this.indexCount, this._renderingMesh.geometry.boundingBias); return this._boundingInfo = new oe.BoundingInfo(t.minimum, t.maximum), this }, t.prototype._checkCollision = function (e) { return this.getBoundingInfo()._checkCollision(e) }, t.prototype.updateBoundingInfo = function (e) { var t = this.getBoundingInfo(); return t || (this.refreshBoundingInfo(), t = this.getBoundingInfo()), t.update(e), this }, t.prototype.isInFrustum = function (e) { var t = this.getBoundingInfo(); return !!t && t.isInFrustum(e, this._mesh.cullingStrategy) }, t.prototype.isCompletelyInFrustum = function (e) { var t = this.getBoundingInfo(); return !!t && t.isCompletelyInFrustum(e) }, t.prototype.render = function (e) { return this._renderingMesh.render(this, e), this }, t.prototype._getLinesIndexBuffer = function (e, t) { if (!this._linesIndexBuffer) { for (var i = [], r = this.indexStart; r < this.indexStart + this.indexCount; r += 3)i.push(e[r], e[r + 1], e[r + 1], e[r + 2], e[r + 2], e[r]); this._linesIndexBuffer = t.createIndexBuffer(i), this._linesIndexCount = i.length } return this._linesIndexBuffer }, t.prototype.canIntersects = function (e) { var t = this.getBoundingInfo(); return !!t && e.intersectsBox(t.boundingBox) }, t.prototype.intersects = function (e, t, i, r) { var n = this.getMaterial(); if (!n) return null; switch (n.fillMode) { case oe.Material.PointListDrawMode: case oe.Material.LineListDrawMode: case oe.Material.LineLoopDrawMode: case oe.Material.LineStripDrawMode: case oe.Material.TriangleFanDrawMode: case oe.Material.TriangleStripDrawMode: return null }if (oe.LinesMesh) { var o = this._mesh instanceof oe.InstancedMesh ? this._mesh.sourceMesh : this._mesh; if (o instanceof oe.LinesMesh) { var s = o; return this._intersectLines(e, t, i, s.intersectionThreshold, r) } } return this._intersectTriangles(e, t, i, r) }, t.prototype._intersectLines = function (e, t, i, r, n) { for (var o = null, s = this.indexStart; s < this.indexStart + this.indexCount; s += 2) { var a = t[i[s]], l = t[i[s + 1]], c = e.intersectionSegment(a, l, r); if (!(c < 0) && (n || !o || c < o.distance) && (o = new oe.IntersectionInfo(null, null, c), n)) break } return o }, t.prototype._intersectTriangles = function (e, t, i, r) { for (var n = null, o = this.indexStart; o < this.indexStart + this.indexCount; o += 3) { var s = t[i[o]], a = t[i[o + 1]], l = t[i[o + 2]], c = e.intersectsTriangle(s, a, l); if (c) { if (c.distance < 0) continue; if ((r || !n || c.distance < n.distance) && ((n = c).faceId = o / 3, r)) break } } return n }, t.prototype._rebuild = function () { this._linesIndexBuffer && (this._linesIndexBuffer = null) }, t.prototype.clone = function (e, i) { var r = new t(this.materialIndex, this.verticesStart, this.verticesCount, this.indexStart, this.indexCount, e, i, !1); if (!this.IsGlobal) { var n = this.getBoundingInfo(); if (!n) return r; r._boundingInfo = new oe.BoundingInfo(n.minimum, n.maximum) } return r }, t.prototype.dispose = function () { this._linesIndexBuffer && (this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer), this._linesIndexBuffer = null); var e = this._mesh.subMeshes.indexOf(this); this._mesh.subMeshes.splice(e, 1) }, t.CreateFromIndices = function (e, i, r, n, o) { for (var s = Number.MAX_VALUE, a = -Number.MAX_VALUE, l = (o = o || n).getIndices(), c = i; c < i + r; c++) { var h = l[c]; h < s && (s = h), a < h && (a = h) } return new t(e, s, a - s + 1, i, r, n, o) }, t }(oe.BaseSubMesh = se), oe.SubMesh = ae, tl = this && this.__assign || function () { return (tl = Object.assign || function (e) { for (var t, i = 1, r = arguments.length; i < r; i++)for (var n in t = arguments[i]) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]); return e }).apply(this, arguments) }, function (e) { var t = function () { function e() { this._isDirty = !0, this._areLightsDirty = !0, this._areAttributesDirty = !0, this._areTexturesDirty = !0, this._areFresnelDirty = !0, this._areMiscDirty = !0, this._areImageProcessingDirty = !0, this._normals = !1, this._uvs = !1, this._needNormals = !1, this._needUVs = !1 } return Object.defineProperty(e.prototype, "isDirty", { get: function () { return this._isDirty }, enumerable: !0, configurable: !0 }), e.prototype.markAsProcessed = function () { this._isDirty = !1, this._areAttributesDirty = !1, this._areTexturesDirty = !1, this._areFresnelDirty = !1, this._areLightsDirty = !1, this._areMiscDirty = !1, this._areImageProcessingDirty = !1 }, e.prototype.markAsUnprocessed = function () { this._isDirty = !0 }, e.prototype.markAllAsDirty = function () { this._areTexturesDirty = !0, this._areAttributesDirty = !0, this._areLightsDirty = !0, this._areFresnelDirty = !0, this._areMiscDirty = !0, this._areImageProcessingDirty = !0, this._isDirty = !0 }, e.prototype.markAsImageProcessingDirty = function () { this._areImageProcessingDirty = !0, this._isDirty = !0 }, e.prototype.markAsLightDirty = function () { this._areLightsDirty = !0, this._isDirty = !0 }, e.prototype.markAsAttributesDirty = function () { this._areAttributesDirty = !0, this._isDirty = !0 }, e.prototype.markAsTexturesDirty = function () { this._areTexturesDirty = !0, this._isDirty = !0 }, e.prototype.markAsFresnelDirty = function () { this._areFresnelDirty = !0, this._isDirty = !0 }, e.prototype.markAsMiscDirty = function () { this._areMiscDirty = !0, this._isDirty = !0 }, e.prototype.rebuild = function () { this._keys && delete this._keys, this._keys = []; for (var e = 0, t = Object.keys(this); e < t.length; e++) { var i = t[e]; "_" !== i[0] && this._keys.push(i) } }, e.prototype.isEqual = function (e) { if (this._keys.length !== e._keys.length) return !1; for (var t = 0; t < this._keys.length; t++) { var i = this._keys[t]; if (this[i] !== e[i]) return !1 } return !0 }, e.prototype.cloneTo = function (e) { this._keys.length !== e._keys.length && (e._keys = this._keys.slice(0)); for (var t = 0; t < this._keys.length; t++) { var i = this._keys[t]; e[i] = this[i] } }, e.prototype.reset = function () { for (var e = 0; e < this._keys.length; e++) { var t = this._keys[e]; switch (typeof this[t]) { case "number": this[t] = 0; break; case "string": this[t] = ""; break; default: this[t] = !1 } } }, e.prototype.toString = function () { for (var e = "", t = 0; t < this._keys.length; t++) { var i = this._keys[t], r = this[i]; switch (typeof r) { case "number": case "string": e += "#define " + i + " " + r + "\n"; break; default: r && (e += "#define " + i + "\n") } } return e }, e }(); e.MaterialDefines = t; var i = function () { function t(i, r, n) { this.checkReadyOnEveryCall = !1, this.checkReadyOnlyOnce = !1, this.state = "", this._alpha = 1, this._backFaceCulling = !0, this.doNotSerialize = !1, this.storeEffectOnSubMeshes = !1, this.onDisposeObservable = new e.Observable, this._alphaMode = e.Engine.ALPHA_COMBINE, this._needDepthPrePass = !1, this.disableDepthWrite = !1, this.forceDepthWrite = !1, this.separateCullingPass = !1, this._fogEnabled = !0, this.pointSize = 1, this.zOffset = 0, this._wasPreviouslyReady = !1, this._fillMode = t.TriangleFillMode, this.name = i, this.id = i || e.Tools.RandomId(), this._scene = r || e.Engine.LastCreatedScene, this.uniqueId = this._scene.getUniqueId(), this._scene.useRightHandedSystem ? this.sideOrientation = t.ClockWiseSideOrientation : this.sideOrientation = t.CounterClockWiseSideOrientation, this._uniformBuffer = new e.UniformBuffer(this._scene.getEngine()), this._useUBO = this.getScene().getEngine().supportsUniformBuffers, n || (this._scene.materials.push(this), this._scene.onNewMaterialAddedObservable.notifyObservers(this)) } return Object.defineProperty(t, "TriangleFillMode", { get: function () { return t._TriangleFillMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "WireFrameFillMode", { get: function () { return t._WireFrameFillMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "PointFillMode", { get: function () { return t._PointFillMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "PointListDrawMode", { get: function () { return t._PointListDrawMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "LineListDrawMode", { get: function () { return t._LineListDrawMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "LineLoopDrawMode", { get: function () { return t._LineLoopDrawMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "LineStripDrawMode", { get: function () { return t._LineStripDrawMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "TriangleStripDrawMode", { get: function () { return t._TriangleStripDrawMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "TriangleFanDrawMode", { get: function () { return t._TriangleFanDrawMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "ClockWiseSideOrientation", { get: function () { return t._ClockWiseSideOrientation }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "CounterClockWiseSideOrientation", { get: function () { return t._CounterClockWiseSideOrientation }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "alpha", { get: function () { return this._alpha }, set: function (e) { this._alpha !== e && (this._alpha = e, this.markAsDirty(t.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "backFaceCulling", { get: function () { return this._backFaceCulling }, set: function (e) { this._backFaceCulling !== e && (this._backFaceCulling = e, this.markAsDirty(t.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "hasRenderTargetTextures", { get: function () { return !1 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onDispose", { set: function (e) { this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onBindObservable", { get: function () { return this._onBindObservable || (this._onBindObservable = new e.Observable), this._onBindObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onBind", { set: function (e) { this._onBindObserver && this.onBindObservable.remove(this._onBindObserver), this._onBindObserver = this.onBindObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onUnBindObservable", { get: function () { return this._onUnBindObservable || (this._onUnBindObservable = new e.Observable), this._onUnBindObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "alphaMode", { get: function () { return this._alphaMode }, set: function (e) { this._alphaMode !== e && (this._alphaMode = e, this.markAsDirty(t.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "needDepthPrePass", { get: function () { return this._needDepthPrePass }, set: function (e) { this._needDepthPrePass !== e && (this._needDepthPrePass = e, this._needDepthPrePass && (this.checkReadyOnEveryCall = !0)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "fogEnabled", { get: function () { return this._fogEnabled }, set: function (e) { this._fogEnabled !== e && (this._fogEnabled = e, this.markAsDirty(t.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "wireframe", { get: function () { switch (this._fillMode) { case t.WireFrameFillMode: case t.LineListDrawMode: case t.LineLoopDrawMode: case t.LineStripDrawMode: return !0 }return this._scene.forceWireframe }, set: function (e) { this.fillMode = e ? t.WireFrameFillMode : t.TriangleFillMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "pointsCloud", { get: function () { switch (this._fillMode) { case t.PointFillMode: case t.PointListDrawMode: return !0 }return this._scene.forcePointsCloud }, set: function (e) { this.fillMode = e ? t.PointFillMode : t.TriangleFillMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "fillMode", { get: function () { return this._fillMode }, set: function (e) { this._fillMode !== e && (this._fillMode = e, this.markAsDirty(t.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), t.prototype.toString = function (e) { return "Name: " + this.name }, t.prototype.getClassName = function () { return "Material" }, Object.defineProperty(t.prototype, "isFrozen", { get: function () { return this.checkReadyOnlyOnce }, enumerable: !0, configurable: !0 }), t.prototype.freeze = function () { this.checkReadyOnlyOnce = !0 }, t.prototype.unfreeze = function () { this.checkReadyOnlyOnce = !1 }, t.prototype.isReady = function (e, t) { return !0 }, t.prototype.isReadyForSubMesh = function (e, t, i) { return !1 }, t.prototype.getEffect = function () { return this._effect }, t.prototype.getScene = function () { return this._scene }, t.prototype.needAlphaBlending = function () { return this.alpha < 1 }, t.prototype.needAlphaBlendingForMesh = function (e) { return this.needAlphaBlending() || e.visibility < 1 || e.hasVertexAlpha }, t.prototype.needAlphaTesting = function () { return !1 }, t.prototype.getAlphaTestTexture = function () { return null }, t.prototype.markDirty = function () { this._wasPreviouslyReady = !1 }, t.prototype._preBind = function (e, i) { void 0 === i && (i = null); var r = this._scene.getEngine(), n = (null == i ? this.sideOrientation : i) === t.ClockWiseSideOrientation; return r.enableEffect(e || this._effect), r.setState(this.backFaceCulling, this.zOffset, !1, n), n }, t.prototype.bind = function (e, t) { }, t.prototype.bindForSubMesh = function (e, t, i) { }, t.prototype.bindOnlyWorldMatrix = function (e) { }, t.prototype.bindSceneUniformBuffer = function (e, t) { t.bindToEffect(e, "Scene") }, t.prototype.bindView = function (e) { this._useUBO ? this.bindSceneUniformBuffer(e, this.getScene().getSceneUniformBuffer()) : e.setMatrix("view", this.getScene().getViewMatrix()) }, t.prototype.bindViewProjection = function (e) { this._useUBO ? this.bindSceneUniformBuffer(e, this.getScene().getSceneUniformBuffer()) : e.setMatrix("viewProjection", this.getScene().getTransformMatrix()) }, t.prototype._shouldTurnAlphaTestOn = function (e) { return !this.needAlphaBlendingForMesh(e) && this.needAlphaTesting() }, t.prototype._afterBind = function (e) { if ((this._scene._cachedMaterial = this)._scene._cachedVisibility = e ? e.visibility : 1, this._onBindObservable && e && this._onBindObservable.notifyObservers(e), this.disableDepthWrite) { var t = this._scene.getEngine(); this._cachedDepthWriteState = t.getDepthWrite(), t.setDepthWrite(!1) } }, t.prototype.unbind = function () { this._onUnBindObservable && this._onUnBindObservable.notifyObservers(this), this.disableDepthWrite && this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState) }, t.prototype.getActiveTextures = function () { return [] }, t.prototype.hasTexture = function (e) { return !1 }, t.prototype.clone = function (e) { return null }, t.prototype.getBindedMeshes = function () { for (var e = new Array, t = 0; t < this._scene.meshes.length; t++) { var i = this._scene.meshes[t]; i.material === this && e.push(i) } return e }, t.prototype.forceCompilation = function (t, i, r) { var n = this, o = tl({ clipPlane: !1 }, r), s = new e.BaseSubMesh, a = this.getScene(), l = function () { if (n._scene && n._scene.getEngine()) { s._materialDefines && (s._materialDefines._renderId = -1); var r = a.clipPlane; o.clipPlane && (a.clipPlane = new e.Plane(0, 0, 0, 1)), n.storeEffectOnSubMeshes ? n.isReadyForSubMesh(t, s) ? i && i(n) : setTimeout(l, 16) : n.isReady(t) ? i && i(n) : setTimeout(l, 16), o.clipPlane && (a.clipPlane = r) } }; l() }, t.prototype.forceCompilationAsync = function (e, t) { var i = this; return new Promise(function (r) { i.forceCompilation(e, function () { r() }, t) }) }, t.prototype.markAsDirty = function (e) { e & t.TextureDirtyFlag && this._markAllSubMeshesAsTexturesDirty(), e & t.LightDirtyFlag && this._markAllSubMeshesAsLightsDirty(), e & t.FresnelDirtyFlag && this._markAllSubMeshesAsFresnelDirty(), e & t.AttributesDirtyFlag && this._markAllSubMeshesAsAttributesDirty(), e & t.MiscDirtyFlag && this._markAllSubMeshesAsMiscDirty(), this.getScene().resetCachedMaterial() }, t.prototype._markAllSubMeshesAsDirty = function (e) { for (var t = 0, i = this.getScene().meshes; t < i.length; t++) { var r = i[t]; if (r.subMeshes) for (var n = 0, o = r.subMeshes; n < o.length; n++) { var s = o[n]; s.getMaterial() === this && s._materialDefines && e(s._materialDefines) } } }, t.prototype._markAllSubMeshesAsImageProcessingDirty = function () { this._markAllSubMeshesAsDirty(function (e) { return e.markAsImageProcessingDirty() }) }, t.prototype._markAllSubMeshesAsTexturesDirty = function () { this._markAllSubMeshesAsDirty(function (e) { return e.markAsTexturesDirty() }) }, t.prototype._markAllSubMeshesAsFresnelDirty = function () { this._markAllSubMeshesAsDirty(function (e) { return e.markAsFresnelDirty() }) }, t.prototype._markAllSubMeshesAsFresnelAndMiscDirty = function () { this._markAllSubMeshesAsDirty(function (e) { e.markAsFresnelDirty(), e.markAsMiscDirty() }) }, t.prototype._markAllSubMeshesAsLightsDirty = function () { this._markAllSubMeshesAsDirty(function (e) { return e.markAsLightDirty() }) }, t.prototype._markAllSubMeshesAsAttributesDirty = function () { this._markAllSubMeshesAsDirty(function (e) { return e.markAsAttributesDirty() }) }, t.prototype._markAllSubMeshesAsMiscDirty = function () { this._markAllSubMeshesAsDirty(function (e) { return e.markAsMiscDirty() }) }, t.prototype._markAllSubMeshesAsTexturesAndMiscDirty = function () { this._markAllSubMeshesAsDirty(function (e) { e.markAsTexturesDirty(), e.markAsMiscDirty() }) }, t.prototype.dispose = function (e, t) { this.getScene().stopAnimation(this), this.getScene().freeProcessedMaterials(); var i = this._scene.materials.indexOf(this); for (0 <= i && this._scene.materials.splice(i, 1), this._scene.onMaterialRemovedObservable.notifyObservers(this), i = 0; i < this._scene.meshes.length; i++) { var r = this._scene.meshes[i]; if (r.material === this && (r.material = null, r.geometry)) { var n = r.geometry; if (this.storeEffectOnSubMeshes) for (var o = 0, s = r.subMeshes; o < s.length; o++) { var a = s[o]; n._releaseVertexArrayObject(a._materialEffect), e && a._materialEffect && this._scene.getEngine()._releaseEffect(a._materialEffect) } else n._releaseVertexArrayObject(this._effect) } } this._uniformBuffer.dispose(), e && this._effect && (this.storeEffectOnSubMeshes || this._scene.getEngine()._releaseEffect(this._effect), this._effect = null), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear(), this._onBindObservable && this._onBindObservable.clear(), this._onUnBindObservable && this._onUnBindObservable.clear() }, t.prototype.serialize = function () { return e.SerializationHelper.Serialize(this) }, t.ParseMultiMaterial = function (t, i) { var r = new e.MultiMaterial(t.name, i); r.id = t.id, e.Tags && e.Tags.AddTagsTo(r, t.tags); for (var n = 0; n < t.materials.length; n++) { var o = t.materials[n]; o ? r.subMaterials.push(i.getMaterialByID(o)) : r.subMaterials.push(null) } return r }, t.Parse = function (t, i, r) { return t.customType && "BABYLON.StandardMaterial" !== t.customType ? "BABYLON.PBRMaterial" !== t.customType || !t.overloadedAlbedo || (t.customType = "BABYLON.LegacyPBRMaterial", e.LegacyPBRMaterial) ? e.Tools.Instantiate(t.customType).Parse(t, i, r) : void e.Tools.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library.") : e.StandardMaterial.Parse(t, i, r) }, t._TriangleFillMode = 0, t._WireFrameFillMode = 1, t._PointFillMode = 2, t._PointListDrawMode = 3, t._LineListDrawMode = 4, t._LineLoopDrawMode = 5, t._LineStripDrawMode = 6, t._TriangleStripDrawMode = 7, t._TriangleFanDrawMode = 8, t._ClockWiseSideOrientation = 0, t._CounterClockWiseSideOrientation = 1, t.TextureDirtyFlag = 1, t.LightDirtyFlag = 2, t.FresnelDirtyFlag = 4, t.AttributesDirtyFlag = 8, t.MiscDirtyFlag = 16, t.AllDirtyFlag = 31, b([e.serialize()], t.prototype, "id", void 0), b([e.serialize()], t.prototype, "uniqueId", void 0), b([e.serialize()], t.prototype, "name", void 0), b([e.serialize()], t.prototype, "checkReadyOnEveryCall", void 0), b([e.serialize()], t.prototype, "checkReadyOnlyOnce", void 0), b([e.serialize()], t.prototype, "state", void 0), b([e.serialize("alpha")], t.prototype, "_alpha", void 0), b([e.serialize("backFaceCulling")], t.prototype, "_backFaceCulling", void 0), b([e.serialize()], t.prototype, "sideOrientation", void 0), b([e.serialize("alphaMode")], t.prototype, "_alphaMode", void 0), b([e.serialize()], t.prototype, "_needDepthPrePass", void 0), b([e.serialize()], t.prototype, "disableDepthWrite", void 0), b([e.serialize()], t.prototype, "forceDepthWrite", void 0), b([e.serialize()], t.prototype, "separateCullingPass", void 0), b([e.serialize("fogEnabled")], t.prototype, "_fogEnabled", void 0), b([e.serialize()], t.prototype, "pointSize", void 0), b([e.serialize()], t.prototype, "zOffset", void 0), b([e.serialize()], t.prototype, "wireframe", null), b([e.serialize()], t.prototype, "pointsCloud", null), b([e.serialize()], t.prototype, "fillMode", null), t }(); e.Material = i }($a || ($a = {})), le = $a || ($a = {}), ce = function () { function e(e, t, i) { this._engine = e, this._noUBO = !e.supportsUniformBuffers, this._dynamic = i, this._data = t || [], this._uniformLocations = {}, this._uniformSizes = {}, this._uniformLocationPointer = 0, this._needSync = !1, this._noUBO ? (this.updateMatrix3x3 = this._updateMatrix3x3ForEffect, this.updateMatrix2x2 = this._updateMatrix2x2ForEffect, this.updateFloat = this._updateFloatForEffect, this.updateFloat2 = this._updateFloat2ForEffect, this.updateFloat3 = this._updateFloat3ForEffect, this.updateFloat4 = this._updateFloat4ForEffect, this.updateMatrix = this._updateMatrixForEffect, this.updateVector3 = this._updateVector3ForEffect, this.updateVector4 = this._updateVector4ForEffect, this.updateColor3 = this._updateColor3ForEffect, this.updateColor4 = this._updateColor4ForEffect) : (this._engine._uniformBuffers.push(this), this.updateMatrix3x3 = this._updateMatrix3x3ForUniform, this.updateMatrix2x2 = this._updateMatrix2x2ForUniform, this.updateFloat = this._updateFloatForUniform, this.updateFloat2 = this._updateFloat2ForUniform, this.updateFloat3 = this._updateFloat3ForUniform, this.updateFloat4 = this._updateFloat4ForUniform, this.updateMatrix = this._updateMatrixForUniform, this.updateVector3 = this._updateVector3ForUniform, this.updateVector4 = this._updateVector4ForUniform, this.updateColor3 = this._updateColor3ForUniform, this.updateColor4 = this._updateColor4ForUniform) } return Object.defineProperty(e.prototype, "useUbo", { get: function () { return !this._noUBO }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "isSync", { get: function () { return !this._needSync }, enumerable: !0, configurable: !0 }), e.prototype.isDynamic = function () { return void 0 !== this._dynamic }, e.prototype.getData = function () { return this._bufferData }, e.prototype.getBuffer = function () { return this._buffer }, e.prototype._fillAlignment = function (e) { var t; if (t = e <= 2 ? e : 4, this._uniformLocationPointer % t != 0) { var i = this._uniformLocationPointer; this._uniformLocationPointer += t - this._uniformLocationPointer % t; for (var r = this._uniformLocationPointer - i, n = 0; n < r; n++)this._data.push(0) } }, e.prototype.addUniform = function (e, t) { if (!this._noUBO && void 0 === this._uniformLocations[e]) { var i; if (t instanceof Array) t = (i = t).length; else { t = t, i = []; for (var r = 0; r < t; r++)i.push(0) } for (this._fillAlignment(t), this._uniformSizes[e] = t, this._uniformLocations[e] = this._uniformLocationPointer, this._uniformLocationPointer += t, r = 0; r < t; r++)this._data.push(i[r]); this._needSync = !0 } }, e.prototype.addMatrix = function (e, t) { this.addUniform(e, Array.prototype.slice.call(t.toArray())) }, e.prototype.addFloat2 = function (e, t, i) { var r = [t, i]; this.addUniform(e, r) }, e.prototype.addFloat3 = function (e, t, i, r) { var n = [t, i, r]; this.addUniform(e, n) }, e.prototype.addColor3 = function (e, t) { var i = new Array; t.toArray(i), this.addUniform(e, i) }, e.prototype.addColor4 = function (e, t, i) { var r = new Array; t.toArray(r), r.push(i), this.addUniform(e, r) }, e.prototype.addVector3 = function (e, t) { var i = new Array; t.toArray(i), this.addUniform(e, i) }, e.prototype.addMatrix3x3 = function (e) { this.addUniform(e, 12) }, e.prototype.addMatrix2x2 = function (e) { this.addUniform(e, 8) }, e.prototype.create = function () { this._noUBO || this._buffer || (this._fillAlignment(4), this._bufferData = new Float32Array(this._data), this._rebuild(), this._needSync = !0) }, e.prototype._rebuild = function () { this._noUBO || (this._dynamic ? this._buffer = this._engine.createDynamicUniformBuffer(this._bufferData) : this._buffer = this._engine.createUniformBuffer(this._bufferData)) }, e.prototype.update = function () { this._buffer ? (this._dynamic || this._needSync) && (this._engine.updateUniformBuffer(this._buffer, this._bufferData), this._needSync = !1) : this.create() }, e.prototype.updateUniform = function (e, t, i) { var r = this._uniformLocations[e]; if (void 0 === r) { if (this._buffer) return void le.Tools.Error("Cannot add an uniform after UBO has been created."); this.addUniform(e, i), r = this._uniformLocations[e] } if (this._buffer || this.create(), this._dynamic) for (o = 0; o < i; o++)this._bufferData[r + o] = t[o]; else { for (var n = !1, o = 0; o < i; o++)this._bufferData[r + o] !== t[o] && (n = !0, this._bufferData[r + o] = t[o]); this._needSync = this._needSync || n } }, e.prototype._updateMatrix3x3ForUniform = function (t, i) { for (var r = 0; r < 3; r++)e._tempBuffer[4 * r] = i[3 * r], e._tempBuffer[4 * r + 1] = i[3 * r + 1], e._tempBuffer[4 * r + 2] = i[3 * r + 2], e._tempBuffer[4 * r + 3] = 0; this.updateUniform(t, e._tempBuffer, 12) }, e.prototype._updateMatrix3x3ForEffect = function (e, t) { this._currentEffect.setMatrix3x3(e, t) }, e.prototype._updateMatrix2x2ForEffect = function (e, t) { this._currentEffect.setMatrix2x2(e, t) }, e.prototype._updateMatrix2x2ForUniform = function (t, i) { for (var r = 0; r < 2; r++)e._tempBuffer[4 * r] = i[2 * r], e._tempBuffer[4 * r + 1] = i[2 * r + 1], e._tempBuffer[4 * r + 2] = 0, e._tempBuffer[4 * r + 3] = 0; this.updateUniform(t, e._tempBuffer, 8) }, e.prototype._updateFloatForEffect = function (e, t) { this._currentEffect.setFloat(e, t) }, e.prototype._updateFloatForUniform = function (t, i) { e._tempBuffer[0] = i, this.updateUniform(t, e._tempBuffer, 1) }, e.prototype._updateFloat2ForEffect = function (e, t, i, r) { void 0 === r && (r = ""), this._currentEffect.setFloat2(e + r, t, i) }, e.prototype._updateFloat2ForUniform = function (t, i, r, n) { void 0 === n && (n = ""), e._tempBuffer[0] = i, e._tempBuffer[1] = r, this.updateUniform(t, e._tempBuffer, 2) }, e.prototype._updateFloat3ForEffect = function (e, t, i, r, n) { void 0 === n && (n = ""), this._currentEffect.setFloat3(e + n, t, i, r) }, e.prototype._updateFloat3ForUniform = function (t, i, r, n, o) { void 0 === o && (o = ""), e._tempBuffer[0] = i, e._tempBuffer[1] = r, e._tempBuffer[2] = n, this.updateUniform(t, e._tempBuffer, 3) }, e.prototype._updateFloat4ForEffect = function (e, t, i, r, n, o) { void 0 === o && (o = ""), this._currentEffect.setFloat4(e + o, t, i, r, n) }, e.prototype._updateFloat4ForUniform = function (t, i, r, n, o, s) { void 0 === s && (s = ""), e._tempBuffer[0] = i, e._tempBuffer[1] = r, e._tempBuffer[2] = n, e._tempBuffer[3] = o, this.updateUniform(t, e._tempBuffer, 4) }, e.prototype._updateMatrixForEffect = function (e, t) { this._currentEffect.setMatrix(e, t) }, e.prototype._updateMatrixForUniform = function (e, t) { this.updateUniform(e, t.toArray(), 16) }, e.prototype._updateVector3ForEffect = function (e, t) { this._currentEffect.setVector3(e, t) }, e.prototype._updateVector3ForUniform = function (t, i) { i.toArray(e._tempBuffer), this.updateUniform(t, e._tempBuffer, 3) }, e.prototype._updateVector4ForEffect = function (e, t) { this._currentEffect.setVector4(e, t) }, e.prototype._updateVector4ForUniform = function (t, i) { i.toArray(e._tempBuffer), this.updateUniform(t, e._tempBuffer, 4) }, e.prototype._updateColor3ForEffect = function (e, t, i) { void 0 === i && (i = ""), this._currentEffect.setColor3(e + i, t) }, e.prototype._updateColor3ForUniform = function (t, i, r) { void 0 === r && (r = ""), i.toArray(e._tempBuffer), this.updateUniform(t, e._tempBuffer, 3) }, e.prototype._updateColor4ForEffect = function (e, t, i, r) { void 0 === r && (r = ""), this._currentEffect.setColor4(e + r, t, i) }, e.prototype._updateColor4ForUniform = function (t, i, r, n) { void 0 === n && (n = ""), i.toArray(e._tempBuffer), e._tempBuffer[3] = r, this.updateUniform(t, e._tempBuffer, 4) }, e.prototype.setTexture = function (e, t) { this._currentEffect.setTexture(e, t) }, e.prototype.updateUniformDirectly = function (e, t) { this.updateUniform(e, t, t.length), this.update() }, e.prototype.bindToEffect = function (e, t) { this._currentEffect = e, !this._noUBO && this._buffer && e.bindUniformBuffer(this._buffer, t) }, e.prototype.dispose = function () { if (!this._noUBO) { var e = this._engine._uniformBuffers.indexOf(this); -1 !== e && this._engine._uniformBuffers.splice(e, 1), this._buffer && this._engine._releaseBuffer(this._buffer) && (this._buffer = null) } }, e._MAX_UNIFORM_SIZE = 256, e._tempBuffer = new Float32Array(e._MAX_UNIFORM_SIZE), e }(), le.UniformBuffer = ce, he = $a || ($a = {}), ue = function () { function e() { } return e.prototype.set = function (e, t) { switch (t) { case he.VertexBuffer.PositionKind: this.positions = e; break; case he.VertexBuffer.NormalKind: this.normals = e; break; case he.VertexBuffer.TangentKind: this.tangents = e; break; case he.VertexBuffer.UVKind: this.uvs = e; break; case he.VertexBuffer.UV2Kind: this.uvs2 = e; break; case he.VertexBuffer.UV3Kind: this.uvs3 = e; break; case he.VertexBuffer.UV4Kind: this.uvs4 = e; break; case he.VertexBuffer.UV5Kind: this.uvs5 = e; break; case he.VertexBuffer.UV6Kind: this.uvs6 = e; break; case he.VertexBuffer.ColorKind: this.colors = e; break; case he.VertexBuffer.MatricesIndicesKind: this.matricesIndices = e; break; case he.VertexBuffer.MatricesWeightsKind: this.matricesWeights = e; break; case he.VertexBuffer.MatricesIndicesExtraKind: this.matricesIndicesExtra = e; break; case he.VertexBuffer.MatricesWeightsExtraKind: this.matricesWeightsExtra = e } }, e.prototype.applyToMesh = function (e, t) { return this._applyTo(e, t), this }, e.prototype.applyToGeometry = function (e, t) { return this._applyTo(e, t), this }, e.prototype.updateMesh = function (e, t, i) { return this._update(e), this }, e.prototype.updateGeometry = function (e, t, i) { return this._update(e), this }, e.prototype._applyTo = function (e, t) { return void 0 === t && (t = !1), this.positions && e.setVerticesData(he.VertexBuffer.PositionKind, this.positions, t), this.normals && e.setVerticesData(he.VertexBuffer.NormalKind, this.normals, t), this.tangents && e.setVerticesData(he.VertexBuffer.TangentKind, this.tangents, t), this.uvs && e.setVerticesData(he.VertexBuffer.UVKind, this.uvs, t), this.uvs2 && e.setVerticesData(he.VertexBuffer.UV2Kind, this.uvs2, t), this.uvs3 && e.setVerticesData(he.VertexBuffer.UV3Kind, this.uvs3, t), this.uvs4 && e.setVerticesData(he.VertexBuffer.UV4Kind, this.uvs4, t), this.uvs5 && e.setVerticesData(he.VertexBuffer.UV5Kind, this.uvs5, t), this.uvs6 && e.setVerticesData(he.VertexBuffer.UV6Kind, this.uvs6, t), this.colors && e.setVerticesData(he.VertexBuffer.ColorKind, this.colors, t), this.matricesIndices && e.setVerticesData(he.VertexBuffer.MatricesIndicesKind, this.matricesIndices, t), this.matricesWeights && e.setVerticesData(he.VertexBuffer.MatricesWeightsKind, this.matricesWeights, t), this.matricesIndicesExtra && e.setVerticesData(he.VertexBuffer.MatricesIndicesExtraKind, this.matricesIndicesExtra, t), this.matricesWeightsExtra && e.setVerticesData(he.VertexBuffer.MatricesWeightsExtraKind, this.matricesWeightsExtra, t), this.indices ? e.setIndices(this.indices, null, t) : e.setIndices([], null), this }, e.prototype._update = function (e, t, i) { return this.positions && e.updateVerticesData(he.VertexBuffer.PositionKind, this.positions, t, i), this.normals && e.updateVerticesData(he.VertexBuffer.NormalKind, this.normals, t, i), this.tangents && e.updateVerticesData(he.VertexBuffer.TangentKind, this.tangents, t, i), this.uvs && e.updateVerticesData(he.VertexBuffer.UVKind, this.uvs, t, i), this.uvs2 && e.updateVerticesData(he.VertexBuffer.UV2Kind, this.uvs2, t, i), this.uvs3 && e.updateVerticesData(he.VertexBuffer.UV3Kind, this.uvs3, t, i), this.uvs4 && e.updateVerticesData(he.VertexBuffer.UV4Kind, this.uvs4, t, i), this.uvs5 && e.updateVerticesData(he.VertexBuffer.UV5Kind, this.uvs5, t, i), this.uvs6 && e.updateVerticesData(he.VertexBuffer.UV6Kind, this.uvs6, t, i), this.colors && e.updateVerticesData(he.VertexBuffer.ColorKind, this.colors, t, i), this.matricesIndices && e.updateVerticesData(he.VertexBuffer.MatricesIndicesKind, this.matricesIndices, t, i), this.matricesWeights && e.updateVerticesData(he.VertexBuffer.MatricesWeightsKind, this.matricesWeights, t, i), this.matricesIndicesExtra && e.updateVerticesData(he.VertexBuffer.MatricesIndicesExtraKind, this.matricesIndicesExtra, t, i), this.matricesWeightsExtra && e.updateVerticesData(he.VertexBuffer.MatricesWeightsExtraKind, this.matricesWeightsExtra, t, i), this.indices && e.setIndices(this.indices, null), this }, e.prototype.transform = function (e) { var t, i = e.m[0] * e.m[5] * e.m[10] < 0, r = he.Vector3.Zero(); if (this.positions) { var n = he.Vector3.Zero(); for (t = 0; t < this.positions.length; t += 3)he.Vector3.FromArrayToRef(this.positions, t, n), he.Vector3.TransformCoordinatesToRef(n, e, r), this.positions[t] = r.x, this.positions[t + 1] = r.y, this.positions[t + 2] = r.z } if (this.normals) { var o = he.Vector3.Zero(); for (t = 0; t < this.normals.length; t += 3)he.Vector3.FromArrayToRef(this.normals, t, o), he.Vector3.TransformNormalToRef(o, e, r), this.normals[t] = r.x, this.normals[t + 1] = r.y, this.normals[t + 2] = r.z } if (this.tangents) { var s = he.Vector4.Zero(), a = he.Vector4.Zero(); for (t = 0; t < this.tangents.length; t += 4)he.Vector4.FromArrayToRef(this.tangents, t, s), he.Vector4.TransformNormalToRef(s, e, a), this.tangents[t] = a.x, this.tangents[t + 1] = a.y, this.tangents[t + 2] = a.z, this.tangents[t + 3] = a.w } if (i && this.indices) for (t = 0; t < this.indices.length; t += 3) { var l = this.indices[t + 1]; this.indices[t + 1] = this.indices[t + 2], this.indices[t + 2] = l } return this }, e.prototype.merge = function (e, t) { if (void 0 === t && (t = !1), this._validate(), e._validate(), !this.normals != !e.normals || !this.tangents != !e.tangents || !this.uvs != !e.uvs || !this.uvs2 != !e.uvs2 || !this.uvs3 != !e.uvs3 || !this.uvs4 != !e.uvs4 || !this.uvs5 != !e.uvs5 || !this.uvs6 != !e.uvs6 || !this.colors != !e.colors || !this.matricesIndices != !e.matricesIndices || !this.matricesWeights != !e.matricesWeights || !this.matricesIndicesExtra != !e.matricesIndicesExtra || !this.matricesWeightsExtra != !e.matricesWeightsExtra) throw new Error("Cannot merge vertex data that do not have the same set of attributes"); if (e.indices) { this.indices || (this.indices = []); var i = this.positions ? this.positions.length / 3 : 0; if (void 0 !== this.indices.BYTES_PER_ELEMENT) { var r = this.indices.length + e.indices.length, n = t || this.indices instanceof Uint32Array ? new Uint32Array(r) : new Uint16Array(r); n.set(this.indices); for (var o = this.indices.length, s = 0; s < e.indices.length; s++)n[o + s] = e.indices[s] + i; this.indices = n } else for (s = 0; s < e.indices.length; s++)this.indices.push(e.indices[s] + i) } return this.positions = this._mergeElement(this.positions, e.positions), this.normals = this._mergeElement(this.normals, e.normals), this.tangents = this._mergeElement(this.tangents, e.tangents), this.uvs = this._mergeElement(this.uvs, e.uvs), this.uvs2 = this._mergeElement(this.uvs2, e.uvs2), this.uvs3 = this._mergeElement(this.uvs3, e.uvs3), this.uvs4 = this._mergeElement(this.uvs4, e.uvs4), this.uvs5 = this._mergeElement(this.uvs5, e.uvs5), this.uvs6 = this._mergeElement(this.uvs6, e.uvs6), this.colors = this._mergeElement(this.colors, e.colors), this.matricesIndices = this._mergeElement(this.matricesIndices, e.matricesIndices), this.matricesWeights = this._mergeElement(this.matricesWeights, e.matricesWeights), this.matricesIndicesExtra = this._mergeElement(this.matricesIndicesExtra, e.matricesIndicesExtra), this.matricesWeightsExtra = this._mergeElement(this.matricesWeightsExtra, e.matricesWeightsExtra), this }, e.prototype._mergeElement = function (e, t) { if (!e) return t; if (!t) return e; var i = t.length + e.length, r = e instanceof Float32Array, n = t instanceof Float32Array; if (r) { var o = new Float32Array(i); return o.set(e), o.set(t, e.length), o } if (n) { var s = e.slice(0), a = 0; for (i = t.length; a < i; a++)s.push(t[a]); return s } return e.concat(t) }, e.prototype._validate = function () { if (!this.positions) throw new Error("Positions are required"); var e = function (e, t) { var i = he.VertexBuffer.DeduceStride(e); if (t.length % i != 0) throw new Error("The " + e + "s array count must be a multiple of " + i); return t.length / i }, t = e(he.VertexBuffer.PositionKind, this.positions), i = function (i, r) { var n = e(i, r); if (n !== t) throw new Error("The " + i + "s element count (" + n + ") does not match the positions count (" + t + ")") }; this.normals && i(he.VertexBuffer.NormalKind, this.normals), this.tangents && i(he.VertexBuffer.TangentKind, this.tangents), this.uvs && i(he.VertexBuffer.UVKind, this.uvs), this.uvs2 && i(he.VertexBuffer.UV2Kind, this.uvs2), this.uvs3 && i(he.VertexBuffer.UV3Kind, this.uvs3), this.uvs4 && i(he.VertexBuffer.UV4Kind, this.uvs4), this.uvs5 && i(he.VertexBuffer.UV5Kind, this.uvs5), this.uvs6 && i(he.VertexBuffer.UV6Kind, this.uvs6), this.colors && i(he.VertexBuffer.ColorKind, this.colors), this.matricesIndices && i(he.VertexBuffer.MatricesIndicesKind, this.matricesIndices), this.matricesWeights && i(he.VertexBuffer.MatricesWeightsKind, this.matricesWeights), this.matricesIndicesExtra && i(he.VertexBuffer.MatricesIndicesExtraKind, this.matricesIndicesExtra), this.matricesWeightsExtra && i(he.VertexBuffer.MatricesWeightsExtraKind, this.matricesWeightsExtra) }, e.prototype.serialize = function () { var e = this.serialize(); return this.positions && (e.positions = this.positions), this.normals && (e.normals = this.normals), this.tangents && (e.tangents = this.tangents), this.uvs && (e.uvs = this.uvs), this.uvs2 && (e.uvs2 = this.uvs2), this.uvs3 && (e.uvs3 = this.uvs3), this.uvs4 && (e.uvs4 = this.uvs4), this.uvs5 && (e.uvs5 = this.uvs5), this.uvs6 && (e.uvs6 = this.uvs6), this.colors && (e.colors = this.colors), this.matricesIndices && (e.matricesIndices = this.matricesIndices, e.matricesIndices._isExpanded = !0), this.matricesWeights && (e.matricesWeights = this.matricesWeights), this.matricesIndicesExtra && (e.matricesIndicesExtra = this.matricesIndicesExtra, e.matricesIndicesExtra._isExpanded = !0), this.matricesWeightsExtra && (e.matricesWeightsExtra = this.matricesWeightsExtra), e.indices = this.indices, e }, e.ExtractFromMesh = function (t, i, r) { return e._ExtractFrom(t, i, r) }, e.ExtractFromGeometry = function (t, i, r) { return e._ExtractFrom(t, i, r) }, e._ExtractFrom = function (t, i, r) { var n = new e; return t.isVerticesDataPresent(he.VertexBuffer.PositionKind) && (n.positions = t.getVerticesData(he.VertexBuffer.PositionKind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.NormalKind) && (n.normals = t.getVerticesData(he.VertexBuffer.NormalKind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.TangentKind) && (n.tangents = t.getVerticesData(he.VertexBuffer.TangentKind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.UVKind) && (n.uvs = t.getVerticesData(he.VertexBuffer.UVKind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.UV2Kind) && (n.uvs2 = t.getVerticesData(he.VertexBuffer.UV2Kind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.UV3Kind) && (n.uvs3 = t.getVerticesData(he.VertexBuffer.UV3Kind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.UV4Kind) && (n.uvs4 = t.getVerticesData(he.VertexBuffer.UV4Kind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.UV5Kind) && (n.uvs5 = t.getVerticesData(he.VertexBuffer.UV5Kind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.UV6Kind) && (n.uvs6 = t.getVerticesData(he.VertexBuffer.UV6Kind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.ColorKind) && (n.colors = t.getVerticesData(he.VertexBuffer.ColorKind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.MatricesIndicesKind) && (n.matricesIndices = t.getVerticesData(he.VertexBuffer.MatricesIndicesKind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.MatricesWeightsKind) && (n.matricesWeights = t.getVerticesData(he.VertexBuffer.MatricesWeightsKind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.MatricesIndicesExtraKind) && (n.matricesIndicesExtra = t.getVerticesData(he.VertexBuffer.MatricesIndicesExtraKind, i, r)), t.isVerticesDataPresent(he.VertexBuffer.MatricesWeightsExtraKind) && (n.matricesWeightsExtra = t.getVerticesData(he.VertexBuffer.MatricesWeightsExtraKind, i, r)), n.indices = t.getIndices(i, r), n }, e.CreateRibbon = function (t) { var i = t.pathArray, r = t.closeArray || !1, n = t.closePath || !1, o = t.invertUV || !1, s = Math.floor(i[0].length / 2), a = t.offset || s; a = s < a ? s : Math.floor(a); var l, c, h, u, d = 0 === t.sideOrientation ? 0 : t.sideOrientation || he.Mesh.DEFAULTSIDE, f = t.uvs, p = t.colors, _ = [], m = [], g = [], v = [], y = [], b = [], T = [], E = [], x = [], P = []; if (i.length < 2) { var A = [], S = []; for (h = 0; h < i[0].length - a; h++)A.push(i[0][h]), S.push(i[0][h + a]); i = [A, S] } var M, R, C, O, D, I = 0, w = n ? 1 : 0; for (l = i[0].length, c = 0; c < i.length; c++) { for (T[c] = 0, y[c] = [0], l = l < (R = (M = i[c]).length) ? l : R, u = 0; u < R;)_.push(M[u].x, M[u].y, M[u].z), 0 < u && (C = M[u].subtract(M[u - 1]).length() + T[c], y[c].push(C), T[c] = C), u++; n && (u-- , _.push(M[0].x, M[0].y, M[0].z), C = M[u].subtract(M[0]).length() + T[c], y[c].push(C), T[c] = C), x[c] = R + w, P[c] = I, I += R + w } var L, F, B = null, N = null; for (h = 0; h < l + w; h++) { for (E[h] = 0, b[h] = [0], c = 0; c < i.length - 1; c++)O = i[c], D = i[c + 1], h === l ? (B = O[0], N = D[0]) : (B = O[h], N = D[h]), C = N.subtract(B).length() + E[h], b[h].push(C), E[h] = C; r && N && B && (O = i[c], D = i[0], h === l && (N = D[0]), C = N.subtract(B).length() + E[h], E[h] = C) } if (f) for (c = 0; c < f.length; c++)v.push(f[c].x, f[c].y); else for (c = 0; c < i.length; c++)for (h = 0; h < l + w; h++)L = 0 != T[c] ? y[c][h] / T[c] : 0, F = 0 != E[h] ? b[h][c] / E[h] : 0, o ? v.push(F, L) : v.push(L, F); for (var V = c = 0, U = x[c] - 1, z = x[c + 1] - 1, G = U < z ? U : z, k = P[1] - P[0], W = r ? x.length : x.length - 1; V <= G && c < W;)m.push(V, V + k, V + 1), m.push(V + k + 1, V + 1, V + k), (V += 1) === G && (++c == x.length - 1 ? (k = P[0] - P[c], U = x[c] - 1, z = x[0] - 1) : (k = P[c + 1] - P[c], U = x[c] - 1, z = x[c + 1] - 1), V = P[c], G = U < z ? U + V : z + V); if (e.ComputeNormals(_, m, g), n) { var H = 0, X = 0; for (c = 0; c < i.length; c++)H = 3 * P[c], X = c + 1 < i.length ? 3 * (P[c + 1] - 1) : g.length - 3, g[H] = .5 * (g[H] + g[X]), g[H + 1] = .5 * (g[H + 1] + g[X + 1]), g[H + 2] = .5 * (g[H + 2] + g[X + 2]), g[X] = g[H], g[X + 1] = g[H + 1], g[X + 2] = g[H + 2] } e._ComputeSides(d, _, m, g, v, t.frontUVs, t.backUVs); var j = null; if (p) { j = new Float32Array(4 * p.length); for (var Y = 0; Y < p.length; Y++)j[4 * Y] = p[Y].r, j[4 * Y + 1] = p[Y].g, j[4 * Y + 2] = p[Y].b, j[4 * Y + 3] = p[Y].a } var K = new e, Q = new Float32Array(_), Z = new Float32Array(g), q = new Float32Array(v); return K.indices = m, K.positions = Q, K.normals = Z, K.uvs = q, j && K.set(j, he.VertexBuffer.ColorKind), n && (K._idx = P), K }, e.CreateBox = function (t) { for (var i = [new he.Vector3(0, 0, 1), new he.Vector3(0, 0, -1), new he.Vector3(1, 0, 0), new he.Vector3(-1, 0, 0), new he.Vector3(0, 1, 0), new he.Vector3(0, -1, 0)], r = [], n = [], o = [], s = [], a = t.width || t.size || 1, l = t.height || t.size || 1, c = t.depth || t.size || 1, h = 0 === t.sideOrientation ? 0 : t.sideOrientation || he.Mesh.DEFAULTSIDE, u = t.faceUV || new Array(6), d = t.faceColors, f = [], p = 0; p < 6; p++)void 0 === u[p] && (u[p] = new he.Vector4(0, 0, 1, 1)), d && void 0 === d[p] && (d[p] = new he.Color4(1, 1, 1, 1)); for (var _ = new he.Vector3(a / 2, l / 2, c / 2), m = 0; m < i.length; m++) { var g = i[m], v = new he.Vector3(g.y, g.z, g.x), y = he.Vector3.Cross(g, v), b = n.length / 3; r.push(b), r.push(b + 1), r.push(b + 2), r.push(b), r.push(b + 2), r.push(b + 3); var T = g.subtract(v).subtract(y).multiply(_); n.push(T.x, T.y, T.z), o.push(g.x, g.y, g.z), s.push(u[m].z, u[m].w), d && f.push(d[m].r, d[m].g, d[m].b, d[m].a), T = g.subtract(v).add(y).multiply(_), n.push(T.x, T.y, T.z), o.push(g.x, g.y, g.z), s.push(u[m].x, u[m].w), d && f.push(d[m].r, d[m].g, d[m].b, d[m].a), T = g.add(v).add(y).multiply(_), n.push(T.x, T.y, T.z), o.push(g.x, g.y, g.z), s.push(u[m].x, u[m].y), d && f.push(d[m].r, d[m].g, d[m].b, d[m].a), T = g.add(v).subtract(y).multiply(_), n.push(T.x, T.y, T.z), o.push(g.x, g.y, g.z), s.push(u[m].z, u[m].y), d && f.push(d[m].r, d[m].g, d[m].b, d[m].a) } e._ComputeSides(h, n, r, o, s, t.frontUVs, t.backUVs); var E = new e; if (E.indices = r, E.positions = n, E.normals = o, E.uvs = s, d) { var x = h === he.Mesh.DOUBLESIDE ? f.concat(f) : f; E.colors = x } return E }, e.CreateSphere = function (t) { for (var i = t.segments || 32, r = t.diameterX || t.diameter || 1, n = t.diameterY || t.diameter || 1, o = t.diameterZ || t.diameter || 1, s = t.arc && (t.arc <= 0 || 1 < t.arc) ? 1 : t.arc || 1, a = t.slice && t.slice <= 0 ? 1 : t.slice || 1, l = 0 === t.sideOrientation ? 0 : t.sideOrientation || he.Mesh.DEFAULTSIDE, c = new he.Vector3(r / 2, n / 2, o / 2), h = 2 + i, u = 2 * h, d = [], f = [], p = [], _ = [], m = 0; m <= h; m++) { for (var g = m / h, v = g * Math.PI * a, y = 0; y <= u; y++) { var b = y / u, T = b * Math.PI * 2 * s, E = he.Matrix.RotationZ(-v), x = he.Matrix.RotationY(T), P = he.Vector3.TransformCoordinates(he.Vector3.Up(), E), A = he.Vector3.TransformCoordinates(P, x), S = A.multiply(c), M = A.divide(c).normalize(); f.push(S.x, S.y, S.z), p.push(M.x, M.y, M.z), _.push(b, g) } if (0 < m) for (var R = f.length / 3, C = R - 2 * (u + 1); C + u + 2 < R; C++)d.push(C), d.push(C + 1), d.push(C + u + 1), d.push(C + u + 1), d.push(C + 1), d.push(C + u + 2) } e._ComputeSides(l, f, d, p, _, t.frontUVs, t.backUVs); var O = new e; return O.indices = d, O.positions = f, O.normals = p, O.uvs = _, O }, e.CreateCylinder = function (t) { var i, r = t.height || 2, n = 0 === t.diameterTop ? 0 : t.diameterTop || t.diameter || 1, o = 0 === t.diameterBottom ? 0 : t.diameterBottom || t.diameter || 1, s = t.tessellation || 24, a = t.subdivisions || 1, l = !!t.hasRings, c = !!t.enclose, h = t.arc && (t.arc <= 0 || 1 < t.arc) ? 1 : t.arc || 1, u = 0 === t.sideOrientation ? 0 : t.sideOrientation || he.Mesh.DEFAULTSIDE, d = t.faceUV || new Array(3), f = t.faceColors, p = 2 + (1 + (1 !== h && c ? 2 : 0)) * (l ? a : 1); for (i = 0; i < p; i++)f && void 0 === f[i] && (f[i] = new he.Color4(1, 1, 1, 1)); for (i = 0; i < p; i++)d && void 0 === d[i] && (d[i] = new he.Vector4(0, 0, 1, 1)); var _, m, g, v, y, b, T = new Array, E = new Array, x = new Array, P = new Array, A = new Array, S = 2 * Math.PI * h / s, M = (o - n) / 2 / r, R = he.Vector3.Zero(), C = he.Vector3.Zero(), O = he.Vector3.Zero(), D = he.Vector3.Zero(), I = he.Vector3.Zero(), w = he.Axis.Y, L = 1, F = 1, B = 0, N = 0; for (v = 0; v <= a; v++)for (g = ((m = v / a) * (n - o) + o) / 2, L = l && 0 !== v && v !== a ? 2 : 1, b = 0; b < L; b++) { for (l && (F += b), c && (F += 2 * b), y = 0; y <= s; y++)_ = y * S, R.x = Math.cos(-_) * g, R.y = -r / 2 + m * r, R.z = Math.sin(-_) * g, 0 === n && v === a ? (C.x = x[x.length - 3 * (s + 1)], C.y = x[x.length - 3 * (s + 1) + 1], C.z = x[x.length - 3 * (s + 1) + 2]) : (C.x = R.x, C.z = R.z, C.y = Math.sqrt(C.x * C.x + C.z * C.z) * M, C.normalize()), 0 === y && (O.copyFrom(R), D.copyFrom(C)), E.push(R.x, R.y, R.z), x.push(C.x, C.y, C.z), N = l ? B !== F ? d[F].y : d[F].w : d[F].y + (d[F].w - d[F].y) * m, P.push(d[F].x + (d[F].z - d[F].x) * y / s, N), f && A.push(f[F].r, f[F].g, f[F].b, f[F].a); 1 !== h && c && (E.push(R.x, R.y, R.z), E.push(0, R.y, 0), E.push(0, R.y, 0), E.push(O.x, O.y, O.z), he.Vector3.CrossToRef(w, C, I), I.normalize(), x.push(I.x, I.y, I.z, I.x, I.y, I.z), he.Vector3.CrossToRef(D, w, I), I.normalize(), x.push(I.x, I.y, I.z, I.x, I.y, I.z), N = l ? B !== F ? d[F + 1].y : d[F + 1].w : d[F + 1].y + (d[F + 1].w - d[F + 1].y) * m, P.push(d[F + 1].x, N), P.push(d[F + 1].z, N), N = l ? B !== F ? d[F + 2].y : d[F + 2].w : d[F + 2].y + (d[F + 2].w - d[F + 2].y) * m, P.push(d[F + 2].x, N), P.push(d[F + 2].z, N), f && (A.push(f[F + 1].r, f[F + 1].g, f[F + 1].b, f[F + 1].a), A.push(f[F + 1].r, f[F + 1].g, f[F + 1].b, f[F + 1].a), A.push(f[F + 2].r, f[F + 2].g, f[F + 2].b, f[F + 2].a), A.push(f[F + 2].r, f[F + 2].g, f[F + 2].b, f[F + 2].a))), B !== F && (B = F) } var V = 1 !== h && c ? s + 4 : s; for (F = v = 0; F < a; F++) { var U = 0, z = 0, G = 0, k = 0; for (y = 0; y < s; y++)U = v * (V + 1) + y, z = (v + 1) * (V + 1) + y, G = v * (V + 1) + (y + 1), k = (v + 1) * (V + 1) + (y + 1), T.push(U, z, G), T.push(k, G, z); 1 !== h && c && (T.push(U + 2, z + 2, G + 2), T.push(k + 2, G + 2, z + 2), T.push(U + 4, z + 4, G + 4), T.push(k + 4, G + 4, z + 4)), v = l ? v + 2 : v + 1 } var W = function (e) { var t = e ? n / 2 : o / 2; if (0 !== t) { var i, a, l, c = e ? d[p - 1] : d[0], u = null; f && (u = e ? f[p - 1] : f[0]); var _ = E.length / 3, m = e ? r / 2 : -r / 2, g = new he.Vector3(0, m, 0); E.push(g.x, g.y, g.z), x.push(0, e ? 1 : -1, 0), P.push(c.x + .5 * (c.z - c.x), c.y + .5 * (c.w - c.y)), u && A.push(u.r, u.g, u.b, u.a); var v = new he.Vector2(.5, .5); for (l = 0; l <= s; l++) { i = 2 * Math.PI * l * h / s; var y = Math.cos(-i), b = Math.sin(-i); a = new he.Vector3(y * t, m, b * t); var S = new he.Vector2(y * v.x + .5, b * v.y + .5); E.push(a.x, a.y, a.z), x.push(0, e ? 1 : -1, 0), P.push(c.x + (c.z - c.x) * S.x, c.y + (c.w - c.y) * S.y), u && A.push(u.r, u.g, u.b, u.a) } for (l = 0; l < s; l++)e ? (T.push(_), T.push(_ + (l + 2)), T.push(_ + (l + 1))) : (T.push(_), T.push(_ + (l + 1)), T.push(_ + (l + 2))) } }; W(!1), W(!0), e._ComputeSides(u, E, T, x, P, t.frontUVs, t.backUVs); var H = new e; return H.indices = T, H.positions = E, H.normals = x, H.uvs = P, f && (H.colors = A), H }, e.CreateTorus = function (t) { for (var i = [], r = [], n = [], o = [], s = t.diameter || 1, a = t.thickness || .5, l = t.tessellation || 16, c = 0 === t.sideOrientation ? 0 : t.sideOrientation || he.Mesh.DEFAULTSIDE, h = l + 1, u = 0; u <= l; u++)for (var d = u / l, f = u * Math.PI * 2 / l - Math.PI / 2, p = he.Matrix.Translation(s / 2, 0, 0).multiply(he.Matrix.RotationY(f)), _ = 0; _ <= l; _++) { var m = 1 - _ / l, g = _ * Math.PI * 2 / l + Math.PI, v = Math.cos(g), y = Math.sin(g), b = new he.Vector3(v, y, 0), T = b.scale(a / 2), E = new he.Vector2(d, m); T = he.Vector3.TransformCoordinates(T, p), b = he.Vector3.TransformNormal(b, p), r.push(T.x, T.y, T.z), n.push(b.x, b.y, b.z), o.push(E.x, E.y); var x = (u + 1) % h, P = (_ + 1) % h; i.push(u * h + _), i.push(u * h + P), i.push(x * h + _), i.push(u * h + P), i.push(x * h + P), i.push(x * h + _) } e._ComputeSides(c, r, i, n, o, t.frontUVs, t.backUVs); var A = new e; return A.indices = i, A.positions = r, A.normals = n, A.uvs = o, A }, e.CreateLineSystem = function (t) { for (var i = [], r = [], n = t.lines, o = t.colors, s = [], a = 0, l = 0; l < n.length; l++)for (var c = n[l], h = 0; h < c.length; h++) { if (r.push(c[h].x, c[h].y, c[h].z), o) { var u = o[l]; s.push(u[h].r, u[h].g, u[h].b, u[h].a) } 0 < h && (i.push(a - 1), i.push(a)), a++ } var d = new e; return d.indices = i, d.positions = r, o && (d.colors = s), d }, e.CreateDashedLines = function (t) { var i, r, n = t.dashSize || 3, o = t.gapSize || 1, s = t.dashNb || 200, a = t.points, l = new Array, c = new Array, h = he.Vector3.Zero(), u = 0, d = 0, f = 0, p = 0, _ = 0; for (_ = 0; _ < a.length - 1; _++)a[_ + 1].subtractToRef(a[_], h), u += h.length(); for (r = n * (i = u / s) / (n + o), _ = 0; _ < a.length - 1; _++) { a[_ + 1].subtractToRef(a[_], h), d = Math.floor(h.length() / i), h.normalize(); for (var m = 0; m < d; m++)f = i * m, l.push(a[_].x + f * h.x, a[_].y + f * h.y, a[_].z + f * h.z), l.push(a[_].x + (f + r) * h.x, a[_].y + (f + r) * h.y, a[_].z + (f + r) * h.z), c.push(p, p + 1), p += 2 } var g = new e; return g.positions = l, g.indices = c, g }, e.CreateGround = function (t) { var i, r, n = [], o = [], s = [], a = [], l = t.width || 1, c = t.height || 1, h = t.subdivisionsX || t.subdivisions || 1, u = t.subdivisionsY || t.subdivisions || 1; for (i = 0; i <= u; i++)for (r = 0; r <= h; r++) { var d = new he.Vector3(r * l / h - l / 2, 0, (u - i) * c / u - c / 2), f = new he.Vector3(0, 1, 0); o.push(d.x, d.y, d.z), s.push(f.x, f.y, f.z), a.push(r / h, 1 - i / u) } for (i = 0; i < u; i++)for (r = 0; r < h; r++)n.push(r + 1 + (i + 1) * (h + 1)), n.push(r + 1 + i * (h + 1)), n.push(r + i * (h + 1)), n.push(r + (i + 1) * (h + 1)), n.push(r + 1 + (i + 1) * (h + 1)), n.push(r + i * (h + 1)); var p = new e; return p.indices = n, p.positions = o, p.normals = s, p.uvs = a, p }, e.CreateTiledGround = function (t) { var i, r, n, o, s = void 0 !== t.xmin && null !== t.xmin ? t.xmin : -1, a = void 0 !== t.zmin && null !== t.zmin ? t.zmin : -1, l = void 0 !== t.xmax && null !== t.xmax ? t.xmax : 1, c = void 0 !== t.zmax && null !== t.zmax ? t.zmax : 1, h = t.subdivisions || { w: 1, h: 1 }, u = t.precision || { w: 1, h: 1 }, d = new Array, f = new Array, p = new Array, _ = new Array; h.h = h.h < 1 ? 1 : h.h, h.w = h.w < 1 ? 1 : h.w, u.w = u.w < 1 ? 1 : u.w, u.h = u.h < 1 ? 1 : u.h; var m = (l - s) / h.w, g = (c - a) / h.h; function v(e, t, n, o) { var s = f.length / 3, a = u.w + 1; for (i = 0; i < u.h; i++)for (r = 0; r < u.w; r++) { var l = [s + r + i * a, s + (r + 1) + i * a, s + (r + 1) + (i + 1) * a, s + r + (i + 1) * a]; d.push(l[1]), d.push(l[2]), d.push(l[3]), d.push(l[0]), d.push(l[1]), d.push(l[3]) } var c = he.Vector3.Zero(), h = new he.Vector3(0, 1, 0); for (i = 0; i <= u.h; i++)for (c.z = i * (o - t) / u.h + t, r = 0; r <= u.w; r++)c.x = r * (n - e) / u.w + e, c.y = 0, f.push(c.x, c.y, c.z), p.push(h.x, h.y, h.z), _.push(r / u.w, i / u.h) } for (n = 0; n < h.h; n++)for (o = 0; o < h.w; o++)v(s + o * m, a + n * g, s + (o + 1) * m, a + (n + 1) * g); var y = new e; return y.indices = d, y.positions = f, y.normals = p, y.uvs = _, y }, e.CreateGroundFromHeightMap = function (t) { var i, r, n = [], o = [], s = [], a = [], l = t.colorFilter || new he.Color3(.3, .59, .11), c = t.alphaFilter || 0; for (i = 0; i <= t.subdivisions; i++)for (r = 0; r <= t.subdivisions; r++) { var h = new he.Vector3(r * t.width / t.subdivisions - t.width / 2, 0, (t.subdivisions - i) * t.height / t.subdivisions - t.height / 2), u = 4 * (((h.x + t.width / 2) / t.width * (t.bufferWidth - 1) | 0) + ((1 - (h.z + t.height / 2) / t.height) * (t.bufferHeight - 1) | 0) * t.bufferWidth), d = t.buffer[u] / 255, f = t.buffer[u + 1] / 255, p = t.buffer[u + 2] / 255, _ = t.buffer[u + 3] / 255, m = d * l.r + f * l.g + p * l.b; h.y = c <= _ ? t.minHeight + (t.maxHeight - t.minHeight) * m : t.minHeight - he.Epsilon, o.push(h.x, h.y, h.z), s.push(0, 0, 0), a.push(r / t.subdivisions, 1 - i / t.subdivisions) } for (i = 0; i < t.subdivisions; i++)for (r = 0; r < t.subdivisions; r++) { var g = r + 1 + (i + 1) * (t.subdivisions + 1), v = r + 1 + i * (t.subdivisions + 1), y = r + i * (t.subdivisions + 1), b = r + (i + 1) * (t.subdivisions + 1), T = o[3 * g + 1] >= t.minHeight, E = o[3 * v + 1] >= t.minHeight, x = o[3 * y + 1] >= t.minHeight; T && E && x && (n.push(g), n.push(v), n.push(y)), o[3 * b + 1] >= t.minHeight && T && x && (n.push(b), n.push(g), n.push(y)) } e.ComputeNormals(o, n, s); var P = new e; return P.indices = n, P.positions = o, P.normals = s, P.uvs = a, P }, e.CreatePlane = function (t) { var i = [], r = [], n = [], o = [], s = t.width || t.size || 1, a = t.height || t.size || 1, l = 0 === t.sideOrientation ? 0 : t.sideOrientation || he.Mesh.DEFAULTSIDE, c = s / 2, h = a / 2; r.push(-c, -h, 0), n.push(0, 0, -1), o.push(0, 0), r.push(c, -h, 0), n.push(0, 0, -1), o.push(1, 0), r.push(c, h, 0), n.push(0, 0, -1), o.push(1, 1), r.push(-c, h, 0), n.push(0, 0, -1), o.push(0, 1), i.push(0), i.push(1), i.push(2), i.push(0), i.push(2), i.push(3), e._ComputeSides(l, r, i, n, o, t.frontUVs, t.backUVs); var u = new e; return u.indices = i, u.positions = r, u.normals = n, u.uvs = o, u }, e.CreateDisc = function (t) { var i = new Array, r = new Array, n = new Array, o = new Array, s = t.radius || .5, a = t.tessellation || 64, l = t.arc && (t.arc <= 0 || 1 < t.arc) ? 1 : t.arc || 1, c = 0 === t.sideOrientation ? 0 : t.sideOrientation || he.Mesh.DEFAULTSIDE; i.push(0, 0, 0), o.push(.5, .5); for (var h = 2 * Math.PI * l, u = h / a, d = 0; d < h; d += u) { var f = Math.cos(d), p = Math.sin(d), _ = (f + 1) / 2, m = (1 - p) / 2; i.push(s * f, s * p, 0), o.push(_, m) } 1 === l && (i.push(i[3], i[4], i[5]), o.push(o[2], o[3])); for (var g = i.length / 3, v = 1; v < g - 1; v++)r.push(v + 1, 0, v); e.ComputeNormals(i, r, n), e._ComputeSides(c, i, r, n, o, t.frontUVs, t.backUVs); var y = new e; return y.indices = r, y.positions = i, y.normals = n, y.uvs = o, y }, e.CreatePolygon = function (t, i, r, n, o, s) { for (var a = r || new Array(3), l = n, c = [], h = 0; h < 3; h++)void 0 === a[h] && (a[h] = new he.Vector4(0, 0, 1, 1)), l && void 0 === l[h] && (l[h] = new he.Color4(1, 1, 1, 1)); for (var u = t.getVerticesData(he.VertexBuffer.PositionKind), d = t.getVerticesData(he.VertexBuffer.NormalKind), f = t.getVerticesData(he.VertexBuffer.UVKind), p = t.getIndices(), _ = 0, m = 0, g = 0; g < d.length; g += 3)Math.abs(d[g + 1]) < .001 && (m = 1), Math.abs(d[g + 1] - 1) < .001 && (m = 0), Math.abs(d[g + 1] + 1) < .001 && (m = 2), f[2 * (_ = g / 3)] = (1 - f[2 * _]) * a[m].x + f[2 * _] * a[m].z, f[2 * _ + 1] = (1 - f[2 * _ + 1]) * a[m].y + f[2 * _ + 1] * a[m].w, l && c.push(l[m].r, l[m].g, l[m].b, l[m].a); e._ComputeSides(i, u, p, d, f, o, s); var v = new e; if (v.indices = p, v.positions = u, v.normals = d, v.uvs = f, l) { var y = i === he.Mesh.DOUBLESIDE ? c.concat(c) : c; v.colors = y } return v }, e.CreateIcoSphere = function (t) { var i, r = t.sideOrientation || he.Mesh.DEFAULTSIDE, n = t.radius || 1, o = void 0 === t.flat || t.flat, s = t.subdivisions || 4, a = t.radiusX || n, l = t.radiusY || n, c = t.radiusZ || n, h = (1 + Math.sqrt(5)) / 2, u = [-1, h, -0, 1, h, 0, -1, -h, 0, 1, -h, 0, 0, -1, -h, 0, 1, -h, 0, -1, h, 0, 1, h, h, 0, 1, h, 0, -1, -h, 0, 1, -h, 0, -1], d = [0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 12, 22, 23, 1, 5, 20, 5, 11, 4, 23, 22, 13, 22, 18, 6, 7, 1, 8, 14, 21, 4, 14, 4, 2, 16, 13, 6, 15, 6, 19, 3, 8, 9, 4, 21, 5, 13, 17, 23, 6, 13, 22, 19, 6, 18, 9, 8, 1], f = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 2, 3, 3, 3, 4, 7, 8, 9, 9, 10, 11], p = [5, 1, 3, 1, 6, 4, 0, 0, 5, 3, 4, 2, 2, 2, 4, 0, 2, 0, 1, 1, 6, 0, 6, 2, 0, 4, 3, 3, 4, 4, 3, 1, 4, 2, 4, 4, 0, 2, 1, 1, 2, 2, 3, 3, 1, 3, 2, 4], _ = [0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0], m = new Array, g = new Array, v = new Array, y = new Array, b = 0, T = new Array(3), E = new Array(3); for (i = 0; i < 3; i++)T[i] = he.Vector3.Zero(), E[i] = he.Vector2.Zero(); for (var x = 0; x < 20; x++) { for (i = 0; i < 3; i++) { var P = d[3 * x + i]; T[i].copyFromFloats(u[3 * f[P]], u[3 * f[P] + 1], u[3 * f[P] + 2]), T[i].normalize().scaleInPlace(n), E[i].copyFromFloats(p[2 * P] * (138 / 1024) + 60 / 1024 + _[x] * (-40 / 1024), p[2 * P + 1] * (239 / 1024) + 26 / 1024 + _[x] * (20 / 1024)) } for (var A = function (e, t, i, r) { var n, h = he.Vector3.Lerp(T[0], T[2], t / s), u = he.Vector3.Lerp(T[1], T[2], t / s), d = s === t ? T[2] : he.Vector3.Lerp(h, u, e / (s - t)); if (d.normalize(), o) { var f = he.Vector3.Lerp(T[0], T[2], r / s), p = he.Vector3.Lerp(T[1], T[2], r / s); n = he.Vector3.Lerp(f, p, i / (s - r)) } else n = new he.Vector3(d.x, d.y, d.z); n.x /= a, n.y /= l, n.z /= c, n.normalize(); var _ = he.Vector2.Lerp(E[0], E[2], t / s), x = he.Vector2.Lerp(E[1], E[2], t / s), P = s === t ? E[2] : he.Vector2.Lerp(_, x, e / (s - t)); g.push(d.x * a, d.y * l, d.z * c), v.push(n.x, n.y, n.z), y.push(P.x, P.y), m.push(b), b++ }, S = 0; S < s; S++)for (var M = 0; M + S < s; M++)A(M, S, M + 1 / 3, S + 1 / 3), A(M + 1, S, M + 1 / 3, S + 1 / 3), A(M, S + 1, M + 1 / 3, S + 1 / 3), M + S + 1 < s && (A(M + 1, S, M + 2 / 3, S + 2 / 3), A(M + 1, S + 1, M + 2 / 3, S + 2 / 3), A(M, S + 1, M + 2 / 3, S + 2 / 3)) } e._ComputeSides(r, g, m, v, y, t.frontUVs, t.backUVs); var R = new e; return R.indices = m, R.positions = g, R.normals = v, R.uvs = y, R }, e.CreatePolyhedron = function (t) { var i = []; i[0] = { vertex: [[0, 0, 1.732051], [1.632993, 0, -.5773503], [-.8164966, 1.414214, -.5773503], [-.8164966, -1.414214, -.5773503]], face: [[0, 1, 2], [0, 2, 3], [0, 3, 1], [1, 3, 2]] }, i[1] = { vertex: [[0, 0, 1.414214], [1.414214, 0, 0], [0, 1.414214, 0], [-1.414214, 0, 0], [0, -1.414214, 0], [0, 0, -1.414214]], face: [[0, 1, 2], [0, 2, 3], [0, 3, 4], [0, 4, 1], [1, 4, 5], [1, 5, 2], [2, 5, 3], [3, 5, 4]] }, i[2] = { vertex: [[0, 0, 1.070466], [.7136442, 0, .7978784], [-.3568221, .618034, .7978784], [-.3568221, -.618034, .7978784], [.7978784, .618034, .3568221], [.7978784, -.618034, .3568221], [-.9341724, .381966, .3568221], [.1362939, 1, .3568221], [.1362939, -1, .3568221], [-.9341724, -.381966, .3568221], [.9341724, .381966, -.3568221], [.9341724, -.381966, -.3568221], [-.7978784, .618034, -.3568221], [-.1362939, 1, -.3568221], [-.1362939, -1, -.3568221], [-.7978784, -.618034, -.3568221], [.3568221, .618034, -.7978784], [.3568221, -.618034, -.7978784], [-.7136442, 0, -.7978784], [0, 0, -1.070466]], face: [[0, 1, 4, 7, 2], [0, 2, 6, 9, 3], [0, 3, 8, 5, 1], [1, 5, 11, 10, 4], [2, 7, 13, 12, 6], [3, 9, 15, 14, 8], [4, 10, 16, 13, 7], [5, 8, 14, 17, 11], [6, 12, 18, 15, 9], [10, 11, 17, 19, 16], [12, 13, 16, 19, 18], [14, 15, 18, 19, 17]] }, i[3] = { vertex: [[0, 0, 1.175571], [1.051462, 0, .5257311], [.3249197, 1, .5257311], [-.8506508, .618034, .5257311], [-.8506508, -.618034, .5257311], [.3249197, -1, .5257311], [.8506508, .618034, -.5257311], [.8506508, -.618034, -.5257311], [-.3249197, 1, -.5257311], [-1.051462, 0, -.5257311], [-.3249197, -1, -.5257311], [0, 0, -1.175571]], face: [[0, 1, 2], [0, 2, 3], [0, 3, 4], [0, 4, 5], [0, 5, 1], [1, 5, 7], [1, 7, 6], [1, 6, 2], [2, 6, 8], [2, 8, 3], [3, 8, 9], [3, 9, 4], [4, 9, 10], [4, 10, 5], [5, 10, 7], [6, 7, 11], [6, 11, 8], [7, 10, 11], [8, 11, 9], [9, 11, 10]] }, i[4] = { vertex: [[0, 0, 1.070722], [.7148135, 0, .7971752], [-.104682, .7071068, .7971752], [-.6841528, .2071068, .7971752], [-.104682, -.7071068, .7971752], [.6101315, .7071068, .5236279], [1.04156, .2071068, .1367736], [.6101315, -.7071068, .5236279], [-.3574067, 1, .1367736], [-.7888348, -.5, .5236279], [-.9368776, .5, .1367736], [-.3574067, -1, .1367736], [.3574067, 1, -.1367736], [.9368776, -.5, -.1367736], [.7888348, .5, -.5236279], [.3574067, -1, -.1367736], [-.6101315, .7071068, -.5236279], [-1.04156, -.2071068, -.1367736], [-.6101315, -.7071068, -.5236279], [.104682, .7071068, -.7971752], [.6841528, -.2071068, -.7971752], [.104682, -.7071068, -.7971752], [-.7148135, 0, -.7971752], [0, 0, -1.070722]], face: [[0, 2, 3], [1, 6, 5], [4, 9, 11], [7, 15, 13], [8, 16, 10], [12, 14, 19], [17, 22, 18], [20, 21, 23], [0, 1, 5, 2], [0, 3, 9, 4], [0, 4, 7, 1], [1, 7, 13, 6], [2, 5, 12, 8], [2, 8, 10, 3], [3, 10, 17, 9], [4, 11, 15, 7], [5, 6, 14, 12], [6, 13, 20, 14], [8, 12, 19, 16], [9, 17, 18, 11], [10, 16, 22, 17], [11, 18, 21, 15], [13, 15, 21, 20], [14, 20, 23, 19], [16, 19, 23, 22], [18, 22, 23, 21]] }, i[5] = { vertex: [[0, 0, 1.322876], [1.309307, 0, .1889822], [-.9819805, .8660254, .1889822], [.1636634, -1.299038, .1889822], [.3273268, .8660254, -.9449112], [-.8183171, -.4330127, -.9449112]], face: [[0, 3, 1], [2, 4, 5], [0, 1, 4, 2], [0, 2, 5, 3], [1, 3, 5, 4]] }, i[6] = { vertex: [[0, 0, 1.159953], [1.013464, 0, .5642542], [-.3501431, .9510565, .5642542], [-.7715208, -.6571639, .5642542], [.6633206, .9510565, -.03144481], [.8682979, -.6571639, -.3996071], [-1.121664, .2938926, -.03144481], [-.2348831, -1.063314, -.3996071], [.5181548, .2938926, -.9953061], [-.5850262, -.112257, -.9953061]], face: [[0, 1, 4, 2], [0, 2, 6, 3], [1, 5, 8, 4], [3, 6, 9, 7], [5, 7, 9, 8], [0, 3, 7, 5, 1], [2, 4, 8, 9, 6]] }, i[7] = { vertex: [[0, 0, 1.118034], [.8944272, 0, .6708204], [-.2236068, .8660254, .6708204], [-.7826238, -.4330127, .6708204], [.6708204, .8660254, .2236068], [1.006231, -.4330127, -.2236068], [-1.006231, .4330127, .2236068], [-.6708204, -.8660254, -.2236068], [.7826238, .4330127, -.6708204], [.2236068, -.8660254, -.6708204], [-.8944272, 0, -.6708204], [0, 0, -1.118034]], face: [[0, 1, 4, 2], [0, 2, 6, 3], [1, 5, 8, 4], [3, 6, 10, 7], [5, 9, 11, 8], [7, 10, 11, 9], [0, 3, 7, 9, 5, 1], [2, 4, 8, 11, 10, 6]] }, i[8] = { vertex: [[-.729665, .670121, .319155], [-.655235, -.29213, -.754096], [-.093922, -.607123, .537818], [.702196, .595691, .485187], [.776626, -.36656, -.588064]], face: [[1, 4, 2], [0, 1, 2], [3, 0, 2], [4, 3, 2], [4, 1, 0, 3]] }, i[9] = { vertex: [[-.868849, -.100041, .61257], [-.329458, .976099, .28078], [-.26629, -.013796, -.477654], [-.13392, -1.034115, .229829], [.738834, .707117, -.307018], [.859683, -.535264, -.338508]], face: [[3, 0, 2], [5, 3, 2], [4, 5, 2], [1, 4, 2], [0, 1, 2], [0, 3, 5, 4, 1]] }, i[10] = { vertex: [[-.610389, .243975, .531213], [-.187812, -.48795, -.664016], [-.187812, .9759, -.664016], [.187812, -.9759, .664016], [.798201, .243975, .132803]], face: [[1, 3, 0], [3, 4, 0], [3, 1, 4], [0, 2, 1], [0, 4, 2], [2, 4, 1]] }, i[11] = { vertex: [[-1.028778, .392027, -.048786], [-.640503, -.646161, .621837], [-.125162, -.395663, -.540059], [.004683, .888447, -.651988], [.125161, .395663, .540059], [.632925, -.791376, .433102], [1.031672, .157063, -.354165]], face: [[3, 2, 0], [2, 1, 0], [2, 5, 1], [0, 4, 3], [0, 1, 4], [4, 1, 5], [2, 3, 6], [3, 4, 6], [5, 2, 6], [4, 5, 6]] }, i[12] = { vertex: [[-.669867, .334933, -.529576], [-.669867, .334933, .529577], [-.4043, 1.212901, 0], [-.334933, -.669867, -.529576], [-.334933, -.669867, .529577], [.334933, .669867, -.529576], [.334933, .669867, .529577], [.4043, -1.212901, 0], [.669867, -.334933, -.529576], [.669867, -.334933, .529577]], face: [[8, 9, 7], [6, 5, 2], [3, 8, 7], [5, 0, 2], [4, 3, 7], [0, 1, 2], [9, 4, 7], [1, 6, 2], [9, 8, 5, 6], [8, 3, 0, 5], [3, 4, 1, 0], [4, 9, 6, 1]] }, i[13] = { vertex: [[-.931836, .219976, -.264632], [-.636706, .318353, .692816], [-.613483, -.735083, -.264632], [-.326545, .979634, 0], [-.318353, -.636706, .692816], [-.159176, .477529, -.856368], [.159176, -.477529, -.856368], [.318353, .636706, .692816], [.326545, -.979634, 0], [.613482, .735082, -.264632], [.636706, -.318353, .692816], [.931835, -.219977, -.264632]], face: [[11, 10, 8], [7, 9, 3], [6, 11, 8], [9, 5, 3], [2, 6, 8], [5, 0, 3], [4, 2, 8], [0, 1, 3], [10, 4, 8], [1, 7, 3], [10, 11, 9, 7], [11, 6, 5, 9], [6, 2, 0, 5], [2, 4, 1, 0], [4, 10, 7, 1]] }, i[14] = { vertex: [[-.93465, .300459, -.271185], [-.838689, -.260219, -.516017], [-.711319, .717591, .128359], [-.710334, -.156922, .080946], [-.599799, .556003, -.725148], [-.503838, -.004675, -.969981], [-.487004, .26021, .48049], [-.460089, -.750282, -.512622], [-.376468, .973135, -.325605], [-.331735, -.646985, .084342], [-.254001, .831847, .530001], [-.125239, -.494738, -.966586], [.029622, .027949, .730817], [.056536, -.982543, -.262295], [.08085, 1.087391, .076037], [.125583, -.532729, .485984], [.262625, .599586, .780328], [.391387, -.726999, -.716259], [.513854, -.868287, .139347], [.597475, .85513, .326364], [.641224, .109523, .783723], [.737185, -.451155, .538891], [.848705, -.612742, -.314616], [.976075, .365067, .32976], [1.072036, -.19561, .084927]], face: [[15, 18, 21], [12, 20, 16], [6, 10, 2], [3, 0, 1], [9, 7, 13], [2, 8, 4, 0], [0, 4, 5, 1], [1, 5, 11, 7], [7, 11, 17, 13], [13, 17, 22, 18], [18, 22, 24, 21], [21, 24, 23, 20], [20, 23, 19, 16], [16, 19, 14, 10], [10, 14, 8, 2], [15, 9, 13, 18], [12, 15, 21, 20], [6, 12, 16, 10], [3, 6, 2, 0], [9, 3, 1, 7], [9, 15, 12, 6, 3], [22, 17, 11, 5, 4, 8, 14, 19, 23, 24]] }; var r, n, o, s, a, l, c = t.type && (t.type < 0 || t.type >= i.length) ? 0 : t.type || 0, h = t.size, u = t.sizeX || h || 1, d = t.sizeY || h || 1, f = t.sizeZ || h || 1, p = t.custom || i[c], _ = p.face.length, m = t.faceUV || new Array(_), g = t.faceColors, v = void 0 === t.flat || t.flat, y = 0 === t.sideOrientation ? 0 : t.sideOrientation || he.Mesh.DEFAULTSIDE, b = new Array, T = new Array, E = new Array, x = new Array, P = new Array, A = 0, S = 0, M = new Array, R = 0, C = 0; if (v) for (C = 0; C < _; C++)g && void 0 === g[C] && (g[C] = new he.Color4(1, 1, 1, 1)), m && void 0 === m[C] && (m[C] = new he.Vector4(0, 0, 1, 1)); if (v) for (C = 0; C < _; C++) { var O = p.face[C].length; for (o = 2 * Math.PI / O, s = .5 * Math.tan(o / 2), a = .5, R = 0; R < O; R++)b.push(p.vertex[p.face[C][R]][0] * u, p.vertex[p.face[C][R]][1] * d, p.vertex[p.face[C][R]][2] * f), M.push(A), A++ , r = m[C].x + (m[C].z - m[C].x) * (.5 + s), n = m[C].y + (m[C].w - m[C].y) * (a - .5), x.push(r, n), l = s * Math.cos(o) - a * Math.sin(o), a = s * Math.sin(o) + a * Math.cos(o), s = l, g && P.push(g[C].r, g[C].g, g[C].b, g[C].a); for (R = 0; R < O - 2; R++)T.push(M[0 + S], M[R + 2 + S], M[R + 1 + S]); S += O } else { for (R = 0; R < p.vertex.length; R++)b.push(p.vertex[R][0] * u, p.vertex[R][1] * d, p.vertex[R][2] * f), x.push(0, 0); for (C = 0; C < _; C++)for (R = 0; R < p.face[C].length - 2; R++)T.push(p.face[C][0], p.face[C][R + 2], p.face[C][R + 1]) } e.ComputeNormals(b, T, E), e._ComputeSides(y, b, T, E, x, t.frontUVs, t.backUVs); var D = new e; return D.positions = b, D.indices = T, D.normals = E, D.uvs = x, g && v && (D.colors = P), D }, e.CreateTorusKnot = function (t) { var i, r, n = new Array, o = new Array, s = new Array, a = new Array, l = t.radius || 2, c = t.tube || .5, h = t.radialSegments || 32, u = t.tubularSegments || 32, d = t.p || 2, f = t.q || 3, p = 0 === t.sideOrientation ? 0 : t.sideOrientation || he.Mesh.DEFAULTSIDE, _ = function (e) { var t = Math.cos(e), i = Math.sin(e), r = f / d * e, n = Math.cos(r), o = l * (2 + n) * .5 * t, s = l * (2 + n) * i * .5, a = l * Math.sin(r) * .5; return new he.Vector3(o, s, a) }; for (i = 0; i <= h; i++) { var m = i % h / h * 2 * d * Math.PI, g = _(m), v = _(m + .01), y = v.subtract(g), b = v.add(g), T = he.Vector3.Cross(y, b); for (b = he.Vector3.Cross(T, y), T.normalize(), b.normalize(), r = 0; r < u; r++) { var E = r % u / u * 2 * Math.PI, x = -c * Math.cos(E), P = c * Math.sin(E); o.push(g.x + x * b.x + P * T.x), o.push(g.y + x * b.y + P * T.y), o.push(g.z + x * b.z + P * T.z), a.push(i / h), a.push(r / u) } } for (i = 0; i < h; i++)for (r = 0; r < u; r++) { var A = (r + 1) % u, S = i * u + r, M = (i + 1) * u + r, R = (i + 1) * u + A, C = i * u + A; n.push(C), n.push(M), n.push(S), n.push(C), n.push(R), n.push(M) } e.ComputeNormals(o, n, s), e._ComputeSides(p, o, n, s, a, t.frontUVs, t.backUVs); var O = new e; return O.indices = n, O.positions = o, O.normals = s, O.uvs = a, O }, e.ComputeNormals = function (e, t, i, r) { var n = 0, o = 0, s = 0, a = 0, l = 0, c = 0, h = 0, u = 0, d = 0, f = 0, p = 0, _ = 0, m = 0, g = 0, v = 0, y = 0, b = 0, T = 0, E = 0, x = 0, P = !1, A = !1, S = !1, M = !1, R = 1, C = 0, O = null; if (r && (P = !!r.facetNormals, A = !!r.facetPositions, S = !!r.facetPartitioning, R = !0 === r.useRightHandedSystem ? -1 : 1, C = r.ratio || 0, M = !!r.depthSort, O = r.distanceTo, M)) { void 0 === O && (O = he.Vector3.Zero()); var D = r.depthSortedFacets } var I = 0, w = 0, L = 0, F = 0; if (S && r && r.bbSize) { var B = 0, N = 0, V = 0, U = 0, z = 0, G = 0, k = 0, W = 0, H = 0, X = 0, j = 0, Y = 0, K = 0, Q = 0, Z = 0, q = 0, J = r.bbSize.x > r.bbSize.y ? r.bbSize.x : r.bbSize.y; J = J > r.bbSize.z ? J : r.bbSize.z, I = r.subDiv.X * C / r.bbSize.x, w = r.subDiv.Y * C / r.bbSize.y, L = r.subDiv.Z * C / r.bbSize.z, F = r.subDiv.max * r.subDiv.max, r.facetPartitioning.length = 0 } for (n = 0; n < e.length; n++)i[n] = 0; var $ = t.length / 3 | 0; for (n = 0; n < $; n++) { if (m = 1 + (_ = 3 * t[3 * n]), g = _ + 2, y = 1 + (v = 3 * t[3 * n + 1]), b = v + 2, E = 1 + (T = 3 * t[3 * n + 2]), x = T + 2, o = e[_] - e[v], s = e[m] - e[y], a = e[g] - e[b], l = e[T] - e[v], c = e[E] - e[y], u = R * (s * (h = e[x] - e[b]) - a * c), d = R * (a * l - o * h), f = R * (o * c - s * l), u /= p = 0 === (p = Math.sqrt(u * u + d * d + f * f)) ? 1 : p, d /= p, f /= p, P && r && (r.facetNormals[n].x = u, r.facetNormals[n].y = d, r.facetNormals[n].z = f), A && r && (r.facetPositions[n].x = (e[_] + e[v] + e[T]) / 3, r.facetPositions[n].y = (e[m] + e[y] + e[E]) / 3, r.facetPositions[n].z = (e[g] + e[b] + e[x]) / 3), S && r && (B = Math.floor((r.facetPositions[n].x - r.bInfo.minimum.x * C) * I), N = Math.floor((r.facetPositions[n].y - r.bInfo.minimum.y * C) * w), V = Math.floor((r.facetPositions[n].z - r.bInfo.minimum.z * C) * L), U = Math.floor((e[_] - r.bInfo.minimum.x * C) * I), z = Math.floor((e[m] - r.bInfo.minimum.y * C) * w), G = Math.floor((e[g] - r.bInfo.minimum.z * C) * L), k = Math.floor((e[v] - r.bInfo.minimum.x * C) * I), W = Math.floor((e[y] - r.bInfo.minimum.y * C) * w), H = Math.floor((e[b] - r.bInfo.minimum.z * C) * L), X = Math.floor((e[T] - r.bInfo.minimum.x * C) * I), j = Math.floor((e[E] - r.bInfo.minimum.y * C) * w), Y = Math.floor((e[x] - r.bInfo.minimum.z * C) * L), Q = U + r.subDiv.max * z + F * G, Z = k + r.subDiv.max * W + F * H, q = X + r.subDiv.max * j + F * Y, K = B + r.subDiv.max * N + F * V, r.facetPartitioning[K] = r.facetPartitioning[K] ? r.facetPartitioning[K] : new Array, r.facetPartitioning[Q] = r.facetPartitioning[Q] ? r.facetPartitioning[Q] : new Array, r.facetPartitioning[Z] = r.facetPartitioning[Z] ? r.facetPartitioning[Z] : new Array, r.facetPartitioning[q] = r.facetPartitioning[q] ? r.facetPartitioning[q] : new Array, r.facetPartitioning[Q].push(n), Z != Q && r.facetPartitioning[Z].push(n), q != Z && q != Q && r.facetPartitioning[q].push(n), K != Q && K != Z && K != q && r.facetPartitioning[K].push(n)), M && r && r.facetPositions) { var ee = D[n]; ee.ind = 3 * n, ee.sqDistance = he.Vector3.DistanceSquared(r.facetPositions[n], O) } i[_] += u, i[m] += d, i[g] += f, i[v] += u, i[y] += d, i[b] += f, i[T] += u, i[E] += d, i[x] += f } for (n = 0; n < i.length / 3; n++)u = i[3 * n], d = i[3 * n + 1], f = i[3 * n + 2], u /= p = 0 === (p = Math.sqrt(u * u + d * d + f * f)) ? 1 : p, d /= p, f /= p, i[3 * n] = u, i[3 * n + 1] = d, i[3 * n + 2] = f }, e._ComputeSides = function (e, t, i, r, n, o, s) { var a, l, c = i.length, h = r.length; switch (e = e || he.Mesh.DEFAULTSIDE) { case he.Mesh.FRONTSIDE: break; case he.Mesh.BACKSIDE: var u; for (a = 0; a < c; a += 3)u = i[a], i[a] = i[a + 2], i[a + 2] = u; for (l = 0; l < h; l++)r[l] = -r[l]; break; case he.Mesh.DOUBLESIDE: for (var d = t.length, f = d / 3, p = 0; p < d; p++)t[d + p] = t[p]; for (a = 0; a < c; a += 3)i[a + c] = i[a + 2] + f, i[a + 1 + c] = i[a + 1] + f, i[a + 2 + c] = i[a] + f; for (l = 0; l < h; l++)r[h + l] = -r[l]; var _ = n.length, m = 0; for (m = 0; m < _; m++)n[m + _] = n[m]; for (o = o || new he.Vector4(0, 0, 1, 1), s = s || new he.Vector4(0, 0, 1, 1), a = m = 0; a < _ / 2; a++)n[m] = o.x + (o.z - o.x) * n[m], n[m + 1] = o.y + (o.w - o.y) * n[m + 1], n[m + _] = s.x + (s.z - s.x) * n[m + _], n[m + _ + 1] = s.y + (s.w - s.y) * n[m + _ + 1], m += 2 } }, e.ImportVertexData = function (t, i) { var r = new e, n = t.positions; n && r.set(n, he.VertexBuffer.PositionKind); var o = t.normals; o && r.set(o, he.VertexBuffer.NormalKind); var s = t.tangents; s && r.set(s, he.VertexBuffer.TangentKind); var a = t.uvs; a && r.set(a, he.VertexBuffer.UVKind); var l = t.uv2s; l && r.set(l, he.VertexBuffer.UV2Kind); var c = t.uv3s; c && r.set(c, he.VertexBuffer.UV3Kind); var h = t.uv4s; h && r.set(h, he.VertexBuffer.UV4Kind); var u = t.uv5s; u && r.set(u, he.VertexBuffer.UV5Kind); var d = t.uv6s; d && r.set(d, he.VertexBuffer.UV6Kind); var f = t.colors; f && r.set(he.Color4.CheckColors4(f, n.length / 3), he.VertexBuffer.ColorKind); var p = t.matricesIndices; p && r.set(p, he.VertexBuffer.MatricesIndicesKind); var _ = t.matricesWeights; _ && r.set(_, he.VertexBuffer.MatricesWeightsKind); var m = t.indices; m && (r.indices = m), i.setAllVerticesData(r, t.updatable) }, e }(), he.VertexData = ue, function (e) { var t = function () { function t(t, i, r, n, o) { void 0 === n && (n = !1), void 0 === o && (o = null), this.delayLoadState = e.Engine.DELAYLOADSTATE_NONE, this._totalVertices = 0, this._isDisposed = !1, this._indexBufferIsUpdatable = !1, this.id = t, this._engine = i.getEngine(), this._meshes = [], this._scene = i, this._vertexBuffers = {}, this._indices = [], this._updatable = n, r ? this.setAllVerticesData(r, n) : (this._totalVertices = 0, this._indices = []), this._engine.getCaps().vertexArrayObject && (this._vertexArrayObjects = {}), o && ("LinesMesh" === o.getClassName() && (this.boundingBias = new e.Vector2(0, o.intersectionThreshold), this._updateExtend()), this.applyToMesh(o), o.computeWorldMatrix(!0)) } return Object.defineProperty(t.prototype, "boundingBias", { get: function () { return this._boundingBias }, set: function (e) { if (this._boundingBias) { if (this._boundingBias.equals(e)) return; this._boundingBias.copyFrom(e) } else this._boundingBias = e.clone(); this._updateBoundingInfo(!0, null) }, enumerable: !0, configurable: !0 }), t.CreateGeometryForMesh = function (e) { var i = new t(t.RandomId(), e.getScene()); return i.applyToMesh(e), i }, Object.defineProperty(t.prototype, "extend", { get: function () { return this._extend }, enumerable: !0, configurable: !0 }), t.prototype.getScene = function () { return this._scene }, t.prototype.getEngine = function () { return this._engine }, t.prototype.isReady = function () { return this.delayLoadState === e.Engine.DELAYLOADSTATE_LOADED || this.delayLoadState === e.Engine.DELAYLOADSTATE_NONE }, Object.defineProperty(t.prototype, "doNotSerialize", { get: function () { for (var e = 0; e < this._meshes.length; e++)if (!this._meshes[e].doNotSerialize) return !1; return !0 }, enumerable: !0, configurable: !0 }), t.prototype._rebuild = function () { for (var e in this._vertexArrayObjects && (this._vertexArrayObjects = {}), 0 !== this._meshes.length && this._indices && (this._indexBuffer = this._engine.createIndexBuffer(this._indices)), this._vertexBuffers) this._vertexBuffers[e]._rebuild() }, t.prototype.setAllVerticesData = function (e, t) { e.applyToGeometry(this, t), this.notifyUpdate() }, t.prototype.setVerticesData = function (t, i, r, n) { void 0 === r && (r = !1); var o = new e.VertexBuffer(this._engine, i, t, r, 0 === this._meshes.length, n); this.setVerticesBuffer(o) }, t.prototype.removeVerticesData = function (e) { this._vertexBuffers[e] && (this._vertexBuffers[e].dispose(), delete this._vertexBuffers[e]) }, t.prototype.setVerticesBuffer = function (t, i) { void 0 === i && (i = null); var r = t.getKind(); if (this._vertexBuffers[r] && this._vertexBuffers[r].dispose(), this._vertexBuffers[r] = t, r === e.VertexBuffer.PositionKind) { var n = t.getData(); null != i ? this._totalVertices = i : null != n && (this._totalVertices = n.length / (t.byteStride / 4)), this._updateExtend(n), this._resetPointsArrayCache(); for (var o = this._meshes, s = o.length, a = 0; a < s; a++) { var l = o[a]; l._boundingInfo = new e.BoundingInfo(this._extend.minimum, this._extend.maximum), l._createGlobalSubMesh(!1), l.computeWorldMatrix(!0) } } this.notifyUpdate(r), this._vertexArrayObjects && (this._disposeVertexArrayObjects(), this._vertexArrayObjects = {}) }, t.prototype.updateVerticesDataDirectly = function (e, t, i, r) { void 0 === r && (r = !1); var n = this.getVertexBuffer(e); n && (n.updateDirectly(t, i, r), this.notifyUpdate(e)) }, t.prototype.updateVerticesData = function (t, i, r) { void 0 === r && (r = !1); var n = this.getVertexBuffer(t); n && (n.update(i), t === e.VertexBuffer.PositionKind && this._updateBoundingInfo(r, i), this.notifyUpdate(t)) }, t.prototype._updateBoundingInfo = function (t, i) { t && this._updateExtend(i); var r = this._meshes, n = r.length; this._resetPointsArrayCache(); for (var o = 0; o < n; o++) { var s = r[o]; if (t) { s._boundingInfo = new e.BoundingInfo(this._extend.minimum, this._extend.maximum); for (var a = 0; a < s.subMeshes.length; a++)s.subMeshes[a].refreshBoundingInfo() } } }, t.prototype._bind = function (e, t) { if (e) { void 0 === t && (t = this._indexBuffer); var i = this.getVertexBuffers(); i && (t == this._indexBuffer && this._vertexArrayObjects ? (this._vertexArrayObjects[e.key] || (this._vertexArrayObjects[e.key] = this._engine.recordVertexArrayObject(i, t, e)), this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key], t)) : this._engine.bindBuffers(i, t, e)) } }, t.prototype.getTotalVertices = function () { return this.isReady() ? this._totalVertices : 0 }, t.prototype.getVerticesData = function (t, i, r) { var n = this.getVertexBuffer(t); if (!n) return null; var o = n.getData(); if (!o) return null; var s = n.getSize() * e.VertexBuffer.GetTypeByteLength(n.type), a = this._totalVertices * n.getSize(); if (n.type !== e.VertexBuffer.FLOAT || n.byteStride !== s) { var l = new Array(a); return n.forEach(a, function (e, t) { l[t] = e }), l } if (!(o instanceof Array || o instanceof Float32Array) || 0 !== n.byteOffset || o.length !== a) { if (o instanceof Array) { var c = n.byteOffset / 4; return e.Tools.Slice(o, c, c + a) } if (o instanceof ArrayBuffer) return new Float32Array(o, n.byteOffset, a); if (c = o.byteOffset + n.byteOffset, r || i && 1 !== this._meshes.length) { var h = new Float32Array(a), u = new Float32Array(o.buffer, c, a); return h.set(u), h } return new Float32Array(o.buffer, c, a) } return r || i && 1 !== this._meshes.length ? e.Tools.Slice(o) : o }, t.prototype.isVertexBufferUpdatable = function (e) { var t = this._vertexBuffers[e]; return !!t && t.isUpdatable() }, t.prototype.getVertexBuffer = function (e) { return this.isReady() ? this._vertexBuffers[e] : null }, t.prototype.getVertexBuffers = function () { return this.isReady() ? this._vertexBuffers : null }, t.prototype.isVerticesDataPresent = function (e) { return this._vertexBuffers ? void 0 !== this._vertexBuffers[e] : !!this._delayInfo && -1 !== this._delayInfo.indexOf(e) }, t.prototype.getVerticesDataKinds = function () { var e, t = []; if (!this._vertexBuffers && this._delayInfo) for (e in this._delayInfo) t.push(e); else for (e in this._vertexBuffers) t.push(e); return t }, t.prototype.updateIndices = function (e, t) { this._indexBuffer && (this._indexBufferIsUpdatable ? this._engine.updateDynamicIndexBuffer(this._indexBuffer, e, t) : this.setIndices(e, null, !0)) }, t.prototype.setIndices = function (e, t, i) { void 0 === t && (t = null), void 0 === i && (i = !1), this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer), this._disposeVertexArrayObjects(), this._indices = e, this._indexBufferIsUpdatable = i, 0 !== this._meshes.length && this._indices && (this._indexBuffer = this._engine.createIndexBuffer(this._indices, i)), null != t && (this._totalVertices = t); for (var r = this._meshes, n = r.length, o = 0; o < n; o++)r[o]._createGlobalSubMesh(!0); this.notifyUpdate() }, t.prototype.getTotalIndices = function () { return this.isReady() ? this._indices.length : 0 }, t.prototype.getIndices = function (e, t) { if (!this.isReady()) return null; var i = this._indices; if (t || e && 1 !== this._meshes.length) { for (var r = i.length, n = [], o = 0; o < r; o++)n.push(i[o]); return n } return i }, t.prototype.getIndexBuffer = function () { return this.isReady() ? this._indexBuffer : null }, t.prototype._releaseVertexArrayObject = function (e) { void 0 === e && (e = null), e && this._vertexArrayObjects && this._vertexArrayObjects[e.key] && (this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]), delete this._vertexArrayObjects[e.key]) }, t.prototype.releaseForMesh = function (e, t) { var i = this._meshes, r = i.indexOf(e); -1 !== r && (i.splice(r, 1), e._geometry = null, 0 === i.length && t && this.dispose()) }, t.prototype.applyToMesh = function (e) { if (e._geometry !== this) { var t = e._geometry; t && t.releaseForMesh(e); var i = this._meshes; (e._geometry = this)._scene.pushGeometry(this), i.push(e), this.isReady() ? this._applyToMesh(e) : e._boundingInfo = this._boundingInfo } }, t.prototype._updateExtend = function (t) { void 0 === t && (t = null), t || (t = this.getVerticesData(e.VertexBuffer.PositionKind)), this._extend = e.Tools.ExtractMinAndMax(t, 0, this._totalVertices, this.boundingBias, 3) }, t.prototype._applyToMesh = function (t) { var i = this._meshes.length; for (var r in this._vertexBuffers) { 1 === i && this._vertexBuffers[r].create(); var n = this._vertexBuffers[r].getBuffer(); n && (n.references = i), r === e.VertexBuffer.PositionKind && (this._extend || this._updateExtend(), t._boundingInfo = new e.BoundingInfo(this._extend.minimum, this._extend.maximum), t._createGlobalSubMesh(!1), t._updateBoundingInfo()) } 1 === i && this._indices && 0 < this._indices.length && (this._indexBuffer = this._engine.createIndexBuffer(this._indices)), this._indexBuffer && (this._indexBuffer.references = i), t._syncGeometryWithMorphTargetManager() }, t.prototype.notifyUpdate = function (e) { this.onGeometryUpdated && this.onGeometryUpdated(this, e); for (var t = 0, i = this._meshes; t < i.length; t++)i[t]._markSubMeshesAsAttributesDirty() }, t.prototype.load = function (t, i) { this.delayLoadState !== e.Engine.DELAYLOADSTATE_LOADING && (this.isReady() ? i && i() : (this.delayLoadState = e.Engine.DELAYLOADSTATE_LOADING, this._queueLoad(t, i))) }, t.prototype._queueLoad = function (t, i) { var r = this; this.delayLoadingFile && (t._addPendingData(this), t._loadFile(this.delayLoadingFile, function (n) { if (r._delayLoadingFunction) { r._delayLoadingFunction(JSON.parse(n), r), r.delayLoadState = e.Engine.DELAYLOADSTATE_LOADED, r._delayInfo = [], t._removePendingData(r); for (var o = r._meshes, s = o.length, a = 0; a < s; a++)r._applyToMesh(o[a]); i && i() } }, void 0, !0)) }, t.prototype.toLeftHanded = function () { var t = this.getIndices(!1); if (null != t && 0 < t.length) { for (var i = 0; i < t.length; i += 3) { var r = t[i + 0]; t[i + 0] = t[i + 2], t[i + 2] = r } this.setIndices(t) } var n = this.getVerticesData(e.VertexBuffer.PositionKind, !1); if (null != n && 0 < n.length) { for (i = 0; i < n.length; i += 3)n[i + 2] = -n[i + 2]; this.setVerticesData(e.VertexBuffer.PositionKind, n, !1) } var o = this.getVerticesData(e.VertexBuffer.NormalKind, !1); if (null != o && 0 < o.length) { for (i = 0; i < o.length; i += 3)o[i + 2] = -o[i + 2]; this.setVerticesData(e.VertexBuffer.NormalKind, o, !1) } }, t.prototype._resetPointsArrayCache = function () { this._positions = null }, t.prototype._generatePointsArray = function () { if (this._positions) return !0; var t = this.getVerticesData(e.VertexBuffer.PositionKind); if (!t || 0 === t.length) return !1; this._positions = []; for (var i = 0; i < t.length; i += 3)this._positions.push(e.Vector3.FromArray(t, i)); return !0 }, t.prototype.isDisposed = function () { return this._isDisposed }, t.prototype._disposeVertexArrayObjects = function () { if (this._vertexArrayObjects) { for (var e in this._vertexArrayObjects) this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]); this._vertexArrayObjects = {} } }, t.prototype.dispose = function () { var t, i = this._meshes, r = i.length; for (t = 0; t < r; t++)this.releaseForMesh(i[t]); for (var n in this._meshes = [], this._disposeVertexArrayObjects(), this._vertexBuffers) this._vertexBuffers[n].dispose(); this._vertexBuffers = {}, this._totalVertices = 0, this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer), this._indexBuffer = null, this._indices = [], this.delayLoadState = e.Engine.DELAYLOADSTATE_NONE, this.delayLoadingFile = null, this._delayLoadingFunction = null, this._delayInfo = [], this._boundingInfo = null, this._scene.removeGeometry(this), this._isDisposed = !0 }, t.prototype.copy = function (i) { var r = new e.VertexData; r.indices = []; var n = this.getIndices(); if (n) for (var o = 0; o < n.length; o++)r.indices.push(n[o]); var s, a = !1, l = !1; for (s in this._vertexBuffers) { var c = this.getVerticesData(s); if (c instanceof Float32Array ? r.set(new Float32Array(c), s) : r.set(c.slice(0), s), !l) { var h = this.getVertexBuffer(s); h && (l = !(a = h.isUpdatable())) } } var u = new t(i, this._scene, r, a); for (s in u.delayLoadState = this.delayLoadState, u.delayLoadingFile = this.delayLoadingFile, u._delayLoadingFunction = this._delayLoadingFunction, this._delayInfo) u._delayInfo = u._delayInfo || [], u._delayInfo.push(s); return u._boundingInfo = new e.BoundingInfo(this._extend.minimum, this._extend.maximum), u }, t.prototype.serialize = function () { var t = {}; return t.id = this.id, t.updatable = this._updatable, e.Tags && e.Tags.HasTags(this) && (t.tags = e.Tags.GetTags(this)), t }, t.prototype.toNumberArray = function (e) { return Array.isArray(e) ? e : Array.prototype.slice.call(e) }, t.prototype.serializeVerticeData = function () { var t = this.serialize(); return this.isVerticesDataPresent(e.VertexBuffer.PositionKind) && (t.positions = this.toNumberArray(this.getVerticesData(e.VertexBuffer.PositionKind)), this.isVertexBufferUpdatable(e.VertexBuffer.PositionKind) && (t.positions._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.NormalKind) && (t.normals = this.toNumberArray(this.getVerticesData(e.VertexBuffer.NormalKind)), this.isVertexBufferUpdatable(e.VertexBuffer.NormalKind) && (t.normals._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.TangentKind) && (t.tangets = this.toNumberArray(this.getVerticesData(e.VertexBuffer.TangentKind)), this.isVertexBufferUpdatable(e.VertexBuffer.TangentKind) && (t.tangets._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.UVKind) && (t.uvs = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UVKind)), this.isVertexBufferUpdatable(e.VertexBuffer.UVKind) && (t.uvs._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && (t.uv2s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV2Kind)), this.isVertexBufferUpdatable(e.VertexBuffer.UV2Kind) && (t.uv2s._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.UV3Kind) && (t.uv3s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV3Kind)), this.isVertexBufferUpdatable(e.VertexBuffer.UV3Kind) && (t.uv3s._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.UV4Kind) && (t.uv4s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV4Kind)), this.isVertexBufferUpdatable(e.VertexBuffer.UV4Kind) && (t.uv4s._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.UV5Kind) && (t.uv5s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV5Kind)), this.isVertexBufferUpdatable(e.VertexBuffer.UV5Kind) && (t.uv5s._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.UV6Kind) && (t.uv6s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV6Kind)), this.isVertexBufferUpdatable(e.VertexBuffer.UV6Kind) && (t.uv6s._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.ColorKind) && (t.colors = this.toNumberArray(this.getVerticesData(e.VertexBuffer.ColorKind)), this.isVertexBufferUpdatable(e.VertexBuffer.ColorKind) && (t.colors._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind) && (t.matricesIndices = this.toNumberArray(this.getVerticesData(e.VertexBuffer.MatricesIndicesKind)), t.matricesIndices._isExpanded = !0, this.isVertexBufferUpdatable(e.VertexBuffer.MatricesIndicesKind) && (t.matricesIndices._updatable = !0)), this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind) && (t.matricesWeights = this.toNumberArray(this.getVerticesData(e.VertexBuffer.MatricesWeightsKind)), this.isVertexBufferUpdatable(e.VertexBuffer.MatricesWeightsKind) && (t.matricesWeights._updatable = !0)), t.indices = this.toNumberArray(this.getIndices()), t }, t.ExtractFromMesh = function (e, t) { var i = e._geometry; return i ? i.copy(t) : null }, t.RandomId = function () { return e.Tools.RandomId() }, t._ImportGeometry = function (i, r) { var n = r.getScene(), o = i.geometryId; if (o) { var s = n.getGeometryByID(o); s && s.applyToMesh(r) } else if (i instanceof ArrayBuffer) { var a = r._binaryInfo; if (a.positionsAttrDesc && 0 < a.positionsAttrDesc.count) { var l = new Float32Array(i, a.positionsAttrDesc.offset, a.positionsAttrDesc.count); r.setVerticesData(e.VertexBuffer.PositionKind, l, !1) } if (a.normalsAttrDesc && 0 < a.normalsAttrDesc.count) { var c = new Float32Array(i, a.normalsAttrDesc.offset, a.normalsAttrDesc.count); r.setVerticesData(e.VertexBuffer.NormalKind, c, !1) } if (a.tangetsAttrDesc && 0 < a.tangetsAttrDesc.count) { var h = new Float32Array(i, a.tangetsAttrDesc.offset, a.tangetsAttrDesc.count); r.setVerticesData(e.VertexBuffer.TangentKind, h, !1) } if (a.uvsAttrDesc && 0 < a.uvsAttrDesc.count) { var u = new Float32Array(i, a.uvsAttrDesc.offset, a.uvsAttrDesc.count); r.setVerticesData(e.VertexBuffer.UVKind, u, !1) } if (a.uvs2AttrDesc && 0 < a.uvs2AttrDesc.count) { var d = new Float32Array(i, a.uvs2AttrDesc.offset, a.uvs2AttrDesc.count); r.setVerticesData(e.VertexBuffer.UV2Kind, d, !1) } if (a.uvs3AttrDesc && 0 < a.uvs3AttrDesc.count) { var f = new Float32Array(i, a.uvs3AttrDesc.offset, a.uvs3AttrDesc.count); r.setVerticesData(e.VertexBuffer.UV3Kind, f, !1) } if (a.uvs4AttrDesc && 0 < a.uvs4AttrDesc.count) { var p = new Float32Array(i, a.uvs4AttrDesc.offset, a.uvs4AttrDesc.count); r.setVerticesData(e.VertexBuffer.UV4Kind, p, !1) } if (a.uvs5AttrDesc && 0 < a.uvs5AttrDesc.count) { var _ = new Float32Array(i, a.uvs5AttrDesc.offset, a.uvs5AttrDesc.count); r.setVerticesData(e.VertexBuffer.UV5Kind, _, !1) } if (a.uvs6AttrDesc && 0 < a.uvs6AttrDesc.count) { var m = new Float32Array(i, a.uvs6AttrDesc.offset, a.uvs6AttrDesc.count); r.setVerticesData(e.VertexBuffer.UV6Kind, m, !1) } if (a.colorsAttrDesc && 0 < a.colorsAttrDesc.count) { var g = new Float32Array(i, a.colorsAttrDesc.offset, a.colorsAttrDesc.count); r.setVerticesData(e.VertexBuffer.ColorKind, g, !1, a.colorsAttrDesc.stride) } if (a.matricesIndicesAttrDesc && 0 < a.matricesIndicesAttrDesc.count) { for (var v = new Int32Array(i, a.matricesIndicesAttrDesc.offset, a.matricesIndicesAttrDesc.count), y = [], b = 0; b < v.length; b++) { var T = v[b]; y.push(255 & T), y.push((65280 & T) >> 8), y.push((16711680 & T) >> 16), y.push(T >> 24) } r.setVerticesData(e.VertexBuffer.MatricesIndicesKind, y, !1) } if (a.matricesWeightsAttrDesc && 0 < a.matricesWeightsAttrDesc.count) { var E = new Float32Array(i, a.matricesWeightsAttrDesc.offset, a.matricesWeightsAttrDesc.count); r.setVerticesData(e.VertexBuffer.MatricesWeightsKind, E, !1) } if (a.indicesAttrDesc && 0 < a.indicesAttrDesc.count) { var x = new Int32Array(i, a.indicesAttrDesc.offset, a.indicesAttrDesc.count); r.setIndices(x, null) } if (a.subMeshesAttrDesc && 0 < a.subMeshesAttrDesc.count) { var P = new Int32Array(i, a.subMeshesAttrDesc.offset, 5 * a.subMeshesAttrDesc.count); for (r.subMeshes = [], b = 0; b < a.subMeshesAttrDesc.count; b++) { var A = P[5 * b + 0], S = P[5 * b + 1], M = P[5 * b + 2], R = P[5 * b + 3], C = P[5 * b + 4]; e.SubMesh.AddToMesh(A, S, M, R, C, r) } } } else if (i.positions && i.normals && i.indices) { if (r.setVerticesData(e.VertexBuffer.PositionKind, i.positions, i.positions._updatable), r.setVerticesData(e.VertexBuffer.NormalKind, i.normals, i.normals._updatable), i.tangents && r.setVerticesData(e.VertexBuffer.TangentKind, i.tangents, i.tangents._updatable), i.uvs && r.setVerticesData(e.VertexBuffer.UVKind, i.uvs, i.uvs._updatable), i.uvs2 && r.setVerticesData(e.VertexBuffer.UV2Kind, i.uvs2, i.uvs2._updatable), i.uvs3 && r.setVerticesData(e.VertexBuffer.UV3Kind, i.uvs3, i.uvs3._updatable), i.uvs4 && r.setVerticesData(e.VertexBuffer.UV4Kind, i.uvs4, i.uvs4._updatable), i.uvs5 && r.setVerticesData(e.VertexBuffer.UV5Kind, i.uvs5, i.uvs5._updatable), i.uvs6 && r.setVerticesData(e.VertexBuffer.UV6Kind, i.uvs6, i.uvs6._updatable), i.colors && r.setVerticesData(e.VertexBuffer.ColorKind, e.Color4.CheckColors4(i.colors, i.positions.length / 3), i.colors._updatable), i.matricesIndices) if (i.matricesIndices._isExpanded) delete i.matricesIndices._isExpanded, r.setVerticesData(e.VertexBuffer.MatricesIndicesKind, i.matricesIndices, i.matricesIndices._updatable); else { for (y = [], b = 0; b < i.matricesIndices.length; b++) { var O = i.matricesIndices[b]; y.push(255 & O), y.push((65280 & O) >> 8), y.push((16711680 & O) >> 16), y.push(O >> 24) } r.setVerticesData(e.VertexBuffer.MatricesIndicesKind, y, i.matricesIndices._updatable) } if (i.matricesIndicesExtra) if (i.matricesIndicesExtra._isExpanded) delete i.matricesIndices._isExpanded, r.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind, i.matricesIndicesExtra, i.matricesIndicesExtra._updatable); else { for (y = [], b = 0; b < i.matricesIndicesExtra.length; b++)O = i.matricesIndicesExtra[b], y.push(255 & O), y.push((65280 & O) >> 8), y.push((16711680 & O) >> 16), y.push(O >> 24); r.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind, y, i.matricesIndicesExtra._updatable) } i.matricesWeights && (t._CleanMatricesWeights(i, r), r.setVerticesData(e.VertexBuffer.MatricesWeightsKind, i.matricesWeights, i.matricesWeights._updatable)), i.matricesWeightsExtra && r.setVerticesData(e.VertexBuffer.MatricesWeightsExtraKind, i.matricesWeightsExtra, i.matricesWeights._updatable), r.setIndices(i.indices, null) } if (i.subMeshes) { r.subMeshes = []; for (var D = 0; D < i.subMeshes.length; D++) { var I = i.subMeshes[D]; e.SubMesh.AddToMesh(I.materialIndex, I.verticesStart, I.verticesCount, I.indexStart, I.indexCount, r) } } r._shouldGenerateFlatShading && (r.convertToFlatShadedMesh(), delete r._shouldGenerateFlatShading), r.computeWorldMatrix(!0), n.onMeshImportedObservable.notifyObservers(r) }, t._CleanMatricesWeights = function (t, i) { if (e.SceneLoader.CleanBoneMatrixWeights) { var r = 0; if (-1 < t.skeletonId) { var n = i.getScene().getLastSkeletonByID(t.skeletonId); if (n) { r = n.bones.length; for (var o = i.getVerticesData(e.VertexBuffer.MatricesIndicesKind), s = i.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind), a = t.matricesWeights, l = t.matricesWeightsExtra, c = t.numBoneInfluencer, h = a.length, u = 0; u < h; u += 4) { for (var d = 0, f = -1, p = 0; p < 4; p++)d += _ = a[u + p], _ < .001 && f < 0 && (f = p); if (l) for (p = 0; p < 4; p++) { var _; d += _ = l[u + p], _ < .001 && f < 0 && (f = p + 4) } if ((f < 0 || c - 1 < f) && (f = c - 1), .001 < d) { var m = 1 / d; for (p = 0; p < 4; p++)a[u + p] *= m; if (l) for (p = 0; p < 4; p++)l[u + p] *= m } else 4 <= f ? (l[u + f - 4] = 1 - d, s[u + f - 4] = r) : (a[u + f] = 1 - d, o[u + f] = r) } i.setVerticesData(e.VertexBuffer.MatricesIndicesKind, o), t.matricesWeightsExtra && i.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind, s) } } } }, t.Parse = function (i, r, n) { if (r.getGeometryByID(i.id)) return null; var o = new t(i.id, r, void 0, i.updatable); return e.Tags && e.Tags.AddTagsTo(o, i.tags), i.delayLoadingFile ? (o.delayLoadState = e.Engine.DELAYLOADSTATE_NOTLOADED, o.delayLoadingFile = n + i.delayLoadingFile, o._boundingInfo = new e.BoundingInfo(e.Vector3.FromArray(i.boundingBoxMinimum), e.Vector3.FromArray(i.boundingBoxMaximum)), o._delayInfo = [], i.hasUVs && o._delayInfo.push(e.VertexBuffer.UVKind), i.hasUVs2 && o._delayInfo.push(e.VertexBuffer.UV2Kind), i.hasUVs3 && o._delayInfo.push(e.VertexBuffer.UV3Kind), i.hasUVs4 && o._delayInfo.push(e.VertexBuffer.UV4Kind), i.hasUVs5 && o._delayInfo.push(e.VertexBuffer.UV5Kind), i.hasUVs6 && o._delayInfo.push(e.VertexBuffer.UV6Kind), i.hasColors && o._delayInfo.push(e.VertexBuffer.ColorKind), i.hasMatricesIndices && o._delayInfo.push(e.VertexBuffer.MatricesIndicesKind), i.hasMatricesWeights && o._delayInfo.push(e.VertexBuffer.MatricesWeightsKind), o._delayLoadingFunction = e.VertexData.ImportVertexData) : e.VertexData.ImportVertexData(i, o), r.pushGeometry(o, !0), o }, t }(), i = function (e) { function t(t, i, r, n) { void 0 === r && (r = !1), void 0 === n && (n = null); var o = e.call(this, t, i, void 0, !1, n) || this; return o._canBeRegenerated = r, o._beingRegenerated = !0, o.regenerate(), o._beingRegenerated = !1, o } return T(t, e), t.prototype.canBeRegenerated = function () { return this._canBeRegenerated }, t.prototype.regenerate = function () { this._canBeRegenerated && (this._beingRegenerated = !0, this.setAllVerticesData(this._regenerateVertexData(), !1), this._beingRegenerated = !1) }, t.prototype.asNewGeometry = function (t) { return e.prototype.copy.call(this, t) }, t.prototype.setAllVerticesData = function (t, i) { this._beingRegenerated && e.prototype.setAllVerticesData.call(this, t, !1) }, t.prototype.setVerticesData = function (t, i, r) { this._beingRegenerated && e.prototype.setVerticesData.call(this, t, i, !1) }, t.prototype._regenerateVertexData = function () { throw new Error("Abstract method") }, t.prototype.copy = function (e) { throw new Error("Must be overriden in sub-classes.") }, t.prototype.serialize = function () { var t = e.prototype.serialize.call(this); return t.canBeRegenerated = this.canBeRegenerated(), t }, t }(e.Geometry = t), r = function (t) { function i(i, r, n, o, s, a, l, c, h) { void 0 === h && (h = e.Mesh.DEFAULTSIDE); var u = t.call(this, i, r, l, c) || this; return u.pathArray = n, u.closeArray = o, u.closePath = s, u.offset = a, u.side = h, u } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreateRibbon({ pathArray: this.pathArray, closeArray: this.closeArray, closePath: this.closePath, offset: this.offset, sideOrientation: this.side }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.pathArray, this.closeArray, this.closePath, this.offset, this.canBeRegenerated(), void 0, this.side) }, i }(e._PrimitiveGeometry = i); e.RibbonGeometry = r; var n = function (t) { function i(i, r, n, o, s, a) { void 0 === s && (s = null), void 0 === a && (a = e.Mesh.DEFAULTSIDE); var l = t.call(this, i, r, o, s) || this; return l.size = n, l.side = a, l } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreateBox({ size: this.size, sideOrientation: this.side }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.size, this.canBeRegenerated(), void 0, this.side) }, i.prototype.serialize = function () { var e = t.prototype.serialize.call(this); return e.size = this.size, e }, i.Parse = function (t, r) { if (r.getGeometryByID(t.id)) return null; var n = new i(t.id, r, t.size, t.canBeRegenerated, null); return e.Tags && e.Tags.AddTagsTo(n, t.tags), r.pushGeometry(n, !0), n }, i }(i); e.BoxGeometry = n; var o = function (t) { function i(i, r, n, o, s, a, l) { void 0 === a && (a = null), void 0 === l && (l = e.Mesh.DEFAULTSIDE); var c = t.call(this, i, r, s, a) || this; return c.segments = n, c.diameter = o, c.side = l, c } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreateSphere({ segments: this.segments, diameter: this.diameter, sideOrientation: this.side }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.segments, this.diameter, this.canBeRegenerated(), null, this.side) }, i.prototype.serialize = function () { var e = t.prototype.serialize.call(this); return e.segments = this.segments, e.diameter = this.diameter, e }, i.Parse = function (t, r) { if (r.getGeometryByID(t.id)) return null; var n = new i(t.id, r, t.segments, t.diameter, t.canBeRegenerated, null); return e.Tags && e.Tags.AddTagsTo(n, t.tags), r.pushGeometry(n, !0), n }, i }(i); e.SphereGeometry = o; var s = function (t) { function i(i, r, n, o, s, a, l) { void 0 === a && (a = null), void 0 === l && (l = e.Mesh.DEFAULTSIDE); var c = t.call(this, i, r, s, a) || this; return c.radius = n, c.tessellation = o, c.side = l, c } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreateDisc({ radius: this.radius, tessellation: this.tessellation, sideOrientation: this.side }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.radius, this.tessellation, this.canBeRegenerated(), null, this.side) }, i }(i); e.DiscGeometry = s; var a = function (t) { function i(i, r, n, o, s, a, l, c, h, u) { void 0 === l && (l = 1), void 0 === h && (h = null), void 0 === u && (u = e.Mesh.DEFAULTSIDE); var d = t.call(this, i, r, c, h) || this; return d.height = n, d.diameterTop = o, d.diameterBottom = s, d.tessellation = a, d.subdivisions = l, d.side = u, d } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreateCylinder({ height: this.height, diameterTop: this.diameterTop, diameterBottom: this.diameterBottom, tessellation: this.tessellation, subdivisions: this.subdivisions, sideOrientation: this.side }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.height, this.diameterTop, this.diameterBottom, this.tessellation, this.subdivisions, this.canBeRegenerated(), null, this.side) }, i.prototype.serialize = function () { var e = t.prototype.serialize.call(this); return e.height = this.height, e.diameterTop = this.diameterTop, e.diameterBottom = this.diameterBottom, e.tessellation = this.tessellation, e }, i.Parse = function (t, r) { if (r.getGeometryByID(t.id)) return null; var n = new i(t.id, r, t.height, t.diameterTop, t.diameterBottom, t.tessellation, t.subdivisions, t.canBeRegenerated, null); return e.Tags && e.Tags.AddTagsTo(n, t.tags), r.pushGeometry(n, !0), n }, i }(i); e.CylinderGeometry = a; var l = function (t) { function i(i, r, n, o, s, a, l, c) { void 0 === l && (l = null), void 0 === c && (c = e.Mesh.DEFAULTSIDE); var h = t.call(this, i, r, a, l) || this; return h.diameter = n, h.thickness = o, h.tessellation = s, h.side = c, h } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreateTorus({ diameter: this.diameter, thickness: this.thickness, tessellation: this.tessellation, sideOrientation: this.side }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.diameter, this.thickness, this.tessellation, this.canBeRegenerated(), null, this.side) }, i.prototype.serialize = function () { var e = t.prototype.serialize.call(this); return e.diameter = this.diameter, e.thickness = this.thickness, e.tessellation = this.tessellation, e }, i.Parse = function (t, r) { if (r.getGeometryByID(t.id)) return null; var n = new i(t.id, r, t.diameter, t.thickness, t.tessellation, t.canBeRegenerated, null); return e.Tags && e.Tags.AddTagsTo(n, t.tags), r.pushGeometry(n, !0), n }, i }(i); e.TorusGeometry = l; var c = function (t) { function i(e, i, r, n, o, s, a) { void 0 === a && (a = null); var l = t.call(this, e, i, s, a) || this; return l.width = r, l.height = n, l.subdivisions = o, l } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreateGround({ width: this.width, height: this.height, subdivisions: this.subdivisions }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.width, this.height, this.subdivisions, this.canBeRegenerated(), null) }, i.prototype.serialize = function () { var e = t.prototype.serialize.call(this); return e.width = this.width, e.height = this.height, e.subdivisions = this.subdivisions, e }, i.Parse = function (t, r) { if (r.getGeometryByID(t.id)) return null; var n = new i(t.id, r, t.width, t.height, t.subdivisions, t.canBeRegenerated, null); return e.Tags && e.Tags.AddTagsTo(n, t.tags), r.pushGeometry(n, !0), n }, i }(i); e.GroundGeometry = c; var h = function (t) { function i(e, i, r, n, o, s, a, l, c, h) { void 0 === h && (h = null); var u = t.call(this, e, i, c, h) || this; return u.xmin = r, u.zmin = n, u.xmax = o, u.zmax = s, u.subdivisions = a, u.precision = l, u } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreateTiledGround({ xmin: this.xmin, zmin: this.zmin, xmax: this.xmax, zmax: this.zmax, subdivisions: this.subdivisions, precision: this.precision }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.xmin, this.zmin, this.xmax, this.zmax, this.subdivisions, this.precision, this.canBeRegenerated(), null) }, i }(i); e.TiledGroundGeometry = h; var u = function (t) { function i(i, r, n, o, s, a) { void 0 === s && (s = null), void 0 === a && (a = e.Mesh.DEFAULTSIDE); var l = t.call(this, i, r, o, s) || this; return l.size = n, l.side = a, l } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreatePlane({ size: this.size, sideOrientation: this.side }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.size, this.canBeRegenerated(), null, this.side) }, i.prototype.serialize = function () { var e = t.prototype.serialize.call(this); return e.size = this.size, e }, i.Parse = function (t, r) { if (r.getGeometryByID(t.id)) return null; var n = new i(t.id, r, t.size, t.canBeRegenerated, null); return e.Tags && e.Tags.AddTagsTo(n, t.tags), r.pushGeometry(n, !0), n }, i }(i); e.PlaneGeometry = u; var d = function (t) { function i(i, r, n, o, s, a, l, c, h, u, d) { void 0 === u && (u = null), void 0 === d && (d = e.Mesh.DEFAULTSIDE); var f = t.call(this, i, r, h, u) || this; return f.radius = n, f.tube = o, f.radialSegments = s, f.tubularSegments = a, f.p = l, f.q = c, f.side = d, f } return T(i, t), i.prototype._regenerateVertexData = function () { return e.VertexData.CreateTorusKnot({ radius: this.radius, tube: this.tube, radialSegments: this.radialSegments, tubularSegments: this.tubularSegments, p: this.p, q: this.q, sideOrientation: this.side }) }, i.prototype.copy = function (e) { return new i(e, this.getScene(), this.radius, this.tube, this.radialSegments, this.tubularSegments, this.p, this.q, this.canBeRegenerated(), null, this.side) }, i.prototype.serialize = function () { var e = t.prototype.serialize.call(this); return e.radius = this.radius, e.tube = this.tube, e.radialSegments = this.radialSegments, e.tubularSegments = this.tubularSegments, e.p = this.p, e.q = this.q, e }, i.Parse = function (t, r) { if (r.getGeometryByID(t.id)) return null; var n = new i(t.id, r, t.radius, t.tube, t.radialSegments, t.tubularSegments, t.p, t.q, t.canBeRegenerated, null); return e.Tags && e.Tags.AddTagsTo(n, t.tags), r.pushGeometry(n, !0), n }, i }(i); e.TorusKnotGeometry = d }($a || ($a = {})), function (e) { var t = function () { function t(e) { void 0 === e && (e = 30), this._enabled = !0, this._rollingFrameTime = new i(e) } return t.prototype.sampleFrame = function (t) { if (void 0 === t && (t = e.Tools.Now), this._enabled) { if (null != this._lastFrameTimeMs) { var i = t - this._lastFrameTimeMs; this._rollingFrameTime.add(i) } this._lastFrameTimeMs = t } }, Object.defineProperty(t.prototype, "averageFrameTime", { get: function () { return this._rollingFrameTime.average }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "averageFrameTimeVariance", { get: function () { return this._rollingFrameTime.variance }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "instantaneousFrameTime", { get: function () { return this._rollingFrameTime.history(0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "averageFPS", { get: function () { return 1e3 / this._rollingFrameTime.average }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "instantaneousFPS", { get: function () { var e = this._rollingFrameTime.history(0); return 0 === e ? 0 : 1e3 / e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "isSaturated", { get: function () { return this._rollingFrameTime.isSaturated() }, enumerable: !0, configurable: !0 }), t.prototype.enable = function () { this._enabled = !0 }, t.prototype.disable = function () { this._enabled = !1, this._lastFrameTimeMs = null }, Object.defineProperty(t.prototype, "isEnabled", { get: function () { return this._enabled }, enumerable: !0, configurable: !0 }), t.prototype.reset = function () { this._lastFrameTimeMs = null, this._rollingFrameTime.reset() }, t }(); e.PerformanceMonitor = t; var i = function () { function e(e) { this._samples = new Array(e), this.reset() } return e.prototype.add = function (e) { var t; if (this.isSaturated()) { var i = this._samples[this._pos]; t = i - this.average, this.average -= t / (this._sampleCount - 1), this._m2 -= t * (i - this.average) } else this._sampleCount++; t = e - this.average, this.average += t / this._sampleCount, this._m2 += t * (e - this.average), this.variance = this._m2 / (this._sampleCount - 1), this._samples[this._pos] = e, this._pos++ , this._pos %= this._samples.length }, e.prototype.history = function (e) { if (e >= this._sampleCount || e >= this._samples.length) return 0; var t = this._wrapPosition(this._pos - 1); return this._samples[this._wrapPosition(t - e)] }, e.prototype.isSaturated = function () { return this._sampleCount >= this._samples.length }, e.prototype.reset = function () { this.average = 0, this.variance = 0, this._sampleCount = 0, this._pos = 0, this._m2 = 0 }, e.prototype._wrapPosition = function (e) { var t = this._samples.length; return (e % t + t) % t }, e }(); e.RollingAverage = i }($a || ($a = {})), de = $a || ($a = {}), fe = function () { function e() { } return e.BindEyePosition = function (e, t) { t._forcedViewPosition ? e.setVector3("vEyePosition", t._forcedViewPosition) : e.setVector3("vEyePosition", t._mirroredCameraPosition ? t._mirroredCameraPosition : t.activeCamera.globalPosition) }, e.PrepareDefinesForMergedUV = function (e, t, i) { t._needUVs = !0, t[i] = !0, e.getTextureMatrix().isIdentity(!0) ? (t[i + "DIRECTUV"] = e.coordinatesIndex + 1, 0 === e.coordinatesIndex ? t.MAINUV1 = !0 : t.MAINUV2 = !0) : t[i + "DIRECTUV"] = 0 }, e.BindTextureMatrix = function (e, t, i) { var r = e.getTextureMatrix(); r.isIdentity(!0) || t.updateMatrix(i + "Matrix", r) }, e.PrepareDefinesForMisc = function (e, t, i, r, n, o, s) { s._areMiscDirty && (s.LOGARITHMICDEPTH = i, s.POINTSIZE = r, s.FOG = t.fogEnabled && e.applyFog && t.fogMode !== de.Scene.FOGMODE_NONE && n, s.NONUNIFORMSCALING = e.nonUniformScaling, s.ALPHATEST = o) }, e.PrepareDefinesForFrameBoundValues = function (e, t, i, r, n) { void 0 === n && (n = null); var o, s, a, l, c = !1; o = null == n ? void 0 !== e.clipPlane && null !== e.clipPlane : n, s = null == n ? void 0 !== e.clipPlane2 && null !== e.clipPlane2 : n, a = null == n ? void 0 !== e.clipPlane3 && null !== e.clipPlane3 : n, l = null == n ? void 0 !== e.clipPlane4 && null !== e.clipPlane4 : n, i.CLIPPLANE !== o && (i.CLIPPLANE = o, c = !0), i.CLIPPLANE2 !== s && (i.CLIPPLANE2 = s, c = !0), i.CLIPPLANE3 !== a && (i.CLIPPLANE3 = a, c = !0), i.CLIPPLANE4 !== l && (i.CLIPPLANE4 = l, c = !0), i.DEPTHPREPASS !== !t.getColorWrite() && (i.DEPTHPREPASS = !i.DEPTHPREPASS, c = !0), i.INSTANCES !== r && (i.INSTANCES = r, c = !0), c && i.markAsUnprocessed() }, e.PrepareDefinesForAttributes = function (e, t, i, r, n, o) { if (void 0 === n && (n = !1), void 0 === o && (o = !0), !t._areAttributesDirty && t._needNormals === t._normals && t._needUVs === t._uvs) return !1; if (t._normals = t._needNormals, t._uvs = t._needUVs, t.NORMAL = t._needNormals && e.isVerticesDataPresent(de.VertexBuffer.NormalKind), t._needNormals && e.isVerticesDataPresent(de.VertexBuffer.TangentKind) && (t.TANGENT = !0), t._needUVs ? (t.UV1 = e.isVerticesDataPresent(de.VertexBuffer.UVKind), t.UV2 = e.isVerticesDataPresent(de.VertexBuffer.UV2Kind)) : (t.UV1 = !1, t.UV2 = !1), i) { var s = e.useVertexColors && e.isVerticesDataPresent(de.VertexBuffer.ColorKind); t.VERTEXCOLOR = s, t.VERTEXALPHA = e.hasVertexAlpha && s && o } if (r && (e.useBones && e.computeBonesUsingShaders && e.skeleton ? (t.NUM_BONE_INFLUENCERS = e.numBoneInfluencers, t.BonesPerMesh = e.skeleton.bones.length + 1) : (t.NUM_BONE_INFLUENCERS = 0, t.BonesPerMesh = 0)), n) { var a = e.morphTargetManager; a ? (t.MORPHTARGETS_TANGENT = a.supportsTangents && t.TANGENT, t.MORPHTARGETS_NORMAL = a.supportsNormals && t.NORMAL, t.MORPHTARGETS = 0 < a.numInfluencers, t.NUM_MORPH_INFLUENCERS = a.numInfluencers) : (t.MORPHTARGETS_TANGENT = !1, t.MORPHTARGETS_NORMAL = !1, t.MORPHTARGETS = !1, t.NUM_MORPH_INFLUENCERS = 0) } return !0 }, e.PrepareDefinesForLights = function (e, t, i, r, n, o) { if (void 0 === n && (n = 4), void 0 === o && (o = !1), !i._areLightsDirty) return i._needNormals; var s = 0, a = !1, l = !1, c = !1, h = !1, u = !1; if (e.lightsEnabled && !o) for (var d = 0, f = t._lightSources; d < f.length; d++) { var p = f[d]; switch (a = !0, void 0 === i["LIGHT" + s] && (l = !0), i["LIGHT" + s] = !0, i["SPOTLIGHT" + s] = !1, i["HEMILIGHT" + s] = !1, i["POINTLIGHT" + s] = !1, i["DIRLIGHT" + s] = !1, p.prepareLightSpecificDefines(i, s), i["LIGHT_FALLOFF_PHYSICAL" + s] = !1, i["LIGHT_FALLOFF_GLTF" + s] = !1, i["LIGHT_FALLOFF_STANDARD" + s] = !1, p.falloffType) { case de.Light.FALLOFF_GLTF: i["LIGHT_FALLOFF_GLTF" + s] = !0; break; case de.Light.FALLOFF_PHYSICAL: i["LIGHT_FALLOFF_PHYSICAL" + s] = !0; break; case de.Light.FALLOFF_STANDARD: i["LIGHT_FALLOFF_STANDARD" + s] = !0 }if (r && !p.specular.equalsFloats(0, 0, 0) && (u = !0), i["SHADOW" + s] = !1, i["SHADOWPCF" + s] = !1, i["SHADOWPCSS" + s] = !1, i["SHADOWPOISSON" + s] = !1, i["SHADOWESM" + s] = !1, i["SHADOWCUBE" + s] = !1, i["SHADOWLOWQUALITY" + s] = !1, i["SHADOWMEDIUMQUALITY" + s] = !1, t && t.receiveShadows && e.shadowsEnabled && p.shadowEnabled) { var _ = p.getShadowGenerator(); if (_) { var m = _.getShadowMap(); m && m.renderList && 0 < m.renderList.length && (h = !0, _.prepareDefines(i, s)) } } if (p.lightmapMode != de.Light.LIGHTMAP_DEFAULT ? (c = !0, i["LIGHTMAPEXCLUDED" + s] = !0, i["LIGHTMAPNOSPECULAR" + s] = p.lightmapMode == de.Light.LIGHTMAP_SHADOWSONLY) : (i["LIGHTMAPEXCLUDED" + s] = !1, i["LIGHTMAPNOSPECULAR" + s] = !1), ++s === n) break } i.SPECULARTERM = u, i.SHADOWS = h; for (var g = s; g < n; g++)void 0 !== i["LIGHT" + g] && (i["LIGHT" + g] = !1, i["HEMILIGHT" + s] = !1, i["POINTLIGHT" + s] = !1, i["DIRLIGHT" + s] = !1, i["SPOTLIGHT" + s] = !1, i["SHADOW" + s] = !1); var v = e.getEngine().getCaps(); return void 0 === i.SHADOWFLOAT && (l = !0), i.SHADOWFLOAT = h && (v.textureFloatRender && v.textureFloatLinearFiltering || v.textureHalfFloatRender && v.textureHalfFloatLinearFiltering), i.LIGHTMAPEXCLUDED = c, l && i.rebuild(), a }, e.PrepareUniformsAndSamplersList = function (e, t, i, r) { var n; void 0 === r && (r = 4); var o = null; if (e.uniformsNames) { var s = e; n = s.uniformsNames, o = s.uniformBuffersNames, t = s.samplers, i = s.defines, r = s.maxSimultaneousLights } else n = e, t || (t = []); for (var a = 0; a < r && i["LIGHT" + a]; a++)n.push("vLightData" + a, "vLightDiffuse" + a, "vLightSpecular" + a, "vLightDirection" + a, "vLightFalloff" + a, "vLightGround" + a, "lightMatrix" + a, "shadowsInfo" + a, "depthValues" + a), o && o.push("Light" + a), t.push("shadowSampler" + a), t.push("depthSampler" + a), i["PROJECTEDLIGHTTEXTURE" + a] && (t.push("projectionLightSampler" + a), n.push("textureProjectionMatrix" + a)); i.NUM_MORPH_INFLUENCERS && n.push("morphTargetInfluences") }, e.HandleFallbacksForShadows = function (e, t, i, r) { void 0 === i && (i = 4), void 0 === r && (r = 0); for (var n = 0, o = 0; o < i && e["LIGHT" + o]; o++)0 < o && (n = r + o, t.addFallback(n, "LIGHT" + o)), e.SHADOWS || (e["SHADOW" + o] && t.addFallback(r, "SHADOW" + o), e["SHADOWPCF" + o] && t.addFallback(r, "SHADOWPCF" + o), e["SHADOWPCSS" + o] && t.addFallback(r, "SHADOWPCSS" + o), e["SHADOWPOISSON" + o] && t.addFallback(r, "SHADOWPOISSON" + o), e["SHADOWESM" + o] && t.addFallback(r, "SHADOWESM" + o)); return n++ }, e.PrepareAttributesForMorphTargets = function (e, t, i) { var r = i.NUM_MORPH_INFLUENCERS; if (0 < r && de.Engine.LastCreatedEngine) for (var n = de.Engine.LastCreatedEngine.getCaps().maxVertexAttribs, o = t.morphTargetManager, s = o && o.supportsNormals && i.NORMAL, a = o && o.supportsTangents && i.TANGENT, l = 0; l < r; l++)e.push(de.VertexBuffer.PositionKind + l), s && e.push(de.VertexBuffer.NormalKind + l), a && e.push(de.VertexBuffer.TangentKind + l), e.length > n && de.Tools.Error("Cannot add more vertex attributes for mesh " + t.name) }, e.PrepareAttributesForBones = function (e, t, i, r) { 0 < i.NUM_BONE_INFLUENCERS && (r.addCPUSkinningFallback(0, t), e.push(de.VertexBuffer.MatricesIndicesKind), e.push(de.VertexBuffer.MatricesWeightsKind), 4 < i.NUM_BONE_INFLUENCERS && (e.push(de.VertexBuffer.MatricesIndicesExtraKind), e.push(de.VertexBuffer.MatricesWeightsExtraKind))) }, e.PrepareAttributesForInstances = function (e, t) { t.INSTANCES && (e.push("world0"), e.push("world1"), e.push("world2"), e.push("world3")) }, e.BindLightShadow = function (e, t, i, r, n) { if (e.shadowEnabled && i.receiveShadows) { var o = e.getShadowGenerator(); o && o.bindShadowLight(r, n) } }, e.BindLightProperties = function (e, t, i) { e.transferToEffect(t, i + "") }, e.BindLights = function (t, i, r, n, o, s) { void 0 === o && (o = 4), void 0 === s && (s = !1); for (var a = Math.min(i._lightSources.length, o), l = 0; l < a; l++) { var c = i._lightSources[l], h = l.toString(), u = c.getScaledIntensity(); c._uniformBuffer.bindToEffect(r, "Light" + l), e.BindLightProperties(c, r, l), c.diffuse.scaleToRef(u, de.Tmp.Color3[0]), c._uniformBuffer.updateColor4("vLightDiffuse", de.Tmp.Color3[0], s ? c.radius : c.range, h), n.SPECULARTERM && (c.specular.scaleToRef(u, de.Tmp.Color3[1]), c._uniformBuffer.updateColor3("vLightSpecular", de.Tmp.Color3[1], h)), t.shadowsEnabled && this.BindLightShadow(c, t, i, h, r), c._uniformBuffer.update() } }, e.BindFogParameters = function (e, t, i, r) { void 0 === r && (r = !1), e.fogEnabled && t.applyFog && e.fogMode !== de.Scene.FOGMODE_NONE && (i.setFloat4("vFogInfos", e.fogMode, e.fogStart, e.fogEnd, e.fogDensity), r ? (e.fogColor.toLinearSpaceToRef(this._tempFogColor), i.setColor3("vFogColor", this._tempFogColor)) : i.setColor3("vFogColor", e.fogColor)) }, e.BindBonesParameters = function (e, t) { if (t && e && (e.computeBonesUsingShaders && t._bonesComputationForcedToCPU && (e.computeBonesUsingShaders = !1), e.useBones && e.computeBonesUsingShaders && e.skeleton)) { var i = e.skeleton.getTransformMatrices(e); i && t.setMatrices("mBones", i) } }, e.BindMorphTargetParameters = function (e, t) { var i = e.morphTargetManager; e && i && t.setFloatArray("morphTargetInfluences", i.influences) }, e.BindLogDepth = function (e, t, i) { e.LOGARITHMICDEPTH && t.setFloat("logarithmicDepthConstant", 2 / (Math.log(i.activeCamera.maxZ + 1) / Math.LN2)) }, e.BindClipPlane = function (e, t) { if (t.clipPlane) { var i = t.clipPlane; e.setFloat4("vClipPlane", i.normal.x, i.normal.y, i.normal.z, i.d) } t.clipPlane2 && (i = t.clipPlane2, e.setFloat4("vClipPlane2", i.normal.x, i.normal.y, i.normal.z, i.d)), t.clipPlane3 && (i = t.clipPlane3, e.setFloat4("vClipPlane3", i.normal.x, i.normal.y, i.normal.z, i.d)), t.clipPlane4 && (i = t.clipPlane4, e.setFloat4("vClipPlane4", i.normal.x, i.normal.y, i.normal.z, i.d)) }, e._tempFogColor = de.Color3.Black(), e }(), de.MaterialHelper = fe, _e = function (e) { function t(t, i) { var r = e.call(this, t, i) || this; return r._normalMatrix = new pe.Matrix, r.storeEffectOnSubMeshes = !0, r } return T(t, e), t.prototype.getEffect = function () { return this._activeEffect }, t.prototype.isReady = function (e, t) { return !!e && (!e.subMeshes || 0 === e.subMeshes.length || this.isReadyForSubMesh(e, e.subMeshes[0], t)) }, t.prototype.bindOnlyWorldMatrix = function (e) { this._activeEffect.setMatrix("world", e) }, t.prototype.bindOnlyNormalMatrix = function (e) { this._activeEffect.setMatrix("normalMatrix", e) }, t.prototype.bind = function (e, t) { t && this.bindForSubMesh(e, t, t.subMeshes[0]) }, t.prototype._afterBind = function (t, i) { void 0 === i && (i = null), e.prototype._afterBind.call(this, t), this.getScene()._cachedEffect = i }, t.prototype._mustRebind = function (e, t, i) { return void 0 === i && (i = 1), e.isCachedMaterialInvalid(this, t, i) }, t }((pe = $a || ($a = {})).Material), pe.PushMaterial = _e, function (e) { var t = function (e) { function t() { var t = e.call(this) || this; return t.MAINUV1 = !1, t.MAINUV2 = !1, t.DIFFUSE = !1, t.DIFFUSEDIRECTUV = 0, t.AMBIENT = !1, t.AMBIENTDIRECTUV = 0, t.OPACITY = !1, t.OPACITYDIRECTUV = 0, t.OPACITYRGB = !1, t.REFLECTION = !1, t.EMISSIVE = !1, t.EMISSIVEDIRECTUV = 0, t.SPECULAR = !1, t.SPECULARDIRECTUV = 0, t.BUMP = !1, t.BUMPDIRECTUV = 0, t.PARALLAX = !1, t.PARALLAXOCCLUSION = !1, t.SPECULAROVERALPHA = !1, t.CLIPPLANE = !1, t.CLIPPLANE2 = !1, t.CLIPPLANE3 = !1, t.CLIPPLANE4 = !1, t.ALPHATEST = !1, t.DEPTHPREPASS = !1, t.ALPHAFROMDIFFUSE = !1, t.POINTSIZE = !1, t.FOG = !1, t.SPECULARTERM = !1, t.DIFFUSEFRESNEL = !1, t.OPACITYFRESNEL = !1, t.REFLECTIONFRESNEL = !1, t.REFRACTIONFRESNEL = !1, t.EMISSIVEFRESNEL = !1, t.FRESNEL = !1, t.NORMAL = !1, t.UV1 = !1, t.UV2 = !1, t.VERTEXCOLOR = !1, t.VERTEXALPHA = !1, t.NUM_BONE_INFLUENCERS = 0, t.BonesPerMesh = 0, t.INSTANCES = !1, t.GLOSSINESS = !1, t.ROUGHNESS = !1, t.EMISSIVEASILLUMINATION = !1, t.LINKEMISSIVEWITHDIFFUSE = !1, t.REFLECTIONFRESNELFROMSPECULAR = !1, t.LIGHTMAP = !1, t.LIGHTMAPDIRECTUV = 0, t.OBJECTSPACE_NORMALMAP = !1, t.USELIGHTMAPASSHADOWMAP = !1, t.REFLECTIONMAP_3D = !1, t.REFLECTIONMAP_SPHERICAL = !1, t.REFLECTIONMAP_PLANAR = !1, t.REFLECTIONMAP_CUBIC = !1, t.USE_LOCAL_REFLECTIONMAP_CUBIC = !1, t.REFLECTIONMAP_PROJECTION = !1, t.REFLECTIONMAP_SKYBOX = !1, t.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1, t.REFLECTIONMAP_EXPLICIT = !1, t.REFLECTIONMAP_EQUIRECTANGULAR = !1, t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1, t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1, t.INVERTCUBICMAP = !1, t.LOGARITHMICDEPTH = !1, t.REFRACTION = !1, t.REFRACTIONMAP_3D = !1, t.REFLECTIONOVERALPHA = !1, t.TWOSIDEDLIGHTING = !1, t.SHADOWFLOAT = !1, t.MORPHTARGETS = !1, t.MORPHTARGETS_NORMAL = !1, t.MORPHTARGETS_TANGENT = !1, t.NUM_MORPH_INFLUENCERS = 0, t.NONUNIFORMSCALING = !1, t.PREMULTIPLYALPHA = !1, t.IMAGEPROCESSING = !1, t.VIGNETTE = !1, t.VIGNETTEBLENDMODEMULTIPLY = !1, t.VIGNETTEBLENDMODEOPAQUE = !1, t.TONEMAPPING = !1, t.TONEMAPPING_ACES = !1, t.CONTRAST = !1, t.COLORCURVES = !1, t.COLORGRADING = !1, t.COLORGRADING3D = !1, t.SAMPLER3DGREENDEPTH = !1, t.SAMPLER3DBGRMAP = !1, t.IMAGEPROCESSINGPOSTPROCESS = !1, t.IS_REFLECTION_LINEAR = !1, t.IS_REFRACTION_LINEAR = !1, t.EXPOSURE = !1, t.rebuild(), t } return T(t, e), t.prototype.setReflectionMode = function (e) { for (var t = 0, i = ["REFLECTIONMAP_CUBIC", "REFLECTIONMAP_EXPLICIT", "REFLECTIONMAP_PLANAR", "REFLECTIONMAP_PROJECTION", "REFLECTIONMAP_PROJECTION", "REFLECTIONMAP_SKYBOX", "REFLECTIONMAP_SPHERICAL", "REFLECTIONMAP_EQUIRECTANGULAR", "REFLECTIONMAP_EQUIRECTANGULAR_FIXED", "REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"]; t < i.length; t++) { var r = i[t]; this[r] = r === e } }, t }(e.MaterialDefines); e.StandardMaterialDefines = t; var i = function (i) { function r(t, n) { var o = i.call(this, t, n) || this; return o.ambientColor = new e.Color3(0, 0, 0), o.diffuseColor = new e.Color3(1, 1, 1), o.specularColor = new e.Color3(1, 1, 1), o.emissiveColor = new e.Color3(0, 0, 0), o.specularPower = 64, o._useAlphaFromDiffuseTexture = !1, o._useEmissiveAsIllumination = !1, o._linkEmissiveWithDiffuse = !1, o._useSpecularOverAlpha = !1, o._useReflectionOverAlpha = !1, o._disableLighting = !1, o._useObjectSpaceNormalMap = !1, o._useParallax = !1, o._useParallaxOcclusion = !1, o.parallaxScaleBias = .05, o._roughness = 0, o.indexOfRefraction = .98, o.invertRefractionY = !0, o.alphaCutOff = .4, o._useLightmapAsShadowmap = !1, o._useReflectionFresnelFromSpecular = !1, o._useGlossinessFromSpecularMapAlpha = !1, o._maxSimultaneousLights = 4, o._invertNormalMapX = !1, o._invertNormalMapY = !1, o._twoSidedLighting = !1, o._renderTargets = new e.SmartArray(16), o._worldViewProjectionMatrix = e.Matrix.Zero(), o._globalAmbientColor = new e.Color3(0, 0, 0), o._attachImageProcessingConfiguration(null), o.getRenderTargetTextures = function () { return o._renderTargets.reset(), r.ReflectionTextureEnabled && o._reflectionTexture && o._reflectionTexture.isRenderTarget && o._renderTargets.push(o._reflectionTexture), r.RefractionTextureEnabled && o._refractionTexture && o._refractionTexture.isRenderTarget && o._renderTargets.push(o._refractionTexture), o._renderTargets }, o } return T(r, i), Object.defineProperty(r.prototype, "imageProcessingConfiguration", { get: function () { return this._imageProcessingConfiguration }, set: function (e) { this._attachImageProcessingConfiguration(e), this._markAllSubMeshesAsTexturesDirty() }, enumerable: !0, configurable: !0 }), r.prototype._attachImageProcessingConfiguration = function (e) { var t = this; e !== this._imageProcessingConfiguration && (this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), this._imageProcessingConfiguration = e || this.getScene().imageProcessingConfiguration, this._imageProcessingConfiguration && (this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add(function (e) { t._markAllSubMeshesAsImageProcessingDirty() }))) }, Object.defineProperty(r.prototype, "cameraColorCurvesEnabled", { get: function () { return this.imageProcessingConfiguration.colorCurvesEnabled }, set: function (e) { this.imageProcessingConfiguration.colorCurvesEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "cameraColorGradingEnabled", { get: function () { return this.imageProcessingConfiguration.colorGradingEnabled }, set: function (e) { this.imageProcessingConfiguration.colorGradingEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "cameraToneMappingEnabled", { get: function () { return this._imageProcessingConfiguration.toneMappingEnabled }, set: function (e) { this._imageProcessingConfiguration.toneMappingEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "cameraExposure", { get: function () { return this._imageProcessingConfiguration.exposure }, set: function (e) { this._imageProcessingConfiguration.exposure = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "cameraContrast", { get: function () { return this._imageProcessingConfiguration.contrast }, set: function (e) { this._imageProcessingConfiguration.contrast = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "cameraColorGradingTexture", { get: function () { return this._imageProcessingConfiguration.colorGradingTexture }, set: function (e) { this._imageProcessingConfiguration.colorGradingTexture = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "cameraColorCurves", { get: function () { return this._imageProcessingConfiguration.colorCurves }, set: function (e) { this._imageProcessingConfiguration.colorCurves = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "hasRenderTargetTextures", { get: function () { return !!(r.ReflectionTextureEnabled && this._reflectionTexture && this._reflectionTexture.isRenderTarget) || !!(r.RefractionTextureEnabled && this._refractionTexture && this._refractionTexture.isRenderTarget) }, enumerable: !0, configurable: !0 }), r.prototype.getClassName = function () { return "StandardMaterial" }, Object.defineProperty(r.prototype, "useLogarithmicDepth", { get: function () { return this._useLogarithmicDepth }, set: function (e) { this._useLogarithmicDepth = e && this.getScene().getEngine().getCaps().fragmentDepthSupported, this._markAllSubMeshesAsMiscDirty() }, enumerable: !0, configurable: !0 }), r.prototype.needAlphaBlending = function () { return this.alpha < 1 || null != this._opacityTexture || this._shouldUseAlphaFromDiffuseTexture() || this._opacityFresnelParameters && this._opacityFresnelParameters.isEnabled }, r.prototype.needAlphaTesting = function () { return null != this._diffuseTexture && this._diffuseTexture.hasAlpha }, r.prototype._shouldUseAlphaFromDiffuseTexture = function () { return null != this._diffuseTexture && this._diffuseTexture.hasAlpha && this._useAlphaFromDiffuseTexture }, r.prototype.getAlphaTestTexture = function () { return this._diffuseTexture }, r.prototype.isReadyForSubMesh = function (i, n, o) { if (void 0 === o && (o = !1), n.effect && this.isFrozen && this._wasPreviouslyReady) return !0; n._materialDefines || (n._materialDefines = new t); var s = this.getScene(), a = n._materialDefines; if (!this.checkReadyOnEveryCall && n.effect && a._renderId === s.getRenderId()) return !0; var l = s.getEngine(); if (a._needNormals = e.MaterialHelper.PrepareDefinesForLights(s, i, a, !0, this._maxSimultaneousLights, this._disableLighting), a._areTexturesDirty) { if (a._needUVs = !1, a.MAINUV1 = !1, a.MAINUV2 = !1, s.texturesEnabled) { if (this._diffuseTexture && r.DiffuseTextureEnabled) { if (!this._diffuseTexture.isReadyOrNotBlocking()) return !1; e.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture, a, "DIFFUSE") } else a.DIFFUSE = !1; if (this._ambientTexture && r.AmbientTextureEnabled) { if (!this._ambientTexture.isReadyOrNotBlocking()) return !1; e.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture, a, "AMBIENT") } else a.AMBIENT = !1; if (this._opacityTexture && r.OpacityTextureEnabled) { if (!this._opacityTexture.isReadyOrNotBlocking()) return !1; e.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture, a, "OPACITY"), a.OPACITYRGB = this._opacityTexture.getAlphaFromRGB } else a.OPACITY = !1; if (this._reflectionTexture && r.ReflectionTextureEnabled) { if (!this._reflectionTexture.isReadyOrNotBlocking()) return !1; switch (a._needNormals = !0, a.REFLECTION = !0, a.ROUGHNESS = 0 < this._roughness, a.REFLECTIONOVERALPHA = this._useReflectionOverAlpha, a.INVERTCUBICMAP = this._reflectionTexture.coordinatesMode === e.Texture.INVCUBIC_MODE, a.REFLECTIONMAP_3D = this._reflectionTexture.isCube, this._reflectionTexture.coordinatesMode) { case e.Texture.EXPLICIT_MODE: a.setReflectionMode("REFLECTIONMAP_EXPLICIT"); break; case e.Texture.PLANAR_MODE: a.setReflectionMode("REFLECTIONMAP_PLANAR"); break; case e.Texture.PROJECTION_MODE: a.setReflectionMode("REFLECTIONMAP_PROJECTION"); break; case e.Texture.SKYBOX_MODE: a.setReflectionMode("REFLECTIONMAP_SKYBOX"), a.REFLECTIONMAP_SKYBOX_TRANSFORMED = !this._reflectionTexture.getReflectionTextureMatrix().isIdentity(); break; case e.Texture.SPHERICAL_MODE: a.setReflectionMode("REFLECTIONMAP_SPHERICAL"); break; case e.Texture.EQUIRECTANGULAR_MODE: a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR"); break; case e.Texture.FIXED_EQUIRECTANGULAR_MODE: a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED"); break; case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE: a.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"); break; case e.Texture.CUBIC_MODE: case e.Texture.INVCUBIC_MODE: default: a.setReflectionMode("REFLECTIONMAP_CUBIC") }a.USE_LOCAL_REFLECTIONMAP_CUBIC = !!this._reflectionTexture.boundingBoxSize } else a.REFLECTION = !1; if (this._emissiveTexture && r.EmissiveTextureEnabled) { if (!this._emissiveTexture.isReadyOrNotBlocking()) return !1; e.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture, a, "EMISSIVE") } else a.EMISSIVE = !1; if (this._lightmapTexture && r.LightmapTextureEnabled) { if (!this._lightmapTexture.isReadyOrNotBlocking()) return !1; e.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture, a, "LIGHTMAP"), a.USELIGHTMAPASSHADOWMAP = this._useLightmapAsShadowmap } else a.LIGHTMAP = !1; if (this._specularTexture && r.SpecularTextureEnabled) { if (!this._specularTexture.isReadyOrNotBlocking()) return !1; e.MaterialHelper.PrepareDefinesForMergedUV(this._specularTexture, a, "SPECULAR"), a.GLOSSINESS = this._useGlossinessFromSpecularMapAlpha } else a.SPECULAR = !1; if (s.getEngine().getCaps().standardDerivatives && this._bumpTexture && r.BumpTextureEnabled) { if (!this._bumpTexture.isReady()) return !1; e.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture, a, "BUMP"), a.PARALLAX = this._useParallax, a.PARALLAXOCCLUSION = this._useParallaxOcclusion, a.OBJECTSPACE_NORMALMAP = this._useObjectSpaceNormalMap } else a.BUMP = !1; if (this._refractionTexture && r.RefractionTextureEnabled) { if (!this._refractionTexture.isReadyOrNotBlocking()) return !1; a._needUVs = !0, a.REFRACTION = !0, a.REFRACTIONMAP_3D = this._refractionTexture.isCube } else a.REFRACTION = !1; a.TWOSIDEDLIGHTING = !this._backFaceCulling && this._twoSidedLighting } else a.DIFFUSE = !1, a.AMBIENT = !1, a.OPACITY = !1, a.REFLECTION = !1, a.EMISSIVE = !1, a.LIGHTMAP = !1, a.BUMP = !1, a.REFRACTION = !1; a.ALPHAFROMDIFFUSE = this._shouldUseAlphaFromDiffuseTexture(), a.EMISSIVEASILLUMINATION = this._useEmissiveAsIllumination, a.LINKEMISSIVEWITHDIFFUSE = this._linkEmissiveWithDiffuse, a.SPECULAROVERALPHA = this._useSpecularOverAlpha, a.PREMULTIPLYALPHA = this.alphaMode === e.Engine.ALPHA_PREMULTIPLIED || this.alphaMode === e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF } if (a._areImageProcessingDirty && this._imageProcessingConfiguration) { if (!this._imageProcessingConfiguration.isReady()) return !1; this._imageProcessingConfiguration.prepareDefines(a), a.IS_REFLECTION_LINEAR = null != this.reflectionTexture && !this.reflectionTexture.gammaSpace, a.IS_REFRACTION_LINEAR = null != this.refractionTexture && !this.refractionTexture.gammaSpace } if (a._areFresnelDirty && (r.FresnelEnabled ? (this._diffuseFresnelParameters || this._opacityFresnelParameters || this._emissiveFresnelParameters || this._refractionFresnelParameters || this._reflectionFresnelParameters) && (a.DIFFUSEFRESNEL = this._diffuseFresnelParameters && this._diffuseFresnelParameters.isEnabled, a.OPACITYFRESNEL = this._opacityFresnelParameters && this._opacityFresnelParameters.isEnabled, a.REFLECTIONFRESNEL = this._reflectionFresnelParameters && this._reflectionFresnelParameters.isEnabled, a.REFLECTIONFRESNELFROMSPECULAR = this._useReflectionFresnelFromSpecular, a.REFRACTIONFRESNEL = this._refractionFresnelParameters && this._refractionFresnelParameters.isEnabled, a.EMISSIVEFRESNEL = this._emissiveFresnelParameters && this._emissiveFresnelParameters.isEnabled, a._needNormals = !0, a.FRESNEL = !0) : a.FRESNEL = !1), e.MaterialHelper.PrepareDefinesForMisc(i, s, this._useLogarithmicDepth, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(i), a), e.MaterialHelper.PrepareDefinesForAttributes(i, a, !0, !0, !0), e.MaterialHelper.PrepareDefinesForFrameBoundValues(s, l, a, o), a.isDirty) { a.markAsProcessed(), s.resetCachedMaterial(); var c = new e.EffectFallbacks; a.REFLECTION && c.addFallback(0, "REFLECTION"), a.SPECULAR && c.addFallback(0, "SPECULAR"), a.BUMP && c.addFallback(0, "BUMP"), a.PARALLAX && c.addFallback(1, "PARALLAX"), a.PARALLAXOCCLUSION && c.addFallback(0, "PARALLAXOCCLUSION"), a.SPECULAROVERALPHA && c.addFallback(0, "SPECULAROVERALPHA"), a.FOG && c.addFallback(1, "FOG"), a.POINTSIZE && c.addFallback(0, "POINTSIZE"), a.LOGARITHMICDEPTH && c.addFallback(0, "LOGARITHMICDEPTH"), e.MaterialHelper.HandleFallbacksForShadows(a, c, this._maxSimultaneousLights), a.SPECULARTERM && c.addFallback(0, "SPECULARTERM"), a.DIFFUSEFRESNEL && c.addFallback(1, "DIFFUSEFRESNEL"), a.OPACITYFRESNEL && c.addFallback(2, "OPACITYFRESNEL"), a.REFLECTIONFRESNEL && c.addFallback(3, "REFLECTIONFRESNEL"), a.EMISSIVEFRESNEL && c.addFallback(4, "EMISSIVEFRESNEL"), a.FRESNEL && c.addFallback(4, "FRESNEL"); var h = [e.VertexBuffer.PositionKind]; a.NORMAL && h.push(e.VertexBuffer.NormalKind), a.UV1 && h.push(e.VertexBuffer.UVKind), a.UV2 && h.push(e.VertexBuffer.UV2Kind), a.VERTEXCOLOR && h.push(e.VertexBuffer.ColorKind), e.MaterialHelper.PrepareAttributesForBones(h, i, a, c), e.MaterialHelper.PrepareAttributesForInstances(h, a), e.MaterialHelper.PrepareAttributesForMorphTargets(h, i, a); var u = "default", d = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vAmbientColor", "vDiffuseColor", "vSpecularColor", "vEmissiveColor", "vFogInfos", "vFogColor", "pointSize", "vDiffuseInfos", "vAmbientInfos", "vOpacityInfos", "vReflectionInfos", "vEmissiveInfos", "vSpecularInfos", "vBumpInfos", "vLightmapInfos", "vRefractionInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "diffuseMatrix", "ambientMatrix", "opacityMatrix", "reflectionMatrix", "emissiveMatrix", "specularMatrix", "bumpMatrix", "normalMatrix", "lightmapMatrix", "refractionMatrix", "diffuseLeftColor", "diffuseRightColor", "opacityParts", "reflectionLeftColor", "reflectionRightColor", "emissiveLeftColor", "emissiveRightColor", "refractionLeftColor", "refractionRightColor", "vReflectionPosition", "vReflectionSize", "logarithmicDepthConstant", "vTangentSpaceParams", "alphaCutOff"], f = ["diffuseSampler", "ambientSampler", "opacitySampler", "reflectionCubeSampler", "reflection2DSampler", "emissiveSampler", "specularSampler", "bumpSampler", "lightmapSampler", "refractionCubeSampler", "refraction2DSampler"], p = ["Material", "Scene"]; e.ImageProcessingConfiguration && (e.ImageProcessingConfiguration.PrepareUniforms(d, a), e.ImageProcessingConfiguration.PrepareSamplers(f, a)), e.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: d, uniformBuffersNames: p, samplers: f, defines: a, maxSimultaneousLights: this._maxSimultaneousLights }), this.customShaderNameResolve && (u = this.customShaderNameResolve(u, d, p, f, a)); var _ = a.toString(); n.setEffect(s.getEngine().createEffect(u, { attributes: h, uniformsNames: d, uniformBuffersNames: p, samplers: f, defines: _, fallbacks: c, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: this._maxSimultaneousLights, maxSimultaneousMorphTargets: a.NUM_MORPH_INFLUENCERS } }, l), a), this.buildUniformLayout() } return !(!n.effect || !n.effect.isReady()) && (a._renderId = s.getRenderId(), this._wasPreviouslyReady = !0) }, r.prototype.buildUniformLayout = function () { this._uniformBuffer.addUniform("diffuseLeftColor", 4), this._uniformBuffer.addUniform("diffuseRightColor", 4), this._uniformBuffer.addUniform("opacityParts", 4), this._uniformBuffer.addUniform("reflectionLeftColor", 4), this._uniformBuffer.addUniform("reflectionRightColor", 4), this._uniformBuffer.addUniform("refractionLeftColor", 4), this._uniformBuffer.addUniform("refractionRightColor", 4), this._uniformBuffer.addUniform("emissiveLeftColor", 4), this._uniformBuffer.addUniform("emissiveRightColor", 4), this._uniformBuffer.addUniform("vDiffuseInfos", 2), this._uniformBuffer.addUniform("vAmbientInfos", 2), this._uniformBuffer.addUniform("vOpacityInfos", 2), this._uniformBuffer.addUniform("vReflectionInfos", 2), this._uniformBuffer.addUniform("vReflectionPosition", 3), this._uniformBuffer.addUniform("vReflectionSize", 3), this._uniformBuffer.addUniform("vEmissiveInfos", 2), this._uniformBuffer.addUniform("vLightmapInfos", 2), this._uniformBuffer.addUniform("vSpecularInfos", 2), this._uniformBuffer.addUniform("vBumpInfos", 3), this._uniformBuffer.addUniform("diffuseMatrix", 16), this._uniformBuffer.addUniform("ambientMatrix", 16), this._uniformBuffer.addUniform("opacityMatrix", 16), this._uniformBuffer.addUniform("reflectionMatrix", 16), this._uniformBuffer.addUniform("emissiveMatrix", 16), this._uniformBuffer.addUniform("lightmapMatrix", 16), this._uniformBuffer.addUniform("specularMatrix", 16), this._uniformBuffer.addUniform("bumpMatrix", 16), this._uniformBuffer.addUniform("vTangentSpaceParams", 2), this._uniformBuffer.addUniform("refractionMatrix", 16), this._uniformBuffer.addUniform("vRefractionInfos", 4), this._uniformBuffer.addUniform("vSpecularColor", 4), this._uniformBuffer.addUniform("vEmissiveColor", 3), this._uniformBuffer.addUniform("vDiffuseColor", 4), this._uniformBuffer.addUniform("pointSize", 1), this._uniformBuffer.create() }, r.prototype.unbind = function () { if (this._activeEffect) { var e = !1; this._reflectionTexture && this._reflectionTexture.isRenderTarget && (this._activeEffect.setTexture("reflection2DSampler", null), e = !0), this._refractionTexture && this._refractionTexture.isRenderTarget && (this._activeEffect.setTexture("refraction2DSampler", null), e = !0), e && this._markAllSubMeshesAsTexturesDirty() } i.prototype.unbind.call(this) }, r.prototype.bindForSubMesh = function (t, i, n) { var o = this.getScene(), s = n._materialDefines; if (s) { var a = n.effect; if (a) { this._activeEffect = a, this.bindOnlyWorldMatrix(t), s.OBJECTSPACE_NORMALMAP && (t.toNormalMatrix(this._normalMatrix), this.bindOnlyNormalMatrix(this._normalMatrix)); var l = this._mustRebind(o, a, i.visibility); if (e.MaterialHelper.BindBonesParameters(i, a), l) { if (this._uniformBuffer.bindToEffect(a, "Material"), this.bindViewProjection(a), !this._uniformBuffer.useUbo || !this.isFrozen || !this._uniformBuffer.isSync) { if (r.FresnelEnabled && s.FRESNEL && (this.diffuseFresnelParameters && this.diffuseFresnelParameters.isEnabled && (this._uniformBuffer.updateColor4("diffuseLeftColor", this.diffuseFresnelParameters.leftColor, this.diffuseFresnelParameters.power), this._uniformBuffer.updateColor4("diffuseRightColor", this.diffuseFresnelParameters.rightColor, this.diffuseFresnelParameters.bias)), this.opacityFresnelParameters && this.opacityFresnelParameters.isEnabled && this._uniformBuffer.updateColor4("opacityParts", new e.Color3(this.opacityFresnelParameters.leftColor.toLuminance(), this.opacityFresnelParameters.rightColor.toLuminance(), this.opacityFresnelParameters.bias), this.opacityFresnelParameters.power), this.reflectionFresnelParameters && this.reflectionFresnelParameters.isEnabled && (this._uniformBuffer.updateColor4("reflectionLeftColor", this.reflectionFresnelParameters.leftColor, this.reflectionFresnelParameters.power), this._uniformBuffer.updateColor4("reflectionRightColor", this.reflectionFresnelParameters.rightColor, this.reflectionFresnelParameters.bias)), this.refractionFresnelParameters && this.refractionFresnelParameters.isEnabled && (this._uniformBuffer.updateColor4("refractionLeftColor", this.refractionFresnelParameters.leftColor, this.refractionFresnelParameters.power), this._uniformBuffer.updateColor4("refractionRightColor", this.refractionFresnelParameters.rightColor, this.refractionFresnelParameters.bias)), this.emissiveFresnelParameters && this.emissiveFresnelParameters.isEnabled && (this._uniformBuffer.updateColor4("emissiveLeftColor", this.emissiveFresnelParameters.leftColor, this.emissiveFresnelParameters.power), this._uniformBuffer.updateColor4("emissiveRightColor", this.emissiveFresnelParameters.rightColor, this.emissiveFresnelParameters.bias))), o.texturesEnabled) { if (this._diffuseTexture && r.DiffuseTextureEnabled && (this._uniformBuffer.updateFloat2("vDiffuseInfos", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level), e.MaterialHelper.BindTextureMatrix(this._diffuseTexture, this._uniformBuffer, "diffuse"), this._diffuseTexture.hasAlpha && a.setFloat("alphaCutOff", this.alphaCutOff)), this._ambientTexture && r.AmbientTextureEnabled && (this._uniformBuffer.updateFloat2("vAmbientInfos", this._ambientTexture.coordinatesIndex, this._ambientTexture.level), e.MaterialHelper.BindTextureMatrix(this._ambientTexture, this._uniformBuffer, "ambient")), this._opacityTexture && r.OpacityTextureEnabled && (this._uniformBuffer.updateFloat2("vOpacityInfos", this._opacityTexture.coordinatesIndex, this._opacityTexture.level), e.MaterialHelper.BindTextureMatrix(this._opacityTexture, this._uniformBuffer, "opacity")), this._reflectionTexture && r.ReflectionTextureEnabled && (this._uniformBuffer.updateFloat2("vReflectionInfos", this._reflectionTexture.level, this.roughness), this._uniformBuffer.updateMatrix("reflectionMatrix", this._reflectionTexture.getReflectionTextureMatrix()), this._reflectionTexture.boundingBoxSize)) { var c = this._reflectionTexture; this._uniformBuffer.updateVector3("vReflectionPosition", c.boundingBoxPosition), this._uniformBuffer.updateVector3("vReflectionSize", c.boundingBoxSize) } if (this._emissiveTexture && r.EmissiveTextureEnabled && (this._uniformBuffer.updateFloat2("vEmissiveInfos", this._emissiveTexture.coordinatesIndex, this._emissiveTexture.level), e.MaterialHelper.BindTextureMatrix(this._emissiveTexture, this._uniformBuffer, "emissive")), this._lightmapTexture && r.LightmapTextureEnabled && (this._uniformBuffer.updateFloat2("vLightmapInfos", this._lightmapTexture.coordinatesIndex, this._lightmapTexture.level), e.MaterialHelper.BindTextureMatrix(this._lightmapTexture, this._uniformBuffer, "lightmap")), this._specularTexture && r.SpecularTextureEnabled && (this._uniformBuffer.updateFloat2("vSpecularInfos", this._specularTexture.coordinatesIndex, this._specularTexture.level), e.MaterialHelper.BindTextureMatrix(this._specularTexture, this._uniformBuffer, "specular")), this._bumpTexture && o.getEngine().getCaps().standardDerivatives && r.BumpTextureEnabled && (this._uniformBuffer.updateFloat3("vBumpInfos", this._bumpTexture.coordinatesIndex, 1 / this._bumpTexture.level, this.parallaxScaleBias), e.MaterialHelper.BindTextureMatrix(this._bumpTexture, this._uniformBuffer, "bump"), o._mirroredCameraPosition ? this._uniformBuffer.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? 1 : -1, this._invertNormalMapY ? 1 : -1) : this._uniformBuffer.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? -1 : 1, this._invertNormalMapY ? -1 : 1)), this._refractionTexture && r.RefractionTextureEnabled) { var h = 1; this._refractionTexture.isCube || (this._uniformBuffer.updateMatrix("refractionMatrix", this._refractionTexture.getReflectionTextureMatrix()), this._refractionTexture.depth && (h = this._refractionTexture.depth)), this._uniformBuffer.updateFloat4("vRefractionInfos", this._refractionTexture.level, this.indexOfRefraction, h, this.invertRefractionY ? -1 : 1) } } this.pointsCloud && this._uniformBuffer.updateFloat("pointSize", this.pointSize), s.SPECULARTERM && this._uniformBuffer.updateColor4("vSpecularColor", this.specularColor, this.specularPower), this._uniformBuffer.updateColor3("vEmissiveColor", this.emissiveColor), this._uniformBuffer.updateColor4("vDiffuseColor", this.diffuseColor, this.alpha * i.visibility) } o.texturesEnabled && (this._diffuseTexture && r.DiffuseTextureEnabled && a.setTexture("diffuseSampler", this._diffuseTexture), this._ambientTexture && r.AmbientTextureEnabled && a.setTexture("ambientSampler", this._ambientTexture), this._opacityTexture && r.OpacityTextureEnabled && a.setTexture("opacitySampler", this._opacityTexture), this._reflectionTexture && r.ReflectionTextureEnabled && (this._reflectionTexture.isCube ? a.setTexture("reflectionCubeSampler", this._reflectionTexture) : a.setTexture("reflection2DSampler", this._reflectionTexture)), this._emissiveTexture && r.EmissiveTextureEnabled && a.setTexture("emissiveSampler", this._emissiveTexture), this._lightmapTexture && r.LightmapTextureEnabled && a.setTexture("lightmapSampler", this._lightmapTexture), this._specularTexture && r.SpecularTextureEnabled && a.setTexture("specularSampler", this._specularTexture), this._bumpTexture && o.getEngine().getCaps().standardDerivatives && r.BumpTextureEnabled && a.setTexture("bumpSampler", this._bumpTexture), this._refractionTexture && r.RefractionTextureEnabled) && (h = 1, this._refractionTexture.isCube ? a.setTexture("refractionCubeSampler", this._refractionTexture) : a.setTexture("refraction2DSampler", this._refractionTexture)), e.MaterialHelper.BindClipPlane(a, o), o.ambientColor.multiplyToRef(this.ambientColor, this._globalAmbientColor), e.MaterialHelper.BindEyePosition(a, o), a.setColor3("vAmbientColor", this._globalAmbientColor) } !l && this.isFrozen || (o.lightsEnabled && !this._disableLighting && e.MaterialHelper.BindLights(o, i, a, s, this._maxSimultaneousLights), (o.fogEnabled && i.applyFog && o.fogMode !== e.Scene.FOGMODE_NONE || this._reflectionTexture || this._refractionTexture) && this.bindView(a), e.MaterialHelper.BindFogParameters(o, i, a), s.NUM_MORPH_INFLUENCERS && e.MaterialHelper.BindMorphTargetParameters(i, a), e.MaterialHelper.BindLogDepth(s, a, o), this._imageProcessingConfiguration && !this._imageProcessingConfiguration.applyByPostProcess && this._imageProcessingConfiguration.bind(this._activeEffect)), this._uniformBuffer.update(), this._afterBind(i, this._activeEffect) } } }, r.prototype.getAnimatables = function () { var e = []; return this._diffuseTexture && this._diffuseTexture.animations && 0 < this._diffuseTexture.animations.length && e.push(this._diffuseTexture), this._ambientTexture && this._ambientTexture.animations && 0 < this._ambientTexture.animations.length && e.push(this._ambientTexture), this._opacityTexture && this._opacityTexture.animations && 0 < this._opacityTexture.animations.length && e.push(this._opacityTexture), this._reflectionTexture && this._reflectionTexture.animations && 0 < this._reflectionTexture.animations.length && e.push(this._reflectionTexture), this._emissiveTexture && this._emissiveTexture.animations && 0 < this._emissiveTexture.animations.length && e.push(this._emissiveTexture), this._specularTexture && this._specularTexture.animations && 0 < this._specularTexture.animations.length && e.push(this._specularTexture), this._bumpTexture && this._bumpTexture.animations && 0 < this._bumpTexture.animations.length && e.push(this._bumpTexture), this._lightmapTexture && this._lightmapTexture.animations && 0 < this._lightmapTexture.animations.length && e.push(this._lightmapTexture), this._refractionTexture && this._refractionTexture.animations && 0 < this._refractionTexture.animations.length && e.push(this._refractionTexture), e }, r.prototype.getActiveTextures = function () { var e = i.prototype.getActiveTextures.call(this); return this._diffuseTexture && e.push(this._diffuseTexture), this._ambientTexture && e.push(this._ambientTexture), this._opacityTexture && e.push(this._opacityTexture), this._reflectionTexture && e.push(this._reflectionTexture), this._emissiveTexture && e.push(this._emissiveTexture), this._specularTexture && e.push(this._specularTexture), this._bumpTexture && e.push(this._bumpTexture), this._lightmapTexture && e.push(this._lightmapTexture), this._refractionTexture && e.push(this._refractionTexture), e }, r.prototype.hasTexture = function (e) { return !!i.prototype.hasTexture.call(this, e) || this._diffuseTexture === e || this._ambientTexture === e || this._opacityTexture === e || this._reflectionTexture === e || this._emissiveTexture === e || this._specularTexture === e || this._bumpTexture === e || this._lightmapTexture === e || this._refractionTexture === e }, r.prototype.dispose = function (e, t) { t && (this._diffuseTexture && this._diffuseTexture.dispose(), this._ambientTexture && this._ambientTexture.dispose(), this._opacityTexture && this._opacityTexture.dispose(), this._reflectionTexture && this._reflectionTexture.dispose(), this._emissiveTexture && this._emissiveTexture.dispose(), this._specularTexture && this._specularTexture.dispose(), this._bumpTexture && this._bumpTexture.dispose(), this._lightmapTexture && this._lightmapTexture.dispose(), this._refractionTexture && this._refractionTexture.dispose()), this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), i.prototype.dispose.call(this, e, t) }, r.prototype.clone = function (t) { var i = this, n = e.SerializationHelper.Clone(function () { return new r(t, i.getScene()) }, this); return n.name = t, n.id = t, n }, r.prototype.serialize = function () { return e.SerializationHelper.Serialize(this) }, r.Parse = function (t, i, n) { return e.SerializationHelper.Parse(function () { return new r(t.name, i) }, t, i, n) }, Object.defineProperty(r, "DiffuseTextureEnabled", { get: function () { return r._DiffuseTextureEnabled }, set: function (t) { r._DiffuseTextureEnabled !== t && (r._DiffuseTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "AmbientTextureEnabled", { get: function () { return r._AmbientTextureEnabled }, set: function (t) { r._AmbientTextureEnabled !== t && (r._AmbientTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "OpacityTextureEnabled", { get: function () { return r._OpacityTextureEnabled }, set: function (t) { r._OpacityTextureEnabled !== t && (r._OpacityTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "ReflectionTextureEnabled", { get: function () { return r._ReflectionTextureEnabled }, set: function (t) { r._ReflectionTextureEnabled !== t && (r._ReflectionTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "EmissiveTextureEnabled", { get: function () { return r._EmissiveTextureEnabled }, set: function (t) { r._EmissiveTextureEnabled !== t && (r._EmissiveTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "SpecularTextureEnabled", { get: function () { return r._SpecularTextureEnabled }, set: function (t) { r._SpecularTextureEnabled !== t && (r._SpecularTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "BumpTextureEnabled", { get: function () { return r._BumpTextureEnabled }, set: function (t) { r._BumpTextureEnabled !== t && (r._BumpTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "LightmapTextureEnabled", { get: function () { return r._LightmapTextureEnabled }, set: function (t) { r._LightmapTextureEnabled !== t && (r._LightmapTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "RefractionTextureEnabled", { get: function () { return r._RefractionTextureEnabled }, set: function (t) { r._RefractionTextureEnabled !== t && (r._RefractionTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "ColorGradingTextureEnabled", { get: function () { return r._ColorGradingTextureEnabled }, set: function (t) { r._ColorGradingTextureEnabled !== t && (r._ColorGradingTextureEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, "FresnelEnabled", { get: function () { return r._FresnelEnabled }, set: function (t) { r._FresnelEnabled !== t && (r._FresnelEnabled = t, e.Engine.MarkAllMaterialsAsDirty(e.Material.FresnelDirtyFlag)) }, enumerable: !0, configurable: !0 }), r._DiffuseTextureEnabled = !0, r._AmbientTextureEnabled = !0, r._OpacityTextureEnabled = !0, r._ReflectionTextureEnabled = !0, r._EmissiveTextureEnabled = !0, r._SpecularTextureEnabled = !0, r._BumpTextureEnabled = !0, r._LightmapTextureEnabled = !0, r._RefractionTextureEnabled = !0, r._ColorGradingTextureEnabled = !0, r._FresnelEnabled = !0, b([e.serializeAsTexture("diffuseTexture")], r.prototype, "_diffuseTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], r.prototype, "diffuseTexture", void 0), b([e.serializeAsTexture("ambientTexture")], r.prototype, "_ambientTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "ambientTexture", void 0), b([e.serializeAsTexture("opacityTexture")], r.prototype, "_opacityTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], r.prototype, "opacityTexture", void 0), b([e.serializeAsTexture("reflectionTexture")], r.prototype, "_reflectionTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "reflectionTexture", void 0), b([e.serializeAsTexture("emissiveTexture")], r.prototype, "_emissiveTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "emissiveTexture", void 0), b([e.serializeAsTexture("specularTexture")], r.prototype, "_specularTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "specularTexture", void 0), b([e.serializeAsTexture("bumpTexture")], r.prototype, "_bumpTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "bumpTexture", void 0), b([e.serializeAsTexture("lightmapTexture")], r.prototype, "_lightmapTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "lightmapTexture", void 0), b([e.serializeAsTexture("refractionTexture")], r.prototype, "_refractionTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "refractionTexture", void 0), b([e.serializeAsColor3("ambient")], r.prototype, "ambientColor", void 0), b([e.serializeAsColor3("diffuse")], r.prototype, "diffuseColor", void 0), b([e.serializeAsColor3("specular")], r.prototype, "specularColor", void 0), b([e.serializeAsColor3("emissive")], r.prototype, "emissiveColor", void 0), b([e.serialize()], r.prototype, "specularPower", void 0), b([e.serialize("useAlphaFromDiffuseTexture")], r.prototype, "_useAlphaFromDiffuseTexture", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useAlphaFromDiffuseTexture", void 0), b([e.serialize("useEmissiveAsIllumination")], r.prototype, "_useEmissiveAsIllumination", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useEmissiveAsIllumination", void 0), b([e.serialize("linkEmissiveWithDiffuse")], r.prototype, "_linkEmissiveWithDiffuse", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "linkEmissiveWithDiffuse", void 0), b([e.serialize("useSpecularOverAlpha")], r.prototype, "_useSpecularOverAlpha", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useSpecularOverAlpha", void 0), b([e.serialize("useReflectionOverAlpha")], r.prototype, "_useReflectionOverAlpha", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useReflectionOverAlpha", void 0), b([e.serialize("disableLighting")], r.prototype, "_disableLighting", void 0), b([e.expandToProperty("_markAllSubMeshesAsLightsDirty")], r.prototype, "disableLighting", void 0), b([e.serialize("useObjectSpaceNormalMap")], r.prototype, "_useObjectSpaceNormalMap", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useObjectSpaceNormalMap", void 0), b([e.serialize("useParallax")], r.prototype, "_useParallax", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useParallax", void 0), b([e.serialize("useParallaxOcclusion")], r.prototype, "_useParallaxOcclusion", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useParallaxOcclusion", void 0), b([e.serialize()], r.prototype, "parallaxScaleBias", void 0), b([e.serialize("roughness")], r.prototype, "_roughness", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "roughness", void 0), b([e.serialize()], r.prototype, "indexOfRefraction", void 0), b([e.serialize()], r.prototype, "invertRefractionY", void 0), b([e.serialize()], r.prototype, "alphaCutOff", void 0), b([e.serialize("useLightmapAsShadowmap")], r.prototype, "_useLightmapAsShadowmap", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useLightmapAsShadowmap", void 0), b([e.serializeAsFresnelParameters("diffuseFresnelParameters")], r.prototype, "_diffuseFresnelParameters", void 0), b([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], r.prototype, "diffuseFresnelParameters", void 0), b([e.serializeAsFresnelParameters("opacityFresnelParameters")], r.prototype, "_opacityFresnelParameters", void 0), b([e.expandToProperty("_markAllSubMeshesAsFresnelAndMiscDirty")], r.prototype, "opacityFresnelParameters", void 0), b([e.serializeAsFresnelParameters("reflectionFresnelParameters")], r.prototype, "_reflectionFresnelParameters", void 0), b([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], r.prototype, "reflectionFresnelParameters", void 0), b([e.serializeAsFresnelParameters("refractionFresnelParameters")], r.prototype, "_refractionFresnelParameters", void 0), b([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], r.prototype, "refractionFresnelParameters", void 0), b([e.serializeAsFresnelParameters("emissiveFresnelParameters")], r.prototype, "_emissiveFresnelParameters", void 0), b([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], r.prototype, "emissiveFresnelParameters", void 0), b([e.serialize("useReflectionFresnelFromSpecular")], r.prototype, "_useReflectionFresnelFromSpecular", void 0), b([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], r.prototype, "useReflectionFresnelFromSpecular", void 0), b([e.serialize("useGlossinessFromSpecularMapAlpha")], r.prototype, "_useGlossinessFromSpecularMapAlpha", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useGlossinessFromSpecularMapAlpha", void 0), b([e.serialize("maxSimultaneousLights")], r.prototype, "_maxSimultaneousLights", void 0), b([e.expandToProperty("_markAllSubMeshesAsLightsDirty")], r.prototype, "maxSimultaneousLights", void 0), b([e.serialize("invertNormalMapX")], r.prototype, "_invertNormalMapX", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "invertNormalMapX", void 0), b([e.serialize("invertNormalMapY")], r.prototype, "_invertNormalMapY", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "invertNormalMapY", void 0), b([e.serialize("twoSidedLighting")], r.prototype, "_twoSidedLighting", void 0), b([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "twoSidedLighting", void 0), b([e.serialize()], r.prototype, "useLogarithmicDepth", null), r }(e.PushMaterial); e.StandardMaterial = i }($a || ($a = {})), function (e) { var t = function () { function t() { this.x = e.Vector3.Zero(), this.y = e.Vector3.Zero(), this.z = e.Vector3.Zero(), this.xx = e.Vector3.Zero(), this.yy = e.Vector3.Zero(), this.zz = e.Vector3.Zero(), this.xy = e.Vector3.Zero(), this.yz = e.Vector3.Zero(), this.zx = e.Vector3.Zero() } return t.prototype.addAmbient = function (t) { var i = new e.Vector3(t.r, t.g, t.b); this.xx = this.xx.add(i), this.yy = this.yy.add(i), this.zz = this.zz.add(i) }, t.prototype.scale = function (e) { this.x = this.x.scale(e), this.y = this.y.scale(e), this.z = this.z.scale(e), this.xx = this.xx.scale(e), this.yy = this.yy.scale(e), this.zz = this.zz.scale(e), this.yz = this.yz.scale(e), this.zx = this.zx.scale(e), this.xy = this.xy.scale(e) }, t.FromHarmonics = function (e) { var i = new t; return i.x = e.l11.scale(1.02333), i.y = e.l1_1.scale(1.02333), i.z = e.l10.scale(1.02333), i.xx = e.l00.scale(.886277).subtract(e.l20.scale(.247708)).add(e.lL22.scale(.429043)), i.yy = e.l00.scale(.886277).subtract(e.l20.scale(.247708)).subtract(e.lL22.scale(.429043)), i.zz = e.l00.scale(.886277).add(e.l20.scale(.495417)), i.yz = e.l2_1.scale(.858086), i.zx = e.l21.scale(.858086), i.xy = e.l2_2.scale(.858086), i.scale(1 / Math.PI), i }, t.FromArray = function (i) { var r = new t; return e.Vector3.FromArrayToRef(i[0], 0, r.x), e.Vector3.FromArrayToRef(i[1], 0, r.y), e.Vector3.FromArrayToRef(i[2], 0, r.z), e.Vector3.FromArrayToRef(i[3], 0, r.xx), e.Vector3.FromArrayToRef(i[4], 0, r.yy), e.Vector3.FromArrayToRef(i[5], 0, r.zz), e.Vector3.FromArrayToRef(i[6], 0, r.yz), e.Vector3.FromArrayToRef(i[7], 0, r.zx), e.Vector3.FromArrayToRef(i[8], 0, r.xy), r }, t }(); e.SphericalPolynomial = t; var i = function () { function t() { this.l00 = e.Vector3.Zero(), this.l1_1 = e.Vector3.Zero(), this.l10 = e.Vector3.Zero(), this.l11 = e.Vector3.Zero(), this.l2_2 = e.Vector3.Zero(), this.l2_1 = e.Vector3.Zero(), this.l20 = e.Vector3.Zero(), this.l21 = e.Vector3.Zero(), this.lL22 = e.Vector3.Zero() } return t.prototype.addLight = function (t, i, r) { var n = new e.Vector3(i.r, i.g, i.b).scale(r); this.l00 = this.l00.add(n.scale(.282095)), this.l1_1 = this.l1_1.add(n.scale(.488603 * t.y)), this.l10 = this.l10.add(n.scale(.488603 * t.z)), this.l11 = this.l11.add(n.scale(.488603 * t.x)), this.l2_2 = this.l2_2.add(n.scale(1.092548 * t.x * t.y)), this.l2_1 = this.l2_1.add(n.scale(1.092548 * t.y * t.z)), this.l21 = this.l21.add(n.scale(1.092548 * t.x * t.z)), this.l20 = this.l20.add(n.scale(.315392 * (3 * t.z * t.z - 1))), this.lL22 = this.lL22.add(n.scale(.546274 * (t.x * t.x - t.y * t.y))) }, t.prototype.scale = function (e) { this.l00 = this.l00.scale(e), this.l1_1 = this.l1_1.scale(e), this.l10 = this.l10.scale(e), this.l11 = this.l11.scale(e), this.l2_2 = this.l2_2.scale(e), this.l2_1 = this.l2_1.scale(e), this.l20 = this.l20.scale(e), this.l21 = this.l21.scale(e), this.lL22 = this.lL22.scale(e) }, t.prototype.convertIncidentRadianceToIrradiance = function () { this.l00 = this.l00.scale(3.141593), this.l1_1 = this.l1_1.scale(2.094395), this.l10 = this.l10.scale(2.094395), this.l11 = this.l11.scale(2.094395), this.l2_2 = this.l2_2.scale(.785398), this.l2_1 = this.l2_1.scale(.785398), this.l20 = this.l20.scale(.785398), this.l21 = this.l21.scale(.785398), this.lL22 = this.lL22.scale(.785398) }, t.prototype.convertIrradianceToLambertianRadiance = function () { this.scale(1 / Math.PI) }, t.FromPolynomial = function (e) { var i = new t; return i.l00 = e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)), i.l1_1 = e.y.scale(.977204), i.l10 = e.z.scale(.977204), i.l11 = e.x.scale(.977204), i.l2_2 = e.xy.scale(1.16538), i.l2_1 = e.yz.scale(1.16538), i.l20 = e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)), i.l21 = e.zx.scale(1.16538), i.lL22 = e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)), i.scale(Math.PI), i }, t.FromArray = function (i) { var r = new t; return e.Vector3.FromArrayToRef(i[0], 0, r.l00), e.Vector3.FromArrayToRef(i[1], 0, r.l1_1), e.Vector3.FromArrayToRef(i[2], 0, r.l10), e.Vector3.FromArrayToRef(i[3], 0, r.l11), e.Vector3.FromArrayToRef(i[4], 0, r.l2_2), e.Vector3.FromArrayToRef(i[5], 0, r.l2_1), e.Vector3.FromArrayToRef(i[6], 0, r.l20), e.Vector3.FromArrayToRef(i[7], 0, r.l21), e.Vector3.FromArrayToRef(i[8], 0, r.lL22), r }, t }(); e.SphericalHarmonics = i }($a || ($a = {})), me = $a || ($a = {}), ge = function (e, t, i, r) { this.name = e, this.worldAxisForNormal = t, this.worldAxisForFileX = i, this.worldAxisForFileY = r }, ve = function () { function e() { } return e.ConvertCubeMapTextureToSphericalPolynomial = function (e) { if (!e.isCube) return null; var t, i, r = e.getSize().width, n = e.readPixels(0), o = e.readPixels(1); e.isRenderTarget ? (t = e.readPixels(3), i = e.readPixels(2)) : (t = e.readPixels(2), i = e.readPixels(3)); var s = e.readPixels(4), a = e.readPixels(5), l = e.gammaSpace, c = me.Engine.TEXTUREFORMAT_RGBA, h = me.Engine.TEXTURETYPE_UNSIGNED_INT; e.textureType && e.textureType !== me.Engine.TEXTURETYPE_UNSIGNED_INT && (h = me.Engine.TEXTURETYPE_FLOAT); var u = { size: r, right: n, left: o, up: t, down: i, front: s, back: a, format: c, type: h, gammaSpace: l }; return this.ConvertCubeMapToSphericalPolynomial(u) }, e.ConvertCubeMapToSphericalPolynomial = function (e) { for (var t = new me.SphericalHarmonics, i = 0, r = 2 / e.size, n = r, o = .5 * r - 1, s = 0; s < 6; s++)for (var a = this.FileFaces[s], l = e[a.name], c = o, h = e.format === me.Engine.TEXTUREFORMAT_RGBA ? 4 : 3, u = 0; u < e.size; u++) { for (var d = o, f = 0; f < e.size; f++) { var p = a.worldAxisForFileX.scale(d).add(a.worldAxisForFileY.scale(c)).add(a.worldAxisForNormal); p.normalize(); var _ = Math.pow(1 + d * d + c * c, -1.5), m = l[u * e.size * h + f * h + 0], g = l[u * e.size * h + f * h + 1], v = l[u * e.size * h + f * h + 2]; e.type === me.Engine.TEXTURETYPE_UNSIGNED_INT && (m /= 255, g /= 255, v /= 255), e.gammaSpace && (m = Math.pow(me.Scalar.Clamp(m), me.ToLinearSpace), g = Math.pow(me.Scalar.Clamp(g), me.ToLinearSpace), v = Math.pow(me.Scalar.Clamp(v), me.ToLinearSpace)); var y = new me.Color3(m, g, v); t.addLight(p, y, _), i += _, d += r } c += n } var b = 4 * Math.PI * 6 / 6 / i; return t.scale(b), t.convertIncidentRadianceToIrradiance(), t.convertIrradianceToLambertianRadiance(), me.SphericalPolynomial.FromHarmonics(t) }, e.FileFaces = [new ge("right", new me.Vector3(1, 0, 0), new me.Vector3(0, 0, -1), new me.Vector3(0, -1, 0)), new ge("left", new me.Vector3(-1, 0, 0), new me.Vector3(0, 0, 1), new me.Vector3(0, -1, 0)), new ge("up", new me.Vector3(0, 1, 0), new me.Vector3(1, 0, 0), new me.Vector3(0, 0, 1)), new ge("down", new me.Vector3(0, -1, 0), new me.Vector3(1, 0, 0), new me.Vector3(0, 0, -1)), new ge("front", new me.Vector3(0, 0, 1), new me.Vector3(1, 0, 0), new me.Vector3(0, -1, 0)), new ge("back", new me.Vector3(0, 0, -1), new me.Vector3(-1, 0, 0), new me.Vector3(0, -1, 0))], e }(), me.CubeMapToSphericalPolynomialTools = ve, ye = $a || ($a = {}), be = function (e) { function t() { var t = e.call(this) || this; return t.PBR = !0, t.MAINUV1 = !1, t.MAINUV2 = !1, t.UV1 = !1, t.UV2 = !1, t.ALBEDO = !1, t.ALBEDODIRECTUV = 0, t.VERTEXCOLOR = !1, t.AMBIENT = !1, t.AMBIENTDIRECTUV = 0, t.AMBIENTINGRAYSCALE = !1, t.OPACITY = !1, t.VERTEXALPHA = !1, t.OPACITYDIRECTUV = 0, t.OPACITYRGB = !1, t.ALPHATEST = !1, t.DEPTHPREPASS = !1, t.ALPHABLEND = !1, t.ALPHAFROMALBEDO = !1, t.ALPHATESTVALUE = "0.5", t.SPECULAROVERALPHA = !1, t.RADIANCEOVERALPHA = !1, t.ALPHAFRESNEL = !1, t.LINEARALPHAFRESNEL = !1, t.PREMULTIPLYALPHA = !1, t.EMISSIVE = !1, t.EMISSIVEDIRECTUV = 0, t.REFLECTIVITY = !1, t.REFLECTIVITYDIRECTUV = 0, t.SPECULARTERM = !1, t.MICROSURFACEFROMREFLECTIVITYMAP = !1, t.MICROSURFACEAUTOMATIC = !1, t.LODBASEDMICROSFURACE = !1, t.MICROSURFACEMAP = !1, t.MICROSURFACEMAPDIRECTUV = 0, t.METALLICWORKFLOW = !1, t.ROUGHNESSSTOREINMETALMAPALPHA = !1, t.ROUGHNESSSTOREINMETALMAPGREEN = !1, t.METALLNESSSTOREINMETALMAPBLUE = !1, t.AOSTOREINMETALMAPRED = !1, t.ENVIRONMENTBRDF = !1, t.NORMAL = !1, t.TANGENT = !1, t.BUMP = !1, t.BUMPDIRECTUV = 0, t.OBJECTSPACE_NORMALMAP = !1, t.PARALLAX = !1, t.PARALLAXOCCLUSION = !1, t.NORMALXYSCALE = !0, t.LIGHTMAP = !1, t.LIGHTMAPDIRECTUV = 0, t.USELIGHTMAPASSHADOWMAP = !1, t.GAMMALIGHTMAP = !1, t.REFLECTION = !1, t.REFLECTIONMAP_3D = !1, t.REFLECTIONMAP_SPHERICAL = !1, t.REFLECTIONMAP_PLANAR = !1, t.REFLECTIONMAP_CUBIC = !1, t.USE_LOCAL_REFLECTIONMAP_CUBIC = !1, t.REFLECTIONMAP_PROJECTION = !1, t.REFLECTIONMAP_SKYBOX = !1, t.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1, t.REFLECTIONMAP_EXPLICIT = !1, t.REFLECTIONMAP_EQUIRECTANGULAR = !1, t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1, t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1, t.INVERTCUBICMAP = !1, t.USESPHERICALFROMREFLECTIONMAP = !1, t.USESPHERICALINVERTEX = !1, t.REFLECTIONMAP_OPPOSITEZ = !1, t.LODINREFLECTIONALPHA = !1, t.GAMMAREFLECTION = !1, t.RGBDREFLECTION = !1, t.RADIANCEOCCLUSION = !1, t.HORIZONOCCLUSION = !1, t.REFRACTION = !1, t.REFRACTIONMAP_3D = !1, t.REFRACTIONMAP_OPPOSITEZ = !1, t.LODINREFRACTIONALPHA = !1, t.GAMMAREFRACTION = !1, t.RGBDREFRACTION = !1, t.LINKREFRACTIONTOTRANSPARENCY = !1, t.INSTANCES = !1, t.NUM_BONE_INFLUENCERS = 0, t.BonesPerMesh = 0, t.NONUNIFORMSCALING = !1, t.MORPHTARGETS = !1, t.MORPHTARGETS_NORMAL = !1, t.MORPHTARGETS_TANGENT = !1, t.NUM_MORPH_INFLUENCERS = 0, t.IMAGEPROCESSING = !1, t.VIGNETTE = !1, t.VIGNETTEBLENDMODEMULTIPLY = !1, t.VIGNETTEBLENDMODEOPAQUE = !1, t.TONEMAPPING = !1, t.TONEMAPPING_ACES = !1, t.CONTRAST = !1, t.COLORCURVES = !1, t.COLORGRADING = !1, t.COLORGRADING3D = !1, t.SAMPLER3DGREENDEPTH = !1, t.SAMPLER3DBGRMAP = !1, t.IMAGEPROCESSINGPOSTPROCESS = !1, t.EXPOSURE = !1, t.USEPHYSICALLIGHTFALLOFF = !1, t.USEGLTFLIGHTFALLOFF = !1, t.TWOSIDEDLIGHTING = !1, t.SHADOWFLOAT = !1, t.CLIPPLANE = !1, t.CLIPPLANE2 = !1, t.CLIPPLANE3 = !1, t.CLIPPLANE4 = !1, t.POINTSIZE = !1, t.FOG = !1, t.LOGARITHMICDEPTH = !1, t.FORCENORMALFORWARD = !1, t.SPECULARAA = !1, t.UNLIT = !1, t.rebuild(), t } return T(t, e), t.prototype.reset = function () { e.prototype.reset.call(this), this.ALPHATESTVALUE = "0.5", this.PBR = !0 }, t }(ye.MaterialDefines), Te = function (e) { function t(i, r) { var n = e.call(this, i, r) || this; return n._directIntensity = 1, n._emissiveIntensity = 1, n._environmentIntensity = 1, n._specularIntensity = 1, n._lightingInfos = new ye.Vector4(n._directIntensity, n._emissiveIntensity, n._environmentIntensity, n._specularIntensity), n._disableBumpMap = !1, n._ambientTextureStrength = 1, n._ambientTextureImpactOnAnalyticalLights = ye.PBRMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS, n._ambientColor = new ye.Color3(0, 0, 0), n._albedoColor = new ye.Color3(1, 1, 1), n._reflectivityColor = new ye.Color3(1, 1, 1), n._reflectionColor = new ye.Color3(1, 1, 1), n._emissiveColor = new ye.Color3(0, 0, 0), n._microSurface = .9, n._indexOfRefraction = .66, n._invertRefractionY = !1, n._linkRefractionWithTransparency = !1, n._useLightmapAsShadowmap = !1, n._useHorizonOcclusion = !0, n._useRadianceOcclusion = !0, n._useAlphaFromAlbedoTexture = !1, n._useSpecularOverAlpha = !0, n._useMicroSurfaceFromReflectivityMapAlpha = !1, n._useRoughnessFromMetallicTextureAlpha = !0, n._useRoughnessFromMetallicTextureGreen = !1, n._useMetallnessFromMetallicTextureBlue = !1, n._useAmbientOcclusionFromMetallicTextureRed = !1, n._useAmbientInGrayScale = !1, n._useAutoMicroSurfaceFromReflectivityMap = !1, n._lightFalloff = t.LIGHTFALLOFF_PHYSICAL, n._useRadianceOverAlpha = !0, n._useObjectSpaceNormalMap = !1, n._useParallax = !1, n._useParallaxOcclusion = !1, n._parallaxScaleBias = .05, n._disableLighting = !1, n._maxSimultaneousLights = 4, n._invertNormalMapX = !1, n._invertNormalMapY = !1, n._twoSidedLighting = !1, n._alphaCutOff = .4, n._forceAlphaTest = !1, n._useAlphaFresnel = !1, n._useLinearAlphaFresnel = !1, n._transparencyMode = null, n._environmentBRDFTexture = null, n._forceIrradianceInFragment = !1, n._forceNormalForward = !1, n._enableSpecularAntiAliasing = !1, n._renderTargets = new ye.SmartArray(16), n._globalAmbientColor = new ye.Color3(0, 0, 0), n._unlit = !1, n._attachImageProcessingConfiguration(null), n.getRenderTargetTextures = function () { return n._renderTargets.reset(), ye.StandardMaterial.ReflectionTextureEnabled && n._reflectionTexture && n._reflectionTexture.isRenderTarget && n._renderTargets.push(n._reflectionTexture), ye.StandardMaterial.RefractionTextureEnabled && n._refractionTexture && n._refractionTexture.isRenderTarget && n._renderTargets.push(n._refractionTexture), n._renderTargets }, n._environmentBRDFTexture = ye.TextureTools.GetEnvironmentBRDFTexture(r), n } return T(t, e), t.prototype._attachImageProcessingConfiguration = function (e) { var t = this; e !== this._imageProcessingConfiguration && (this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), this._imageProcessingConfiguration = e || this.getScene().imageProcessingConfiguration, this._imageProcessingConfiguration && (this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add(function (e) { t._markAllSubMeshesAsImageProcessingDirty() }))) }, Object.defineProperty(t.prototype, "hasRenderTargetTextures", { get: function () { return !!(ye.StandardMaterial.ReflectionTextureEnabled && this._reflectionTexture && this._reflectionTexture.isRenderTarget) || !!(ye.StandardMaterial.RefractionTextureEnabled && this._refractionTexture && this._refractionTexture.isRenderTarget) }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "PBRBaseMaterial" }, Object.defineProperty(t.prototype, "useLogarithmicDepth", { get: function () { return this._useLogarithmicDepth }, set: function (e) { this._useLogarithmicDepth = e && this.getScene().getEngine().getCaps().fragmentDepthSupported }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "transparencyMode", { get: function () { return this._transparencyMode }, set: function (e) { this._transparencyMode !== e && (this._transparencyMode = e, this._forceAlphaTest = e === ye.PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND, this._markAllSubMeshesAsTexturesAndMiscDirty()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "_disableAlphaBlending", { get: function () { return this._linkRefractionWithTransparency || this._transparencyMode === ye.PBRMaterial.PBRMATERIAL_OPAQUE || this._transparencyMode === ye.PBRMaterial.PBRMATERIAL_ALPHATEST }, enumerable: !0, configurable: !0 }), t.prototype.needAlphaBlending = function () { return !this._disableAlphaBlending && (this.alpha < 1 || null != this._opacityTexture || this._shouldUseAlphaFromAlbedoTexture()) }, t.prototype.needAlphaBlendingForMesh = function (t) { return !this._disableAlphaBlending && e.prototype.needAlphaBlendingForMesh.call(this, t) }, t.prototype.needAlphaTesting = function () { return !!this._forceAlphaTest || !this._linkRefractionWithTransparency && null != this._albedoTexture && this._albedoTexture.hasAlpha && (null == this._transparencyMode || this._transparencyMode === ye.PBRMaterial.PBRMATERIAL_ALPHATEST) }, t.prototype._shouldUseAlphaFromAlbedoTexture = function () { return null != this._albedoTexture && this._albedoTexture.hasAlpha && this._useAlphaFromAlbedoTexture && this._transparencyMode !== ye.PBRMaterial.PBRMATERIAL_OPAQUE }, t.prototype.getAlphaTestTexture = function () { return this._albedoTexture }, t.prototype.isReadyForSubMesh = function (e, t, i) { if (t.effect && this.isFrozen && this._wasPreviouslyReady) return !0; t._materialDefines || (t._materialDefines = new be); var r = t._materialDefines; if (!this.checkReadyOnEveryCall && t.effect && r._renderId === this.getScene().getRenderId()) return !0; var n = this.getScene(), o = n.getEngine(); if (r._areTexturesDirty && n.texturesEnabled) { if (this._albedoTexture && ye.StandardMaterial.DiffuseTextureEnabled && !this._albedoTexture.isReadyOrNotBlocking()) return !1; if (this._ambientTexture && ye.StandardMaterial.AmbientTextureEnabled && !this._ambientTexture.isReadyOrNotBlocking()) return !1; if (this._opacityTexture && ye.StandardMaterial.OpacityTextureEnabled && !this._opacityTexture.isReadyOrNotBlocking()) return !1; var s = this._getReflectionTexture(); if (s && ye.StandardMaterial.ReflectionTextureEnabled && !s.isReadyOrNotBlocking()) return !1; if (this._lightmapTexture && ye.StandardMaterial.LightmapTextureEnabled && !this._lightmapTexture.isReadyOrNotBlocking()) return !1; if (this._emissiveTexture && ye.StandardMaterial.EmissiveTextureEnabled && !this._emissiveTexture.isReadyOrNotBlocking()) return !1; if (ye.StandardMaterial.SpecularTextureEnabled) { if (this._metallicTexture) { if (!this._metallicTexture.isReadyOrNotBlocking()) return !1 } else if (this._reflectivityTexture && !this._reflectivityTexture.isReadyOrNotBlocking()) return !1; if (this._microSurfaceTexture && !this._microSurfaceTexture.isReadyOrNotBlocking()) return !1 } if (o.getCaps().standardDerivatives && this._bumpTexture && ye.StandardMaterial.BumpTextureEnabled && !this._disableBumpMap && !this._bumpTexture.isReady()) return !1; var a = this._getRefractionTexture(); if (a && ye.StandardMaterial.RefractionTextureEnabled && !a.isReadyOrNotBlocking()) return !1; if (this._environmentBRDFTexture && ye.StandardMaterial.ReflectionTextureEnabled && !this._environmentBRDFTexture.isReady()) return !1 } if (r._areImageProcessingDirty && this._imageProcessingConfiguration && !this._imageProcessingConfiguration.isReady()) return !1; o.getCaps().standardDerivatives || e.isVerticesDataPresent(ye.VertexBuffer.NormalKind) || (e.createNormals(!0), ye.Tools.Warn("PBRMaterial: Normals have been created for the mesh: " + e.name)); var l = this._prepareEffect(e, r, this.onCompiled, this.onError, i); return l && (n.resetCachedMaterial(), t.setEffect(l, r), this.buildUniformLayout()), !(!t.effect || !t.effect.isReady()) && (r._renderId = n.getRenderId(), this._wasPreviouslyReady = !0) }, t.prototype.isMetallicWorkflow = function () { return !(null == this._metallic && null == this._roughness && !this._metallicTexture) }, t.prototype._prepareEffect = function (e, t, i, r, n, o) { if (void 0 === i && (i = null), void 0 === r && (r = null), void 0 === n && (n = null), void 0 === o && (o = null), this._prepareDefines(e, t, n, o), !t.isDirty) return null; t.markAsProcessed(); var s = this.getScene().getEngine(), a = new ye.EffectFallbacks, l = 0; t.USESPHERICALINVERTEX && a.addFallback(l++, "USESPHERICALINVERTEX"), t.FOG && a.addFallback(l, "FOG"), t.SPECULARAA && a.addFallback(l, "SPECULARAA"), t.POINTSIZE && a.addFallback(l, "POINTSIZE"), t.LOGARITHMICDEPTH && a.addFallback(l, "LOGARITHMICDEPTH"), t.PARALLAX && a.addFallback(l, "PARALLAX"), t.PARALLAXOCCLUSION && a.addFallback(l++, "PARALLAXOCCLUSION"), t.ENVIRONMENTBRDF && a.addFallback(l++, "ENVIRONMENTBRDF"), t.TANGENT && a.addFallback(l++, "TANGENT"), t.BUMP && a.addFallback(l++, "BUMP"), l = ye.MaterialHelper.HandleFallbacksForShadows(t, a, this._maxSimultaneousLights, l++), t.SPECULARTERM && a.addFallback(l++, "SPECULARTERM"), t.USESPHERICALFROMREFLECTIONMAP && a.addFallback(l++, "USESPHERICALFROMREFLECTIONMAP"), t.LIGHTMAP && a.addFallback(l++, "LIGHTMAP"), t.NORMAL && a.addFallback(l++, "NORMAL"), t.AMBIENT && a.addFallback(l++, "AMBIENT"), t.EMISSIVE && a.addFallback(l++, "EMISSIVE"), t.VERTEXCOLOR && a.addFallback(l++, "VERTEXCOLOR"), 0 < t.NUM_BONE_INFLUENCERS && a.addCPUSkinningFallback(l++, e), t.MORPHTARGETS && a.addFallback(l++, "MORPHTARGETS"); var c = [ye.VertexBuffer.PositionKind]; t.NORMAL && c.push(ye.VertexBuffer.NormalKind), t.TANGENT && c.push(ye.VertexBuffer.TangentKind), t.UV1 && c.push(ye.VertexBuffer.UVKind), t.UV2 && c.push(ye.VertexBuffer.UV2Kind), t.VERTEXCOLOR && c.push(ye.VertexBuffer.ColorKind), ye.MaterialHelper.PrepareAttributesForBones(c, e, t, a), ye.MaterialHelper.PrepareAttributesForInstances(c, t), ye.MaterialHelper.PrepareAttributesForMorphTargets(c, e, t); var h = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vAmbientColor", "vAlbedoColor", "vReflectivityColor", "vEmissiveColor", "vReflectionColor", "vFogInfos", "vFogColor", "pointSize", "vAlbedoInfos", "vAmbientInfos", "vOpacityInfos", "vReflectionInfos", "vReflectionPosition", "vReflectionSize", "vEmissiveInfos", "vReflectivityInfos", "vMicroSurfaceSamplerInfos", "vBumpInfos", "vLightmapInfos", "vRefractionInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "albedoMatrix", "ambientMatrix", "opacityMatrix", "reflectionMatrix", "emissiveMatrix", "reflectivityMatrix", "normalMatrix", "microSurfaceSamplerMatrix", "bumpMatrix", "lightmapMatrix", "refractionMatrix", "vLightingIntensity", "logarithmicDepthConstant", "vSphericalX", "vSphericalY", "vSphericalZ", "vSphericalXX", "vSphericalYY", "vSphericalZZ", "vSphericalXY", "vSphericalYZ", "vSphericalZX", "vReflectionMicrosurfaceInfos", "vRefractionMicrosurfaceInfos", "vTangentSpaceParams"], u = ["albedoSampler", "reflectivitySampler", "ambientSampler", "emissiveSampler", "bumpSampler", "lightmapSampler", "opacitySampler", "refractionSampler", "refractionSamplerLow", "refractionSamplerHigh", "reflectionSampler", "reflectionSamplerLow", "reflectionSamplerHigh", "microSurfaceSampler", "environmentBrdfSampler"], d = ["Material", "Scene"]; ye.ImageProcessingConfiguration && (ye.ImageProcessingConfiguration.PrepareUniforms(h, t), ye.ImageProcessingConfiguration.PrepareSamplers(u, t)), ye.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: h, uniformBuffersNames: d, samplers: u, defines: t, maxSimultaneousLights: this._maxSimultaneousLights }); var f = t.toString(); return s.createEffect("pbr", { attributes: c, uniformsNames: h, uniformBuffersNames: d, samplers: u, defines: f, fallbacks: a, onCompiled: i, onError: r, indexParameters: { maxSimultaneousLights: this._maxSimultaneousLights, maxSimultaneousMorphTargets: t.NUM_MORPH_INFLUENCERS } }, s) }, t.prototype._prepareDefines = function (e, i, r, n) { void 0 === r && (r = null), void 0 === n && (n = null); var o = this.getScene(), s = o.getEngine(); if (ye.MaterialHelper.PrepareDefinesForLights(o, e, i, !0, this._maxSimultaneousLights, this._disableLighting), i._needNormals = !0, i.METALLICWORKFLOW = this.isMetallicWorkflow(), i._areTexturesDirty) { if (i._needUVs = !1, o.texturesEnabled) { o.getEngine().getCaps().textureLOD && (i.LODBASEDMICROSFURACE = !0), this._albedoTexture && ye.StandardMaterial.DiffuseTextureEnabled ? ye.MaterialHelper.PrepareDefinesForMergedUV(this._albedoTexture, i, "ALBEDO") : i.ALBEDO = !1, this._ambientTexture && ye.StandardMaterial.AmbientTextureEnabled ? (ye.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture, i, "AMBIENT"), i.AMBIENTINGRAYSCALE = this._useAmbientInGrayScale) : i.AMBIENT = !1, this._opacityTexture && ye.StandardMaterial.OpacityTextureEnabled ? (ye.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture, i, "OPACITY"), i.OPACITYRGB = this._opacityTexture.getAlphaFromRGB) : i.OPACITY = !1; var a = this._getReflectionTexture(); if (a && ye.StandardMaterial.ReflectionTextureEnabled) { switch (i.REFLECTION = !0, i.GAMMAREFLECTION = a.gammaSpace, i.RGBDREFLECTION = a.isRGBD, i.REFLECTIONMAP_OPPOSITEZ = this.getScene().useRightHandedSystem ? !a.invertZ : a.invertZ, i.LODINREFLECTIONALPHA = a.lodLevelInAlpha, a.coordinatesMode === ye.Texture.INVCUBIC_MODE && (i.INVERTCUBICMAP = !0), i.REFLECTIONMAP_3D = a.isCube, a.coordinatesMode) { case ye.Texture.EXPLICIT_MODE: i.REFLECTIONMAP_EXPLICIT = !0; break; case ye.Texture.PLANAR_MODE: i.REFLECTIONMAP_PLANAR = !0; break; case ye.Texture.PROJECTION_MODE: i.REFLECTIONMAP_PROJECTION = !0; break; case ye.Texture.SKYBOX_MODE: i.REFLECTIONMAP_SKYBOX = !0; break; case ye.Texture.SPHERICAL_MODE: i.REFLECTIONMAP_SPHERICAL = !0; break; case ye.Texture.EQUIRECTANGULAR_MODE: i.REFLECTIONMAP_EQUIRECTANGULAR = !0; break; case ye.Texture.FIXED_EQUIRECTANGULAR_MODE: i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !0; break; case ye.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE: i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !0; break; case ye.Texture.CUBIC_MODE: case ye.Texture.INVCUBIC_MODE: default: i.REFLECTIONMAP_CUBIC = !0, i.USE_LOCAL_REFLECTIONMAP_CUBIC = !!a.boundingBoxSize }a.coordinatesMode !== ye.Texture.SKYBOX_MODE ? a.sphericalPolynomial && (i.USESPHERICALFROMREFLECTIONMAP = !0, this._forceIrradianceInFragment || o.getEngine().getCaps().maxVaryingVectors <= 8 ? i.USESPHERICALINVERTEX = !1 : i.USESPHERICALINVERTEX = !0) : i.REFLECTIONMAP_SKYBOX_TRANSFORMED = !a.getReflectionTextureMatrix().isIdentity() } else i.REFLECTION = !1, i.REFLECTIONMAP_3D = !1, i.REFLECTIONMAP_SPHERICAL = !1, i.REFLECTIONMAP_PLANAR = !1, i.REFLECTIONMAP_CUBIC = !1, i.USE_LOCAL_REFLECTIONMAP_CUBIC = !1, i.REFLECTIONMAP_PROJECTION = !1, i.REFLECTIONMAP_SKYBOX = !1, i.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1, i.REFLECTIONMAP_EXPLICIT = !1, i.REFLECTIONMAP_EQUIRECTANGULAR = !1, i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1, i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1, i.INVERTCUBICMAP = !1, i.USESPHERICALFROMREFLECTIONMAP = !1, i.USESPHERICALINVERTEX = !1, i.REFLECTIONMAP_OPPOSITEZ = !1, i.LODINREFLECTIONALPHA = !1, i.GAMMAREFLECTION = !1, i.RGBDREFLECTION = !1; this._lightmapTexture && ye.StandardMaterial.LightmapTextureEnabled ? (ye.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture, i, "LIGHTMAP"), i.USELIGHTMAPASSHADOWMAP = this._useLightmapAsShadowmap, i.GAMMALIGHTMAP = this._lightmapTexture.gammaSpace) : i.LIGHTMAP = !1, this._emissiveTexture && ye.StandardMaterial.EmissiveTextureEnabled ? ye.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture, i, "EMISSIVE") : i.EMISSIVE = !1, ye.StandardMaterial.SpecularTextureEnabled ? (this._metallicTexture ? (ye.MaterialHelper.PrepareDefinesForMergedUV(this._metallicTexture, i, "REFLECTIVITY"), i.ROUGHNESSSTOREINMETALMAPALPHA = this._useRoughnessFromMetallicTextureAlpha, i.ROUGHNESSSTOREINMETALMAPGREEN = !this._useRoughnessFromMetallicTextureAlpha && this._useRoughnessFromMetallicTextureGreen, i.METALLNESSSTOREINMETALMAPBLUE = this._useMetallnessFromMetallicTextureBlue, i.AOSTOREINMETALMAPRED = this._useAmbientOcclusionFromMetallicTextureRed) : this._reflectivityTexture ? (ye.MaterialHelper.PrepareDefinesForMergedUV(this._reflectivityTexture, i, "REFLECTIVITY"), i.MICROSURFACEFROMREFLECTIVITYMAP = this._useMicroSurfaceFromReflectivityMapAlpha, i.MICROSURFACEAUTOMATIC = this._useAutoMicroSurfaceFromReflectivityMap) : i.REFLECTIVITY = !1, this._microSurfaceTexture ? ye.MaterialHelper.PrepareDefinesForMergedUV(this._microSurfaceTexture, i, "MICROSURFACEMAP") : i.MICROSURFACEMAP = !1) : (i.REFLECTIVITY = !1, i.MICROSURFACEMAP = !1), o.getEngine().getCaps().standardDerivatives && this._bumpTexture && ye.StandardMaterial.BumpTextureEnabled && !this._disableBumpMap ? (ye.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture, i, "BUMP"), this._useParallax && this._albedoTexture && ye.StandardMaterial.DiffuseTextureEnabled ? (i.PARALLAX = !0, i.PARALLAXOCCLUSION = !!this._useParallaxOcclusion) : i.PARALLAX = !1, i.OBJECTSPACE_NORMALMAP = this._useObjectSpaceNormalMap) : i.BUMP = !1; var l = this._getRefractionTexture(); l && ye.StandardMaterial.RefractionTextureEnabled ? (i.REFRACTION = !0, i.REFRACTIONMAP_3D = l.isCube, i.GAMMAREFRACTION = l.gammaSpace, i.RGBDREFRACTION = l.isRGBD, i.REFRACTIONMAP_OPPOSITEZ = l.invertZ, i.LODINREFRACTIONALPHA = l.lodLevelInAlpha, this._linkRefractionWithTransparency && (i.LINKREFRACTIONTOTRANSPARENCY = !0)) : i.REFRACTION = !1, this._environmentBRDFTexture && ye.StandardMaterial.ReflectionTextureEnabled ? i.ENVIRONMENTBRDF = !0 : i.ENVIRONMENTBRDF = !1, this._shouldUseAlphaFromAlbedoTexture() ? i.ALPHAFROMALBEDO = !0 : i.ALPHAFROMALBEDO = !1 } i.SPECULAROVERALPHA = this._useSpecularOverAlpha, this._lightFalloff === t.LIGHTFALLOFF_STANDARD ? (i.USEPHYSICALLIGHTFALLOFF = !1, i.USEGLTFLIGHTFALLOFF = !1) : this._lightFalloff === t.LIGHTFALLOFF_GLTF ? (i.USEPHYSICALLIGHTFALLOFF = !1, i.USEGLTFLIGHTFALLOFF = !0) : (i.USEPHYSICALLIGHTFALLOFF = !0, i.USEGLTFLIGHTFALLOFF = !1), i.RADIANCEOVERALPHA = this._useRadianceOverAlpha, !this.backFaceCulling && this._twoSidedLighting ? i.TWOSIDEDLIGHTING = !0 : i.TWOSIDEDLIGHTING = !1, i.ALPHATESTVALUE = this._alphaCutOff + (this._alphaCutOff % 1 == 0 ? "." : ""), i.PREMULTIPLYALPHA = this.alphaMode === ye.Engine.ALPHA_PREMULTIPLIED || this.alphaMode === ye.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF, i.ALPHABLEND = this.needAlphaBlendingForMesh(e), i.ALPHAFRESNEL = this._useAlphaFresnel || this._useLinearAlphaFresnel, i.LINEARALPHAFRESNEL = this._useLinearAlphaFresnel, i.SPECULARAA = o.getEngine().getCaps().standardDerivatives && this._enableSpecularAntiAliasing } i._areImageProcessingDirty && this._imageProcessingConfiguration && this._imageProcessingConfiguration.prepareDefines(i), i.FORCENORMALFORWARD = this._forceNormalForward, i.RADIANCEOCCLUSION = this._useRadianceOcclusion, i.HORIZONOCCLUSION = this._useHorizonOcclusion, i._areMiscDirty && (ye.MaterialHelper.PrepareDefinesForMisc(e, o, this._useLogarithmicDepth, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e) || this._forceAlphaTest, i), i.UNLIT = this._unlit || (this.pointsCloud || this.wireframe) && !e.isVerticesDataPresent(ye.VertexBuffer.NormalKind)), ye.MaterialHelper.PrepareDefinesForFrameBoundValues(o, s, i, !!r, n), ye.MaterialHelper.PrepareDefinesForAttributes(e, i, !0, !0, !0, this._transparencyMode !== ye.PBRMaterial.PBRMATERIAL_OPAQUE) }, t.prototype.forceCompilation = function (e, t, i) { var r = this, n = tl({ clipPlane: !1 }, i), o = new be, s = this._prepareEffect(e, o, void 0, void 0, void 0, n.clipPlane); s.isReady() ? t && t(this) : s.onCompileObservable.add(function () { t && t(r) }) }, t.prototype.buildUniformLayout = function () { this._uniformBuffer.addUniform("vAlbedoInfos", 2), this._uniformBuffer.addUniform("vAmbientInfos", 4), this._uniformBuffer.addUniform("vOpacityInfos", 2), this._uniformBuffer.addUniform("vEmissiveInfos", 2), this._uniformBuffer.addUniform("vLightmapInfos", 2), this._uniformBuffer.addUniform("vReflectivityInfos", 3), this._uniformBuffer.addUniform("vMicroSurfaceSamplerInfos", 2), this._uniformBuffer.addUniform("vRefractionInfos", 4), this._uniformBuffer.addUniform("vReflectionInfos", 2), this._uniformBuffer.addUniform("vReflectionPosition", 3), this._uniformBuffer.addUniform("vReflectionSize", 3), this._uniformBuffer.addUniform("vBumpInfos", 3), this._uniformBuffer.addUniform("albedoMatrix", 16), this._uniformBuffer.addUniform("ambientMatrix", 16), this._uniformBuffer.addUniform("opacityMatrix", 16), this._uniformBuffer.addUniform("emissiveMatrix", 16), this._uniformBuffer.addUniform("lightmapMatrix", 16), this._uniformBuffer.addUniform("reflectivityMatrix", 16), this._uniformBuffer.addUniform("microSurfaceSamplerMatrix", 16), this._uniformBuffer.addUniform("bumpMatrix", 16), this._uniformBuffer.addUniform("vTangentSpaceParams", 2), this._uniformBuffer.addUniform("refractionMatrix", 16), this._uniformBuffer.addUniform("reflectionMatrix", 16), this._uniformBuffer.addUniform("vReflectionColor", 3), this._uniformBuffer.addUniform("vAlbedoColor", 4), this._uniformBuffer.addUniform("vLightingIntensity", 4), this._uniformBuffer.addUniform("vRefractionMicrosurfaceInfos", 3), this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos", 3), this._uniformBuffer.addUniform("vReflectivityColor", 4), this._uniformBuffer.addUniform("vEmissiveColor", 3), this._uniformBuffer.addUniform("pointSize", 1), this._uniformBuffer.create() }, t.prototype.unbind = function () { this._reflectionTexture && this._reflectionTexture.isRenderTarget && this._uniformBuffer.setTexture("reflectionSampler", null), this._refractionTexture && this._refractionTexture.isRenderTarget && this._uniformBuffer.setTexture("refractionSampler", null), e.prototype.unbind.call(this) }, t.prototype.bindForSubMesh = function (e, i, r) { var n = this.getScene(), o = r._materialDefines; if (o) { var s = r.effect; if (s) { this._activeEffect = s, this.bindOnlyWorldMatrix(e), o.OBJECTSPACE_NORMALMAP && (e.toNormalMatrix(this._normalMatrix), this.bindOnlyNormalMatrix(this._normalMatrix)); var a = this._mustRebind(n, s, i.visibility); ye.MaterialHelper.BindBonesParameters(i, this._activeEffect); var l = null; if (a) { this._uniformBuffer.bindToEffect(s, "Material"), this.bindViewProjection(s), l = this._getReflectionTexture(); var c = this._getRefractionTexture(); if (!this._uniformBuffer.useUbo || !this.isFrozen || !this._uniformBuffer.isSync) { if (n.texturesEnabled) { if (this._albedoTexture && ye.StandardMaterial.DiffuseTextureEnabled && (this._uniformBuffer.updateFloat2("vAlbedoInfos", this._albedoTexture.coordinatesIndex, this._albedoTexture.level), ye.MaterialHelper.BindTextureMatrix(this._albedoTexture, this._uniformBuffer, "albedo")), this._ambientTexture && ye.StandardMaterial.AmbientTextureEnabled && (this._uniformBuffer.updateFloat4("vAmbientInfos", this._ambientTexture.coordinatesIndex, this._ambientTexture.level, this._ambientTextureStrength, this._ambientTextureImpactOnAnalyticalLights), ye.MaterialHelper.BindTextureMatrix(this._ambientTexture, this._uniformBuffer, "ambient")), this._opacityTexture && ye.StandardMaterial.OpacityTextureEnabled && (this._uniformBuffer.updateFloat2("vOpacityInfos", this._opacityTexture.coordinatesIndex, this._opacityTexture.level), ye.MaterialHelper.BindTextureMatrix(this._opacityTexture, this._uniformBuffer, "opacity")), l && ye.StandardMaterial.ReflectionTextureEnabled) { if (this._uniformBuffer.updateMatrix("reflectionMatrix", l.getReflectionTextureMatrix()), this._uniformBuffer.updateFloat2("vReflectionInfos", l.level, 0), l.boundingBoxSize) { var h = l; this._uniformBuffer.updateVector3("vReflectionPosition", h.boundingBoxPosition), this._uniformBuffer.updateVector3("vReflectionSize", h.boundingBoxSize) } var u = l.sphericalPolynomial; o.USESPHERICALFROMREFLECTIONMAP && u && (this._activeEffect.setFloat3("vSphericalX", u.x.x, u.x.y, u.x.z), this._activeEffect.setFloat3("vSphericalY", u.y.x, u.y.y, u.y.z), this._activeEffect.setFloat3("vSphericalZ", u.z.x, u.z.y, u.z.z), this._activeEffect.setFloat3("vSphericalXX_ZZ", u.xx.x - u.zz.x, u.xx.y - u.zz.y, u.xx.z - u.zz.z), this._activeEffect.setFloat3("vSphericalYY_ZZ", u.yy.x - u.zz.x, u.yy.y - u.zz.y, u.yy.z - u.zz.z), this._activeEffect.setFloat3("vSphericalZZ", u.zz.x, u.zz.y, u.zz.z), this._activeEffect.setFloat3("vSphericalXY", u.xy.x, u.xy.y, u.xy.z), this._activeEffect.setFloat3("vSphericalYZ", u.yz.x, u.yz.y, u.yz.z), this._activeEffect.setFloat3("vSphericalZX", u.zx.x, u.zx.y, u.zx.z)), this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos", l.getSize().width, l.lodGenerationScale, l.lodGenerationOffset) } if (this._emissiveTexture && ye.StandardMaterial.EmissiveTextureEnabled && (this._uniformBuffer.updateFloat2("vEmissiveInfos", this._emissiveTexture.coordinatesIndex, this._emissiveTexture.level), ye.MaterialHelper.BindTextureMatrix(this._emissiveTexture, this._uniformBuffer, "emissive")), this._lightmapTexture && ye.StandardMaterial.LightmapTextureEnabled && (this._uniformBuffer.updateFloat2("vLightmapInfos", this._lightmapTexture.coordinatesIndex, this._lightmapTexture.level), ye.MaterialHelper.BindTextureMatrix(this._lightmapTexture, this._uniformBuffer, "lightmap")), ye.StandardMaterial.SpecularTextureEnabled && (this._metallicTexture ? (this._uniformBuffer.updateFloat3("vReflectivityInfos", this._metallicTexture.coordinatesIndex, this._metallicTexture.level, this._ambientTextureStrength), ye.MaterialHelper.BindTextureMatrix(this._metallicTexture, this._uniformBuffer, "reflectivity")) : this._reflectivityTexture && (this._uniformBuffer.updateFloat3("vReflectivityInfos", this._reflectivityTexture.coordinatesIndex, this._reflectivityTexture.level, 1), ye.MaterialHelper.BindTextureMatrix(this._reflectivityTexture, this._uniformBuffer, "reflectivity")), this._microSurfaceTexture && (this._uniformBuffer.updateFloat2("vMicroSurfaceSamplerInfos", this._microSurfaceTexture.coordinatesIndex, this._microSurfaceTexture.level), ye.MaterialHelper.BindTextureMatrix(this._microSurfaceTexture, this._uniformBuffer, "microSurfaceSampler"))), this._bumpTexture && n.getEngine().getCaps().standardDerivatives && ye.StandardMaterial.BumpTextureEnabled && !this._disableBumpMap && (this._uniformBuffer.updateFloat3("vBumpInfos", this._bumpTexture.coordinatesIndex, this._bumpTexture.level, this._parallaxScaleBias), ye.MaterialHelper.BindTextureMatrix(this._bumpTexture, this._uniformBuffer, "bump"), n._mirroredCameraPosition ? this._uniformBuffer.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? 1 : -1, this._invertNormalMapY ? 1 : -1) : this._uniformBuffer.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? -1 : 1, this._invertNormalMapY ? -1 : 1)), c && ye.StandardMaterial.RefractionTextureEnabled) { this._uniformBuffer.updateMatrix("refractionMatrix", c.getReflectionTextureMatrix()); var d = 1; c.isCube || c.depth && (d = c.depth), this._uniformBuffer.updateFloat4("vRefractionInfos", c.level, this._indexOfRefraction, d, this._invertRefractionY ? -1 : 1), this._uniformBuffer.updateFloat3("vRefractionMicrosurfaceInfos", c.getSize().width, c.lodGenerationScale, c.lodGenerationOffset) } } this.pointsCloud && this._uniformBuffer.updateFloat("pointSize", this.pointSize), o.METALLICWORKFLOW ? (ye.PBRMaterial._scaledReflectivity.r = void 0 === this._metallic || null === this._metallic ? 1 : this._metallic, ye.PBRMaterial._scaledReflectivity.g = void 0 === this._roughness || null === this._roughness ? 1 : this._roughness, this._uniformBuffer.updateColor4("vReflectivityColor", ye.PBRMaterial._scaledReflectivity, 0)) : this._uniformBuffer.updateColor4("vReflectivityColor", this._reflectivityColor, this._microSurface), this._uniformBuffer.updateColor3("vEmissiveColor", this._emissiveColor), this._uniformBuffer.updateColor3("vReflectionColor", this._reflectionColor), this._uniformBuffer.updateColor4("vAlbedoColor", this._albedoColor, this.alpha * i.visibility), this._lightingInfos.x = this._directIntensity, this._lightingInfos.y = this._emissiveIntensity, this._lightingInfos.z = this._environmentIntensity, this._lightingInfos.w = this._specularIntensity, this._uniformBuffer.updateVector4("vLightingIntensity", this._lightingInfos) } n.texturesEnabled && (this._albedoTexture && ye.StandardMaterial.DiffuseTextureEnabled && this._uniformBuffer.setTexture("albedoSampler", this._albedoTexture), this._ambientTexture && ye.StandardMaterial.AmbientTextureEnabled && this._uniformBuffer.setTexture("ambientSampler", this._ambientTexture), this._opacityTexture && ye.StandardMaterial.OpacityTextureEnabled && this._uniformBuffer.setTexture("opacitySampler", this._opacityTexture), l && ye.StandardMaterial.ReflectionTextureEnabled && (o.LODBASEDMICROSFURACE ? this._uniformBuffer.setTexture("reflectionSampler", l) : (this._uniformBuffer.setTexture("reflectionSampler", l._lodTextureMid || l), this._uniformBuffer.setTexture("reflectionSamplerLow", l._lodTextureLow || l), this._uniformBuffer.setTexture("reflectionSamplerHigh", l._lodTextureHigh || l))), o.ENVIRONMENTBRDF && this._uniformBuffer.setTexture("environmentBrdfSampler", this._environmentBRDFTexture), c && ye.StandardMaterial.RefractionTextureEnabled && (o.LODBASEDMICROSFURACE ? this._uniformBuffer.setTexture("refractionSampler", c) : (this._uniformBuffer.setTexture("refractionSampler", c._lodTextureMid || c), this._uniformBuffer.setTexture("refractionSamplerLow", c._lodTextureLow || c), this._uniformBuffer.setTexture("refractionSamplerHigh", c._lodTextureHigh || c))), this._emissiveTexture && ye.StandardMaterial.EmissiveTextureEnabled && this._uniformBuffer.setTexture("emissiveSampler", this._emissiveTexture), this._lightmapTexture && ye.StandardMaterial.LightmapTextureEnabled && this._uniformBuffer.setTexture("lightmapSampler", this._lightmapTexture), ye.StandardMaterial.SpecularTextureEnabled && (this._metallicTexture ? this._uniformBuffer.setTexture("reflectivitySampler", this._metallicTexture) : this._reflectivityTexture && this._uniformBuffer.setTexture("reflectivitySampler", this._reflectivityTexture), this._microSurfaceTexture && this._uniformBuffer.setTexture("microSurfaceSampler", this._microSurfaceTexture)), this._bumpTexture && n.getEngine().getCaps().standardDerivatives && ye.StandardMaterial.BumpTextureEnabled && !this._disableBumpMap && this._uniformBuffer.setTexture("bumpSampler", this._bumpTexture)), ye.MaterialHelper.BindClipPlane(this._activeEffect, n), n.ambientColor.multiplyToRef(this._ambientColor, this._globalAmbientColor); var f = n._forcedViewPosition ? n._forcedViewPosition : n._mirroredCameraPosition ? n._mirroredCameraPosition : n.activeCamera.globalPosition, p = n.useRightHandedSystem === (null != n._mirroredCameraPosition); s.setFloat4("vEyePosition", f.x, f.y, f.z, p ? -1 : 1), s.setColor3("vAmbientColor", this._globalAmbientColor) } !a && this.isFrozen || (n.lightsEnabled && !this._disableLighting && ye.MaterialHelper.BindLights(n, i, this._activeEffect, o, this._maxSimultaneousLights, this._lightFalloff !== t.LIGHTFALLOFF_STANDARD), (n.fogEnabled && i.applyFog && n.fogMode !== ye.Scene.FOGMODE_NONE || l) && this.bindView(s), ye.MaterialHelper.BindFogParameters(n, i, this._activeEffect, !0), o.NUM_MORPH_INFLUENCERS && ye.MaterialHelper.BindMorphTargetParameters(i, this._activeEffect), this._imageProcessingConfiguration.bind(this._activeEffect), ye.MaterialHelper.BindLogDepth(o, this._activeEffect, n)), this._uniformBuffer.update(), this._afterBind(i, this._activeEffect) } } }, t.prototype.getAnimatables = function () { var e = []; return this._albedoTexture && this._albedoTexture.animations && 0 < this._albedoTexture.animations.length && e.push(this._albedoTexture), this._ambientTexture && this._ambientTexture.animations && 0 < this._ambientTexture.animations.length && e.push(this._ambientTexture), this._opacityTexture && this._opacityTexture.animations && 0 < this._opacityTexture.animations.length && e.push(this._opacityTexture), this._reflectionTexture && this._reflectionTexture.animations && 0 < this._reflectionTexture.animations.length && e.push(this._reflectionTexture), this._emissiveTexture && this._emissiveTexture.animations && 0 < this._emissiveTexture.animations.length && e.push(this._emissiveTexture), this._metallicTexture && this._metallicTexture.animations && 0 < this._metallicTexture.animations.length ? e.push(this._metallicTexture) : this._reflectivityTexture && this._reflectivityTexture.animations && 0 < this._reflectivityTexture.animations.length && e.push(this._reflectivityTexture), this._bumpTexture && this._bumpTexture.animations && 0 < this._bumpTexture.animations.length && e.push(this._bumpTexture), this._lightmapTexture && this._lightmapTexture.animations && 0 < this._lightmapTexture.animations.length && e.push(this._lightmapTexture), this._refractionTexture && this._refractionTexture.animations && 0 < this._refractionTexture.animations.length && e.push(this._refractionTexture), e }, t.prototype._getReflectionTexture = function () { return this._reflectionTexture ? this._reflectionTexture : this.getScene().environmentTexture }, t.prototype._getRefractionTexture = function () { return this._refractionTexture ? this._refractionTexture : this._linkRefractionWithTransparency ? this.getScene().environmentTexture : null }, t.prototype.dispose = function (t, i) { i && (this._albedoTexture && this._albedoTexture.dispose(), this._ambientTexture && this._ambientTexture.dispose(), this._opacityTexture && this._opacityTexture.dispose(), this._reflectionTexture && this._reflectionTexture.dispose(), this._environmentBRDFTexture && this.getScene()._environmentBRDFTexture !== this._environmentBRDFTexture && this._environmentBRDFTexture.dispose(), this._emissiveTexture && this._emissiveTexture.dispose(), this._metallicTexture && this._metallicTexture.dispose(), this._reflectivityTexture && this._reflectivityTexture.dispose(), this._bumpTexture && this._bumpTexture.dispose(), this._lightmapTexture && this._lightmapTexture.dispose(), this._refractionTexture && this._refractionTexture.dispose()), this._renderTargets.dispose(), this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), e.prototype.dispose.call(this, t, i) }, t.LIGHTFALLOFF_PHYSICAL = 0, t.LIGHTFALLOFF_GLTF = 1, t.LIGHTFALLOFF_STANDARD = 2, t._scaledReflectivity = new ye.Color3, b([ye.serializeAsImageProcessingConfiguration()], t.prototype, "_imageProcessingConfiguration", void 0), b([ye.serialize()], t.prototype, "useLogarithmicDepth", null), b([ye.serialize()], t.prototype, "transparencyMode", null), t }(ye.PushMaterial), ye.PBRBaseMaterial = Te, xe = function (e) { function t(t, i) { var r = e.call(this, t, i) || this; return r.maxSimultaneousLights = 4, r.disableLighting = !1, r.invertNormalMapX = !1, r.invertNormalMapY = !1, r.emissiveColor = new Ee.Color3(0, 0, 0), r.occlusionStrength = 1, r.useLightmapAsShadowmap = !1, r._useAlphaFromAlbedoTexture = !0, r._useAmbientInGrayScale = !0, r } return T(t, e), Object.defineProperty(t.prototype, "doubleSided", { get: function () { return this._twoSidedLighting }, set: function (e) { this._twoSidedLighting !== e && (this._twoSidedLighting = e, this.backFaceCulling = !e, this._markAllSubMeshesAsTexturesDirty()) }, enumerable: !0, configurable: !0 }), t.prototype.getActiveTextures = function () { var t = e.prototype.getActiveTextures.call(this); return this.environmentTexture && t.push(this.environmentTexture), this.normalTexture && t.push(this.normalTexture), this.emissiveTexture && t.push(this.emissiveTexture), this.occlusionTexture && t.push(this.occlusionTexture), this.lightmapTexture && t.push(this.lightmapTexture), t }, t.prototype.hasTexture = function (t) { return !!e.prototype.hasTexture.call(this, t) || this.lightmapTexture === t }, t.prototype.getClassName = function () { return "PBRBaseSimpleMaterial" }, b([Ee.serialize(), Ee.expandToProperty("_markAllSubMeshesAsLightsDirty")], t.prototype, "maxSimultaneousLights", void 0), b([Ee.serialize(), Ee.expandToProperty("_markAllSubMeshesAsLightsDirty")], t.prototype, "disableLighting", void 0), b([Ee.serializeAsTexture(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_reflectionTexture")], t.prototype, "environmentTexture", void 0), b([Ee.serialize(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "invertNormalMapX", void 0), b([Ee.serialize(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "invertNormalMapY", void 0), b([Ee.serializeAsTexture(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_bumpTexture")], t.prototype, "normalTexture", void 0), b([Ee.serializeAsColor3("emissive"), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "emissiveColor", void 0), b([Ee.serializeAsTexture(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "emissiveTexture", void 0), b([Ee.serialize(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_ambientTextureStrength")], t.prototype, "occlusionStrength", void 0), b([Ee.serializeAsTexture(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_ambientTexture")], t.prototype, "occlusionTexture", void 0), b([Ee.serialize(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_alphaCutOff")], t.prototype, "alphaCutOff", void 0), b([Ee.serialize()], t.prototype, "doubleSided", null), b([Ee.serializeAsTexture(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty", null)], t.prototype, "lightmapTexture", void 0), b([Ee.serialize(), Ee.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useLightmapAsShadowmap", void 0), t }((Ee = $a || ($a = {})).PBRBaseMaterial), Ee.PBRBaseSimpleMaterial = xe, Ae = function (e) { function t(i, r) { var n = e.call(this, i, r) || this; return n.directIntensity = 1, n.emissiveIntensity = 1, n.environmentIntensity = 1, n.specularIntensity = 1, n.disableBumpMap = !1, n.ambientTextureStrength = 1, n.ambientTextureImpactOnAnalyticalLights = t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS, n.ambientColor = new Pe.Color3(0, 0, 0), n.albedoColor = new Pe.Color3(1, 1, 1), n.reflectivityColor = new Pe.Color3(1, 1, 1), n.reflectionColor = new Pe.Color3(1, 1, 1), n.emissiveColor = new Pe.Color3(0, 0, 0), n.microSurface = 1, n.indexOfRefraction = .66, n.invertRefractionY = !1, n.linkRefractionWithTransparency = !1, n.useLightmapAsShadowmap = !1, n.useAlphaFromAlbedoTexture = !1, n.forceAlphaTest = !1, n.alphaCutOff = .4, n.useSpecularOverAlpha = !0, n.useMicroSurfaceFromReflectivityMapAlpha = !1, n.useRoughnessFromMetallicTextureAlpha = !0, n.useRoughnessFromMetallicTextureGreen = !1, n.useMetallnessFromMetallicTextureBlue = !1, n.useAmbientOcclusionFromMetallicTextureRed = !1, n.useAmbientInGrayScale = !1, n.useAutoMicroSurfaceFromReflectivityMap = !1, n.useRadianceOverAlpha = !0, n.useObjectSpaceNormalMap = !1, n.useParallax = !1, n.useParallaxOcclusion = !1, n.parallaxScaleBias = .05, n.disableLighting = !1, n.forceIrradianceInFragment = !1, n.maxSimultaneousLights = 4, n.invertNormalMapX = !1, n.invertNormalMapY = !1, n.twoSidedLighting = !1, n.useAlphaFresnel = !1, n.useLinearAlphaFresnel = !1, n.environmentBRDFTexture = null, n.forceNormalForward = !1, n.enableSpecularAntiAliasing = !1, n.useHorizonOcclusion = !0, n.useRadianceOcclusion = !0, n.unlit = !1, n._environmentBRDFTexture = Pe.TextureTools.GetEnvironmentBRDFTexture(r), n } return T(t, e), Object.defineProperty(t.prototype, "usePhysicalLightFalloff", { get: function () { return this._lightFalloff === Pe.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL }, set: function (e) { e !== this.usePhysicalLightFalloff && (this._markAllSubMeshesAsTexturesDirty(), this._lightFalloff = e ? Pe.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL : Pe.PBRBaseMaterial.LIGHTFALLOFF_STANDARD) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "useGLTFLightFalloff", { get: function () { return this._lightFalloff === Pe.PBRBaseMaterial.LIGHTFALLOFF_GLTF }, set: function (e) { e !== this.useGLTFLightFalloff && (this._markAllSubMeshesAsTexturesDirty(), this._lightFalloff = e ? Pe.PBRBaseMaterial.LIGHTFALLOFF_GLTF : Pe.PBRBaseMaterial.LIGHTFALLOFF_STANDARD) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "imageProcessingConfiguration", { get: function () { return this._imageProcessingConfiguration }, set: function (e) { this._attachImageProcessingConfiguration(e), this._markAllSubMeshesAsTexturesDirty() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraColorCurvesEnabled", { get: function () { return this.imageProcessingConfiguration.colorCurvesEnabled }, set: function (e) { this.imageProcessingConfiguration.colorCurvesEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraColorGradingEnabled", { get: function () { return this.imageProcessingConfiguration.colorGradingEnabled }, set: function (e) { this.imageProcessingConfiguration.colorGradingEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraToneMappingEnabled", { get: function () { return this._imageProcessingConfiguration.toneMappingEnabled }, set: function (e) { this._imageProcessingConfiguration.toneMappingEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraExposure", { get: function () { return this._imageProcessingConfiguration.exposure }, set: function (e) { this._imageProcessingConfiguration.exposure = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraContrast", { get: function () { return this._imageProcessingConfiguration.contrast }, set: function (e) { this._imageProcessingConfiguration.contrast = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraColorGradingTexture", { get: function () { return this._imageProcessingConfiguration.colorGradingTexture }, set: function (e) { this._imageProcessingConfiguration.colorGradingTexture = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraColorCurves", { get: function () { return this._imageProcessingConfiguration.colorCurves }, set: function (e) { this._imageProcessingConfiguration.colorCurves = e }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "PBRMaterial" }, t.prototype.getActiveTextures = function () { var t = e.prototype.getActiveTextures.call(this); return this._albedoTexture && t.push(this._albedoTexture), this._ambientTexture && t.push(this._ambientTexture), this._opacityTexture && t.push(this._opacityTexture), this._reflectionTexture && t.push(this._reflectionTexture), this._emissiveTexture && t.push(this._emissiveTexture), this._reflectivityTexture && t.push(this._reflectivityTexture), this._metallicTexture && t.push(this._metallicTexture), this._microSurfaceTexture && t.push(this._microSurfaceTexture), this._bumpTexture && t.push(this._bumpTexture), this._lightmapTexture && t.push(this._lightmapTexture), this._refractionTexture && t.push(this._refractionTexture), t }, t.prototype.hasTexture = function (t) { return !!e.prototype.hasTexture.call(this, t) || this._albedoTexture === t || this._ambientTexture === t || this._opacityTexture === t || this._reflectionTexture === t || this._reflectivityTexture === t || this._metallicTexture === t || this._microSurfaceTexture === t || this._bumpTexture === t || this._lightmapTexture === t || this._refractionTexture === t }, t.prototype.clone = function (e) { var i = this, r = Pe.SerializationHelper.Clone(function () { return new t(e, i.getScene()) }, this); return r.id = e, r.name = e, r }, t.prototype.serialize = function () { var e = Pe.SerializationHelper.Serialize(this); return e.customType = "BABYLON.PBRMaterial", e }, t.Parse = function (e, i, r) { return Pe.SerializationHelper.Parse(function () { return new t(e.name, i) }, e, i, r) }, t.PBRMATERIAL_OPAQUE = 0, t.PBRMATERIAL_ALPHATEST = 1, t.PBRMATERIAL_ALPHABLEND = 2, t.PBRMATERIAL_ALPHATESTANDBLEND = 3, t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS = 1, b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "directIntensity", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "emissiveIntensity", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "environmentIntensity", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "specularIntensity", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "disableBumpMap", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "albedoTexture", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "ambientTexture", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "ambientTextureStrength", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "ambientTextureImpactOnAnalyticalLights", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], t.prototype, "opacityTexture", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionTexture", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "emissiveTexture", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectivityTexture", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "metallicTexture", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "metallic", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "roughness", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "microSurfaceTexture", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "bumpTexture", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty", null)], t.prototype, "lightmapTexture", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "refractionTexture", void 0), b([Pe.serializeAsColor3("ambient"), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "ambientColor", void 0), b([Pe.serializeAsColor3("albedo"), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "albedoColor", void 0), b([Pe.serializeAsColor3("reflectivity"), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectivityColor", void 0), b([Pe.serializeAsColor3("reflection"), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionColor", void 0), b([Pe.serializeAsColor3("emissive"), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "emissiveColor", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "microSurface", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "indexOfRefraction", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "invertRefractionY", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "linkRefractionWithTransparency", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useLightmapAsShadowmap", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], t.prototype, "useAlphaFromAlbedoTexture", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], t.prototype, "forceAlphaTest", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], t.prototype, "alphaCutOff", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useSpecularOverAlpha", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useMicroSurfaceFromReflectivityMapAlpha", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useRoughnessFromMetallicTextureAlpha", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useRoughnessFromMetallicTextureGreen", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useMetallnessFromMetallicTextureBlue", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useAmbientOcclusionFromMetallicTextureRed", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useAmbientInGrayScale", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useAutoMicroSurfaceFromReflectivityMap", void 0), b([Pe.serialize()], t.prototype, "usePhysicalLightFalloff", null), b([Pe.serialize()], t.prototype, "useGLTFLightFalloff", null), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useRadianceOverAlpha", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useObjectSpaceNormalMap", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useParallax", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useParallaxOcclusion", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "parallaxScaleBias", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsLightsDirty")], t.prototype, "disableLighting", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "forceIrradianceInFragment", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsLightsDirty")], t.prototype, "maxSimultaneousLights", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "invertNormalMapX", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "invertNormalMapY", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "twoSidedLighting", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useAlphaFresnel", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useLinearAlphaFresnel", void 0), b([Pe.serializeAsTexture(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "environmentBRDFTexture", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "forceNormalForward", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "enableSpecularAntiAliasing", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useHorizonOcclusion", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useRadianceOcclusion", void 0), b([Pe.serialize(), Pe.expandToProperty("_markAllSubMeshesAsMiscDirty")], t.prototype, "unlit", void 0), t }((Pe = $a || ($a = {})).PBRBaseMaterial), Pe.PBRMaterial = Ae, Me = function (e) { function t(t, i) { var r = e.call(this, t, i) || this; return r._useRoughnessFromMetallicTextureAlpha = !1, r._useRoughnessFromMetallicTextureGreen = !0, r._useMetallnessFromMetallicTextureBlue = !0, r.metallic = 1, r.roughness = 1, r } return T(t, e), t.prototype.getClassName = function () { return "PBRMetallicRoughnessMaterial" }, t.prototype.getActiveTextures = function () { var t = e.prototype.getActiveTextures.call(this); return this.baseTexture && t.push(this.baseTexture), this.metallicRoughnessTexture && t.push(this.metallicRoughnessTexture), t }, t.prototype.hasTexture = function (t) { return !!e.prototype.hasTexture.call(this, t) || this.baseTexture === t || this.metallicRoughnessTexture === t }, t.prototype.clone = function (e) { var i = this, r = Se.SerializationHelper.Clone(function () { return new t(e, i.getScene()) }, this); return r.id = e, r.name = e, r }, t.prototype.serialize = function () { var e = Se.SerializationHelper.Serialize(this); return e.customType = "BABYLON.PBRMetallicRoughnessMaterial", e }, t.Parse = function (e, i, r) { return Se.SerializationHelper.Parse(function () { return new t(e.name, i) }, e, i, r) }, b([Se.serializeAsColor3(), Se.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_albedoColor")], t.prototype, "baseColor", void 0), b([Se.serializeAsTexture(), Se.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_albedoTexture")], t.prototype, "baseTexture", void 0), b([Se.serialize(), Se.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "metallic", void 0), b([Se.serialize(), Se.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "roughness", void 0), b([Se.serializeAsTexture(), Se.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_metallicTexture")], t.prototype, "metallicRoughnessTexture", void 0), t }((Se = $a || ($a = {})).PBRBaseSimpleMaterial), Se.PBRMetallicRoughnessMaterial = Me, Ce = function (e) { function t(t, i) { var r = e.call(this, t, i) || this; return r._useMicroSurfaceFromReflectivityMapAlpha = !0, r } return T(t, e), t.prototype.getClassName = function () { return "PBRSpecularGlossinessMaterial" }, t.prototype.getActiveTextures = function () { var t = e.prototype.getActiveTextures.call(this); return this.diffuseTexture && t.push(this.diffuseTexture), this.specularGlossinessTexture && t.push(this.specularGlossinessTexture), t }, t.prototype.hasTexture = function (t) { return !!e.prototype.hasTexture.call(this, t) || this.diffuseTexture === t || this.specularGlossinessTexture === t }, t.prototype.clone = function (e) { var i = this, r = Re.SerializationHelper.Clone(function () { return new t(e, i.getScene()) }, this); return r.id = e, r.name = e, r }, t.prototype.serialize = function () { var e = Re.SerializationHelper.Serialize(this); return e.customType = "BABYLON.PBRSpecularGlossinessMaterial", e }, t.Parse = function (e, i, r) { return Re.SerializationHelper.Parse(function () { return new t(e.name, i) }, e, i, r) }, b([Re.serializeAsColor3("diffuse"), Re.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_albedoColor")], t.prototype, "diffuseColor", void 0), b([Re.serializeAsTexture(), Re.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_albedoTexture")], t.prototype, "diffuseTexture", void 0), b([Re.serializeAsColor3("specular"), Re.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_reflectivityColor")], t.prototype, "specularColor", void 0), b([Re.serialize(), Re.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_microSurface")], t.prototype, "glossiness", void 0), b([Re.serializeAsTexture(), Re.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_reflectivityTexture")], t.prototype, "specularGlossinessTexture", void 0), t }((Re = $a || ($a = {})).PBRBaseSimpleMaterial), Re.PBRSpecularGlossinessMaterial = Ce, function (e) { e.CameraInputTypes = {}; var t = function () { function t(e) { this.attached = {}, this.camera = e, this.checkInputs = function () { } } return t.prototype.add = function (t) { var i = t.getSimpleName(); this.attached[i] ? e.Tools.Warn("camera input of type " + i + " already exists on camera") : ((this.attached[i] = t).camera = this.camera, t.checkInputs && (this.checkInputs = this._addCheckInputs(t.checkInputs.bind(t))), this.attachedElement && t.attachControl(this.attachedElement)) }, t.prototype.remove = function (e) { for (var t in this.attached) { var i = this.attached[t]; i === e && (i.detachControl(this.attachedElement), i.camera = null, delete this.attached[t], this.rebuildInputCheck()) } }, t.prototype.removeByType = function (e) { for (var t in this.attached) { var i = this.attached[t]; i.getClassName() === e && (i.detachControl(this.attachedElement), i.camera = null, delete this.attached[t], this.rebuildInputCheck()) } }, t.prototype._addCheckInputs = function (e) { var t = this.checkInputs; return function () { t(), e() } }, t.prototype.attachInput = function (e) { this.attachedElement && e.attachControl(this.attachedElement, this.noPreventDefault) }, t.prototype.attachElement = function (t, i) { if (void 0 === i && (i = !1), !this.attachedElement) for (var r in i = !e.Camera.ForceAttachControlToAlwaysPreventDefault && i, this.attachedElement = t, this.noPreventDefault = i, this.attached) this.attached[r].attachControl(t, i) }, t.prototype.detachElement = function (e, t) { if (void 0 === t && (t = !1), this.attachedElement === e) { for (var i in this.attached) this.attached[i].detachControl(e), t && (this.attached[i].camera = null); this.attachedElement = null } }, t.prototype.rebuildInputCheck = function () { for (var e in this.checkInputs = function () { }, this.attached) { var t = this.attached[e]; t.checkInputs && (this.checkInputs = this._addCheckInputs(t.checkInputs.bind(t))) } }, t.prototype.clear = function () { this.attachedElement && this.detachElement(this.attachedElement, !0), this.attached = {}, this.attachedElement = null, this.checkInputs = function () { } }, t.prototype.serialize = function (t) { var i = {}; for (var r in this.attached) { var n = this.attached[r], o = e.SerializationHelper.Serialize(n); i[n.getClassName()] = o } t.inputsmgr = i }, t.prototype.parse = function (t) { var i = t.inputsmgr; if (i) { for (var r in this.clear(), i) if (s = e.CameraInputTypes[r]) { var n = i[r], o = e.SerializationHelper.Parse(function () { return new s }, n, null); this.add(o) } } else for (var r in this.attached) { var s; (s = e.CameraInputTypes[this.attached[r].getClassName()]) && (o = e.SerializationHelper.Parse(function () { return new s }, t, null), this.remove(this.attached[r]), this.add(o)) } }, t }(); e.CameraInputsManager = t }($a || ($a = {})), De = function (e) { function t(t, i, r, n) { void 0 === n && (n = !0); var o = e.call(this, t, i, r, n) || this; return o.cameraDirection = new Oe.Vector3(0, 0, 0), o.cameraRotation = new Oe.Vector2(0, 0), o.rotation = new Oe.Vector3(0, 0, 0), o.speed = 2, o.noRotationConstraint = !1, o.lockedTarget = null, o._currentTarget = Oe.Vector3.Zero(), o._viewMatrix = Oe.Matrix.Zero(), o._camMatrix = Oe.Matrix.Zero(), o._cameraTransformMatrix = Oe.Matrix.Zero(), o._cameraRotationMatrix = Oe.Matrix.Zero(), o._referencePoint = new Oe.Vector3(0, 0, 1), o._transformedReferencePoint = Oe.Vector3.Zero(), o._globalCurrentTarget = Oe.Vector3.Zero(), o._globalCurrentUpVector = Oe.Vector3.Zero(), o._defaultUp = Oe.Vector3.Up(), o._cachedRotationZ = 0, o._cachedQuaternionRotationZ = 0, o } return T(t, e), t.prototype.getFrontPosition = function (e) { this.getWorldMatrix(); var t = this.getTarget().subtract(this.position); return t.normalize(), t.scaleInPlace(e), this.globalPosition.add(t) }, t.prototype._getLockedTargetPosition = function () { return this.lockedTarget ? (this.lockedTarget.absolutePosition && this.lockedTarget.computeWorldMatrix(), this.lockedTarget.absolutePosition || this.lockedTarget) : null }, t.prototype.storeState = function () { return this._storedPosition = this.position.clone(), this._storedRotation = this.rotation.clone(), this.rotationQuaternion && (this._storedRotationQuaternion = this.rotationQuaternion.clone()), e.prototype.storeState.call(this) }, t.prototype._restoreStateValues = function () { return !!e.prototype._restoreStateValues.call(this) && (this.position = this._storedPosition.clone(), this.rotation = this._storedRotation.clone(), this.rotationQuaternion && (this.rotationQuaternion = this._storedRotationQuaternion.clone()), this.cameraDirection.copyFromFloats(0, 0, 0), this.cameraRotation.copyFromFloats(0, 0), !0) }, t.prototype._initCache = function () { e.prototype._initCache.call(this), this._cache.lockedTarget = new Oe.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.rotation = new Oe.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.rotationQuaternion = new Oe.Quaternion(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE) }, t.prototype._updateCache = function (t) { t || e.prototype._updateCache.call(this); var i = this._getLockedTargetPosition(); i ? this._cache.lockedTarget ? this._cache.lockedTarget.copyFrom(i) : this._cache.lockedTarget = i.clone() : this._cache.lockedTarget = null, this._cache.rotation.copyFrom(this.rotation), this.rotationQuaternion && this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion) }, t.prototype._isSynchronizedViewMatrix = function () { if (!e.prototype._isSynchronizedViewMatrix.call(this)) return !1; var t = this._getLockedTargetPosition(); return (this._cache.lockedTarget ? this._cache.lockedTarget.equals(t) : !t) && (this.rotationQuaternion ? this.rotationQuaternion.equals(this._cache.rotationQuaternion) : this._cache.rotation.equals(this.rotation)) }, t.prototype._computeLocalCameraSpeed = function () { var e = this.getEngine(); return this.speed * Math.sqrt(e.getDeltaTime() / (100 * e.getFps())) }, t.prototype.setTarget = function (e) { this.upVector.normalize(), this.position.z === e.z && (this.position.z += Oe.Epsilon), Oe.Matrix.LookAtLHToRef(this.position, e, this._defaultUp, this._camMatrix), this._camMatrix.invert(), this.rotation.x = Math.atan(this._camMatrix.m[6] / this._camMatrix.m[10]); var t = e.subtract(this.position); 0 <= t.x ? this.rotation.y = -Math.atan(t.z / t.x) + Math.PI / 2 : this.rotation.y = -Math.atan(t.z / t.x) - Math.PI / 2, this.rotation.z = 0, isNaN(this.rotation.x) && (this.rotation.x = 0), isNaN(this.rotation.y) && (this.rotation.y = 0), isNaN(this.rotation.z) && (this.rotation.z = 0), this.rotationQuaternion && Oe.Quaternion.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this.rotationQuaternion) }, t.prototype.getTarget = function () { return this._currentTarget }, t.prototype._decideIfNeedsToMove = function () { return 0 < Math.abs(this.cameraDirection.x) || 0 < Math.abs(this.cameraDirection.y) || 0 < Math.abs(this.cameraDirection.z) }, t.prototype._updatePosition = function () { if (this.parent) return this.parent.getWorldMatrix().invertToRef(Oe.Tmp.Matrix[0]), Oe.Vector3.TransformNormalToRef(this.cameraDirection, Oe.Tmp.Matrix[0], Oe.Tmp.Vector3[0]), void this.position.addInPlace(Oe.Tmp.Vector3[0]); this.position.addInPlace(this.cameraDirection) }, t.prototype._checkInputs = function () { var t = this._decideIfNeedsToMove(), i = 0 < Math.abs(this.cameraRotation.x) || 0 < Math.abs(this.cameraRotation.y); if (t && this._updatePosition(), i && (this.rotation.x += this.cameraRotation.x, this.rotation.y += this.cameraRotation.y, this.rotationQuaternion && this.rotation.lengthSquared() && Oe.Quaternion.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this.rotationQuaternion), !this.noRotationConstraint)) { var r = Math.PI / 2 * .95; this.rotation.x > r && (this.rotation.x = r), this.rotation.x < -r && (this.rotation.x = -r) } t && (Math.abs(this.cameraDirection.x) < this.speed * Oe.Epsilon && (this.cameraDirection.x = 0), Math.abs(this.cameraDirection.y) < this.speed * Oe.Epsilon && (this.cameraDirection.y = 0), Math.abs(this.cameraDirection.z) < this.speed * Oe.Epsilon && (this.cameraDirection.z = 0), this.cameraDirection.scaleInPlace(this.inertia)), i && (Math.abs(this.cameraRotation.x) < this.speed * Oe.Epsilon && (this.cameraRotation.x = 0), Math.abs(this.cameraRotation.y) < this.speed * Oe.Epsilon && (this.cameraRotation.y = 0), this.cameraRotation.scaleInPlace(this.inertia)), e.prototype._checkInputs.call(this) }, t.prototype._updateCameraRotationMatrix = function () { this.rotationQuaternion ? this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix) : Oe.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this._cameraRotationMatrix) }, t.prototype._rotateUpVectorWithCameraRotationMatrix = function () { return Oe.Vector3.TransformNormalToRef(this._defaultUp, this._cameraRotationMatrix, this.upVector), this }, t.prototype._getViewMatrix = function () { return this.lockedTarget && this.setTarget(this._getLockedTargetPosition()), this._updateCameraRotationMatrix(), this.rotationQuaternion && this._cachedQuaternionRotationZ != this.rotationQuaternion.z ? (this._rotateUpVectorWithCameraRotationMatrix(), this._cachedQuaternionRotationZ = this.rotationQuaternion.z) : this._cachedRotationZ != this.rotation.z && (this._rotateUpVectorWithCameraRotationMatrix(), this._cachedRotationZ = this.rotation.z), Oe.Vector3.TransformCoordinatesToRef(this._referencePoint, this._cameraRotationMatrix, this._transformedReferencePoint), this.position.addToRef(this._transformedReferencePoint, this._currentTarget), this._computeViewMatrix(this.position, this._currentTarget, this.upVector), this._viewMatrix }, t.prototype._computeViewMatrix = function (e, t, i) { if (this.parent) { var r = this.parent.getWorldMatrix(); Oe.Vector3.TransformCoordinatesToRef(e, r, this._globalPosition), Oe.Vector3.TransformCoordinatesToRef(t, r, this._globalCurrentTarget), Oe.Vector3.TransformNormalToRef(i, r, this._globalCurrentUpVector), this._markSyncedWithParent() } else this._globalPosition.copyFrom(e), this._globalCurrentTarget.copyFrom(t), this._globalCurrentUpVector.copyFrom(i); this.getScene().useRightHandedSystem ? Oe.Matrix.LookAtRHToRef(this._globalPosition, this._globalCurrentTarget, this._globalCurrentUpVector, this._viewMatrix) : Oe.Matrix.LookAtLHToRef(this._globalPosition, this._globalCurrentTarget, this._globalCurrentUpVector, this._viewMatrix) }, t.prototype.createRigCamera = function (e, i) { if (this.cameraRigMode !== Oe.Camera.RIG_MODE_NONE) { var r = new t(e, this.position.clone(), this.getScene()); return this.cameraRigMode !== Oe.Camera.RIG_MODE_VR && this.cameraRigMode !== Oe.Camera.RIG_MODE_WEBVR || (this.rotationQuaternion || (this.rotationQuaternion = new Oe.Quaternion), r._cameraRigParams = {}, r.rotationQuaternion = new Oe.Quaternion), r } return null }, t.prototype._updateRigCameras = function () { var t = this._rigCameras[0], i = this._rigCameras[1]; switch (this.cameraRigMode) { case Oe.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH: case Oe.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL: case Oe.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED: case Oe.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER: var r = this.cameraRigMode === Oe.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED ? 1 : -1, n = this.cameraRigMode === Oe.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED ? -1 : 1; this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle * r, t.position), this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle * n, i.position), t.setTarget(this.getTarget()), i.setTarget(this.getTarget()); break; case Oe.Camera.RIG_MODE_VR: t.rotationQuaternion ? (t.rotationQuaternion.copyFrom(this.rotationQuaternion), i.rotationQuaternion.copyFrom(this.rotationQuaternion)) : (t.rotation.copyFrom(this.rotation), i.rotation.copyFrom(this.rotation)), t.position.copyFrom(this.position), i.position.copyFrom(this.position) }e.prototype._updateRigCameras.call(this) }, t.prototype._getRigCamPosition = function (e, t) { this._rigCamTransformMatrix || (this._rigCamTransformMatrix = new Oe.Matrix); var i = this.getTarget(); Oe.Matrix.Translation(-i.x, -i.y, -i.z).multiplyToRef(Oe.Matrix.RotationY(e), this._rigCamTransformMatrix), this._rigCamTransformMatrix = this._rigCamTransformMatrix.multiply(Oe.Matrix.Translation(i.x, i.y, i.z)), Oe.Vector3.TransformCoordinatesToRef(this.position, this._rigCamTransformMatrix, t) }, t.prototype.getClassName = function () { return "TargetCamera" }, b([Oe.serializeAsVector3()], t.prototype, "rotation", void 0), b([Oe.serialize()], t.prototype, "speed", void 0), b([Oe.serializeAsMeshReference("lockedTargetId")], t.prototype, "lockedTarget", void 0), t }((Oe = $a || ($a = {})).Camera), Oe.TargetCamera = De, Ie = $a || ($a = {}), we = function () { function e(e) { void 0 === e && (e = !0), this.touchEnabled = e, this.buttons = [0, 1, 2], this.angularSensibility = 2e3, this.previousPosition = null } return e.prototype.attachControl = function (e, t) { var i = this, r = this.camera.getEngine(); this._pointerInput || (this._pointerInput = function (n, o) { var s = n.event; if (!r.isInVRExclusivePointerMode && (i.touchEnabled || "touch" !== s.pointerType) && (n.type === Ie.PointerEventTypes.POINTERMOVE || -1 !== i.buttons.indexOf(s.button))) { var a = s.srcElement || s.target; if (n.type === Ie.PointerEventTypes.POINTERDOWN && a) { try { a.setPointerCapture(s.pointerId) } catch (n) { } i.previousPosition = { x: s.clientX, y: s.clientY }, t || (s.preventDefault(), e.focus()) } else if (n.type === Ie.PointerEventTypes.POINTERUP && a) { try { a.releasePointerCapture(s.pointerId) } catch (n) { } i.previousPosition = null, t || s.preventDefault() } else if (n.type === Ie.PointerEventTypes.POINTERMOVE) { if (!i.previousPosition || r.isPointerLock) return; var l = s.clientX - i.previousPosition.x; i.camera.getScene().useRightHandedSystem && (l *= -1), i.camera.parent && i.camera.parent._getWorldMatrixDeterminant() < 0 && (l *= -1), i.camera.cameraRotation.y += l / i.angularSensibility; var c = s.clientY - i.previousPosition.y; i.camera.cameraRotation.x += c / i.angularSensibility, i.previousPosition = { x: s.clientX, y: s.clientY }, t || s.preventDefault() } } }), this._onMouseMove = function (e) { if (r.isPointerLock && !r.isInVRExclusivePointerMode) { var n = e.movementX || e.mozMovementX || e.webkitMovementX || e.msMovementX || 0; i.camera.getScene().useRightHandedSystem && (n *= -1), i.camera.parent && i.camera.parent._getWorldMatrixDeterminant() < 0 && (n *= -1), i.camera.cameraRotation.y += n / i.angularSensibility; var o = e.movementY || e.mozMovementY || e.webkitMovementY || e.msMovementY || 0; i.camera.cameraRotation.x += o / i.angularSensibility, i.previousPosition = null, t || e.preventDefault() } }, this._observer = this.camera.getScene().onPointerObservable.add(this._pointerInput, Ie.PointerEventTypes.POINTERDOWN | Ie.PointerEventTypes.POINTERUP | Ie.PointerEventTypes.POINTERMOVE), e.addEventListener("mousemove", this._onMouseMove, !1) }, e.prototype.detachControl = function (e) { this._observer && e && (this.camera.getScene().onPointerObservable.remove(this._observer), this._onMouseMove && e.removeEventListener("mousemove", this._onMouseMove), this._observer = null, this._onMouseMove = null, this.previousPosition = null) }, e.prototype.getClassName = function () { return "FreeCameraMouseInput" }, e.prototype.getSimpleName = function () { return "mouse" }, b([Ie.serialize()], e.prototype, "buttons", void 0), b([Ie.serialize()], e.prototype, "angularSensibility", void 0), e }(), Ie.FreeCameraMouseInput = we, Ie.CameraInputTypes.FreeCameraMouseInput = we, Le = $a || ($a = {}), Fe = function () { function e() { this.keysUp = [38], this.keysDown = [40], this.keysLeft = [37], this.keysRight = [39], this._keys = new Array } return e.prototype.attachControl = function (e, t) { var i = this; this._onCanvasBlurObserver || (this._scene = this.camera.getScene(), this._engine = this._scene.getEngine(), this._onCanvasBlurObserver = this._engine.onCanvasBlurObservable.add(function () { i._keys = [] }), this._onKeyboardObserver = this._scene.onKeyboardObservable.add(function (e) { var r, n = e.event; e.type === Le.KeyboardEventTypes.KEYDOWN ? -1 === i.keysUp.indexOf(n.keyCode) && -1 === i.keysDown.indexOf(n.keyCode) && -1 === i.keysLeft.indexOf(n.keyCode) && -1 === i.keysRight.indexOf(n.keyCode) || (-1 === (r = i._keys.indexOf(n.keyCode)) && i._keys.push(n.keyCode), t || n.preventDefault()) : -1 === i.keysUp.indexOf(n.keyCode) && -1 === i.keysDown.indexOf(n.keyCode) && -1 === i.keysLeft.indexOf(n.keyCode) && -1 === i.keysRight.indexOf(n.keyCode) || (0 <= (r = i._keys.indexOf(n.keyCode)) && i._keys.splice(r, 1), t || n.preventDefault()) })) }, e.prototype.detachControl = function (e) { this._scene && (this._onKeyboardObserver && this._scene.onKeyboardObservable.remove(this._onKeyboardObserver), this._onCanvasBlurObserver && this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver), this._onKeyboardObserver = null, this._onCanvasBlurObserver = null), this._keys = [] }, e.prototype.checkInputs = function () { if (this._onKeyboardObserver) for (var e = this.camera, t = 0; t < this._keys.length; t++) { var i = this._keys[t], r = e._computeLocalCameraSpeed(); -1 !== this.keysLeft.indexOf(i) ? e._localDirection.copyFromFloats(-r, 0, 0) : -1 !== this.keysUp.indexOf(i) ? e._localDirection.copyFromFloats(0, 0, r) : -1 !== this.keysRight.indexOf(i) ? e._localDirection.copyFromFloats(r, 0, 0) : -1 !== this.keysDown.indexOf(i) && e._localDirection.copyFromFloats(0, 0, -r), e.getScene().useRightHandedSystem && (e._localDirection.z *= -1), e.getViewMatrix().invertToRef(e._cameraTransformMatrix), Le.Vector3.TransformNormalToRef(e._localDirection, e._cameraTransformMatrix, e._transformedDirection), e.cameraDirection.addInPlace(e._transformedDirection) } }, e.prototype.getClassName = function () { return "FreeCameraKeyboardMoveInput" }, e.prototype._onLostFocus = function (e) { this._keys = [] }, e.prototype.getSimpleName = function () { return "keyboard" }, b([Le.serialize()], e.prototype, "keysUp", void 0), b([Le.serialize()], e.prototype, "keysDown", void 0), b([Le.serialize()], e.prototype, "keysLeft", void 0), b([Le.serialize()], e.prototype, "keysRight", void 0), e }(), Le.FreeCameraKeyboardMoveInput = Fe, Le.CameraInputTypes.FreeCameraKeyboardMoveInput = Fe, Ne = function (e) { function t(t) { return e.call(this, t) || this } return T(t, e), t.prototype.addKeyboard = function () { return this.add(new Be.FreeCameraKeyboardMoveInput), this }, t.prototype.addMouse = function (e) { return void 0 === e && (e = !0), this.add(new Be.FreeCameraMouseInput(e)), this }, t.prototype.addDeviceOrientation = function () { return this.add(new Be.FreeCameraDeviceOrientationInput), this }, t.prototype.addTouch = function () { return this.add(new Be.FreeCameraTouchInput), this }, t.prototype.addVirtualJoystick = function () { return this.add(new Be.FreeCameraVirtualJoystickInput), this }, t }((Be = $a || ($a = {})).CameraInputsManager), Be.FreeCameraInputsManager = Ne, function (e) { e.Node.AddNodeConstructor("FreeCamera", function (t, i) { return function () { return new e.UniversalCamera(t, e.Vector3.Zero(), i) } }); var t = function (t) { function i(i, r, n, o) { void 0 === o && (o = !0); var s = t.call(this, i, r, n, o) || this; return s.ellipsoid = new e.Vector3(.5, 1, .5), s.ellipsoidOffset = new e.Vector3(0, 0, 0), s.checkCollisions = !1, s.applyGravity = !1, s._needMoveForGravity = !1, s._oldPosition = e.Vector3.Zero(), s._diffPosition = e.Vector3.Zero(), s._newPosition = e.Vector3.Zero(), s._collisionMask = -1, s._onCollisionPositionChange = function (t, i, r) { var n; void 0 === r && (r = null), s.getScene().workerCollisions && i.multiplyInPlace(s._collider._radius), n = i, s._newPosition.copyFrom(n), s._newPosition.subtractToRef(s._oldPosition, s._diffPosition), s._diffPosition.length() > e.Engine.CollisionsEpsilon && (s.position.addInPlace(s._diffPosition), s.onCollide && r && s.onCollide(r)) }, s.inputs = new e.FreeCameraInputsManager(s), s.inputs.addKeyboard().addMouse(), s } return T(i, t), Object.defineProperty(i.prototype, "angularSensibility", { get: function () { var e = this.inputs.attached.mouse; return e ? e.angularSensibility : 0 }, set: function (e) { var t = this.inputs.attached.mouse; t && (t.angularSensibility = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "keysUp", { get: function () { var e = this.inputs.attached.keyboard; return e ? e.keysUp : [] }, set: function (e) { var t = this.inputs.attached.keyboard; t && (t.keysUp = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "keysDown", { get: function () { var e = this.inputs.attached.keyboard; return e ? e.keysDown : [] }, set: function (e) { var t = this.inputs.attached.keyboard; t && (t.keysDown = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "keysLeft", { get: function () { var e = this.inputs.attached.keyboard; return e ? e.keysLeft : [] }, set: function (e) { var t = this.inputs.attached.keyboard; t && (t.keysLeft = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "keysRight", { get: function () { var e = this.inputs.attached.keyboard; return e ? e.keysRight : [] }, set: function (e) { var t = this.inputs.attached.keyboard; t && (t.keysRight = e) }, enumerable: !0, configurable: !0 }), i.prototype.attachControl = function (e, t) { this.inputs.attachElement(e, t) }, i.prototype.detachControl = function (t) { this.inputs.detachElement(t), this.cameraDirection = new e.Vector3(0, 0, 0), this.cameraRotation = new e.Vector2(0, 0) }, Object.defineProperty(i.prototype, "collisionMask", { get: function () { return this._collisionMask }, set: function (e) { this._collisionMask = isNaN(e) ? -1 : e }, enumerable: !0, configurable: !0 }), i.prototype._collideWithWorld = function (t) { (this.parent ? e.Vector3.TransformCoordinates(this.position, this.parent.getWorldMatrix()) : this.position).subtractFromFloatsToRef(0, this.ellipsoid.y, 0, this._oldPosition), this._oldPosition.addInPlace(this.ellipsoidOffset), this._collider || (this._collider = new e.Collider), this._collider._radius = this.ellipsoid, this._collider.collisionMask = this._collisionMask; var i = t; this.applyGravity && (i = t.add(this.getScene().gravity)), this.getScene().collisionCoordinator.getNewPosition(this._oldPosition, i, this._collider, 3, null, this._onCollisionPositionChange, this.uniqueId) }, i.prototype._checkInputs = function () { this._localDirection || (this._localDirection = e.Vector3.Zero(), this._transformedDirection = e.Vector3.Zero()), this.inputs.checkInputs(), t.prototype._checkInputs.call(this) }, i.prototype._decideIfNeedsToMove = function () { return this._needMoveForGravity || 0 < Math.abs(this.cameraDirection.x) || 0 < Math.abs(this.cameraDirection.y) || 0 < Math.abs(this.cameraDirection.z) }, i.prototype._updatePosition = function () { this.checkCollisions && this.getScene().collisionsEnabled ? this._collideWithWorld(this.cameraDirection) : t.prototype._updatePosition.call(this) }, i.prototype.dispose = function () { this.inputs.clear(), t.prototype.dispose.call(this) }, i.prototype.getClassName = function () { return "FreeCamera" }, b([e.serializeAsVector3()], i.prototype, "ellipsoid", void 0), b([e.serializeAsVector3()], i.prototype, "ellipsoidOffset", void 0), b([e.serialize()], i.prototype, "checkCollisions", void 0), b([e.serialize()], i.prototype, "applyGravity", void 0), i }(e.TargetCamera); e.FreeCamera = t }($a || ($a = {})), Ve = $a || ($a = {}), Ue = function () { function e() { this.keysUp = [38], this.keysDown = [40], this.keysLeft = [37], this.keysRight = [39], this.keysReset = [220], this.panningSensibility = 50, this.zoomingSensibility = 25, this.useAltToZoom = !0, this.angularSpeed = .01, this._keys = new Array } return e.prototype.attachControl = function (e, t) { var i = this; this._onCanvasBlurObserver || (this._scene = this.camera.getScene(), this._engine = this._scene.getEngine(), this._onCanvasBlurObserver = this._engine.onCanvasBlurObservable.add(function () { i._keys = [] }), this._onKeyboardObserver = this._scene.onKeyboardObservable.add(function (e) { var r, n = e.event; e.type === Ve.KeyboardEventTypes.KEYDOWN ? (i._ctrlPressed = n.ctrlKey, i._altPressed = n.altKey, (-1 !== i.keysUp.indexOf(n.keyCode) || -1 !== i.keysDown.indexOf(n.keyCode) || -1 !== i.keysLeft.indexOf(n.keyCode) || -1 !== i.keysRight.indexOf(n.keyCode) || -1 !== i.keysReset.indexOf(n.keyCode)) && (-1 === (r = i._keys.indexOf(n.keyCode)) && i._keys.push(n.keyCode), n.preventDefault && (t || n.preventDefault()))) : -1 === i.keysUp.indexOf(n.keyCode) && -1 === i.keysDown.indexOf(n.keyCode) && -1 === i.keysLeft.indexOf(n.keyCode) && -1 === i.keysRight.indexOf(n.keyCode) && -1 === i.keysReset.indexOf(n.keyCode) || (0 <= (r = i._keys.indexOf(n.keyCode)) && i._keys.splice(r, 1), n.preventDefault && (t || n.preventDefault())) })) }, e.prototype.detachControl = function (e) { this._scene && (this._onKeyboardObserver && this._scene.onKeyboardObservable.remove(this._onKeyboardObserver), this._onCanvasBlurObserver && this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver), this._onKeyboardObserver = null, this._onCanvasBlurObserver = null), this._keys = [] }, e.prototype.checkInputs = function () { if (this._onKeyboardObserver) for (var e = this.camera, t = 0; t < this._keys.length; t++) { var i = this._keys[t]; -1 !== this.keysLeft.indexOf(i) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningX -= 1 / this.panningSensibility : e.inertialAlphaOffset -= this.angularSpeed : -1 !== this.keysUp.indexOf(i) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningY += 1 / this.panningSensibility : this._altPressed && this.useAltToZoom ? e.inertialRadiusOffset += 1 / this.zoomingSensibility : e.inertialBetaOffset -= this.angularSpeed : -1 !== this.keysRight.indexOf(i) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningX += 1 / this.panningSensibility : e.inertialAlphaOffset += this.angularSpeed : -1 !== this.keysDown.indexOf(i) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningY -= 1 / this.panningSensibility : this._altPressed && this.useAltToZoom ? e.inertialRadiusOffset -= 1 / this.zoomingSensibility : e.inertialBetaOffset += this.angularSpeed : -1 !== this.keysReset.indexOf(i) && e.useInputToRestoreState && e.restoreState() } }, e.prototype.getClassName = function () { return "ArcRotateCameraKeyboardMoveInput" }, e.prototype.getSimpleName = function () { return "keyboard" }, b([Ve.serialize()], e.prototype, "keysUp", void 0), b([Ve.serialize()], e.prototype, "keysDown", void 0), b([Ve.serialize()], e.prototype, "keysLeft", void 0), b([Ve.serialize()], e.prototype, "keysRight", void 0), b([Ve.serialize()], e.prototype, "keysReset", void 0), b([Ve.serialize()], e.prototype, "panningSensibility", void 0), b([Ve.serialize()], e.prototype, "zoomingSensibility", void 0), b([Ve.serialize()], e.prototype, "useAltToZoom", void 0), b([Ve.serialize()], e.prototype, "angularSpeed", void 0), e }(), Ve.ArcRotateCameraKeyboardMoveInput = Ue, Ve.CameraInputTypes.ArcRotateCameraKeyboardMoveInput = Ue, ze = $a || ($a = {}), Ge = function () { function e() { this.wheelPrecision = 3, this.wheelDeltaPercentage = 0 } return e.prototype.attachControl = function (e, t) { var i = this; this._wheel = function (e, r) { if (e.type === ze.PointerEventTypes.POINTERWHEEL) { var n = e.event, o = 0; if (n.wheelDelta) if (i.wheelDeltaPercentage) { var s = .01 * n.wheelDelta * i.wheelDeltaPercentage * i.camera.radius; o = 0 < n.wheelDelta ? s / (1 + i.wheelDeltaPercentage) : s * (1 + i.wheelDeltaPercentage) } else o = n.wheelDelta / (40 * i.wheelPrecision); else n.detail && (o = -n.detail / i.wheelPrecision); o && (i.camera.inertialRadiusOffset += o), n.preventDefault && (t || n.preventDefault()) } }, this._observer = this.camera.getScene().onPointerObservable.add(this._wheel, ze.PointerEventTypes.POINTERWHEEL) }, e.prototype.detachControl = function (e) { this._observer && e && (this.camera.getScene().onPointerObservable.remove(this._observer), this._observer = null, this._wheel = null) }, e.prototype.getClassName = function () { return "ArcRotateCameraMouseWheelInput" }, e.prototype.getSimpleName = function () { return "mousewheel" }, b([ze.serialize()], e.prototype, "wheelPrecision", void 0), b([ze.serialize()], e.prototype, "wheelDeltaPercentage", void 0), e }(), ze.ArcRotateCameraMouseWheelInput = Ge, ze.CameraInputTypes.ArcRotateCameraMouseWheelInput = Ge, ke = $a || ($a = {}), We = function () { function e() { this.buttons = [0, 1, 2], this.angularSensibilityX = 1e3, this.angularSensibilityY = 1e3, this.pinchPrecision = 12, this.pinchDeltaPercentage = 0, this.panningSensibility = 1e3, this.multiTouchPanning = !0, this.multiTouchPanAndZoom = !0, this.pinchInwards = !0, this._isPanClick = !1 } return e.prototype.attachControl = function (e, t) { var i, r = this, n = this.camera.getEngine(), o = null, s = null, a = 0, l = 0, c = 0, h = { x: 0, y: 0, isPaning: !1, isPinching: !1 }; this._pointerInput = function (u, d) { var f = u.event, p = "touch" === u.event.pointerType; if (!n.isInVRExclusivePointerMode && (u.type === ke.PointerEventTypes.POINTERMOVE || -1 !== r.buttons.indexOf(f.button))) { var _ = f.srcElement || f.target; if (u.type === ke.PointerEventTypes.POINTERDOWN && _) { try { _.setPointerCapture(f.pointerId) } catch (u) { } r._isPanClick = f.button === r.camera._panningMouseButton, i = { x: f.clientX, y: f.clientY, pointerId: f.pointerId, type: f.pointerType }, null === o ? o = i : null === s && (s = i), t || (f.preventDefault(), e.focus()) } else if (u.type === ke.PointerEventTypes.POINTERDOUBLETAP) r.camera.useInputToRestoreState && r.camera.restoreState(); else if (u.type === ke.PointerEventTypes.POINTERUP && _) { try { _.releasePointerCapture(f.pointerId) } catch (u) { } i = null, a = 0, h.isPaning = !1, h.isPinching = !1, l = c = 0, p || (s = null), n._badOS ? o = s = null : s && o && o.pointerId == f.pointerId ? (o = s, s = null, i = { x: o.x, y: o.y, pointerId: o.pointerId, type: f.pointerType }) : o && s && s.pointerId == f.pointerId ? (s = null, i = { x: o.x, y: o.y, pointerId: o.pointerId, type: f.pointerType }) : o = s = null, t || f.preventDefault() } else if (u.type === ke.PointerEventTypes.POINTERMOVE) if (t || f.preventDefault(), o && null === s && i) { if (0 !== r.panningSensibility && (f.ctrlKey && r.camera._useCtrlForPanning || r._isPanClick)) r.camera.inertialPanningX += -(f.clientX - i.x) / r.panningSensibility, r.camera.inertialPanningY += (f.clientY - i.y) / r.panningSensibility; else { var m = f.clientX - i.x, g = f.clientY - i.y; r.camera.inertialAlphaOffset -= m / r.angularSensibilityX, r.camera.inertialBetaOffset -= g / r.angularSensibilityY } i.x = f.clientX, i.y = f.clientY } else if (o && s) { var v = o.pointerId === f.pointerId ? o : s; v.x = f.clientX, v.y = f.clientY; var y = r.pinchInwards ? 1 : -1, b = o.x - s.x, T = o.y - s.y, E = b * b + T * T, x = Math.sqrt(E); if (0 === a) return l = x, a = E, h.x = (o.x + s.x) / 2, void (h.y = (o.y + s.y) / 2); if (r.multiTouchPanAndZoom) { if (r.pinchDeltaPercentage ? r.camera.inertialRadiusOffset += .001 * (E - a) * r.camera.radius * r.pinchDeltaPercentage : r.camera.inertialRadiusOffset += (E - a) / (r.pinchPrecision * ((r.angularSensibilityX + r.angularSensibilityY) / 2) * y), 0 !== r.panningSensibility) { var P = (o.x + s.x) / 2, A = (o.y + s.y) / 2, S = P - h.x, M = A - h.y; h.x = P, h.y = A, r.camera.inertialPanningX += -S / r.panningSensibility, r.camera.inertialPanningY += M / r.panningSensibility } } else { if (c++ , h.isPinching || c < 20 && Math.abs(x - l) > r.camera.pinchToPanMaxDistance) r.pinchDeltaPercentage ? r.camera.inertialRadiusOffset += .001 * (E - a) * r.camera.radius * r.pinchDeltaPercentage : r.camera.inertialRadiusOffset += (E - a) / (r.pinchPrecision * ((r.angularSensibilityX + r.angularSensibilityY) / 2) * y), h.isPaning = !1, h.isPinching = !0; else if (i && i.pointerId === v.pointerId && 0 !== r.panningSensibility && r.multiTouchPanning) { if (!h.isPaning) return h.isPaning = !0, h.isPinching = !1, h.x = v.x, void (h.y = v.y); r.camera.inertialPanningX += -(v.x - h.x) / r.panningSensibility, r.camera.inertialPanningY += (v.y - h.y) / r.panningSensibility } i && i.pointerId === f.pointerId && (h.x = v.x, h.y = v.y) } a = E } } }, this._observer = this.camera.getScene().onPointerObservable.add(this._pointerInput, ke.PointerEventTypes.POINTERDOWN | ke.PointerEventTypes.POINTERUP | ke.PointerEventTypes.POINTERMOVE | ke.PointerEventTypes.POINTERDOUBLETAP), this._onContextMenu = function (e) { e.preventDefault() }, this.camera._useCtrlForPanning || e.addEventListener("contextmenu", this._onContextMenu, !1), this._onLostFocus = function () { o = s = null, a = 0, h.isPaning = !1, h.isPinching = !1, i = null, l = c = 0 }, this._onMouseMove = function (e) { if (n.isPointerLock) { var i = e.movementX || e.mozMovementX || e.webkitMovementX || e.msMovementX || 0, o = e.movementY || e.mozMovementY || e.webkitMovementY || e.msMovementY || 0; r.camera.inertialAlphaOffset -= i / r.angularSensibilityX, r.camera.inertialBetaOffset -= o / r.angularSensibilityY, t || e.preventDefault() } }, this._onGestureStart = function (t) { void 0 !== window.MSGesture && (r._MSGestureHandler || (r._MSGestureHandler = new MSGesture, r._MSGestureHandler.target = e), r._MSGestureHandler.addPointer(t.pointerId)) }, this._onGesture = function (e) { r.camera.radius *= e.scale, e.preventDefault && (t || (e.stopPropagation(), e.preventDefault())) }, e.addEventListener("mousemove", this._onMouseMove, !1), e.addEventListener("MSPointerDown", this._onGestureStart, !1), e.addEventListener("MSGestureChange", this._onGesture, !1), ke.Tools.RegisterTopRootEvents([{ name: "blur", handler: this._onLostFocus }]) }, e.prototype.detachControl = function (e) { this._onLostFocus && ke.Tools.UnregisterTopRootEvents([{ name: "blur", handler: this._onLostFocus }]), e && this._observer && (this.camera.getScene().onPointerObservable.remove(this._observer), this._observer = null, this._onContextMenu && e.removeEventListener("contextmenu", this._onContextMenu), this._onMouseMove && e.removeEventListener("mousemove", this._onMouseMove), this._onGestureStart && e.removeEventListener("MSPointerDown", this._onGestureStart), this._onGesture && e.removeEventListener("MSGestureChange", this._onGesture), this._isPanClick = !1, this.pinchInwards = !0, this._onMouseMove = null, this._onGestureStart = null, this._onGesture = null, this._MSGestureHandler = null, this._onLostFocus = null, this._onContextMenu = null) }, e.prototype.getClassName = function () { return "ArcRotateCameraPointersInput" }, e.prototype.getSimpleName = function () { return "pointers" }, b([ke.serialize()], e.prototype, "buttons", void 0), b([ke.serialize()], e.prototype, "angularSensibilityX", void 0), b([ke.serialize()], e.prototype, "angularSensibilityY", void 0), b([ke.serialize()], e.prototype, "pinchPrecision", void 0), b([ke.serialize()], e.prototype, "pinchDeltaPercentage", void 0), b([ke.serialize()], e.prototype, "panningSensibility", void 0), b([ke.serialize()], e.prototype, "multiTouchPanning", void 0), b([ke.serialize()], e.prototype, "multiTouchPanAndZoom", void 0), e }(), ke.ArcRotateCameraPointersInput = We, ke.CameraInputTypes.ArcRotateCameraPointersInput = We, Xe = function (e) { function t(t) { return e.call(this, t) || this } return T(t, e), t.prototype.addMouseWheel = function () { return this.add(new He.ArcRotateCameraMouseWheelInput), this }, t.prototype.addPointers = function () { return this.add(new He.ArcRotateCameraPointersInput), this }, t.prototype.addKeyboard = function () { return this.add(new He.ArcRotateCameraKeyboardMoveInput), this }, t.prototype.addVRDeviceOrientation = function () { return this.add(new He.ArcRotateCameraVRDeviceOrientationInput), this }, t }((He = $a || ($a = {})).CameraInputsManager), He.ArcRotateCameraInputsManager = Xe, function (e) { e.Node.AddNodeConstructor("ArcRotateCamera", function (i, r) { return function () { return new t(i, 0, 0, 1, e.Vector3.Zero(), r) } }); var t = function (t) { function i(i, r, n, o, s, a, l) { void 0 === l && (l = !0); var c = t.call(this, i, e.Vector3.Zero(), a, l) || this; return c.inertialAlphaOffset = 0, c.inertialBetaOffset = 0, c.inertialRadiusOffset = 0, c.lowerAlphaLimit = null, c.upperAlphaLimit = null, c.lowerBetaLimit = .01, c.upperBetaLimit = Math.PI, c.lowerRadiusLimit = null, c.upperRadiusLimit = null, c.inertialPanningX = 0, c.inertialPanningY = 0, c.pinchToPanMaxDistance = 20, c.panningDistanceLimit = null, c.panningOriginTarget = e.Vector3.Zero(), c.panningInertia = .9, c.zoomOnFactor = 1, c.targetScreenOffset = e.Vector2.Zero(), c.allowUpsideDown = !0, c.useInputToRestoreState = !0, c._viewMatrix = new e.Matrix, c.panningAxis = new e.Vector3(1, 1, 0), c.onMeshTargetChangedObservable = new e.Observable, c.checkCollisions = !1, c.collisionRadius = new e.Vector3(.5, .5, .5), c._previousPosition = e.Vector3.Zero(), c._collisionVelocity = e.Vector3.Zero(), c._newPosition = e.Vector3.Zero(), c._computationVector = e.Vector3.Zero(), c._onCollisionPositionChange = function (e, t, i) { void 0 === i && (i = null), c.getScene().workerCollisions && c.checkCollisions && t.multiplyInPlace(c._collider._radius), i ? (c.setPosition(t), c.onCollide && c.onCollide(i)) : c._previousPosition.copyFrom(c.position); var r = Math.cos(c.alpha), n = Math.sin(c.alpha), o = Math.cos(c.beta), s = Math.sin(c.beta); 0 === s && (s = 1e-4); var a = c._getTargetPosition(); c._computationVector.copyFromFloats(c.radius * r * s, c.radius * o, c.radius * n * s), a.addToRef(c._computationVector, c._newPosition), c.position.copyFrom(c._newPosition); var l = c.upVector; c.allowUpsideDown && c.beta < 0 && (l = (l = l.clone()).negate()), c._computeViewMatrix(c.position, a, l), c._viewMatrix.m[12] += c.targetScreenOffset.x, c._viewMatrix.m[13] += c.targetScreenOffset.y, c._collisionTriggered = !1 }, c._target = e.Vector3.Zero(), s && c.setTarget(s), c.alpha = r, c.beta = n, c.radius = o, c.getViewMatrix(), c.inputs = new e.ArcRotateCameraInputsManager(c), c.inputs.addKeyboard().addMouseWheel().addPointers(), c } return T(i, t), Object.defineProperty(i.prototype, "target", { get: function () { return this._target }, set: function (e) { this.setTarget(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "angularSensibilityX", { get: function () { var e = this.inputs.attached.pointers; return e ? e.angularSensibilityX : 0 }, set: function (e) { var t = this.inputs.attached.pointers; t && (t.angularSensibilityX = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "angularSensibilityY", { get: function () { var e = this.inputs.attached.pointers; return e ? e.angularSensibilityY : 0 }, set: function (e) { var t = this.inputs.attached.pointers; t && (t.angularSensibilityY = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "pinchPrecision", { get: function () { var e = this.inputs.attached.pointers; return e ? e.pinchPrecision : 0 }, set: function (e) { var t = this.inputs.attached.pointers; t && (t.pinchPrecision = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "pinchDeltaPercentage", { get: function () { var e = this.inputs.attached.pointers; return e ? e.pinchDeltaPercentage : 0 }, set: function (e) { var t = this.inputs.attached.pointers; t && (t.pinchDeltaPercentage = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "panningSensibility", { get: function () { var e = this.inputs.attached.pointers; return e ? e.panningSensibility : 0 }, set: function (e) { var t = this.inputs.attached.pointers; t && (t.panningSensibility = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "keysUp", { get: function () { var e = this.inputs.attached.keyboard; return e ? e.keysUp : [] }, set: function (e) { var t = this.inputs.attached.keyboard; t && (t.keysUp = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "keysDown", { get: function () { var e = this.inputs.attached.keyboard; return e ? e.keysDown : [] }, set: function (e) { var t = this.inputs.attached.keyboard; t && (t.keysDown = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "keysLeft", { get: function () { var e = this.inputs.attached.keyboard; return e ? e.keysLeft : [] }, set: function (e) { var t = this.inputs.attached.keyboard; t && (t.keysLeft = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "keysRight", { get: function () { var e = this.inputs.attached.keyboard; return e ? e.keysRight : [] }, set: function (e) { var t = this.inputs.attached.keyboard; t && (t.keysRight = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "wheelPrecision", { get: function () { var e = this.inputs.attached.mousewheel; return e ? e.wheelPrecision : 0 }, set: function (e) { var t = this.inputs.attached.mousewheel; t && (t.wheelPrecision = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "wheelDeltaPercentage", { get: function () { var e = this.inputs.attached.mousewheel; return e ? e.wheelDeltaPercentage : 0 }, set: function (e) { var t = this.inputs.attached.mousewheel; t && (t.wheelDeltaPercentage = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "bouncingBehavior", { get: function () { return this._bouncingBehavior }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "useBouncingBehavior", { get: function () { return null != this._bouncingBehavior }, set: function (t) { t !== this.useBouncingBehavior && (t ? (this._bouncingBehavior = new e.BouncingBehavior, this.addBehavior(this._bouncingBehavior)) : this._bouncingBehavior && (this.removeBehavior(this._bouncingBehavior), this._bouncingBehavior = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "framingBehavior", { get: function () { return this._framingBehavior }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "useFramingBehavior", { get: function () { return null != this._framingBehavior }, set: function (t) { t !== this.useFramingBehavior && (t ? (this._framingBehavior = new e.FramingBehavior, this.addBehavior(this._framingBehavior)) : this._framingBehavior && (this.removeBehavior(this._framingBehavior), this._framingBehavior = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "autoRotationBehavior", { get: function () { return this._autoRotationBehavior }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "useAutoRotationBehavior", { get: function () { return null != this._autoRotationBehavior }, set: function (t) { t !== this.useAutoRotationBehavior && (t ? (this._autoRotationBehavior = new e.AutoRotationBehavior, this.addBehavior(this._autoRotationBehavior)) : this._autoRotationBehavior && (this.removeBehavior(this._autoRotationBehavior), this._autoRotationBehavior = null)) }, enumerable: !0, configurable: !0 }), i.prototype._initCache = function () { t.prototype._initCache.call(this), this._cache._target = new e.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.alpha = void 0, this._cache.beta = void 0, this._cache.radius = void 0, this._cache.targetScreenOffset = e.Vector2.Zero() }, i.prototype._updateCache = function (e) { e || t.prototype._updateCache.call(this), this._cache._target.copyFrom(this._getTargetPosition()), this._cache.alpha = this.alpha, this._cache.beta = this.beta, this._cache.radius = this.radius, this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset) }, i.prototype._getTargetPosition = function () { if (this._targetHost && this._targetHost.getAbsolutePosition) { var e = this._targetHost.getAbsolutePosition(); this._targetBoundingCenter ? e.addToRef(this._targetBoundingCenter, this._target) : this._target.copyFrom(e) } return this._getLockedTargetPosition() || this._target }, i.prototype.storeState = function () { return this._storedAlpha = this.alpha, this._storedBeta = this.beta, this._storedRadius = this.radius, this._storedTarget = this._getTargetPosition().clone(), t.prototype.storeState.call(this) }, i.prototype._restoreStateValues = function () { return !(!t.prototype._restoreStateValues.call(this) || (this.alpha = this._storedAlpha, this.beta = this._storedBeta, this.radius = this._storedRadius, this.setTarget(this._storedTarget.clone()), this.inertialAlphaOffset = 0, this.inertialBetaOffset = 0, this.inertialRadiusOffset = 0, this.inertialPanningX = 0, this.inertialPanningY = 0)) }, i.prototype._isSynchronizedViewMatrix = function () { return !!t.prototype._isSynchronizedViewMatrix.call(this) && this._cache._target.equals(this._getTargetPosition()) && this._cache.alpha === this.alpha && this._cache.beta === this.beta && this._cache.radius === this.radius && this._cache.targetScreenOffset.equals(this.targetScreenOffset) }, i.prototype.attachControl = function (e, t, i, r) { var n = this; void 0 === i && (i = !0), void 0 === r && (r = 2), this._useCtrlForPanning = i, this._panningMouseButton = r, this.inputs.attachElement(e, t), this._reset = function () { n.inertialAlphaOffset = 0, n.inertialBetaOffset = 0, n.inertialRadiusOffset = 0, n.inertialPanningX = 0, n.inertialPanningY = 0 } }, i.prototype.detachControl = function (e) { this.inputs.detachElement(e), this._reset && this._reset() }, i.prototype._checkInputs = function () { if (!this._collisionTriggered) { if (this.inputs.checkInputs(), 0 !== this.inertialAlphaOffset || 0 !== this.inertialBetaOffset || 0 !== this.inertialRadiusOffset) { var i = this.inertialAlphaOffset; this.beta <= 0 && (i *= -1), this.getScene().useRightHandedSystem && (i *= -1), this.parent && this.parent._getWorldMatrixDeterminant() < 0 && (i *= -1), this.alpha += i, this.beta += this.inertialBetaOffset, this.radius -= this.inertialRadiusOffset, this.inertialAlphaOffset *= this.inertia, this.inertialBetaOffset *= this.inertia, this.inertialRadiusOffset *= this.inertia, Math.abs(this.inertialAlphaOffset) < e.Epsilon && (this.inertialAlphaOffset = 0), Math.abs(this.inertialBetaOffset) < e.Epsilon && (this.inertialBetaOffset = 0), Math.abs(this.inertialRadiusOffset) < this.speed * e.Epsilon && (this.inertialRadiusOffset = 0) } 0 === this.inertialPanningX && 0 === this.inertialPanningY || (this._localDirection || (this._localDirection = e.Vector3.Zero(), this._transformedDirection = e.Vector3.Zero()), this._localDirection.copyFromFloats(this.inertialPanningX, this.inertialPanningY, this.inertialPanningY), this._localDirection.multiplyInPlace(this.panningAxis), this._viewMatrix.invertToRef(this._cameraTransformMatrix), e.Vector3.TransformNormalToRef(this._localDirection, this._cameraTransformMatrix, this._transformedDirection), this.panningAxis.y || (this._transformedDirection.y = 0), this._targetHost || (this.panningDistanceLimit ? (this._transformedDirection.addInPlace(this._target), e.Vector3.DistanceSquared(this._transformedDirection, this.panningOriginTarget) <= this.panningDistanceLimit * this.panningDistanceLimit && this._target.copyFrom(this._transformedDirection)) : this._target.addInPlace(this._transformedDirection)), this.inertialPanningX *= this.panningInertia, this.inertialPanningY *= this.panningInertia, Math.abs(this.inertialPanningX) < this.speed * e.Epsilon && (this.inertialPanningX = 0), Math.abs(this.inertialPanningY) < this.speed * e.Epsilon && (this.inertialPanningY = 0)), this._checkLimits(), t.prototype._checkInputs.call(this) } }, i.prototype._checkLimits = function () { null === this.lowerBetaLimit || void 0 === this.lowerBetaLimit ? this.allowUpsideDown && this.beta > Math.PI && (this.beta = this.beta - 2 * Math.PI) : this.beta < this.lowerBetaLimit && (this.beta = this.lowerBetaLimit), null === this.upperBetaLimit || void 0 === this.upperBetaLimit ? this.allowUpsideDown && this.beta < -Math.PI && (this.beta = this.beta + 2 * Math.PI) : this.beta > this.upperBetaLimit && (this.beta = this.upperBetaLimit), null !== this.lowerAlphaLimit && this.alpha < this.lowerAlphaLimit && (this.alpha = this.lowerAlphaLimit), null !== this.upperAlphaLimit && this.alpha > this.upperAlphaLimit && (this.alpha = this.upperAlphaLimit), null !== this.lowerRadiusLimit && this.radius < this.lowerRadiusLimit && (this.radius = this.lowerRadiusLimit), null !== this.upperRadiusLimit && this.radius > this.upperRadiusLimit && (this.radius = this.upperRadiusLimit) }, i.prototype.rebuildAnglesAndRadius = function () { this.position.subtractToRef(this._getTargetPosition(), this._computationVector), this.radius = this._computationVector.length(), 0 === this.radius && (this.radius = 1e-4), this.alpha = Math.acos(this._computationVector.x / Math.sqrt(Math.pow(this._computationVector.x, 2) + Math.pow(this._computationVector.z, 2))), this._computationVector.z < 0 && (this.alpha = 2 * Math.PI - this.alpha), this.beta = Math.acos(this._computationVector.y / this.radius), this._checkLimits() }, i.prototype.setPosition = function (e) { this.position.equals(e) || (this.position.copyFrom(e), this.rebuildAnglesAndRadius()) }, i.prototype.setTarget = function (e, t, i) { if (void 0 === t && (t = !1), void 0 === i && (i = !1), e.getBoundingInfo) this._targetBoundingCenter = t ? e.getBoundingInfo().boundingBox.centerWorld.clone() : null, this._targetHost = e, this._target = this._getTargetPosition(), this.onMeshTargetChangedObservable.notifyObservers(this._targetHost); else { var r = e, n = this._getTargetPosition(); if (n && !i && n.equals(r)) return; this._targetHost = null, this._target = r, this._targetBoundingCenter = null, this.onMeshTargetChangedObservable.notifyObservers(null) } this.rebuildAnglesAndRadius() }, i.prototype._getViewMatrix = function () { var t = Math.cos(this.alpha), i = Math.sin(this.alpha), r = Math.cos(this.beta), n = Math.sin(this.beta); 0 === n && (n = 1e-4); var o = this._getTargetPosition(); if (this._computationVector.copyFromFloats(this.radius * t * n, this.radius * r, this.radius * i * n), o.addToRef(this._computationVector, this._newPosition), this.getScene().collisionsEnabled && this.checkCollisions) this._collider || (this._collider = new e.Collider), this._collider._radius = this.collisionRadius, this._newPosition.subtractToRef(this.position, this._collisionVelocity), this._collisionTriggered = !0, this.getScene().collisionCoordinator.getNewPosition(this.position, this._collisionVelocity, this._collider, 3, null, this._onCollisionPositionChange, this.uniqueId); else { this.position.copyFrom(this._newPosition); var s = this.upVector; this.allowUpsideDown && n < 0 && (s = (s = s.clone()).negate()), this._computeViewMatrix(this.position, o, s), this._viewMatrix.m[12] += this.targetScreenOffset.x, this._viewMatrix.m[13] += this.targetScreenOffset.y } return this._currentTarget = o, this._viewMatrix }, i.prototype.zoomOn = function (t, i) { void 0 === i && (i = !1), t = t || this.getScene().meshes; var r = e.Mesh.MinMax(t), n = e.Vector3.Distance(r.min, r.max); this.radius = n * this.zoomOnFactor, this.focusOn({ min: r.min, max: r.max, distance: n }, i) }, i.prototype.focusOn = function (t, i) { var r, n; if (void 0 === i && (i = !1), void 0 === t.min) { var o = t || this.getScene().meshes; r = e.Mesh.MinMax(o), n = e.Vector3.Distance(r.min, r.max) } else { n = (r = t).distance } this._target = e.Mesh.Center(r), i || (this.maxZ = 2 * n) }, i.prototype.createRigCamera = function (t, r) { var n = 0; switch (this.cameraRigMode) { case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH: case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL: case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER: case e.Camera.RIG_MODE_VR: n = this._cameraRigParams.stereoHalfAngle * (0 === r ? 1 : -1); break; case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED: n = this._cameraRigParams.stereoHalfAngle * (0 === r ? -1 : 1) }var o = new i(t, this.alpha + n, this.beta, this.radius, this._target, this.getScene()); return o._cameraRigParams = {}, o }, i.prototype._updateRigCameras = function () { var i = this._rigCameras[0], r = this._rigCameras[1]; switch (i.beta = r.beta = this.beta, i.radius = r.radius = this.radius, this.cameraRigMode) { case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH: case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL: case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER: case e.Camera.RIG_MODE_VR: i.alpha = this.alpha - this._cameraRigParams.stereoHalfAngle, r.alpha = this.alpha + this._cameraRigParams.stereoHalfAngle; break; case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED: i.alpha = this.alpha + this._cameraRigParams.stereoHalfAngle, r.alpha = this.alpha - this._cameraRigParams.stereoHalfAngle }t.prototype._updateRigCameras.call(this) }, i.prototype.dispose = function () { this.inputs.clear(), t.prototype.dispose.call(this) }, i.prototype.getClassName = function () { return "ArcRotateCamera" }, b([e.serialize()], i.prototype, "alpha", void 0), b([e.serialize()], i.prototype, "beta", void 0), b([e.serialize()], i.prototype, "radius", void 0), b([e.serializeAsVector3("target")], i.prototype, "_target", void 0), b([e.serialize()], i.prototype, "inertialAlphaOffset", void 0), b([e.serialize()], i.prototype, "inertialBetaOffset", void 0), b([e.serialize()], i.prototype, "inertialRadiusOffset", void 0), b([e.serialize()], i.prototype, "lowerAlphaLimit", void 0), b([e.serialize()], i.prototype, "upperAlphaLimit", void 0), b([e.serialize()], i.prototype, "lowerBetaLimit", void 0), b([e.serialize()], i.prototype, "upperBetaLimit", void 0), b([e.serialize()], i.prototype, "lowerRadiusLimit", void 0), b([e.serialize()], i.prototype, "upperRadiusLimit", void 0), b([e.serialize()], i.prototype, "inertialPanningX", void 0), b([e.serialize()], i.prototype, "inertialPanningY", void 0), b([e.serialize()], i.prototype, "pinchToPanMaxDistance", void 0), b([e.serialize()], i.prototype, "panningDistanceLimit", void 0), b([e.serializeAsVector3()], i.prototype, "panningOriginTarget", void 0), b([e.serialize()], i.prototype, "panningInertia", void 0), b([e.serialize()], i.prototype, "zoomOnFactor", void 0), b([e.serialize()], i.prototype, "targetScreenOffset", void 0), b([e.serialize()], i.prototype, "allowUpsideDown", void 0), b([e.serialize()], i.prototype, "useInputToRestoreState", void 0), i }(e.TargetCamera); e.ArcRotateCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("Light_Type_3", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (t) { function i(i, r, n) { var o = t.call(this, i, n) || this; return o.groundColor = new e.Color3(0, 0, 0), o.direction = r || e.Vector3.Up(), o } return T(i, t), i.prototype._buildUniformLayout = function () { this._uniformBuffer.addUniform("vLightData", 4), this._uniformBuffer.addUniform("vLightDiffuse", 4), this._uniformBuffer.addUniform("vLightSpecular", 3), this._uniformBuffer.addUniform("vLightGround", 3), this._uniformBuffer.addUniform("shadowsInfo", 3), this._uniformBuffer.addUniform("depthValues", 2), this._uniformBuffer.create() }, i.prototype.getClassName = function () { return "HemisphericLight" }, i.prototype.setDirectionToTarget = function (t) { return this.direction = e.Vector3.Normalize(t.subtract(e.Vector3.Zero())), this.direction }, i.prototype.getShadowGenerator = function () { return null }, i.prototype.transferToEffect = function (t, i) { var r = e.Vector3.Normalize(this.direction); return this._uniformBuffer.updateFloat4("vLightData", r.x, r.y, r.z, 0, i), this._uniformBuffer.updateColor3("vLightGround", this.groundColor.scale(this.intensity), i), this }, i.prototype.computeWorldMatrix = function (t, i) { return this._worldMatrix || (this._worldMatrix = e.Matrix.Identity()), this._worldMatrix }, i.prototype.getTypeID = function () { return e.Light.LIGHTTYPEID_HEMISPHERICLIGHT }, i.prototype.prepareLightSpecificDefines = function (e, t) { e["HEMILIGHT" + t] = !0 }, b([e.serializeAsColor3()], i.prototype, "groundColor", void 0), b([e.serializeAsVector3()], i.prototype, "direction", void 0), i }(e.Light); e.HemisphericLight = t }($a || ($a = {})), Ye = function (e) { function t() { var t = null !== e && e.apply(this, arguments) || this; return t._needProjectionMatrixCompute = !0, t } return T(t, e), t.prototype._setPosition = function (e) { this._position = e }, Object.defineProperty(t.prototype, "position", { get: function () { return this._position }, set: function (e) { this._setPosition(e) }, enumerable: !0, configurable: !0 }), t.prototype._setDirection = function (e) { this._direction = e }, Object.defineProperty(t.prototype, "direction", { get: function () { return this._direction }, set: function (e) { this._setDirection(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "shadowMinZ", { get: function () { return this._shadowMinZ }, set: function (e) { this._shadowMinZ = e, this.forceProjectionMatrixCompute() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "shadowMaxZ", { get: function () { return this._shadowMaxZ }, set: function (e) { this._shadowMaxZ = e, this.forceProjectionMatrixCompute() }, enumerable: !0, configurable: !0 }), t.prototype.computeTransformedInformation = function () { return !(!this.parent || !this.parent.getWorldMatrix || (this.transformedPosition || (this.transformedPosition = je.Vector3.Zero()), je.Vector3.TransformCoordinatesToRef(this.position, this.parent.getWorldMatrix(), this.transformedPosition), this.direction && (this.transformedDirection || (this.transformedDirection = je.Vector3.Zero()), je.Vector3.TransformNormalToRef(this.direction, this.parent.getWorldMatrix(), this.transformedDirection)), 0)) }, t.prototype.getDepthScale = function () { return 50 }, t.prototype.getShadowDirection = function (e) { return this.transformedDirection ? this.transformedDirection : this.direction }, t.prototype.getAbsolutePosition = function () { return this.transformedPosition ? this.transformedPosition : this.position }, t.prototype.setDirectionToTarget = function (e) { return this.direction = je.Vector3.Normalize(e.subtract(this.position)), this.direction }, t.prototype.getRotation = function () { this.direction.normalize(); var e = je.Vector3.Cross(this.direction, je.Axis.Y), t = je.Vector3.Cross(e, this.direction); return je.Vector3.RotationFromAxis(e, t, this.direction) }, t.prototype.needCube = function () { return !1 }, t.prototype.needProjectionMatrixCompute = function () { return this._needProjectionMatrixCompute }, t.prototype.forceProjectionMatrixCompute = function () { this._needProjectionMatrixCompute = !0 }, t.prototype._initCache = function () { e.prototype._initCache.call(this), this._cache.position = je.Vector3.Zero() }, t.prototype._isSynchronized = function () { return !!this._cache.position.equals(this.position) }, t.prototype.computeWorldMatrix = function (e) { return !e && this.isSynchronized() ? this._currentRenderId = this.getScene().getRenderId() : (this._updateCache(), this._cache.position.copyFrom(this.position), this._worldMatrix || (this._worldMatrix = je.Matrix.Identity()), je.Matrix.TranslationToRef(this.position.x, this.position.y, this.position.z, this._worldMatrix), this.parent && this.parent.getWorldMatrix && (this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(), this._worldMatrix), this._markSyncedWithParent()), this._worldMatrixDeterminant = this._worldMatrix.determinant()), this._worldMatrix }, t.prototype.getDepthMinZ = function (e) { return void 0 !== this.shadowMinZ ? this.shadowMinZ : e.minZ }, t.prototype.getDepthMaxZ = function (e) { return void 0 !== this.shadowMaxZ ? this.shadowMaxZ : e.maxZ }, t.prototype.setShadowProjectionMatrix = function (e, t, i) { return this.customProjectionMatrixBuilder ? this.customProjectionMatrixBuilder(t, i, e) : this._setDefaultShadowProjectionMatrix(e, t, i), this }, b([je.serializeAsVector3()], t.prototype, "position", null), b([je.serializeAsVector3()], t.prototype, "direction", null), b([je.serialize()], t.prototype, "shadowMinZ", null), b([je.serialize()], t.prototype, "shadowMaxZ", null), t }((je = $a || ($a = {})).Light), je.ShadowLight = Ye, function (e) { e.Node.AddNodeConstructor("Light_Type_0", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (t) { function i(e, i, r) { var n = t.call(this, e, r) || this; return n._shadowAngle = Math.PI / 2, n.position = i, n } return T(i, t), Object.defineProperty(i.prototype, "shadowAngle", { get: function () { return this._shadowAngle }, set: function (e) { this._shadowAngle = e, this.forceProjectionMatrixCompute() }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "direction", { get: function () { return this._direction }, set: function (e) { var t = this.needCube(); this._direction = e, this.needCube() !== t && this._shadowGenerator && this._shadowGenerator.recreateShadowMap() }, enumerable: !0, configurable: !0 }), i.prototype.getClassName = function () { return "PointLight" }, i.prototype.getTypeID = function () { return e.Light.LIGHTTYPEID_POINTLIGHT }, i.prototype.needCube = function () { return !this.direction }, i.prototype.getShadowDirection = function (i) { if (this.direction) return t.prototype.getShadowDirection.call(this, i); switch (i) { case 0: return new e.Vector3(1, 0, 0); case 1: return new e.Vector3(-1, 0, 0); case 2: return new e.Vector3(0, -1, 0); case 3: return new e.Vector3(0, 1, 0); case 4: return new e.Vector3(0, 0, 1); case 5: return new e.Vector3(0, 0, -1) }return e.Vector3.Zero() }, i.prototype._setDefaultShadowProjectionMatrix = function (t, i, r) { var n = this.getScene().activeCamera; n && e.Matrix.PerspectiveFovLHToRef(this.shadowAngle, 1, this.getDepthMinZ(n), this.getDepthMaxZ(n), t) }, i.prototype._buildUniformLayout = function () { this._uniformBuffer.addUniform("vLightData", 4), this._uniformBuffer.addUniform("vLightDiffuse", 4), this._uniformBuffer.addUniform("vLightSpecular", 3), this._uniformBuffer.addUniform("vLightFalloff", 4), this._uniformBuffer.addUniform("shadowsInfo", 3), this._uniformBuffer.addUniform("depthValues", 2), this._uniformBuffer.create() }, i.prototype.transferToEffect = function (e, t) { return this.computeTransformedInformation() ? this._uniformBuffer.updateFloat4("vLightData", this.transformedPosition.x, this.transformedPosition.y, this.transformedPosition.z, 0, t) : this._uniformBuffer.updateFloat4("vLightData", this.position.x, this.position.y, this.position.z, 0, t), this._uniformBuffer.updateFloat4("vLightFalloff", this.range, this._inverseSquaredRange, 0, 0, t), this }, i.prototype.prepareLightSpecificDefines = function (e, t) { e["POINTLIGHT" + t] = !0 }, b([e.serialize()], i.prototype, "shadowAngle", null), i }(e.ShadowLight); e.PointLight = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("Light_Type_1", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (t) { function i(e, i, r) { var n = t.call(this, e, r) || this; return n._shadowFrustumSize = 0, n._shadowOrthoScale = .1, n.autoUpdateExtends = !0, n._orthoLeft = Number.MAX_VALUE, n._orthoRight = Number.MIN_VALUE, n._orthoTop = Number.MIN_VALUE, n._orthoBottom = Number.MAX_VALUE, n.position = i.scale(-1), n.direction = i, n } return T(i, t), Object.defineProperty(i.prototype, "shadowFrustumSize", { get: function () { return this._shadowFrustumSize }, set: function (e) { this._shadowFrustumSize = e, this.forceProjectionMatrixCompute() }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "shadowOrthoScale", { get: function () { return this._shadowOrthoScale }, set: function (e) { this._shadowOrthoScale = e, this.forceProjectionMatrixCompute() }, enumerable: !0, configurable: !0 }), i.prototype.getClassName = function () { return "DirectionalLight" }, i.prototype.getTypeID = function () { return e.Light.LIGHTTYPEID_DIRECTIONALLIGHT }, i.prototype._setDefaultShadowProjectionMatrix = function (e, t, i) { 0 < this.shadowFrustumSize ? this._setDefaultFixedFrustumShadowProjectionMatrix(e, t) : this._setDefaultAutoExtendShadowProjectionMatrix(e, t, i) }, i.prototype._setDefaultFixedFrustumShadowProjectionMatrix = function (t, i) { var r = this.getScene().activeCamera; r && e.Matrix.OrthoLHToRef(this.shadowFrustumSize, this.shadowFrustumSize, void 0 !== this.shadowMinZ ? this.shadowMinZ : r.minZ, void 0 !== this.shadowMaxZ ? this.shadowMaxZ : r.maxZ, t) }, i.prototype._setDefaultAutoExtendShadowProjectionMatrix = function (t, i, r) { var n = this.getScene().activeCamera; if (n) { if (this.autoUpdateExtends || this._orthoLeft === Number.MAX_VALUE) { var o = e.Vector3.Zero(); this._orthoLeft = Number.MAX_VALUE, this._orthoRight = Number.MIN_VALUE, this._orthoTop = Number.MIN_VALUE, this._orthoBottom = Number.MAX_VALUE; for (var s = 0; s < r.length; s++) { var a = r[s]; if (a) for (var l = a.getBoundingInfo().boundingBox, c = 0; c < l.vectorsWorld.length; c++)e.Vector3.TransformCoordinatesToRef(l.vectorsWorld[c], i, o), o.x < this._orthoLeft && (this._orthoLeft = o.x), o.y < this._orthoBottom && (this._orthoBottom = o.y), o.x > this._orthoRight && (this._orthoRight = o.x), o.y > this._orthoTop && (this._orthoTop = o.y) } } var h = this._orthoRight - this._orthoLeft, u = this._orthoTop - this._orthoBottom; e.Matrix.OrthoOffCenterLHToRef(this._orthoLeft - h * this.shadowOrthoScale, this._orthoRight + h * this.shadowOrthoScale, this._orthoBottom - u * this.shadowOrthoScale, this._orthoTop + u * this.shadowOrthoScale, void 0 !== this.shadowMinZ ? this.shadowMinZ : n.minZ, void 0 !== this.shadowMaxZ ? this.shadowMaxZ : n.maxZ, t) } }, i.prototype._buildUniformLayout = function () { this._uniformBuffer.addUniform("vLightData", 4), this._uniformBuffer.addUniform("vLightDiffuse", 4), this._uniformBuffer.addUniform("vLightSpecular", 3), this._uniformBuffer.addUniform("shadowsInfo", 3), this._uniformBuffer.addUniform("depthValues", 2), this._uniformBuffer.create() }, i.prototype.transferToEffect = function (e, t) { return this.computeTransformedInformation() ? this._uniformBuffer.updateFloat4("vLightData", this.transformedDirection.x, this.transformedDirection.y, this.transformedDirection.z, 1, t) : this._uniformBuffer.updateFloat4("vLightData", this.direction.x, this.direction.y, this.direction.z, 1, t), this }, i.prototype.getDepthMinZ = function (e) { return 1 }, i.prototype.getDepthMaxZ = function (e) { return 1 }, i.prototype.prepareLightSpecificDefines = function (e, t) { e["DIRLIGHT" + t] = !0 }, b([e.serialize()], i.prototype, "shadowFrustumSize", null), b([e.serialize()], i.prototype, "shadowOrthoScale", null), b([e.serialize()], i.prototype, "autoUpdateExtends", void 0), i }(e.ShadowLight); e.DirectionalLight = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("Light_Type_2", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), e.Vector3.Zero(), 0, 0, r) } }); var t = function (t) { function i(i, r, n, o, s, a) { var l = t.call(this, i, a) || this; return l._innerAngle = 0, l._projectionTextureMatrix = e.Matrix.Zero(), l._projectionTextureLightNear = 1e-6, l._projectionTextureLightFar = 1e3, l._projectionTextureUpDirection = e.Vector3.Up(), l._projectionTextureViewLightDirty = !0, l._projectionTextureProjectionLightDirty = !0, l._projectionTextureDirty = !0, l._projectionTextureViewTargetVector = e.Vector3.Zero(), l._projectionTextureViewLightMatrix = e.Matrix.Zero(), l._projectionTextureProjectionLightMatrix = e.Matrix.Zero(), l._projectionTextureScalingMatrix = e.Matrix.FromValues(.5, 0, 0, 0, 0, .5, 0, 0, 0, 0, .5, 0, .5, .5, .5, 1), l.position = r, l.direction = n, l.angle = o, l.exponent = s, l } return T(i, t), Object.defineProperty(i.prototype, "angle", { get: function () { return this._angle }, set: function (e) { this._angle = e, this._cosHalfAngle = Math.cos(.5 * e), this._projectionTextureProjectionLightDirty = !0, this.forceProjectionMatrixCompute(), this._computeAngleValues() }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "innerAngle", { get: function () { return this._innerAngle }, set: function (e) { this._innerAngle = e, this._computeAngleValues() }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "shadowAngleScale", { get: function () { return this._shadowAngleScale }, set: function (e) { this._shadowAngleScale = e, this.forceProjectionMatrixCompute() }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "projectionTextureMatrix", { get: function () { return this._projectionTextureMatrix }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "projectionTextureLightNear", { get: function () { return this._projectionTextureLightNear }, set: function (e) { this._projectionTextureLightNear = e, this._projectionTextureProjectionLightDirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "projectionTextureLightFar", { get: function () { return this._projectionTextureLightFar }, set: function (e) { this._projectionTextureLightFar = e, this._projectionTextureProjectionLightDirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "projectionTextureUpDirection", { get: function () { return this._projectionTextureUpDirection }, set: function (e) { this._projectionTextureUpDirection = e, this._projectionTextureProjectionLightDirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "projectionTexture", { get: function () { return this._projectionTexture }, set: function (e) { this._projectionTexture = e, this._projectionTextureDirty = !0 }, enumerable: !0, configurable: !0 }), i.prototype.getClassName = function () { return "SpotLight" }, i.prototype.getTypeID = function () { return e.Light.LIGHTTYPEID_SPOTLIGHT }, i.prototype._setDirection = function (e) { t.prototype._setDirection.call(this, e), this._projectionTextureViewLightDirty = !0 }, i.prototype._setPosition = function (e) { t.prototype._setPosition.call(this, e), this._projectionTextureViewLightDirty = !0 }, i.prototype._setDefaultShadowProjectionMatrix = function (t, i, r) { var n = this.getScene().activeCamera; if (n) { this._shadowAngleScale = this._shadowAngleScale || 1; var o = this._shadowAngleScale * this._angle; e.Matrix.PerspectiveFovLHToRef(o, 1, this.getDepthMinZ(n), this.getDepthMaxZ(n), t) } }, i.prototype._computeProjectionTextureViewLightMatrix = function () { this._projectionTextureViewLightDirty = !1, this._projectionTextureDirty = !0, this.position.addToRef(this.direction, this._projectionTextureViewTargetVector), e.Matrix.LookAtLHToRef(this.position, this._projectionTextureViewTargetVector, this._projectionTextureUpDirection, this._projectionTextureViewLightMatrix) }, i.prototype._computeProjectionTextureProjectionLightMatrix = function () { this._projectionTextureProjectionLightDirty = !1, this._projectionTextureDirty = !0; var t = this.projectionTextureLightFar, i = this.projectionTextureLightNear, r = t / (t - i), n = -r * i, o = 1 / Math.tan(this._angle / 2); e.Matrix.FromValuesToRef(o / 1, 0, 0, 0, 0, o, 0, 0, 0, 0, r, 1, 0, 0, n, 0, this._projectionTextureProjectionLightMatrix) }, i.prototype._computeProjectionTextureMatrix = function () { this._projectionTextureDirty = !1, this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix, this._projectionTextureMatrix), this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix, this._projectionTextureMatrix) }, i.prototype._buildUniformLayout = function () { this._uniformBuffer.addUniform("vLightData", 4), this._uniformBuffer.addUniform("vLightDiffuse", 4), this._uniformBuffer.addUniform("vLightSpecular", 3), this._uniformBuffer.addUniform("vLightDirection", 3), this._uniformBuffer.addUniform("vLightFalloff", 4), this._uniformBuffer.addUniform("shadowsInfo", 3), this._uniformBuffer.addUniform("depthValues", 2), this._uniformBuffer.create() }, i.prototype._computeAngleValues = function () { this._lightAngleScale = 1 / Math.max(.001, Math.cos(.5 * this._innerAngle) - this._cosHalfAngle), this._lightAngleOffset = -this._cosHalfAngle * this._lightAngleScale }, i.prototype.transferToEffect = function (t, i) { var r; return this.computeTransformedInformation() ? (this._uniformBuffer.updateFloat4("vLightData", this.transformedPosition.x, this.transformedPosition.y, this.transformedPosition.z, this.exponent, i), r = e.Vector3.Normalize(this.transformedDirection)) : (this._uniformBuffer.updateFloat4("vLightData", this.position.x, this.position.y, this.position.z, this.exponent, i), r = e.Vector3.Normalize(this.direction)), this._uniformBuffer.updateFloat4("vLightDirection", r.x, r.y, r.z, this._cosHalfAngle, i), this._uniformBuffer.updateFloat4("vLightFalloff", this.range, this._inverseSquaredRange, this._lightAngleScale, this._lightAngleOffset, i), this.projectionTexture && this.projectionTexture.isReady() && (this._projectionTextureViewLightDirty && this._computeProjectionTextureViewLightMatrix(), this._projectionTextureProjectionLightDirty && this._computeProjectionTextureProjectionLightMatrix(), this._projectionTextureDirty && this._computeProjectionTextureMatrix(), t.setMatrix("textureProjectionMatrix" + i, this._projectionTextureMatrix), t.setTexture("projectionLightSampler" + i, this.projectionTexture)), this }, i.prototype.dispose = function () { t.prototype.dispose.call(this), this._projectionTexture && this._projectionTexture.dispose() }, i.prototype.prepareLightSpecificDefines = function (e, t) { e["SPOTLIGHT" + t] = !0, e["PROJECTEDLIGHTTEXTURE" + t] = !!this.projectionTexture }, b([e.serialize()], i.prototype, "angle", null), b([e.serialize()], i.prototype, "innerAngle", null), b([e.serialize()], i.prototype, "shadowAngleScale", null), b([e.serialize()], i.prototype, "exponent", void 0), b([e.serialize()], i.prototype, "projectionTextureLightNear", null), b([e.serialize()], i.prototype, "projectionTextureLightFar", null), b([e.serialize()], i.prototype, "projectionTextureUpDirection", null), b([e.serializeAsTexture("projectedLightTexture")], i.prototype, "_projectionTexture", void 0), i }(e.ShadowLight); e.SpotLight = t }($a || ($a = {})), Qe = function () { this.enableBlending = !1, this.blendingSpeed = .01, this.loopMode = Ke.Animation.ANIMATIONLOOPMODE_CYCLE }, (Ke = $a || ($a = {})).AnimationPropertiesOverride = Qe, function (e) { var t = function () { function e(e, t, i) { this.name = e, this.from = t, this.to = i } return e.prototype.clone = function () { return new e(this.name, this.from, this.to) }, e }(); e.AnimationRange = t; var i = function () { function e(e, t, i) { this.frame = e, this.action = t, this.onlyOnce = i, this.isDone = !1 } return e.prototype._clone = function () { return new e(this.frame, this.action, this.onlyOnce) }, e }(); e.AnimationEvent = i; var r, n, o = function () { function t(e) { this.path = e, this._onchange = new Array, this.value = 0, this.animations = new Array } return t.prototype.getPoint = function () { var t = this.path.getPointAtLengthPosition(this.value); return new e.Vector3(t.x, 0, t.y) }, t.prototype.moveAhead = function (e) { return void 0 === e && (e = .002), this.move(e), this }, t.prototype.moveBack = function (e) { return void 0 === e && (e = .002), this.move(-e), this }, t.prototype.move = function (e) { if (1 < Math.abs(e)) throw "step size should be less than 1."; return this.value += e, this.ensureLimits(), this.raiseOnChange(), this }, t.prototype.ensureLimits = function () { for (; 1 < this.value;)this.value -= 1; for (; this.value < 0;)this.value += 1; return this }, t.prototype.raiseOnChange = function () { var e = this; return this._onchange.forEach(function (t) { return t(e) }), this }, t.prototype.onchange = function (e) { return this._onchange.push(e), this }, t }(); e.PathCursor = o, (n = r = e.AnimationKeyInterpolation || (e.AnimationKeyInterpolation = {}))[n.STEP = 1] = "STEP"; var s = function () { function i(e, t, r, n, o, s) { this.name = e, this.targetProperty = t, this.framePerSecond = r, this.dataType = n, this.loopMode = o, this.enableBlending = s, this._runtimeAnimations = new Array, this._events = new Array, this.blendingSpeed = .01, this._ranges = {}, this.targetPropertyPath = t.split("."), this.dataType = n, this.loopMode = void 0 === o ? i.ANIMATIONLOOPMODE_CYCLE : o } return i._PrepareAnimation = function (t, r, n, o, s, a, l, c) { var h = void 0; if (!isNaN(parseFloat(s)) && isFinite(s) ? h = i.ANIMATIONTYPE_FLOAT : s instanceof e.Quaternion ? h = i.ANIMATIONTYPE_QUATERNION : s instanceof e.Vector3 ? h = i.ANIMATIONTYPE_VECTOR3 : s instanceof e.Vector2 ? h = i.ANIMATIONTYPE_VECTOR2 : s instanceof e.Color3 ? h = i.ANIMATIONTYPE_COLOR3 : s instanceof e.Size && (h = i.ANIMATIONTYPE_SIZE), null == h) return null; var u = new i(t, r, n, h, l), d = [{ frame: 0, value: s }, { frame: o, value: a }]; return u.setKeys(d), void 0 !== c && u.setEasingFunction(c), u }, i.CreateAnimation = function (e, t, r, n) { var o = new i(e + "Animation", e, r, t, i.ANIMATIONLOOPMODE_CONSTANT); return o.setEasingFunction(n), o }, i.CreateAndStartAnimation = function (e, t, r, n, o, s, a, l, c, h) { var u = i._PrepareAnimation(e, r, n, o, s, a, l, c); return u ? t.getScene().beginDirectAnimation(t, [u], 0, o, 1 === u.loopMode, 1, h) : null }, i.CreateAndStartHierarchyAnimation = function (e, t, r, n, o, s, a, l, c, h, u) { var d = i._PrepareAnimation(e, n, o, s, a, l, c, h); return d ? t.getScene().beginDirectHierarchyAnimation(t, r, [d], 0, s, 1 === d.loopMode, 1, u) : null }, i.CreateMergeAndStartAnimation = function (e, t, r, n, o, s, a, l, c, h) { var u = i._PrepareAnimation(e, r, n, o, s, a, l, c); return u ? (t.animations.push(u), t.getScene().beginAnimation(t, 0, o, 1 === u.loopMode, 1, h)) : null }, i.TransitionTo = function (e, t, i, r, n, o, s, a) { if (void 0 === a && (a = null), s <= 0) return i[e] = t, a && a(), null; var l = n * (s / 1e3); o.setKeys([{ frame: 0, value: i[e].clone ? i[e].clone() : i[e] }, { frame: l, value: t }]), i.animations || (i.animations = []), i.animations.push(o); var c = r.beginAnimation(i, 0, l, !1); return c.onAnimationEnd = a, c }, Object.defineProperty(i.prototype, "runtimeAnimations", { get: function () { return this._runtimeAnimations }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "hasRunningRuntimeAnimations", { get: function () { for (var e = 0, t = this._runtimeAnimations; e < t.length; e++)if (!t[e].isStopped) return !0; return !1 }, enumerable: !0, configurable: !0 }), i.prototype.toString = function (e) { var t = "Name: " + this.name + ", property: " + this.targetProperty; if (t += ", datatype: " + ["Float", "Vector3", "Quaternion", "Matrix", "Color3", "Vector2"][this.dataType], t += ", nKeys: " + (this._keys ? this._keys.length : "none"), t += ", nRanges: " + (this._ranges ? Object.keys(this._ranges).length : "none"), e) { t += ", Ranges: {"; var i = !0; for (var r in this._ranges) i && (t += ", ", i = !1), t += r; t += "}" } return t }, i.prototype.addEvent = function (e) { this._events.push(e) }, i.prototype.removeEvents = function (e) { for (var t = 0; t < this._events.length; t++)this._events[t].frame === e && (this._events.splice(t, 1), t--) }, i.prototype.getEvents = function () { return this._events }, i.prototype.createRange = function (e, i, r) { this._ranges[e] || (this._ranges[e] = new t(e, i, r)) }, i.prototype.deleteRange = function (e, t) { void 0 === t && (t = !0); var i = this._ranges[e]; if (i) { if (t) for (var r = i.from, n = i.to, o = this._keys.length - 1; 0 <= o; o--)this._keys[o].frame >= r && this._keys[o].frame <= n && this._keys.splice(o, 1); this._ranges[e] = null } }, i.prototype.getRange = function (e) { return this._ranges[e] }, i.prototype.getKeys = function () { return this._keys }, i.prototype.getHighestFrame = function () { for (var e = 0, t = 0, i = this._keys.length; t < i; t++)e < this._keys[t].frame && (e = this._keys[t].frame); return e }, i.prototype.getEasingFunction = function () { return this._easingFunction }, i.prototype.setEasingFunction = function (e) { this._easingFunction = e }, i.prototype.floatInterpolateFunction = function (t, i, r) { return e.Scalar.Lerp(t, i, r) }, i.prototype.floatInterpolateFunctionWithTangents = function (t, i, r, n, o) { return e.Scalar.Hermite(t, i, r, n, o) }, i.prototype.quaternionInterpolateFunction = function (t, i, r) { return e.Quaternion.Slerp(t, i, r) }, i.prototype.quaternionInterpolateFunctionWithTangents = function (t, i, r, n, o) { return e.Quaternion.Hermite(t, i, r, n, o).normalize() }, i.prototype.vector3InterpolateFunction = function (t, i, r) { return e.Vector3.Lerp(t, i, r) }, i.prototype.vector3InterpolateFunctionWithTangents = function (t, i, r, n, o) { return e.Vector3.Hermite(t, i, r, n, o) }, i.prototype.vector2InterpolateFunction = function (t, i, r) { return e.Vector2.Lerp(t, i, r) }, i.prototype.vector2InterpolateFunctionWithTangents = function (t, i, r, n, o) { return e.Vector2.Hermite(t, i, r, n, o) }, i.prototype.sizeInterpolateFunction = function (t, i, r) { return e.Size.Lerp(t, i, r) }, i.prototype.color3InterpolateFunction = function (t, i, r) { return e.Color3.Lerp(t, i, r) }, i.prototype._getKeyValue = function (e) { return "function" == typeof e ? e() : e }, i.prototype._interpolate = function (e, t, n, o, s, a) { if (o === i.ANIMATIONLOOPMODE_CONSTANT && 0 < t) return a.clone ? a.clone() : a; var l = this.getKeys(), c = Math.max(0, Math.min(l.length - 1, Math.floor(l.length * (e - l[0].frame) / (l[l.length - 1].frame - l[0].frame)) - 1)); if (l[c].frame >= e) for (; 0 <= c - 1 && l[c].frame >= e;)c--; for (var h = c; h < l.length; h++) { var u = l[h + 1]; if (u.frame >= e) { var d = l[h], f = this._getKeyValue(d.value); if (d.interpolation === r.STEP) return f; var p = this._getKeyValue(u.value), _ = void 0 !== d.outTangent && void 0 !== u.inTangent, m = u.frame - d.frame, g = (e - d.frame) / m, v = this.getEasingFunction(); switch (null != v && (g = v.ease(g)), this.dataType) { case i.ANIMATIONTYPE_FLOAT: var y = _ ? this.floatInterpolateFunctionWithTangents(f, d.outTangent * m, p, u.inTangent * m, g) : this.floatInterpolateFunction(f, p, g); switch (o) { case i.ANIMATIONLOOPMODE_CYCLE: case i.ANIMATIONLOOPMODE_CONSTANT: return y; case i.ANIMATIONLOOPMODE_RELATIVE: return s * t + y }break; case i.ANIMATIONTYPE_QUATERNION: var b = _ ? this.quaternionInterpolateFunctionWithTangents(f, d.outTangent.scale(m), p, u.inTangent.scale(m), g) : this.quaternionInterpolateFunction(f, p, g); switch (o) { case i.ANIMATIONLOOPMODE_CYCLE: case i.ANIMATIONLOOPMODE_CONSTANT: return b; case i.ANIMATIONLOOPMODE_RELATIVE: return b.addInPlace(s.scale(t)) }return b; case i.ANIMATIONTYPE_VECTOR3: var T = _ ? this.vector3InterpolateFunctionWithTangents(f, d.outTangent.scale(m), p, u.inTangent.scale(m), g) : this.vector3InterpolateFunction(f, p, g); switch (o) { case i.ANIMATIONLOOPMODE_CYCLE: case i.ANIMATIONLOOPMODE_CONSTANT: return T; case i.ANIMATIONLOOPMODE_RELATIVE: return T.add(s.scale(t)) }case i.ANIMATIONTYPE_VECTOR2: var E = _ ? this.vector2InterpolateFunctionWithTangents(f, d.outTangent.scale(m), p, u.inTangent.scale(m), g) : this.vector2InterpolateFunction(f, p, g); switch (o) { case i.ANIMATIONLOOPMODE_CYCLE: case i.ANIMATIONLOOPMODE_CONSTANT: return E; case i.ANIMATIONLOOPMODE_RELATIVE: return E.add(s.scale(t)) }case i.ANIMATIONTYPE_SIZE: switch (o) { case i.ANIMATIONLOOPMODE_CYCLE: case i.ANIMATIONLOOPMODE_CONSTANT: return this.sizeInterpolateFunction(f, p, g); case i.ANIMATIONLOOPMODE_RELATIVE: return this.sizeInterpolateFunction(f, p, g).add(s.scale(t)) }case i.ANIMATIONTYPE_COLOR3: switch (o) { case i.ANIMATIONLOOPMODE_CYCLE: case i.ANIMATIONLOOPMODE_CONSTANT: return this.color3InterpolateFunction(f, p, g); case i.ANIMATIONLOOPMODE_RELATIVE: return this.color3InterpolateFunction(f, p, g).add(s.scale(t)) }case i.ANIMATIONTYPE_MATRIX: switch (o) { case i.ANIMATIONLOOPMODE_CYCLE: case i.ANIMATIONLOOPMODE_CONSTANT: if (i.AllowMatricesInterpolation) return this.matrixInterpolateFunction(f, p, g, n); case i.ANIMATIONLOOPMODE_RELATIVE: return f } }break } } return this._getKeyValue(l[l.length - 1].value) }, i.prototype.matrixInterpolateFunction = function (t, r, n, o) { return i.AllowMatrixDecomposeForInterpolation ? o ? (e.Matrix.DecomposeLerpToRef(t, r, n, o), o) : e.Matrix.DecomposeLerp(t, r, n) : o ? (e.Matrix.LerpToRef(t, r, n, o), o) : e.Matrix.Lerp(t, r, n) }, i.prototype.clone = function () { var e = new i(this.name, this.targetPropertyPath.join("."), this.framePerSecond, this.dataType, this.loopMode); if (e.enableBlending = this.enableBlending, e.blendingSpeed = this.blendingSpeed, this._keys && e.setKeys(this._keys), this._ranges) for (var t in e._ranges = {}, this._ranges) { var r = this._ranges[t]; r && (e._ranges[t] = r.clone()) } return e }, i.prototype.setKeys = function (e) { this._keys = e.slice(0) }, i.prototype.serialize = function () { var e = {}; e.name = this.name, e.property = this.targetProperty, e.framePerSecond = this.framePerSecond, e.dataType = this.dataType, e.loopBehavior = this.loopMode, e.enableBlending = this.enableBlending, e.blendingSpeed = this.blendingSpeed; var t = this.dataType; e.keys = []; for (var r = this.getKeys(), n = 0; n < r.length; n++) { var o = r[n], s = {}; switch (s.frame = o.frame, t) { case i.ANIMATIONTYPE_FLOAT: s.values = [o.value]; break; case i.ANIMATIONTYPE_QUATERNION: case i.ANIMATIONTYPE_MATRIX: case i.ANIMATIONTYPE_VECTOR3: case i.ANIMATIONTYPE_COLOR3: s.values = o.value.asArray() }e.keys.push(s) } for (var a in e.ranges = [], this._ranges) { var l = this._ranges[a]; if (l) { var c = {}; c.name = a, c.from = l.from, c.to = l.to, e.ranges.push(c) } } return e }, Object.defineProperty(i, "ANIMATIONTYPE_FLOAT", { get: function () { return i._ANIMATIONTYPE_FLOAT }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ANIMATIONTYPE_VECTOR3", { get: function () { return i._ANIMATIONTYPE_VECTOR3 }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ANIMATIONTYPE_VECTOR2", { get: function () { return i._ANIMATIONTYPE_VECTOR2 }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ANIMATIONTYPE_SIZE", { get: function () { return i._ANIMATIONTYPE_SIZE }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ANIMATIONTYPE_QUATERNION", { get: function () { return i._ANIMATIONTYPE_QUATERNION }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ANIMATIONTYPE_MATRIX", { get: function () { return i._ANIMATIONTYPE_MATRIX }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ANIMATIONTYPE_COLOR3", { get: function () { return i._ANIMATIONTYPE_COLOR3 }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ANIMATIONLOOPMODE_RELATIVE", { get: function () { return i._ANIMATIONLOOPMODE_RELATIVE }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ANIMATIONLOOPMODE_CYCLE", { get: function () { return i._ANIMATIONLOOPMODE_CYCLE }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ANIMATIONLOOPMODE_CONSTANT", { get: function () { return i._ANIMATIONLOOPMODE_CONSTANT }, enumerable: !0, configurable: !0 }), i._UniversalLerp = function (e, t, i) { var r = e.constructor; return r.Lerp ? r.Lerp(e, t, i) : r.Slerp ? r.Slerp(e, t, i) : e.toFixed ? e * (1 - i) + i * t : t }, i.Parse = function (t) { var r, n, o = new i(t.name, t.property, t.framePerSecond, t.dataType, t.loopBehavior), s = t.dataType, a = []; for (t.enableBlending && (o.enableBlending = t.enableBlending), t.blendingSpeed && (o.blendingSpeed = t.blendingSpeed), n = 0; n < t.keys.length; n++) { var l, c, h = t.keys[n]; switch (s) { case i.ANIMATIONTYPE_FLOAT: r = h.values[0], 1 <= h.values.length && (l = h.values[1]), 2 <= h.values.length && (c = h.values[2]); break; case i.ANIMATIONTYPE_QUATERNION: if (r = e.Quaternion.FromArray(h.values), 8 <= h.values.length) { var u = e.Quaternion.FromArray(h.values.slice(4, 8)); u.equals(e.Quaternion.Zero()) || (l = u) } if (12 <= h.values.length) { var d = e.Quaternion.FromArray(h.values.slice(8, 12)); d.equals(e.Quaternion.Zero()) || (c = d) } break; case i.ANIMATIONTYPE_MATRIX: r = e.Matrix.FromArray(h.values); break; case i.ANIMATIONTYPE_COLOR3: r = e.Color3.FromArray(h.values); break; case i.ANIMATIONTYPE_VECTOR3: default: r = e.Vector3.FromArray(h.values) }var f = {}; f.frame = h.frame, f.value = r, null != l && (f.inTangent = l), null != c && (f.outTangent = c), a.push(f) } if (o.setKeys(a), t.ranges) for (n = 0; n < t.ranges.length; n++)r = t.ranges[n], o.createRange(r.name, r.from, r.to); return o }, i.AppendSerializedAnimations = function (e, t) { if (e.animations) { t.animations = []; for (var i = 0; i < e.animations.length; i++) { var r = e.animations[i]; t.animations.push(r.serialize()) } } }, i.AllowMatricesInterpolation = !1, i.AllowMatrixDecomposeForInterpolation = !0, i._ANIMATIONTYPE_FLOAT = 0, i._ANIMATIONTYPE_VECTOR3 = 1, i._ANIMATIONTYPE_QUATERNION = 2, i._ANIMATIONTYPE_MATRIX = 3, i._ANIMATIONTYPE_COLOR3 = 4, i._ANIMATIONTYPE_VECTOR2 = 5, i._ANIMATIONTYPE_SIZE = 6, i._ANIMATIONLOOPMODE_RELATIVE = 0, i._ANIMATIONLOOPMODE_CYCLE = 1, i._ANIMATIONLOOPMODE_CONSTANT = 2, i }(); e.Animation = s }($a || ($a = {})), function (e) { e.TargetedAnimation = function () { }; var t = function () { function t(t, i) { void 0 === i && (i = null), this.name = t, this._targetedAnimations = new Array, this._animatables = new Array, this._from = Number.MAX_VALUE, this._to = -Number.MAX_VALUE, this._speedRatio = 1, this.onAnimationEndObservable = new e.Observable, this.onAnimationGroupEndObservable = new e.Observable, this.onAnimationGroupPauseObservable = new e.Observable, this._scene = i || e.Engine.LastCreatedScene, this._scene.animationGroups.push(this) } return Object.defineProperty(t.prototype, "from", { get: function () { return this._from }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "to", { get: function () { return this._to }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "isStarted", { get: function () { return this._isStarted }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "speedRatio", { get: function () { return this._speedRatio }, set: function (e) { if (this._speedRatio !== e) { this._speedRatio = e; for (var t = 0; t < this._animatables.length; t++)this._animatables[t].speedRatio = this._speedRatio } }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "targetedAnimations", { get: function () { return this._targetedAnimations }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "animatables", { get: function () { return this._animatables }, enumerable: !0, configurable: !0 }), t.prototype.addTargetedAnimation = function (e, t) { var i = { animation: e, target: t }, r = e.getKeys(); return this._from > r[0].frame && (this._from = r[0].frame), this._to < r[r.length - 1].frame && (this._to = r[r.length - 1].frame), this._targetedAnimations.push(i), i }, t.prototype.normalize = function (e, t) { void 0 === e && (e = null), void 0 === t && (t = null), null == e && (e = this._from), null == t && (t = this._to); for (var i = 0; i < this._targetedAnimations.length; i++) { var r = this._targetedAnimations[i].animation.getKeys(), n = r[0], o = r[r.length - 1]; if (n.frame > e) { var s = { frame: e, value: n.value, inTangent: n.inTangent, outTangent: n.outTangent, interpolation: n.interpolation }; r.splice(0, 0, s) } o.frame < t && (s = { frame: t, value: o.value, inTangent: o.outTangent, outTangent: o.outTangent, interpolation: o.interpolation }, r.push(s)) } return this._from = e, this._to = t, this }, t.prototype.start = function (e, t, i, r) { var n = this; if (void 0 === e && (e = !1), void 0 === t && (t = 1), this._isStarted || 0 === this._targetedAnimations.length) return this; for (var o = function (o) { var a = s._scene.beginDirectAnimation(o.target, [o.animation], void 0 !== i ? i : s._from, void 0 !== r ? r : s._to, e, t); a.onAnimationEnd = function () { n.onAnimationEndObservable.notifyObservers(o), n._checkAnimationGroupEnded(a) }, s._animatables.push(a) }, s = this, a = 0, l = this._targetedAnimations; a < l.length; a++)o(l[a]); return this._speedRatio = t, this._isStarted = !0, this }, t.prototype.pause = function () { if (!this._isStarted) return this; for (var e = 0; e < this._animatables.length; e++)this._animatables[e].pause(); return this.onAnimationGroupPauseObservable.notifyObservers(this), this }, t.prototype.play = function (e) { if (this.isStarted && this._animatables.length === this._targetedAnimations.length) { if (void 0 !== e) for (var t = 0; t < this._animatables.length; t++)this._animatables[t].loopAnimation = e; this.restart() } else this.stop(), this.start(e, this._speedRatio); return this }, t.prototype.reset = function () { if (!this._isStarted) return this; for (var e = 0; e < this._animatables.length; e++)this._animatables[e].reset(); return this }, t.prototype.restart = function () { if (!this._isStarted) return this; for (var e = 0; e < this._animatables.length; e++)this._animatables[e].restart(); return this }, t.prototype.stop = function () { if (!this._isStarted) return this; for (var e = this._animatables.slice(), t = 0; t < e.length; t++)e[t].stop(); return this._isStarted = !1, this }, t.prototype.setWeightForAllAnimatables = function (e) { for (var t = 0; t < this._animatables.length; t++)this._animatables[t].weight = e; return this }, t.prototype.syncAllAnimationsWith = function (e) { for (var t = 0; t < this._animatables.length; t++)this._animatables[t].syncWith(e); return this }, t.prototype.goToFrame = function (e) { if (!this._isStarted) return this; for (var t = 0; t < this._animatables.length; t++)this._animatables[t].goToFrame(e); return this }, t.prototype.dispose = function () { this._targetedAnimations = [], this._animatables = []; var e = this._scene.animationGroups.indexOf(this); -1 < e && this._scene.animationGroups.splice(e, 1) }, t.prototype._checkAnimationGroupEnded = function (e) { var t = this._animatables.indexOf(e); -1 < t && this._animatables.splice(t, 1), 0 === this._animatables.length && (this._isStarted = !1, this.onAnimationGroupEndObservable.notifyObservers(this)) }, t.Parse = function (t, i) { for (var r = new e.AnimationGroup(t.name, i), n = 0; n < t.targetedAnimations.length; n++) { var o = t.targetedAnimations[n], s = e.Animation.Parse(o.animation), a = o.targetId, l = i.getNodeByID(a); null != l && r.addTargetedAnimation(s, l) } return null !== t.from && null !== t.from && r.normalize(t.from, t.to), r }, t.prototype.getClassName = function () { return "AnimationGroup" }, t.prototype.toString = function (e) { var t = "Name: " + this.name; return t += ", type: " + this.getClassName(), e && (t += ", from: " + this._from, t += ", to: " + this._to, t += ", isStarted: " + this._isStarted, t += ", speedRatio: " + this._speedRatio, t += ", targetedAnimations length: " + this._targetedAnimations.length, t += ", animatables length: " + this._animatables), t }, t }(); e.AnimationGroup = t }($a || ($a = {})), Ze = $a || ($a = {}), qe = Object.freeze(new Ze.Quaternion(0, 0, 0, 0)), Je = Object.freeze(Ze.Vector3.Zero()), $e = Object.freeze(Ze.Vector2.Zero()), et = Object.freeze(Ze.Size.Zero()), tt = Object.freeze(Ze.Color3.Black()), it = function () { function e(e, t, i, r) { var n = this; this._events = new Array, this._currentFrame = 0, this._originalValue = new Array, this._offsetsCache = {}, this._highLimitsCache = {}, this._stopped = !1, this._blendingFactor = 0, this._targetPath = "", this._weight = 1, this._ratioOffset = 0, this._previousDelay = 0, this._previousRatio = 0, this._animation = t, this._target = e, this._scene = i, this._host = r, t._runtimeAnimations.push(this); var o = t.getEvents(); o && 0 < o.length && o.forEach(function (e) { n._events.push(e._clone()) }) } return Object.defineProperty(e.prototype, "currentFrame", { get: function () { return this._currentFrame }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "weight", { get: function () { return this._weight }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "currentValue", { get: function () { return this._currentValue }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "targetPath", { get: function () { return this._targetPath }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "target", { get: function () { return this._activeTarget }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "animation", { get: function () { return this._animation }, enumerable: !0, configurable: !0 }), e.prototype.reset = function (e) { if (void 0 === e && (e = !1), e) if (this._target instanceof Array) for (var t = 0, i = 0, r = this._target; i < r.length; i++) { var n = r[i]; void 0 !== this._originalValue[t] && this._setValue(n, this._originalValue[t], -1), t++ } else void 0 !== this._originalValue[0] && this._setValue(this._target, this._originalValue[0], -1); for (this._offsetsCache = {}, this._highLimitsCache = {}, this._currentFrame = 0, this._blendingFactor = 0, this._originalValue = new Array, t = 0; t < this._events.length; t++)this._events[t].isDone = !1 }, e.prototype.isStopped = function () { return this._stopped }, e.prototype.dispose = function () { var e = this._animation.runtimeAnimations.indexOf(this); -1 < e && this._animation.runtimeAnimations.splice(e, 1) }, e.prototype._interpolate = function (e, t, i, r, n) { return this._currentFrame = e, this._animation.dataType !== Ze.Animation.ANIMATIONTYPE_MATRIX || this._workValue || (this._workValue = Ze.Matrix.Zero()), this._animation._interpolate(e, t, this._workValue, i, r, n) }, e.prototype.setValue = function (e, t) { if (void 0 === t && (t = 1), this._target instanceof Array) for (var i = 0, r = 0, n = this._target; r < n.length; r++) { var o = n[r]; this._setValue(o, e, t, i), i++ } else this._setValue(this._target, e, t) }, e.prototype._setValue = function (e, t, i, r) { var n, o; void 0 === r && (r = 0); var s = this._animation.targetPropertyPath; if (1 < s.length) { for (var a = e[s[0]], l = 1; l < s.length - 1; l++)a = a[s[l]]; n = s[s.length - 1], o = a } else n = s[0], o = e; if (this._targetPath = n, this._activeTarget = o, this._weight = i, void 0 === this._originalValue[r]) { var c = void 0; (c = o.getRestPose && "_matrix" === n ? o.getRestPose() : o[n]) && c.clone ? this._originalValue[r] = c.clone() : this._originalValue[r] = c } if ((e && e.animationPropertiesOverride ? e.animationPropertiesOverride.enableBlending : this._animation.enableBlending) && this._blendingFactor <= 1) { this._originalBlendValue || ((c = o[n]).clone ? this._originalBlendValue = c.clone() : this._originalBlendValue = c), this._originalBlendValue.m ? Ze.Animation.AllowMatrixDecomposeForInterpolation ? this._currentValue ? Ze.Matrix.DecomposeLerpToRef(this._originalBlendValue, t, this._blendingFactor, this._currentValue) : this._currentValue = Ze.Matrix.DecomposeLerp(this._originalBlendValue, t, this._blendingFactor) : this._currentValue ? Ze.Matrix.LerpToRef(this._originalBlendValue, t, this._blendingFactor, this._currentValue) : this._currentValue = Ze.Matrix.Lerp(this._originalBlendValue, t, this._blendingFactor) : this._currentValue = Ze.Animation._UniversalLerp(this._originalBlendValue, t, this._blendingFactor); var h = e && e.animationPropertiesOverride ? e.animationPropertiesOverride.blendingSpeed : this._animation.blendingSpeed; this._blendingFactor += h } else this._currentValue = t; -1 !== i ? this._scene._registerTargetForLateAnimationBinding(this, this._originalValue[r]) : o[n] = this._currentValue, e.markAsDirty && e.markAsDirty(this._animation.targetProperty) }, e.prototype._getCorrectLoopMode = function () { return this._target && this._target.animationPropertiesOverride ? this._target.animationPropertiesOverride.loopMode : this._animation.loopMode }, e.prototype.goToFrame = function (e) { var t = this._animation.getKeys(); e < t[0].frame ? e = t[0].frame : e > t[t.length - 1].frame && (e = t[t.length - 1].frame); var i = this._interpolate(e, 0, this._getCorrectLoopMode()); this.setValue(i, -1) }, e.prototype._prepareForSpeedRatioChange = function (e) { var t = this._previousDelay * (this._animation.framePerSecond * e) / 1e3; this._ratioOffset = this._previousRatio - t }, e.prototype.animate = function (e, t, i, r, n, o) { void 0 === o && (o = -1); var s = this._animation.targetPropertyPath; if (!s || s.length < 1) return !(this._stopped = !0); var a = !0, l = this._animation.getKeys(); if (0 !== l[0].frame) { var c = { frame: 0, value: l[0].value }; l.splice(0, 0, c) } else 1 === l.length && (c = { frame: .001, value: l[0].value }, l.push(c)); (t < l[0].frame || t > l[l.length - 1].frame) && (t = l[0].frame), (i < l[0].frame || i > l[l.length - 1].frame) && (i = l[l.length - 1].frame), t === i && (t > l[0].frame ? t-- : i < l[l.length - 1].frame && i++); var h, u = i - t, d = e * (this._animation.framePerSecond * n) / 1e3 + this._ratioOffset, f = 0; if (this._previousDelay = e, this._previousRatio = d, (t < i && u <= d || i < t && d <= u) && !r) a = !1, f = this._animation._getKeyValue(l[l.length - 1].value); else if (this._getCorrectLoopMode() !== Ze.Animation.ANIMATIONLOOPMODE_CYCLE) { var p = i.toString() + t.toString(); if (!this._offsetsCache[p]) { var _ = this._interpolate(t, 0, Ze.Animation.ANIMATIONLOOPMODE_CYCLE), m = this._interpolate(i, 0, Ze.Animation.ANIMATIONLOOPMODE_CYCLE); switch (this._animation.dataType) { case Ze.Animation.ANIMATIONTYPE_FLOAT: this._offsetsCache[p] = m - _; break; case Ze.Animation.ANIMATIONTYPE_QUATERNION: this._offsetsCache[p] = m.subtract(_); break; case Ze.Animation.ANIMATIONTYPE_VECTOR3: this._offsetsCache[p] = m.subtract(_); case Ze.Animation.ANIMATIONTYPE_VECTOR2: this._offsetsCache[p] = m.subtract(_); case Ze.Animation.ANIMATIONTYPE_SIZE: this._offsetsCache[p] = m.subtract(_); case Ze.Animation.ANIMATIONTYPE_COLOR3: this._offsetsCache[p] = m.subtract(_) }this._highLimitsCache[p] = m } f = this._highLimitsCache[p], h = this._offsetsCache[p] } if (void 0 === h) switch (this._animation.dataType) { case Ze.Animation.ANIMATIONTYPE_FLOAT: h = 0; break; case Ze.Animation.ANIMATIONTYPE_QUATERNION: h = qe; break; case Ze.Animation.ANIMATIONTYPE_VECTOR3: h = Je; break; case Ze.Animation.ANIMATIONTYPE_VECTOR2: h = $e; break; case Ze.Animation.ANIMATIONTYPE_SIZE: h = et; break; case Ze.Animation.ANIMATIONTYPE_COLOR3: h = tt }var g = d / u >> 0, v = a ? t + d % u : i; if (this._host && this._host.syncRoot) { var y = this._host.syncRoot; v = t + (i - t) * ((y.masterFrame - y.fromFrame) / (y.toFrame - y.fromFrame)) } var b = this._events; if (0 < u && this.currentFrame > v || u < 0 && this.currentFrame < v) for (var T = 0; T < b.length; T++)b[T].onlyOnce || (b[T].isDone = !1); var E = this._interpolate(v, g, this._getCorrectLoopMode(), h, f); for (this.setValue(E, o), T = 0; T < b.length; T++)if (0 < u && v >= b[T].frame && b[T].frame >= t || u < 0 && v <= b[T].frame && b[T].frame <= t) { var x = b[T]; x.isDone || (x.onlyOnce && (b.splice(T, 1), T--), x.isDone = !0, x.action(v)) } return a || (this._stopped = !0), a }, e }(), Ze.RuntimeAnimation = it, rt = $a || ($a = {}), nt = function () { function e(e, t, i, r, n, o, s, a) { void 0 === i && (i = 0), void 0 === r && (r = 100), void 0 === n && (n = !1), void 0 === o && (o = 1), this.target = t, this.fromFrame = i, this.toFrame = r, this.loopAnimation = n, this.onAnimationEnd = s, this._localDelayOffset = null, this._pausedDelay = null, this._runtimeAnimations = new Array, this._paused = !1, this._speedRatio = 1, this._weight = -1, this.disposeOnEnd = !0, this.animationStarted = !1, this.onAnimationEndObservable = new rt.Observable, this._scene = e, a && this.appendAnimations(t, a), this._speedRatio = o, e._activeAnimatables.push(this) } return Object.defineProperty(e.prototype, "syncRoot", { get: function () { return this._syncRoot }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "masterFrame", { get: function () { return 0 === this._runtimeAnimations.length ? 0 : this._runtimeAnimations[0].currentFrame }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "weight", { get: function () { return this._weight }, set: function (e) { this._weight = -1 !== e ? Math.min(Math.max(e, 0), 1) : -1 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "speedRatio", { get: function () { return this._speedRatio }, set: function (e) { for (var t = 0; t < this._runtimeAnimations.length; t++)this._runtimeAnimations[t]._prepareForSpeedRatioChange(e); this._speedRatio = e }, enumerable: !0, configurable: !0 }), e.prototype.syncWith = function (e) { if (this._syncRoot = e) { var t = this._scene._activeAnimatables.indexOf(this); -1 < t && (this._scene._activeAnimatables.splice(t, 1), this._scene._activeAnimatables.push(this)) } return this }, e.prototype.getAnimations = function () { return this._runtimeAnimations }, e.prototype.appendAnimations = function (e, t) { for (var i = 0; i < t.length; i++) { var r = t[i]; this._runtimeAnimations.push(new rt.RuntimeAnimation(e, r, this._scene, this)) } }, e.prototype.getAnimationByTargetProperty = function (e) { for (var t = this._runtimeAnimations, i = 0; i < t.length; i++)if (t[i].animation.targetProperty === e) return t[i].animation; return null }, e.prototype.getRuntimeAnimationByTargetProperty = function (e) { for (var t = this._runtimeAnimations, i = 0; i < t.length; i++)if (t[i].animation.targetProperty === e) return t[i]; return null }, e.prototype.reset = function () { for (var e = this._runtimeAnimations, t = 0; t < e.length; t++)e[t].reset(!0); this._localDelayOffset = null, this._pausedDelay = null }, e.prototype.enableBlending = function (e) { for (var t = this._runtimeAnimations, i = 0; i < t.length; i++)t[i].animation.enableBlending = !0, t[i].animation.blendingSpeed = e }, e.prototype.disableBlending = function () { for (var e = this._runtimeAnimations, t = 0; t < e.length; t++)e[t].animation.enableBlending = !1 }, e.prototype.goToFrame = function (e) { var t = this._runtimeAnimations; if (t[0]) { var i = t[0].animation.framePerSecond, r = 1e3 * (e - t[0].currentFrame) / (i * this.speedRatio); null === this._localDelayOffset && (this._localDelayOffset = 0), this._localDelayOffset -= r } for (var n = 0; n < t.length; n++)t[n].goToFrame(e) }, e.prototype.pause = function () { this._paused || (this._paused = !0) }, e.prototype.restart = function () { this._paused = !1 }, e.prototype._raiseOnAnimationEnd = function () { this.onAnimationEnd && this.onAnimationEnd(), this.onAnimationEndObservable.notifyObservers(this) }, e.prototype.stop = function (e, t) { if (e || t) { var i = this._scene._activeAnimatables.indexOf(this); if (-1 < i) { for (var r = (o = this._runtimeAnimations).length - 1; 0 <= r; r--) { var n = o[r]; e && n.animation.name != e || t && !t(n.target) || (n.dispose(), o.splice(r, 1)) } 0 == o.length && (this._scene._activeAnimatables.splice(i, 1), this._raiseOnAnimationEnd()) } } else if (-1 < (r = this._scene._activeAnimatables.indexOf(this))) { this._scene._activeAnimatables.splice(r, 1); var o = this._runtimeAnimations; for (r = 0; r < o.length; r++)o[r].dispose(); this._raiseOnAnimationEnd() } }, e.prototype.waitAsync = function () { var e = this; return new Promise(function (t, i) { e.onAnimationEndObservable.add(function () { t(e) }, void 0, void 0, e, !0) }) }, e.prototype._animate = function (e) { if (this._paused) return this.animationStarted = !1, null === this._pausedDelay && (this._pausedDelay = e), !0; if (null === this._localDelayOffset ? (this._localDelayOffset = e, this._pausedDelay = null) : null !== this._pausedDelay && (this._localDelayOffset += e - this._pausedDelay, this._pausedDelay = null), 0 === this._weight) return !0; var t, i = !1, r = this._runtimeAnimations; for (t = 0; t < r.length; t++) { var n = r[t].animate(e - this._localDelayOffset, this.fromFrame, this.toFrame, this.loopAnimation, this._speedRatio, this._weight); i = i || n } if (!(this.animationStarted = i)) { if (this.disposeOnEnd) for (t = this._scene._activeAnimatables.indexOf(this), this._scene._activeAnimatables.splice(t, 1), t = 0; t < r.length; t++)r[t].dispose(); this._raiseOnAnimationEnd(), this.disposeOnEnd && (this.onAnimationEnd = null, this.onAnimationEndObservable.clear()) } return i }, e }(), rt.Animatable = nt, function (e) { var t = function () { function e() { this._easingMode = e.EASINGMODE_EASEIN } return e.prototype.setEasingMode = function (e) { var t = Math.min(Math.max(e, 0), 2); this._easingMode = t }, e.prototype.getEasingMode = function () { return this._easingMode }, e.prototype.easeInCore = function (e) { throw new Error("You must implement this method") }, e.prototype.ease = function (t) { switch (this._easingMode) { case e.EASINGMODE_EASEIN: return this.easeInCore(t); case e.EASINGMODE_EASEOUT: return 1 - this.easeInCore(1 - t) }return .5 <= t ? .5 * (1 - this.easeInCore(2 * (1 - t))) + .5 : .5 * this.easeInCore(2 * t) }, e.EASINGMODE_EASEIN = 0, e.EASINGMODE_EASEOUT = 1, e.EASINGMODE_EASEINOUT = 2, e }(), i = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.easeInCore = function (e) { return e = Math.max(0, Math.min(1, e)), 1 - Math.sqrt(1 - e * e) }, t }(e.EasingFunction = t); e.CircleEase = i; var r = function (e) { function t(t) { void 0 === t && (t = 1); var i = e.call(this) || this; return i.amplitude = t, i } return T(t, e), t.prototype.easeInCore = function (e) { var t = Math.max(0, this.amplitude); return Math.pow(e, 3) - e * t * Math.sin(3.141592653589793 * e) }, t }(t); e.BackEase = r; var n = function (e) { function t(t, i) { void 0 === t && (t = 3), void 0 === i && (i = 2); var r = e.call(this) || this; return r.bounces = t, r.bounciness = i, r } return T(t, e), t.prototype.easeInCore = function (e) { var t = Math.max(0, this.bounces), i = this.bounciness; i <= 1 && (i = 1.001); var r = Math.pow(i, t), n = 1 - i, o = (1 - r) / n + .5 * r, s = e * o, a = Math.log(-s * (1 - i) + 1) / Math.log(i), l = Math.floor(a), c = l + 1, h = (1 - Math.pow(i, l)) / (n * o), u = .5 * (h + (1 - Math.pow(i, c)) / (n * o)), d = e - u, f = u - h; return -Math.pow(1 / i, t - l) / (f * f) * (d - f) * (d + f) }, t }(t); e.BounceEase = n; var o = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.easeInCore = function (e) { return e * e * e }, t }(t); e.CubicEase = o; var s = function (e) { function t(t, i) { void 0 === t && (t = 3), void 0 === i && (i = 3); var r = e.call(this) || this; return r.oscillations = t, r.springiness = i, r } return T(t, e), t.prototype.easeInCore = function (e) { var t = Math.max(0, this.oscillations), i = Math.max(0, this.springiness); return (0 == i ? e : (Math.exp(i * e) - 1) / (Math.exp(i) - 1)) * Math.sin((6.283185307179586 * t + 1.5707963267948966) * e) }, t }(t); e.ElasticEase = s; var a = function (e) { function t(t) { void 0 === t && (t = 2); var i = e.call(this) || this; return i.exponent = t, i } return T(t, e), t.prototype.easeInCore = function (e) { return this.exponent <= 0 ? e : (Math.exp(this.exponent * e) - 1) / (Math.exp(this.exponent) - 1) }, t }(t); e.ExponentialEase = a; var l = function (e) { function t(t) { void 0 === t && (t = 2); var i = e.call(this) || this; return i.power = t, i } return T(t, e), t.prototype.easeInCore = function (e) { var t = Math.max(0, this.power); return Math.pow(e, t) }, t }(t); e.PowerEase = l; var c = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.easeInCore = function (e) { return e * e }, t }(t); e.QuadraticEase = c; var h = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.easeInCore = function (e) { return e * e * e * e }, t }(t); e.QuarticEase = h; var u = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.easeInCore = function (e) { return e * e * e * e * e }, t }(t); e.QuinticEase = u; var d = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.easeInCore = function (e) { return 1 - Math.sin(1.5707963267948966 * (1 - e)) }, t }(t); e.SineEase = d; var f = function (t) { function i(e, i, r, n) { void 0 === e && (e = 0), void 0 === i && (i = 0), void 0 === r && (r = 1), void 0 === n && (n = 1); var o = t.call(this) || this; return o.x1 = e, o.y1 = i, o.x2 = r, o.y2 = n, o } return T(i, t), i.prototype.easeInCore = function (t) { return e.BezierCurve.Interpolate(t, this.x1, this.y1, this.x2, this.y2) }, i }(t); e.BezierCurveEase = f }($a || ($a = {})), function (e) { var t = function () { function e(e) { this._actionManager = e } return e.prototype.isValid = function () { return !0 }, e.prototype._getProperty = function (e) { return this._actionManager._getProperty(e) }, e.prototype._getEffectiveTarget = function (e, t) { return this._actionManager._getEffectiveTarget(e, t) }, e.prototype.serialize = function () { }, e.prototype._serialize = function (e) { return { type: 2, children: [], name: e.name, properties: e.properties } }, e }(), i = function (t) { function i(e, r, n, o, s) { void 0 === s && (s = i.IsEqual); var a = t.call(this, e) || this; return a.propertyPath = n, a.value = o, a.operator = s, a._target = r, a._effectiveTarget = a._getEffectiveTarget(r, a.propertyPath), a._property = a._getProperty(a.propertyPath), a } return T(i, t), Object.defineProperty(i, "IsEqual", { get: function () { return i._IsEqual }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "IsDifferent", { get: function () { return i._IsDifferent }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "IsGreater", { get: function () { return i._IsGreater }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "IsLesser", { get: function () { return i._IsLesser }, enumerable: !0, configurable: !0 }), i.prototype.isValid = function () { switch (this.operator) { case i.IsGreater: return this._effectiveTarget[this._property] > this.value; case i.IsLesser: return this._effectiveTarget[this._property] < this.value; case i.IsEqual: case i.IsDifferent: var e; return e = this.value.equals ? this.value.equals(this._effectiveTarget[this._property]) : this.value === this._effectiveTarget[this._property], this.operator === i.IsEqual ? e : !e }return !1 }, i.prototype.serialize = function () { return this._serialize({ name: "ValueCondition", properties: [e.Action._GetTargetProperty(this._target), { name: "propertyPath", value: this.propertyPath }, { name: "value", value: e.Action._SerializeValueAsString(this.value) }, { name: "operator", value: i.GetOperatorName(this.operator) }] }) }, i.GetOperatorName = function (e) { switch (e) { case i._IsEqual: return "IsEqual"; case i._IsDifferent: return "IsDifferent"; case i._IsGreater: return "IsGreater"; case i._IsLesser: return "IsLesser"; default: return "" } }, i._IsEqual = 0, i._IsDifferent = 1, i._IsGreater = 2, i._IsLesser = 3, i }(e.Condition = t); e.ValueCondition = i; var r = function (e) { function t(t, i) { var r = e.call(this, t) || this; return r.predicate = i, r } return T(t, e), t.prototype.isValid = function () { return this.predicate() }, t }(t); e.PredicateCondition = r; var n = function (t) { function i(e, i, r) { var n = t.call(this, e) || this; return n.value = r, n._target = i, n } return T(i, t), i.prototype.isValid = function () { return this._target.state === this.value }, i.prototype.serialize = function () { return this._serialize({ name: "StateCondition", properties: [e.Action._GetTargetProperty(this._target), { name: "value", value: this.value }] }) }, i }(t); e.StateCondition = n }($a || ($a = {})), ot = $a || ($a = {}), st = function () { function e(e, t) { this.triggerOptions = e, this.onBeforeExecuteObservable = new ot.Observable, e.parameter ? (this.trigger = e.trigger, this._triggerParameter = e.parameter) : e.trigger ? this.trigger = e.trigger : this.trigger = e, (this._nextActiveAction = this)._condition = t } return e.prototype._prepare = function () { }, e.prototype.getTriggerParameter = function () { return this._triggerParameter }, e.prototype._executeCurrent = function (e) { if (this._nextActiveAction._condition) { var t = this._nextActiveAction._condition, i = this._actionManager.getScene().getRenderId(); if (t._evaluationId === i) { if (!t._currentResult) return } else { if (t._evaluationId = i, !t.isValid()) return void (t._currentResult = !1); t._currentResult = !0 } } this.onBeforeExecuteObservable.notifyObservers(this), this._nextActiveAction.execute(e), this.skipToNextActiveAction() }, e.prototype.execute = function (e) { }, e.prototype.skipToNextActiveAction = function () { this._nextActiveAction._child ? (this._nextActiveAction._child._actionManager || (this._nextActiveAction._child._actionManager = this._actionManager), this._nextActiveAction = this._nextActiveAction._child) : this._nextActiveAction = this }, e.prototype.then = function (e) { return (this._child = e)._actionManager = this._actionManager, e._prepare(), e }, e.prototype._getProperty = function (e) { return this._actionManager._getProperty(e) }, e.prototype._getEffectiveTarget = function (e, t) { return this._actionManager._getEffectiveTarget(e, t) }, e.prototype.serialize = function (e) { }, e.prototype._serialize = function (e, t) { var i = { type: 1, children: [], name: e.name, properties: e.properties || [] }; if (this._child && this._child.serialize(i), this._condition) { var r = this._condition.serialize(); return r.children.push(i), t && t.children.push(r), r } return t && t.children.push(i), i }, e._SerializeValueAsString = function (e) { return "number" == typeof e ? e.toString() : "boolean" == typeof e ? e ? "true" : "false" : e instanceof ot.Vector2 ? e.x + ", " + e.y : e instanceof ot.Vector3 ? e.x + ", " + e.y + ", " + e.z : e instanceof ot.Color3 ? e.r + ", " + e.g + ", " + e.b : e instanceof ot.Color4 ? e.r + ", " + e.g + ", " + e.b + ", " + e.a : e }, e._GetTargetProperty = function (e) { return { name: "target", targetType: e instanceof ot.Mesh ? "MeshProperties" : e instanceof ot.Light ? "LightProperties" : e instanceof ot.Camera ? "CameraProperties" : "SceneProperties", value: e instanceof ot.Scene ? "Scene" : e.name } }, e }(), ot.Action = st, function (e) { var t = function () { function e(e, t, i, r, n, o) { this.source = e, this.pointerX = t, this.pointerY = i, this.meshUnderPointer = r, this.sourceEvent = n, this.additionalData = o } return e.CreateNew = function (t, i, r) { var n = t.getScene(); return new e(t, n.pointerX, n.pointerY, n.meshUnderPointer, i, r) }, e.CreateNewFromSprite = function (t, i, r, n) { return new e(t, i.pointerX, i.pointerY, i.meshUnderPointer, r, n) }, e.CreateNewFromScene = function (t, i) { return new e(null, t.pointerX, t.pointerY, t.meshUnderPointer, i) }, e.CreateNewFromPrimitive = function (t, i, r, n) { return new e(t, i.x, i.y, null, r, n) }, e }(); e.ActionEvent = t; var i = function () { function t(t) { this.actions = new Array, this.hoverCursor = "", this._scene = t || e.Engine.LastCreatedScene, t.actionManagers.push(this) } return t.prototype.dispose = function () { for (var e = this._scene.actionManagers.indexOf(this), i = 0; i < this.actions.length; i++) { var r = this.actions[i]; t.Triggers[r.trigger]-- , 0 === t.Triggers[r.trigger] && delete t.Triggers[r.trigger] } -1 < e && this._scene.actionManagers.splice(e, 1) }, t.prototype.getScene = function () { return this._scene }, t.prototype.hasSpecificTriggers = function (e) { for (var t = 0; t < this.actions.length; t++) { var i = this.actions[t]; if (-1 < e.indexOf(i.trigger)) return !0 } return !1 }, t.prototype.hasSpecificTriggers2 = function (e, t) { for (var i = 0; i < this.actions.length; i++) { var r = this.actions[i]; if (e == r.trigger || t == r.trigger) return !0 } return !1 }, t.prototype.hasSpecificTrigger = function (e, t) { for (var i = 0; i < this.actions.length; i++) { var r = this.actions[i]; if (r.trigger === e) { if (!t) return !0; if (t(r.getTriggerParameter())) return !0 } } return !1 }, Object.defineProperty(t.prototype, "hasPointerTriggers", { get: function () { for (var e = 0; e < this.actions.length; e++) { var i = this.actions[e]; if (i.trigger >= t.OnPickTrigger && i.trigger <= t.OnPointerOutTrigger) return !0 } return !1 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "hasPickTriggers", { get: function () { for (var e = 0; e < this.actions.length; e++) { var i = this.actions[e]; if (i.trigger >= t.OnPickTrigger && i.trigger <= t.OnPickUpTrigger) return !0 } return !1 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "HasTriggers", { get: function () { for (var e in t.Triggers) if (t.Triggers.hasOwnProperty(e)) return !0; return !1 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "HasPickTriggers", { get: function () { for (var e in t.Triggers) if (t.Triggers.hasOwnProperty(e)) { var i = parseInt(e); if (t.OnPickTrigger <= i && i <= t.OnPickUpTrigger) return !0 } return !1 }, enumerable: !0, configurable: !0 }), t.HasSpecificTrigger = function (e) { for (var i in t.Triggers) if (t.Triggers.hasOwnProperty(i) && parseInt(i) === e) return !0; return !1 }, t.prototype.registerAction = function (i) { return i.trigger === t.OnEveryFrameTrigger && this.getScene().actionManager !== this ? (e.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"), null) : (this.actions.push(i), t.Triggers[i.trigger] ? t.Triggers[i.trigger]++ : t.Triggers[i.trigger] = 1, i._actionManager = this, i._prepare(), i) }, t.prototype.unregisterAction = function (e) { var i = this.actions.indexOf(e); return -1 !== i && (this.actions.splice(i, 1), t.Triggers[e.trigger] -= 1, 0 === t.Triggers[e.trigger] && delete t.Triggers[e.trigger], delete e._actionManager, !0) }, t.prototype.processTrigger = function (e, i) { for (var r = 0; r < this.actions.length; r++) { var n = this.actions[r]; if (n.trigger === e) { if (i && (e === t.OnKeyUpTrigger || e === t.OnKeyDownTrigger)) { var o = n.getTriggerParameter(); if (o && o !== i.sourceEvent.keyCode) { if (!o.toLowerCase) continue; var s = o.toLowerCase(); if (s !== i.sourceEvent.key) { var a = i.sourceEvent.charCode ? i.sourceEvent.charCode : i.sourceEvent.keyCode; if (String.fromCharCode(a).toLowerCase() !== s) continue } } } n._executeCurrent(i) } } }, t.prototype._getEffectiveTarget = function (e, t) { for (var i = t.split("."), r = 0; r < i.length - 1; r++)e = e[i[r]]; return e }, t.prototype._getProperty = function (e) { var t = e.split("."); return t[t.length - 1] }, t.prototype.serialize = function (i) { for (var r = { children: new Array, name: i, type: 3, properties: new Array }, n = 0; n < this.actions.length; n++) { var o = { type: 0, children: new Array, name: t.GetTriggerName(this.actions[n].trigger), properties: new Array }, s = this.actions[n].triggerOptions; if (s && "number" != typeof s) if (s.parameter instanceof e.Node) o.properties.push(e.Action._GetTargetProperty(s.parameter)); else { var a = {}; e.Tools.DeepCopy(s.parameter, a, ["mesh"]), s.parameter && s.parameter.mesh && (a._meshId = s.parameter.mesh.id), o.properties.push({ name: "parameter", targetType: null, value: a }) } this.actions[n].serialize(o), r.children.push(o) } return r }, t.Parse = function (i, r, n) { var o = new t(n); null === r ? n.actionManager = o : r.actionManager = o; for (var s = function (t, i, r, n) { if (null === n) { var o = parseFloat(i); return "true" === i || "false" === i ? "true" === i : isNaN(o) ? i : o } for (var s = n.split("."), a = i.split(","), l = 0; l < s.length; l++)r = r[s[l]]; if ("boolean" == typeof r) return "true" === a[0]; if ("string" == typeof r) return a[0]; var c = new Array; for (l = 0; l < a.length; l++)c.push(parseFloat(a[l])); return r instanceof e.Vector3 ? e.Vector3.FromArray(c) : r instanceof e.Vector4 ? e.Vector4.FromArray(c) : r instanceof e.Color3 ? e.Color3.FromArray(c) : r instanceof e.Color4 ? e.Color4.FromArray(c) : parseFloat(a[0]) }, a = function (i, r, l, c, h) { if (void 0 === h && (h = null), !i.detached) { var u = new Array, d = null, f = null, p = i.combine && 0 < i.combine.length; if (2 === i.type ? u.push(o) : u.push(r), p) { for (var _ = new Array, m = 0; m < i.combine.length; m++)a(i.combine[m], t.NothingTrigger, l, c, _); u.push(_) } else for (var g = 0; g < i.properties.length; g++) { var v = i.properties[g].value, y = i.properties[g].name, b = i.properties[g].targetType; "target" === y ? v = d = null !== b && "SceneProperties" === b ? n : n.getNodeByName(v) : "parent" === y ? v = n.getNodeByName(v) : "sound" === y ? n.getSoundByName && (v = n.getSoundByName(v)) : "propertyPath" !== y ? v = 2 === i.type && "operator" === y ? e.ValueCondition[v] : s(0, v, d, "value" === y ? f : null) : f = v, u.push(v) } if (null === h ? u.push(l) : u.push(null), "InterpolateValueAction" === i.name) { var T = u[u.length - 2]; u[u.length - 1] = T, u[u.length - 2] = l } var E, x, P, A = (E = i.name, x = u, (P = Object.create(e.Tools.Instantiate("BABYLON." + E).prototype)).constructor.apply(P, x), P); if (A instanceof e.Condition && null !== l) { var S = new e.DoNothingAction(r, l); c ? c.then(S) : o.registerAction(S), c = S } for (null === h ? A instanceof e.Condition ? (l = A, A = c) : (l = null, c ? c.then(A) : o.registerAction(A)) : h.push(A), g = 0; g < i.children.length; g++)a(i.children[g], r, l, A, null) } }, l = 0; l < i.children.length; l++) { var c, h = i.children[l]; if (0 < h.properties.length) { var u = h.properties[0].value, d = null === h.properties[0].targetType ? u : n.getMeshByName(u); d._meshId && (d.mesh = n.getMeshByID(d._meshId)), c = { trigger: t[h.name], parameter: d } } else c = t[h.name]; for (var f = 0; f < h.children.length; f++)h.detached || a(h.children[f], c, null, null) } }, t.GetTriggerName = function (e) { switch (e) { case 0: return "NothingTrigger"; case 1: return "OnPickTrigger"; case 2: return "OnLeftPickTrigger"; case 3: return "OnRightPickTrigger"; case 4: return "OnCenterPickTrigger"; case 5: return "OnPickDownTrigger"; case 6: return "OnPickUpTrigger"; case 7: return "OnLongPressTrigger"; case 8: return "OnPointerOverTrigger"; case 9: return "OnPointerOutTrigger"; case 10: return "OnEveryFrameTrigger"; case 11: return "OnIntersectionEnterTrigger"; case 12: return "OnIntersectionExitTrigger"; case 13: return "OnKeyDownTrigger"; case 14: return "OnKeyUpTrigger"; case 15: return "OnPickOutTrigger"; default: return "" } }, t.NothingTrigger = 0, t.OnPickTrigger = 1, t.OnLeftPickTrigger = 2, t.OnRightPickTrigger = 3, t.OnCenterPickTrigger = 4, t.OnPickDownTrigger = 5, t.OnDoublePickTrigger = 6, t.OnPickUpTrigger = 7, t.OnPickOutTrigger = 16, t.OnLongPressTrigger = 8, t.OnPointerOverTrigger = 9, t.OnPointerOutTrigger = 10, t.OnEveryFrameTrigger = 11, t.OnIntersectionEnterTrigger = 12, t.OnIntersectionExitTrigger = 13, t.OnKeyDownTrigger = 14, t.OnKeyUpTrigger = 15, t.Triggers = {}, t }(); e.ActionManager = i }($a || ($a = {})), lt = function (e) { function t(t, i, r, n, o, s, a, l) { void 0 === o && (o = 1e3); var c = e.call(this, t, s) || this; return c.duration = 1e3, c.onInterpolationDoneObservable = new at.Observable, c.propertyPath = r, c.value = n, c.duration = o, c.stopOtherAnimations = a, c.onInterpolationDone = l, c._target = c._effectiveTarget = i, c } return T(t, e), t.prototype._prepare = function () { this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath), this._property = this._getProperty(this.propertyPath) }, t.prototype.execute = function () { var e, t = this, i = this._actionManager.getScene(), r = [{ frame: 0, value: this._effectiveTarget[this._property] }, { frame: 100, value: this.value }]; if ("number" == typeof this.value) e = at.Animation.ANIMATIONTYPE_FLOAT; else if (this.value instanceof at.Color3) e = at.Animation.ANIMATIONTYPE_COLOR3; else if (this.value instanceof at.Vector3) e = at.Animation.ANIMATIONTYPE_VECTOR3; else if (this.value instanceof at.Matrix) e = at.Animation.ANIMATIONTYPE_MATRIX; else { if (!(this.value instanceof at.Quaternion)) return void at.Tools.Warn("InterpolateValueAction: Unsupported type (" + typeof this.value + ")"); e = at.Animation.ANIMATIONTYPE_QUATERNION } var n = new at.Animation("InterpolateValueAction", this._property, 1e3 / this.duration * 100, e, at.Animation.ANIMATIONLOOPMODE_CONSTANT); n.setKeys(r), this.stopOtherAnimations && i.stopAnimation(this._effectiveTarget), i.beginDirectAnimation(this._effectiveTarget, [n], 0, 100, !1, 1, function () { t.onInterpolationDoneObservable.notifyObservers(t), t.onInterpolationDone && t.onInterpolationDone() }) }, t.prototype.serialize = function (t) { return e.prototype._serialize.call(this, { name: "InterpolateValueAction", properties: [at.Action._GetTargetProperty(this._target), { name: "propertyPath", value: this.propertyPath }, { name: "value", value: at.Action._SerializeValueAsString(this.value) }, { name: "duration", value: at.Action._SerializeValueAsString(this.duration) }, { name: "stopOtherAnimations", value: at.Action._SerializeValueAsString(this.stopOtherAnimations) || !1 }] }, t) }, t }((at = $a || ($a = {})).Action), at.InterpolateValueAction = lt, function (e) { var t = function (t) { function i(e, i, r, n) { var o = t.call(this, e, n) || this; return o.propertyPath = r, o._target = o._effectiveTarget = i, o } return T(i, t), i.prototype._prepare = function () { this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath), this._property = this._getProperty(this.propertyPath) }, i.prototype.execute = function () { this._effectiveTarget[this._property] = !this._effectiveTarget[this._property] }, i.prototype.serialize = function (i) { return t.prototype._serialize.call(this, { name: "SwitchBooleanAction", properties: [e.Action._GetTargetProperty(this._target), { name: "propertyPath", value: this.propertyPath }] }, i) }, i }(e.Action); e.SwitchBooleanAction = t; var i = function (t) { function i(e, i, r, n) { var o = t.call(this, e, n) || this; return o.value = r, o._target = i, o } return T(i, t), i.prototype.execute = function () { this._target.state = this.value }, i.prototype.serialize = function (i) { return t.prototype._serialize.call(this, { name: "SetStateAction", properties: [e.Action._GetTargetProperty(this._target), { name: "value", value: this.value }] }, i) }, i }(e.Action); e.SetStateAction = i; var r = function (t) { function i(e, i, r, n, o) { var s = t.call(this, e, o) || this; return s.propertyPath = r, s.value = n, s._target = s._effectiveTarget = i, s } return T(i, t), i.prototype._prepare = function () { this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath), this._property = this._getProperty(this.propertyPath) }, i.prototype.execute = function () { this._effectiveTarget[this._property] = this.value, this._target.markAsDirty && this._target.markAsDirty(this._property) }, i.prototype.serialize = function (i) { return t.prototype._serialize.call(this, { name: "SetValueAction", properties: [e.Action._GetTargetProperty(this._target), { name: "propertyPath", value: this.propertyPath }, { name: "value", value: e.Action._SerializeValueAsString(this.value) }] }, i) }, i }(e.Action); e.SetValueAction = r; var n = function (t) { function i(e, i, r, n, o) { var s = t.call(this, e, o) || this; return s.propertyPath = r, s.value = n, s._target = s._effectiveTarget = i, s } return T(i, t), i.prototype._prepare = function () { this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath), this._property = this._getProperty(this.propertyPath), "number" != typeof this._effectiveTarget[this._property] && e.Tools.Warn("Warning: IncrementValueAction can only be used with number values") }, i.prototype.execute = function () { this._effectiveTarget[this._property] += this.value, this._target.markAsDirty && this._target.markAsDirty(this._property) }, i.prototype.serialize = function (i) { return t.prototype._serialize.call(this, { name: "IncrementValueAction", properties: [e.Action._GetTargetProperty(this._target), { name: "propertyPath", value: this.propertyPath }, { name: "value", value: e.Action._SerializeValueAsString(this.value) }] }, i) }, i }(e.Action); e.IncrementValueAction = n; var o = function (t) { function i(e, i, r, n, o, s) { var a = t.call(this, e, s) || this; return a.from = r, a.to = n, a.loop = o, a._target = i, a } return T(i, t), i.prototype._prepare = function () { }, i.prototype.execute = function () { this._actionManager.getScene().beginAnimation(this._target, this.from, this.to, this.loop) }, i.prototype.serialize = function (i) { return t.prototype._serialize.call(this, { name: "PlayAnimationAction", properties: [e.Action._GetTargetProperty(this._target), { name: "from", value: String(this.from) }, { name: "to", value: String(this.to) }, { name: "loop", value: e.Action._SerializeValueAsString(this.loop) || !1 }] }, i) }, i }(e.Action); e.PlayAnimationAction = o; var s = function (t) { function i(e, i, r) { var n = t.call(this, e, r) || this; return n._target = i, n } return T(i, t), i.prototype._prepare = function () { }, i.prototype.execute = function () { this._actionManager.getScene().stopAnimation(this._target) }, i.prototype.serialize = function (i) { return t.prototype._serialize.call(this, { name: "StopAnimationAction", properties: [e.Action._GetTargetProperty(this._target)] }, i) }, i }(e.Action); e.StopAnimationAction = s; var a = function (t) { function i(i, r) { return void 0 === i && (i = e.ActionManager.NothingTrigger), t.call(this, i, r) || this } return T(i, t), i.prototype.execute = function () { }, i.prototype.serialize = function (e) { return t.prototype._serialize.call(this, { name: "DoNothingAction", properties: [] }, e) }, i }(e.Action); e.DoNothingAction = a; var l = function (e) { function t(t, i, r) { var n = e.call(this, t, r) || this; return n.children = i, n } return T(t, e), t.prototype._prepare = function () { for (var e = 0; e < this.children.length; e++)this.children[e]._actionManager = this._actionManager, this.children[e]._prepare() }, t.prototype.execute = function (e) { for (var t = 0; t < this.children.length; t++)this.children[t].execute(e) }, t.prototype.serialize = function (t) { for (var i = e.prototype._serialize.call(this, { name: "CombineAction", properties: [], combine: [] }, t), r = 0; r < this.children.length; r++)i.combine.push(this.children[r].serialize(null)); return i }, t }(e.Action); e.CombineAction = l; var c = function (e) { function t(t, i, r) { var n = e.call(this, t, r) || this; return n.func = i, n } return T(t, e), t.prototype.execute = function (e) { this.func(e) }, t }(e.Action); e.ExecuteCodeAction = c; var h = function (t) { function i(e, i, r, n) { var o = t.call(this, e, n) || this; return o._target = i, o._parent = r, o } return T(i, t), i.prototype._prepare = function () { }, i.prototype.execute = function () { if (this._target.parent !== this._parent) { var t = this._parent.getWorldMatrix().clone(); t.invert(), this._target.position = e.Vector3.TransformCoordinates(this._target.position, t), this._target.parent = this._parent } }, i.prototype.serialize = function (i) { return t.prototype._serialize.call(this, { name: "SetParentAction", properties: [e.Action._GetTargetProperty(this._target), e.Action._GetTargetProperty(this._parent)] }, i) }, i }(e.Action); e.SetParentAction = h }($a || ($a = {})), ct = $a || ($a = {}), ht = function () { function e(e, t, i, r, n, o, s) { if (void 0 === o && (o = .01), void 0 === s && (s = ct.Texture.TRILINEAR_SAMPLINGMODE), this.name = e, this.sprites = new Array, this.renderingGroupId = 0, this.layerMask = 268435455, this.fogEnabled = !0, this.isPickable = !1, this.onDisposeObservable = new ct.Observable, this._vertexBuffers = {}, n._getComponent(ct.SceneComponentConstants.NAME_SPRITE) || n._addComponent(new ct.SpriteSceneComponent(n)), this._capacity = i, this._spriteTexture = new ct.Texture(t, n, !0, !1, s), this._spriteTexture.wrapU = ct.Texture.CLAMP_ADDRESSMODE, this._spriteTexture.wrapV = ct.Texture.CLAMP_ADDRESSMODE, r.width && r.height) this.cellWidth = r.width, this.cellHeight = r.height; else { if (void 0 === r) return; this.cellWidth = r, this.cellHeight = r } this._epsilon = o, this._scene = n, this._scene.spriteManagers.push(this); for (var a = [], l = 0, c = 0; c < i; c++)a.push(l), a.push(l + 1), a.push(l + 2), a.push(l), a.push(l + 2), a.push(l + 3), l += 4; this._indexBuffer = n.getEngine().createIndexBuffer(a), this._vertexData = new Float32Array(16 * i * 4), this._buffer = new ct.Buffer(n.getEngine(), this._vertexData, !0, 16); var h = this._buffer.createVertexBuffer(ct.VertexBuffer.PositionKind, 0, 4), u = this._buffer.createVertexBuffer("options", 4, 4), d = this._buffer.createVertexBuffer("cellInfo", 8, 4), f = this._buffer.createVertexBuffer(ct.VertexBuffer.ColorKind, 12, 4); this._vertexBuffers[ct.VertexBuffer.PositionKind] = h, this._vertexBuffers.options = u, this._vertexBuffers.cellInfo = d, this._vertexBuffers[ct.VertexBuffer.ColorKind] = f, this._effectBase = this._scene.getEngine().createEffect("sprites", [ct.VertexBuffer.PositionKind, "options", "cellInfo", ct.VertexBuffer.ColorKind], ["view", "projection", "textureInfos", "alphaTest"], ["diffuseSampler"], ""), this._effectFog = this._scene.getEngine().createEffect("sprites", [ct.VertexBuffer.PositionKind, "options", "cellInfo", ct.VertexBuffer.ColorKind], ["view", "projection", "textureInfos", "alphaTest", "vFogInfos", "vFogColor"], ["diffuseSampler"], "#define FOG") } return Object.defineProperty(e.prototype, "onDispose", { set: function (e) { this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "texture", { get: function () { return this._spriteTexture }, set: function (e) { this._spriteTexture = e }, enumerable: !0, configurable: !0 }), e.prototype._appendSpriteVertex = function (e, t, i, r, n) { var o = 16 * e; 0 === i ? i = this._epsilon : 1 === i && (i = 1 - this._epsilon), 0 === r ? r = this._epsilon : 1 === r && (r = 1 - this._epsilon), this._vertexData[o] = t.position.x, this._vertexData[o + 1] = t.position.y, this._vertexData[o + 2] = t.position.z, this._vertexData[o + 3] = t.angle, this._vertexData[o + 4] = t.width, this._vertexData[o + 5] = t.height, this._vertexData[o + 6] = i, this._vertexData[o + 7] = r, this._vertexData[o + 8] = t.invertU ? 1 : 0, this._vertexData[o + 9] = t.invertV ? 1 : 0; var s = t.cellIndex / n >> 0; this._vertexData[o + 10] = t.cellIndex - s * n, this._vertexData[o + 11] = s, this._vertexData[o + 12] = t.color.r, this._vertexData[o + 13] = t.color.g, this._vertexData[o + 14] = t.color.b, this._vertexData[o + 15] = t.color.a }, e.prototype.intersects = function (e, t, i, r) { for (var n = Math.min(this._capacity, this.sprites.length), o = ct.Vector3.Zero(), s = ct.Vector3.Zero(), a = Number.MAX_VALUE, l = null, c = ct.Vector3.Zero(), h = t.getViewMatrix(), u = 0; u < n; u++) { var d = this.sprites[u]; if (d) { if (i) { if (!i(d)) continue } else if (!d.isPickable) continue; if (ct.Vector3.TransformCoordinatesToRef(d.position, h, c), o.copyFromFloats(c.x - d.width / 2, c.y - d.height / 2, c.z), s.copyFromFloats(c.x + d.width / 2, c.y + d.height / 2, c.z), e.intersectsBoxMinMax(o, s)) { var f = ct.Vector3.Distance(c, e.origin); if (f < a && (a = f, l = d, r)) break } } } if (l) { var p = new ct.PickingInfo; return p.hit = !0, p.pickedSprite = l, p.distance = a, p } return null }, e.prototype.render = function () { if (this._effectBase.isReady() && this._effectFog.isReady() && this._spriteTexture && this._spriteTexture.isReady()) { for (var e = this._scene.getEngine(), t = this._spriteTexture.getBaseSize(), i = e.getDeltaTime(), r = Math.min(this._capacity, this.sprites.length), n = t.width / this.cellWidth, o = 0, s = 0; s < r; s++) { var a = this.sprites[s]; a && a.isVisible && (a._animate(i), this._appendSpriteVertex(o++, a, 0, 0, n), this._appendSpriteVertex(o++, a, 1, 0, n), this._appendSpriteVertex(o++, a, 1, 1, n), this._appendSpriteVertex(o++, a, 0, 1, n)) } this._buffer.update(this._vertexData); var l = this._effectBase; this._scene.fogEnabled && this._scene.fogMode !== ct.Scene.FOGMODE_NONE && this.fogEnabled && (l = this._effectFog), e.enableEffect(l); var c = this._scene.getViewMatrix(); l.setTexture("diffuseSampler", this._spriteTexture), l.setMatrix("view", c), l.setMatrix("projection", this._scene.getProjectionMatrix()), l.setFloat2("textureInfos", this.cellWidth / t.width, this.cellHeight / t.height), this._scene.fogEnabled && this._scene.fogMode !== ct.Scene.FOGMODE_NONE && this.fogEnabled && (l.setFloat4("vFogInfos", this._scene.fogMode, this._scene.fogStart, this._scene.fogEnd, this._scene.fogDensity), l.setColor3("vFogColor", this._scene.fogColor)), e.bindBuffers(this._vertexBuffers, this._indexBuffer, l), e.setDepthFunctionToLessOrEqual(), l.setBool("alphaTest", !0), e.setColorWrite(!1), e.drawElementsType(ct.Material.TriangleFillMode, 0, o / 4 * 6), e.setColorWrite(!0), l.setBool("alphaTest", !1), e.setAlphaMode(ct.Engine.ALPHA_COMBINE), e.drawElementsType(ct.Material.TriangleFillMode, 0, o / 4 * 6), e.setAlphaMode(ct.Engine.ALPHA_DISABLE) } }, e.prototype.dispose = function () { this._buffer && (this._buffer.dispose(), this._buffer = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null), this._spriteTexture && (this._spriteTexture.dispose(), this._spriteTexture = null); var e = this._scene.spriteManagers.indexOf(this); this._scene.spriteManagers.splice(e, 1), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear() }, e }(), ct.SpriteManager = ht, ut = $a || ($a = {}), dt = function () { function e(e, t) { this.name = e, this.color = new ut.Color4(1, 1, 1, 1), this.width = 1, this.height = 1, this.angle = 0, this.cellIndex = 0, this.invertU = 0, this.invertV = 0, this.animations = new Array, this.isPickable = !1, this._animationStarted = !1, this._loopAnimation = !1, this._fromIndex = 0, this._toIndex = 0, this._delay = 0, this._direction = 1, this._time = 0, this.isVisible = !0, this._manager = t, this._manager.sprites.push(this), this.position = ut.Vector3.Zero() } return Object.defineProperty(e.prototype, "size", { get: function () { return this.width }, set: function (e) { this.width = e, this.height = e }, enumerable: !0, configurable: !0 }), e.prototype.playAnimation = function (e, t, i, r, n) { this._fromIndex = e, this._toIndex = t, this._loopAnimation = i, this._delay = r, this._animationStarted = !0, this._direction = e < t ? 1 : -1, this.cellIndex = e, this._time = 0, this._onAnimationEnd = n }, e.prototype.stopAnimation = function () { this._animationStarted = !1 }, e.prototype._animate = function (e) { this._animationStarted && (this._time += e, this._time > this._delay && (this._time = this._time % this._delay, this.cellIndex += this._direction, this.cellIndex > this._toIndex && (this._loopAnimation ? this.cellIndex = this._fromIndex : (this.cellIndex = this._toIndex, this._animationStarted = !1, this._onAnimationEnd && this._onAnimationEnd(), this.disposeWhenFinishedAnimating && this.dispose())))) }, e.prototype.dispose = function () { for (var e = 0; e < this._manager.sprites.length; e++)this._manager.sprites[e] == this && this._manager.sprites.splice(e, 1) }, e }(), ut.Sprite = dt, function (e) { e.Scene.prototype._internalPickSprites = function (t, i, r, n) { if (!e.PickingInfo) return null; var o = null; if (!n) { if (!this.activeCamera) return null; n = this.activeCamera } if (0 < this.spriteManagers.length) for (var s = 0; s < this.spriteManagers.length; s++) { var a = this.spriteManagers[s]; if (a.isPickable) { var l = a.intersects(t, n, i, r); if (l && l.hit && (r || null == o || !(l.distance >= o.distance)) && (o = l, r)) break } } return o || new e.PickingInfo }, e.Scene.prototype.pickSprite = function (e, t, i, r, n) { return this.createPickingRayInCameraSpaceToRef(e, t, this._tempSpritePickingRay, n), this._internalPickSprites(this._tempSpritePickingRay, i, r, n) }, e.Scene.prototype.pickSpriteWithRay = function (t, i, r, n) { if (!this._tempSpritePickingRay) return null; if (!n) { if (!this.activeCamera) return null; n = this.activeCamera } return e.Ray.TransformToRef(t, n.getViewMatrix(), this._tempSpritePickingRay), this._internalPickSprites(this._tempSpritePickingRay, i, r, n) }, e.Scene.prototype.setPointerOverSprite = function (t) { this._pointerOverSprite !== t && (this._pointerOverSprite && this._pointerOverSprite.actionManager && this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger, e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite, this)), this._pointerOverSprite = t, this._pointerOverSprite && this._pointerOverSprite.actionManager && this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger, e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite, this))) }, e.Scene.prototype.getPointerOverSprite = function () { return this._pointerOverSprite }; var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_SPRITE, this.scene = t, this.scene.spriteManagers = new Array, this.scene._tempSpritePickingRay = e.Ray ? e.Ray.Zero() : null, this.scene.onBeforeSpritesRenderingObservable = new e.Observable, this.scene.onAfterSpritesRenderingObservable = new e.Observable, this._spritePredicate = function (e) { return !!e.actionManager && e.isPickable && e.actionManager.hasPointerTriggers } } return t.prototype.register = function () { this.scene._pointerMoveStage.registerStep(e.SceneComponentConstants.STEP_POINTERMOVE_SPRITE, this, this._pointerMove), this.scene._pointerDownStage.registerStep(e.SceneComponentConstants.STEP_POINTERDOWN_SPRITE, this, this._pointerDown), this.scene._pointerUpStage.registerStep(e.SceneComponentConstants.STEP_POINTERUP_SPRITE, this, this._pointerUp) }, t.prototype.rebuild = function () { }, t.prototype.dispose = function () { this.scene.onBeforeSpritesRenderingObservable.clear(), this.scene.onAfterSpritesRenderingObservable.clear(); for (var e = this.scene.spriteManagers; e.length;)e[0].dispose() }, t.prototype._pickSpriteButKeepRay = function (e, t, i, r, n) { var o = this.scene.pickSprite(t, i, this._spritePredicate, r, n); return o && (o.ray = e ? e.ray : null), o }, t.prototype._pointerMove = function (e, t, i, r, n) { var o = this.scene; return r ? o.setPointerOverSprite(null) : (i = this._pickSpriteButKeepRay(i, e, t, !1, o.cameraToUseForPointers || void 0)) && i.hit && i.pickedSprite ? (o.setPointerOverSprite(i.pickedSprite), o._pointerOverSprite && o._pointerOverSprite.actionManager && o._pointerOverSprite.actionManager.hoverCursor ? n.style.cursor = o._pointerOverSprite.actionManager.hoverCursor : n.style.cursor = o.hoverCursor) : o.setPointerOverSprite(null), i }, t.prototype._pointerDown = function (t, i, r, n) { var o = this.scene; if (o._pickedDownSprite = null, 0 < o.spriteManagers.length && (r = o.pickSprite(t, i, this._spritePredicate, !1, o.cameraToUseForPointers || void 0)) && r.hit && r.pickedSprite && r.pickedSprite.actionManager) { switch (o._pickedDownSprite = r.pickedSprite, n.button) { case 0: r.pickedSprite.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger, e.ActionEvent.CreateNewFromSprite(r.pickedSprite, o, n)); break; case 1: r.pickedSprite.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger, e.ActionEvent.CreateNewFromSprite(r.pickedSprite, o, n)); break; case 2: r.pickedSprite.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger, e.ActionEvent.CreateNewFromSprite(r.pickedSprite, o, n)) }r.pickedSprite.actionManager && r.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickDownTrigger, e.ActionEvent.CreateNewFromSprite(r.pickedSprite, o, n)) } return r }, t.prototype._pointerUp = function (t, i, r, n) { var o = this.scene; if (0 < o.spriteManagers.length) { var s = o.pickSprite(t, i, this._spritePredicate, !1, o.cameraToUseForPointers || void 0); s && (s.hit && s.pickedSprite && s.pickedSprite.actionManager && (s.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger, e.ActionEvent.CreateNewFromSprite(s.pickedSprite, o, n)), s.pickedSprite.actionManager && (this.scene._isPointerSwiping() || s.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickTrigger, e.ActionEvent.CreateNewFromSprite(s.pickedSprite, o, n)))), o._pickedDownSprite && o._pickedDownSprite.actionManager && o._pickedDownSprite !== s.pickedSprite && o._pickedDownSprite.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger, e.ActionEvent.CreateNewFromSprite(o._pickedDownSprite, o, n))) } return r }, t }(); e.SpriteSceneComponent = t }($a || ($a = {})), function (e) { e.IntersectionInfo = function (e, t, i) { this.bu = e, this.bv = t, this.distance = i, this.faceId = 0, this.subMeshId = 0 }; var t = function () { function t() { this.hit = !1, this.distance = 0, this.pickedPoint = null, this.pickedMesh = null, this.bu = 0, this.bv = 0, this.faceId = -1, this.subMeshId = 0, this.pickedSprite = null, this.originMesh = null, this.ray = null } return t.prototype.getNormal = function (t, i) { if (void 0 === t && (t = !1), void 0 === i && (i = !0), !this.pickedMesh || !this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind)) return null; var r, n = this.pickedMesh.getIndices(); if (!n) return null; if (i) { var o = this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind), s = e.Vector3.FromArray(o, 3 * n[3 * this.faceId]), a = e.Vector3.FromArray(o, 3 * n[3 * this.faceId + 1]), l = e.Vector3.FromArray(o, 3 * n[3 * this.faceId + 2]); s = s.scale(this.bu), a = a.scale(this.bv), l = l.scale(1 - this.bu - this.bv), r = new e.Vector3(s.x + a.x + l.x, s.y + a.y + l.y, s.z + a.z + l.z) } else { var c = this.pickedMesh.getVerticesData(e.VertexBuffer.PositionKind), h = e.Vector3.FromArray(c, 3 * n[3 * this.faceId]), u = e.Vector3.FromArray(c, 3 * n[3 * this.faceId + 1]), d = e.Vector3.FromArray(c, 3 * n[3 * this.faceId + 2]), f = h.subtract(u), p = d.subtract(u); r = e.Vector3.Cross(f, p) } if (t) { var _ = this.pickedMesh.getWorldMatrix(); this.pickedMesh.nonUniformScaling && (e.Tmp.Matrix[0].copyFrom(_), (_ = e.Tmp.Matrix[0]).setTranslationFromFloats(0, 0, 0), _.invert(), _.transposeToRef(e.Tmp.Matrix[1]), _ = e.Tmp.Matrix[1]), r = e.Vector3.TransformNormal(r, _) } return r.normalize(), r }, t.prototype.getTextureCoordinates = function () { if (!this.pickedMesh || !this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind)) return null; var t = this.pickedMesh.getIndices(); if (!t) return null; var i = this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind); if (!i) return null; var r = e.Vector2.FromArray(i, 2 * t[3 * this.faceId]), n = e.Vector2.FromArray(i, 2 * t[3 * this.faceId + 1]), o = e.Vector2.FromArray(i, 2 * t[3 * this.faceId + 2]); return r = r.scale(1 - this.bu - this.bv), n = n.scale(this.bu), o = o.scale(this.bv), new e.Vector2(r.x + n.x + o.x, r.y + n.y + o.y) }, t }(); e.PickingInfo = t }($a || ($a = {})), ft = $a || ($a = {}), pt = function () { function e(e, t, i) { void 0 === i && (i = Number.MAX_VALUE), this.origin = e, this.direction = t, this.length = i } return e.prototype.intersectsBoxMinMax = function (e, t) { var i, r, n, o, s = 0, a = Number.MAX_VALUE; if (Math.abs(this.direction.x) < 1e-7) { if (this.origin.x < e.x || this.origin.x > t.x) return !1 } else if (i = 1 / this.direction.x, r = (e.x - this.origin.x) * i, (n = (t.x - this.origin.x) * i) == -1 / 0 && (n = 1 / 0), n < r && (o = r, r = n, n = o), s = Math.max(r, s), (a = Math.min(n, a)) < s) return !1; if (Math.abs(this.direction.y) < 1e-7) { if (this.origin.y < e.y || this.origin.y > t.y) return !1 } else if (i = 1 / this.direction.y, r = (e.y - this.origin.y) * i, (n = (t.y - this.origin.y) * i) == -1 / 0 && (n = 1 / 0), n < r && (o = r, r = n, n = o), s = Math.max(r, s), (a = Math.min(n, a)) < s) return !1; if (Math.abs(this.direction.z) < 1e-7) { if (this.origin.z < e.z || this.origin.z > t.z) return !1 } else if (i = 1 / this.direction.z, r = (e.z - this.origin.z) * i, (n = (t.z - this.origin.z) * i) == -1 / 0 && (n = 1 / 0), n < r && (o = r, r = n, n = o), s = Math.max(r, s), (a = Math.min(n, a)) < s) return !1; return !0 }, e.prototype.intersectsBox = function (e) { return this.intersectsBoxMinMax(e.minimum, e.maximum) }, e.prototype.intersectsSphere = function (e) { var t = e.center.x - this.origin.x, i = e.center.y - this.origin.y, r = e.center.z - this.origin.z, n = t * t + i * i + r * r, o = e.radius * e.radius; if (n <= o) return !0; var s = t * this.direction.x + i * this.direction.y + r * this.direction.z; return !(s < 0) && n - s * s <= o }, e.prototype.intersectsTriangle = function (e, t, i) { this._edge1 || (this._edge1 = ft.Vector3.Zero(), this._edge2 = ft.Vector3.Zero(), this._pvec = ft.Vector3.Zero(), this._tvec = ft.Vector3.Zero(), this._qvec = ft.Vector3.Zero()), t.subtractToRef(e, this._edge1), i.subtractToRef(e, this._edge2), ft.Vector3.CrossToRef(this.direction, this._edge2, this._pvec); var r = ft.Vector3.Dot(this._edge1, this._pvec); if (0 === r) return null; var n = 1 / r; this.origin.subtractToRef(e, this._tvec); var o = ft.Vector3.Dot(this._tvec, this._pvec) * n; if (o < 0 || 1 < o) return null; ft.Vector3.CrossToRef(this._tvec, this._edge1, this._qvec); var s = ft.Vector3.Dot(this.direction, this._qvec) * n; if (s < 0 || 1 < o + s) return null; var a = ft.Vector3.Dot(this._edge2, this._qvec) * n; return a > this.length ? null : new ft.IntersectionInfo(o, s, a) }, e.prototype.intersectsPlane = function (e) { var t, i = ft.Vector3.Dot(e.normal, this.direction); if (Math.abs(i) < 9.99999997475243e-7) return null; var r = ft.Vector3.Dot(e.normal, this.origin); return (t = (-e.d - r) / i) < 0 ? t < -9.99999997475243e-7 ? null : 0 : t }, e.prototype.intersectsMesh = function (t, i) { var r = ft.Tmp.Matrix[0]; return t.getWorldMatrix().invertToRef(r), this._tmpRay ? e.TransformToRef(this, r, this._tmpRay) : this._tmpRay = e.Transform(this, r), t.intersects(this._tmpRay, i) }, e.prototype.intersectsMeshes = function (e, t, i) { i ? i.length = 0 : i = []; for (var r = 0; r < e.length; r++) { var n = this.intersectsMesh(e[r], t); n.hit && i.push(n) } return i.sort(this._comparePickingInfo), i }, e.prototype._comparePickingInfo = function (e, t) { return e.distance < t.distance ? -1 : e.distance > t.distance ? 1 : 0 }, e.prototype.intersectionSegment = function (t, i, r) { var n, o, s, a, l = this.origin.add(this.direction.multiplyByFloats(e.rayl, e.rayl, e.rayl)), c = i.subtract(t), h = l.subtract(this.origin), u = t.subtract(this.origin), d = ft.Vector3.Dot(c, c), f = ft.Vector3.Dot(c, h), p = ft.Vector3.Dot(h, h), _ = ft.Vector3.Dot(c, u), m = ft.Vector3.Dot(h, u), g = d * p - f * f, v = g, y = g; g < e.smallnum ? (o = 0, v = 1, a = m, y = p) : (a = d * m - f * _, (o = f * m - p * _) < 0 ? (o = 0, a = m, y = p) : v < o && (o = v, a = m + f, y = p)), a < 0 ? -_ < (a = 0) ? o = 0 : d < -_ ? o = v : (o = -_, v = d) : y < a && (a = y, -_ + f < 0 ? o = 0 : d < -_ + f ? o = v : (o = -_ + f, v = d)), n = Math.abs(o) < e.smallnum ? 0 : o / v, s = Math.abs(a) < e.smallnum ? 0 : a / y; var b = h.multiplyByFloats(s, s, s), T = u.add(c.multiplyByFloats(n, n, n)).subtract(b); return 0 < s && s <= this.length && T.lengthSquared() < r * r ? b.length() : -1 }, e.prototype.update = function (e, t, i, r, n, o, s) { return ft.Vector3.UnprojectFloatsToRef(e, t, 0, i, r, n, o, s, this.origin), ft.Vector3.UnprojectFloatsToRef(e, t, 1, i, r, n, o, s, ft.Tmp.Vector3[0]), ft.Tmp.Vector3[0].subtractToRef(this.origin, this.direction), this.direction.normalize(), this }, e.Zero = function () { return new e(ft.Vector3.Zero(), ft.Vector3.Zero()) }, e.CreateNew = function (t, i, r, n, o, s, a) { return e.Zero().update(t, i, r, n, o, s, a) }, e.CreateNewFromTo = function (t, i, r) { void 0 === r && (r = ft.Matrix.Identity()); var n = i.subtract(t), o = Math.sqrt(n.x * n.x + n.y * n.y + n.z * n.z); return n.normalize(), e.Transform(new e(t, n, o), r) }, e.Transform = function (t, i) { var r = new e(new ft.Vector3(0, 0, 0), new ft.Vector3(0, 0, 0)); return e.TransformToRef(t, i, r), r }, e.TransformToRef = function (e, t, i) { ft.Vector3.TransformCoordinatesToRef(e.origin, t, i.origin), ft.Vector3.TransformNormalToRef(e.direction, t, i.direction), i.length = e.length; var r = i.direction, n = r.length(); if (0 !== n && 1 !== n) { var o = 1 / n; r.x *= o, r.y *= o, r.z *= o, i.length *= n } }, e.smallnum = 1e-8, e.rayl = 1e9, e }(), ft.Ray = pt, _t = $a || ($a = {}), mt = { root: 0, found: !1 }, gt = function (e, t, i, r) { mt.root = 0, mt.found = !1; var n = t * t - 4 * e * i; if (n < 0) return mt; var o = Math.sqrt(n), s = (-t - o) / (2 * e), a = (-t + o) / (2 * e); if (a < s) { var l = a; a = s, s = l } return 0 < s && s < r ? (mt.root = s, mt.found = !0) : 0 < a && a < r && (mt.root = a, mt.found = !0), mt }, vt = function () { function e() { this._collisionPoint = _t.Vector3.Zero(), this._planeIntersectionPoint = _t.Vector3.Zero(), this._tempVector = _t.Vector3.Zero(), this._tempVector2 = _t.Vector3.Zero(), this._tempVector3 = _t.Vector3.Zero(), this._tempVector4 = _t.Vector3.Zero(), this._edge = _t.Vector3.Zero(), this._baseToVertex = _t.Vector3.Zero(), this._destinationPoint = _t.Vector3.Zero(), this._slidePlaneNormal = _t.Vector3.Zero(), this._displacementVector = _t.Vector3.Zero(), this._radius = _t.Vector3.One(), this._retry = 0, this._basePointWorld = _t.Vector3.Zero(), this._velocityWorld = _t.Vector3.Zero(), this._normalizedVelocity = _t.Vector3.Zero(), this._collisionMask = -1 } return Object.defineProperty(e.prototype, "collisionMask", { get: function () { return this._collisionMask }, set: function (e) { this._collisionMask = isNaN(e) ? -1 : e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "slidePlaneNormal", { get: function () { return this._slidePlaneNormal }, enumerable: !0, configurable: !0 }), e.prototype._initialize = function (e, t, i) { this._velocity = t, _t.Vector3.NormalizeToRef(t, this._normalizedVelocity), (this._basePoint = e).multiplyToRef(this._radius, this._basePointWorld), t.multiplyToRef(this._radius, this._velocityWorld), this._velocityWorldLength = this._velocityWorld.length(), this._epsilon = i, this.collisionFound = !1 }, e.prototype._checkPointInTriangle = function (e, t, i, r, n) { t.subtractToRef(e, this._tempVector), i.subtractToRef(e, this._tempVector2), _t.Vector3.CrossToRef(this._tempVector, this._tempVector2, this._tempVector4); var o = _t.Vector3.Dot(this._tempVector4, n); return !(o < 0) && (r.subtractToRef(e, this._tempVector3), _t.Vector3.CrossToRef(this._tempVector2, this._tempVector3, this._tempVector4), !((o = _t.Vector3.Dot(this._tempVector4, n)) < 0) && (_t.Vector3.CrossToRef(this._tempVector3, this._tempVector, this._tempVector4), 0 <= _t.Vector3.Dot(this._tempVector4, n))) }, e.prototype._canDoCollision = function (e, t, i, r) { var n, o, s, a, l = _t.Vector3.Distance(this._basePointWorld, e), c = Math.max(this._radius.x, this._radius.y, this._radius.z); return !(l > this._velocityWorldLength + c + t || (n = i, o = r, s = this._basePointWorld, a = this._velocityWorldLength + c, n.x > s.x + a || s.x - a > o.x || n.y > s.y + a || s.y - a > o.y || n.z > s.z + a || s.z - a > o.z)) }, e.prototype._testTriangle = function (e, t, i, r, n, o) { var s, a = !1; t || (t = []), t[e] || (t[e] = new _t.Plane(0, 0, 0, 0), t[e].copyFromPoints(i, r, n)); var l = t[e]; if (o || l.isFrontFacingTo(this._normalizedVelocity, 0)) { var c = l.signedDistanceTo(this._basePoint), h = _t.Vector3.Dot(l.normal, this._velocity); if (0 == h) { if (1 <= Math.abs(c)) return; a = !0, s = 0 } else { var u = (1 - c) / h; if (u < (s = (-1 - c) / h)) { var d = u; u = s, s = d } if (1 < s || u < 0) return; s < 0 && (s = 0), 1 < s && (s = 1) } this._collisionPoint.copyFromFloats(0, 0, 0); var f = !1, p = 1; if (a || (this._basePoint.subtractToRef(l.normal, this._planeIntersectionPoint), this._velocity.scaleToRef(s, this._tempVector), this._planeIntersectionPoint.addInPlace(this._tempVector), this._checkPointInTriangle(this._planeIntersectionPoint, i, r, n, l.normal) && (f = !0, p = s, this._collisionPoint.copyFrom(this._planeIntersectionPoint))), !f) { var _ = this._velocity.lengthSquared(), m = _; this._basePoint.subtractToRef(i, this._tempVector); var g = 2 * _t.Vector3.Dot(this._velocity, this._tempVector), v = this._tempVector.lengthSquared() - 1, y = gt(m, g, v, p); y.found && (p = y.root, f = !0, this._collisionPoint.copyFrom(i)), this._basePoint.subtractToRef(r, this._tempVector), g = 2 * _t.Vector3.Dot(this._velocity, this._tempVector), v = this._tempVector.lengthSquared() - 1, (y = gt(m, g, v, p)).found && (p = y.root, f = !0, this._collisionPoint.copyFrom(r)), this._basePoint.subtractToRef(n, this._tempVector), g = 2 * _t.Vector3.Dot(this._velocity, this._tempVector), v = this._tempVector.lengthSquared() - 1, (y = gt(m, g, v, p)).found && (p = y.root, f = !0, this._collisionPoint.copyFrom(n)), r.subtractToRef(i, this._edge), i.subtractToRef(this._basePoint, this._baseToVertex); var b = this._edge.lengthSquared(), T = _t.Vector3.Dot(this._edge, this._velocity), E = _t.Vector3.Dot(this._edge, this._baseToVertex); if (m = b * -_ + T * T, g = b * (2 * _t.Vector3.Dot(this._velocity, this._baseToVertex)) - 2 * T * E, v = b * (1 - this._baseToVertex.lengthSquared()) + E * E, (y = gt(m, g, v, p)).found) { var x = (T * y.root - E) / b; 0 <= x && x <= 1 && (p = y.root, f = !0, this._edge.scaleInPlace(x), i.addToRef(this._edge, this._collisionPoint)) } n.subtractToRef(r, this._edge), r.subtractToRef(this._basePoint, this._baseToVertex), b = this._edge.lengthSquared(), T = _t.Vector3.Dot(this._edge, this._velocity), E = _t.Vector3.Dot(this._edge, this._baseToVertex), m = b * -_ + T * T, g = b * (2 * _t.Vector3.Dot(this._velocity, this._baseToVertex)) - 2 * T * E, v = b * (1 - this._baseToVertex.lengthSquared()) + E * E, (y = gt(m, g, v, p)).found && 0 <= (x = (T * y.root - E) / b) && x <= 1 && (p = y.root, f = !0, this._edge.scaleInPlace(x), r.addToRef(this._edge, this._collisionPoint)), i.subtractToRef(n, this._edge), n.subtractToRef(this._basePoint, this._baseToVertex), b = this._edge.lengthSquared(), T = _t.Vector3.Dot(this._edge, this._velocity), E = _t.Vector3.Dot(this._edge, this._baseToVertex), m = b * -_ + T * T, g = b * (2 * _t.Vector3.Dot(this._velocity, this._baseToVertex)) - 2 * T * E, v = b * (1 - this._baseToVertex.lengthSquared()) + E * E, (y = gt(m, g, v, p)).found && 0 <= (x = (T * y.root - E) / b) && x <= 1 && (p = y.root, f = !0, this._edge.scaleInPlace(x), n.addToRef(this._edge, this._collisionPoint)) } if (f) { var P = p * this._velocity.length(); (!this.collisionFound || P < this._nearestDistance) && (this.intersectionPoint ? this.intersectionPoint.copyFrom(this._collisionPoint) : this.intersectionPoint = this._collisionPoint.clone(), this._nearestDistance = P, this.collisionFound = !0) } } }, e.prototype._collide = function (e, t, i, r, n, o, s) { for (var a = r; a < n; a += 3) { var l = t[i[a] - o], c = t[i[a + 1] - o], h = t[i[a + 2] - o]; this._testTriangle(a, e, h, c, l, s) } }, e.prototype._getResponse = function (e, t) { e.addToRef(t, this._destinationPoint), t.scaleInPlace(this._nearestDistance / t.length()), this._basePoint.addToRef(t, e), e.subtractToRef(this.intersectionPoint, this._slidePlaneNormal), this._slidePlaneNormal.normalize(), this._slidePlaneNormal.scaleToRef(this._epsilon, this._displacementVector), e.addInPlace(this._displacementVector), this.intersectionPoint.addInPlace(this._displacementVector), this._slidePlaneNormal.scaleInPlace(_t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint, this._slidePlaneNormal, this._destinationPoint)), this._destinationPoint.subtractInPlace(this._slidePlaneNormal), this._destinationPoint.subtractToRef(this.intersectionPoint, t) }, e }(), _t.Collider = vt, function (e) { var t, i, r, n; e.CollisionWorker = "", (i = t = e.WorkerTaskType || (e.WorkerTaskType = {}))[i.INIT = 0] = "INIT", i[i.UPDATE = 1] = "UPDATE", i[i.COLLIDE = 2] = "COLLIDE", (n = r = e.WorkerReplyType || (e.WorkerReplyType = {}))[n.SUCCESS = 0] = "SUCCESS", n[n.UNKNOWN_ERROR = 1] = "UNKNOWN_ERROR"; var o = function () { function i() { var n = this; this._scaledPosition = e.Vector3.Zero(), this._scaledVelocity = e.Vector3.Zero(), this.onMeshUpdated = function (e) { n._addUpdateMeshesList[e.uniqueId] = i.SerializeMesh(e) }, this.onGeometryUpdated = function (e) { n._addUpdateGeometriesList[e.id] = i.SerializeGeometry(e) }, this._afterRender = function () { if (n._init && !(0 == n._toRemoveGeometryArray.length && 0 == n._toRemoveMeshesArray.length && 0 == Object.keys(n._addUpdateGeometriesList).length && 0 == Object.keys(n._addUpdateMeshesList).length || 4 < n._runningUpdated)) { ++n._runningUpdated; var e = { updatedMeshes: n._addUpdateMeshesList, updatedGeometries: n._addUpdateGeometriesList, removedGeometries: n._toRemoveGeometryArray, removedMeshes: n._toRemoveMeshesArray }, i = { payload: e, taskType: t.UPDATE }, r = []; for (var o in e.updatedGeometries) e.updatedGeometries.hasOwnProperty(o) && (r.push(i.payload.updatedGeometries[o].indices.buffer), r.push(i.payload.updatedGeometries[o].normals.buffer), r.push(i.payload.updatedGeometries[o].positions.buffer)); n._worker.postMessage(i, r), n._addUpdateMeshesList = {}, n._addUpdateGeometriesList = {}, n._toRemoveGeometryArray = [], n._toRemoveMeshesArray = [] } }, this._onMessageFromWorker = function (i) { var o = i.data; if (o.error == r.SUCCESS) switch (o.taskType) { case t.INIT: n._init = !0, n._scene.meshes.forEach(function (e) { n.onMeshAdded(e) }), n._scene.getGeometries().forEach(function (e) { n.onGeometryAdded(e) }); break; case t.UPDATE: n._runningUpdated--; break; case t.COLLIDE: var s = o.payload; if (!n._collisionsCallbackArray[s.collisionId]) return; var a = n._collisionsCallbackArray[s.collisionId]; if (a) { var l = n._scene.getMeshByUniqueID(s.collidedMeshUniqueId); l && a(s.collisionId, e.Vector3.FromArray(s.newPosition), l) } n._collisionsCallbackArray[s.collisionId] = null } else e.Tools.Warn("error returned from worker!") }, this._collisionsCallbackArray = [], this._init = !1, this._runningUpdated = 0, this._addUpdateMeshesList = {}, this._addUpdateGeometriesList = {}, this._toRemoveGeometryArray = [], this._toRemoveMeshesArray = [] } return i.prototype.getNewPosition = function (e, i, r, n, o, s, a) { if (this._init && !this._collisionsCallbackArray[a] && !this._collisionsCallbackArray[a + 1e5]) { e.divideToRef(r._radius, this._scaledPosition), i.divideToRef(r._radius, this._scaledVelocity), this._collisionsCallbackArray[a] = s; var l = { payload: { collider: { position: this._scaledPosition.asArray(), velocity: this._scaledVelocity.asArray(), radius: r._radius.asArray() }, collisionId: a, excludedMeshUniqueId: o ? o.uniqueId : null, maximumRetry: n }, taskType: t.COLLIDE }; this._worker.postMessage(l) } }, i.prototype.init = function (i) { this._scene = i, this._scene.registerAfterRender(this._afterRender); var r = e.WorkerIncluded ? e.Engine.CodeRepository + "Collisions/babylon.collisionWorker.js" : URL.createObjectURL(new Blob([e.CollisionWorker], { type: "application/javascript" })); this._worker = new Worker(r), this._worker.onmessage = this._onMessageFromWorker; var n = { payload: {}, taskType: t.INIT }; this._worker.postMessage(n) }, i.prototype.destroy = function () { this._scene.unregisterAfterRender(this._afterRender), this._worker.terminate() }, i.prototype.onMeshAdded = function (e) { e.registerAfterWorldMatrixUpdate(this.onMeshUpdated), this.onMeshUpdated(e) }, i.prototype.onMeshRemoved = function (e) { this._toRemoveMeshesArray.push(e.uniqueId) }, i.prototype.onGeometryAdded = function (e) { e.onGeometryUpdated = this.onGeometryUpdated, this.onGeometryUpdated(e) }, i.prototype.onGeometryDeleted = function (e) { this._toRemoveGeometryArray.push(e.id) }, i.SerializeMesh = function (t) { var i = []; t.subMeshes && (i = t.subMeshes.map(function (e, t) { var i = e.getBoundingInfo(); return { position: t, verticesStart: e.verticesStart, verticesCount: e.verticesCount, indexStart: e.indexStart, indexCount: e.indexCount, hasMaterial: !!e.getMaterial(), sphereCenter: i.boundingSphere.centerWorld.asArray(), sphereRadius: i.boundingSphere.radiusWorld, boxMinimum: i.boundingBox.minimumWorld.asArray(), boxMaximum: i.boundingBox.maximumWorld.asArray() } })); var r = null; if (t instanceof e.Mesh) r = (n = t.geometry) ? n.id : null; else if (t instanceof e.InstancedMesh) { var n; r = (n = t.sourceMesh && t.sourceMesh.geometry) ? n.id : null } var o = t.getBoundingInfo(); return { uniqueId: t.uniqueId, id: t.id, name: t.name, geometryId: r, sphereCenter: o.boundingSphere.centerWorld.asArray(), sphereRadius: o.boundingSphere.radiusWorld, boxMinimum: o.boundingBox.minimumWorld.asArray(), boxMaximum: o.boundingBox.maximumWorld.asArray(), worldMatrixFromCache: t.worldMatrixFromCache.asArray(), subMeshes: i, checkCollisions: t.checkCollisions } }, i.SerializeGeometry = function (t) { return { id: t.id, positions: new Float32Array(t.getVerticesData(e.VertexBuffer.PositionKind) || []), normals: new Float32Array(t.getVerticesData(e.VertexBuffer.NormalKind) || []), indices: new Uint32Array(t.getIndices() || []) } }, i }(); e.CollisionCoordinatorWorker = o; var s = function () { function t() { this._scaledPosition = e.Vector3.Zero(), this._scaledVelocity = e.Vector3.Zero(), this._finalPosition = e.Vector3.Zero() } return t.prototype.getNewPosition = function (e, t, i, r, n, o, s) { e.divideToRef(i._radius, this._scaledPosition), t.divideToRef(i._radius, this._scaledVelocity), i.collidedMesh = null, i._retry = 0, i._initialVelocity = this._scaledVelocity, i._initialPosition = this._scaledPosition, this._collideWithWorld(this._scaledPosition, this._scaledVelocity, i, r, this._finalPosition, n), this._finalPosition.multiplyInPlace(i._radius), o(s, this._finalPosition, i.collidedMesh) }, t.prototype.init = function (e) { this._scene = e }, t.prototype.destroy = function () { }, t.prototype.onMeshAdded = function (e) { }, t.prototype.onMeshUpdated = function (e) { }, t.prototype.onMeshRemoved = function (e) { }, t.prototype.onGeometryAdded = function (e) { }, t.prototype.onGeometryUpdated = function (e) { }, t.prototype.onGeometryDeleted = function (e) { }, t.prototype._collideWithWorld = function (t, i, r, n, o, s) { void 0 === s && (s = null); var a = 10 * e.Engine.CollisionsEpsilon; if (r._retry >= n) o.copyFrom(t); else { var l = s ? s.collisionMask : r.collisionMask; r._initialize(t, i, a); for (var c = 0; c < this._scene.meshes.length; c++) { var h = this._scene.meshes[c]; h.isEnabled() && h.checkCollisions && h.subMeshes && h !== s && 0 != (l & h.collisionGroup) && h._checkCollision(r) } r.collisionFound ? (0 === i.x && 0 === i.y && 0 === i.z || r._getResponse(t, i), i.length() <= a ? o.copyFrom(t) : (r._retry++ , this._collideWithWorld(t, i, r, n, o, s))) : t.addToRef(i, o) } }, t }(); e.CollisionCoordinatorLegacy = s }($a || ($a = {})), yt = $a || ($a = {}), bt = function () { function e(t) { this.particleSystem = t, this.position = yt.Vector3.Zero(), this.direction = yt.Vector3.Zero(), this.color = new yt.Color4(0, 0, 0, 0), this.colorStep = new yt.Color4(0, 0, 0, 0), this.lifeTime = 1, this.age = 0, this.size = 0, this.scale = new yt.Vector2(1, 1), this.angle = 0, this.angularSpeed = 0, this.cellIndex = 0, this._attachedSubEmitters = null, this._currentColor1 = new yt.Color4(0, 0, 0, 0), this._currentColor2 = new yt.Color4(0, 0, 0, 0), this._currentSize1 = 0, this._currentSize2 = 0, this._currentAngularSpeed1 = 0, this._currentAngularSpeed2 = 0, this._currentVelocity1 = 0, this._currentVelocity2 = 0, this._currentLimitVelocity1 = 0, this._currentLimitVelocity2 = 0, this._currentDrag1 = 0, this._currentDrag2 = 0, this.id = e._Count++ , this.particleSystem.isAnimationSheetEnabled && this.updateCellInfoFromSystem() } return e.prototype.updateCellInfoFromSystem = function () { this.cellIndex = this.particleSystem.startSpriteCellID }, e.prototype.updateCellIndex = function () { var e = this.age, t = this.particleSystem.spriteCellChangeSpeed; this.particleSystem.spriteRandomStartCell && (void 0 === this._randomCellOffset && (this._randomCellOffset = Math.random() * this.lifeTime), 0 === t ? (t = 1, e = this._randomCellOffset) : e += this._randomCellOffset); var i = this._initialEndSpriteCellID - this._initialStartSpriteCellID, r = yt.Scalar.Clamp(e * t % this.lifeTime / this.lifeTime); this.cellIndex = this._initialStartSpriteCellID + r * i | 0 }, e.prototype._inheritParticleInfoToSubEmitter = function (e) { if (e.particleSystem.emitter.position) { var t = e.particleSystem.emitter; t.position.copyFrom(this.position), e.inheritDirection && (t.position.subtractToRef(this.direction, yt.Tmp.Vector3[0]), t.lookAt(yt.Tmp.Vector3[0], 0, Math.PI / 2)) } else e.particleSystem.emitter.copyFrom(this.position); this.direction.scaleToRef(e.inheritedVelocityAmount / 2, yt.Tmp.Vector3[0]), e.particleSystem._inheritedVelocityOffset.copyFrom(yt.Tmp.Vector3[0]) }, e.prototype._inheritParticleInfoToSubEmitters = function () { var e = this; this._attachedSubEmitters && 0 < this._attachedSubEmitters.length && this._attachedSubEmitters.forEach(function (t) { e._inheritParticleInfoToSubEmitter(t) }) }, e.prototype._reset = function () { this.age = 0, this._currentColorGradient = null, this._currentSizeGradient = null, this._currentAngularSpeedGradient = null, this._currentVelocityGradient = null, this._currentLimitVelocityGradient = null, this._currentDragGradient = null, this.cellIndex = this.particleSystem.startSpriteCellID, this._randomCellOffset = void 0 }, e.prototype.copyTo = function (e) { e.position.copyFrom(this.position), this._initialDirection ? e._initialDirection ? e._initialDirection.copyFrom(this._initialDirection) : e._initialDirection = this._initialDirection.clone() : e._initialDirection = null, e.direction.copyFrom(this.direction), e.color.copyFrom(this.color), e.colorStep.copyFrom(this.colorStep), e.lifeTime = this.lifeTime, e.age = this.age, e._randomCellOffset = this._randomCellOffset, e.size = this.size, e.scale.copyFrom(this.scale), e.angle = this.angle, e.angularSpeed = this.angularSpeed, e.particleSystem = this.particleSystem, e.cellIndex = this.cellIndex, e.id = this.id, e._attachedSubEmitters = this._attachedSubEmitters, this._currentColorGradient && (e._currentColorGradient = this._currentColorGradient, e._currentColor1.copyFrom(this._currentColor1), e._currentColor2.copyFrom(this._currentColor2)), this._currentSizeGradient && (e._currentSizeGradient = this._currentSizeGradient, e._currentSize1 = this._currentSize1, e._currentSize2 = this._currentSize2), this._currentAngularSpeedGradient && (e._currentAngularSpeedGradient = this._currentAngularSpeedGradient, e._currentAngularSpeed1 = this._currentAngularSpeed1, e._currentAngularSpeed2 = this._currentAngularSpeed2), this._currentVelocityGradient && (e._currentVelocityGradient = this._currentVelocityGradient, e._currentVelocity1 = this._currentVelocity1, e._currentVelocity2 = this._currentVelocity2), this._currentLimitVelocityGradient && (e._currentLimitVelocityGradient = this._currentLimitVelocityGradient, e._currentLimitVelocity1 = this._currentLimitVelocity1, e._currentLimitVelocity2 = this._currentLimitVelocity2), this._currentDragGradient && (e._currentDragGradient = this._currentDragGradient, e._currentDrag1 = this._currentDrag1, e._currentDrag2 = this._currentDrag2), this.particleSystem.isAnimationSheetEnabled && (e._initialStartSpriteCellID = this._initialStartSpriteCellID, e._initialEndSpriteCellID = this._initialEndSpriteCellID), this.particleSystem.useRampGradients && e.remapData.copyFrom(this.remapData), this._randomNoiseCoordinates1 && (e._randomNoiseCoordinates1 ? (e._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1), e._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)) : (e._randomNoiseCoordinates1 = this._randomNoiseCoordinates1.clone(), e._randomNoiseCoordinates2 = this._randomNoiseCoordinates2.clone())) }, e._Count = 0, e }(), yt.Particle = bt, Tt = $a || ($a = {}), Et = function () { function e(e) { this.animations = [], this.renderingGroupId = 0, this.emitter = null, this.emitRate = 10, this.manualEmitCount = -1, this.updateSpeed = .01, this.targetStopDuration = 0, this.disposeOnStop = !1, this.minEmitPower = 1, this.maxEmitPower = 1, this.minLifeTime = 1, this.maxLifeTime = 1, this.minSize = 1, this.maxSize = 1, this.minScaleX = 1, this.maxScaleX = 1, this.minScaleY = 1, this.maxScaleY = 1, this.minInitialRotation = 0, this.maxInitialRotation = 0, this.minAngularSpeed = 0, this.maxAngularSpeed = 0, this.layerMask = 268435455, this.customShader = null, this.preventAutoStart = !1, this.noiseStrength = new Tt.Vector3(10, 10, 10), this.onAnimationEnd = null, this.blendMode = Tt.ParticleSystem.BLENDMODE_ONEONE, this.forceDepthWrite = !1, this.preWarmCycles = 0, this.preWarmStepOffset = 1, this.spriteCellChangeSpeed = 1, this.startSpriteCellID = 0, this.endSpriteCellID = 0, this.spriteCellWidth = 0, this.spriteCellHeight = 0, this.spriteRandomStartCell = !1, this.translationPivot = new Tt.Vector2(0, 0), this.beginAnimationOnStart = !1, this.beginAnimationFrom = 0, this.beginAnimationTo = 60, this.beginAnimationLoop = !1, this.gravity = Tt.Vector3.Zero(), this._colorGradients = null, this._sizeGradients = null, this._lifeTimeGradients = null, this._angularSpeedGradients = null, this._velocityGradients = null, this._limitVelocityGradients = null, this._dragGradients = null, this._emitRateGradients = null, this._startSizeGradients = null, this._rampGradients = null, this._colorRemapGradients = null, this._alphaRemapGradients = null, this.startDelay = 0, this.limitVelocityDamping = .4, this.color1 = new Tt.Color4(1, 1, 1, 1), this.color2 = new Tt.Color4(1, 1, 1, 1), this.colorDead = new Tt.Color4(0, 0, 0, 1), this.textureMask = new Tt.Color4(1, 1, 1, 1), this._isSubEmitter = !1, this.billboardMode = Tt.ParticleSystem.BILLBOARDMODE_ALL, this._isBillboardBased = !0, this._imageProcessingConfigurationDefines = new Tt.ImageProcessingConfigurationDefines, this.id = e, this.name = e } return Object.defineProperty(e.prototype, "isAnimationSheetEnabled", { get: function () { return this._isAnimationSheetEnabled }, set: function (e) { this._isAnimationSheetEnabled != e && (this._isAnimationSheetEnabled = e, this._reset()) }, enumerable: !0, configurable: !0 }), e.prototype.getScene = function () { return this._scene }, e.prototype._hasTargetStopDurationDependantGradient = function () { return this._startSizeGradients && 0 < this._startSizeGradients.length || this._emitRateGradients && 0 < this._emitRateGradients.length || this._lifeTimeGradients && 0 < this._lifeTimeGradients.length }, e.prototype.getDragGradients = function () { return this._dragGradients }, e.prototype.getLimitVelocityGradients = function () { return this._limitVelocityGradients }, e.prototype.getColorGradients = function () { return this._colorGradients }, e.prototype.getSizeGradients = function () { return this._sizeGradients }, e.prototype.getColorRemapGradients = function () { return this._colorRemapGradients }, e.prototype.getAlphaRemapGradients = function () { return this._alphaRemapGradients }, e.prototype.getLifeTimeGradients = function () { return this._lifeTimeGradients }, e.prototype.getAngularSpeedGradients = function () { return this._angularSpeedGradients }, e.prototype.getVelocityGradients = function () { return this._velocityGradients }, e.prototype.getStartSizeGradients = function () { return this._startSizeGradients }, e.prototype.getEmitRateGradients = function () { return this._emitRateGradients }, Object.defineProperty(e.prototype, "direction1", { get: function () { return this.particleEmitterType.direction1 ? this.particleEmitterType.direction1 : Tt.Vector3.Zero() }, set: function (e) { this.particleEmitterType.direction1 && (this.particleEmitterType.direction1 = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "direction2", { get: function () { return this.particleEmitterType.direction2 ? this.particleEmitterType.direction2 : Tt.Vector3.Zero() }, set: function (e) { this.particleEmitterType.direction2 && (this.particleEmitterType.direction2 = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "minEmitBox", { get: function () { return this.particleEmitterType.minEmitBox ? this.particleEmitterType.minEmitBox : Tt.Vector3.Zero() }, set: function (e) { this.particleEmitterType.minEmitBox && (this.particleEmitterType.minEmitBox = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "maxEmitBox", { get: function () { return this.particleEmitterType.maxEmitBox ? this.particleEmitterType.maxEmitBox : Tt.Vector3.Zero() }, set: function (e) { this.particleEmitterType.maxEmitBox && (this.particleEmitterType.maxEmitBox = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "isBillboardBased", { get: function () { return this._isBillboardBased }, set: function (e) { this._isBillboardBased !== e && (this._isBillboardBased = e, this._reset()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "imageProcessingConfiguration", { get: function () { return this._imageProcessingConfiguration }, set: function (e) { this._attachImageProcessingConfiguration(e) }, enumerable: !0, configurable: !0 }), e.prototype._attachImageProcessingConfiguration = function (e) { e !== this._imageProcessingConfiguration && (this._imageProcessingConfiguration = e || this._scene.imageProcessingConfiguration) }, e.prototype._reset = function () { }, e.prototype._removeGradientAndTexture = function (e, t, i) { if (!t) return this; for (var r = 0, n = 0, o = t; n < o.length; n++) { if (o[n].gradient === e) { t.splice(r, 1); break } r++ } return i && i.dispose(), this }, e.prototype.createPointEmitter = function (e, t) { var i = new Tt.PointParticleEmitter; return i.direction1 = e, i.direction2 = t, this.particleEmitterType = i }, e.prototype.createHemisphericEmitter = function (e, t) { void 0 === e && (e = 1), void 0 === t && (t = 1); var i = new Tt.HemisphericParticleEmitter(e, t); return this.particleEmitterType = i }, e.prototype.createSphereEmitter = function (e, t) { void 0 === e && (e = 1), void 0 === t && (t = 1); var i = new Tt.SphereParticleEmitter(e, t); return this.particleEmitterType = i }, e.prototype.createDirectedSphereEmitter = function (e, t, i) { void 0 === e && (e = 1), void 0 === t && (t = new Tt.Vector3(0, 1, 0)), void 0 === i && (i = new Tt.Vector3(0, 1, 0)); var r = new Tt.SphereDirectedParticleEmitter(e, t, i); return this.particleEmitterType = r }, e.prototype.createCylinderEmitter = function (e, t, i, r) { void 0 === e && (e = 1), void 0 === t && (t = 1), void 0 === i && (i = 1), void 0 === r && (r = 0); var n = new Tt.CylinderParticleEmitter(e, t, i, r); return this.particleEmitterType = n }, e.prototype.createDirectedCylinderEmitter = function (e, t, i, r, n) { void 0 === e && (e = 1), void 0 === t && (t = 1), void 0 === i && (i = 1), void 0 === r && (r = new Tt.Vector3(0, 1, 0)), void 0 === n && (n = new Tt.Vector3(0, 1, 0)); var o = new Tt.CylinderDirectedParticleEmitter(e, t, i, r, n); return this.particleEmitterType = o }, e.prototype.createConeEmitter = function (e, t) { void 0 === e && (e = 1), void 0 === t && (t = Math.PI / 4); var i = new Tt.ConeParticleEmitter(e, t); return this.particleEmitterType = i }, e.prototype.createBoxEmitter = function (e, t, i, r) { var n = new Tt.BoxParticleEmitter; return this.particleEmitterType = n, this.direction1 = e, this.direction2 = t, this.minEmitBox = i, this.maxEmitBox = r, n }, e.BLENDMODE_ONEONE = 0, e.BLENDMODE_STANDARD = 1, e.BLENDMODE_ADD = 2, e.BLENDMODE_MULTIPLY = 3, e.BLENDMODE_MULTIPLYADD = 4, e }(), Tt.BaseParticleSystem = Et, Pt = function (e) { function t(t, i, r, n, o, s) { void 0 === n && (n = null), void 0 === o && (o = !1), void 0 === s && (s = .01); var a = e.call(this, t) || this; return a._inheritedVelocityOffset = new xt.Vector3, a.onDisposeObservable = new xt.Observable, a._particles = new Array, a._stockParticles = new Array, a._newPartsExcess = 0, a._vertexBuffers = {}, a._scaledColorStep = new xt.Color4(0, 0, 0, 0), a._colorDiff = new xt.Color4(0, 0, 0, 0), a._scaledDirection = xt.Vector3.Zero(), a._scaledGravity = xt.Vector3.Zero(), a._currentRenderId = -1, a._useInstancing = !1, a._started = !1, a._stopped = !1, a._actualFrame = 0, a._currentEmitRate1 = 0, a._currentEmitRate2 = 0, a._currentStartSize1 = 0, a._currentStartSize2 = 0, a._rawTextureWidth = 256, a._useRampGradients = !1, a._disposeEmitterOnDispose = !1, a.recycleParticle = function (e) { var t = a._particles.pop(); t !== e && t.copyTo(e), a._stockParticles.push(t) }, a._createParticle = function () { var e; if (0 !== a._stockParticles.length ? (e = a._stockParticles.pop())._reset() : e = new xt.Particle(a), a._subEmitters && 0 < a._subEmitters.length) { var t = a._subEmitters[Math.floor(Math.random() * a._subEmitters.length)]; e._attachedSubEmitters = [], t.forEach(function (t) { if (t.type === xt.SubEmitterType.ATTACHED) { var i = t.clone(); e._attachedSubEmitters.push(i), i.particleSystem.start() } }) } return e }, a._emitFromParticle = function (e) { if (a._subEmitters && 0 !== a._subEmitters.length) { var t = Math.floor(Math.random() * a._subEmitters.length); a._subEmitters[t].forEach(function (t) { if (t.type === xt.SubEmitterType.END) { var i = t.clone(); e._inheritParticleInfoToSubEmitter(i), (i.particleSystem._rootParticleSystem = a).activeSubSystems.push(i.particleSystem), i.particleSystem.start() } }) } }, a._capacity = i, a._epsilon = s, a._isAnimationSheetEnabled = o, a._scene = r || xt.Engine.LastCreatedScene, a._attachImageProcessingConfiguration(null), a._customEffect = n, a._scene.particleSystems.push(a), a._useInstancing = a._scene.getEngine().getCaps().instancedArrays, a._createIndexBuffer(), a._createVertexBuffers(), a.particleEmitterType = new xt.BoxParticleEmitter, a.updateFunction = function (e) { var t = null, i = null; a.noiseTexture && (t = a.noiseTexture.getSize(), i = a.noiseTexture.getContent()); for (var r, n = function () { r = e[o]; var n = a._scaledUpdateSpeed, s = r.age; if (r.age += n, r.age > r.lifeTime) { var l = r.age - s; n = (r.lifeTime - s) * n / l, r.age = r.lifeTime } var c = r.age / r.lifeTime; a._colorGradients && 0 < a._colorGradients.length ? xt.Tools.GetCurrentGradient(c, a._colorGradients, function (e, t, i) { e !== r._currentColorGradient && (r._currentColor1.copyFrom(r._currentColor2), t.getColorToRef(r._currentColor2), r._currentColorGradient = e), xt.Color4.LerpToRef(r._currentColor1, r._currentColor2, i, r.color) }) : (r.colorStep.scaleToRef(n, a._scaledColorStep), r.color.addInPlace(a._scaledColorStep), r.color.a < 0 && (r.color.a = 0)), a._angularSpeedGradients && 0 < a._angularSpeedGradients.length && xt.Tools.GetCurrentGradient(c, a._angularSpeedGradients, function (e, t, i) { e !== r._currentAngularSpeedGradient && (r._currentAngularSpeed1 = r._currentAngularSpeed2, r._currentAngularSpeed2 = t.getFactor(), r._currentAngularSpeedGradient = e), r.angularSpeed = xt.Scalar.Lerp(r._currentAngularSpeed1, r._currentAngularSpeed2, i) }), r.angle += r.angularSpeed * n; var h = n; if (a._velocityGradients && 0 < a._velocityGradients.length && xt.Tools.GetCurrentGradient(c, a._velocityGradients, function (e, t, i) { e !== r._currentVelocityGradient && (r._currentVelocity1 = r._currentVelocity2, r._currentVelocity2 = t.getFactor(), r._currentVelocityGradient = e), h *= xt.Scalar.Lerp(r._currentVelocity1, r._currentVelocity2, i) }), r.direction.scaleToRef(h, a._scaledDirection), a._limitVelocityGradients && 0 < a._limitVelocityGradients.length && xt.Tools.GetCurrentGradient(c, a._limitVelocityGradients, function (e, t, i) { e !== r._currentLimitVelocityGradient && (r._currentLimitVelocity1 = r._currentLimitVelocity2, r._currentLimitVelocity2 = t.getFactor(), r._currentLimitVelocityGradient = e), xt.Scalar.Lerp(r._currentLimitVelocity1, r._currentLimitVelocity2, i) < r.direction.length() && r.direction.scaleInPlace(a.limitVelocityDamping) }), a._dragGradients && 0 < a._dragGradients.length && xt.Tools.GetCurrentGradient(c, a._dragGradients, function (e, t, i) { e !== r._currentDragGradient && (r._currentDrag1 = r._currentDrag2, r._currentDrag2 = t.getFactor(), r._currentDragGradient = e); var n = xt.Scalar.Lerp(r._currentDrag1, r._currentDrag2, i); a._scaledDirection.scaleInPlace(1 - n) }), r.position.addInPlace(a._scaledDirection), i && t) { var u = a._fetchR(r._randomNoiseCoordinates1.x, r._randomNoiseCoordinates1.y, t.width, t.height, i), d = a._fetchR(r._randomNoiseCoordinates1.z, r._randomNoiseCoordinates2.x, t.width, t.height, i), f = a._fetchR(r._randomNoiseCoordinates2.y, r._randomNoiseCoordinates2.z, t.width, t.height, i), p = xt.Tmp.Vector3[0], _ = xt.Tmp.Vector3[1]; p.copyFromFloats((2 * u - 1) * a.noiseStrength.x, (2 * d - 1) * a.noiseStrength.y, (2 * f - 1) * a.noiseStrength.z), p.scaleToRef(n, _), r.direction.addInPlace(_) } if (a.gravity.scaleToRef(n, a._scaledGravity), r.direction.addInPlace(a._scaledGravity), a._sizeGradients && 0 < a._sizeGradients.length && xt.Tools.GetCurrentGradient(c, a._sizeGradients, function (e, t, i) { e !== r._currentSizeGradient && (r._currentSize1 = r._currentSize2, r._currentSize2 = t.getFactor(), r._currentSizeGradient = e), r.size = xt.Scalar.Lerp(r._currentSize1, r._currentSize2, i) }), a._useRampGradients && (a._colorRemapGradients && 0 < a._colorRemapGradients.length && xt.Tools.GetCurrentGradient(c, a._colorRemapGradients, function (e, t, i) { var n = xt.Scalar.Lerp(e.factor1, t.factor1, i), o = xt.Scalar.Lerp(e.factor2, t.factor2, i); r.remapData.x = n, r.remapData.y = o - n }), a._alphaRemapGradients && 0 < a._alphaRemapGradients.length && xt.Tools.GetCurrentGradient(c, a._alphaRemapGradients, function (e, t, i) { var n = xt.Scalar.Lerp(e.factor1, t.factor1, i), o = xt.Scalar.Lerp(e.factor2, t.factor2, i); r.remapData.z = n, r.remapData.w = o - n })), a._isAnimationSheetEnabled && r.updateCellIndex(), r._inheritParticleInfoToSubEmitters(), r.age >= r.lifeTime) return a._emitFromParticle(r), r._attachedSubEmitters && (r._attachedSubEmitters.forEach(function (e) { e.particleSystem.disposeOnStop = !0, e.particleSystem.stop() }), r._attachedSubEmitters = null), a.recycleParticle(r), o-- , "continue" }, o = 0; o < e.length; o++)n() }, a } return T(t, e), Object.defineProperty(t.prototype, "onDispose", { set: function (e) { this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "useRampGradients", { get: function () { return this._useRampGradients }, set: function (e) { this._useRampGradients !== e && (this._useRampGradients = e, this._resetEffect()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "particles", { get: function () { return this._particles }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "ParticleSystem" }, t.prototype._addFactorGradient = function (e, t, i, r) { var n = new xt.FactorGradient; n.gradient = t, n.factor1 = i, n.factor2 = r, e.push(n), e.sort(function (e, t) { return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0 }) }, t.prototype._removeFactorGradient = function (e, t) { if (e) for (var i = 0, r = 0, n = e; r < n.length; r++) { if (n[r].gradient === t) { e.splice(i, 1); break } i++ } }, t.prototype.addLifeTimeGradient = function (e, t, i) { return this._lifeTimeGradients || (this._lifeTimeGradients = []), this._addFactorGradient(this._lifeTimeGradients, e, t, i), this }, t.prototype.removeLifeTimeGradient = function (e) { return this._removeFactorGradient(this._lifeTimeGradients, e), this }, t.prototype.addSizeGradient = function (e, t, i) { return this._sizeGradients || (this._sizeGradients = []), this._addFactorGradient(this._sizeGradients, e, t, i), this }, t.prototype.removeSizeGradient = function (e) { return this._removeFactorGradient(this._sizeGradients, e), this }, t.prototype.addColorRemapGradient = function (e, t, i) { return this._colorRemapGradients || (this._colorRemapGradients = []), this._addFactorGradient(this._colorRemapGradients, e, t, i), this }, t.prototype.removeColorRemapGradient = function (e) { return this._removeFactorGradient(this._colorRemapGradients, e), this }, t.prototype.addAlphaRemapGradient = function (e, t, i) { return this._alphaRemapGradients || (this._alphaRemapGradients = []), this._addFactorGradient(this._alphaRemapGradients, e, t, i), this }, t.prototype.removeAlphaRemapGradient = function (e) { return this._removeFactorGradient(this._alphaRemapGradients, e), this }, t.prototype.addAngularSpeedGradient = function (e, t, i) { return this._angularSpeedGradients || (this._angularSpeedGradients = []), this._addFactorGradient(this._angularSpeedGradients, e, t, i), this }, t.prototype.removeAngularSpeedGradient = function (e) { return this._removeFactorGradient(this._angularSpeedGradients, e), this }, t.prototype.addVelocityGradient = function (e, t, i) { return this._velocityGradients || (this._velocityGradients = []), this._addFactorGradient(this._velocityGradients, e, t, i), this }, t.prototype.removeVelocityGradient = function (e) { return this._removeFactorGradient(this._velocityGradients, e), this }, t.prototype.addLimitVelocityGradient = function (e, t, i) { return this._limitVelocityGradients || (this._limitVelocityGradients = []), this._addFactorGradient(this._limitVelocityGradients, e, t, i), this }, t.prototype.removeLimitVelocityGradient = function (e) { return this._removeFactorGradient(this._limitVelocityGradients, e), this }, t.prototype.addDragGradient = function (e, t, i) { return this._dragGradients || (this._dragGradients = []), this._addFactorGradient(this._dragGradients, e, t, i), this }, t.prototype.removeDragGradient = function (e) { return this._removeFactorGradient(this._dragGradients, e), this }, t.prototype.addEmitRateGradient = function (e, t, i) { return this._emitRateGradients || (this._emitRateGradients = []), this._addFactorGradient(this._emitRateGradients, e, t, i), this }, t.prototype.removeEmitRateGradient = function (e) { return this._removeFactorGradient(this._emitRateGradients, e), this }, t.prototype.addStartSizeGradient = function (e, t, i) { return this._startSizeGradients || (this._startSizeGradients = []), this._addFactorGradient(this._startSizeGradients, e, t, i), this }, t.prototype.removeStartSizeGradient = function (e) { return this._removeFactorGradient(this._emitRateGradients, e), this }, t.prototype._createRampGradientTexture = function () { if (this._rampGradients && this._rampGradients.length && !this._rampGradientsTexture) { for (var e = new Uint8Array(4 * this._rawTextureWidth), t = xt.Tmp.Color3[0], i = 0; i < this._rawTextureWidth; i++) { var r = i / this._rawTextureWidth; xt.Tools.GetCurrentGradient(r, this._rampGradients, function (r, n, o) { xt.Color3.LerpToRef(r.color, n.color, o, t), e[4 * i] = 255 * t.r, e[4 * i + 1] = 255 * t.g, e[4 * i + 2] = 255 * t.b, e[4 * i + 3] = 255 }) } this._rampGradientsTexture = xt.RawTexture.CreateRGBATexture(e, this._rawTextureWidth, 1, this._scene, !1, !1, xt.Texture.NEAREST_SAMPLINGMODE) } }, t.prototype.getRampGradients = function () { return this._rampGradients }, t.prototype.addRampGradient = function (e, t) { this._rampGradients || (this._rampGradients = []); var i = new xt.Color3Gradient; return i.gradient = e, i.color = t, this._rampGradients.push(i), this._rampGradients.sort(function (e, t) { return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0 }), this._rampGradientsTexture && (this._rampGradientsTexture.dispose(), this._rampGradientsTexture = null), this._createRampGradientTexture(), this }, t.prototype.removeRampGradient = function (e) { return this._removeGradientAndTexture(e, this._rampGradients, this._rampGradientsTexture), this._rampGradientsTexture = null, this._rampGradients && 0 < this._rampGradients.length && this._createRampGradientTexture(), this }, t.prototype.addColorGradient = function (e, t, i) { this._colorGradients || (this._colorGradients = []); var r = new xt.ColorGradient; return r.gradient = e, r.color1 = t, r.color2 = i, this._colorGradients.push(r), this._colorGradients.sort(function (e, t) { return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0 }), this }, t.prototype.removeColorGradient = function (e) { if (!this._colorGradients) return this; for (var t = 0, i = 0, r = this._colorGradients; i < r.length; i++) { if (r[i].gradient === e) { this._colorGradients.splice(t, 1); break } t++ } return this }, t.prototype._fetchR = function (e, t, i, r, n) { return n[4 * (((e = .5 * Math.abs(e) + .5) * i % i | 0) + ((t = .5 * Math.abs(t) + .5) * r % r | 0) * i)] / 255 }, t.prototype._reset = function () { this._resetEffect() }, t.prototype._resetEffect = function () { this._vertexBuffer && (this._vertexBuffer.dispose(), this._vertexBuffer = null), this._spriteBuffer && (this._spriteBuffer.dispose(), this._spriteBuffer = null), this._createVertexBuffers() }, t.prototype._createVertexBuffers = function () { this._vertexBufferSize = this._useInstancing ? 10 : 12, this._isAnimationSheetEnabled && (this._vertexBufferSize += 1), this._isBillboardBased && this.billboardMode !== t.BILLBOARDMODE_STRETCHED || (this._vertexBufferSize += 3), this._useRampGradients && (this._vertexBufferSize += 4); var e = this._scene.getEngine(); this._vertexData = new Float32Array(this._capacity * this._vertexBufferSize * (this._useInstancing ? 1 : 4)), this._vertexBuffer = new xt.Buffer(e, this._vertexData, !0, this._vertexBufferSize); var i = 0, r = this._vertexBuffer.createVertexBuffer(xt.VertexBuffer.PositionKind, i, 3, this._vertexBufferSize, this._useInstancing); this._vertexBuffers[xt.VertexBuffer.PositionKind] = r, i += 3; var n = this._vertexBuffer.createVertexBuffer(xt.VertexBuffer.ColorKind, i, 4, this._vertexBufferSize, this._useInstancing); this._vertexBuffers[xt.VertexBuffer.ColorKind] = n, i += 4; var o = this._vertexBuffer.createVertexBuffer("angle", i, 1, this._vertexBufferSize, this._useInstancing); this._vertexBuffers.angle = o, i += 1; var s, a = this._vertexBuffer.createVertexBuffer("size", i, 2, this._vertexBufferSize, this._useInstancing); if (this._vertexBuffers.size = a, i += 2, this._isAnimationSheetEnabled) { var l = this._vertexBuffer.createVertexBuffer("cellIndex", i, 1, this._vertexBufferSize, this._useInstancing); this._vertexBuffers.cellIndex = l, i += 1 } if (!this._isBillboardBased || this.billboardMode === t.BILLBOARDMODE_STRETCHED) { var c = this._vertexBuffer.createVertexBuffer("direction", i, 3, this._vertexBufferSize, this._useInstancing); this._vertexBuffers.direction = c, i += 3 } if (this._useRampGradients) { var h = this._vertexBuffer.createVertexBuffer("remapData", i, 4, this._vertexBufferSize, this._useInstancing); this._vertexBuffers.remapData = h, i += 4 } if (this._useInstancing) { var u = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]); this._spriteBuffer = new xt.Buffer(e, u, !1, 2), s = this._spriteBuffer.createVertexBuffer("offset", 0, 2) } else s = this._vertexBuffer.createVertexBuffer("offset", i, 2, this._vertexBufferSize, this._useInstancing), i += 2; this._vertexBuffers.offset = s }, t.prototype._createIndexBuffer = function () { if (!this._useInstancing) { for (var e = [], t = 0, i = 0; i < this._capacity; i++)e.push(t), e.push(t + 1), e.push(t + 2), e.push(t), e.push(t + 2), e.push(t + 3), t += 4; this._indexBuffer = this._scene.getEngine().createIndexBuffer(e) } }, t.prototype.getCapacity = function () { return this._capacity }, t.prototype.isAlive = function () { return this._alive }, t.prototype.isStarted = function () { return this._started }, t.prototype._prepareSubEmitterInternalArray = function () { var e = this; this._subEmitters = new Array, this.subEmitters && this.subEmitters.forEach(function (i) { i instanceof t ? e._subEmitters.push([new xt.SubEmitter(i)]) : i instanceof xt.SubEmitter ? e._subEmitters.push([i]) : i instanceof Array && e._subEmitters.push(i) }) }, t.prototype.start = function (e) { var t = this; if (void 0 === e && (e = this.startDelay), !this.targetStopDuration && this._hasTargetStopDurationDependantGradient()) throw "Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set"; if (e) setTimeout(function () { t.start(0) }, e); else { if (this._prepareSubEmitterInternalArray(), this._started = !0, this._stopped = !1, this._actualFrame = 0, this._subEmitters && 0 != this._subEmitters.length && (this.activeSubSystems = new Array), this._emitRateGradients && (0 < this._emitRateGradients.length && (this._currentEmitRateGradient = this._emitRateGradients[0], this._currentEmitRate1 = this._currentEmitRateGradient.getFactor(), this._currentEmitRate2 = this._currentEmitRate1), 1 < this._emitRateGradients.length && (this._currentEmitRate2 = this._emitRateGradients[1].getFactor())), this._startSizeGradients && (0 < this._startSizeGradients.length && (this._currentStartSizeGradient = this._startSizeGradients[0], this._currentStartSize1 = this._currentStartSizeGradient.getFactor(), this._currentStartSize2 = this._currentStartSize1), 1 < this._startSizeGradients.length && (this._currentStartSize2 = this._startSizeGradients[1].getFactor())), this.preWarmCycles) { this.emitter instanceof xt.AbstractMesh && this.emitter.computeWorldMatrix(!0); var i = this.noiseTexture; if (i && i.onGeneratedObservable) i.onGeneratedObservable.addOnce(function () { setTimeout(function () { for (var e = 0; e < t.preWarmCycles; e++)t.animate(!0), i.render() }) }); else for (var r = 0; r < this.preWarmCycles; r++)this.animate(!0) } this.beginAnimationOnStart && this.animations && 0 < this.animations.length && this.getScene().beginAnimation(this, this.beginAnimationFrom, this.beginAnimationTo, this.beginAnimationLoop) } }, t.prototype.stop = function (e) { void 0 === e && (e = !0), this._stopped = !0, e && this._stopSubEmitters() }, t.prototype.reset = function () { this._stockParticles = [], this._particles = [] }, t.prototype._appendParticleVertex = function (e, i, r, n) { var o = e * this._vertexBufferSize; this._vertexData[o++] = i.position.x, this._vertexData[o++] = i.position.y, this._vertexData[o++] = i.position.z, this._vertexData[o++] = i.color.r, this._vertexData[o++] = i.color.g, this._vertexData[o++] = i.color.b, this._vertexData[o++] = i.color.a, this._vertexData[o++] = i.angle, this._vertexData[o++] = i.scale.x * i.size, this._vertexData[o++] = i.scale.y * i.size, this._isAnimationSheetEnabled && (this._vertexData[o++] = i.cellIndex), this._isBillboardBased ? this.billboardMode === t.BILLBOARDMODE_STRETCHED && (this._vertexData[o++] = i.direction.x, this._vertexData[o++] = i.direction.y, this._vertexData[o++] = i.direction.z) : i._initialDirection ? (this._vertexData[o++] = i._initialDirection.x, this._vertexData[o++] = i._initialDirection.y, this._vertexData[o++] = i._initialDirection.z) : (this._vertexData[o++] = i.direction.x, this._vertexData[o++] = i.direction.y, this._vertexData[o++] = i.direction.z), this._useRampGradients && (this._vertexData[o++] = i.remapData.x, this._vertexData[o++] = i.remapData.y, this._vertexData[o++] = i.remapData.z, this._vertexData[o++] = i.remapData.w), this._useInstancing || (this._isAnimationSheetEnabled && (0 === r ? r = this._epsilon : 1 === r && (r = 1 - this._epsilon), 0 === n ? n = this._epsilon : 1 === n && (n = 1 - this._epsilon)), this._vertexData[o++] = r, this._vertexData[o++] = n) }, t.prototype._stopSubEmitters = function () { this.activeSubSystems && (this.activeSubSystems.forEach(function (e) { e.stop(!0) }), this.activeSubSystems = new Array) }, t.prototype._removeFromRoot = function () { if (this._rootParticleSystem) { var e = this._rootParticleSystem.activeSubSystems.indexOf(this); -1 !== e && this._rootParticleSystem.activeSubSystems.splice(e, 1), this._rootParticleSystem = null } }, t.prototype._update = function (e) { var t, i = this; if (this._alive = 0 < this._particles.length, this.emitter.position) { var r = this.emitter; this._emitterWorldMatrix = r.getWorldMatrix() } else { var n = this.emitter; this._emitterWorldMatrix = xt.Matrix.Translation(n.x, n.y, n.z) } this.updateFunction(this._particles); for (var o, s = function () { if (a._particles.length === a._capacity) return "break"; t = a._createParticle(), a._particles.push(t); var e = xt.Scalar.RandomRange(a.minEmitPower, a.maxEmitPower); if (a.startPositionFunction ? a.startPositionFunction(a._emitterWorldMatrix, t.position, t) : a.particleEmitterType.startPositionFunction(a._emitterWorldMatrix, t.position, t), a.startDirectionFunction ? a.startDirectionFunction(a._emitterWorldMatrix, t.direction, t) : a.particleEmitterType.startDirectionFunction(a._emitterWorldMatrix, t.direction, t), 0 === e ? t._initialDirection ? t._initialDirection.copyFrom(t.direction) : t._initialDirection = t.direction.clone() : t._initialDirection = null, t.direction.scaleInPlace(e), a.targetStopDuration && a._lifeTimeGradients && 0 < a._lifeTimeGradients.length) { var r = xt.Scalar.Clamp(a._actualFrame / a.targetStopDuration); xt.Tools.GetCurrentGradient(r, a._lifeTimeGradients, function (e, i, n) { var o = e, s = i, a = o.getFactor(), l = s.getFactor(), c = (r - o.gradient) / (s.gradient - o.gradient); t.lifeTime = xt.Scalar.Lerp(a, l, c) }) } else t.lifeTime = xt.Scalar.RandomRange(a.minLifeTime, a.maxLifeTime); if (a._sizeGradients && 0 !== a._sizeGradients.length ? (t._currentSizeGradient = a._sizeGradients[0], t._currentSize1 = t._currentSizeGradient.getFactor(), t.size = t._currentSize1, 1 < a._sizeGradients.length ? t._currentSize2 = a._sizeGradients[1].getFactor() : t._currentSize2 = t._currentSize1) : t.size = xt.Scalar.RandomRange(a.minSize, a.maxSize), t.scale.copyFromFloats(xt.Scalar.RandomRange(a.minScaleX, a.maxScaleX), xt.Scalar.RandomRange(a.minScaleY, a.maxScaleY)), a._startSizeGradients && a._startSizeGradients[0] && a.targetStopDuration) { var n = a._actualFrame / a.targetStopDuration; xt.Tools.GetCurrentGradient(n, a._startSizeGradients, function (e, r, n) { e !== i._currentStartSizeGradient && (i._currentStartSize1 = i._currentStartSize2, i._currentStartSize2 = r.getFactor(), i._currentStartSizeGradient = e); var o = xt.Scalar.Lerp(i._currentStartSize1, i._currentStartSize2, n); t.scale.scaleInPlace(o) }) } a._angularSpeedGradients && 0 !== a._angularSpeedGradients.length ? (t._currentAngularSpeedGradient = a._angularSpeedGradients[0], t.angularSpeed = t._currentAngularSpeedGradient.getFactor(), t._currentAngularSpeed1 = t.angularSpeed, 1 < a._angularSpeedGradients.length ? t._currentAngularSpeed2 = a._angularSpeedGradients[1].getFactor() : t._currentAngularSpeed2 = t._currentAngularSpeed1) : t.angularSpeed = xt.Scalar.RandomRange(a.minAngularSpeed, a.maxAngularSpeed), t.angle = xt.Scalar.RandomRange(a.minInitialRotation, a.maxInitialRotation), a._velocityGradients && 0 < a._velocityGradients.length && (t._currentVelocityGradient = a._velocityGradients[0], t._currentVelocity1 = t._currentVelocityGradient.getFactor(), 1 < a._velocityGradients.length ? t._currentVelocity2 = a._velocityGradients[1].getFactor() : t._currentVelocity2 = t._currentVelocity1), a._limitVelocityGradients && 0 < a._limitVelocityGradients.length && (t._currentLimitVelocityGradient = a._limitVelocityGradients[0], t._currentLimitVelocity1 = t._currentLimitVelocityGradient.getFactor(), 1 < a._limitVelocityGradients.length ? t._currentLimitVelocity2 = a._limitVelocityGradients[1].getFactor() : t._currentLimitVelocity2 = t._currentLimitVelocity1), a._dragGradients && 0 < a._dragGradients.length && (t._currentDragGradient = a._dragGradients[0], t._currentDrag1 = t._currentDragGradient.getFactor(), 1 < a._dragGradients.length ? t._currentDrag2 = a._dragGradients[1].getFactor() : t._currentDrag2 = t._currentDrag1), a._colorGradients && 0 !== a._colorGradients.length ? (t._currentColorGradient = a._colorGradients[0], t._currentColorGradient.getColorToRef(t.color), t._currentColor1.copyFrom(t.color), 1 < a._colorGradients.length ? a._colorGradients[1].getColorToRef(t._currentColor2) : t._currentColor2.copyFrom(t.color)) : (o = xt.Scalar.RandomRange(0, 1), xt.Color4.LerpToRef(a.color1, a.color2, o, t.color), a.colorDead.subtractToRef(t.color, a._colorDiff), a._colorDiff.scaleToRef(1 / t.lifeTime, t.colorStep)), a._isAnimationSheetEnabled && (t._initialStartSpriteCellID = a.startSpriteCellID, t._initialEndSpriteCellID = a.endSpriteCellID), t.direction.addInPlace(a._inheritedVelocityOffset), a._useRampGradients && (t.remapData = new xt.Vector4(0, 1, 0, 1)), a.noiseTexture && (t._randomNoiseCoordinates1 ? (t._randomNoiseCoordinates1.copyFromFloats(Math.random(), Math.random(), Math.random()), t._randomNoiseCoordinates2.copyFromFloats(Math.random(), Math.random(), Math.random())) : (t._randomNoiseCoordinates1 = new xt.Vector3(Math.random(), Math.random(), Math.random()), t._randomNoiseCoordinates2 = new xt.Vector3(Math.random(), Math.random(), Math.random()))), t._inheritParticleInfoToSubEmitters() }, a = this, l = 0; l < e && "break" !== s(); l++); }, t._GetAttributeNamesOrOptions = function (e, t, i) { void 0 === e && (e = !1), void 0 === t && (t = !1), void 0 === i && (i = !1); var r = [xt.VertexBuffer.PositionKind, xt.VertexBuffer.ColorKind, "angle", "offset", "size"]; return e && r.push("cellIndex"), t || r.push("direction"), i && r.push("remapData"), r }, t._GetEffectCreationOptions = function (e) { void 0 === e && (e = !1); var t = ["invView", "view", "projection", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "textureMask", "translationPivot", "eyePosition"]; return e && t.push("particlesInfos"), t }, t.prototype._getEffect = function (e) { if (this._customEffect) return this._customEffect; var i = []; if (this._scene.clipPlane && i.push("#define CLIPPLANE"), this._scene.clipPlane2 && i.push("#define CLIPPLANE2"), this._scene.clipPlane3 && i.push("#define CLIPPLANE3"), this._scene.clipPlane4 && i.push("#define CLIPPLANE4"), this._isAnimationSheetEnabled && i.push("#define ANIMATESHEET"), e === t.BLENDMODE_MULTIPLY && i.push("#define BLENDMULTIPLYMODE"), this._useRampGradients && i.push("#define RAMPGRADIENT"), this._isBillboardBased) switch (i.push("#define BILLBOARD"), this.billboardMode) { case t.BILLBOARDMODE_Y: i.push("#define BILLBOARDY"); break; case t.BILLBOARDMODE_STRETCHED: i.push("#define BILLBOARDSTRETCHED") }this._imageProcessingConfiguration && (this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines), i.push(this._imageProcessingConfigurationDefines.toString())); var r = i.join("\n"); if (this._cachedDefines !== r) { this._cachedDefines = r; var n = t._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled, this._isBillboardBased && this.billboardMode !== t.BILLBOARDMODE_STRETCHED, this._useRampGradients), o = t._GetEffectCreationOptions(this._isAnimationSheetEnabled), s = ["diffuseSampler", "rampSampler"]; xt.ImageProcessingConfiguration && (xt.ImageProcessingConfiguration.PrepareUniforms(o, this._imageProcessingConfigurationDefines), xt.ImageProcessingConfiguration.PrepareSamplers(s, this._imageProcessingConfigurationDefines)), this._effect = this._scene.getEngine().createEffect("particles", n, o, s, r) } return this._effect }, t.prototype.animate = function (e) { var t = this; if (void 0 === e && (e = !1), this._started) { if (!e) { if (!this.isReady()) return; if (this._currentRenderId === this._scene.getRenderId()) return; this._currentRenderId = this._scene.getRenderId() } var i; if (this._scaledUpdateSpeed = this.updateSpeed * (e ? this.preWarmStepOffset : this._scene.getAnimationRatio()), -1 < this.manualEmitCount) i = this.manualEmitCount, this._newPartsExcess = 0, this.manualEmitCount = 0; else { var r = this.emitRate; if (this._emitRateGradients && 0 < this._emitRateGradients.length && this.targetStopDuration) { var n = this._actualFrame / this.targetStopDuration; xt.Tools.GetCurrentGradient(n, this._emitRateGradients, function (e, i, n) { e !== t._currentEmitRateGradient && (t._currentEmitRate1 = t._currentEmitRate2, t._currentEmitRate2 = i.getFactor(), t._currentEmitRateGradient = e), r = xt.Scalar.Lerp(t._currentEmitRate1, t._currentEmitRate2, n) }) } i = r * this._scaledUpdateSpeed >> 0, this._newPartsExcess += r * this._scaledUpdateSpeed - i } if (1 < this._newPartsExcess && (i += this._newPartsExcess >> 0, this._newPartsExcess -= this._newPartsExcess >> 0), this._alive = !1, this._stopped ? i = 0 : (this._actualFrame += this._scaledUpdateSpeed, this.targetStopDuration && this._actualFrame >= this.targetStopDuration && this.stop()), this._update(i), this._stopped && (this._alive || (this._started = !1, this.onAnimationEnd && this.onAnimationEnd(), this.disposeOnStop && this._scene._toBeDisposed.push(this))), !e) { for (var o = 0, s = 0; s < this._particles.length; s++) { var a = this._particles[s]; this._appendParticleVertices(o, a), o += this._useInstancing ? 1 : 4 } this._vertexBuffer && this._vertexBuffer.update(this._vertexData) } 0 === this.manualEmitCount && this.disposeOnStop && this.stop() } }, t.prototype._appendParticleVertices = function (e, t) { this._appendParticleVertex(e++, t, 0, 0), this._useInstancing || (this._appendParticleVertex(e++, t, 1, 0), this._appendParticleVertex(e++, t, 1, 1), this._appendParticleVertex(e++, t, 0, 1)) }, t.prototype.rebuild = function () { this._createIndexBuffer(), this._vertexBuffer && this._vertexBuffer._rebuild() }, t.prototype.isReady = function () { if (!(this.emitter && this._imageProcessingConfiguration.isReady() && this.particleTexture && this.particleTexture.isReady())) return !1; if (this.blendMode !== t.BLENDMODE_MULTIPLYADD) { if (!this._getEffect(this.blendMode).isReady()) return !1 } else { if (!this._getEffect(t.BLENDMODE_MULTIPLY).isReady()) return !1; if (!this._getEffect(t.BLENDMODE_ADD).isReady()) return !1 } return !0 }, t.prototype._render = function (e) { var i = this._getEffect(e), r = this._scene.getEngine(); r.enableEffect(i); var n = this._scene.getViewMatrix(); if (i.setTexture("diffuseSampler", this.particleTexture), i.setMatrix("view", n), i.setMatrix("projection", this._scene.getProjectionMatrix()), this._isAnimationSheetEnabled && this.particleTexture) { var o = this.particleTexture.getBaseSize(); i.setFloat3("particlesInfos", this.spriteCellWidth / o.width, this.spriteCellHeight / o.height, o.width / this.spriteCellWidth) } if (i.setVector2("translationPivot", this.translationPivot), i.setFloat4("textureMask", this.textureMask.r, this.textureMask.g, this.textureMask.b, this.textureMask.a), this._isBillboardBased) { var s = this._scene.activeCamera; i.setVector3("eyePosition", s.globalPosition) } if (this._rampGradientsTexture && i.setTexture("rampSampler", this._rampGradientsTexture), this._scene.clipPlane || this._scene.clipPlane2 || this._scene.clipPlane3 || this._scene.clipPlane4) { var a = n.clone(); a.invert(), i.setMatrix("invView", a), xt.MaterialHelper.BindClipPlane(i, this._scene) } switch (r.bindBuffers(this._vertexBuffers, this._indexBuffer, i), this._imageProcessingConfiguration && !this._imageProcessingConfiguration.applyByPostProcess && this._imageProcessingConfiguration.bind(i), e) { case t.BLENDMODE_ADD: r.setAlphaMode(xt.Engine.ALPHA_ADD); break; case t.BLENDMODE_ONEONE: r.setAlphaMode(xt.Engine.ALPHA_ONEONE); break; case t.BLENDMODE_STANDARD: r.setAlphaMode(xt.Engine.ALPHA_COMBINE); break; case t.BLENDMODE_MULTIPLY: r.setAlphaMode(xt.Engine.ALPHA_MULTIPLY) }return this._useInstancing ? r.drawArraysType(xt.Material.TriangleFanDrawMode, 0, 4, this._particles.length) : r.drawElementsType(xt.Material.TriangleFillMode, 0, 6 * this._particles.length), this._particles.length }, t.prototype.render = function () { if (!this.isReady() || !this._particles.length) return 0; var e = this._scene.getEngine(); e.setState(!1), this.forceDepthWrite && e.setDepthWrite(!0); var i = 0; return this.blendMode === t.BLENDMODE_MULTIPLYADD && (i = this._render(t.BLENDMODE_MULTIPLY) + this._render(t.BLENDMODE_ADD)), i = this._render(this.blendMode), e.unbindInstanceAttributes(), e.setAlphaMode(xt.Engine.ALPHA_DISABLE), i }, t.prototype.dispose = function (e) { if (void 0 === e && (e = !0), this._vertexBuffer && (this._vertexBuffer.dispose(), this._vertexBuffer = null), this._spriteBuffer && (this._spriteBuffer.dispose(), this._spriteBuffer = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null), e && this.particleTexture && (this.particleTexture.dispose(), this.particleTexture = null), e && this.noiseTexture && (this.noiseTexture.dispose(), this.noiseTexture = null), this._rampGradientsTexture && (this._rampGradientsTexture.dispose(), this._rampGradientsTexture = null), this._removeFromRoot(), this._subEmitters && this._subEmitters.length) { for (var t = 0; t < this._subEmitters.length; t++)for (var i = 0, r = this._subEmitters[t]; i < r.length; i++)r[i].dispose(); this._subEmitters = [], this.subEmitters = [] } this._disposeEmitterOnDispose && this.emitter && this.emitter.dispose && this.emitter.dispose(!0), -1 < (t = this._scene.particleSystems.indexOf(this)) && this._scene.particleSystems.splice(t, 1), this._scene._activeParticleSystems.dispose(), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear(), this.reset() }, t.prototype.clone = function (e, i) { var r = null, n = null; if (null != this.customShader) { var o = 0 < (n = this.customShader).shaderOptions.defines.length ? n.shaderOptions.defines.join("\n") : ""; r = this._scene.getEngine().createEffectForParticles(n.shaderPath.fragmentElement, n.shaderOptions.uniforms, n.shaderOptions.samplers, o) } else this._customEffect && (r = this._customEffect); var s = new t(e, this._capacity, this._scene, r); return s.customShader = n, xt.Tools.DeepCopy(this, s, ["particles", "customShader", "noiseTexture"]), void 0 === i && (i = this.emitter), s.noiseTexture = this.noiseTexture, s.emitter = i, this.particleTexture && (s.particleTexture = new xt.Texture(this.particleTexture.url, this._scene)), this._colorGradients && this._colorGradients.forEach(function (e) { s.addColorGradient(e.gradient, e.color1, e.color2) }), this._dragGradients && this._dragGradients.forEach(function (e) { s.addDragGradient(e.gradient, e.factor1, e.factor2) }), this._angularSpeedGradients && this._angularSpeedGradients.forEach(function (e) { s.addAngularSpeedGradient(e.gradient, e.factor1, e.factor2) }), this._emitRateGradients && this._emitRateGradients.forEach(function (e) { s.addEmitRateGradient(e.gradient, e.factor1, e.factor2) }), this._lifeTimeGradients && this._lifeTimeGradients.forEach(function (e) { s.addLifeTimeGradient(e.gradient, e.factor1, e.factor2) }), this._limitVelocityGradients && this._limitVelocityGradients.forEach(function (e) { s.addLimitVelocityGradient(e.gradient, e.factor1, e.factor2) }), this._sizeGradients && this._sizeGradients.forEach(function (e) { s.addSizeGradient(e.gradient, e.factor1, e.factor2) }), this._startSizeGradients && this._startSizeGradients.forEach(function (e) { s.addStartSizeGradient(e.gradient, e.factor1, e.factor2) }), this._velocityGradients && this._velocityGradients.forEach(function (e) { s.addVelocityGradient(e.gradient, e.factor1, e.factor2) }), this._rampGradients && this._rampGradients.forEach(function (e) { s.addRampGradient(e.gradient, e.color) }), this._colorRemapGradients && this._colorRemapGradients.forEach(function (e) { s.addColorRemapGradient(e.gradient, e.factor1, e.factor2) }), this._alphaRemapGradients && this._alphaRemapGradients.forEach(function (e) { s.addAlphaRemapGradient(e.gradient, e.factor1, e.factor2) }), this.preventAutoStart || s.start(), s }, t.prototype.serialize = function () { var e = {}; if (t._Serialize(e, this), e.textureMask = this.textureMask.asArray(), e.customShader = this.customShader, e.preventAutoStart = this.preventAutoStart, this.subEmitters) { e.subEmitters = [], this._subEmitters || this._prepareSubEmitterInternalArray(); for (var i = 0, r = this._subEmitters; i < r.length; i++) { for (var n = [], o = 0, s = r[i]; o < s.length; o++) { var a = s[o]; n.push(a.serialize()) } e.subEmitters.push(n) } } return e }, t._Serialize = function (e, t) { if (e.name = t.name, e.id = t.id, e.capacity = t.getCapacity(), t.emitter.position) { var i = t.emitter; e.emitterId = i.id } else { var r = t.emitter; e.emitter = r.asArray() } t.particleEmitterType && (e.particleEmitterType = t.particleEmitterType.serialize()), t.particleTexture && (e.textureName = t.particleTexture.name, e.invertY = t.particleTexture._invertY), xt.Animation.AppendSerializedAnimations(t, e), e.beginAnimationOnStart = t.beginAnimationOnStart, e.beginAnimationFrom = t.beginAnimationFrom, e.beginAnimationTo = t.beginAnimationTo, e.beginAnimationLoop = t.beginAnimationLoop, e.startDelay = t.startDelay, e.renderingGroupId = t.renderingGroupId, e.isBillboardBased = t.isBillboardBased, e.billboardMode = t.billboardMode, e.minAngularSpeed = t.minAngularSpeed, e.maxAngularSpeed = t.maxAngularSpeed, e.minSize = t.minSize, e.maxSize = t.maxSize, e.minScaleX = t.minScaleX, e.maxScaleX = t.maxScaleX, e.minScaleY = t.minScaleY, e.maxScaleY = t.maxScaleY, e.minEmitPower = t.minEmitPower, e.maxEmitPower = t.maxEmitPower, e.minLifeTime = t.minLifeTime, e.maxLifeTime = t.maxLifeTime, e.emitRate = t.emitRate, e.gravity = t.gravity.asArray(), e.noiseStrength = t.noiseStrength.asArray(), e.color1 = t.color1.asArray(), e.color2 = t.color2.asArray(), e.colorDead = t.colorDead.asArray(), e.updateSpeed = t.updateSpeed, e.targetStopDuration = t.targetStopDuration, e.blendMode = t.blendMode, e.preWarmCycles = t.preWarmCycles, e.preWarmStepOffset = t.preWarmStepOffset, e.minInitialRotation = t.minInitialRotation, e.maxInitialRotation = t.maxInitialRotation, e.startSpriteCellID = t.startSpriteCellID, e.endSpriteCellID = t.endSpriteCellID, e.spriteCellChangeSpeed = t.spriteCellChangeSpeed, e.spriteCellWidth = t.spriteCellWidth, e.spriteCellHeight = t.spriteCellHeight, e.spriteRandomStartCell = t.spriteRandomStartCell, e.isAnimationSheetEnabled = t.isAnimationSheetEnabled; var n = t.getColorGradients(); if (n) { e.colorGradients = []; for (var o = 0, s = n; o < s.length; o++) { var a = s[o], l = { gradient: a.gradient, color1: a.color1.asArray() }; a.color2 && (l.color2 = a.color2.asArray()), e.colorGradients.push(l) } } var c = t.getRampGradients(); if (c) { e.rampGradients = []; for (var h = 0, u = c; h < u.length; h++) { var d = u[h]; l = { gradient: d.gradient, color: d.color.asArray() }, e.rampGradients.push(l) } e.useRampGradients = t.useRampGradients } var f = t.getColorRemapGradients(); if (f) { e.colorRemapGradients = []; for (var p = 0, _ = f; p < _.length; p++) { var m = _[p]; l = { gradient: m.gradient, factor1: m.factor1 }, void 0 !== m.factor2 && (l.factor2 = m.factor2), e.colorRemapGradients.push(l) } } var g = t.getAlphaRemapGradients(); if (g) { e.alphaRemapGradients = []; for (var v = 0, y = g; v < y.length; v++) { var b = y[v]; l = { gradient: b.gradient, factor1: b.factor1 }, void 0 !== b.factor2 && (l.factor2 = b.factor2), e.alphaRemapGradients.push(l) } } var T = t.getSizeGradients(); if (T) { e.sizeGradients = []; for (var E = 0, x = T; E < x.length; E++) { var P = x[E]; l = { gradient: P.gradient, factor1: P.factor1 }, void 0 !== P.factor2 && (l.factor2 = P.factor2), e.sizeGradients.push(l) } } var A = t.getAngularSpeedGradients(); if (A) { e.angularSpeedGradients = []; for (var S = 0, M = A; S < M.length; S++) { var R = M[S]; l = { gradient: R.gradient, factor1: R.factor1 }, void 0 !== R.factor2 && (l.factor2 = R.factor2), e.angularSpeedGradients.push(l) } } var C = t.getVelocityGradients(); if (C) { e.velocityGradients = []; for (var O = 0, D = C; O < D.length; O++) { var I = D[O]; l = { gradient: I.gradient, factor1: I.factor1 }, void 0 !== I.factor2 && (l.factor2 = I.factor2), e.velocityGradients.push(l) } } var w = t.getDragGradients(); if (w) { e.dragyGradients = []; for (var L = 0, F = w; L < F.length; L++) { var B = F[L]; l = { gradient: B.gradient, factor1: B.factor1 }, void 0 !== B.factor2 && (l.factor2 = B.factor2), e.dragGradients.push(l) } } var N = t.getEmitRateGradients(); if (N) { e.emitRateGradients = []; for (var V = 0, U = N; V < U.length; V++) { var z = U[V]; l = { gradient: z.gradient, factor1: z.factor1 }, void 0 !== z.factor2 && (l.factor2 = z.factor2), e.emitRateGradients.push(l) } } var G = t.getStartSizeGradients(); if (G) { e.startSizeGradients = []; for (var k = 0, W = G; k < W.length; k++) { var H = W[k]; l = { gradient: H.gradient, factor1: H.factor1 }, void 0 !== H.factor2 && (l.factor2 = H.factor2), e.startSizeGradients.push(l) } } var X = t.getLifeTimeGradients(); if (X) { e.lifeTimeGradients = []; for (var j = 0, Y = X; j < Y.length; j++) { var K = Y[j]; l = { gradient: K.gradient, factor1: K.factor1 }, void 0 !== K.factor2 && (l.factor2 = K.factor2), e.lifeTimeGradients.push(l) } } var Q = t.getLimitVelocityGradients(); if (Q) { e.limitVelocityGradients = []; for (var Z = 0, q = Q; Z < q.length; Z++) { var J = q[Z]; l = { gradient: J.gradient, factor1: J.factor1 }, void 0 !== J.factor2 && (l.factor2 = J.factor2), e.limitVelocityGradients.push(l) } e.limitVelocityDamping = t.limitVelocityDamping } t.noiseTexture && (e.noiseTexture = t.noiseTexture.serialize()) }, t._Parse = function (e, t, i, r) { if (e.textureName && (t.particleTexture = new xt.Texture(r + e.textureName, i, !1, void 0 === e.invertY || e.invertY), t.particleTexture.name = e.textureName), e.emitterId || 0 === e.emitterId || void 0 !== e.emitter ? e.emitterId ? t.emitter = i.getLastMeshByID(e.emitterId) : t.emitter = xt.Vector3.FromArray(e.emitter) : t.emitter = xt.Vector3.Zero(), void 0 !== e.renderingGroupId && (t.renderingGroupId = e.renderingGroupId), void 0 !== e.isBillboardBased && (t.isBillboardBased = e.isBillboardBased), void 0 !== e.billboardMode && (t.billboardMode = e.billboardMode), e.animations) { for (var n = 0; n < e.animations.length; n++) { var o = e.animations[n]; t.animations.push(xt.Animation.Parse(o)) } t.beginAnimationOnStart = e.beginAnimationOnStart, t.beginAnimationFrom = e.beginAnimationFrom, t.beginAnimationTo = e.beginAnimationTo, t.beginAnimationLoop = e.beginAnimationLoop } if (e.autoAnimate && i.beginAnimation(t, e.autoAnimateFrom, e.autoAnimateTo, e.autoAnimateLoop, e.autoAnimateSpeed || 1), t.startDelay = 0 | e.startDelay, t.minAngularSpeed = e.minAngularSpeed, t.maxAngularSpeed = e.maxAngularSpeed, t.minSize = e.minSize, t.maxSize = e.maxSize, e.minScaleX && (t.minScaleX = e.minScaleX, t.maxScaleX = e.maxScaleX, t.minScaleY = e.minScaleY, t.maxScaleY = e.maxScaleY), void 0 !== e.preWarmCycles && (t.preWarmCycles = e.preWarmCycles, t.preWarmStepOffset = e.preWarmStepOffset), void 0 !== e.minInitialRotation && (t.minInitialRotation = e.minInitialRotation, t.maxInitialRotation = e.maxInitialRotation), t.minLifeTime = e.minLifeTime, t.maxLifeTime = e.maxLifeTime, t.minEmitPower = e.minEmitPower, t.maxEmitPower = e.maxEmitPower, t.emitRate = e.emitRate, t.gravity = xt.Vector3.FromArray(e.gravity), e.noiseStrength && (t.noiseStrength = xt.Vector3.FromArray(e.noiseStrength)), t.color1 = xt.Color4.FromArray(e.color1), t.color2 = xt.Color4.FromArray(e.color2), t.colorDead = xt.Color4.FromArray(e.colorDead), t.updateSpeed = e.updateSpeed, t.targetStopDuration = e.targetStopDuration, t.blendMode = e.blendMode, e.colorGradients) for (var s = 0, a = e.colorGradients; s < a.length; s++) { var l = a[s]; t.addColorGradient(l.gradient, xt.Color4.FromArray(l.color1), l.color2 ? xt.Color4.FromArray(l.color2) : void 0) } if (e.rampGradients) { for (var c = 0, h = e.rampGradients; c < h.length; c++) { var u = h[c]; t.addRampGradient(u.gradient, xt.Color3.FromArray(u.color)) } t.useRampGradients = e.useRampGradients } if (e.colorRemapGradients) for (var d = 0, f = e.colorRemapGradients; d < f.length; d++) { var p = f[d]; t.addColorRemapGradient(p.gradient, void 0 !== p.factor1 ? p.factor1 : p.factor, p.factor2) } if (e.alphaRemapGradients) for (var _ = 0, m = e.alphaRemapGradients; _ < m.length; _++) { var g = m[_]; t.addAlphaRemapGradient(g.gradient, void 0 !== g.factor1 ? g.factor1 : g.factor, g.factor2) } if (e.sizeGradients) for (var v = 0, y = e.sizeGradients; v < y.length; v++) { var b = y[v]; t.addSizeGradient(b.gradient, void 0 !== b.factor1 ? b.factor1 : b.factor, b.factor2) } if (e.sizeGradients) for (var T = 0, E = e.sizeGradients; T < E.length; T++)b = E[T], t.addSizeGradient(b.gradient, void 0 !== b.factor1 ? b.factor1 : b.factor, b.factor2); if (e.angularSpeedGradients) for (var x = 0, P = e.angularSpeedGradients; x < P.length; x++) { var A = P[x]; t.addAngularSpeedGradient(A.gradient, void 0 !== A.factor1 ? A.factor1 : A.factor, A.factor2) } if (e.velocityGradients) for (var S = 0, M = e.velocityGradients; S < M.length; S++) { var R = M[S]; t.addVelocityGradient(R.gradient, void 0 !== R.factor1 ? R.factor1 : R.factor, R.factor2) } if (e.dragGradients) for (var C = 0, O = e.dragGradients; C < O.length; C++) { var D = O[C]; t.addDragGradient(D.gradient, void 0 !== D.factor1 ? D.factor1 : D.factor, D.factor2) } if (e.emitRateGradients) for (var I = 0, w = e.emitRateGradients; I < w.length; I++) { var L = w[I]; t.addEmitRateGradient(L.gradient, void 0 !== L.factor1 ? L.factor1 : L.factor, L.factor2) } if (e.startSizeGradients) for (var F = 0, B = e.startSizeGradients; F < B.length; F++) { var N = B[F]; t.addStartSizeGradient(N.gradient, void 0 !== N.factor1 ? N.factor1 : N.factor, N.factor2) } if (e.lifeTimeGradients) for (var V = 0, U = e.lifeTimeGradients; V < U.length; V++) { var z = U[V]; t.addLifeTimeGradient(z.gradient, void 0 !== z.factor1 ? z.factor1 : z.factor, z.factor2) } if (e.limitVelocityGradients) { for (var G = 0, k = e.limitVelocityGradients; G < k.length; G++) { var W = k[G]; t.addLimitVelocityGradient(W.gradient, void 0 !== W.factor1 ? W.factor1 : W.factor, W.factor2) } t.limitVelocityDamping = e.limitVelocityDamping } var H; if (e.noiseTexture && (t.noiseTexture = xt.ProceduralTexture.Parse(e.noiseTexture, i, r)), e.particleEmitterType) { switch (e.particleEmitterType.type) { case "SphereParticleEmitter": H = new xt.SphereParticleEmitter; break; case "SphereDirectedParticleEmitter": H = new xt.SphereDirectedParticleEmitter; break; case "ConeEmitter": case "ConeParticleEmitter": H = new xt.ConeParticleEmitter; break; case "CylinderParticleEmitter": H = new xt.CylinderParticleEmitter; break; case "HemisphericParticleEmitter": H = new xt.HemisphericParticleEmitter; break; case "BoxEmitter": case "BoxParticleEmitter": default: H = new xt.BoxParticleEmitter }H.parse(e.particleEmitterType) } else (H = new xt.BoxParticleEmitter).parse(e); t.particleEmitterType = H, t.startSpriteCellID = e.startSpriteCellID, t.endSpriteCellID = e.endSpriteCellID, t.spriteCellWidth = e.spriteCellWidth, t.spriteCellHeight = e.spriteCellHeight, t.spriteCellChangeSpeed = e.spriteCellChangeSpeed, t.spriteRandomStartCell = e.spriteRandomStartCell }, t.Parse = function (e, i, r, n) { void 0 === n && (n = !1); var o = e.name, s = null, a = null; if (e.customShader) { var l = 0 < (a = e.customShader).shaderOptions.defines.length ? a.shaderOptions.defines.join("\n") : ""; s = i.getEngine().createEffectForParticles(a.shaderPath.fragmentElement, a.shaderOptions.uniforms, a.shaderOptions.samplers, l) } var c = new t(o, e.capacity, i, s, e.isAnimationSheetEnabled); if (c.customShader = a, e.id && (c.id = e.id), e.subEmitters) { c.subEmitters = []; for (var h = 0, u = e.subEmitters; h < u.length; h++) { for (var d = [], f = 0, p = u[h]; f < p.length; f++) { var _ = p[f]; d.push(xt.SubEmitter.Parse(_, i, r)) } c.subEmitters.push(d) } } return t._Parse(e, c, i, r), c.textureMask = xt.Color4.FromArray(e.textureMask), e.preventAutoStart && (c.preventAutoStart = e.preventAutoStart), n || c.preventAutoStart || c.start(), c }, t.BILLBOARDMODE_Y = 2, t.BILLBOARDMODE_ALL = 7, t.BILLBOARDMODE_STRETCHED = 8, t }((xt = $a || ($a = {})).BaseParticleSystem), xt.ParticleSystem = Pt, At = $a || ($a = {}), St = function () { function e() { this.direction1 = new At.Vector3(0, 1, 0), this.direction2 = new At.Vector3(0, 1, 0), this.minEmitBox = new At.Vector3(-.5, -.5, -.5), this.maxEmitBox = new At.Vector3(.5, .5, .5) } return e.prototype.startDirectionFunction = function (e, t, i) { var r = At.Scalar.RandomRange(this.direction1.x, this.direction2.x), n = At.Scalar.RandomRange(this.direction1.y, this.direction2.y), o = At.Scalar.RandomRange(this.direction1.z, this.direction2.z); At.Vector3.TransformNormalFromFloatsToRef(r, n, o, e, t) }, e.prototype.startPositionFunction = function (e, t, i) { var r = At.Scalar.RandomRange(this.minEmitBox.x, this.maxEmitBox.x), n = At.Scalar.RandomRange(this.minEmitBox.y, this.maxEmitBox.y), o = At.Scalar.RandomRange(this.minEmitBox.z, this.maxEmitBox.z); At.Vector3.TransformCoordinatesFromFloatsToRef(r, n, o, e, t) }, e.prototype.clone = function () { var t = new e; return At.Tools.DeepCopy(this, t), t }, e.prototype.applyToShader = function (e) { e.setVector3("direction1", this.direction1), e.setVector3("direction2", this.direction2), e.setVector3("minEmitBox", this.minEmitBox), e.setVector3("maxEmitBox", this.maxEmitBox) }, e.prototype.getEffectDefines = function () { return "#define BOXEMITTER" }, e.prototype.getClassName = function () { return "BoxParticleEmitter" }, e.prototype.serialize = function () { var e = {}; return e.type = this.getClassName(), e.direction1 = this.direction1.asArray(), e.direction2 = this.direction2.asArray(), e.minEmitBox = this.minEmitBox.asArray(), e.maxEmitBox = this.maxEmitBox.asArray(), e }, e.prototype.parse = function (e) { At.Vector3.FromArrayToRef(e.direction1, 0, this.direction1), At.Vector3.FromArrayToRef(e.direction2, 0, this.direction2), At.Vector3.FromArrayToRef(e.minEmitBox, 0, this.minEmitBox), At.Vector3.FromArrayToRef(e.maxEmitBox, 0, this.maxEmitBox) }, e }(), At.BoxParticleEmitter = St, Mt = $a || ($a = {}), Rt = function () { function e(e, t, i, r) { void 0 === e && (e = 1), void 0 === t && (t = 1), void 0 === i && (i = 1), void 0 === r && (r = 0), this.radius = e, this.height = t, this.radiusRange = i, this.directionRandomizer = r } return e.prototype.startDirectionFunction = function (e, t, i) { var r = i.position.subtract(e.getTranslation()).normalize(), n = Mt.Scalar.RandomRange(-this.directionRandomizer / 2, this.directionRandomizer / 2), o = Math.atan2(r.x, r.z); o += Mt.Scalar.RandomRange(-Math.PI / 2, Math.PI / 2) * this.directionRandomizer, r.y = n, r.x = Math.sin(o), r.z = Math.cos(o), r.normalize(), Mt.Vector3.TransformNormalFromFloatsToRef(r.x, r.y, r.z, e, t) }, e.prototype.startPositionFunction = function (e, t, i) { var r = Mt.Scalar.RandomRange(-this.height / 2, this.height / 2), n = Mt.Scalar.RandomRange(0, 2 * Math.PI), o = Mt.Scalar.RandomRange((1 - this.radiusRange) * (1 - this.radiusRange), 1), s = Math.sqrt(o) * this.radius, a = s * Math.cos(n), l = s * Math.sin(n); Mt.Vector3.TransformCoordinatesFromFloatsToRef(a, r, l, e, t) }, e.prototype.clone = function () { var t = new e(this.radius, this.directionRandomizer); return Mt.Tools.DeepCopy(this, t), t }, e.prototype.applyToShader = function (e) { e.setFloat("radius", this.radius), e.setFloat("height", this.height), e.setFloat("radiusRange", this.radiusRange), e.setFloat("directionRandomizer", this.directionRandomizer) }, e.prototype.getEffectDefines = function () { return "#define CYLINDEREMITTER" }, e.prototype.getClassName = function () { return "CylinderParticleEmitter" }, e.prototype.serialize = function () { var e = {}; return e.type = this.getClassName(), e.radius = this.radius, e.height = this.height, e.radiusRange = this.radiusRange, e.directionRandomizer = this.directionRandomizer, e }, e.prototype.parse = function (e) { this.radius = e.radius, this.height = e.height, this.radiusRange = e.radiusRange, this.directionRandomizer = e.directionRandomizer }, e }(), Ct = function (e) { function t(t, i, r, n, o) { void 0 === t && (t = 1), void 0 === i && (i = 1), void 0 === r && (r = 1), void 0 === n && (n = new Mt.Vector3(0, 1, 0)), void 0 === o && (o = new Mt.Vector3(0, 1, 0)); var s = e.call(this, t, i, r) || this; return s.direction1 = n, s.direction2 = o, s } return T(t, e), t.prototype.startDirectionFunction = function (e, t, i) { var r = Mt.Scalar.RandomRange(this.direction1.x, this.direction2.x), n = Mt.Scalar.RandomRange(this.direction1.y, this.direction2.y), o = Mt.Scalar.RandomRange(this.direction1.z, this.direction2.z); Mt.Vector3.TransformNormalFromFloatsToRef(r, n, o, e, t) }, t.prototype.clone = function () { var e = new t(this.radius, this.height, this.radiusRange, this.direction1, this.direction2); return Mt.Tools.DeepCopy(this, e), e }, t.prototype.applyToShader = function (e) { e.setFloat("radius", this.radius), e.setFloat("height", this.height), e.setFloat("radiusRange", this.radiusRange), e.setVector3("direction1", this.direction1), e.setVector3("direction2", this.direction2) }, t.prototype.getEffectDefines = function () { return "#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER" }, t.prototype.getClassName = function () { return "CylinderDirectedParticleEmitter" }, t.prototype.serialize = function () { var t = e.prototype.serialize.call(this); return t.direction1 = this.direction1.asArray(), t.direction2 = this.direction2.asArray(), t }, t.prototype.parse = function (t) { e.prototype.parse.call(this, t), this.direction1.copyFrom(t.direction1), this.direction2.copyFrom(t.direction2) }, t }(Mt.CylinderParticleEmitter = Rt), Mt.CylinderDirectedParticleEmitter = Ct, Ot = $a || ($a = {}), Dt = function () { function e(e, t, i) { void 0 === e && (e = 1), void 0 === t && (t = Math.PI), void 0 === i && (i = 0), this.directionRandomizer = i, this.radiusRange = 1, this.heightRange = 1, this.emitFromSpawnPointOnly = !1, this.angle = t, this.radius = e } return Object.defineProperty(e.prototype, "radius", { get: function () { return this._radius }, set: function (e) { this._radius = e, this._buildHeight() }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "angle", { get: function () { return this._angle }, set: function (e) { this._angle = e, this._buildHeight() }, enumerable: !0, configurable: !0 }), e.prototype._buildHeight = function () { 0 !== this._angle ? this._height = this._radius / Math.tan(this._angle / 2) : this._height = 1 }, e.prototype.startDirectionFunction = function (e, t, i) { if (1 === Math.abs(Math.cos(this._angle))) Ot.Vector3.TransformNormalFromFloatsToRef(0, 1, 0, e, t); else { var r = i.position.subtract(e.getTranslation()).normalize(), n = Ot.Scalar.RandomRange(0, this.directionRandomizer), o = Ot.Scalar.RandomRange(0, this.directionRandomizer), s = Ot.Scalar.RandomRange(0, this.directionRandomizer); r.x += n, r.y += o, r.z += s, r.normalize(), Ot.Vector3.TransformNormalFromFloatsToRef(r.x, r.y, r.z, e, t) } }, e.prototype.startPositionFunction = function (e, t, i) { var r, n = Ot.Scalar.RandomRange(0, 2 * Math.PI); r = this.emitFromSpawnPointOnly ? 1e-4 : 1 - (r = Ot.Scalar.RandomRange(0, this.heightRange)) * r; var o = this._radius - Ot.Scalar.RandomRange(0, this._radius * this.radiusRange), s = (o *= r) * Math.sin(n), a = o * Math.cos(n), l = r * this._height; Ot.Vector3.TransformCoordinatesFromFloatsToRef(s, l, a, e, t) }, e.prototype.clone = function () { var t = new e(this._radius, this._angle, this.directionRandomizer); return Ot.Tools.DeepCopy(this, t), t }, e.prototype.applyToShader = function (e) { e.setFloat2("radius", this._radius, this.radiusRange), e.setFloat("coneAngle", this._angle), e.setFloat2("height", this._height, this.heightRange), e.setFloat("directionRandomizer", this.directionRandomizer) }, e.prototype.getEffectDefines = function () { var e = "#define CONEEMITTER"; return this.emitFromSpawnPointOnly && (e += "\n#define CONEEMITTERSPAWNPOINT"), e }, e.prototype.getClassName = function () { return "ConeParticleEmitter" }, e.prototype.serialize = function () { var e = {}; return e.type = this.getClassName(), e.radius = this._radius, e.angle = this._angle, e.directionRandomizer = this.directionRandomizer, e }, e.prototype.parse = function (e) { this.radius = e.radius, this.angle = e.angle, this.directionRandomizer = e.directionRandomizer }, e }(), Ot.ConeParticleEmitter = Dt, It = $a || ($a = {}), wt = function () { function e(e, t, i) { void 0 === e && (e = 1), void 0 === t && (t = 1), void 0 === i && (i = 0), this.radius = e, this.radiusRange = t, this.directionRandomizer = i } return e.prototype.startDirectionFunction = function (e, t, i) { var r = i.position.subtract(e.getTranslation()).normalize(), n = It.Scalar.RandomRange(0, this.directionRandomizer), o = It.Scalar.RandomRange(0, this.directionRandomizer), s = It.Scalar.RandomRange(0, this.directionRandomizer); r.x += n, r.y += o, r.z += s, r.normalize(), It.Vector3.TransformNormalFromFloatsToRef(r.x, r.y, r.z, e, t) }, e.prototype.startPositionFunction = function (e, t, i) { var r = this.radius - It.Scalar.RandomRange(0, this.radius * this.radiusRange), n = It.Scalar.RandomRange(0, 1), o = It.Scalar.RandomRange(0, 2 * Math.PI), s = Math.acos(2 * n - 1), a = r * Math.cos(o) * Math.sin(s), l = r * Math.cos(s), c = r * Math.sin(o) * Math.sin(s); It.Vector3.TransformCoordinatesFromFloatsToRef(a, l, c, e, t) }, e.prototype.clone = function () { var t = new e(this.radius, this.directionRandomizer); return It.Tools.DeepCopy(this, t), t }, e.prototype.applyToShader = function (e) { e.setFloat("radius", this.radius), e.setFloat("radiusRange", this.radiusRange), e.setFloat("directionRandomizer", this.directionRandomizer) }, e.prototype.getEffectDefines = function () { return "#define SPHEREEMITTER" }, e.prototype.getClassName = function () { return "SphereParticleEmitter" }, e.prototype.serialize = function () { var e = {}; return e.type = this.getClassName(), e.radius = this.radius, e.radiusRange = this.radiusRange, e.directionRandomizer = this.directionRandomizer, e }, e.prototype.parse = function (e) { this.radius = e.radius, this.radiusRange = e.radiusRange, this.directionRandomizer = e.directionRandomizer }, e }(), Lt = function (e) { function t(t, i, r) { void 0 === t && (t = 1), void 0 === i && (i = new It.Vector3(0, 1, 0)), void 0 === r && (r = new It.Vector3(0, 1, 0)); var n = e.call(this, t) || this; return n.direction1 = i, n.direction2 = r, n } return T(t, e), t.prototype.startDirectionFunction = function (e, t, i) { var r = It.Scalar.RandomRange(this.direction1.x, this.direction2.x), n = It.Scalar.RandomRange(this.direction1.y, this.direction2.y), o = It.Scalar.RandomRange(this.direction1.z, this.direction2.z); It.Vector3.TransformNormalFromFloatsToRef(r, n, o, e, t) }, t.prototype.clone = function () { var e = new t(this.radius, this.direction1, this.direction2); return It.Tools.DeepCopy(this, e), e }, t.prototype.applyToShader = function (e) { e.setFloat("radius", this.radius), e.setFloat("radiusRange", this.radiusRange), e.setVector3("direction1", this.direction1), e.setVector3("direction2", this.direction2) }, t.prototype.getEffectDefines = function () { return "#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER" }, t.prototype.getClassName = function () { return "SphereDirectedParticleEmitter" }, t.prototype.serialize = function () { var t = e.prototype.serialize.call(this); return t.direction1 = this.direction1.asArray(), t.direction2 = this.direction2.asArray(), t }, t.prototype.parse = function (t) { e.prototype.parse.call(this, t), this.direction1.copyFrom(t.direction1), this.direction2.copyFrom(t.direction2) }, t }(It.SphereParticleEmitter = wt), It.SphereDirectedParticleEmitter = Lt, Ft = $a || ($a = {}), Bt = function () { function e(e, t, i) { void 0 === e && (e = 1), void 0 === t && (t = 1), void 0 === i && (i = 0), this.radius = e, this.radiusRange = t, this.directionRandomizer = i } return e.prototype.startDirectionFunction = function (e, t, i) { var r = i.position.subtract(e.getTranslation()).normalize(), n = Ft.Scalar.RandomRange(0, this.directionRandomizer), o = Ft.Scalar.RandomRange(0, this.directionRandomizer), s = Ft.Scalar.RandomRange(0, this.directionRandomizer); r.x += n, r.y += o, r.z += s, r.normalize(), Ft.Vector3.TransformNormalFromFloatsToRef(r.x, r.y, r.z, e, t) }, e.prototype.startPositionFunction = function (e, t, i) { var r = this.radius - Ft.Scalar.RandomRange(0, this.radius * this.radiusRange), n = Ft.Scalar.RandomRange(0, 1), o = Ft.Scalar.RandomRange(0, 2 * Math.PI), s = Math.acos(2 * n - 1), a = r * Math.cos(o) * Math.sin(s), l = r * Math.cos(s), c = r * Math.sin(o) * Math.sin(s); Ft.Vector3.TransformCoordinatesFromFloatsToRef(a, Math.abs(l), c, e, t) }, e.prototype.clone = function () { var t = new e(this.radius, this.directionRandomizer); return Ft.Tools.DeepCopy(this, t), t }, e.prototype.applyToShader = function (e) { e.setFloat("radius", this.radius), e.setFloat("radiusRange", this.radiusRange), e.setFloat("directionRandomizer", this.directionRandomizer) }, e.prototype.getEffectDefines = function () { return "#define HEMISPHERICEMITTER" }, e.prototype.getClassName = function () { return "HemisphericParticleEmitter" }, e.prototype.serialize = function () { var e = {}; return e.type = this.getClassName(), e.radius = this.radius, e.radiusRange = this.radiusRange, e.directionRandomizer = this.directionRandomizer, e }, e.prototype.parse = function (e) { this.radius = e.radius, this.radiusRange = e.radiusRange, this.directionRandomizer = e.directionRandomizer }, e }(), Ft.HemisphericParticleEmitter = Bt, Nt = $a || ($a = {}), Vt = function () { function e() { this.direction1 = new Nt.Vector3(0, 1, 0), this.direction2 = new Nt.Vector3(0, 1, 0) } return e.prototype.startDirectionFunction = function (e, t, i) { var r = Nt.Scalar.RandomRange(this.direction1.x, this.direction2.x), n = Nt.Scalar.RandomRange(this.direction1.y, this.direction2.y), o = Nt.Scalar.RandomRange(this.direction1.z, this.direction2.z); Nt.Vector3.TransformNormalFromFloatsToRef(r, n, o, e, t) }, e.prototype.startPositionFunction = function (e, t, i) { Nt.Vector3.TransformCoordinatesFromFloatsToRef(0, 0, 0, e, t) }, e.prototype.clone = function () { var t = new e; return Nt.Tools.DeepCopy(this, t), t }, e.prototype.applyToShader = function (e) { e.setVector3("direction1", this.direction1), e.setVector3("direction2", this.direction2) }, e.prototype.getEffectDefines = function () { return "#define POINTEMITTER" }, e.prototype.getClassName = function () { return "PointParticleEmitter" }, e.prototype.serialize = function () { var e = {}; return e.type = this.getClassName(), e.direction1 = this.direction1.asArray(), e.direction2 = this.direction2.asArray(), e }, e.prototype.parse = function (e) { Nt.Vector3.FromArrayToRef(e.direction1, 0, this.direction1), Nt.Vector3.FromArrayToRef(e.direction2, 0, this.direction2) }, e }(), Nt.PointParticleEmitter = Vt, (Ut = $a || ($a = {})).AbstractScene.AddParser(Ut.SceneComponentConstants.NAME_PARTICLESYSTEM, function (e, t, i, r) { var n = Ut.AbstractScene.GetIndividualParser(Ut.SceneComponentConstants.NAME_PARTICLESYSTEM); if (n && void 0 !== e.particleSystems && null !== e.particleSystems) for (var o = 0, s = e.particleSystems.length; o < s; o++) { var a = e.particleSystems[o]; i.particleSystems.push(n(a, t, r)) } }), Ut.AbstractScene.AddIndividualParser(Ut.SceneComponentConstants.NAME_PARTICLESYSTEM, function (e, t, i) { return e.activeParticleCount ? Ut.GPUParticleSystem.Parse(e, t, i) : Ut.ParticleSystem.Parse(e, t, i) }), Ut.Engine.prototype.createEffectForParticles = function (e, t, i, r, n, o, s) { void 0 === t && (t = []), void 0 === i && (i = []), void 0 === r && (r = ""); var a = Ut.ParticleSystem._GetAttributeNamesOrOptions(), l = Ut.ParticleSystem._GetEffectCreationOptions(); return -1 === r.indexOf(" BILLBOARD") && (r += "\n#define BILLBOARD\n"), -1 === i.indexOf("diffuseSampler") && i.push("diffuseSampler"), this.createEffect({ vertex: "particles", fragmentElement: e }, a, l.concat(t), i, r, n, o, s) }, Ut.Mesh.prototype.getEmittedParticleSystems = function () { for (var e = new Array, t = 0; t < this.getScene().particleSystems.length; t++) { var i = this.getScene().particleSystems[t]; i.emitter === this && e.push(i) } return e }, Ut.Mesh.prototype.getHierarchyEmittedParticleSystems = function () { var e = new Array, t = this.getDescendants(); t.push(this); for (var i = 0; i < this.getScene().particleSystems.length; i++) { var r = this.getScene().particleSystems[i], n = r.emitter; n.position && -1 !== t.indexOf(n) && e.push(r) } return e }, function (e) { var t, i; (i = t = e.SubEmitterType || (e.SubEmitterType = {}))[i.ATTACHED = 0] = "ATTACHED", i[i.END = 1] = "END"; var r = function () { function i(i) { this.particleSystem = i, this.type = t.END, this.inheritDirection = !1, this.inheritedVelocityAmount = 0, i.emitter && i.emitter.dispose || (i.emitter = new e.AbstractMesh("SubemitterSystemEmitter", i.getScene())), i.onDisposeObservable.add(function () { i.emitter && i.emitter.dispose && i.emitter.dispose() }) } return i.prototype.clone = function () { var t = this.particleSystem.emitter; t ? t instanceof e.Vector3 ? t = t.clone() : t instanceof e.AbstractMesh && ((t = new e.Mesh("", t.getScene())).isVisible = !1) : t = new e.Vector3; var r = new i(this.particleSystem.clone("", t)); return r.type = this.type, r.inheritDirection = this.inheritDirection, r.inheritedVelocityAmount = this.inheritedVelocityAmount, r.particleSystem._disposeEmitterOnDispose = !0, r.particleSystem.disposeOnStop = !0, r }, i.prototype.serialize = function () { var e = {}; return e.type = this.type, e.inheritDirection = this.inheritDirection, e.inheritedVelocityAmount = this.inheritedVelocityAmount, e.particleSystem = this.particleSystem.serialize(), e }, i.Parse = function (t, r, n) { var o = t.particleSystem, s = new i(e.ParticleSystem.Parse(o, r, n)); return s.type = t.type, s.inheritDirection = t.inheritDirection, s.inheritedVelocityAmount = t.inheritedVelocityAmount, s.particleSystem._isSubEmitter = !0, s }, i.prototype.dispose = function () { this.particleSystem.dispose() }, i }(); e.SubEmitter = r }($a || ($a = {})), Gt = function (e) { function t(t, i, r, n) { void 0 === n && (n = {}); var o = e.call(this, t, i) || this; return o._textures = {}, o._textureArrays = {}, o._floats = {}, o._ints = {}, o._floatsArrays = {}, o._colors3 = {}, o._colors3Arrays = {}, o._colors4 = {}, o._vectors2 = {}, o._vectors3 = {}, o._vectors4 = {}, o._matrices = {}, o._matrices3x3 = {}, o._matrices2x2 = {}, o._vectors2Arrays = {}, o._vectors3Arrays = {}, o._cachedWorldViewMatrix = new zt.Matrix, o._shaderPath = r, o._options = tl({ needAlphaBlending: !1, needAlphaTesting: !1, attributes: ["position", "normal", "uv"], uniforms: ["worldViewProjection"], uniformBuffers: [], samplers: [], defines: [] }, n), o } return T(t, e), t.prototype.getClassName = function () { return "ShaderMaterial" }, t.prototype.needAlphaBlending = function () { return this.alpha < 1 || this._options.needAlphaBlending }, t.prototype.needAlphaTesting = function () { return this._options.needAlphaTesting }, t.prototype._checkUniform = function (e) { -1 === this._options.uniforms.indexOf(e) && this._options.uniforms.push(e) }, t.prototype.setTexture = function (e, t) { return -1 === this._options.samplers.indexOf(e) && this._options.samplers.push(e), this._textures[e] = t, this }, t.prototype.setTextureArray = function (e, t) { return -1 === this._options.samplers.indexOf(e) && this._options.samplers.push(e), this._checkUniform(e), this._textureArrays[e] = t, this }, t.prototype.setFloat = function (e, t) { return this._checkUniform(e), this._floats[e] = t, this }, t.prototype.setInt = function (e, t) { return this._checkUniform(e), this._ints[e] = t, this }, t.prototype.setFloats = function (e, t) { return this._checkUniform(e), this._floatsArrays[e] = t, this }, t.prototype.setColor3 = function (e, t) { return this._checkUniform(e), this._colors3[e] = t, this }, t.prototype.setColor3Array = function (e, t) { return this._checkUniform(e), this._colors3Arrays[e] = t.reduce(function (e, t) { return t.toArray(e, e.length), e }, []), this }, t.prototype.setColor4 = function (e, t) { return this._checkUniform(e), this._colors4[e] = t, this }, t.prototype.setVector2 = function (e, t) { return this._checkUniform(e), this._vectors2[e] = t, this }, t.prototype.setVector3 = function (e, t) { return this._checkUniform(e), this._vectors3[e] = t, this }, t.prototype.setVector4 = function (e, t) { return this._checkUniform(e), this._vectors4[e] = t, this }, t.prototype.setMatrix = function (e, t) { return this._checkUniform(e), this._matrices[e] = t, this }, t.prototype.setMatrix3x3 = function (e, t) { return this._checkUniform(e), this._matrices3x3[e] = t, this }, t.prototype.setMatrix2x2 = function (e, t) { return this._checkUniform(e), this._matrices2x2[e] = t, this }, t.prototype.setArray2 = function (e, t) { return this._checkUniform(e), this._vectors2Arrays[e] = t, this }, t.prototype.setArray3 = function (e, t) { return this._checkUniform(e), this._vectors3Arrays[e] = t, this }, t.prototype._checkCache = function (e, t, i) { return !t || (this._effect && this._effect.defines.indexOf("#define INSTANCES"), !1) }, t.prototype.isReady = function (e, t) { var i = this.getScene(), r = i.getEngine(); if (!this.checkReadyOnEveryCall && this._renderId === i.getRenderId() && this._checkCache(i, e, t)) return !0; for (var n = [], o = [], s = new zt.EffectFallbacks, a = 0; a < this._options.defines.length; a++)n.push(this._options.defines[a]); for (a = 0; a < this._options.attributes.length; a++)o.push(this._options.attributes[a]); for (var l in e && e.isVerticesDataPresent(zt.VertexBuffer.ColorKind) && (o.push(zt.VertexBuffer.ColorKind), n.push("#define VERTEXCOLOR")), t && (n.push("#define INSTANCES"), zt.MaterialHelper.PrepareAttributesForInstances(o, n)), e && e.useBones && e.computeBonesUsingShaders && e.skeleton ? (o.push(zt.VertexBuffer.MatricesIndicesKind), o.push(zt.VertexBuffer.MatricesWeightsKind), 4 < e.numBoneInfluencers && (o.push(zt.VertexBuffer.MatricesIndicesExtraKind), o.push(zt.VertexBuffer.MatricesWeightsExtraKind)), n.push("#define NUM_BONE_INFLUENCERS " + e.numBoneInfluencers), n.push("#define BonesPerMesh " + (e.skeleton.bones.length + 1)), s.addCPUSkinningFallback(0, e), -1 === this._options.uniforms.indexOf("mBones") && this._options.uniforms.push("mBones")) : n.push("#define NUM_BONE_INFLUENCERS 0"), this._textures) if (!this._textures[l].isReady()) return !1; e && this._shouldTurnAlphaTestOn(e) && n.push("#define ALPHATEST"); var c = this._effect, h = n.join("\n"); return this._effect = r.createEffect(this._shaderPath, { attributes: o, uniformsNames: this._options.uniforms, uniformBuffersNames: this._options.uniformBuffers, samplers: this._options.samplers, defines: h, fallbacks: s, onCompiled: this.onCompiled, onError: this.onError }, r), !!this._effect.isReady() && (c !== this._effect && i.resetCachedMaterial(), this._renderId = i.getRenderId(), !0) }, t.prototype.bindOnlyWorldMatrix = function (e) { var t = this.getScene(); this._effect && (-1 !== this._options.uniforms.indexOf("world") && this._effect.setMatrix("world", e), -1 !== this._options.uniforms.indexOf("worldView") && (e.multiplyToRef(t.getViewMatrix(), this._cachedWorldViewMatrix), this._effect.setMatrix("worldView", this._cachedWorldViewMatrix)), -1 !== this._options.uniforms.indexOf("worldViewProjection") && this._effect.setMatrix("worldViewProjection", e.multiply(t.getTransformMatrix()))) }, t.prototype.bind = function (e, t) { if (this.bindOnlyWorldMatrix(e), this._effect && this.getScene().getCachedMaterial() !== this) { var i; for (i in -1 !== this._options.uniforms.indexOf("view") && this._effect.setMatrix("view", this.getScene().getViewMatrix()), -1 !== this._options.uniforms.indexOf("projection") && this._effect.setMatrix("projection", this.getScene().getProjectionMatrix()), -1 !== this._options.uniforms.indexOf("viewProjection") && this._effect.setMatrix("viewProjection", this.getScene().getTransformMatrix()), zt.MaterialHelper.BindBonesParameters(t, this._effect), this._textures) this._effect.setTexture(i, this._textures[i]); for (i in this._textureArrays) this._effect.setTextureArray(i, this._textureArrays[i]); for (i in this._ints) this._effect.setInt(i, this._ints[i]); for (i in this._floats) this._effect.setFloat(i, this._floats[i]); for (i in this._floatsArrays) this._effect.setArray(i, this._floatsArrays[i]); for (i in this._colors3) this._effect.setColor3(i, this._colors3[i]); for (i in this._colors3Arrays) this._effect.setArray3(i, this._colors3Arrays[i]); for (i in this._colors4) { var r = this._colors4[i]; this._effect.setFloat4(i, r.r, r.g, r.b, r.a) } for (i in this._vectors2) this._effect.setVector2(i, this._vectors2[i]); for (i in this._vectors3) this._effect.setVector3(i, this._vectors3[i]); for (i in this._vectors4) this._effect.setVector4(i, this._vectors4[i]); for (i in this._matrices) this._effect.setMatrix(i, this._matrices[i]); for (i in this._matrices3x3) this._effect.setMatrix3x3(i, this._matrices3x3[i]); for (i in this._matrices2x2) this._effect.setMatrix2x2(i, this._matrices2x2[i]); for (i in this._vectors2Arrays) this._effect.setArray2(i, this._vectors2Arrays[i]); for (i in this._vectors3Arrays) this._effect.setArray3(i, this._vectors3Arrays[i]) } this._afterBind(t) }, t.prototype.getActiveTextures = function () { var t = e.prototype.getActiveTextures.call(this); for (var i in this._textures) t.push(this._textures[i]); for (var i in this._textureArrays) for (var r = this._textureArrays[i], n = 0; n < r.length; n++)t.push(r[n]); return t }, t.prototype.hasTexture = function (t) { if (e.prototype.hasTexture.call(this, t)) return !0; for (var i in this._textures) if (this._textures[i] === t) return !0; for (var i in this._textureArrays) for (var r = this._textureArrays[i], n = 0; n < r.length; n++)if (r[n] === t) return !0; return !1 }, t.prototype.clone = function (e) { return new t(e, this.getScene(), this._shaderPath, this._options) }, t.prototype.dispose = function (t, i) { if (i) { var r; for (r in this._textures) this._textures[r].dispose(); for (r in this._textureArrays) for (var n = this._textureArrays[r], o = 0; o < n.length; o++)n[o].dispose() } this._textures = {}, e.prototype.dispose.call(this, t, i) }, t.prototype.serialize = function () { var e, t = zt.SerializationHelper.Serialize(this); for (e in t.customType = "BABYLON.ShaderMaterial", t.options = this._options, t.shaderPath = this._shaderPath, t.textures = {}, this._textures) t.textures[e] = this._textures[e].serialize(); for (e in t.textureArrays = {}, this._textureArrays) { t.textureArrays[e] = []; for (var i = this._textureArrays[e], r = 0; r < i.length; r++)t.textureArrays[e].push(i[r].serialize()) } for (e in t.floats = {}, this._floats) t.floats[e] = this._floats[e]; for (e in t.FloatArrays = {}, this._floatsArrays) t.FloatArrays[e] = this._floatsArrays[e]; for (e in t.colors3 = {}, this._colors3) t.colors3[e] = this._colors3[e].asArray(); for (e in t.colors3Arrays = {}, this._colors3Arrays) t.colors3Arrays[e] = this._colors3Arrays[e]; for (e in t.colors4 = {}, this._colors4) t.colors4[e] = this._colors4[e].asArray(); for (e in t.vectors2 = {}, this._vectors2) t.vectors2[e] = this._vectors2[e].asArray(); for (e in t.vectors3 = {}, this._vectors3) t.vectors3[e] = this._vectors3[e].asArray(); for (e in t.vectors4 = {}, this._vectors4) t.vectors4[e] = this._vectors4[e].asArray(); for (e in t.matrices = {}, this._matrices) t.matrices[e] = this._matrices[e].asArray(); for (e in t.matrices3x3 = {}, this._matrices3x3) t.matrices3x3[e] = this._matrices3x3[e]; for (e in t.matrices2x2 = {}, this._matrices2x2) t.matrices2x2[e] = this._matrices2x2[e]; for (e in t.vectors2Arrays = {}, this._vectors2Arrays) t.vectors2Arrays[e] = this._vectors2Arrays[e]; for (e in t.vectors3Arrays = {}, this._vectors3Arrays) t.vectors3Arrays[e] = this._vectors3Arrays[e]; return t }, t.Parse = function (e, i, r) { var n, o = zt.SerializationHelper.Parse(function () { return new t(e.name, i, e.shaderPath, e.options) }, e, i, r); for (n in e.textures) o.setTexture(n, zt.Texture.Parse(e.textures[n], i, r)); for (n in e.textureArrays) { for (var s = e.textureArrays[n], a = new Array, l = 0; l < s.length; l++)a.push(zt.Texture.Parse(s[l], i, r)); o.setTextureArray(n, a) } for (n in e.floats) o.setFloat(n, e.floats[n]); for (n in e.floatsArrays) o.setFloats(n, e.floatsArrays[n]); for (n in e.colors3) o.setColor3(n, zt.Color3.FromArray(e.colors3[n])); for (n in e.colors3Arrays) { var c = e.colors3Arrays[n].reduce(function (e, t, i) { return i % 3 == 0 ? e.push([t]) : e[e.length - 1].push(t), e }, []).map(function (e) { return zt.Color3.FromArray(e) }); o.setColor3Array(n, c) } for (n in e.colors4) o.setColor4(n, zt.Color4.FromArray(e.colors4[n])); for (n in e.vectors2) o.setVector2(n, zt.Vector2.FromArray(e.vectors2[n])); for (n in e.vectors3) o.setVector3(n, zt.Vector3.FromArray(e.vectors3[n])); for (n in e.vectors4) o.setVector4(n, zt.Vector4.FromArray(e.vectors4[n])); for (n in e.matrices) o.setMatrix(n, zt.Matrix.FromArray(e.matrices[n])); for (n in e.matrices3x3) o.setMatrix3x3(n, e.matrices3x3[n]); for (n in e.matrices2x2) o.setMatrix2x2(n, e.matrices2x2[n]); for (n in e.vectors2Arrays) o.setArray2(n, e.vectors2Arrays[n]); for (n in e.vectors3Arrays) o.setArray3(n, e.vectors3Arrays[n]); return o }, t }((zt = $a || ($a = {})).Material), zt.ShaderMaterial = Gt, Wt = function (e) { function t(t, i) { var r = e.call(this, t, i) || this; return r.generateOctree = !1, r } return T(t, e), t.prototype.getClassName = function () { return "GroundMesh" }, Object.defineProperty(t.prototype, "subdivisions", { get: function () { return Math.min(this._subdivisionsX, this._subdivisionsY) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "subdivisionsX", { get: function () { return this._subdivisionsX }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "subdivisionsY", { get: function () { return this._subdivisionsY }, enumerable: !0, configurable: !0 }), t.prototype.optimize = function (e, t) { void 0 === t && (t = 32), this._subdivisionsX = e, this._subdivisionsY = e, this.subdivide(e), this.createOrUpdateSubmeshesOctree && this.createOrUpdateSubmeshesOctree(t) }, t.prototype.getHeightAtCoordinates = function (e, t) { var i = this.getWorldMatrix(), r = kt.Tmp.Matrix[5]; i.invertToRef(r); var n = kt.Tmp.Vector3[8]; if (kt.Vector3.TransformCoordinatesFromFloatsToRef(e, 0, t, r, n), e = n.x, t = n.z, e < this._minX || e > this._maxX || t < this._minZ || t > this._maxZ) return this.position.y; this._heightQuads && 0 != this._heightQuads.length || (this._initHeightQuads(), this._computeHeightQuads()); var o = this._getFacetAt(e, t), s = -(o.x * e + o.z * t + o.w) / o.y; return kt.Vector3.TransformCoordinatesFromFloatsToRef(0, s, 0, i, n), n.y }, t.prototype.getNormalAtCoordinates = function (e, t) { var i = new kt.Vector3(0, 1, 0); return this.getNormalAtCoordinatesToRef(e, t, i), i }, t.prototype.getNormalAtCoordinatesToRef = function (e, t, i) { var r = this.getWorldMatrix(), n = kt.Tmp.Matrix[5]; r.invertToRef(n); var o = kt.Tmp.Vector3[8]; if (kt.Vector3.TransformCoordinatesFromFloatsToRef(e, 0, t, n, o), e = o.x, t = o.z, e < this._minX || e > this._maxX || t < this._minZ || t > this._maxZ) return this; this._heightQuads && 0 != this._heightQuads.length || (this._initHeightQuads(), this._computeHeightQuads()); var s = this._getFacetAt(e, t); return kt.Vector3.TransformNormalFromFloatsToRef(s.x, s.y, s.z, r, i), this }, t.prototype.updateCoordinateHeights = function () { return this._heightQuads && 0 != this._heightQuads.length || this._initHeightQuads(), this._computeHeightQuads(), this }, t.prototype._getFacetAt = function (e, t) { var i = Math.floor((e + this._maxX) * this._subdivisionsX / this._width), r = Math.floor(-(t + this._maxZ) * this._subdivisionsY / this._height + this._subdivisionsY), n = this._heightQuads[r * this._subdivisionsX + i]; return t < n.slope.x * e + n.slope.y ? n.facet1 : n.facet2 }, t.prototype._initHeightQuads = function () { var e = this._subdivisionsX, t = this._subdivisionsY; this._heightQuads = new Array; for (var i = 0; i < t; i++)for (var r = 0; r < e; r++) { var n = { slope: kt.Vector2.Zero(), facet1: new kt.Vector4(0, 0, 0, 0), facet2: new kt.Vector4(0, 0, 0, 0) }; this._heightQuads[i * e + r] = n } return this }, t.prototype._computeHeightQuads = function () { var e = this.getVerticesData(kt.VertexBuffer.PositionKind); if (!e) return this; for (var t = kt.Tmp.Vector3[3], i = kt.Tmp.Vector3[2], r = kt.Tmp.Vector3[1], n = kt.Tmp.Vector3[0], o = kt.Tmp.Vector3[4], s = kt.Tmp.Vector3[5], a = kt.Tmp.Vector3[6], l = kt.Tmp.Vector3[7], c = kt.Tmp.Vector3[8], h = 0, u = 0, d = 0, f = 0, p = 0, _ = 0, m = 0, g = this._subdivisionsX, v = this._subdivisionsY, y = 0; y < v; y++)for (var b = 0; b < g; b++) { h = 3 * b, u = y * (g + 1) * 3, d = (y + 1) * (g + 1) * 3, t.x = e[u + h], t.y = e[u + h + 1], t.z = e[u + h + 2], i.x = e[u + h + 3], i.y = e[u + h + 4], i.z = e[u + h + 5], r.x = e[d + h], r.y = e[d + h + 1], r.z = e[d + h + 2], n.x = e[d + h + 3], n.y = e[d + h + 4], n.z = e[d + h + 5], f = (n.z - t.z) / (n.x - t.x), p = t.z - f * t.x, i.subtractToRef(t, o), r.subtractToRef(t, s), n.subtractToRef(t, a), kt.Vector3.CrossToRef(a, s, l), kt.Vector3.CrossToRef(o, a, c), l.normalize(), c.normalize(), _ = -(l.x * t.x + l.y * t.y + l.z * t.z), m = -(c.x * i.x + c.y * i.y + c.z * i.z); var T = this._heightQuads[y * g + b]; T.slope.copyFromFloats(f, p), T.facet1.copyFromFloats(l.x, l.y, l.z, _), T.facet2.copyFromFloats(c.x, c.y, c.z, m) } return this }, t.prototype.serialize = function (t) { e.prototype.serialize.call(this, t), t.subdivisionsX = this._subdivisionsX, t.subdivisionsY = this._subdivisionsY, t.minX = this._minX, t.maxX = this._maxX, t.minZ = this._minZ, t.maxZ = this._maxZ, t.width = this._width, t.height = this._height }, t.Parse = function (e, i) { var r = new t(e.name, i); return r._subdivisionsX = e.subdivisionsX || 1, r._subdivisionsY = e.subdivisionsY || 1, r._minX = e.minX, r._maxX = e.maxX, r._minZ = e.minZ, r._maxZ = e.maxZ, r._width = e.width, r._height = e.height, r }, t }((kt = $a || ($a = {})).Mesh), kt.GroundMesh = Wt, Xt = function (e) { function t(t, i) { var r = e.call(this, t, i.getScene()) || this; return i.instances.push(r), r._sourceMesh = i, r.position.copyFrom(i.position), r.rotation.copyFrom(i.rotation), r.scaling.copyFrom(i.scaling), i.rotationQuaternion && (r.rotationQuaternion = i.rotationQuaternion.clone()), r.infiniteDistance = i.infiniteDistance, r.setPivotMatrix(i.getPivotMatrix()), r.refreshBoundingInfo(), r._syncSubMeshes(), r } return T(t, e), t.prototype.getClassName = function () { return "InstancedMesh" }, Object.defineProperty(t.prototype, "receiveShadows", { get: function () { return this._sourceMesh.receiveShadows }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "material", { get: function () { return this._sourceMesh.material }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "visibility", { get: function () { return this._sourceMesh.visibility }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "skeleton", { get: function () { return this._sourceMesh.skeleton }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "renderingGroupId", { get: function () { return this._sourceMesh.renderingGroupId }, set: function (e) { this._sourceMesh && e !== this._sourceMesh.renderingGroupId && Ht.Tools.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene") }, enumerable: !0, configurable: !0 }), t.prototype.getTotalVertices = function () { return this._sourceMesh.getTotalVertices() }, Object.defineProperty(t.prototype, "sourceMesh", { get: function () { return this._sourceMesh }, enumerable: !0, configurable: !0 }), t.prototype.isReady = function (e) { return void 0 === e && (e = !1), this._sourceMesh.isReady(e, !0) }, t.prototype.getVerticesData = function (e, t) { return this._sourceMesh.getVerticesData(e, t) }, t.prototype.setVerticesData = function (e, t, i, r) { return this.sourceMesh && this.sourceMesh.setVerticesData(e, t, i, r), this.sourceMesh }, t.prototype.updateVerticesData = function (e, t, i, r) { return this.sourceMesh && this.sourceMesh.updateVerticesData(e, t, i, r), this.sourceMesh }, t.prototype.setIndices = function (e, t) { return void 0 === t && (t = null), this.sourceMesh && this.sourceMesh.setIndices(e, t), this.sourceMesh }, t.prototype.isVerticesDataPresent = function (e) { return this._sourceMesh.isVerticesDataPresent(e) }, t.prototype.getIndices = function () { return this._sourceMesh.getIndices() }, Object.defineProperty(t.prototype, "_positions", { get: function () { return this._sourceMesh._positions }, enumerable: !0, configurable: !0 }), t.prototype.refreshBoundingInfo = function () { var e = this._sourceMesh.getBoundingInfo(); return this._boundingInfo = new Ht.BoundingInfo(e.minimum.clone(), e.maximum.clone()), this._updateBoundingInfo(), this }, t.prototype._preActivate = function () { return this._currentLOD && this._currentLOD._preActivate(), this }, t.prototype._activate = function (e) { return this._currentLOD && this._currentLOD._registerInstanceForRenderId(this, e), this }, t.prototype.getLOD = function (e) { if (!e) return this; var t = this.getBoundingInfo(); return this._currentLOD = this.sourceMesh.getLOD(e, t.boundingSphere), this._currentLOD === this.sourceMesh ? this : this._currentLOD }, t.prototype._syncSubMeshes = function () { if (this.releaseSubMeshes(), this._sourceMesh.subMeshes) for (var e = 0; e < this._sourceMesh.subMeshes.length; e++)this._sourceMesh.subMeshes[e].clone(this, this._sourceMesh); return this }, t.prototype._generatePointsArray = function () { return this._sourceMesh._generatePointsArray() }, t.prototype.clone = function (e, t, i) { var r = this._sourceMesh.createInstance(e); if (Ht.Tools.DeepCopy(this, r, ["name", "subMeshes", "uniqueId"], []), this.refreshBoundingInfo(), t && (r.parent = t), !i) for (var n = 0; n < this.getScene().meshes.length; n++) { var o = this.getScene().meshes[n]; o.parent === this && o.clone(o.name, r) } return r.computeWorldMatrix(!0), r }, t.prototype.dispose = function (t, i) { void 0 === i && (i = !1); var r = this._sourceMesh.instances.indexOf(this); this._sourceMesh.instances.splice(r, 1), e.prototype.dispose.call(this, t, i) }, t }((Ht = $a || ($a = {})).AbstractMesh), Ht.InstancedMesh = Xt, Yt = function (e) { function t(t, i, r, n, o, s, a) { void 0 === i && (i = null), void 0 === r && (r = null); var l = e.call(this, t, i, r, n, o) || this; l.useVertexColor = s, l.useVertexAlpha = a, l.color = new jt.Color3(1, 1, 1), l.alpha = 1, n && (l.color = n.color.clone(), l.alpha = n.alpha, l.useVertexColor = n.useVertexColor, l.useVertexAlpha = n.useVertexAlpha), l._intersectionThreshold = .1; var c = { attributes: [jt.VertexBuffer.PositionKind, "world0", "world1", "world2", "world3"], uniforms: ["world", "viewProjection"], needAlphaBlending: !0, defines: [] }; return !1 === a && (c.needAlphaBlending = !1), s ? (c.defines.push("#define VERTEXCOLOR"), c.attributes.push(jt.VertexBuffer.ColorKind)) : c.uniforms.push("color"), l._colorShader = new jt.ShaderMaterial("colorShader", l.getScene(), "color", c), l } return T(t, e), Object.defineProperty(t.prototype, "intersectionThreshold", { get: function () { return this._intersectionThreshold }, set: function (e) { this._intersectionThreshold !== e && (this._intersectionThreshold = e, this.geometry && (this.geometry.boundingBias = new jt.Vector2(0, e))) }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "LinesMesh" }, Object.defineProperty(t.prototype, "material", { get: function () { return this._colorShader }, set: function (e) { }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "checkCollisions", { get: function () { return !1 }, enumerable: !0, configurable: !0 }), t.prototype._bind = function (e, t, i) { return this._geometry && (this._geometry._bind(this._colorShader.getEffect()), this.useVertexColor || this._colorShader.setColor4("color", this.color.toColor4(this.alpha))), this }, t.prototype._draw = function (e, t, i) { return this._geometry && this._geometry.getVertexBuffers() && (this._unIndexed || this._geometry.getIndexBuffer()) && this.getScene().getEngine().drawElementsType(jt.Material.LineListDrawMode, e.indexStart, e.indexCount, i), this }, t.prototype.dispose = function (t) { this._colorShader.dispose(), e.prototype.dispose.call(this, t) }, t.prototype.clone = function (e, i, r) { return new t(e, this.getScene(), i, this, r) }, t }((jt = $a || ($a = {})).Mesh), jt.LinesMesh = Yt, Kt = $a || ($a = {}), Qt = function () { function e() { this._count = 0, this._data = {} } return e.prototype.copyFrom = function (e) { var t = this; this.clear(), e.forEach(function (e, i) { return t.add(e, i) }) }, e.prototype.get = function (e) { var t = this._data[e]; if (void 0 !== t) return t }, e.prototype.getOrAddWithFactory = function (e, t) { var i = this.get(e); return void 0 !== i || (i = t(e)) && this.add(e, i), i }, e.prototype.getOrAdd = function (e, t) { var i = this.get(e); return void 0 !== i ? i : (this.add(e, t), t) }, e.prototype.contains = function (e) { return void 0 !== this._data[e] }, e.prototype.add = function (e, t) { return void 0 === this._data[e] && (this._data[e] = t, ++this._count, !0) }, e.prototype.set = function (e, t) { return void 0 !== this._data[e] && (this._data[e] = t, !0) }, e.prototype.getAndRemove = function (e) { var t = this.get(e); return void 0 !== t ? (delete this._data[e], --this._count, t) : null }, e.prototype.remove = function (e) { return !!this.contains(e) && (delete this._data[e], --this._count, !0) }, e.prototype.clear = function () { this._data = {}, this._count = 0 }, Object.defineProperty(e.prototype, "count", { get: function () { return this._count }, enumerable: !0, configurable: !0 }), e.prototype.forEach = function (e) { for (var t in this._data) e(t, this._data[t]) }, e.prototype.first = function (e) { for (var t in this._data) { var i = e(t, this._data[t]); if (i) return i } return null }, e }(), Kt.StringDictionary = Qt, qt = (Zt = $a || ($a = {})).Debug || (Zt.Debug = {}), Jt = function () { function e(e, t, i, r, n) { void 0 === r && (r = !0), void 0 === n && (n = 1), this.skeleton = e, this.mesh = t, this.autoUpdateBonesMatrices = r, this.renderingGroupId = n, this.color = Zt.Color3.White(), this._debugLines = new Array, this._isEnabled = !1, this._scene = i, this.update(), this._renderFunction = this.update.bind(this) } return Object.defineProperty(e.prototype, "isEnabled", { get: function () { return this._isEnabled }, set: function (e) { this._isEnabled !== e && ((this._isEnabled = e) ? this._scene.registerBeforeRender(this._renderFunction) : this._scene.unregisterBeforeRender(this._renderFunction)) }, enumerable: !0, configurable: !0 }), e.prototype._getBonePosition = function (e, t, i, r, n, o) { void 0 === r && (r = 0), void 0 === n && (n = 0), void 0 === o && (o = 0); var s = Zt.Tmp.Matrix[0], a = t.getParent(); if (s.copyFrom(t.getLocalMatrix()), 0 !== r || 0 !== n || 0 !== o) { var l = Zt.Tmp.Matrix[1]; Zt.Matrix.IdentityToRef(l), l.m[12] = r, l.m[13] = n, l.m[14] = o, l.multiplyToRef(s, s) } a && s.multiplyToRef(a.getAbsoluteTransform(), s), s.multiplyToRef(i, s), e.x = s.m[12], e.y = s.m[13], e.z = s.m[14] }, e.prototype._getLinesForBonesWithLength = function (e, t) { for (var i = e.length, r = this.mesh.position, n = 0; n < i; n++) { var o = e[n], s = this._debugLines[n]; s || (s = [Zt.Vector3.Zero(), Zt.Vector3.Zero()], this._debugLines[n] = s), this._getBonePosition(s[0], o, t), this._getBonePosition(s[1], o, t, 0, o.length, 0), s[0].subtractInPlace(r), s[1].subtractInPlace(r) } }, e.prototype._getLinesForBonesNoLength = function (e, t) { for (var i = e.length, r = 0, n = this.mesh.position, o = i - 1; 0 <= o; o--) { var s = e[o], a = s.getParent(); if (a) { var l = this._debugLines[r]; l || (l = [Zt.Vector3.Zero(), Zt.Vector3.Zero()], this._debugLines[r] = l), s.getAbsolutePositionToRef(this.mesh, l[0]), a.getAbsolutePositionToRef(this.mesh, l[1]), l[0].subtractInPlace(n), l[1].subtractInPlace(n), r++ } } }, e.prototype.update = function () { this.autoUpdateBonesMatrices && this.skeleton.computeAbsoluteTransforms(), void 0 === this.skeleton.bones[0].length ? this._getLinesForBonesNoLength(this.skeleton.bones, this.mesh.getWorldMatrix()) : this._getLinesForBonesWithLength(this.skeleton.bones, this.mesh.getWorldMatrix()), this._debugMesh ? Zt.MeshBuilder.CreateLineSystem("", { lines: this._debugLines, updatable: !0, instance: this._debugMesh }, this._scene) : (this._debugMesh = Zt.MeshBuilder.CreateLineSystem("", { lines: this._debugLines, updatable: !0, instance: null }, this._scene), this._debugMesh.renderingGroupId = this.renderingGroupId), this._debugMesh.position.copyFrom(this.mesh.position), this._debugMesh.color = this.color }, e.prototype.dispose = function () { this._debugMesh && (this.isEnabled = !1, this._debugMesh.dispose(), this._debugMesh = null) }, e }(), qt.SkeletonViewer = Jt, ei = ($t = $a || ($a = {})).Debug || ($t.Debug = {}), ti = function () { function e(e, t) { void 0 === t && (t = 1), this._xline = [$t.Vector3.Zero(), $t.Vector3.Zero()], this._yline = [$t.Vector3.Zero(), $t.Vector3.Zero()], this._zline = [$t.Vector3.Zero(), $t.Vector3.Zero()], this.scaleLines = 1, this.scaleLines = t, this._xmesh = $t.Mesh.CreateLines("xline", this._xline, e, !0), this._ymesh = $t.Mesh.CreateLines("yline", this._yline, e, !0), this._zmesh = $t.Mesh.CreateLines("zline", this._zline, e, !0), this._xmesh.renderingGroupId = 2, this._ymesh.renderingGroupId = 2, this._zmesh.renderingGroupId = 2, this._xmesh.material.checkReadyOnlyOnce = !0, this._xmesh.color = new $t.Color3(1, 0, 0), this._ymesh.material.checkReadyOnlyOnce = !0, this._ymesh.color = new $t.Color3(0, 1, 0), this._zmesh.material.checkReadyOnlyOnce = !0, this._zmesh.color = new $t.Color3(0, 0, 1), this.scene = e } return e.prototype.update = function (e, t, i, r) { var n = this.scaleLines; this._xmesh && this._xmesh.position.copyFrom(e), this._ymesh && this._ymesh.position.copyFrom(e), this._zmesh && this._zmesh.position.copyFrom(e); var o = this._xline[1]; o.x = t.x * n, o.y = t.y * n, o.z = t.z * n, $t.Mesh.CreateLines("", this._xline, null, !1, this._xmesh), (o = this._yline[1]).x = i.x * n, o.y = i.y * n, o.z = i.z * n, $t.Mesh.CreateLines("", this._yline, null, !1, this._ymesh), (o = this._zline[1]).x = r.x * n, o.y = r.y * n, o.z = r.z * n, $t.Mesh.CreateLines("", this._zline, null, !1, this._zmesh) }, e.prototype.dispose = function () { this._xmesh && this._xmesh.dispose(), this._ymesh && this._ymesh.dispose(), this._zmesh && this._zmesh.dispose(), this._xmesh = null, this._ymesh = null, this._zmesh = null, this.scene = null }, e }(), ei.AxesViewer = ti, ni = function (e) { function t(t, i, r, n) { void 0 === n && (n = 1); var o = e.call(this, t, n) || this; return o.pos = ii.Vector3.Zero(), o.xaxis = ii.Vector3.Zero(), o.yaxis = ii.Vector3.Zero(), o.zaxis = ii.Vector3.Zero(), o.mesh = r, o.bone = i, o } return T(t, e), t.prototype.update = function () { if (this.mesh && this.bone) { var t = this.bone; t.getAbsolutePositionToRef(this.mesh, this.pos), t.getDirectionToRef(ii.Axis.X, this.mesh, this.xaxis), t.getDirectionToRef(ii.Axis.Y, this.mesh, this.yaxis), t.getDirectionToRef(ii.Axis.Z, this.mesh, this.zaxis), e.prototype.update.call(this, this.pos, this.xaxis, this.yaxis, this.zaxis) } }, t.prototype.dispose = function () { this.mesh && (this.mesh = null, this.bone = null, e.prototype.dispose.call(this)) }, t }((ri = (ii = $a || ($a = {})).Debug || (ii.Debug = {})).AxesViewer), ri.BoneAxesViewer = ni, oi = $a || ($a = {}), si = function () { function e(e) { this.ray = e } return e.CreateAndShow = function (t, i, r) { var n = new e(t); return n.show(i, r), n }, e.prototype.show = function (e, t) { if (!this._renderFunction && this.ray) { var i = this.ray; this._renderFunction = this._render.bind(this), this._scene = e, this._renderPoints = [i.origin, i.origin.add(i.direction.scale(i.length))], this._renderLine = oi.Mesh.CreateLines("ray", this._renderPoints, e, !0), this._renderFunction && this._scene.registerBeforeRender(this._renderFunction) } t && this._renderLine && this._renderLine.color.copyFrom(t) }, e.prototype.hide = function () { this._renderFunction && this._scene && (this._scene.unregisterBeforeRender(this._renderFunction), this._scene = null, this._renderFunction = null, this._renderLine && (this._renderLine.dispose(), this._renderLine = null), this._renderPoints = []) }, e.prototype._render = function () { var e = this.ray; if (e) { var t = this._renderPoints[1], i = Math.min(e.length, 1e6); t.copyFrom(e.direction), t.scaleInPlace(i), t.addInPlace(e.origin), oi.Mesh.CreateLines("ray", this._renderPoints, this._scene, !0, this._renderLine) } }, e.prototype.attachToMesh = function (e, t, i, r) { this._attachedToMesh = e; var n = this.ray; n && (n.direction || (n.direction = oi.Vector3.Zero()), n.origin || (n.origin = oi.Vector3.Zero()), r && (n.length = r), i || (i = oi.Vector3.Zero()), t || (t = new oi.Vector3(0, 0, -1)), this._meshSpaceDirection ? (this._meshSpaceDirection.copyFrom(t), this._meshSpaceOrigin.copyFrom(i)) : (this._meshSpaceDirection = t.clone(), this._meshSpaceOrigin = i.clone()), this._updateToMeshFunction || (this._updateToMeshFunction = this._updateToMesh.bind(this), this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)), this._updateToMesh()) }, e.prototype.detachFromMesh = function () { this._attachedToMesh && (this._updateToMeshFunction && this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction), this._attachedToMesh = null, this._updateToMeshFunction = null) }, e.prototype._updateToMesh = function () { var e = this.ray; this._attachedToMesh && e && (this._attachedToMesh._isDisposed ? this.detachFromMesh() : (this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection, e.direction), oi.Vector3.TransformCoordinatesToRef(this._meshSpaceOrigin, this._attachedToMesh.getWorldMatrix(), e.origin))) }, e.prototype.dispose = function () { this.hide(), this.detachFromMesh(), this.ray = null }, e }(), oi.RayHelper = si, function (e) { Object.defineProperty(e.Scene.prototype, "debugLayer", { get: function () { return this._debugLayer || (this._debugLayer = new t(this)), this._debugLayer }, enumerable: !0, configurable: !0 }); var t = function () { function i(t) { var i = this; this.BJSINSPECTOR = "undefined" != typeof INSPECTOR ? INSPECTOR : void 0, this.onPropertyChangedObservable = new e.Observable, this._scene = t, this._scene.onDisposeObservable.add(function () { i._scene._debugLayer && i._scene._debugLayer.hide() }) } return i.prototype._createInspector = function (e) { void 0 === e && (e = {}); var t = e.popup || !1, i = e.initialTab || 0, r = e.parentElement || null; this._inspector || (this.BJSINSPECTOR = this.BJSINSPECTOR || "undefined" != typeof INSPECTOR ? INSPECTOR : void 0, this._inspector = new this.BJSINSPECTOR.Inspector(this._scene, t, i, r, e.newColors)) }, i.prototype.isVisible = function () { return !!this._inspector }, i.prototype.hide = function () { if (this._inspector) { try { this._inspector.dispose() } catch (t) { } this.onPropertyChangedObservable.clear(), this._inspector = null } }, i.prototype.show = function (t) { void 0 === t && (t = {}), void 0 === this.BJSINSPECTOR ? e.Tools.LoadScript(i.InspectorURL, this._createInspector.bind(this, t)) : this._createInspector(t) }, i.prototype.getActiveTab = function () { return this._inspector ? this._inspector.getActiveTabIndex() : -1 }, i.InspectorURL = "https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js", i }(); e.DebugLayer = t }($a || ($a = {})), li = (ai = $a || ($a = {})).Debug || (ai.Debug = {}), ci = function () { function e(e) { this._impostors = [], this._meshes = [], this._numMeshes = 0, this._scene = e || ai.Engine.LastCreatedScene; var t = this._scene.getPhysicsEngine(); t && (this._physicsEnginePlugin = t.getPhysicsPlugin()) } return e.prototype._updateDebugMeshes = function () { for (var e = this._physicsEnginePlugin, t = 0; t < this._numMeshes; t++) { var i = this._impostors[t]; if (i) if (i.isDisposed) this.hideImpostor(this._impostors[t--]); else { var r = this._meshes[t]; r && e && e.syncMeshWithImpostor(r, i) } } }, e.prototype.showImpostor = function (e) { if (this._scene) { for (var t = 0; t < this._numMeshes; t++)if (this._impostors[t] == e) return; var i = this._getDebugMesh(e, this._scene); i && (this._impostors[this._numMeshes] = e, this._meshes[this._numMeshes] = i, 0 === this._numMeshes && (this._renderFunction = this._updateDebugMeshes.bind(this), this._scene.registerBeforeRender(this._renderFunction)), this._numMeshes++) } }, e.prototype.hideImpostor = function (e) { if (e && this._scene) { for (var t = !1, i = 0; i < this._numMeshes; i++)if (this._impostors[i] == e) { var r = this._meshes[i]; if (!r) continue; this._scene.removeMesh(r), r.dispose(), this._numMeshes-- , 0 < this._numMeshes ? (this._meshes[i] = this._meshes[this._numMeshes], this._impostors[i] = this._impostors[this._numMeshes], this._meshes[this._numMeshes] = null, this._impostors[this._numMeshes] = null) : (this._meshes[0] = null, this._impostors[0] = null), t = !0; break } t && 0 === this._numMeshes && this._scene.unregisterBeforeRender(this._renderFunction) } }, e.prototype._getDebugMaterial = function (e) { return this._debugMaterial || (this._debugMaterial = new ai.StandardMaterial("", e), this._debugMaterial.wireframe = !0), this._debugMaterial }, e.prototype._getDebugBoxMesh = function (e) { return this._debugBoxMesh || (this._debugBoxMesh = ai.MeshBuilder.CreateBox("physicsBodyBoxViewMesh", { size: 1 }, e), this._debugBoxMesh.renderingGroupId = 1, this._debugBoxMesh.rotationQuaternion = ai.Quaternion.Identity(), this._debugBoxMesh.material = this._getDebugMaterial(e), e.removeMesh(this._debugBoxMesh)), this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance") }, e.prototype._getDebugSphereMesh = function (e) { return this._debugSphereMesh || (this._debugSphereMesh = ai.MeshBuilder.CreateSphere("physicsBodySphereViewMesh", { diameter: 1 }, e), this._debugSphereMesh.renderingGroupId = 1, this._debugSphereMesh.rotationQuaternion = ai.Quaternion.Identity(), this._debugSphereMesh.material = this._getDebugMaterial(e), e.removeMesh(this._debugSphereMesh)), this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance") }, e.prototype._getDebugMesh = function (e, t) { var i = null; if (e.type == ai.PhysicsImpostor.BoxImpostor) i = this._getDebugBoxMesh(t), e.getBoxSizeToRef(i.scaling); else if (e.type == ai.PhysicsImpostor.SphereImpostor) { i = this._getDebugSphereMesh(t); var r = e.getRadius(); i.scaling.x = 2 * r, i.scaling.y = 2 * r, i.scaling.z = 2 * r } return i }, e.prototype.dispose = function () { for (var e = 0; e < this._numMeshes; e++)this.hideImpostor(this._impostors[e]); this._debugBoxMesh && this._debugBoxMesh.dispose(), this._debugSphereMesh && this._debugSphereMesh.dispose(), this._debugMaterial && this._debugMaterial.dispose(), this._impostors.length = 0, this._scene = null, this._physicsEnginePlugin = null }, e }(), li.PhysicsViewer = ci, function (e) { Object.defineProperty(e.Scene.prototype, "forceShowBoundingBoxes", { get: function () { return this._forceShowBoundingBoxes || !1 }, set: function (e) { (this._forceShowBoundingBoxes = e) && this.getBoundingBoxRenderer() }, enumerable: !0, configurable: !0 }), e.Scene.prototype.getBoundingBoxRenderer = function () { return this._boundingBoxRenderer || (this._boundingBoxRenderer = new t(this)), this._boundingBoxRenderer }, Object.defineProperty(e.AbstractMesh.prototype, "showBoundingBox", { get: function () { return this._showBoundingBox || !1 }, set: function (e) { (this._showBoundingBox = e) && this.getScene().getBoundingBoxRenderer() }, enumerable: !0, configurable: !0 }); var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_BOUNDINGBOXRENDERER, this.frontColor = new e.Color3(1, 1, 1), this.backColor = new e.Color3(.1, .1, .1), this.showBackLines = !0, this.renderList = new e.SmartArray(32), this._vertexBuffers = {}, (this.scene = t)._addComponent(this) } return t.prototype.register = function () { this.scene._beforeEvaluateActiveMeshStage.registerStep(e.SceneComponentConstants.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER, this, this.reset), this.scene._activeMeshStage.registerStep(e.SceneComponentConstants.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER, this, this._activeMesh), this.scene._evaluateSubMeshStage.registerStep(e.SceneComponentConstants.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER, this, this._evaluateSubMesh), this.scene._afterRenderingGroupDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER, this, this.render) }, t.prototype._evaluateSubMesh = function (e, t) { if (e.showSubMeshesBoundingBox) { var i = t.getBoundingInfo(); null != i && (i.boundingBox._tag = e.renderingGroupId, this.renderList.push(i.boundingBox)) } }, t.prototype._activeMesh = function (e, t) { if (e.showBoundingBox || this.scene.forceShowBoundingBoxes) { var i = e.getBoundingInfo(); i.boundingBox._tag = t.renderingGroupId, this.renderList.push(i.boundingBox) } }, t.prototype._prepareRessources = function () { if (!this._colorShader) { this._colorShader = new e.ShaderMaterial("colorShader", this.scene, "color", { attributes: [e.VertexBuffer.PositionKind], uniforms: ["world", "viewProjection", "color"] }); var t = this.scene.getEngine(), i = e.VertexData.CreateBox({ size: 1 }); this._vertexBuffers[e.VertexBuffer.PositionKind] = new e.VertexBuffer(t, i.positions, e.VertexBuffer.PositionKind, !1), this._createIndexBuffer() } }, t.prototype._createIndexBuffer = function () { var e = this.scene.getEngine(); this._indexBuffer = e.createIndexBuffer([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 7, 1, 6, 2, 5, 3, 4]) }, t.prototype.rebuild = function () { var t = this._vertexBuffers[e.VertexBuffer.PositionKind]; t && t._rebuild(), this._createIndexBuffer() }, t.prototype.reset = function () { this.renderList.reset() }, t.prototype.render = function (t) { if (0 !== this.renderList.length && (this._prepareRessources(), this._colorShader.isReady())) { var i = this.scene.getEngine(); i.setDepthWrite(!1), this._colorShader._preBind(); for (var r = 0; r < this.renderList.length; r++) { var n = this.renderList.data[r]; if (n._tag === t) { var o = n.minimum, s = n.maximum.subtract(o), a = o.add(s.scale(.5)), l = e.Matrix.Scaling(s.x, s.y, s.z).multiply(e.Matrix.Translation(a.x, a.y, a.z)).multiply(n.getWorldMatrix()); i.bindBuffers(this._vertexBuffers, this._indexBuffer, this._colorShader.getEffect()), this.showBackLines && (i.setDepthFunctionToGreaterOrEqual(), this.scene.resetCachedMaterial(), this._colorShader.setColor4("color", this.backColor.toColor4()), this._colorShader.bind(l), i.drawElementsType(e.Material.LineListDrawMode, 0, 24)), i.setDepthFunctionToLess(), this.scene.resetCachedMaterial(), this._colorShader.setColor4("color", this.frontColor.toColor4()), this._colorShader.bind(l), i.drawElementsType(e.Material.LineListDrawMode, 0, 24) } } this._colorShader.unbind(), i.setDepthFunctionToLessOrEqual(), i.setDepthWrite(!0) } }, t.prototype.renderOcclusionBoundingBox = function (t) { if (this._prepareRessources(), this._colorShader.isReady() && t._boundingInfo) { var i = this.scene.getEngine(); i.setDepthWrite(!1), i.setColorWrite(!1), this._colorShader._preBind(); var r = t._boundingInfo.boundingBox, n = r.minimum, o = r.maximum.subtract(n), s = n.add(o.scale(.5)), a = e.Matrix.Scaling(o.x, o.y, o.z).multiply(e.Matrix.Translation(s.x, s.y, s.z)).multiply(r.getWorldMatrix()); i.bindBuffers(this._vertexBuffers, this._indexBuffer, this._colorShader.getEffect()), i.setDepthFunctionToLess(), this.scene.resetCachedMaterial(), this._colorShader.bind(a), i.drawElementsType(e.Material.LineListDrawMode, 0, 24), this._colorShader.unbind(), i.setDepthFunctionToLessOrEqual(), i.setDepthWrite(!0), i.setColorWrite(!0) } }, t.prototype.dispose = function () { if (this._colorShader) { this.renderList.dispose(), this._colorShader.dispose(); var t = this._vertexBuffers[e.VertexBuffer.PositionKind]; t && (t.dispose(), this._vertexBuffers[e.VertexBuffer.PositionKind] = null), this.scene.getEngine()._releaseBuffer(this._indexBuffer) } }, t }(); e.BoundingBoxRenderer = t }($a || ($a = {})), (hi = $a || ($a = {})).Engine.prototype.createTransformFeedback = function () { return this._gl.createTransformFeedback() }, hi.Engine.prototype.deleteTransformFeedback = function (e) { this._gl.deleteTransformFeedback(e) }, hi.Engine.prototype.bindTransformFeedback = function (e) { this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK, e) }, hi.Engine.prototype.beginTransformFeedback = function (e) { void 0 === e && (e = !0), this._gl.beginTransformFeedback(e ? this._gl.POINTS : this._gl.TRIANGLES) }, hi.Engine.prototype.endTransformFeedback = function () { this._gl.endTransformFeedback() }, hi.Engine.prototype.setTranformFeedbackVaryings = function (e, t) { this._gl.transformFeedbackVaryings(e, t, this._gl.INTERLEAVED_ATTRIBS) }, hi.Engine.prototype.bindTransformFeedbackBuffer = function (e) { this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER, 0, e) }, di = function (e) { function t(t, i, r, n) { void 0 === n && (n = !1); var o = e.call(this, t) || this; o.layerMask = 268435455, o._accumulatedCount = 0, o._targetIndex = 0, o._currentRenderId = -1, o._started = !1, o._stopped = !1, o._timeDelta = 0, o._attributesStrideSize = 21, o._actualFrame = 0, o._rawTextureWidth = 256, o.onDisposeObservable = new ui.Observable, o.forceDepthWrite = !1, o._preWarmDone = !1, o._scene = r || ui.Engine.LastCreatedScene, o._attachImageProcessingConfiguration(null), o._engine = o._scene.getEngine(), i.randomTextureSize || delete i.randomTextureSize; var s = tl({ capacity: 5e4, randomTextureSize: o._engine.getCaps().maxTextureSize }, i), a = i; isFinite(a) && (s.capacity = a), o._capacity = s.capacity, o._activeCount = s.capacity, o._currentActiveCount = 0, o._isAnimationSheetEnabled = n, o._scene.particleSystems.push(o), o._updateEffectOptions = { attributes: ["position", "age", "life", "seed", "size", "color", "direction", "initialDirection", "angle", "cellIndex", "cellStartOffset", "noiseCoordinates1", "noiseCoordinates2"], uniformsNames: ["currentCount", "timeDelta", "emitterWM", "lifeTime", "color1", "color2", "sizeRange", "scaleRange", "gravity", "emitPower", "direction1", "direction2", "minEmitBox", "maxEmitBox", "radius", "directionRandomizer", "height", "coneAngle", "stopFactor", "angleRange", "radiusRange", "cellInfos", "noiseStrength", "limitVelocityDamping"], uniformBuffersNames: [], samplers: ["randomSampler", "randomSampler2", "sizeGradientSampler", "angularSpeedGradientSampler", "velocityGradientSampler", "limitVelocityGradientSampler", "noiseSampler", "dragGradientSampler"], defines: "", fallbacks: null, onCompiled: null, onError: null, indexParameters: null, maxSimultaneousLights: 0, transformFeedbackVaryings: [] }, o.particleEmitterType = new ui.BoxParticleEmitter; for (var l = Math.min(o._engine.getCaps().maxTextureSize, s.randomTextureSize), c = [], h = 0; h < l; ++h)c.push(Math.random()), c.push(Math.random()), c.push(Math.random()), c.push(Math.random()); for (o._randomTexture = new ui.RawTexture(new Float32Array(c), l, 1, ui.Engine.TEXTUREFORMAT_RGBA, o._scene, !1, !1, ui.Texture.NEAREST_SAMPLINGMODE, ui.Engine.TEXTURETYPE_FLOAT), o._randomTexture.wrapU = ui.Texture.WRAP_ADDRESSMODE, o._randomTexture.wrapV = ui.Texture.WRAP_ADDRESSMODE, c = [], h = 0; h < l; ++h)c.push(Math.random()), c.push(Math.random()), c.push(Math.random()), c.push(Math.random()); return o._randomTexture2 = new ui.RawTexture(new Float32Array(c), l, 1, ui.Engine.TEXTUREFORMAT_RGBA, o._scene, !1, !1, ui.Texture.NEAREST_SAMPLINGMODE, ui.Engine.TEXTURETYPE_FLOAT), o._randomTexture2.wrapU = ui.Texture.WRAP_ADDRESSMODE, o._randomTexture2.wrapV = ui.Texture.WRAP_ADDRESSMODE, o._randomTextureSize = l, o } return T(t, e), Object.defineProperty(t, "IsSupported", { get: function () { return !!ui.Engine.LastCreatedEngine && 1 < ui.Engine.LastCreatedEngine.webGLVersion }, enumerable: !0, configurable: !0 }), t.prototype.getCapacity = function () { return this._capacity }, Object.defineProperty(t.prototype, "activeParticleCount", { get: function () { return this._activeCount }, set: function (e) { this._activeCount = Math.min(e, this._capacity) }, enumerable: !0, configurable: !0 }), t.prototype.isReady = function () { return this._updateEffect ? !!(this.emitter && this._updateEffect.isReady() && this._imageProcessingConfiguration.isReady() && this._renderEffect.isReady() && this.particleTexture && this.particleTexture.isReady()) : (this._recreateUpdateEffect(), this._recreateRenderEffect(), !1) }, t.prototype.isStarted = function () { return this._started }, t.prototype.start = function (e) { var t = this; if (void 0 === e && (e = this.startDelay), !this.targetStopDuration && this._hasTargetStopDurationDependantGradient()) throw "Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set"; e ? setTimeout(function () { t.start(0) }, e) : (this._started = !0, this._stopped = !1, this._preWarmDone = !1, this.beginAnimationOnStart && this.animations && 0 < this.animations.length && this.getScene().beginAnimation(this, this.beginAnimationFrom, this.beginAnimationTo, this.beginAnimationLoop)) }, t.prototype.stop = function () { this._stopped = !0 }, t.prototype.reset = function () { this._releaseBuffers(), this._releaseVAOs(), this._currentActiveCount = 0, this._targetIndex = 0 }, t.prototype.getClassName = function () { return "GPUParticleSystem" }, t.prototype._removeGradientAndTexture = function (t, i, r) { return e.prototype._removeGradientAndTexture.call(this, t, i, r), this._releaseBuffers(), this }, t.prototype.addColorGradient = function (e, t, i) { this._colorGradients || (this._colorGradients = []); var r = new ui.ColorGradient; return r.gradient = e, r.color1 = t, this._colorGradients.push(r), this._colorGradients.sort(function (e, t) { return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0 }), this._colorGradientsTexture && (this._colorGradientsTexture.dispose(), this._colorGradientsTexture = null), this._releaseBuffers(), this }, t.prototype.removeColorGradient = function (e) { return this._removeGradientAndTexture(e, this._colorGradients, this._colorGradientsTexture), this._colorGradientsTexture = null, this }, t.prototype._addFactorGradient = function (e, t, i) { var r = new ui.FactorGradient; r.gradient = t, r.factor1 = i, e.push(r), e.sort(function (e, t) { return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0 }), this._releaseBuffers() }, t.prototype.addSizeGradient = function (e, t) { return this._sizeGradients || (this._sizeGradients = []), this._addFactorGradient(this._sizeGradients, e, t), this._sizeGradientsTexture && (this._sizeGradientsTexture.dispose(), this._sizeGradientsTexture = null), this._releaseBuffers(), this }, t.prototype.removeSizeGradient = function (e) { return this._removeGradientAndTexture(e, this._sizeGradients, this._sizeGradientsTexture), this._sizeGradientsTexture = null, this }, t.prototype.addAngularSpeedGradient = function (e, t) { return this._angularSpeedGradients || (this._angularSpeedGradients = []), this._addFactorGradient(this._angularSpeedGradients, e, t), this._angularSpeedGradientsTexture && (this._angularSpeedGradientsTexture.dispose(), this._angularSpeedGradientsTexture = null), this._releaseBuffers(), this }, t.prototype.removeAngularSpeedGradient = function (e) { return this._removeGradientAndTexture(e, this._angularSpeedGradients, this._angularSpeedGradientsTexture), this._angularSpeedGradientsTexture = null, this }, t.prototype.addVelocityGradient = function (e, t) { return this._velocityGradients || (this._velocityGradients = []), this._addFactorGradient(this._velocityGradients, e, t), this._velocityGradientsTexture && (this._velocityGradientsTexture.dispose(), this._velocityGradientsTexture = null), this._releaseBuffers(), this }, t.prototype.removeVelocityGradient = function (e) { return this._removeGradientAndTexture(e, this._velocityGradients, this._velocityGradientsTexture), this._velocityGradientsTexture = null, this }, t.prototype.addLimitVelocityGradient = function (e, t) { return this._limitVelocityGradients || (this._limitVelocityGradients = []), this._addFactorGradient(this._limitVelocityGradients, e, t), this._limitVelocityGradientsTexture && (this._limitVelocityGradientsTexture.dispose(), this._limitVelocityGradientsTexture = null), this._releaseBuffers(), this }, t.prototype.removeLimitVelocityGradient = function (e) { return this._removeGradientAndTexture(e, this._limitVelocityGradients, this._limitVelocityGradientsTexture), this._limitVelocityGradientsTexture = null, this }, t.prototype.addDragGradient = function (e, t) { return this._dragGradients || (this._dragGradients = []), this._addFactorGradient(this._dragGradients, e, t), this._dragGradientsTexture && (this._dragGradientsTexture.dispose(), this._dragGradientsTexture = null), this._releaseBuffers(), this }, t.prototype.removeDragGradient = function (e) { return this._removeGradientAndTexture(e, this._dragGradients, this._dragGradientsTexture), this._dragGradientsTexture = null, this }, t.prototype.addEmitRateGradient = function (e, t, i) { return this }, t.prototype.removeEmitRateGradient = function (e) { return this }, t.prototype.addStartSizeGradient = function (e, t, i) { return this }, t.prototype.removeStartSizeGradient = function (e) { return this }, t.prototype.addColorRemapGradient = function (e, t, i) { return this }, t.prototype.removeColorRemapGradient = function (e) { return this }, t.prototype.addAlphaRemapGradient = function (e, t, i) { return this }, t.prototype.removeAlphaRemapGradient = function (e) { return this }, t.prototype.addRampGradient = function (e, t) { return this }, t.prototype.removeRampGradient = function (e) { return this }, t.prototype.getRampGradients = function () { return null }, Object.defineProperty(t.prototype, "useRampGradients", { get: function () { return !1 }, set: function (e) { }, enumerable: !0, configurable: !0 }), t.prototype.addLifeTimeGradient = function (e, t, i) { return this }, t.prototype.removeLifeTimeGradient = function (e) { return this }, t.prototype._reset = function () { this._releaseBuffers() }, t.prototype._createUpdateVAO = function (e) { var t = {}; t.position = e.createVertexBuffer("position", 0, 3), t.age = e.createVertexBuffer("age", 3, 1), t.life = e.createVertexBuffer("life", 4, 1), t.seed = e.createVertexBuffer("seed", 5, 4), t.size = e.createVertexBuffer("size", 9, 3); var i = 12; this._colorGradientsTexture || (t.color = e.createVertexBuffer("color", i, 4), i += 4), t.direction = e.createVertexBuffer("direction", i, 3), i += 3, this._isBillboardBased || (t.initialDirection = e.createVertexBuffer("initialDirection", i, 3), i += 3), this._angularSpeedGradientsTexture ? (t.angle = e.createVertexBuffer("angle", i, 1), i += 1) : (t.angle = e.createVertexBuffer("angle", i, 2), i += 2), this._isAnimationSheetEnabled && (t.cellIndex = e.createVertexBuffer("cellIndex", i, 1), i += 1, this.spriteRandomStartCell && (t.cellStartOffset = e.createVertexBuffer("cellStartOffset", i, 1), i += 1)), this.noiseTexture && (t.noiseCoordinates1 = e.createVertexBuffer("noiseCoordinates1", i, 3), i += 3, t.noiseCoordinates2 = e.createVertexBuffer("noiseCoordinates2", i, 3), i += 3); var r = this._engine.recordVertexArrayObject(t, null, this._updateEffect); return this._engine.bindArrayBuffer(null), r }, t.prototype._createRenderVAO = function (e, t) { var i = {}; i.position = e.createVertexBuffer("position", 0, 3, this._attributesStrideSize, !0), i.age = e.createVertexBuffer("age", 3, 1, this._attributesStrideSize, !0), i.life = e.createVertexBuffer("life", 4, 1, this._attributesStrideSize, !0), i.size = e.createVertexBuffer("size", 9, 3, this._attributesStrideSize, !0); var r = 12; this._colorGradientsTexture || (i.color = e.createVertexBuffer("color", r, 4, this._attributesStrideSize, !0), r += 4), this.billboardMode === ui.ParticleSystem.BILLBOARDMODE_STRETCHED && (i.direction = e.createVertexBuffer("direction", r, 3, this._attributesStrideSize, !0)), r += 3, this._isBillboardBased || (i.initialDirection = e.createVertexBuffer("initialDirection", r, 3, this._attributesStrideSize, !0), r += 3), i.angle = e.createVertexBuffer("angle", r, 1, this._attributesStrideSize, !0), this._angularSpeedGradientsTexture ? r++ : r += 2, this._isAnimationSheetEnabled && (i.cellIndex = e.createVertexBuffer("cellIndex", r, 1, this._attributesStrideSize, !0), r += 1, this.spriteRandomStartCell && (i.cellStartOffset = e.createVertexBuffer("cellStartOffset", r, 1, this._attributesStrideSize, !0), r += 1)), this.noiseTexture && (i.noiseCoordinates1 = e.createVertexBuffer("noiseCoordinates1", r, 3, this._attributesStrideSize, !0), r += 3, i.noiseCoordinates2 = e.createVertexBuffer("noiseCoordinates2", r, 3, this._attributesStrideSize, !0), r += 3), i.offset = t.createVertexBuffer("offset", 0, 2), i.uv = t.createVertexBuffer("uv", 2, 2); var n = this._engine.recordVertexArrayObject(i, null, this._renderEffect); return this._engine.bindArrayBuffer(null), n }, t.prototype._initialize = function (e) { if (void 0 === e && (e = !1), !this._buffer0 || e) { var t = this._scene.getEngine(), i = new Array; this.isBillboardBased || (this._attributesStrideSize += 3), this._colorGradientsTexture && (this._attributesStrideSize -= 4), this._angularSpeedGradientsTexture && (this._attributesStrideSize -= 1), this._isAnimationSheetEnabled && (this._attributesStrideSize += 1, this.spriteRandomStartCell && (this._attributesStrideSize += 1)), this.noiseTexture && (this._attributesStrideSize += 6); for (var r = 0; r < this._capacity; r++)i.push(0), i.push(0), i.push(0), i.push(0), i.push(0), i.push(Math.random()), i.push(Math.random()), i.push(Math.random()), i.push(Math.random()), i.push(0), i.push(0), i.push(0), this._colorGradientsTexture || (i.push(0), i.push(0), i.push(0), i.push(0)), i.push(0), i.push(0), i.push(0), this.isBillboardBased || (i.push(0), i.push(0), i.push(0)), i.push(0), this._angularSpeedGradientsTexture || i.push(0), this._isAnimationSheetEnabled && (i.push(0), this.spriteRandomStartCell && i.push(0)), this.noiseTexture && (i.push(Math.random()), i.push(Math.random()), i.push(Math.random()), i.push(Math.random()), i.push(Math.random()), i.push(Math.random())); var n = new Float32Array([.5, .5, 1, 1, -.5, .5, 0, 1, -.5, -.5, 0, 0, .5, -.5, 1, 0]); this._buffer0 = new ui.Buffer(t, i, !1, this._attributesStrideSize), this._buffer1 = new ui.Buffer(t, i, !1, this._attributesStrideSize), this._spriteBuffer = new ui.Buffer(t, n, !1, 4), this._updateVAO = [], this._updateVAO.push(this._createUpdateVAO(this._buffer0)), this._updateVAO.push(this._createUpdateVAO(this._buffer1)), this._renderVAO = [], this._renderVAO.push(this._createRenderVAO(this._buffer1, this._spriteBuffer)), this._renderVAO.push(this._createRenderVAO(this._buffer0, this._spriteBuffer)), this._sourceBuffer = this._buffer0, this._targetBuffer = this._buffer1 } }, t.prototype._recreateUpdateEffect = function () { var e = this.particleEmitterType ? this.particleEmitterType.getEffectDefines() : ""; this._isBillboardBased && (e += "\n#define BILLBOARD"), this._colorGradientsTexture && (e += "\n#define COLORGRADIENTS"), this._sizeGradientsTexture && (e += "\n#define SIZEGRADIENTS"), this._angularSpeedGradientsTexture && (e += "\n#define ANGULARSPEEDGRADIENTS"), this._velocityGradientsTexture && (e += "\n#define VELOCITYGRADIENTS"), this._limitVelocityGradientsTexture && (e += "\n#define LIMITVELOCITYGRADIENTS"), this._dragGradientsTexture && (e += "\n#define DRAGGRADIENTS"), this.isAnimationSheetEnabled && (e += "\n#define ANIMATESHEET", this.spriteRandomStartCell && (e += "\n#define ANIMATESHEETRANDOMSTART")), this.noiseTexture && (e += "\n#define NOISE"), this._updateEffect && this._updateEffectOptions.defines === e || (this._updateEffectOptions.transformFeedbackVaryings = ["outPosition", "outAge", "outLife", "outSeed", "outSize"], this._colorGradientsTexture || this._updateEffectOptions.transformFeedbackVaryings.push("outColor"), this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"), this._isBillboardBased || this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"), this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"), this.isAnimationSheetEnabled && (this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"), this.spriteRandomStartCell && this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")), this.noiseTexture && (this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"), this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")), this._updateEffectOptions.defines = e, this._updateEffect = new ui.Effect("gpuUpdateParticles", this._updateEffectOptions, this._scene.getEngine())) }, t.prototype._recreateRenderEffect = function () { var e = ""; if (this._scene.clipPlane && (e = "\n#define CLIPPLANE"), this._scene.clipPlane2 && (e = "\n#define CLIPPLANE2"), this._scene.clipPlane3 && (e = "\n#define CLIPPLANE3"), this._scene.clipPlane4 && (e = "\n#define CLIPPLANE4"), this.blendMode === ui.ParticleSystem.BLENDMODE_MULTIPLY && (e = "\n#define BLENDMULTIPLYMODE"), this._isBillboardBased) switch (e += "\n#define BILLBOARD", this.billboardMode) { case ui.ParticleSystem.BILLBOARDMODE_Y: e += "\n#define BILLBOARDY"; break; case ui.ParticleSystem.BILLBOARDMODE_STRETCHED: e += "\n#define BILLBOARDSTRETCHED"; break; case ui.ParticleSystem.BILLBOARDMODE_ALL: }if (this._colorGradientsTexture && (e += "\n#define COLORGRADIENTS"), this.isAnimationSheetEnabled && (e += "\n#define ANIMATESHEET"), this._imageProcessingConfiguration && (this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines), e += "\n" + this._imageProcessingConfigurationDefines.toString()), !this._renderEffect || this._renderEffect.defines !== e) { var t = ["view", "projection", "colorDead", "invView", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "sheetInfos", "translationPivot", "eyePosition"], i = ["textureSampler", "colorGradientSampler"]; ui.ImageProcessingConfiguration && (ui.ImageProcessingConfiguration.PrepareUniforms(t, this._imageProcessingConfigurationDefines), ui.ImageProcessingConfiguration.PrepareSamplers(i, this._imageProcessingConfigurationDefines)), this._renderEffect = new ui.Effect("gpuRenderParticles", ["position", "age", "life", "size", "color", "offset", "uv", "direction", "initialDirection", "angle", "cellIndex"], t, i, this._scene.getEngine(), e) } }, t.prototype.animate = function (e) { void 0 === e && (e = !1), this._timeDelta = this.updateSpeed * (e ? this.preWarmStepOffset : this._scene.getAnimationRatio()), this._actualFrame += this._timeDelta, this._stopped || this.targetStopDuration && this._actualFrame >= this.targetStopDuration && this.stop() }, t.prototype._createFactorGradientTexture = function (e, t) { var i = this[t]; if (e && e.length && !i) { for (var r = new Float32Array(this._rawTextureWidth), n = 0; n < this._rawTextureWidth; n++) { var o = n / this._rawTextureWidth; ui.Tools.GetCurrentGradient(o, e, function (e, t, i) { r[n] = ui.Scalar.Lerp(e.factor1, t.factor1, i) }) } this[t] = ui.RawTexture.CreateRTexture(r, this._rawTextureWidth, 1, this._scene, !1, !1, ui.Texture.NEAREST_SAMPLINGMODE) } }, t.prototype._createSizeGradientTexture = function () { this._createFactorGradientTexture(this._sizeGradients, "_sizeGradientsTexture") }, t.prototype._createAngularSpeedGradientTexture = function () { this._createFactorGradientTexture(this._angularSpeedGradients, "_angularSpeedGradientsTexture") }, t.prototype._createVelocityGradientTexture = function () { this._createFactorGradientTexture(this._velocityGradients, "_velocityGradientsTexture") }, t.prototype._createLimitVelocityGradientTexture = function () { this._createFactorGradientTexture(this._limitVelocityGradients, "_limitVelocityGradientsTexture") }, t.prototype._createDragGradientTexture = function () { this._createFactorGradientTexture(this._dragGradients, "_dragGradientsTexture") }, t.prototype._createColorGradientTexture = function () { if (this._colorGradients && this._colorGradients.length && !this._colorGradientsTexture) { for (var e = new Uint8Array(4 * this._rawTextureWidth), t = ui.Tmp.Color4[0], i = 0; i < this._rawTextureWidth; i++) { var r = i / this._rawTextureWidth; ui.Tools.GetCurrentGradient(r, this._colorGradients, function (r, n, o) { ui.Color4.LerpToRef(r.color1, n.color1, o, t), e[4 * i] = 255 * t.r, e[4 * i + 1] = 255 * t.g, e[4 * i + 2] = 255 * t.b, e[4 * i + 3] = 255 * t.a }) } this._colorGradientsTexture = ui.RawTexture.CreateRGBATexture(e, this._rawTextureWidth, 1, this._scene, !1, !1, ui.Texture.NEAREST_SAMPLINGMODE) } }, t.prototype.render = function (e) { if (void 0 === e && (e = !1), !this._started) return 0; if (this._createColorGradientTexture(), this._createSizeGradientTexture(), this._createAngularSpeedGradientTexture(), this._createVelocityGradientTexture(), this._createLimitVelocityGradientTexture(), this._createDragGradientTexture(), this._recreateUpdateEffect(), this._recreateRenderEffect(), !this.isReady()) return 0; if (!e) { if (!this._preWarmDone && this.preWarmCycles) { for (var t = 0; t < this.preWarmCycles; t++)this.animate(!0), this.render(!0); this._preWarmDone = !0 } if (this._currentRenderId === this._scene.getRenderId()) return 0; this._currentRenderId = this._scene.getRenderId() } if (this._initialize(), this._accumulatedCount += this.emitRate * this._timeDelta, 1 < this._accumulatedCount) { var i = 0 | this._accumulatedCount; this._accumulatedCount -= i, this._currentActiveCount = Math.min(this._activeCount, this._currentActiveCount + i) } if (!this._currentActiveCount) return 0; var r; if (this._engine.enableEffect(this._updateEffect), this._engine.setState(!1), this._updateEffect.setFloat("currentCount", this._currentActiveCount), this._updateEffect.setFloat("timeDelta", this._timeDelta), this._updateEffect.setFloat("stopFactor", this._stopped ? 0 : 1), this._updateEffect.setTexture("randomSampler", this._randomTexture), this._updateEffect.setTexture("randomSampler2", this._randomTexture2), this._updateEffect.setFloat2("lifeTime", this.minLifeTime, this.maxLifeTime), this._updateEffect.setFloat2("emitPower", this.minEmitPower, this.maxEmitPower), this._colorGradientsTexture || (this._updateEffect.setDirectColor4("color1", this.color1), this._updateEffect.setDirectColor4("color2", this.color2)), this._updateEffect.setFloat2("sizeRange", this.minSize, this.maxSize), this._updateEffect.setFloat4("scaleRange", this.minScaleX, this.maxScaleX, this.minScaleY, this.maxScaleY), this._updateEffect.setFloat4("angleRange", this.minAngularSpeed, this.maxAngularSpeed, this.minInitialRotation, this.maxInitialRotation), this._updateEffect.setVector3("gravity", this.gravity), this._sizeGradientsTexture && this._updateEffect.setTexture("sizeGradientSampler", this._sizeGradientsTexture), this._angularSpeedGradientsTexture && this._updateEffect.setTexture("angularSpeedGradientSampler", this._angularSpeedGradientsTexture), this._velocityGradientsTexture && this._updateEffect.setTexture("velocityGradientSampler", this._velocityGradientsTexture), this._limitVelocityGradientsTexture && (this._updateEffect.setTexture("limitVelocityGradientSampler", this._limitVelocityGradientsTexture), this._updateEffect.setFloat("limitVelocityDamping", this.limitVelocityDamping)), this._dragGradientsTexture && this._updateEffect.setTexture("dragGradientSampler", this._dragGradientsTexture), this.particleEmitterType && this.particleEmitterType.applyToShader(this._updateEffect), this._isAnimationSheetEnabled && this._updateEffect.setFloat3("cellInfos", this.startSpriteCellID, this.endSpriteCellID, this.spriteCellChangeSpeed), this.noiseTexture && (this._updateEffect.setTexture("noiseSampler", this.noiseTexture), this._updateEffect.setVector3("noiseStrength", this.noiseStrength)), this.emitter.position) r = this.emitter.getWorldMatrix(); else { var n = this.emitter; r = ui.Matrix.Translation(n.x, n.y, n.z) } if (this._updateEffect.setMatrix("emitterWM", r), this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex], null), this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()), this._engine.setRasterizerState(!1), this._engine.beginTransformFeedback(!0), this._engine.drawArraysType(ui.Material.PointListDrawMode, 0, this._currentActiveCount), this._engine.endTransformFeedback(), this._engine.setRasterizerState(!0), this._engine.bindTransformFeedbackBuffer(null), !e) { this._engine.enableEffect(this._renderEffect); var o = this._scene.getViewMatrix(); if (this._renderEffect.setMatrix("view", o), this._renderEffect.setMatrix("projection", this._scene.getProjectionMatrix()), this._renderEffect.setTexture("textureSampler", this.particleTexture), this._renderEffect.setVector2("translationPivot", this.translationPivot), this._colorGradientsTexture ? this._renderEffect.setTexture("colorGradientSampler", this._colorGradientsTexture) : this._renderEffect.setDirectColor4("colorDead", this.colorDead), this._isAnimationSheetEnabled && this.particleTexture) { var s = this.particleTexture.getBaseSize(); this._renderEffect.setFloat3("sheetInfos", this.spriteCellWidth / s.width, this.spriteCellHeight / s.height, s.width / this.spriteCellWidth) } if (this._isBillboardBased) { var a = this._scene.activeCamera; this._renderEffect.setVector3("eyePosition", a.globalPosition) } if (this._scene.clipPlane || this._scene.clipPlane2 || this._scene.clipPlane3 || this._scene.clipPlane4) { var l = o.clone(); l.invert(), this._renderEffect.setMatrix("invView", l), ui.MaterialHelper.BindClipPlane(this._renderEffect, this._scene) } switch (this._imageProcessingConfiguration && !this._imageProcessingConfiguration.applyByPostProcess && this._imageProcessingConfiguration.bind(this._renderEffect), this.blendMode) { case ui.ParticleSystem.BLENDMODE_ADD: this._engine.setAlphaMode(ui.Engine.ALPHA_ADD); break; case ui.ParticleSystem.BLENDMODE_ONEONE: this._engine.setAlphaMode(ui.Engine.ALPHA_ONEONE); break; case ui.ParticleSystem.BLENDMODE_STANDARD: this._engine.setAlphaMode(ui.Engine.ALPHA_COMBINE); break; case ui.ParticleSystem.BLENDMODE_MULTIPLY: this._engine.setAlphaMode(ui.Engine.ALPHA_MULTIPLY) }this.forceDepthWrite && this._engine.setDepthWrite(!0), this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex], null), this._engine.drawArraysType(ui.Material.TriangleFanDrawMode, 0, 4, this._currentActiveCount), this._engine.setAlphaMode(ui.Engine.ALPHA_DISABLE) } this._targetIndex++ , 2 === this._targetIndex && (this._targetIndex = 0); var c = this._sourceBuffer; return this._sourceBuffer = this._targetBuffer, this._targetBuffer = c, this._currentActiveCount }, t.prototype.rebuild = function () { this._initialize(!0) }, t.prototype._releaseBuffers = function () { this._buffer0 && (this._buffer0.dispose(), this._buffer0 = null), this._buffer1 && (this._buffer1.dispose(), this._buffer1 = null), this._spriteBuffer && (this._spriteBuffer.dispose(), this._spriteBuffer = null) }, t.prototype._releaseVAOs = function () { if (this._updateVAO) { for (var e = 0; e < this._updateVAO.length; e++)this._engine.releaseVertexArrayObject(this._updateVAO[e]); for (this._updateVAO = [], e = 0; e < this._renderVAO.length; e++)this._engine.releaseVertexArrayObject(this._renderVAO[e]); this._renderVAO = [] } }, t.prototype.dispose = function (e) { void 0 === e && (e = !0); var t = this._scene.particleSystems.indexOf(this); -1 < t && this._scene.particleSystems.splice(t, 1), this._releaseBuffers(), this._releaseVAOs(), this._colorGradientsTexture && (this._colorGradientsTexture.dispose(), this._colorGradientsTexture = null), this._sizeGradientsTexture && (this._sizeGradientsTexture.dispose(), this._sizeGradientsTexture = null), this._angularSpeedGradientsTexture && (this._angularSpeedGradientsTexture.dispose(), this._angularSpeedGradientsTexture = null), this._velocityGradientsTexture && (this._velocityGradientsTexture.dispose(), this._velocityGradientsTexture = null), this._limitVelocityGradientsTexture && (this._limitVelocityGradientsTexture.dispose(), this._limitVelocityGradientsTexture = null), this._dragGradientsTexture && (this._dragGradientsTexture.dispose(), this._dragGradientsTexture = null), this._randomTexture && (this._randomTexture.dispose(), this._randomTexture = null), this._randomTexture2 && (this._randomTexture2.dispose(), this._randomTexture2 = null), e && this.particleTexture && (this.particleTexture.dispose(), this.particleTexture = null), e && this.noiseTexture && (this.noiseTexture.dispose(), this.noiseTexture = null), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear() }, t.prototype.clone = function (e, i) { var r = new t(e, { capacity: this._capacity, randomTextureSize: this._randomTextureSize }, this._scene); return ui.Tools.DeepCopy(this, r), void 0 === i && (i = this.emitter), r.emitter = i, this.particleTexture && (r.particleTexture = new ui.Texture(this.particleTexture.url, this._scene)), r }, t.prototype.serialize = function () { var e = {}; return ui.ParticleSystem._Serialize(e, this), e.activeParticleCount = this.activeParticleCount, e }, t.Parse = function (e, i, r, n) { void 0 === n && (n = !1); var o = new t(e.name, { capacity: e.capacity, randomTextureSize: e.randomTextureSize }, i); return e.activeParticleCount && (o.activeParticleCount = e.activeParticleCount), ui.ParticleSystem._Parse(e, o, i, r), e.preventAutoStart && (o.preventAutoStart = e.preventAutoStart), n || o.preventAutoStart || o.start(), o }, t }((ui = $a || ($a = {})).BaseParticleSystem), ui.GPUParticleSystem = di, function (e) { var t = function () { function t(t, i, r, n, o, s, a, l) { void 0 === l && (l = null), this.idx = 0, this.color = new e.Color4(1, 1, 1, 1), this.position = e.Vector3.Zero(), this.rotation = e.Vector3.Zero(), this.scaling = e.Vector3.One(), this.uvs = new e.Vector4(0, 0, 1, 1), this.velocity = e.Vector3.Zero(), this.pivot = e.Vector3.Zero(), this.translateFromPivot = !1, this.alive = !0, this.isVisible = !0, this._pos = 0, this._ind = 0, this.shapeId = 0, this.idxInShape = 0, this._stillInvisible = !1, this._rotationMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1], this.parentId = null, this._globalPosition = e.Vector3.Zero(), this.idx = t, this._pos = i, this._ind = r, this._model = n, this.shapeId = o, this.idxInShape = s, this._sps = a, l && (this._modelBoundingInfo = l, this._boundingInfo = new e.BoundingInfo(l.minimum, l.maximum)) } return Object.defineProperty(t.prototype, "scale", { get: function () { return this.scaling }, set: function (e) { this.scaling = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "quaternion", { get: function () { return this.rotationQuaternion }, set: function (e) { this.rotationQuaternion = e }, enumerable: !0, configurable: !0 }), t.prototype.intersectsMesh = function (t) { return !(!this._boundingInfo || !t._boundingInfo) && (this._sps._bSphereOnly ? e.BoundingSphere.Intersects(this._boundingInfo.boundingSphere, t._boundingInfo.boundingSphere) : this._boundingInfo.intersects(t._boundingInfo, !1)) }, t }(); e.SolidParticle = t; e.ModelShape = function (e, t, i, r, n, o) { this._indicesLength = 0, this.shapeID = e, this._shape = t, this._indicesLength = i, this._shapeUV = r, this._positionFunction = n, this._vertexFunction = o }; e.DepthSortedParticle = function () { this.ind = 0, this.indicesLength = 0, this.sqDistance = 0 } }($a || ($a = {})), fi = $a || ($a = {}), pi = function () { function e(e, t, i) { this.particles = new Array, this.nbParticles = 0, this.billboard = !1, this.recomputeNormals = !0, this.counter = 0, this.vars = {}, this._bSphereOnly = !1, this._bSphereRadiusFactor = 1, this._positions = new Array, this._indices = new Array, this._normals = new Array, this._colors = new Array, this._uvs = new Array, this._index = 0, this._updatable = !0, this._pickable = !1, this._isVisibilityBoxLocked = !1, this._alwaysVisible = !1, this._depthSort = !1, this._shapeCounter = 0, this._copy = new fi.SolidParticle(0, 0, 0, null, 0, 0, this), this._color = new fi.Color4(0, 0, 0, 0), this._computeParticleColor = !0, this._computeParticleTexture = !0, this._computeParticleRotation = !0, this._computeParticleVertex = !1, this._computeBoundingBox = !1, this._depthSortParticles = !0, this._cam_axisZ = fi.Vector3.Zero(), this._cam_axisY = fi.Vector3.Zero(), this._cam_axisX = fi.Vector3.Zero(), this._axisZ = fi.Axis.Z, this._camDir = fi.Vector3.Zero(), this._camInvertedPosition = fi.Vector3.Zero(), this._rotMatrix = new fi.Matrix, this._invertMatrix = new fi.Matrix, this._rotated = fi.Vector3.Zero(), this._quaternion = new fi.Quaternion, this._vertex = fi.Vector3.Zero(), this._normal = fi.Vector3.Zero(), this._yaw = 0, this._pitch = 0, this._roll = 0, this._halfroll = 0, this._halfpitch = 0, this._halfyaw = 0, this._sinRoll = 0, this._cosRoll = 0, this._sinPitch = 0, this._cosPitch = 0, this._sinYaw = 0, this._cosYaw = 0, this._mustUnrotateFixedNormals = !1, this._minimum = fi.Vector3.Zero(), this._maximum = fi.Vector3.Zero(), this._minBbox = fi.Vector3.Zero(), this._maxBbox = fi.Vector3.Zero(), this._particlesIntersect = !1, this._depthSortFunction = function (e, t) { return t.sqDistance - e.sqDistance }, this._needs32Bits = !1, this._pivotBackTranslation = fi.Vector3.Zero(), this._scaledPivot = fi.Vector3.Zero(), this._particleHasParent = !1, this.name = e, this._scene = t || fi.Engine.LastCreatedScene, this._camera = t.activeCamera, this._pickable = !!i && i.isPickable, this._depthSort = !!i && i.enableDepthSort, this._particlesIntersect = !!i && i.particleIntersection, this._bSphereOnly = !!i && i.boundingSphereOnly, this._bSphereRadiusFactor = i && i.bSphereRadiusFactor ? i.bSphereRadiusFactor : 1, i && void 0 !== i.updatable ? this._updatable = i.updatable : this._updatable = !0, this._pickable && (this.pickedParticles = []), this._depthSort && (this.depthSortedParticles = []) } return e.prototype.buildMesh = function () { if (0 === this.nbParticles) { var e = fi.MeshBuilder.CreateDisc("", { radius: 1, tessellation: 3 }, this._scene); this.addShape(e, 1), e.dispose() } this._indices32 = this._needs32Bits ? new Uint32Array(this._indices) : new Uint16Array(this._indices), this._positions32 = new Float32Array(this._positions), this._uvs32 = new Float32Array(this._uvs), this._colors32 = new Float32Array(this._colors), this.recomputeNormals && fi.VertexData.ComputeNormals(this._positions32, this._indices32, this._normals), this._normals32 = new Float32Array(this._normals), this._fixedNormal32 = new Float32Array(this._normals), this._mustUnrotateFixedNormals && this._unrotateFixedNormals(); var t = new fi.VertexData; t.indices = this._depthSort ? this._indices : this._indices32, t.set(this._positions32, fi.VertexBuffer.PositionKind), t.set(this._normals32, fi.VertexBuffer.NormalKind), 0 < this._uvs32.length && t.set(this._uvs32, fi.VertexBuffer.UVKind), 0 < this._colors32.length && t.set(this._colors32, fi.VertexBuffer.ColorKind); var i = new fi.Mesh(this.name, this._scene); return t.applyToMesh(i, this._updatable), this.mesh = i, this.mesh.isPickable = this._pickable, this._depthSort || (this._indices = null), this._positions = null, this._normals = null, this._uvs = null, this._colors = null, this._updatable || (this.particles.length = 0), i }, e.prototype.digest = function (e, t) { var i = t && t.facetNb || 1, r = t && t.number || 0, n = t && t.delta || 0, o = e.getVerticesData(fi.VertexBuffer.PositionKind), s = e.getIndices(), a = e.getVerticesData(fi.VertexBuffer.UVKind), l = e.getVerticesData(fi.VertexBuffer.ColorKind), c = e.getVerticesData(fi.VertexBuffer.NormalKind), h = 0, u = s.length / 3; r ? (r = u < r ? u : r, i = Math.round(u / r), n = 0) : i = u < i ? u : i; for (var d = [], f = [], p = [], _ = [], m = fi.Vector3.Zero(), g = i; h < u;) { u - (i = g + Math.floor((1 + n) * Math.random())) < h && (i = u - h), d.length = 0, f.length = 0, p.length = 0; for (var v = _.length = 0, y = 3 * h; y < 3 * (h + i); y++) { f.push(v); var b = s[y]; d.push(o[3 * b], o[3 * b + 1], o[3 * b + 2]), a && p.push(a[2 * b], a[2 * b + 1]), l && _.push(l[4 * b], l[4 * b + 1], l[4 * b + 2], l[4 * b + 3]), v++ } var T, E, x = this.nbParticles, P = this._posToShape(d), A = this._uvsToShapeUV(p); for (T = 0; T < P.length; T++)m.addInPlace(P[T]); for (m.scaleInPlace(1 / P.length), T = 0; T < P.length; T++)P[T].subtractInPlace(m); this._particlesIntersect && (E = new fi.BoundingInfo(m, m)); var S = new fi.ModelShape(this._shapeCounter, P, 3 * i, A, null, null), M = this._positions.length, R = this._indices.length; this._meshBuilder(this._index, P, this._positions, f, this._indices, p, this._uvs, _, this._colors, c, this._normals, x, 0, null), this._addParticle(x, M, R, S, this._shapeCounter, 0, E), this.particles[this.nbParticles].position.addInPlace(m), this._index += P.length, x++ , this.nbParticles++ , this._shapeCounter++ , h += i } return this }, e.prototype._unrotateFixedNormals = function () { for (var e = 0, t = 0, i = 0; i < this.particles.length; i++) { this._particle = this.particles[i], this._shape = this._particle._model._shape, this._particle.rotationQuaternion ? this._quaternion.copyFrom(this._particle.rotationQuaternion) : (this._yaw = this._particle.rotation.y, this._pitch = this._particle.rotation.x, this._roll = this._particle.rotation.z, this._quaternionRotationYPR()), this._quaternionToRotationMatrix(), this._rotMatrix.invertToRef(this._invertMatrix); for (var r = 0; r < this._shape.length; r++)t = e + 3 * r, fi.Vector3.TransformNormalFromFloatsToRef(this._normals32[t], this._normals32[t + 1], this._normals32[t + 2], this._invertMatrix, this._normal), this._fixedNormal32[t] = this._normal.x, this._fixedNormal32[t + 1] = this._normal.y, this._fixedNormal32[t + 2] = this._normal.z; e = t + 3 } }, e.prototype._resetCopy = function () { this._copy.position.x = 0, this._copy.position.y = 0, this._copy.position.z = 0, this._copy.rotation.x = 0, this._copy.rotation.y = 0, this._copy.rotation.z = 0, this._copy.rotationQuaternion = null, this._copy.scaling.x = 1, this._copy.scaling.y = 1, this._copy.scaling.z = 1, this._copy.uvs.x = 0, this._copy.uvs.y = 0, this._copy.uvs.z = 1, this._copy.uvs.w = 1, this._copy.color = null, this._copy.translateFromPivot = !1 }, e.prototype._meshBuilder = function (e, t, i, r, n, o, s, a, l, c, h, u, d, f) { var p, _ = 0, m = 0, g = 0; for (this._resetCopy(), f && f.positionFunction && (f.positionFunction(this._copy, u, d), this._mustUnrotateFixedNormals = !0), this._copy.rotationQuaternion ? this._quaternion.copyFrom(this._copy.rotationQuaternion) : (this._yaw = this._copy.rotation.y, this._pitch = this._copy.rotation.x, this._roll = this._copy.rotation.z, this._quaternionRotationYPR()), this._quaternionToRotationMatrix(), this._scaledPivot.x = this._copy.pivot.x * this._copy.scaling.x, this._scaledPivot.y = this._copy.pivot.y * this._copy.scaling.y, this._scaledPivot.z = this._copy.pivot.z * this._copy.scaling.z, this._copy.translateFromPivot ? this._pivotBackTranslation.copyFromFloats(0, 0, 0) : this._pivotBackTranslation.copyFrom(this._scaledPivot), p = 0; p < t.length; p++)this._vertex.x = t[p].x, this._vertex.y = t[p].y, this._vertex.z = t[p].z, f && f.vertexFunction && f.vertexFunction(this._copy, this._vertex, p), this._vertex.x *= this._copy.scaling.x, this._vertex.y *= this._copy.scaling.y, this._vertex.z *= this._copy.scaling.z, this._vertex.x -= this._scaledPivot.x, this._vertex.y -= this._scaledPivot.y, this._vertex.z -= this._scaledPivot.z, fi.Vector3.TransformCoordinatesToRef(this._vertex, this._rotMatrix, this._rotated), this._rotated.addInPlace(this._pivotBackTranslation), i.push(this._copy.position.x + this._rotated.x, this._copy.position.y + this._rotated.y, this._copy.position.z + this._rotated.z), o && (s.push((this._copy.uvs.z - this._copy.uvs.x) * o[_] + this._copy.uvs.x, (this._copy.uvs.w - this._copy.uvs.y) * o[_ + 1] + this._copy.uvs.y), _ += 2), this._copy.color ? this._color = this._copy.color : a && void 0 !== a[m] ? (this._color.r = a[m], this._color.g = a[m + 1], this._color.b = a[m + 2], this._color.a = a[m + 3]) : (this._color.r = 1, this._color.g = 1, this._color.b = 1, this._color.a = 1), l.push(this._color.r, this._color.g, this._color.b, this._color.a), m += 4, !this.recomputeNormals && c && (this._normal.x = c[g], this._normal.y = c[g + 1], this._normal.z = c[g + 2], fi.Vector3.TransformNormalToRef(this._normal, this._rotMatrix, this._normal), h.push(this._normal.x, this._normal.y, this._normal.z), g += 3); for (p = 0; p < r.length; p++) { var v = e + r[p]; n.push(v), 65535 < v && (this._needs32Bits = !0) } if (this._pickable) { var y = r.length / 3; for (p = 0; p < y; p++)this.pickedParticles.push({ idx: u, faceId: p }) } return this._depthSort && this.depthSortedParticles.push(new fi.DepthSortedParticle), this._copy }, e.prototype._posToShape = function (e) { for (var t = [], i = 0; i < e.length; i += 3)t.push(new fi.Vector3(e[i], e[i + 1], e[i + 2])); return t }, e.prototype._uvsToShapeUV = function (e) { var t = []; if (e) for (var i = 0; i < e.length; i++)t.push(e[i]); return t }, e.prototype._addParticle = function (e, t, i, r, n, o, s) { void 0 === s && (s = null); var a = new fi.SolidParticle(e, t, i, r, n, o, this, s); return this.particles.push(a), a }, e.prototype.addShape = function (e, t, i) { var r, n = e.getVerticesData(fi.VertexBuffer.PositionKind), o = e.getIndices(), s = e.getVerticesData(fi.VertexBuffer.UVKind), a = e.getVerticesData(fi.VertexBuffer.ColorKind), l = e.getVerticesData(fi.VertexBuffer.NormalKind); this._particlesIntersect && (r = e.getBoundingInfo()); for (var c, h, u = this._posToShape(n), d = this._uvsToShapeUV(s), f = i ? i.positionFunction : null, p = i ? i.vertexFunction : null, _ = new fi.ModelShape(this._shapeCounter, u, o.length, d, f, p), m = this.nbParticles, g = 0; g < t; g++) { var v = this._positions.length, y = this._indices.length; h = this._meshBuilder(this._index, u, this._positions, o, this._indices, s, this._uvs, a, this._colors, l, this._normals, m, g, i), this._updatable && ((c = this._addParticle(m, v, y, _, this._shapeCounter, g, r)).position.copyFrom(h.position), c.rotation.copyFrom(h.rotation), h.rotationQuaternion && c.rotationQuaternion && c.rotationQuaternion.copyFrom(h.rotationQuaternion), h.color && c.color && c.color.copyFrom(h.color), c.scaling.copyFrom(h.scaling), c.uvs.copyFrom(h.uvs)), this._index += u.length, m++ } return this.nbParticles += t, this._shapeCounter++ , this._shapeCounter - 1 }, e.prototype._rebuildParticle = function (e) { this._resetCopy(), e._model._positionFunction && e._model._positionFunction(this._copy, e.idx, e.idxInShape), this._copy.rotationQuaternion ? this._quaternion.copyFrom(this._copy.rotationQuaternion) : (this._yaw = this._copy.rotation.y, this._pitch = this._copy.rotation.x, this._roll = this._copy.rotation.z, this._quaternionRotationYPR()), this._quaternionToRotationMatrix(), this._scaledPivot.x = this._particle.pivot.x * this._particle.scaling.x, this._scaledPivot.y = this._particle.pivot.y * this._particle.scaling.y, this._scaledPivot.z = this._particle.pivot.z * this._particle.scaling.z, this._copy.translateFromPivot ? this._pivotBackTranslation.copyFromFloats(0, 0, 0) : this._pivotBackTranslation.copyFrom(this._scaledPivot), this._shape = e._model._shape; for (var t = 0; t < this._shape.length; t++)this._vertex.x = this._shape[t].x, this._vertex.y = this._shape[t].y, this._vertex.z = this._shape[t].z, e._model._vertexFunction && e._model._vertexFunction(this._copy, this._vertex, t), this._vertex.x *= this._copy.scaling.x, this._vertex.y *= this._copy.scaling.y, this._vertex.z *= this._copy.scaling.z, this._vertex.x -= this._scaledPivot.x, this._vertex.y -= this._scaledPivot.y, this._vertex.z -= this._scaledPivot.z, fi.Vector3.TransformCoordinatesToRef(this._vertex, this._rotMatrix, this._rotated), this._rotated.addInPlace(this._pivotBackTranslation), this._positions32[e._pos + 3 * t] = this._copy.position.x + this._rotated.x, this._positions32[e._pos + 3 * t + 1] = this._copy.position.y + this._rotated.y, this._positions32[e._pos + 3 * t + 2] = this._copy.position.z + this._rotated.z; e.position.x = 0, e.position.y = 0, e.position.z = 0, e.rotation.x = 0, e.rotation.y = 0, e.rotation.z = 0, e.rotationQuaternion = null, e.scaling.x = 1, e.scaling.y = 1, e.scaling.z = 1, e.uvs.x = 0, e.uvs.y = 0, e.uvs.z = 1, e.uvs.w = 1, e.pivot.x = 0, e.pivot.y = 0, e.pivot.z = 0, e.translateFromPivot = !1, e.parentId = null }, e.prototype.rebuildMesh = function () { for (var e = 0; e < this.particles.length; e++)this._rebuildParticle(this.particles[e]); return this.mesh.updateVerticesData(fi.VertexBuffer.PositionKind, this._positions32, !1, !1), this }, e.prototype.setParticles = function (e, t, i) { if (void 0 === e && (e = 0), void 0 === t && (t = this.nbParticles - 1), void 0 === i && (i = !0), !this._updatable) return this; if (this.beforeUpdateParticles(e, t, i), this._cam_axisX.x = 1, this._cam_axisX.y = 0, this._cam_axisX.z = 0, this._cam_axisY.x = 0, this._cam_axisY.y = 1, this._cam_axisY.z = 0, this._cam_axisZ.x = 0, this._cam_axisZ.y = 0, this._cam_axisZ.z = 1, (this.billboard || this._depthSort) && (this.mesh.computeWorldMatrix(!0), this.mesh._worldMatrix.invertToRef(this._invertMatrix)), this.billboard) { this._camera.getDirectionToRef(this._axisZ, this._camDir), fi.Vector3.TransformNormalToRef(this._camDir, this._invertMatrix, this._cam_axisZ), this._cam_axisZ.normalize(); var r = this._camera.getViewMatrix(!0); fi.Vector3.TransformNormalFromFloatsToRef(r.m[1], r.m[5], r.m[9], this._invertMatrix, this._cam_axisY), fi.Vector3.CrossToRef(this._cam_axisY, this._cam_axisZ, this._cam_axisX), this._cam_axisY.normalize(), this._cam_axisX.normalize() } this._depthSort && fi.Vector3.TransformCoordinatesToRef(this._camera.globalPosition, this._invertMatrix, this._camInvertedPosition), fi.Matrix.IdentityToRef(this._rotMatrix); var n = 0, o = 0, s = 0, a = 0, l = 0, c = 0, h = 0; this.mesh.isFacetDataEnabled && (this._computeBoundingBox = !0), t = t >= this.nbParticles ? this.nbParticles - 1 : t, this._computeBoundingBox && (0 == e && t == this.nbParticles - 1 ? (fi.Vector3.FromFloatsToRef(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, this._minimum), fi.Vector3.FromFloatsToRef(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE, this._maximum)) : this.mesh._boundingInfo && (this._minimum.copyFrom(this.mesh._boundingInfo.boundingBox.minimum), this._maximum.copyFrom(this.mesh._boundingInfo.boundingBox.maximum))); var u = (o = this.particles[e]._pos) / 3 | 0; a = 4 * u, c = 2 * u; for (var d = e; d <= t; d++) { if (this._particle = this.particles[d], this._shape = this._particle._model._shape, this._shapeUV = this._particle._model._shapeUV, this.updateParticle(this._particle), this._depthSort && this._depthSortParticles) { var f = this.depthSortedParticles[d]; f.ind = this._particle._ind, f.indicesLength = this._particle._model._indicesLength, f.sqDistance = fi.Vector3.DistanceSquared(this._particle.position, this._camInvertedPosition) } if (!this._particle.alive || this._particle._stillInvisible && !this._particle.isVisible) o += 3 * (h = this._shape.length), a += 4 * h, c += 2 * h; else { if (this._particle.isVisible) for (this._particle._stillInvisible = !1, this._particleHasParent = null !== this._particle.parentId, this._scaledPivot.x = this._particle.pivot.x * this._particle.scaling.x, this._scaledPivot.y = this._particle.pivot.y * this._particle.scaling.y, this._scaledPivot.z = this._particle.pivot.z * this._particle.scaling.z, this.billboard && (this._particle.rotation.x = 0, this._particle.rotation.y = 0), (this._computeParticleRotation || this.billboard) && (this._particle.rotationQuaternion ? this._quaternion.copyFrom(this._particle.rotationQuaternion) : (this._yaw = this._particle.rotation.y, this._pitch = this._particle.rotation.x, this._roll = this._particle.rotation.z, this._quaternionRotationYPR()), this._quaternionToRotationMatrix()), this._particleHasParent ? (this._parent = this.particles[this._particle.parentId], this._rotated.x = this._particle.position.x * this._parent._rotationMatrix[0] + this._particle.position.y * this._parent._rotationMatrix[3] + this._particle.position.z * this._parent._rotationMatrix[6], this._rotated.y = this._particle.position.x * this._parent._rotationMatrix[1] + this._particle.position.y * this._parent._rotationMatrix[4] + this._particle.position.z * this._parent._rotationMatrix[7], this._rotated.z = this._particle.position.x * this._parent._rotationMatrix[2] + this._particle.position.y * this._parent._rotationMatrix[5] + this._particle.position.z * this._parent._rotationMatrix[8], this._particle._globalPosition.x = this._parent._globalPosition.x + this._rotated.x, this._particle._globalPosition.y = this._parent._globalPosition.y + this._rotated.y, this._particle._globalPosition.z = this._parent._globalPosition.z + this._rotated.z, (this._computeParticleRotation || this.billboard) && (this._particle._rotationMatrix[0] = this._rotMatrix.m[0] * this._parent._rotationMatrix[0] + this._rotMatrix.m[1] * this._parent._rotationMatrix[3] + this._rotMatrix.m[2] * this._parent._rotationMatrix[6], this._particle._rotationMatrix[1] = this._rotMatrix.m[0] * this._parent._rotationMatrix[1] + this._rotMatrix.m[1] * this._parent._rotationMatrix[4] + this._rotMatrix.m[2] * this._parent._rotationMatrix[7], this._particle._rotationMatrix[2] = this._rotMatrix.m[0] * this._parent._rotationMatrix[2] + this._rotMatrix.m[1] * this._parent._rotationMatrix[5] + this._rotMatrix.m[2] * this._parent._rotationMatrix[8], this._particle._rotationMatrix[3] = this._rotMatrix.m[4] * this._parent._rotationMatrix[0] + this._rotMatrix.m[5] * this._parent._rotationMatrix[3] + this._rotMatrix.m[6] * this._parent._rotationMatrix[6], this._particle._rotationMatrix[4] = this._rotMatrix.m[4] * this._parent._rotationMatrix[1] + this._rotMatrix.m[5] * this._parent._rotationMatrix[4] + this._rotMatrix.m[6] * this._parent._rotationMatrix[7], this._particle._rotationMatrix[5] = this._rotMatrix.m[4] * this._parent._rotationMatrix[2] + this._rotMatrix.m[5] * this._parent._rotationMatrix[5] + this._rotMatrix.m[6] * this._parent._rotationMatrix[8], this._particle._rotationMatrix[6] = this._rotMatrix.m[8] * this._parent._rotationMatrix[0] + this._rotMatrix.m[9] * this._parent._rotationMatrix[3] + this._rotMatrix.m[10] * this._parent._rotationMatrix[6], this._particle._rotationMatrix[7] = this._rotMatrix.m[8] * this._parent._rotationMatrix[1] + this._rotMatrix.m[9] * this._parent._rotationMatrix[4] + this._rotMatrix.m[10] * this._parent._rotationMatrix[7], this._particle._rotationMatrix[8] = this._rotMatrix.m[8] * this._parent._rotationMatrix[2] + this._rotMatrix.m[9] * this._parent._rotationMatrix[5] + this._rotMatrix.m[10] * this._parent._rotationMatrix[8])) : (this._particle._globalPosition.x = this._particle.position.x, this._particle._globalPosition.y = this._particle.position.y, this._particle._globalPosition.z = this._particle.position.z, (this._computeParticleRotation || this.billboard) && (this._particle._rotationMatrix[0] = this._rotMatrix.m[0], this._particle._rotationMatrix[1] = this._rotMatrix.m[1], this._particle._rotationMatrix[2] = this._rotMatrix.m[2], this._particle._rotationMatrix[3] = this._rotMatrix.m[4], this._particle._rotationMatrix[4] = this._rotMatrix.m[5], this._particle._rotationMatrix[5] = this._rotMatrix.m[6], this._particle._rotationMatrix[6] = this._rotMatrix.m[8], this._particle._rotationMatrix[7] = this._rotMatrix.m[9], this._particle._rotationMatrix[8] = this._rotMatrix.m[10])), this._particle.translateFromPivot ? (this._pivotBackTranslation.x = 0, this._pivotBackTranslation.y = 0, this._pivotBackTranslation.z = 0) : (this._pivotBackTranslation.x = this._scaledPivot.x, this._pivotBackTranslation.y = this._scaledPivot.y, this._pivotBackTranslation.z = this._scaledPivot.z), h = 0; h < this._shape.length; h++)n = o + 3 * h, s = a + 4 * h, l = c + 2 * h, this._vertex.x = this._shape[h].x, this._vertex.y = this._shape[h].y, this._vertex.z = this._shape[h].z, this._computeParticleVertex && this.updateParticleVertex(this._particle, this._vertex, h), this._vertex.x *= this._particle.scaling.x, this._vertex.y *= this._particle.scaling.y, this._vertex.z *= this._particle.scaling.z, this._vertex.x -= this._scaledPivot.x, this._vertex.y -= this._scaledPivot.y, this._vertex.z -= this._scaledPivot.z, this._rotated.x = this._vertex.x * this._particle._rotationMatrix[0] + this._vertex.y * this._particle._rotationMatrix[3] + this._vertex.z * this._particle._rotationMatrix[6], this._rotated.y = this._vertex.x * this._particle._rotationMatrix[1] + this._vertex.y * this._particle._rotationMatrix[4] + this._vertex.z * this._particle._rotationMatrix[7], this._rotated.z = this._vertex.x * this._particle._rotationMatrix[2] + this._vertex.y * this._particle._rotationMatrix[5] + this._vertex.z * this._particle._rotationMatrix[8], this._rotated.x += this._pivotBackTranslation.x, this._rotated.y += this._pivotBackTranslation.y, this._rotated.z += this._pivotBackTranslation.z, this._positions32[n] = this._particle._globalPosition.x + this._cam_axisX.x * this._rotated.x + this._cam_axisY.x * this._rotated.y + this._cam_axisZ.x * this._rotated.z, this._positions32[n + 1] = this._particle._globalPosition.y + this._cam_axisX.y * this._rotated.x + this._cam_axisY.y * this._rotated.y + this._cam_axisZ.y * this._rotated.z, this._positions32[n + 2] = this._particle._globalPosition.z + this._cam_axisX.z * this._rotated.x + this._cam_axisY.z * this._rotated.y + this._cam_axisZ.z * this._rotated.z, this._computeBoundingBox && (this._positions32[n] < this._minimum.x && (this._minimum.x = this._positions32[n]), this._positions32[n] > this._maximum.x && (this._maximum.x = this._positions32[n]), this._positions32[n + 1] < this._minimum.y && (this._minimum.y = this._positions32[n + 1]), this._positions32[n + 1] > this._maximum.y && (this._maximum.y = this._positions32[n + 1]), this._positions32[n + 2] < this._minimum.z && (this._minimum.z = this._positions32[n + 2]), this._positions32[n + 2] > this._maximum.z && (this._maximum.z = this._positions32[n + 2])), this._computeParticleVertex || (this._normal.x = this._fixedNormal32[n], this._normal.y = this._fixedNormal32[n + 1], this._normal.z = this._fixedNormal32[n + 2], this._rotated.x = this._normal.x * this._particle._rotationMatrix[0] + this._normal.y * this._particle._rotationMatrix[3] + this._normal.z * this._particle._rotationMatrix[6], this._rotated.y = this._normal.x * this._particle._rotationMatrix[1] + this._normal.y * this._particle._rotationMatrix[4] + this._normal.z * this._particle._rotationMatrix[7], this._rotated.z = this._normal.x * this._particle._rotationMatrix[2] + this._normal.y * this._particle._rotationMatrix[5] + this._normal.z * this._particle._rotationMatrix[8], this._normals32[n] = this._cam_axisX.x * this._rotated.x + this._cam_axisY.x * this._rotated.y + this._cam_axisZ.x * this._rotated.z, this._normals32[n + 1] = this._cam_axisX.y * this._rotated.x + this._cam_axisY.y * this._rotated.y + this._cam_axisZ.y * this._rotated.z, this._normals32[n + 2] = this._cam_axisX.z * this._rotated.x + this._cam_axisY.z * this._rotated.y + this._cam_axisZ.z * this._rotated.z), this._computeParticleColor && this._particle.color && (this._colors32[s] = this._particle.color.r, this._colors32[s + 1] = this._particle.color.g, this._colors32[s + 2] = this._particle.color.b, this._colors32[s + 3] = this._particle.color.a), this._computeParticleTexture && (this._uvs32[l] = this._shapeUV[2 * h] * (this._particle.uvs.z - this._particle.uvs.x) + this._particle.uvs.x, this._uvs32[l + 1] = this._shapeUV[2 * h + 1] * (this._particle.uvs.w - this._particle.uvs.y) + this._particle.uvs.y); else for (this._particle._stillInvisible = !0, h = 0; h < this._shape.length; h++)n = o + 3 * h, s = a + 4 * h, l = c + 2 * h, this._positions32[n] = 0, this._positions32[n + 1] = 0, this._positions32[n + 2] = 0, this._normals32[n] = 0, this._normals32[n + 1] = 0, this._normals32[n + 2] = 0, this._computeParticleColor && this._particle.color && (this._colors32[s] = this._particle.color.r, this._colors32[s + 1] = this._particle.color.g, this._colors32[s + 2] = this._particle.color.b, this._colors32[s + 3] = this._particle.color.a), this._computeParticleTexture && (this._uvs32[l] = this._shapeUV[2 * h] * (this._particle.uvs.z - this._particle.uvs.x) + this._particle.uvs.x, this._uvs32[l + 1] = this._shapeUV[2 * h + 1] * (this._particle.uvs.w - this._particle.uvs.y) + this._particle.uvs.y); if (this._particlesIntersect) { var p = this._particle._boundingInfo, _ = p.boundingBox, m = p.boundingSphere; if (!this._bSphereOnly) { for (var g = 0; g < _.vectors.length; g++)this._vertex.x = this._particle._modelBoundingInfo.boundingBox.vectors[g].x * this._particle.scaling.x, this._vertex.y = this._particle._modelBoundingInfo.boundingBox.vectors[g].y * this._particle.scaling.y, this._vertex.z = this._particle._modelBoundingInfo.boundingBox.vectors[g].z * this._particle.scaling.z, this._rotated.x = this._vertex.x * this._particle._rotationMatrix[0] + this._vertex.y * this._particle._rotationMatrix[3] + this._vertex.z * this._particle._rotationMatrix[6], this._rotated.y = this._vertex.x * this._particle._rotationMatrix[1] + this._vertex.y * this._particle._rotationMatrix[4] + this._vertex.z * this._particle._rotationMatrix[7], this._rotated.z = this._vertex.x * this._particle._rotationMatrix[2] + this._vertex.y * this._particle._rotationMatrix[5] + this._vertex.z * this._particle._rotationMatrix[8], _.vectors[g].x = this._particle.position.x + this._cam_axisX.x * this._rotated.x + this._cam_axisY.x * this._rotated.y + this._cam_axisZ.x * this._rotated.z, _.vectors[g].y = this._particle.position.y + this._cam_axisX.y * this._rotated.x + this._cam_axisY.y * this._rotated.y + this._cam_axisZ.y * this._rotated.z, _.vectors[g].z = this._particle.position.z + this._cam_axisX.z * this._rotated.x + this._cam_axisY.z * this._rotated.y + this._cam_axisZ.z * this._rotated.z; _._update(this.mesh._worldMatrix) } this._minBbox.x = this._particle._modelBoundingInfo.minimum.x * this._particle.scaling.x, this._minBbox.y = this._particle._modelBoundingInfo.minimum.y * this._particle.scaling.y, this._minBbox.z = this._particle._modelBoundingInfo.minimum.z * this._particle.scaling.z, this._maxBbox.x = this._particle._modelBoundingInfo.maximum.x * this._particle.scaling.x, this._maxBbox.y = this._particle._modelBoundingInfo.maximum.y * this._particle.scaling.y, this._maxBbox.z = this._particle._modelBoundingInfo.maximum.z * this._particle.scaling.z, m.center.x = this._particle._globalPosition.x + .5 * (this._minBbox.x + this._maxBbox.x), m.center.y = this._particle._globalPosition.y + .5 * (this._minBbox.y + this._maxBbox.y), m.center.z = this._particle._globalPosition.z + .5 * (this._minBbox.z + this._maxBbox.z), m.radius = .5 * this._bSphereRadiusFactor * Math.sqrt((this._maxBbox.x - this._minBbox.x) * (this._maxBbox.x - this._minBbox.x) + (this._maxBbox.y - this._minBbox.y) * (this._maxBbox.y - this._minBbox.y) + (this._maxBbox.z - this._minBbox.z) * (this._maxBbox.z - this._minBbox.z)), m._update(this.mesh._worldMatrix) } o = n + 3, a = s + 4, c = l + 2 } } if (i) { if (this._computeParticleColor && this.mesh.updateVerticesData(fi.VertexBuffer.ColorKind, this._colors32, !1, !1), this._computeParticleTexture && this.mesh.updateVerticesData(fi.VertexBuffer.UVKind, this._uvs32, !1, !1), this.mesh.updateVerticesData(fi.VertexBuffer.PositionKind, this._positions32, !1, !1), !this.mesh.areNormalsFrozen || this.mesh.isFacetDataEnabled) { if (this._computeParticleVertex || this.mesh.isFacetDataEnabled) { var v = this.mesh.isFacetDataEnabled ? this.mesh.getFacetDataParameters() : null; fi.VertexData.ComputeNormals(this._positions32, this._indices32, this._normals32, v); for (var y = 0; y < this._normals32.length; y++)this._fixedNormal32[y] = this._normals32[y] } this.mesh.areNormalsFrozen || this.mesh.updateVerticesData(fi.VertexBuffer.NormalKind, this._normals32, !1, !1) } if (this._depthSort && this._depthSortParticles) { this.depthSortedParticles.sort(this._depthSortFunction); var b = this.depthSortedParticles.length, T = 0, E = 0, x = 0, P = 0; for (T = 0; T < b; T++)for (E = this.depthSortedParticles[T].indicesLength, x = this.depthSortedParticles[T].ind, y = 0; y < E; y++)this._indices32[P] = this._indices[x + y], P++; this.mesh.updateIndices(this._indices32) } } return this._computeBoundingBox && (this.mesh._boundingInfo = new fi.BoundingInfo(this._minimum, this._maximum), this.mesh._boundingInfo.update(this.mesh._worldMatrix)), this.afterUpdateParticles(e, t, i), this }, e.prototype._quaternionRotationYPR = function () { this._halfroll = .5 * this._roll, this._halfpitch = .5 * this._pitch, this._halfyaw = .5 * this._yaw, this._sinRoll = Math.sin(this._halfroll), this._cosRoll = Math.cos(this._halfroll), this._sinPitch = Math.sin(this._halfpitch), this._cosPitch = Math.cos(this._halfpitch), this._sinYaw = Math.sin(this._halfyaw), this._cosYaw = Math.cos(this._halfyaw), this._quaternion.x = this._cosYaw * this._sinPitch * this._cosRoll + this._sinYaw * this._cosPitch * this._sinRoll, this._quaternion.y = this._sinYaw * this._cosPitch * this._cosRoll - this._cosYaw * this._sinPitch * this._sinRoll, this._quaternion.z = this._cosYaw * this._cosPitch * this._sinRoll - this._sinYaw * this._sinPitch * this._cosRoll, this._quaternion.w = this._cosYaw * this._cosPitch * this._cosRoll + this._sinYaw * this._sinPitch * this._sinRoll }, e.prototype._quaternionToRotationMatrix = function () { this._rotMatrix.m[0] = 1 - 2 * (this._quaternion.y * this._quaternion.y + this._quaternion.z * this._quaternion.z), this._rotMatrix.m[1] = 2 * (this._quaternion.x * this._quaternion.y + this._quaternion.z * this._quaternion.w), this._rotMatrix.m[2] = 2 * (this._quaternion.z * this._quaternion.x - this._quaternion.y * this._quaternion.w), this._rotMatrix.m[3] = 0, this._rotMatrix.m[4] = 2 * (this._quaternion.x * this._quaternion.y - this._quaternion.z * this._quaternion.w), this._rotMatrix.m[5] = 1 - 2 * (this._quaternion.z * this._quaternion.z + this._quaternion.x * this._quaternion.x), this._rotMatrix.m[6] = 2 * (this._quaternion.y * this._quaternion.z + this._quaternion.x * this._quaternion.w), this._rotMatrix.m[7] = 0, this._rotMatrix.m[8] = 2 * (this._quaternion.z * this._quaternion.x + this._quaternion.y * this._quaternion.w), this._rotMatrix.m[9] = 2 * (this._quaternion.y * this._quaternion.z - this._quaternion.x * this._quaternion.w), this._rotMatrix.m[10] = 1 - 2 * (this._quaternion.y * this._quaternion.y + this._quaternion.x * this._quaternion.x), this._rotMatrix.m[11] = 0, this._rotMatrix.m[12] = 0, this._rotMatrix.m[13] = 0, this._rotMatrix.m[14] = 0, this._rotMatrix.m[15] = 1 }, e.prototype.dispose = function () { this.mesh.dispose(), this.vars = null, this._positions = null, this._indices = null, this._normals = null, this._uvs = null, this._colors = null, this._indices32 = null, this._positions32 = null, this._normals32 = null, this._fixedNormal32 = null, this._uvs32 = null, this._colors32 = null, this.pickedParticles = null }, e.prototype.refreshVisibleSize = function () { return this._isVisibilityBoxLocked || this.mesh.refreshBoundingInfo(), this }, e.prototype.setVisibilityBox = function (e) { var t = e / 2; this.mesh._boundingInfo = new fi.BoundingInfo(new fi.Vector3(-t, -t, -t), new fi.Vector3(t, t, t)) }, Object.defineProperty(e.prototype, "isAlwaysVisible", { get: function () { return this._alwaysVisible }, set: function (e) { this._alwaysVisible = e, this.mesh.alwaysSelectAsActiveMesh = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "isVisibilityBoxLocked", { get: function () { return this._isVisibilityBoxLocked }, set: function (e) { this._isVisibilityBoxLocked = e, this.mesh.getBoundingInfo().isLocked = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "computeParticleRotation", { get: function () { return this._computeParticleRotation }, set: function (e) { this._computeParticleRotation = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "computeParticleColor", { get: function () { return this._computeParticleColor }, set: function (e) { this._computeParticleColor = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "computeParticleTexture", { get: function () { return this._computeParticleTexture }, set: function (e) { this._computeParticleTexture = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "computeParticleVertex", { get: function () { return this._computeParticleVertex }, set: function (e) { this._computeParticleVertex = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "computeBoundingBox", { get: function () { return this._computeBoundingBox }, set: function (e) { this._computeBoundingBox = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "depthSortParticles", { get: function () { return this._depthSortParticles }, set: function (e) { this._depthSortParticles = e }, enumerable: !0, configurable: !0 }), e.prototype.initParticles = function () { }, e.prototype.recycleParticle = function (e) { return e }, e.prototype.updateParticle = function (e) { return e }, e.prototype.updateParticleVertex = function (e, t, i) { return t }, e.prototype.beforeUpdateParticles = function (e, t, i) { }, e.prototype.afterUpdateParticles = function (e, t, i) { }, e }(), fi.SolidParticleSystem = pi, _i = $a || ($a = {}), mi = function () { function e() { } return e.updateSideOrientation = function (e) { return e == _i.Mesh.DOUBLESIDE ? _i.Mesh.DOUBLESIDE : null == e ? _i.Mesh.FRONTSIDE : e }, e.CreateBox = function (t, i, r) { void 0 === r && (r = null); var n = new _i.Mesh(t, r); return i.sideOrientation = e.updateSideOrientation(i.sideOrientation), n._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreateBox(i).applyToMesh(n, i.updatable), n }, e.CreateSphere = function (t, i, r) { var n = new _i.Mesh(t, r); return i.sideOrientation = e.updateSideOrientation(i.sideOrientation), n._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreateSphere(i).applyToMesh(n, i.updatable), n }, e.CreateDisc = function (t, i, r) { void 0 === r && (r = null); var n = new _i.Mesh(t, r); return i.sideOrientation = e.updateSideOrientation(i.sideOrientation), n._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreateDisc(i).applyToMesh(n, i.updatable), n }, e.CreateIcoSphere = function (t, i, r) { var n = new _i.Mesh(t, r); return i.sideOrientation = e.updateSideOrientation(i.sideOrientation), n._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreateIcoSphere(i).applyToMesh(n, i.updatable), n }, e.CreateRibbon = function (t, i, r) { void 0 === r && (r = null); var n = i.pathArray, o = i.closeArray, s = i.closePath, a = e.updateSideOrientation(i.sideOrientation), l = i.instance, c = i.updatable; if (l) { _i.Vector3.FromFloatsToRef(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, _i.Tmp.Vector3[0]), _i.Vector3.FromFloatsToRef(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE, _i.Tmp.Vector3[1]); var h = l.getVerticesData(_i.VertexBuffer.PositionKind); if (function (e) { for (var t = n[0].length, i = l, r = 0, o = i._originalBuilderSideOrientation === _i.Mesh.DOUBLESIDE ? 2 : 1, s = 1; s <= o; s++)for (var a = 0; a < n.length; a++) { var c = n[a], h = c.length; t = t < h ? t : h; for (var u = 0; u < t;)e[r] = c[u].x, e[r + 1] = c[u].y, e[r + 2] = c[u].z, c[u].x < _i.Tmp.Vector3[0].x && (_i.Tmp.Vector3[0].x = c[u].x), c[u].x > _i.Tmp.Vector3[1].x && (_i.Tmp.Vector3[1].x = c[u].x), c[u].y < _i.Tmp.Vector3[0].y && (_i.Tmp.Vector3[0].y = c[u].y), c[u].y > _i.Tmp.Vector3[1].y && (_i.Tmp.Vector3[1].y = c[u].y), c[u].z < _i.Tmp.Vector3[0].z && (_i.Tmp.Vector3[0].z = c[u].z), c[u].z > _i.Tmp.Vector3[1].z && (_i.Tmp.Vector3[1].z = c[u].z), u++ , r += 3; i._creationDataStorage && i._creationDataStorage.closePath && (e[r] = c[0].x, e[r + 1] = c[0].y, e[r + 2] = c[0].z, r += 3) } }(h), l._boundingInfo = new _i.BoundingInfo(_i.Tmp.Vector3[2], _i.Tmp.Vector3[3]), l._boundingInfo.update(l._worldMatrix), l.updateVerticesData(_i.VertexBuffer.PositionKind, h, !1, !1), i.colors) { for (var u = l.getVerticesData(_i.VertexBuffer.ColorKind), d = 0; d < i.colors.length; d++)u[4 * d] = i.colors[d].r, u[4 * d + 1] = i.colors[d].g, u[4 * d + 2] = i.colors[d].b, u[4 * d + 3] = i.colors[d].a; l.updateVerticesData(_i.VertexBuffer.ColorKind, u, !1, !1) } if (i.uvs) { for (var f = l.getVerticesData(_i.VertexBuffer.UVKind), p = 0; p < i.uvs.length; p++)f[2 * p] = i.uvs[p].x, f[2 * p + 1] = i.uvs[p].y; l.updateVerticesData(_i.VertexBuffer.UVKind, f, !1, !1) } if (!l.areNormalsFrozen || l.isFacetDataEnabled) { var _ = l.getIndices(), m = l.getVerticesData(_i.VertexBuffer.NormalKind), g = l.isFacetDataEnabled ? l.getFacetDataParameters() : null; if (_i.VertexData.ComputeNormals(h, _, m, g), l._creationDataStorage && l._creationDataStorage.closePath) for (var v = 0, y = 0, b = 0; b < n.length; b++)v = 3 * l._creationDataStorage.idx[b], y = b + 1 < n.length ? 3 * (l._creationDataStorage.idx[b + 1] - 1) : m.length - 3, m[v] = .5 * (m[v] + m[y]), m[v + 1] = .5 * (m[v + 1] + m[y + 1]), m[v + 2] = .5 * (m[v + 2] + m[y + 2]), m[y] = m[v], m[y + 1] = m[v + 1], m[y + 2] = m[v + 2]; l.areNormalsFrozen || l.updateVerticesData(_i.VertexBuffer.NormalKind, m, !1, !1) } return l } var T = new _i.Mesh(t, r); T._originalBuilderSideOrientation = a, T._creationDataStorage = new _i._CreationDataStorage; var E = _i.VertexData.CreateRibbon(i); return s && (T._creationDataStorage.idx = E._idx), T._creationDataStorage.closePath = s, T._creationDataStorage.closeArray = o, E.applyToMesh(T, c), T }, e.CreateCylinder = function (t, i, r) { var n = new _i.Mesh(t, r); return i.sideOrientation = e.updateSideOrientation(i.sideOrientation), n._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreateCylinder(i).applyToMesh(n, i.updatable), n }, e.CreateTorus = function (t, i, r) { var n = new _i.Mesh(t, r); return i.sideOrientation = e.updateSideOrientation(i.sideOrientation), n._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreateTorus(i).applyToMesh(n, i.updatable), n }, e.CreateTorusKnot = function (t, i, r) { var n = new _i.Mesh(t, r); return i.sideOrientation = e.updateSideOrientation(i.sideOrientation), n._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreateTorusKnot(i).applyToMesh(n, i.updatable), n }, e.CreateLineSystem = function (e, t, i) { var r = t.instance, n = t.lines, o = t.colors; if (r) { var s, a, l = r.getVerticesData(_i.VertexBuffer.PositionKind); o && (s = r.getVerticesData(_i.VertexBuffer.ColorKind)); for (var c = 0, h = 0, u = 0; u < n.length; u++)for (var d = n[u], f = 0; f < d.length; f++)l[c] = d[f].x, l[c + 1] = d[f].y, l[c + 2] = d[f].z, o && s && (a = o[u], s[h] = a[f].r, s[h + 1] = a[f].g, s[h + 2] = a[f].b, s[h + 3] = a[f].a, h += 4), c += 3; return r.updateVerticesData(_i.VertexBuffer.PositionKind, l, !1, !1), o && s && r.updateVerticesData(_i.VertexBuffer.ColorKind, s, !1, !1), r } var p = !!o, _ = new _i.LinesMesh(e, i, null, void 0, void 0, p, t.useVertexAlpha); return _i.VertexData.CreateLineSystem(t).applyToMesh(_, t.updatable), _ }, e.CreateLines = function (t, i, r) { void 0 === r && (r = null); var n = i.colors ? [i.colors] : null; return e.CreateLineSystem(t, { lines: [i.points], updatable: i.updatable, instance: i.instance, colors: n, useVertexAlpha: i.useVertexAlpha }, r) }, e.CreateDashedLines = function (e, t, i) { void 0 === i && (i = null); var r = t.points, n = t.instance, o = t.gapSize || 1, s = t.dashSize || 3; if (n) return n.updateMeshPositions(function (e) { var t, i, o = _i.Vector3.Zero(), s = e.length / 6, a = 0, l = 0, c = 0, h = 0, u = 0, d = 0; for (u = 0; u < r.length - 1; u++)r[u + 1].subtractToRef(r[u], o), a += o.length(); t = a / s; var f = n._creationDataStorage.dashSize; for (i = f * t / (f + n._creationDataStorage.gapSize), u = 0; u < r.length - 1; u++)for (r[u + 1].subtractToRef(r[u], o), l = Math.floor(o.length() / t), o.normalize(), d = 0; d < l && h < e.length;)c = t * d, e[h] = r[u].x + c * o.x, e[h + 1] = r[u].y + c * o.y, e[h + 2] = r[u].z + c * o.z, e[h + 3] = r[u].x + (c + i) * o.x, e[h + 4] = r[u].y + (c + i) * o.y, e[h + 5] = r[u].z + (c + i) * o.z, h += 6, d++; for (; h < e.length;)e[h] = r[u].x, e[h + 1] = r[u].y, e[h + 2] = r[u].z, h += 3 }, !1), n; var a = new _i.LinesMesh(e, i); return _i.VertexData.CreateDashedLines(t).applyToMesh(a, t.updatable), a._creationDataStorage = new _i._CreationDataStorage, a._creationDataStorage.dashSize = s, a._creationDataStorage.gapSize = o, a }, e.ExtrudeShape = function (t, i, r) { void 0 === r && (r = null); var n = i.path, o = i.shape, s = i.scale || 1, a = i.rotation || 0, l = 0 === i.cap ? 0 : i.cap || _i.Mesh.NO_CAP, c = i.updatable, h = e.updateSideOrientation(i.sideOrientation), u = i.instance || null, d = i.invertUV || !1; return e._ExtrudeShapeGeneric(t, o, n, s, a, null, null, !1, !1, l, !1, r, !!c, h, u, d, i.frontUVs || null, i.backUVs || null) }, e.ExtrudeShapeCustom = function (t, i, r) { var n = i.path, o = i.shape, s = i.scaleFunction || function () { return 1 }, a = i.rotationFunction || function () { return 0 }, l = i.ribbonCloseArray || !1, c = i.ribbonClosePath || !1, h = 0 === i.cap ? 0 : i.cap || _i.Mesh.NO_CAP, u = i.updatable, d = e.updateSideOrientation(i.sideOrientation), f = i.instance, p = i.invertUV || !1; return e._ExtrudeShapeGeneric(t, o, n, null, null, s, a, l, c, h, !0, r, !!u, d, f || null, p, i.frontUVs || null, i.backUVs || null) }, e.CreateLathe = function (t, i, r) { var n, o = i.arc ? i.arc <= 0 || 1 < i.arc ? 1 : i.arc : 1, s = void 0 === i.closed || i.closed, a = i.shape, l = i.radius || 1, c = i.tessellation || 64, h = i.clip || 0, u = i.updatable, d = e.updateSideOrientation(i.sideOrientation), f = i.cap || _i.Mesh.NO_CAP, p = 2 * Math.PI, _ = new Array, m = i.invertUV || !1, g = 0, v = 0, y = p / c * o, b = new Array; for (g = 0; g <= c - h; g++) { for (b = [], f != _i.Mesh.CAP_START && f != _i.Mesh.CAP_ALL || (b.push(new _i.Vector3(0, a[0].y, 0)), b.push(new _i.Vector3(Math.cos(g * y) * a[0].x * l, a[0].y, Math.sin(g * y) * a[0].x * l))), v = 0; v < a.length; v++)n = new _i.Vector3(Math.cos(g * y) * a[v].x * l, a[v].y, Math.sin(g * y) * a[v].x * l), b.push(n); f != _i.Mesh.CAP_END && f != _i.Mesh.CAP_ALL || (b.push(new _i.Vector3(Math.cos(g * y) * a[a.length - 1].x * l, a[a.length - 1].y, Math.sin(g * y) * a[a.length - 1].x * l)), b.push(new _i.Vector3(0, a[a.length - 1].y, 0))), _.push(b) } return e.CreateRibbon(t, { pathArray: _, closeArray: s, sideOrientation: d, updatable: u, invertUV: m, frontUVs: i.frontUVs, backUVs: i.backUVs }, r) }, e.CreatePlane = function (t, i, r) { var n = new _i.Mesh(t, r); if (i.sideOrientation = e.updateSideOrientation(i.sideOrientation), n._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreatePlane(i).applyToMesh(n, i.updatable), i.sourcePlane) { n.translate(i.sourcePlane.normal, i.sourcePlane.d); var o = Math.acos(_i.Vector3.Dot(i.sourcePlane.normal, _i.Axis.Z)), s = _i.Vector3.Cross(_i.Axis.Z, i.sourcePlane.normal); s.lengthSquared() > _i.Epsilon && n.rotate(s, o) } return n }, e.CreateGround = function (e, t, i) { var r = new _i.GroundMesh(e, i); return r._setReady(!1), r._subdivisionsX = t.subdivisionsX || t.subdivisions || 1, r._subdivisionsY = t.subdivisionsY || t.subdivisions || 1, r._width = t.width || 1, r._height = t.height || 1, r._maxX = r._width / 2, r._maxZ = r._height / 2, r._minX = -r._maxX, r._minZ = -r._maxZ, _i.VertexData.CreateGround(t).applyToMesh(r, t.updatable), r._setReady(!0), r }, e.CreateTiledGround = function (e, t, i) { var r = new _i.Mesh(e, i); return _i.VertexData.CreateTiledGround(t).applyToMesh(r, t.updatable), r }, e.CreateGroundFromHeightMap = function (e, t, i, r) { var n = i.width || 10, o = i.height || 10, s = i.subdivisions || 1, a = i.minHeight || 0, l = i.maxHeight || 1, c = i.colorFilter || new _i.Color3(.3, .59, .11), h = i.alphaFilter || 0, u = i.updatable, d = i.onReady, f = new _i.GroundMesh(e, r); return f._subdivisionsX = s, f._subdivisionsY = s, f._width = n, f._height = o, f._maxX = f._width / 2, f._maxZ = f._height / 2, f._minX = -f._maxX, f._minZ = -f._maxZ, f._setReady(!1), _i.Tools.LoadImage(t, function (e) { var t = document.createElement("canvas"), i = t.getContext("2d"); if (!i) throw new Error("Unable to get 2d context for CreateGroundFromHeightMap"); if (!r.isDisposed) { var p = e.width, _ = e.height; t.width = p, t.height = _, i.drawImage(e, 0, 0); var m = i.getImageData(0, 0, p, _).data; _i.VertexData.CreateGroundFromHeightMap({ width: n, height: o, subdivisions: s, minHeight: a, maxHeight: l, colorFilter: c, buffer: m, bufferWidth: p, bufferHeight: _, alphaFilter: h }).applyToMesh(f, u), d && d(f), f._setReady(!0) } }, function () { }, r.database), f }, e.CreatePolygon = function (t, i, r) { i.sideOrientation = e.updateSideOrientation(i.sideOrientation); for (var n = i.shape, o = i.holes || [], s = i.depth || 0, a = [], l = [], c = 0; c < n.length; c++)a[c] = new _i.Vector2(n[c].x, n[c].z); a[0].equalsWithEpsilon(a[a.length - 1], 1e-8) && a.pop(); for (var h = new _i.PolygonMeshBuilder(t, a, r), u = 0; u < o.length; u++) { l = []; for (var d = 0; d < o[u].length; d++)l.push(new _i.Vector2(o[u][d].x, o[u][d].z)); h.addHole(l) } var f = h.build(i.updatable, s); return f._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreatePolygon(f, i.sideOrientation, i.faceUV, i.faceColors, i.frontUVs, i.backUVs).applyToMesh(f, i.updatable), f }, e.ExtrudePolygon = function (t, i, r) { return e.CreatePolygon(t, i, r) }, e.CreateTube = function (t, i, r) { var n = i.path, o = i.instance, s = 1; void 0 !== i.radius ? s = i.radius : o && (s = o._creationDataStorage.radius); var a = i.tessellation || 64, l = i.radiusFunction || null, c = i.cap || _i.Mesh.NO_CAP, h = i.invertUV || !1, u = i.updatable, d = e.updateSideOrientation(i.sideOrientation); i.arc = i.arc && (i.arc <= 0 || 1 < i.arc) ? 1 : i.arc || 1; var f, p, _ = function (e, t, i, r, n, o, s, a) { for (var l, c, h, u, d = t.getTangents(), f = t.getNormals(), p = t.getDistances(), _ = 2 * Math.PI / n * a, m = o || function () { return r }, g = _i.Tmp.Matrix[0], v = s === _i.Mesh.NO_CAP || s === _i.Mesh.CAP_END ? 0 : 2, y = 0; y < e.length; y++) { c = m(y, p[y]), l = Array(), h = f[y]; for (var b = 0; b < n; b++)_i.Matrix.RotationAxisToRef(d[y], _ * b, g), u = l[b] ? l[b] : _i.Vector3.Zero(), _i.Vector3.TransformCoordinatesToRef(h, g, u), u.scaleInPlace(c).addInPlace(e[y]), l[b] = u; i[v] = l, v++ } var T = function (t, i) { for (var r = Array(), n = 0; n < t; n++)r.push(e[i]); return r }; switch (s) { case _i.Mesh.NO_CAP: break; case _i.Mesh.CAP_START: i[0] = T(n, 0), i[1] = i[2].slice(0); break; case _i.Mesh.CAP_END: i[v] = i[v - 1].slice(0), i[v + 1] = T(n, e.length - 1); break; case _i.Mesh.CAP_ALL: i[0] = T(n, 0), i[1] = i[2].slice(0), i[v] = i[v - 1].slice(0), i[v + 1] = T(n, e.length - 1) }return i }; if (o) { var m = o._creationDataStorage, g = i.arc || m.arc; return p = _(n, f = m.path3D.update(n), m.pathArray, s, m.tessellation, l, m.cap, g), o = e.CreateRibbon("", { pathArray: p, instance: o }), m.path3D = f, m.pathArray = p, m.arc = g, m.radius = s, o } p = _(n, f = new _i.Path3D(n), new Array, s, a, l, c = c < 0 || 3 < c ? 0 : c, i.arc); var v = e.CreateRibbon(t, { pathArray: p, closePath: !0, closeArray: !1, updatable: u, sideOrientation: d, invertUV: h, frontUVs: i.frontUVs, backUVs: i.backUVs }, r); return v._creationDataStorage.pathArray = p, v._creationDataStorage.path3D = f, v._creationDataStorage.tessellation = a, v._creationDataStorage.cap = c, v._creationDataStorage.arc = i.arc, v._creationDataStorage.radius = s, v }, e.CreatePolyhedron = function (t, i, r) { var n = new _i.Mesh(t, r); return i.sideOrientation = e.updateSideOrientation(i.sideOrientation), n._originalBuilderSideOrientation = i.sideOrientation, _i.VertexData.CreatePolyhedron(i).applyToMesh(n, i.updatable), n }, e.CreateDecal = function (e, t, i) { var r = t.getIndices(), n = t.getVerticesData(_i.VertexBuffer.PositionKind), o = t.getVerticesData(_i.VertexBuffer.NormalKind), s = i.position || _i.Vector3.Zero(), a = i.normal || _i.Vector3.Up(), l = i.size || _i.Vector3.One(), c = i.angle || 0; if (!a) { var h = new _i.Vector3(0, 0, 1), u = t.getScene().activeCamera, d = _i.Vector3.TransformCoordinates(h, u.getWorldMatrix()); a = u.globalPosition.subtract(d) } var f = -Math.atan2(a.z, a.x) - Math.PI / 2, p = Math.sqrt(a.x * a.x + a.z * a.z), _ = Math.atan2(a.y, p), m = _i.Matrix.RotationYawPitchRoll(f, _, c).multiply(_i.Matrix.Translation(s.x, s.y, s.z)), g = _i.Matrix.Invert(m), v = t.getWorldMatrix().multiply(g), y = new _i.VertexData; y.indices = [], y.positions = [], y.normals = [], y.uvs = []; for (var b = 0, T = function (e) { var t = new _i.PositionNormalVertex; if (!r || !n || !o) return t; var i = r[e]; return t.position = new _i.Vector3(n[3 * i], n[3 * i + 1], n[3 * i + 2]), t.position = _i.Vector3.TransformCoordinates(t.position, v), t.normal = new _i.Vector3(o[3 * i], o[3 * i + 1], o[3 * i + 2]), t.normal = _i.Vector3.TransformNormal(t.normal, v), t }, E = function (e, t) { if (0 === e.length) return e; for (var i = .5 * Math.abs(_i.Vector3.Dot(l, t)), r = function (e, r) { var n = _i.Vector3.GetClipFactor(e.position, r.position, t, i); return new _i.PositionNormalVertex(_i.Vector3.Lerp(e.position, r.position, n), _i.Vector3.Lerp(e.normal, r.normal, n)) }, n = new Array, o = 0; o < e.length; o += 3) { var s, a, c, h = null, u = null, d = null, f = null; switch (((s = 0 < _i.Vector3.Dot(e[o].position, t) - i) ? 1 : 0) + ((a = 0 < _i.Vector3.Dot(e[o + 1].position, t) - i) ? 1 : 0) + ((c = 0 < _i.Vector3.Dot(e[o + 2].position, t) - i) ? 1 : 0)) { case 0: n.push(e[o]), n.push(e[o + 1]), n.push(e[o + 2]); break; case 1: if (s && (h = e[o + 1], u = e[o + 2], d = r(e[o], h), f = r(e[o], u)), a) { h = e[o], u = e[o + 2], d = r(e[o + 1], h), f = r(e[o + 1], u), n.push(d), n.push(u.clone()), n.push(h.clone()), n.push(u.clone()), n.push(d.clone()), n.push(f); break } c && (h = e[o], u = e[o + 1], d = r(e[o + 2], h), f = r(e[o + 2], u)), h && u && d && f && (n.push(h.clone()), n.push(u.clone()), n.push(d), n.push(f), n.push(d.clone()), n.push(u.clone())); break; case 2: s || (u = r(h = e[o].clone(), e[o + 1]), d = r(h, e[o + 2]), n.push(h), n.push(u), n.push(d)), a || (u = r(h = e[o + 1].clone(), e[o + 2]), d = r(h, e[o]), n.push(h), n.push(u), n.push(d)), c || (u = r(h = e[o + 2].clone(), e[o]), d = r(h, e[o + 1]), n.push(h), n.push(u), n.push(d)) } } return n }, x = 0; x < r.length; x += 3) { var P = new Array; if (P.push(T(x)), P.push(T(x + 1)), P.push(T(x + 2)), 0 !== (P = E(P = E(P = E(P = E(P = E(P = E(P, new _i.Vector3(1, 0, 0)), new _i.Vector3(-1, 0, 0)), new _i.Vector3(0, 1, 0)), new _i.Vector3(0, -1, 0)), new _i.Vector3(0, 0, 1)), new _i.Vector3(0, 0, -1))).length) for (var A = 0; A < P.length; A++) { var S = P[A]; y.indices.push(b), S.position.toArray(y.positions, 3 * b), S.normal.toArray(y.normals, 3 * b), y.uvs.push(.5 + S.position.x / l.x), y.uvs.push(.5 + S.position.y / l.y), b++ } } var M = new _i.Mesh(e, t.getScene()); return y.applyToMesh(M), M.position = s.clone(), M.rotation = new _i.Vector3(_, f, c), M }, e._ExtrudeShapeGeneric = function (t, i, r, n, o, s, a, l, c, h, u, d, f, p, _, m, g, v) { var y, b, T = function (e, t, i, r, n, o, s, a, l, c) { for (var h = i.getTangents(), u = i.getNormals(), d = i.getBinormals(), f = i.getDistances(), p = 0, _ = c && a ? a : function () { return null !== o ? o : 0 }, m = c && s ? s : function () { return null !== n ? n : 1 }, g = l === _i.Mesh.NO_CAP || l === _i.Mesh.CAP_END ? 0 : 2, v = _i.Tmp.Matrix[0], y = 0; y < t.length; y++) { for (var b = new Array, T = _(y, f[y]), E = m(y, f[y]), x = 0; x < e.length; x++) { _i.Matrix.RotationAxisToRef(h[y], p, v); var P = h[y].scale(e[x].z).add(u[y].scale(e[x].x)).add(d[y].scale(e[x].y)), A = b[x] ? b[x] : _i.Vector3.Zero(); _i.Vector3.TransformCoordinatesToRef(P, v, A), A.scaleInPlace(E).addInPlace(t[y]), b[x] = A } r[g] = b, p += T, g++ } var S = function (e) { var t, i = Array(), r = _i.Vector3.Zero(); for (t = 0; t < e.length; t++)r.addInPlace(e[t]); for (r.scaleInPlace(1 / e.length), t = 0; t < e.length; t++)i.push(r); return i }; switch (l) { case _i.Mesh.NO_CAP: break; case _i.Mesh.CAP_START: r[0] = S(r[2]), r[1] = r[2]; break; case _i.Mesh.CAP_END: r[g] = r[g - 1], r[g + 1] = S(r[g - 1]); break; case _i.Mesh.CAP_ALL: r[0] = S(r[2]), r[1] = r[2], r[g] = r[g - 1], r[g + 1] = S(r[g - 1]) }return r }; if (_) { var E = _._creationDataStorage; return y = E.path3D.update(r), b = T(i, r, E.path3D, E.pathArray, n, o, s, a, E.cap, u), _i.Mesh.CreateRibbon("", b, !1, !1, 0, d || void 0, !1, 0, _) } b = T(i, r, y = new _i.Path3D(r), new Array, n, o, s, a, h = h < 0 || 3 < h ? 0 : h, u); var x = e.CreateRibbon(t, { pathArray: b, closeArray: l, closePath: c, updatable: f, sideOrientation: p, invertUV: m, frontUVs: g || void 0, backUVs: v || void 0 }, d); return x._creationDataStorage.pathArray = b, x._creationDataStorage.path3D = y, x._creationDataStorage.cap = h, x }, e }(), _i.MeshBuilder = mi, gi = $a || ($a = {}), vi = function () { function e() { } return Object.defineProperty(e, "DecoderAvailable", { get: function () { if ("undefined" != typeof DracoDecoderModule) return !0; var t = e.Configuration.decoder; if (t) { if (t.wasmUrl && t.wasmBinaryUrl && "object" == typeof WebAssembly) return !0; if (t.fallbackUrl) return !0 } return !1 }, enumerable: !0, configurable: !0 }), e.prototype.dispose = function () { }, e.prototype.decodeMeshAsync = function (t, i) { var r = t instanceof ArrayBuffer ? new Uint8Array(t) : t; return e._GetDecoderModule().then(function (e) { var t = e.module, n = new gi.VertexData, o = new t.DecoderBuffer; o.Init(r, r.byteLength); var s, a, l = new t.Decoder; try { var c = l.GetEncodedGeometryType(o); switch (c) { case t.TRIANGULAR_MESH: s = new t.Mesh, a = l.DecodeBufferToMesh(o, s); break; case t.POINT_CLOUD: s = new t.PointCloud, a = l.DecodeBufferToPointCloud(o, s); break; default: throw new Error("Invalid geometry type " + c) }if (!a.ok() || !s.ptr) throw new Error(a.error_msg()); var h = s.num_points(); if (c === t.TRIANGULAR_MESH) { var u = s.num_faces(), d = new t.DracoInt32Array; try { for (var f = new Uint32Array(3 * u), p = 0; p < u; p++) { l.GetFaceFromMesh(s, p, d); var _ = 3 * p; f[_ + 0] = d.GetValue(0), f[_ + 1] = d.GetValue(1), f[_ + 2] = d.GetValue(2) } n.indices = f } finally { t.destroy(d) } } for (var m in i) { var g = i[m], v = l.GetAttributeByUniqueId(s, g), y = new t.DracoFloat32Array; try { l.GetAttributeFloatForAllPoints(s, v, y); var b = new Float32Array(h * v.num_components()); for (p = 0; p < b.length; p++)b[p] = y.GetValue(p); n.set(b, m) } finally { t.destroy(y) } } } finally { s && t.destroy(s), t.destroy(l), t.destroy(o) } return n }) }, e._GetDecoderModule = function () { if (!e._DecoderModulePromise) { var t = null, i = {}; if ("undefined" != typeof DracoDecoderModule) t = Promise.resolve(); else { var r = e.Configuration.decoder; r && (r.wasmUrl && r.wasmBinaryUrl && "object" == typeof WebAssembly ? t = Promise.all([e._LoadScriptAsync(r.wasmUrl), e._LoadFileAsync(r.wasmBinaryUrl).then(function (e) { i.wasmBinary = e })]) : r.fallbackUrl && (t = e._LoadScriptAsync(r.fallbackUrl))) } if (!t) throw new Error("Draco decoder module is not available"); e._DecoderModulePromise = t.then(function () { return new Promise(function (e) { i.onModuleLoaded = function (t) { e({ module: t }) }, DracoDecoderModule(i) }) }) } return e._DecoderModulePromise }, e._LoadScriptAsync = function (e) { return new Promise(function (t, i) { gi.Tools.LoadScript(e, function () { t() }, function (e) { i(new Error(e)) }) }) }, e._LoadFileAsync = function (e) { return new Promise(function (t, i) { gi.Tools.LoadFile(e, function (e) { t(e) }, void 0, void 0, !0, function (e, t) { i(t) }) }) }, e.Configuration = { decoder: { wasmUrl: "https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js", wasmBinaryUrl: "https://preview.babylonjs.com/draco_decoder_gltf.wasm", fallbackUrl: "https://preview.babylonjs.com/draco_decoder_gltf.js" } }, e }(), gi.DracoCompression = vi, function (e) { e.Engine.AudioEngineFactory = function (e) { return new t(e) }; var t = function () { function t(t) { void 0 === t && (t = null); var i = this; this._audioContext = null, this._audioContextInitialized = !1, this._muteButton = null, this.canUseWebAudio = !1, this.WarnedWebAudioUnsupported = !1, this.isMP3supported = !1, this.isOGGsupported = !1, this.unlocked = !0, this.useCustomUnlockedButton = !1, this.onAudioUnlockedObservable = new e.Observable, this.onAudioLockedObservable = new e.Observable, this._tryToRun = !1, this._onResize = function () { i._moveButtonToTopLeft() }, void 0 === window.AudioContext && void 0 === window.webkitAudioContext || (window.AudioContext = window.AudioContext || window.webkitAudioContext, this.canUseWebAudio = !0); var r = document.createElement("audio"); this._hostElement = t; try { r && r.canPlayType && r.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/, "") && (this.isMP3supported = !0) } catch (t) { } try { r && r.canPlayType && r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, "") && (this.isOGGsupported = !0) } catch (t) { } } return Object.defineProperty(t.prototype, "audioContext", { get: function () { return this._audioContextInitialized ? this.unlocked || this._muteButton || this._displayMuteButton() : this._initializeAudioContext(), this._audioContext }, enumerable: !0, configurable: !0 }), t.prototype.lock = function () { this._triggerSuspendedState() }, t.prototype.unlock = function () { this._triggerRunningState() }, t.prototype._resumeAudioContext = function () { var e; return this._audioContext.resume && (e = this._audioContext.resume()), e || Promise.resolve() }, t.prototype._initializeAudioContext = function () { try { this.canUseWebAudio && (this._audioContext = new AudioContext, this.masterGain = this._audioContext.createGain(), this.masterGain.gain.value = 1, this.masterGain.connect(this._audioContext.destination), this._audioContextInitialized = !0, "running" === this._audioContext.state && this._triggerRunningState()) } catch (t) { this.canUseWebAudio = !1, e.Tools.Error("Web Audio: " + t.message) } }, t.prototype._triggerRunningState = function () { var e = this; this._tryToRun || (this._tryToRun = !0, this._resumeAudioContext().then(function () { e._tryToRun = !1, e._muteButton && e._hideMuteButton() }).catch(function () { e._tryToRun = !1, e.unlocked = !1 }), this.unlocked = !0, this.onAudioUnlockedObservable.notifyObservers(this)) }, t.prototype._triggerSuspendedState = function () { this.unlocked = !1, this.onAudioLockedObservable.notifyObservers(this), this._displayMuteButton() }, t.prototype._displayMuteButton = function () { var e = this; if (!this.useCustomUnlockedButton) { this._muteButton = document.createElement("BUTTON"), this._muteButton.className = "babylonUnmuteIcon", this._muteButton.id = "babylonUnmuteIconBtn", this._muteButton.title = "Unmute"; var t = document.createElement("style"); t.appendChild(document.createTextNode(".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E);  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }")), document.getElementsByTagName("head")[0].appendChild(t), document.body.appendChild(this._muteButton), this._moveButtonToTopLeft(), this._muteButton.addEventListener("touchend", function () { e._triggerRunningState() }, !0), this._muteButton.addEventListener("click", function () { e._triggerRunningState() }, !0), window.addEventListener("resize", this._onResize) } }, t.prototype._moveButtonToTopLeft = function () { this._hostElement && this._muteButton && (this._muteButton.style.top = this._hostElement.offsetTop + 20 + "px", this._muteButton.style.left = this._hostElement.offsetLeft + 20 + "px") }, t.prototype._hideMuteButton = function () { this._muteButton && (document.body.removeChild(this._muteButton), this._muteButton = null) }, t.prototype.dispose = function () { this.canUseWebAudio && this._audioContextInitialized && (this._connectedAnalyser && this._audioContext && (this._connectedAnalyser.stopDebugCanvas(), this._connectedAnalyser.dispose(), this.masterGain.disconnect(), this.masterGain.connect(this._audioContext.destination), this._connectedAnalyser = null), this.masterGain.gain.value = 1), this.WarnedWebAudioUnsupported = !1, this._hideMuteButton(), window.removeEventListener("resize", this._onResize), this.onAudioUnlockedObservable.clear(), this.onAudioLockedObservable.clear() }, t.prototype.getGlobalVolume = function () { return this.canUseWebAudio && this._audioContextInitialized ? this.masterGain.gain.value : -1 }, t.prototype.setGlobalVolume = function (e) { this.canUseWebAudio && this._audioContextInitialized && (this.masterGain.gain.value = e) }, t.prototype.connectToAnalyser = function (e) { this._connectedAnalyser && this._connectedAnalyser.stopDebugCanvas(), this.canUseWebAudio && this._audioContextInitialized && this._audioContext && (this._connectedAnalyser = e, this.masterGain.disconnect(), this._connectedAnalyser.connectAudioNodes(this.masterGain, this._audioContext.destination)) }, t }(); e.AudioEngine = t }($a || ($a = {})), yi = $a || ($a = {}), bi = function () { function e(e, t, i, r, n) { void 0 === r && (r = null); var o = this; this.autoplay = !1, this.loop = !1, this.useCustomAttenuation = !1, this.isPlaying = !1, this.isPaused = !1, this.spatialSound = !1, this.refDistance = 1, this.rolloffFactor = 1, this.maxDistance = 100, this.distanceModel = "linear", this.onEndedObservable = new yi.Observable, this._panningModel = "equalpower", this._playbackRate = 1, this._streaming = !1, this._startTime = 0, this._startOffset = 0, this._position = yi.Vector3.Zero(), this._positionInEmitterSpace = !1, this._localDirection = new yi.Vector3(1, 0, 0), this._volume = 1, this._isReadyToPlay = !1, this._isDirectional = !1, this._coneInnerAngle = 360, this._coneOuterAngle = 360, this._coneOuterGain = 0, this._isOutputConnected = !1, this._urlType = "Unknown", this.name = e; var s = (this._scene = i)._getComponent(yi.SceneComponentConstants.NAME_AUDIO); if (s || (s = new yi.AudioSceneComponent(i), i._addComponent(s)), this._readyToPlayCallback = r, this._customAttenuationFunction = function (e, t, i, r, n) { return t < i ? e * (1 - t / i) : 0 }, n && (this.autoplay = n.autoplay || !1, this.loop = n.loop || !1, void 0 !== n.volume && (this._volume = n.volume), this.spatialSound = n.spatialSound || !1, this.maxDistance = n.maxDistance || 100, this.useCustomAttenuation = n.useCustomAttenuation || !1, this.rolloffFactor = n.rolloffFactor || 1, this.refDistance = n.refDistance || 1, this.distanceModel = n.distanceModel || "linear", this._playbackRate = n.playbackRate || 1, this._streaming = n.streaming || !1), yi.Engine.audioEngine.canUseWebAudio && yi.Engine.audioEngine.audioContext) { this._soundGain = yi.Engine.audioEngine.audioContext.createGain(), this._soundGain.gain.value = this._volume, this._inputAudioNode = this._soundGain, this._outputAudioNode = this._soundGain, this.spatialSound && this._createSpatialParameters(), this._scene.mainSoundTrack.AddSound(this); var a = !0; if (t) try { "string" == typeof t ? this._urlType = "String" : t instanceof ArrayBuffer ? this._urlType = "ArrayBuffer" : t instanceof MediaStream ? this._urlType = "MediaStream" : Array.isArray(t) && (this._urlType = "Array"); var l = [], c = !1; switch (this._urlType) { case "MediaStream": this._streaming = !0, this._isReadyToPlay = !0, this._streamingSource = yi.Engine.audioEngine.audioContext.createMediaElementSource(t), this.autoplay && this.play(), this._readyToPlayCallback && this._readyToPlayCallback(); break; case "ArrayBuffer": 0 < t.byteLength && (c = !0, this._soundLoaded(t)); break; case "String": l.push(t); case "Array": 0 === l.length && (l = t); for (var h = 0; h < l.length; h++) { var u = l[h]; if (-1 !== u.indexOf(".mp3", u.length - 4) && yi.Engine.audioEngine.isMP3supported && (c = !0), -1 !== u.indexOf(".ogg", u.length - 4) && yi.Engine.audioEngine.isOGGsupported && (c = !0), -1 !== u.indexOf(".wav", u.length - 4) && (c = !0), -1 !== u.indexOf("blob:") && (c = !0), c) { this._streaming ? (this._htmlAudioElement = new Audio(u), this._htmlAudioElement.controls = !1, this._htmlAudioElement.loop = this.loop, yi.Tools.SetCorsBehavior(u, this._htmlAudioElement), this._htmlAudioElement.preload = "auto", this._htmlAudioElement.addEventListener("canplaythrough", function () { o._isReadyToPlay = !0, o.autoplay && o.play(), o._readyToPlayCallback && o._readyToPlayCallback() }), document.body.appendChild(this._htmlAudioElement), this._htmlAudioElement.load()) : this._scene._loadFile(u, function (e) { o._soundLoaded(e) }, void 0, !0, !0, function (e) { e && yi.Tools.Error("XHR " + e.status + " error on: " + u + "."), yi.Tools.Error("Sound creation aborted."), o._scene.mainSoundTrack.RemoveSound(o) }); break } } break; default: a = !1 }a ? c || (this._isReadyToPlay = !0, this._readyToPlayCallback && window.setTimeout(function () { o._readyToPlayCallback && o._readyToPlayCallback() }, 1e3)) : yi.Tools.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.") } catch (e) { yi.Tools.Error("Unexpected error. Sound creation aborted."), this._scene.mainSoundTrack.RemoveSound(this) } } else this._scene.mainSoundTrack.AddSound(this), yi.Engine.audioEngine.WarnedWebAudioUnsupported || (yi.Tools.Error("Web Audio is not supported by your browser."), yi.Engine.audioEngine.WarnedWebAudioUnsupported = !0), this._readyToPlayCallback && window.setTimeout(function () { o._readyToPlayCallback && o._readyToPlayCallback() }, 1e3) } return e.prototype.dispose = function () { yi.Engine.audioEngine.canUseWebAudio && (this.isPlaying && this.stop(), this._isReadyToPlay = !1, -1 === this.soundTrackId ? this._scene.mainSoundTrack.RemoveSound(this) : this._scene.soundTracks && this._scene.soundTracks[this.soundTrackId].RemoveSound(this), this._soundGain && (this._soundGain.disconnect(), this._soundGain = null), this._soundPanner && (this._soundPanner.disconnect(), this._soundPanner = null), this._soundSource && (this._soundSource.disconnect(), this._soundSource = null), this._audioBuffer = null, this._htmlAudioElement && (this._htmlAudioElement.pause(), this._htmlAudioElement.src = "", document.body.removeChild(this._htmlAudioElement)), this._streamingSource && this._streamingSource.disconnect(), this._connectedMesh && this._registerFunc && (this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc), this._connectedMesh = null)) }, e.prototype.isReady = function () { return this._isReadyToPlay }, e.prototype._soundLoaded = function (e) { var t = this; yi.Engine.audioEngine.audioContext && yi.Engine.audioEngine.audioContext.decodeAudioData(e, function (e) { t._audioBuffer = e, t._isReadyToPlay = !0, t.autoplay && t.play(), t._readyToPlayCallback && t._readyToPlayCallback() }, function (e) { yi.Tools.Error("Error while decoding audio data for: " + t.name + " / Error: " + e) }) }, e.prototype.setAudioBuffer = function (e) { yi.Engine.audioEngine.canUseWebAudio && (this._audioBuffer = e, this._isReadyToPlay = !0) }, e.prototype.updateOptions = function (e) { e && (this.loop = e.loop || this.loop, this.maxDistance = e.maxDistance || this.maxDistance, this.useCustomAttenuation = e.useCustomAttenuation || this.useCustomAttenuation, this.rolloffFactor = e.rolloffFactor || this.rolloffFactor, this.refDistance = e.refDistance || this.refDistance, this.distanceModel = e.distanceModel || this.distanceModel, this._playbackRate = e.playbackRate || this._playbackRate, this._updateSpatialParameters(), this.isPlaying && (this._streaming && this._htmlAudioElement ? this._htmlAudioElement.playbackRate = this._playbackRate : this._soundSource && (this._soundSource.playbackRate.value = this._playbackRate))) }, e.prototype._createSpatialParameters = function () { yi.Engine.audioEngine.canUseWebAudio && yi.Engine.audioEngine.audioContext && (this._scene.headphone && (this._panningModel = "HRTF"), this._soundPanner = yi.Engine.audioEngine.audioContext.createPanner(), this._updateSpatialParameters(), this._soundPanner.connect(this._outputAudioNode), this._inputAudioNode = this._soundPanner) }, e.prototype._updateSpatialParameters = function () { this.spatialSound && this._soundPanner && (this.useCustomAttenuation ? (this._soundPanner.distanceModel = "linear", this._soundPanner.maxDistance = Number.MAX_VALUE, this._soundPanner.refDistance = 1, this._soundPanner.rolloffFactor = 1) : (this._soundPanner.distanceModel = this.distanceModel, this._soundPanner.maxDistance = this.maxDistance, this._soundPanner.refDistance = this.refDistance, this._soundPanner.rolloffFactor = this.rolloffFactor), this._soundPanner.panningModel = this._panningModel) }, e.prototype.switchPanningModelToHRTF = function () { this._panningModel = "HRTF", this._switchPanningModel() }, e.prototype.switchPanningModelToEqualPower = function () { this._panningModel = "equalpower", this._switchPanningModel() }, e.prototype._switchPanningModel = function () { yi.Engine.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && (this._soundPanner.panningModel = this._panningModel) }, e.prototype.connectToSoundTrackAudioNode = function (e) { yi.Engine.audioEngine.canUseWebAudio && (this._isOutputConnected && this._outputAudioNode.disconnect(), this._outputAudioNode.connect(e), this._isOutputConnected = !0) }, e.prototype.setDirectionalCone = function (e, t, i) { t < e ? yi.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.") : (this._coneInnerAngle = e, this._coneOuterAngle = t, this._coneOuterGain = i, this._isDirectional = !0, this.isPlaying && this.loop && (this.stop(), this.play())) }, Object.defineProperty(e.prototype, "directionalConeInnerAngle", { get: function () { return this._coneInnerAngle }, set: function (e) { if (e != this._coneInnerAngle) { if (this._coneOuterAngle < e) return void yi.Tools.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle."); this._coneInnerAngle = e, yi.Engine.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && (this._soundPanner.coneInnerAngle = this._coneInnerAngle) } }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "directionalConeOuterAngle", { get: function () { return this._coneOuterAngle }, set: function (e) { if (e != this._coneOuterAngle) { if (e < this._coneInnerAngle) return void yi.Tools.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle."); this._coneOuterAngle = e, yi.Engine.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && (this._soundPanner.coneOuterAngle = this._coneOuterAngle) } }, enumerable: !0, configurable: !0 }), e.prototype.setPosition = function (e) { this._position = e, yi.Engine.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && !isNaN(this._position.x) && !isNaN(this._position.y) && !isNaN(this._position.z) && this._soundPanner.setPosition(this._position.x, this._position.y, this._position.z) }, e.prototype.setLocalDirectionToMesh = function (e) { this._localDirection = e, yi.Engine.audioEngine.canUseWebAudio && this._connectedMesh && this.isPlaying && this._updateDirection() }, e.prototype._updateDirection = function () { if (this._connectedMesh && this._soundPanner) { var e = this._connectedMesh.getWorldMatrix(), t = yi.Vector3.TransformNormal(this._localDirection, e); t.normalize(), this._soundPanner.setOrientation(t.x, t.y, t.z) } }, e.prototype.updateDistanceFromListener = function () { if (yi.Engine.audioEngine.canUseWebAudio && this._connectedMesh && this.useCustomAttenuation && this._soundGain && this._scene.activeCamera) { var e = this._connectedMesh.getDistanceToCamera(this._scene.activeCamera); this._soundGain.gain.value = this._customAttenuationFunction(this._volume, e, this.maxDistance, this.refDistance, this.rolloffFactor) } }, e.prototype.setAttenuationFunction = function (e) { this._customAttenuationFunction = e }, e.prototype.play = function (e, t) { var i = this; if (this._isReadyToPlay && this._scene.audioEnabled && yi.Engine.audioEngine.audioContext) try { this._startOffset < 0 && (e = -this._startOffset, this._startOffset = 0); var r = e ? yi.Engine.audioEngine.audioContext.currentTime + e : yi.Engine.audioEngine.audioContext.currentTime; if (this._soundSource && this._streamingSource || this.spatialSound && this._soundPanner && (isNaN(this._position.x) || isNaN(this._position.y) || isNaN(this._position.z) || this._soundPanner.setPosition(this._position.x, this._position.y, this._position.z), this._isDirectional && (this._soundPanner.coneInnerAngle = this._coneInnerAngle, this._soundPanner.coneOuterAngle = this._coneOuterAngle, this._soundPanner.coneOuterGain = this._coneOuterGain, this._connectedMesh ? this._updateDirection() : this._soundPanner.setOrientation(this._localDirection.x, this._localDirection.y, this._localDirection.z))), this._streaming) { if (this._streamingSource || (this._streamingSource = yi.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement), this._htmlAudioElement.onended = function () { i._onended() }, this._htmlAudioElement.playbackRate = this._playbackRate), this._streamingSource.disconnect(), this._streamingSource.connect(this._inputAudioNode), this._htmlAudioElement) { var n = function () { if (yi.Engine.audioEngine.unlocked) { var e = i._htmlAudioElement.play(); void 0 !== e && e.catch(function (e) { yi.Engine.audioEngine.lock(), yi.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function () { n() }) }) } else yi.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function () { n() }) }; n() } } else this._soundSource = yi.Engine.audioEngine.audioContext.createBufferSource(), this._soundSource.buffer = this._audioBuffer, this._soundSource.connect(this._inputAudioNode), this._soundSource.loop = this.loop, this._soundSource.playbackRate.value = this._playbackRate, this._soundSource.onended = function () { i._onended() }, this._soundSource.buffer && this._soundSource.start(r, this.isPaused ? this._startOffset % this._soundSource.buffer.duration : t || 0); this._startTime = r, this.isPlaying = !0, this.isPaused = !1 } catch (e) { yi.Tools.Error("Error while trying to play audio: " + this.name + ", " + e.message) } }, e.prototype._onended = function () { this.isPlaying = !1, this.onended && this.onended(), this.onEndedObservable.notifyObservers(this) }, e.prototype.stop = function (e) { if (this.isPlaying) { if (this._streaming) this._htmlAudioElement ? (this._htmlAudioElement.pause(), 0 < this._htmlAudioElement.currentTime && (this._htmlAudioElement.currentTime = 0)) : this._streamingSource.disconnect(); else if (yi.Engine.audioEngine.audioContext && this._soundSource) { var t = e ? yi.Engine.audioEngine.audioContext.currentTime + e : yi.Engine.audioEngine.audioContext.currentTime; this._soundSource.stop(t), this._soundSource.onended = function () { }, this.isPaused || (this._startOffset = 0) } this.isPlaying = !1 } }, e.prototype.pause = function () { this.isPlaying && (this.isPaused = !0, this._streaming ? this._htmlAudioElement ? this._htmlAudioElement.pause() : this._streamingSource.disconnect() : yi.Engine.audioEngine.audioContext && (this.stop(0), this._startOffset += yi.Engine.audioEngine.audioContext.currentTime - this._startTime)) }, e.prototype.setVolume = function (e, t) { yi.Engine.audioEngine.canUseWebAudio && this._soundGain && (t && yi.Engine.audioEngine.audioContext ? (this._soundGain.gain.cancelScheduledValues(yi.Engine.audioEngine.audioContext.currentTime), this._soundGain.gain.setValueAtTime(this._soundGain.gain.value, yi.Engine.audioEngine.audioContext.currentTime), this._soundGain.gain.linearRampToValueAtTime(e, yi.Engine.audioEngine.audioContext.currentTime + t)) : this._soundGain.gain.value = e), this._volume = e }, e.prototype.setPlaybackRate = function (e) { this._playbackRate = e, this.isPlaying && (this._streaming && this._htmlAudioElement ? this._htmlAudioElement.playbackRate = this._playbackRate : this._soundSource && (this._soundSource.playbackRate.value = this._playbackRate)) }, e.prototype.getVolume = function () { return this._volume }, e.prototype.attachToMesh = function (e) { var t = this; this._connectedMesh && this._registerFunc && (this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc), this._registerFunc = null), this._connectedMesh = e, this.spatialSound || (this.spatialSound = !0, this._createSpatialParameters(), this.isPlaying && this.loop && (this.stop(), this.play())), this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh), this._registerFunc = function (e) { return t._onRegisterAfterWorldMatrixUpdate(e) }, e.registerAfterWorldMatrixUpdate(this._registerFunc) }, e.prototype.detachFromMesh = function () { this._connectedMesh && this._registerFunc && (this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc), this._registerFunc = null, this._connectedMesh = null) }, e.prototype._onRegisterAfterWorldMatrixUpdate = function (e) { if (e.getBoundingInfo) { var t = e; if (this._positionInEmitterSpace) t.worldMatrixFromCache.invertToRef(yi.Tmp.Matrix[0]), this.setPosition(yi.Tmp.Matrix[0].getTranslation()); else { var i = t.getBoundingInfo(); this.setPosition(i.boundingSphere.centerWorld) } yi.Engine.audioEngine.canUseWebAudio && this._isDirectional && this.isPlaying && this._updateDirection() } }, e.prototype.clone = function () { var t = this; if (this._streaming) return null; var i = function () { t._isReadyToPlay ? (n._audioBuffer = t.getAudioBuffer(), n._isReadyToPlay = !0, n.autoplay && n.play()) : window.setTimeout(i, 300) }, r = { autoplay: this.autoplay, loop: this.loop, volume: this._volume, spatialSound: this.spatialSound, maxDistance: this.maxDistance, useCustomAttenuation: this.useCustomAttenuation, rolloffFactor: this.rolloffFactor, refDistance: this.refDistance, distanceModel: this.distanceModel }, n = new e(this.name + "_cloned", new ArrayBuffer(0), this._scene, null, r); return this.useCustomAttenuation && n.setAttenuationFunction(this._customAttenuationFunction), n.setPosition(this._position), n.setPlaybackRate(this._playbackRate), i(), n }, e.prototype.getAudioBuffer = function () { return this._audioBuffer }, e.prototype.serialize = function () { var e = { name: this.name, url: this.name, autoplay: this.autoplay, loop: this.loop, volume: this._volume, spatialSound: this.spatialSound, maxDistance: this.maxDistance, rolloffFactor: this.rolloffFactor, refDistance: this.refDistance, distanceModel: this.distanceModel, playbackRate: this._playbackRate, panningModel: this._panningModel, soundTrackId: this.soundTrackId }; return this.spatialSound && (this._connectedMesh && (e.connectedMeshId = this._connectedMesh.id), e.position = this._position.asArray(), e.refDistance = this.refDistance, e.distanceModel = this.distanceModel, e.isDirectional = this._isDirectional, e.localDirectionToMesh = this._localDirection.asArray(), e.coneInnerAngle = this._coneInnerAngle, e.coneOuterAngle = this._coneOuterAngle, e.coneOuterGain = this._coneOuterGain), e }, e.Parse = function (t, i, r, n) { var o, s = t.name; o = t.url ? r + t.url : r + s; var a, l = { autoplay: t.autoplay, loop: t.loop, volume: t.volume, spatialSound: t.spatialSound, maxDistance: t.maxDistance, rolloffFactor: t.rolloffFactor, refDistance: t.refDistance, distanceModel: t.distanceModel, playbackRate: t.playbackRate }; if (n) { var c = function () { n._isReadyToPlay ? (a._audioBuffer = n.getAudioBuffer(), a._isReadyToPlay = !0, a.autoplay && a.play()) : window.setTimeout(c, 300) }; a = new e(s, new ArrayBuffer(0), i, null, l), c() } else a = new e(s, o, i, function () { i._removePendingData(a) }, l), i._addPendingData(a); if (t.position) { var h = yi.Vector3.FromArray(t.position); a.setPosition(h) } if (t.isDirectional && (a.setDirectionalCone(t.coneInnerAngle || 360, t.coneOuterAngle || 360, t.coneOuterGain || 0), t.localDirectionToMesh)) { var u = yi.Vector3.FromArray(t.localDirectionToMesh); a.setLocalDirectionToMesh(u) } if (t.connectedMeshId) { var d = i.getMeshByID(t.connectedMeshId); d && a.attachToMesh(d) } return a }, e }(), yi.Sound = bi, Ti = $a || ($a = {}), Ei = function () { function e(e, t) { void 0 === t && (t = {}), this.id = -1, this._isMainTrack = !1, this._isInitialized = !1, this._scene = e, this.soundCollection = new Array, this._options = t, !this._isMainTrack && this._scene.soundTracks && (this._scene.soundTracks.push(this), this.id = this._scene.soundTracks.length - 1) } return e.prototype._initializeSoundTrackAudioGraph = function () { Ti.Engine.audioEngine.canUseWebAudio && Ti.Engine.audioEngine.audioContext && (this._outputAudioNode = Ti.Engine.audioEngine.audioContext.createGain(), this._outputAudioNode.connect(Ti.Engine.audioEngine.masterGain), this._options && (this._options.volume && (this._outputAudioNode.gain.value = this._options.volume), this._options.mainTrack && (this._isMainTrack = this._options.mainTrack)), this._isInitialized = !0) }, e.prototype.dispose = function () { if (Ti.Engine.audioEngine && Ti.Engine.audioEngine.canUseWebAudio) { for (this._connectedAnalyser && this._connectedAnalyser.stopDebugCanvas(); this.soundCollection.length;)this.soundCollection[0].dispose(); this._outputAudioNode && this._outputAudioNode.disconnect(), this._outputAudioNode = null } }, e.prototype.AddSound = function (e) { this._isInitialized || this._initializeSoundTrackAudioGraph(), Ti.Engine.audioEngine.canUseWebAudio && this._outputAudioNode && e.connectToSoundTrackAudioNode(this._outputAudioNode), e.soundTrackId && (-1 === e.soundTrackId ? this._scene.mainSoundTrack.RemoveSound(e) : this._scene.soundTracks && this._scene.soundTracks[e.soundTrackId].RemoveSound(e)), this.soundCollection.push(e), e.soundTrackId = this.id }, e.prototype.RemoveSound = function (e) { var t = this.soundCollection.indexOf(e); -1 !== t && this.soundCollection.splice(t, 1) }, e.prototype.setVolume = function (e) { Ti.Engine.audioEngine.canUseWebAudio && this._outputAudioNode && (this._outputAudioNode.gain.value = e) }, e.prototype.switchPanningModelToHRTF = function () { if (Ti.Engine.audioEngine.canUseWebAudio) for (var e = 0; e < this.soundCollection.length; e++)this.soundCollection[e].switchPanningModelToHRTF() }, e.prototype.switchPanningModelToEqualPower = function () { if (Ti.Engine.audioEngine.canUseWebAudio) for (var e = 0; e < this.soundCollection.length; e++)this.soundCollection[e].switchPanningModelToEqualPower() }, e.prototype.connectToAnalyser = function (e) { this._connectedAnalyser && this._connectedAnalyser.stopDebugCanvas(), this._connectedAnalyser = e, Ti.Engine.audioEngine.canUseWebAudio && this._outputAudioNode && (this._outputAudioNode.disconnect(), this._connectedAnalyser.connectAudioNodes(this._outputAudioNode, Ti.Engine.audioEngine.masterGain)) }, e }(), Ti.SoundTrack = Ei, xi = $a || ($a = {}), Pi = function () { function e(e) { this.SMOOTHING = .75, this.FFT_SIZE = 512, this.BARGRAPHAMPLITUDE = 256, this.DEBUGCANVASPOS = { x: 20, y: 20 }, this.DEBUGCANVASSIZE = { width: 320, height: 200 }, this._scene = e, this._audioEngine = xi.Engine.audioEngine, this._audioEngine.canUseWebAudio && this._audioEngine.audioContext && (this._webAudioAnalyser = this._audioEngine.audioContext.createAnalyser(), this._webAudioAnalyser.minDecibels = -140, this._webAudioAnalyser.maxDecibels = 0, this._byteFreqs = new Uint8Array(this._webAudioAnalyser.frequencyBinCount), this._byteTime = new Uint8Array(this._webAudioAnalyser.frequencyBinCount), this._floatFreqs = new Float32Array(this._webAudioAnalyser.frequencyBinCount)) } return e.prototype.getFrequencyBinCount = function () { return this._audioEngine.canUseWebAudio ? this._webAudioAnalyser.frequencyBinCount : 0 }, e.prototype.getByteFrequencyData = function () { return this._audioEngine.canUseWebAudio && (this._webAudioAnalyser.smoothingTimeConstant = this.SMOOTHING, this._webAudioAnalyser.fftSize = this.FFT_SIZE, this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)), this._byteFreqs }, e.prototype.getByteTimeDomainData = function () { return this._audioEngine.canUseWebAudio && (this._webAudioAnalyser.smoothingTimeConstant = this.SMOOTHING, this._webAudioAnalyser.fftSize = this.FFT_SIZE, this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)), this._byteTime }, e.prototype.getFloatFrequencyData = function () { return this._audioEngine.canUseWebAudio && (this._webAudioAnalyser.smoothingTimeConstant = this.SMOOTHING, this._webAudioAnalyser.fftSize = this.FFT_SIZE, this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)), this._floatFreqs }, e.prototype.drawDebugCanvas = function () { var e = this; if (this._audioEngine.canUseWebAudio && (this._debugCanvas || (this._debugCanvas = document.createElement("canvas"), this._debugCanvas.width = this.DEBUGCANVASSIZE.width, this._debugCanvas.height = this.DEBUGCANVASSIZE.height, this._debugCanvas.style.position = "absolute", this._debugCanvas.style.top = this.DEBUGCANVASPOS.y + "px", this._debugCanvas.style.left = this.DEBUGCANVASPOS.x + "px", this._debugCanvasContext = this._debugCanvas.getContext("2d"), document.body.appendChild(this._debugCanvas), this._registerFunc = function () { e.drawDebugCanvas() }, this._scene.registerBeforeRender(this._registerFunc)), this._registerFunc && this._debugCanvasContext)) { var t = this.getByteFrequencyData(); this._debugCanvasContext.fillStyle = "rgb(0, 0, 0)", this._debugCanvasContext.fillRect(0, 0, this.DEBUGCANVASSIZE.width, this.DEBUGCANVASSIZE.height); for (var i = 0; i < this.getFrequencyBinCount(); i++) { var r = t[i] / this.BARGRAPHAMPLITUDE, n = this.DEBUGCANVASSIZE.height * r, o = this.DEBUGCANVASSIZE.height - n - 1, s = this.DEBUGCANVASSIZE.width / this.getFrequencyBinCount(), a = i / this.getFrequencyBinCount() * 360; this._debugCanvasContext.fillStyle = "hsl(" + a + ", 100%, 50%)", this._debugCanvasContext.fillRect(i * s, o, s, n) } } }, e.prototype.stopDebugCanvas = function () { this._debugCanvas && (this._registerFunc && (this._scene.unregisterBeforeRender(this._registerFunc), this._registerFunc = null), document.body.removeChild(this._debugCanvas), this._debugCanvas = null, this._debugCanvasContext = null) }, e.prototype.connectAudioNodes = function (e, t) { this._audioEngine.canUseWebAudio && (e.connect(this._webAudioAnalyser), this._webAudioAnalyser.connect(t)) }, e.prototype.dispose = function () { this._audioEngine.canUseWebAudio && this._webAudioAnalyser.disconnect() }, e }(), xi.Analyser = Pi, Ai = $a || ($a = {}), Si = function () { function e(e, t, i) { var r = this; if (this.loop = !1, this._coneInnerAngle = 360, this._coneOuterAngle = 360, this._volume = 1, this.isPlaying = !1, this.isPaused = !1, this._sounds = [], this._weights = [], t.length !== i.length) throw new Error("Sounds length does not equal weights length"); this.loop = e; for (var n = 0, o = 0, s = this._weights = i; o < s.length; o++)n += s[o]; for (var a = 0 < n ? 1 / n : 0, l = 0; l < this._weights.length; l++)this._weights[l] *= a; this._sounds = t; for (var c = 0, h = this._sounds; c < h.length; c++)h[c].onEndedObservable.add(function () { r._onended() }) } return Object.defineProperty(e.prototype, "directionalConeInnerAngle", { get: function () { return this._coneInnerAngle }, set: function (e) { if (e !== this._coneInnerAngle) { if (this._coneOuterAngle < e) return void Ai.Tools.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle."); this._coneInnerAngle = e; for (var t = 0, i = this._sounds; t < i.length; t++)i[t].directionalConeInnerAngle = e } }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "directionalConeOuterAngle", { get: function () { return this._coneOuterAngle }, set: function (e) { if (e !== this._coneOuterAngle) { if (e < this._coneInnerAngle) return void Ai.Tools.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle."); this._coneOuterAngle = e; for (var t = 0, i = this._sounds; t < i.length; t++)i[t].directionalConeOuterAngle = e } }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "volume", { get: function () { return this._volume }, set: function (e) { if (e !== this._volume) for (var t = 0, i = this._sounds; t < i.length; t++)i[t].setVolume(e) }, enumerable: !0, configurable: !0 }), e.prototype._onended = function () { void 0 !== this._currentIndex && (this._sounds[this._currentIndex].autoplay = !1), this.loop && this.isPlaying ? this.play() : this.isPlaying = !1 }, e.prototype.pause = function () { this.isPaused = !0, void 0 !== this._currentIndex && this._sounds[this._currentIndex].pause() }, e.prototype.stop = function () { this.isPlaying = !1, void 0 !== this._currentIndex && this._sounds[this._currentIndex].stop() }, e.prototype.play = function (e) { if (!this.isPaused) { this.stop(); for (var t = Math.random(), i = 0, r = 0; r < this._weights.length; r++)if (t <= (i += this._weights[r])) { this._currentIndex = r; break } } var n = this._sounds[this._currentIndex]; n.isReady() ? n.play(0, this.isPaused ? void 0 : e) : n.autoplay = !0, this.isPlaying = !0, this.isPaused = !1 }, e }(), Ai.WeightedSound = Si, function (e) { e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_AUDIO, function (t, i, r, n) { var o, s = []; if (r.sounds = r.sounds || [], void 0 !== t.sounds && null !== t.sounds) for (var a = 0, l = t.sounds.length; a < l; a++) { var c = t.sounds[a]; e.Engine.audioEngine.canUseWebAudio ? (c.url || (c.url = c.name), s[c.url] ? r.sounds.push(e.Sound.Parse(c, i, n, s[c.url])) : (o = e.Sound.Parse(c, i, n), s[c.url] = o, r.sounds.push(o))) : r.sounds.push(new e.Sound(c.name, null, i)) } s = [] }), Object.defineProperty(e.Scene.prototype, "mainSoundTrack", { get: function () { var i = this._getComponent(e.SceneComponentConstants.NAME_AUDIO); return i || (i = new t(this), this._addComponent(i)), this._mainSoundTrack || (this._mainSoundTrack = new e.SoundTrack(this, { mainTrack: !0 })), this._mainSoundTrack }, enumerable: !0, configurable: !0 }), e.Scene.prototype.getSoundByName = function (e) { var t; for (t = 0; t < this.mainSoundTrack.soundCollection.length; t++)if (this.mainSoundTrack.soundCollection[t].name === e) return this.mainSoundTrack.soundCollection[t]; if (this.soundTracks) for (var i = 0; i < this.soundTracks.length; i++)for (t = 0; t < this.soundTracks[i].soundCollection.length; t++)if (this.soundTracks[i].soundCollection[t].name === e) return this.soundTracks[i].soundCollection[t]; return null }, Object.defineProperty(e.Scene.prototype, "audioEnabled", { get: function () { var i = this._getComponent(e.SceneComponentConstants.NAME_AUDIO); return i || (i = new t(this), this._addComponent(i)), i.audioEnabled }, set: function (i) { var r = this._getComponent(e.SceneComponentConstants.NAME_AUDIO); r || (r = new t(this), this._addComponent(r)), i ? r.enableAudio() : r.disableAudio() }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.Scene.prototype, "headphone", { get: function () { var i = this._getComponent(e.SceneComponentConstants.NAME_AUDIO); return i || (i = new t(this), this._addComponent(i)), i.headphone }, set: function (i) { var r = this._getComponent(e.SceneComponentConstants.NAME_AUDIO); r || (r = new t(this), this._addComponent(r)), i ? r.switchAudioModeForHeadphones() : r.switchAudioModeForNormalSpeakers() }, enumerable: !0, configurable: !0 }); var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_AUDIO, this._audioEnabled = !0, this._headphone = !1, (this.scene = t).soundTracks = new Array, t.sounds = new Array } return Object.defineProperty(t.prototype, "audioEnabled", { get: function () { return this._audioEnabled }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "headphone", { get: function () { return this._headphone }, enumerable: !0, configurable: !0 }), t.prototype.register = function () { this.scene._afterRenderStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDER_AUDIO, this, this._afterRender) }, t.prototype.rebuild = function () { }, t.prototype.serialize = function (e) { if (e.sounds = [], this.scene.soundTracks) for (var t = 0; t < this.scene.soundTracks.length; t++)for (var i = this.scene.soundTracks[t], r = 0; r < i.soundCollection.length; r++)e.sounds.push(i.soundCollection[r].serialize()) }, t.prototype.addFromContainer = function (e) { var t = this; e.sounds && e.sounds.forEach(function (e) { e.play(), e.autoplay = !0, t.scene.mainSoundTrack.AddSound(e) }) }, t.prototype.removeFromContainer = function (e) { var t = this; e.sounds && e.sounds.forEach(function (e) { e.stop(), e.autoplay = !1, t.scene.mainSoundTrack.RemoveSound(e) }) }, t.prototype.dispose = function () { var e = this.scene; if (e._mainSoundTrack && e.mainSoundTrack.dispose(), e.soundTracks) for (var t = 0; t < e.soundTracks.length; t++)e.soundTracks[t].dispose() }, t.prototype.disableAudio = function () { var e, t = this.scene; for (this._audioEnabled = !1, e = 0; e < t.mainSoundTrack.soundCollection.length; e++)t.mainSoundTrack.soundCollection[e].pause(); if (t.soundTracks) for (e = 0; e < t.soundTracks.length; e++)for (var i = 0; i < t.soundTracks[e].soundCollection.length; i++)t.soundTracks[e].soundCollection[i].pause() }, t.prototype.enableAudio = function () { var e, t = this.scene; for (this._audioEnabled = !0, e = 0; e < t.mainSoundTrack.soundCollection.length; e++)t.mainSoundTrack.soundCollection[e].isPaused && t.mainSoundTrack.soundCollection[e].play(); if (t.soundTracks) for (e = 0; e < t.soundTracks.length; e++)for (var i = 0; i < t.soundTracks[e].soundCollection.length; i++)t.soundTracks[e].soundCollection[i].isPaused && t.soundTracks[e].soundCollection[i].play() }, t.prototype.switchAudioModeForHeadphones = function () { var e = this.scene; if (this._headphone = !0, e.mainSoundTrack.switchPanningModelToHRTF(), e.soundTracks) for (var t = 0; t < e.soundTracks.length; t++)e.soundTracks[t].switchPanningModelToHRTF() }, t.prototype.switchAudioModeForNormalSpeakers = function () { var e = this.scene; if (this._headphone = !1, e.mainSoundTrack.switchPanningModelToEqualPower(), e.soundTracks) for (var t = 0; t < e.soundTracks.length; t++)e.soundTracks[t].switchPanningModelToEqualPower() }, t.prototype._afterRender = function () { var t = this.scene; if (this._audioEnabled && t._mainSoundTrack && t.soundTracks && (0 !== t._mainSoundTrack.soundCollection.length || 1 !== t.soundTracks.length)) { var i, r = e.Engine.audioEngine; if ((i = 0 < t.activeCameras.length ? t.activeCameras[0] : t.activeCamera) && r.audioContext) { r.audioContext.listener.setPosition(i.position.x, i.position.y, i.position.z), i.rigCameras && 0 < i.rigCameras.length && (i = i.rigCameras[0]); var n, o = e.Matrix.Invert(i.getViewMatrix()), s = e.Vector3.TransformNormal(new e.Vector3(0, 0, -1), o); for (s.normalize(), isNaN(s.x) || isNaN(s.y) || isNaN(s.z) || r.audioContext.listener.setOrientation(s.x, s.y, s.z, 0, 1, 0), n = 0; n < t.mainSoundTrack.soundCollection.length; n++) { var a = t.mainSoundTrack.soundCollection[n]; a.useCustomAttenuation && a.updateDistanceFromListener() } if (t.soundTracks) for (n = 0; n < t.soundTracks.length; n++)for (var l = 0; l < t.soundTracks[n].soundCollection.length; l++)(a = t.soundTracks[n].soundCollection[l]).useCustomAttenuation && a.updateDistanceFromListener() } } }, t }(); e.AudioSceneComponent = t }($a || ($a = {})), function (e) { var t = function (e) { function t(t, i, r) { var n = e.call(this, t, r) || this; return n._sound = i, n } return T(t, e), t.prototype._prepare = function () { }, t.prototype.execute = function () { void 0 !== this._sound && this._sound.play() }, t.prototype.serialize = function (t) { return e.prototype._serialize.call(this, { name: "PlaySoundAction", properties: [{ name: "sound", value: this._sound.name }] }, t) }, t }(e.Action); e.PlaySoundAction = t; var i = function (e) { function t(t, i, r) { var n = e.call(this, t, r) || this; return n._sound = i, n } return T(t, e), t.prototype._prepare = function () { }, t.prototype.execute = function () { void 0 !== this._sound && this._sound.stop() }, t.prototype.serialize = function (t) { return e.prototype._serialize.call(this, { name: "StopSoundAction", properties: [{ name: "sound", value: this._sound.name }] }, t) }, t }(e.Action); e.StopSoundAction = i }($a || ($a = {})), Ri = function (e) { function t(t, i, r, n, o, s, a, l, c, h, u, d, f) { void 0 === r && (r = null), void 0 === n && (n = !1), void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === l && (l = Mi.Engine.TEXTUREFORMAT_RGBA), void 0 === c && (c = !1), void 0 === h && (h = null), void 0 === u && (u = !1), void 0 === d && (d = .8), void 0 === f && (f = 0); var p = e.call(this, i) || this; if (p.boundingBoxPosition = Mi.Vector3.Zero(), p._rotationY = 0, p._prefiltered = !1, p.name = t, p.url = t, p._noMipmap = n, p.hasAlpha = !1, p._format = l, p.isCube = !0, p._textureMatrix = Mi.Matrix.Identity(), p._createPolynomials = u, p.coordinatesMode = Mi.Texture.CUBIC_MODE, !t && !o) return p; var _ = t.lastIndexOf("."), m = h || (-1 < _ ? t.substring(_).toLowerCase() : ""), g = ".dds" === m, v = ".env" === m; if (v ? (p.gammaSpace = !1, p._prefiltered = !1) : (p._prefiltered = c) && (p.gammaSpace = !1), p._texture = p._getFromCache(t, n), !o && (v || g || r || (r = ["_px.jpg", "_py.jpg", "_pz.jpg", "_nx.jpg", "_ny.jpg", "_nz.jpg"]), o = [], r)) for (var y = 0; y < r.length; y++)o.push(t + r[y]); return p._files = o, p._texture ? s && (p._texture.isReady ? Mi.Tools.SetImmediate(function () { return s() }) : p._texture.onLoadedObservable.add(s)) : i.useDelayedTextureLoading ? p.delayLoadState = Mi.Engine.DELAYLOADSTATE_NOTLOADED : p._texture = c ? i.getEngine().createPrefilteredCubeTexture(t, i, d, f, s, a, l, h, p._createPolynomials) : i.getEngine().createCubeTexture(t, i, o, n, s, a, p._format, h, !1, d, f), p } return T(t, e), Object.defineProperty(t.prototype, "boundingBoxSize", { get: function () { return this._boundingBoxSize }, set: function (e) { if (!this._boundingBoxSize || !this._boundingBoxSize.equals(e)) { this._boundingBoxSize = e; var t = this.getScene(); t && t.markAllMaterialsAsDirty(Mi.Material.TextureDirtyFlag) } }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "rotationY", { get: function () { return this._rotationY }, set: function (e) { this._rotationY = e, this.setReflectionTextureMatrix(Mi.Matrix.RotationY(this._rotationY)) }, enumerable: !0, configurable: !0 }), t.CreateFromImages = function (e, i, r) { var n = ""; return e.forEach(function (e) { return n += e }), new t(n, i, null, r, e) }, t.CreateFromPrefilteredData = function (e, i, r, n) { return void 0 === r && (r = null), void 0 === n && (n = !0), new t(e, i, null, !1, null, null, null, void 0, !0, r, n) }, t.prototype.delayLoad = function () { if (this.delayLoadState === Mi.Engine.DELAYLOADSTATE_NOTLOADED) { var e = this.getScene(); e && (this.delayLoadState = Mi.Engine.DELAYLOADSTATE_LOADED, this._texture = this._getFromCache(this.url, this._noMipmap), this._texture || (this._prefiltered ? this._texture = e.getEngine().createPrefilteredCubeTexture(this.url, e, this.lodGenerationScale, this.lodGenerationOffset, void 0, void 0, this._format, void 0, this._createPolynomials) : this._texture = e.getEngine().createCubeTexture(this.url, e, this._files, this._noMipmap, void 0, void 0, this._format))) } }, t.prototype.getReflectionTextureMatrix = function () { return this._textureMatrix }, t.prototype.setReflectionTextureMatrix = function (e) { this._textureMatrix = e }, t.Parse = function (e, i, r) { var n = Mi.SerializationHelper.Parse(function () { var n = !1; return e.prefiltered && (n = e.prefiltered), new t(r + e.name, i, e.extensions, !1, null, null, null, void 0, n) }, e, i); if (e.boundingBoxPosition && (n.boundingBoxPosition = Mi.Vector3.FromArray(e.boundingBoxPosition)), e.boundingBoxSize && (n.boundingBoxSize = Mi.Vector3.FromArray(e.boundingBoxSize)), e.animations) for (var o = 0; o < e.animations.length; o++) { var s = e.animations[o]; n.animations.push(Mi.Animation.Parse(s)) } return n }, t.prototype.clone = function () { var e = this; return Mi.SerializationHelper.Clone(function () { var i = e.getScene(); return i ? new t(e.url, i, e._extensions, e._noMipmap, e._files) : e }, this) }, b([Mi.serialize("rotationY")], t.prototype, "rotationY", null), t }((Mi = $a || ($a = {})).BaseTexture), Mi.CubeTexture = Ri, Oi = function (e) { function t(t, i, r, n, o, s, a, l, c) { void 0 === n && (n = Ci.Engine.TEXTUREFORMAT_RGBA), void 0 === o && (o = Ci.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === s && (s = !1), void 0 === a && (a = !1), void 0 === l && (l = Ci.Texture.TRILINEAR_SAMPLINGMODE), void 0 === c && (c = null); var h = e.call(this, "", t) || this; return h._texture = t.getEngine().createRawCubeTexture(i, r, n, o, s, a, l, c), h } return T(t, e), t.prototype.update = function (e, t, i, r, n, o) { void 0 === n && (n = null), void 0 === o && (o = 0), this._texture.getEngine().updateRawCubeTexture(this._texture, e, t, i, r, n) }, t.prototype.updateRGBDAsync = function (e, i, r, n) { return void 0 === i && (i = null), void 0 === r && (r = .8), void 0 === n && (n = 0), t._UpdateRGBDAsync(this._texture, e, i, r, n) }, t.prototype.clone = function () { var e = this; return Ci.SerializationHelper.Clone(function () { var i = e.getScene(), r = e._texture, n = new t(i, r._bufferViewArray, r.width, r.format, r.type, r.generateMipMaps, r.invertY, r.samplingMode, r._compression); return r.dataSource === Ci.InternalTexture.DATASOURCE_CUBERAW_RGBD && n.updateRGBDAsync(r._bufferViewArrayArray, r._sphericalPolynomial, r._lodGenerationScale, r._lodGenerationOffset), n }, this) }, t._UpdateRGBDAsync = function (e, t, i, r, n) { return e._dataSource = Ci.InternalTexture.DATASOURCE_CUBERAW_RGBD, e._bufferViewArrayArray = t, e._lodGenerationScale = r, e._lodGenerationOffset = n, e._sphericalPolynomial = i, Ci.EnvironmentTextureTools.UploadLevelsAsync(e, t).then(function () { e.isReady = !0 }) }, t }((Ci = $a || ($a = {})).CubeTexture), Ci.RawCubeTexture = Oi, Ii = function (e) { function t(t, i, r, n, o, s, a, l, c, h, u, d) { void 0 === o && (o = !0), void 0 === s && (s = Di.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === a && (a = !1), void 0 === l && (l = Di.Texture.TRILINEAR_SAMPLINGMODE), void 0 === c && (c = !0), void 0 === h && (h = !1), void 0 === u && (u = !1), void 0 === d && (d = Di.Engine.TEXTUREFORMAT_RGBA); var f = e.call(this, null, r, !n) || this; return f.isCube = a, f.renderParticles = !0, f.renderSprites = !1, f.coordinatesMode = Di.Texture.PROJECTION_MODE, f.ignoreCameraViewport = !1, f.onBeforeBindObservable = new Di.Observable, f.onAfterUnbindObservable = new Di.Observable, f.onBeforeRenderObservable = new Di.Observable, f.onAfterRenderObservable = new Di.Observable, f.onClearObservable = new Di.Observable, f._currentRefreshId = -1, f._refreshRate = 1, f._samples = 1, f.boundingBoxPosition = Di.Vector3.Zero(), (r = f.getScene()) ? (f.renderList = new Array, f._engine = r.getEngine(), f.name = t, f.isRenderTarget = !0, f._initialSizeParameter = i, f._processSizeParameter(i), f._resizeObserver = f.getScene().getEngine().onResizeObservable.add(function () { }), f._generateMipMaps = !!n, f._doNotChangeAspectRatio = o, f._renderingManager = new Di.RenderingManager(r), f._renderingManager._useSceneAutoClearSetup = !0, u || (f._renderTargetOptions = { generateMipMaps: n, type: s, format: d, samplingMode: l, generateDepthBuffer: c, generateStencilBuffer: h }, l === Di.Texture.NEAREST_SAMPLINGMODE && (f.wrapU = Di.Texture.CLAMP_ADDRESSMODE, f.wrapV = Di.Texture.CLAMP_ADDRESSMODE), a ? (f._texture = r.getEngine().createRenderTargetCubeTexture(f.getRenderSize(), f._renderTargetOptions), f.coordinatesMode = Di.Texture.INVCUBIC_MODE, f._textureMatrix = Di.Matrix.Identity()) : f._texture = r.getEngine().createRenderTargetTexture(f._size, f._renderTargetOptions)), f) : f } return T(t, e), Object.defineProperty(t.prototype, "renderList", { get: function () { return this._renderList }, set: function (e) { this._renderList = e, this._renderList && this._hookArray(this._renderList) }, enumerable: !0, configurable: !0 }), t.prototype._hookArray = function (e) { var t = this, i = e.push; e.push = function () { for (var r = [], n = 0; n < arguments.length; n++)r[n] = arguments[n]; var o = 0 === e.length, s = i.apply(e, r); return o && t.getScene().meshes.forEach(function (e) { e._markSubMeshesAsLightDirty() }), s }; var r = e.splice; e.splice = function (i, n) { var o = r.apply(e, [i, n]); return 0 === e.length && t.getScene().meshes.forEach(function (e) { e._markSubMeshesAsLightDirty() }), o } }, Object.defineProperty(t.prototype, "onAfterUnbind", { set: function (e) { this._onAfterUnbindObserver && this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver), this._onAfterUnbindObserver = this.onAfterUnbindObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onBeforeRender", { set: function (e) { this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver), this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onAfterRender", { set: function (e) { this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver), this._onAfterRenderObserver = this.onAfterRenderObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onClear", { set: function (e) { this._onClearObserver && this.onClearObservable.remove(this._onClearObserver), this._onClearObserver = this.onClearObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "renderTargetOptions", { get: function () { return this._renderTargetOptions }, enumerable: !0, configurable: !0 }), t.prototype._onRatioRescale = function () { this._sizeRatio && this.resize(this._initialSizeParameter) }, Object.defineProperty(t.prototype, "boundingBoxSize", { get: function () { return this._boundingBoxSize }, set: function (e) { if (!this._boundingBoxSize || !this._boundingBoxSize.equals(e)) { this._boundingBoxSize = e; var t = this.getScene(); t && t.markAllMaterialsAsDirty(Di.Material.TextureDirtyFlag) } }, enumerable: !0, configurable: !0 }), t.prototype.createDepthStencilTexture = function (e, t, i) { if (void 0 === e && (e = 0), void 0 === t && (t = !0), void 0 === i && (i = !1), this.getScene()) { var r = this.getScene().getEngine(); this.depthStencilTexture = r.createDepthStencilTexture(this._size, { bilinearFiltering: t, comparisonFunction: e, generateStencil: i, isCube: this.isCube }), r.setFrameBufferDepthStencilTexture(this) } }, t.prototype._processSizeParameter = function (e) { e.ratio ? (this._sizeRatio = e.ratio, this._size = { width: this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(), this._sizeRatio), height: this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(), this._sizeRatio) }) : this._size = e }, Object.defineProperty(t.prototype, "samples", { get: function () { return this._samples }, set: function (e) { if (this._samples !== e) { var t = this.getScene(); t && (this._samples = t.getEngine().updateRenderTargetTextureSampleCount(this._texture, e)) } }, enumerable: !0, configurable: !0 }), t.prototype.resetRefreshCounter = function () { this._currentRefreshId = -1 }, Object.defineProperty(t.prototype, "refreshRate", { get: function () { return this._refreshRate }, set: function (e) { this._refreshRate = e, this.resetRefreshCounter() }, enumerable: !0, configurable: !0 }), t.prototype.addPostProcess = function (e) { if (!this._postProcessManager) { var t = this.getScene(); if (!t) return; this._postProcessManager = new Di.PostProcessManager(t), this._postProcesses = new Array } this._postProcesses.push(e), this._postProcesses[0].autoClear = !1 }, t.prototype.clearPostProcesses = function (e) { if (void 0 === e && (e = !1), this._postProcesses) { if (e) for (var t = 0, i = this._postProcesses; t < i.length; t++)i[t].dispose(); this._postProcesses = [] } }, t.prototype.removePostProcess = function (e) { if (this._postProcesses) { var t = this._postProcesses.indexOf(e); -1 !== t && (this._postProcesses.splice(t, 1), 0 < this._postProcesses.length && (this._postProcesses[0].autoClear = !1)) } }, t.prototype._shouldRender = function () { return -1 === this._currentRefreshId ? (this._currentRefreshId = 1, !0) : this.refreshRate === this._currentRefreshId ? (this._currentRefreshId = 1, !0) : (this._currentRefreshId++ , !1) }, t.prototype.getRenderSize = function () { return this.getRenderWidth() }, t.prototype.getRenderWidth = function () { return this._size.width ? this._size.width : this._size }, t.prototype.getRenderHeight = function () { return this._size.width ? this._size.height : this._size }, Object.defineProperty(t.prototype, "canRescale", { get: function () { return !0 }, enumerable: !0, configurable: !0 }), t.prototype.scale = function (e) { var t = this.getRenderSize() * e; this.resize(t) }, t.prototype.getReflectionTextureMatrix = function () { return this.isCube ? this._textureMatrix : e.prototype.getReflectionTextureMatrix.call(this) }, t.prototype.resize = function (e) { this.releaseInternalTexture(); var t = this.getScene(); t && (this._processSizeParameter(e), this.isCube ? this._texture = t.getEngine().createRenderTargetCubeTexture(this.getRenderSize(), this._renderTargetOptions) : this._texture = t.getEngine().createRenderTargetTexture(this._size, this._renderTargetOptions)) }, t.prototype.render = function (e, t) { if (void 0 === e && (e = !1), void 0 === t && (t = !1), a = this.getScene()) { var i, r = a.getEngine(); if (void 0 !== this.useCameraPostProcesses && (e = this.useCameraPostProcesses), this._waitingRenderList) { this.renderList = []; for (var n = 0; n < this._waitingRenderList.length; n++) { var o = this._waitingRenderList[n], s = a.getMeshByID(o); s && this.renderList.push(s) } delete this._waitingRenderList } if (this.renderListPredicate) { var a; if (this.renderList ? this.renderList.splice(0) : this.renderList = [], !(a = this.getScene())) return; var l = a.meshes; for (n = 0; n < l.length; n++) { var c = l[n]; this.renderListPredicate(c) && this.renderList.push(c) } } this.onBeforeBindObservable.notifyObservers(this), this.activeCamera ? (i = this.activeCamera, r.setViewport(this.activeCamera.viewport, this.getRenderWidth(), this.getRenderHeight()), this.activeCamera !== a.activeCamera && a.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix(!0))) : (i = a.activeCamera) && r.setViewport(i.viewport, this.getRenderWidth(), this.getRenderHeight()), this._renderingManager.reset(); for (var h = this.renderList ? this.renderList : a.getActiveMeshes().data, u = this.renderList ? this.renderList.length : a.getActiveMeshes().length, d = a.getRenderId(), f = 0; f < u; f++)if (c = h[f]) { if (!c.isReady(0 === this.refreshRate)) { this.resetRefreshCounter(); continue } c._preActivateForIntermediateRendering(d); var p; if (p = !(this.renderList || !i) && 0 == (c.layerMask & i.layerMask), c.isEnabled() && c.isVisible && c.subMeshes && !p) { c._activate(d); for (var _ = 0; _ < c.subMeshes.length; _++) { var m = c.subMeshes[_]; a._activeIndices.addCount(m.indexCount, !1), this._renderingManager.dispatch(m, c) } } } for (var g = 0; g < a.particleSystems.length; g++) { var v = a.particleSystems[g], y = v.emitter; v.isStarted() && y && y.position && y.isEnabled() && 0 <= h.indexOf(y) && this._renderingManager.dispatchParticles(v) } if (this.isCube) for (var b = 0; b < 6; b++)this.renderToTarget(b, h, u, e, t), a.incrementRenderId(), a.resetCachedMaterial(); else this.renderToTarget(0, h, u, e, t); this.onAfterUnbindObservable.notifyObservers(this), a.activeCamera && (this.activeCamera && this.activeCamera !== a.activeCamera && a.setTransformMatrix(a.activeCamera.getViewMatrix(), a.activeCamera.getProjectionMatrix(!0)), r.setViewport(a.activeCamera.viewport)), a.resetCachedMaterial() } }, t.prototype._bestReflectionRenderTargetDimension = function (e, t) { var i = e * t, r = Di.Tools.NearestPOT(i + 16384 / (128 + i)); return Math.min(Di.Tools.FloorPOT(e), r) }, t.prototype.unbindFrameBuffer = function (e, t) { var i = this; this._texture && e.unBindFramebuffer(this._texture, this.isCube, function () { i.onAfterRenderObservable.notifyObservers(t) }) }, t.prototype.renderToTarget = function (e, t, i, r, n) { var o = this.getScene(); if (o) { var s = o.getEngine(); this._texture && (this._postProcessManager ? this._postProcessManager._prepareFrame(this._texture, this._postProcesses) : r && o.postProcessManager._prepareFrame(this._texture) || this._texture && s.bindFramebuffer(this._texture, this.isCube ? e : void 0, void 0, void 0, this.ignoreCameraViewport, this.depthStencilTexture ? this.depthStencilTexture : void 0), this.onBeforeRenderObservable.notifyObservers(e), this.onClearObservable.hasObservers() ? this.onClearObservable.notifyObservers(s) : s.clear(this.clearColor || o.clearColor, !0, !0, !0), this._doNotChangeAspectRatio || o.updateTransformMatrix(!0), this._renderingManager.render(this.customRenderFunction, t, this.renderParticles, this.renderSprites), this._postProcessManager ? this._postProcessManager._finalizeFrame(!1, this._texture, e, this._postProcesses, this.ignoreCameraViewport) : r && o.postProcessManager._finalizeFrame(!1, this._texture, e), this._doNotChangeAspectRatio || o.updateTransformMatrix(!0), n && Di.Tools.DumpFramebuffer(this.getRenderWidth(), this.getRenderHeight(), s), this.isCube && 5 !== e ? this.onAfterRenderObservable.notifyObservers(e) : (this.isCube && 5 === e && s.generateMipMapsForCubemap(this._texture), this.unbindFrameBuffer(s, e))) } }, t.prototype.setRenderingOrder = function (e, t, i, r) { void 0 === t && (t = null), void 0 === i && (i = null), void 0 === r && (r = null), this._renderingManager.setRenderingOrder(e, t, i, r) }, t.prototype.setRenderingAutoClearDepthStencil = function (e, t) { this._renderingManager.setRenderingAutoClearDepthStencil(e, t), this._renderingManager._useSceneAutoClearSetup = !1 }, t.prototype.clone = function () { var e = this.getSize(), i = new t(this.name, e, this.getScene(), this._renderTargetOptions.generateMipMaps, this._doNotChangeAspectRatio, this._renderTargetOptions.type, this.isCube, this._renderTargetOptions.samplingMode, this._renderTargetOptions.generateDepthBuffer, this._renderTargetOptions.generateStencilBuffer); return i.hasAlpha = this.hasAlpha, i.level = this.level, i.coordinatesMode = this.coordinatesMode, this.renderList && (i.renderList = this.renderList.slice(0)), i }, t.prototype.serialize = function () { if (!this.name) return null; var t = e.prototype.serialize.call(this); if (t.renderTargetSize = this.getRenderSize(), t.renderList = [], this.renderList) for (var i = 0; i < this.renderList.length; i++)t.renderList.push(this.renderList[i].id); return t }, t.prototype.disposeFramebufferObjects = function () { var e = this.getInternalTexture(), t = this.getScene(); e && t && t.getEngine()._releaseFramebufferObjects(e) }, t.prototype.dispose = function () { this._postProcessManager && (this._postProcessManager.dispose(), this._postProcessManager = null), this.clearPostProcesses(!0), this._resizeObserver && (this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver), this._resizeObserver = null), this.renderList = null; var t = this.getScene(); if (t) { var i = t.customRenderTargets.indexOf(this); 0 <= i && t.customRenderTargets.splice(i, 1); for (var r = 0, n = t.cameras; r < n.length; r++) { var o = n[r]; 0 <= (i = o.customRenderTargets.indexOf(this)) && o.customRenderTargets.splice(i, 1) } e.prototype.dispose.call(this) } }, t.prototype._rebuild = function () { this.refreshRate === t.REFRESHRATE_RENDER_ONCE && (this.refreshRate = t.REFRESHRATE_RENDER_ONCE), this._postProcessManager && this._postProcessManager._rebuild() }, t.prototype.freeRenderingGroups = function () { this._renderingManager && this._renderingManager.freeRenderingGroups() }, t.REFRESHRATE_RENDER_ONCE = 0, t.REFRESHRATE_RENDER_ONEVERYFRAME = 1, t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES = 2, t }((Di = $a || ($a = {})).Texture), Di.RenderTargetTexture = Ii, Li = function (e) { function t(t, i, r, n, o) { var s = this, a = !(!o || !o.generateMipMaps) && o.generateMipMaps, l = !(!o || !o.generateDepthTexture) && o.generateDepthTexture, c = !o || void 0 === o.doNotChangeAspectRatio || o.doNotChangeAspectRatio; if ((s = e.call(this, t, i, n, a, c) || this)._engine = n.getEngine(), s.isSupported) { for (var h = [], u = [], d = 0; d < r; d++)o && o.types && void 0 !== o.types[d] ? h.push(o.types[d]) : h.push(o && o.defaultType ? o.defaultType : wi.Engine.TEXTURETYPE_UNSIGNED_INT), o && o.samplingModes && void 0 !== o.samplingModes[d] ? u.push(o.samplingModes[d]) : u.push(wi.Texture.BILINEAR_SAMPLINGMODE); var f = !o || void 0 === o.generateDepthBuffer || o.generateDepthBuffer, p = !(!o || void 0 === o.generateStencilBuffer) && o.generateStencilBuffer; return s._size = i, s._multiRenderTargetOptions = { samplingModes: u, generateMipMaps: a, generateDepthBuffer: f, generateStencilBuffer: p, generateDepthTexture: l, types: h, textureCount: r }, s._createInternalTextures(), s._createTextures(), s } s.dispose() } return T(t, e), Object.defineProperty(t.prototype, "isSupported", { get: function () { return 1 < this._engine.webGLVersion || this._engine.getCaps().drawBuffersExtension }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "textures", { get: function () { return this._textures }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "depthTexture", { get: function () { return this._textures[this._textures.length - 1] }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "wrapU", { set: function (e) { if (this._textures) for (var t = 0; t < this._textures.length; t++)this._textures[t].wrapU = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "wrapV", { set: function (e) { if (this._textures) for (var t = 0; t < this._textures.length; t++)this._textures[t].wrapV = e }, enumerable: !0, configurable: !0 }), t.prototype._rebuild = function () { this.releaseInternalTextures(), this._createInternalTextures(); for (var e = 0; e < this._internalTextures.length; e++)this._textures[e]._texture = this._internalTextures[e]; this._texture = this._internalTextures[0] }, t.prototype._createInternalTextures = function () { this._internalTextures = this._engine.createMultipleRenderTarget(this._size, this._multiRenderTargetOptions) }, t.prototype._createTextures = function () { this._textures = []; for (var e = 0; e < this._internalTextures.length; e++) { var t = new wi.Texture(null, this.getScene()); t._texture = this._internalTextures[e], this._textures.push(t) } this._texture = this._internalTextures[0] }, Object.defineProperty(t.prototype, "samples", { get: function () { return this._samples }, set: function (e) { this._samples !== e && (this._samples = this._engine.updateMultipleRenderTargetTextureSampleCount(this._internalTextures, e)) }, enumerable: !0, configurable: !0 }), t.prototype.resize = function (e) { this.releaseInternalTextures(), this._internalTextures = this._engine.createMultipleRenderTarget(e, this._multiRenderTargetOptions), this._createInternalTextures() }, t.prototype.unbindFrameBuffer = function (e, t) { var i = this; e.unBindMultiColorAttachmentFramebuffer(this._internalTextures, this.isCube, function () { i.onAfterRenderObservable.notifyObservers(t) }) }, t.prototype.dispose = function () { this.releaseInternalTextures(), e.prototype.dispose.call(this) }, t.prototype.releaseInternalTextures = function () { if (this._internalTextures) for (var e = this._internalTextures.length - 1; 0 <= e; e--)void 0 !== this._internalTextures[e] && (this._internalTextures[e].dispose(), this._internalTextures.splice(e, 1)) }, t }((wi = $a || ($a = {})).RenderTargetTexture), wi.MultiRenderTarget = Li, Bi = function (e) { function t(t, i, r, n, o, s, a) { void 0 === o && (o = Fi.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === s && (s = Fi.Texture.BILINEAR_SAMPLINGMODE), void 0 === a && (a = !0); var l = e.call(this, t, i, r, n, !0, o, !1, s, a) || this; return l.scene = r, l.mirrorPlane = new Fi.Plane(0, 1, 0, 1), l._transformMatrix = Fi.Matrix.Zero(), l._mirrorMatrix = Fi.Matrix.Zero(), l._adaptiveBlurKernel = 0, l._blurKernelX = 0, l._blurKernelY = 0, l._blurRatio = 1, l.ignoreCameraViewport = !0, l._updateGammaSpace(), l._imageProcessingConfigChangeObserver = r.imageProcessingConfiguration.onUpdateParameters.add(function () { l._updateGammaSpace }), l.onBeforeRenderObservable.add(function () { Fi.Matrix.ReflectionToRef(l.mirrorPlane, l._mirrorMatrix), l._savedViewMatrix = r.getViewMatrix(), l._mirrorMatrix.multiplyToRef(l._savedViewMatrix, l._transformMatrix), r.setTransformMatrix(l._transformMatrix, r.getProjectionMatrix()), r.clipPlane = l.mirrorPlane, r.getEngine().cullBackFaces = !1, r._mirroredCameraPosition = Fi.Vector3.TransformCoordinates(r.activeCamera.globalPosition, l._mirrorMatrix) }), l.onAfterRenderObservable.add(function () { r.setTransformMatrix(l._savedViewMatrix, r.getProjectionMatrix()), r.getEngine().cullBackFaces = !0, r._mirroredCameraPosition = null, delete r.clipPlane }), l } return T(t, e), Object.defineProperty(t.prototype, "blurRatio", { get: function () { return this._blurRatio }, set: function (e) { this._blurRatio !== e && (this._blurRatio = e, this._preparePostProcesses()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "adaptiveBlurKernel", { set: function (e) { this._adaptiveBlurKernel = e, this._autoComputeBlurKernel() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "blurKernel", { set: function (e) { this.blurKernelX = e, this.blurKernelY = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "blurKernelX", { get: function () { return this._blurKernelX }, set: function (e) { this._blurKernelX !== e && (this._blurKernelX = e, this._preparePostProcesses()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "blurKernelY", { get: function () { return this._blurKernelY }, set: function (e) { this._blurKernelY !== e && (this._blurKernelY = e, this._preparePostProcesses()) }, enumerable: !0, configurable: !0 }), t.prototype._autoComputeBlurKernel = function () { var e = this.getScene().getEngine(), t = this.getRenderWidth() / e.getRenderWidth(), i = this.getRenderHeight() / e.getRenderHeight(); this.blurKernelX = this._adaptiveBlurKernel * t, this.blurKernelY = this._adaptiveBlurKernel * i }, t.prototype._onRatioRescale = function () { this._sizeRatio && (this.resize(this._initialSizeParameter), this._adaptiveBlurKernel || this._preparePostProcesses()), this._adaptiveBlurKernel && this._autoComputeBlurKernel() }, t.prototype._updateGammaSpace = function () { this.gammaSpace = !this.scene.imageProcessingConfiguration.isEnabled || !this.scene.imageProcessingConfiguration.applyByPostProcess }, t.prototype._preparePostProcesses = function () { if (this.clearPostProcesses(!0), this._blurKernelX && this._blurKernelY) { var e = this.getScene().getEngine(), t = e.getCaps().textureFloatRender ? Fi.Engine.TEXTURETYPE_FLOAT : Fi.Engine.TEXTURETYPE_HALF_FLOAT; this._blurX = new Fi.BlurPostProcess("horizontal blur", new Fi.Vector2(1, 0), this._blurKernelX, this._blurRatio, null, Fi.Texture.BILINEAR_SAMPLINGMODE, e, !1, t), this._blurX.autoClear = !1, 1 === this._blurRatio && this.samples < 2 && this._texture ? this._blurX.inputTexture = this._texture : this._blurX.alwaysForcePOT = !0, this._blurY = new Fi.BlurPostProcess("vertical blur", new Fi.Vector2(0, 1), this._blurKernelY, this._blurRatio, null, Fi.Texture.BILINEAR_SAMPLINGMODE, e, !1, t), this._blurY.autoClear = !1, this._blurY.alwaysForcePOT = 1 !== this._blurRatio, this.addPostProcess(this._blurX), this.addPostProcess(this._blurY) } else this._blurY && (this.removePostProcess(this._blurY), this._blurY.dispose(), this._blurY = null), this._blurX && (this.removePostProcess(this._blurX), this._blurX.dispose(), this._blurX = null) }, t.prototype.clone = function () { var e = this.getScene(); if (!e) return this; var i = this.getSize(), r = new t(this.name, i.width, e, this._renderTargetOptions.generateMipMaps, this._renderTargetOptions.type, this._renderTargetOptions.samplingMode, this._renderTargetOptions.generateDepthBuffer); return r.hasAlpha = this.hasAlpha, r.level = this.level, r.mirrorPlane = this.mirrorPlane.clone(), this.renderList && (r.renderList = this.renderList.slice(0)), r }, t.prototype.serialize = function () { if (!this.name) return null; var t = e.prototype.serialize.call(this); return t.mirrorPlane = this.mirrorPlane.asArray(), t }, t.prototype.dispose = function () { e.prototype.dispose.call(this), this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver) }, t }((Fi = $a || ($a = {})).RenderTargetTexture), Fi.MirrorTexture = Bi, Vi = function (e) { function t(t, i, r, n) { var o = e.call(this, t, i, r, n, !0) || this; return o.refractionPlane = new Ni.Plane(0, 1, 0, 1), o.depth = 2, o.onBeforeRenderObservable.add(function () { r.clipPlane = o.refractionPlane }), o.onAfterRenderObservable.add(function () { delete r.clipPlane }), o } return T(t, e), t.prototype.clone = function () { var e = this.getScene(); if (!e) return this; var i = this.getSize(), r = new t(this.name, i.width, e, this._generateMipMaps); return r.hasAlpha = this.hasAlpha, r.level = this.level, r.refractionPlane = this.refractionPlane.clone(), this.renderList && (r.renderList = this.renderList.slice(0)), r.depth = this.depth, r }, t.prototype.serialize = function () { if (!this.name) return null; var t = e.prototype.serialize.call(this); return t.mirrorPlane = this.refractionPlane.asArray(), t.depth = this.depth, t }, t }((Ni = $a || ($a = {})).RenderTargetTexture), Ni.RefractionTexture = Vi, zi = function (e) { function t(t, i, r, n, o, s) { void 0 === r && (r = null), void 0 === o && (o = Ui.Texture.TRILINEAR_SAMPLINGMODE), void 0 === s && (s = Ui.Engine.TEXTUREFORMAT_RGBA); var a = e.call(this, null, r, !n, void 0, o, void 0, void 0, void 0, void 0, s) || this; a.name = t, a._engine = a.getScene().getEngine(), a.wrapU = Ui.Texture.CLAMP_ADDRESSMODE, a.wrapV = Ui.Texture.CLAMP_ADDRESSMODE, a._generateMipMaps = n, i.getContext ? (a._canvas = i, a._texture = a._engine.createDynamicTexture(i.width, i.height, n, o)) : (a._canvas = document.createElement("canvas"), i.width || 0 === i.width ? a._texture = a._engine.createDynamicTexture(i.width, i.height, n, o) : a._texture = a._engine.createDynamicTexture(i, i, n, o)); var l = a.getSize(); return a._canvas.width = l.width, a._canvas.height = l.height, a._context = a._canvas.getContext("2d"), a } return T(t, e), Object.defineProperty(t.prototype, "canRescale", { get: function () { return !0 }, enumerable: !0, configurable: !0 }), t.prototype._recreate = function (e) { this._canvas.width = e.width, this._canvas.height = e.height, this.releaseInternalTexture(), this._texture = this._engine.createDynamicTexture(e.width, e.height, this._generateMipMaps, this._samplingMode) }, t.prototype.scale = function (e) { var t = this.getSize(); t.width *= e, t.height *= e, this._recreate(t) }, t.prototype.scaleTo = function (e, t) { var i = this.getSize(); i.width = e, i.height = t, this._recreate(i) }, t.prototype.getContext = function () { return this._context }, t.prototype.clear = function () { var e = this.getSize(); this._context.fillRect(0, 0, e.width, e.height) }, t.prototype.update = function (e, t) { void 0 === t && (t = !1), this._engine.updateDynamicTexture(this._texture, this._canvas, void 0 === e || e, t, this._format || void 0) }, t.prototype.drawText = function (e, t, i, r, n, o, s, a) { void 0 === a && (a = !0); var l = this.getSize(); if (o && (this._context.fillStyle = o, this._context.fillRect(0, 0, l.width, l.height)), this._context.font = r, null == t) { var c = this._context.measureText(e); t = (l.width - c.width) / 2 } if (null == i) { var h = parseInt(r.replace(/\D/g, "")); i = l.height / 2 + h / 3.65 } this._context.fillStyle = n, this._context.fillText(e, t, i), a && this.update(s) }, t.prototype.clone = function () { var e = this.getScene(); if (!e) return this; var i = this.getSize(), r = new t(this.name, i, e, this._generateMipMaps); return r.hasAlpha = this.hasAlpha, r.level = this.level, r.wrapU = this.wrapU, r.wrapV = this.wrapV, r }, t.prototype.serialize = function () { var t = this.getScene(); t && !t.isReady() && Ui.Tools.Warn("The scene must be ready before serializing the dynamic texture"); var i = e.prototype.serialize.call(this); return i.base64String = this._canvas.toDataURL(), i.invertY = this._invertY, i.samplingMode = this.samplingMode, i }, t.prototype._rebuild = function () { this.update() }, t }((Ui = $a || ($a = {})).Texture), Ui.DynamicTexture = zi, ki = function (e) { function t(t, i, r, n, o, s, a) { void 0 === n && (n = !1), void 0 === o && (o = !1), void 0 === s && (s = Gi.Texture.TRILINEAR_SAMPLINGMODE), void 0 === a && (a = { autoPlay: !0, loop: !0, autoUpdateTexture: !0 }); var l = e.call(this, null, r, !n, o) || this; return l._onUserActionRequestedObservable = null, l._stillImageCaptured = !1, l._poster = !1, l._createInternalTexture = function () { if (null != l._texture) { if (!l._poster) return; l._texture.dispose(), l._poster = !1 } if (!l._engine.needPOTTextures || Gi.Tools.IsExponentOfTwo(l.video.videoWidth) && Gi.Tools.IsExponentOfTwo(l.video.videoHeight) ? (l.wrapU = Gi.Texture.WRAP_ADDRESSMODE, l.wrapV = Gi.Texture.WRAP_ADDRESSMODE) : (l.wrapU = Gi.Texture.CLAMP_ADDRESSMODE, l.wrapV = Gi.Texture.CLAMP_ADDRESSMODE, l._generateMipMaps = !1), l._texture = l._engine.createDynamicTexture(l.video.videoWidth, l.video.videoHeight, l._generateMipMaps, l._samplingMode), l.video.autoplay) l._texture.isReady = !0, l._updateInternalTexture(), l.onLoadObservable.hasObservers() && l.onLoadObservable.notifyObservers(l); else { var e = l.video.onplaying, t = !1; l.video.onplaying = function () { l.video.onplaying = e, l._texture.isReady = !0, l._updateInternalTexture(), t || l.video.pause(), l.onLoadObservable.hasObservers() && l.onLoadObservable.notifyObservers(l) }; var i = l.video.play(); i ? i.then(function () { }).catch(function () { t = !0, l._onUserActionRequestedObservable && l._onUserActionRequestedObservable.hasObservers() && l._onUserActionRequestedObservable.notifyObservers(l) }) : (l.video.onplaying = e, l._texture.isReady = !0, l._updateInternalTexture(), l.onLoadObservable.hasObservers() && l.onLoadObservable.notifyObservers(l)) } }, l.reset = function () { null != l._texture && (l._poster || (l._texture.dispose(), l._texture = null)) }, l._updateInternalTexture = function (e) { null != l._texture && l._texture.isReady && (l.video.readyState < l.video.HAVE_CURRENT_DATA || l._engine.updateVideoTexture(l._texture, l.video, l._invertY)) }, l._engine = l.getScene().getEngine(), l._generateMipMaps = n, l._samplingMode = s, l.autoUpdateTexture = a.autoUpdateTexture, l.name = t || l._getName(i), l.video = l._getVideo(i), a.poster && (l.video.poster = a.poster), void 0 !== a.autoPlay && (l.video.autoplay = a.autoPlay), void 0 !== a.loop && (l.video.loop = a.loop), l.video.setAttribute("playsinline", ""), l.video.addEventListener("canplay", l._createInternalTexture), l.video.addEventListener("paused", l._updateInternalTexture), l.video.addEventListener("seeked", l._updateInternalTexture), l.video.addEventListener("emptied", l.reset), l.video.readyState >= l.video.HAVE_CURRENT_DATA && l._createInternalTexture(), a.poster && (l._texture = l._engine.createTexture(a.poster, !1, !0, r), l._poster = !0), l } return T(t, e), Object.defineProperty(t.prototype, "onUserActionRequestedObservable", { get: function () { return this._onUserActionRequestedObservable || (this._onUserActionRequestedObservable = new Gi.Observable), this._onUserActionRequestedObservable }, enumerable: !0, configurable: !0 }), t.prototype._getName = function (e) { return e instanceof HTMLVideoElement ? e.currentSrc : "object" == typeof e ? e.toString() : e }, t.prototype._getVideo = function (e) { if (e instanceof HTMLVideoElement) return Gi.Tools.SetCorsBehavior(e.currentSrc, e), e; var t = document.createElement("video"); return "string" == typeof e ? (Gi.Tools.SetCorsBehavior(e, t), t.src = e) : (Gi.Tools.SetCorsBehavior(e[0], t), e.forEach(function (e) { var i = document.createElement("source"); i.src = e, t.appendChild(i) })), t }, t.prototype._rebuild = function () { this.update() }, t.prototype.update = function () { this.autoUpdateTexture && this.updateTexture(!0) }, t.prototype.updateTexture = function (e) { e && (this.video.paused && this._stillImageCaptured || (this._stillImageCaptured = !0, this._updateInternalTexture())) }, t.prototype.updateURL = function (e) { this.video.src = e }, t.prototype.dispose = function () { e.prototype.dispose.call(this), this._onUserActionRequestedObservable && (this._onUserActionRequestedObservable.clear(), this._onUserActionRequestedObservable = null), this.video.removeEventListener("canplay", this._createInternalTexture), this.video.removeEventListener("paused", this._updateInternalTexture), this.video.removeEventListener("seeked", this._updateInternalTexture), this.video.removeEventListener("emptied", this.reset), this.video.pause() }, t.CreateFromWebCam = function (e, i, r) { var n, o = document.createElement("video"); o.setAttribute("autoplay", ""), o.setAttribute("muted", ""), o.setAttribute("playsinline", ""), r && r.deviceId && (n = { exact: r.deviceId }), window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL, navigator.mediaDevices ? navigator.mediaDevices.getUserMedia({ video: r }).then(function (r) { void 0 !== o.mozSrcObject ? o.mozSrcObject = r : o.srcObject = r; var n = function () { i && i(new t("video", o, e, !0, !0)), o.removeEventListener("playing", n) }; o.addEventListener("playing", n), o.play() }).catch(function (e) { Gi.Tools.Error(e.name) }) : (navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia, navigator.getUserMedia && navigator.getUserMedia({ video: { deviceId: n, width: { min: r && r.minWidth || 256, max: r && r.maxWidth || 640 }, height: { min: r && r.minHeight || 256, max: r && r.maxHeight || 480 } } }, function (r) { void 0 !== o.mozSrcObject ? o.mozSrcObject = r : o.src = window.URL && window.URL.createObjectURL(r) || r, o.play(), i && i(new t("video", o, e, !0, !0)) }, function (e) { Gi.Tools.Error(e.name) })) }, t }((Gi = $a || ($a = {})).Texture), Gi.VideoTexture = ki, Hi = function (e) { function t(t, i, r, n, o, s, a, l, c) { void 0 === s && (s = !0), void 0 === a && (a = !1), void 0 === l && (l = Wi.Texture.TRILINEAR_SAMPLINGMODE), void 0 === c && (c = Wi.Engine.TEXTURETYPE_UNSIGNED_INT); var h = e.call(this, null, o, !s, a) || this; return h.format = n, h._engine = o.getEngine(), h._texture = o.getEngine().createRawTexture(t, i, r, n, s, a, l, null, c), h.wrapU = Wi.Texture.CLAMP_ADDRESSMODE, h.wrapV = Wi.Texture.CLAMP_ADDRESSMODE, h } return T(t, e), t.prototype.update = function (e) { this._engine.updateRawTexture(this._texture, e, this._texture.format, this._texture.invertY, void 0, this._texture.type) }, t.CreateLuminanceTexture = function (e, i, r, n, o, s, a) { return void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = Wi.Texture.TRILINEAR_SAMPLINGMODE), new t(e, i, r, Wi.Engine.TEXTUREFORMAT_LUMINANCE, n, o, s, a) }, t.CreateLuminanceAlphaTexture = function (e, i, r, n, o, s, a) { return void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = Wi.Texture.TRILINEAR_SAMPLINGMODE), new t(e, i, r, Wi.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA, n, o, s, a) }, t.CreateAlphaTexture = function (e, i, r, n, o, s, a) { return void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = Wi.Texture.TRILINEAR_SAMPLINGMODE), new t(e, i, r, Wi.Engine.TEXTUREFORMAT_ALPHA, n, o, s, a) }, t.CreateRGBTexture = function (e, i, r, n, o, s, a, l) { return void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = Wi.Texture.TRILINEAR_SAMPLINGMODE), void 0 === l && (l = Wi.Engine.TEXTURETYPE_UNSIGNED_INT), new t(e, i, r, Wi.Engine.TEXTUREFORMAT_RGB, n, o, s, a, l) }, t.CreateRGBATexture = function (e, i, r, n, o, s, a, l) { return void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = Wi.Texture.TRILINEAR_SAMPLINGMODE), void 0 === l && (l = Wi.Engine.TEXTURETYPE_UNSIGNED_INT), new t(e, i, r, Wi.Engine.TEXTUREFORMAT_RGBA, n, o, s, a, l) }, t.CreateRTexture = function (e, i, r, n, o, s, a, l) { return void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = Wi.Texture.TRILINEAR_SAMPLINGMODE), void 0 === l && (l = Wi.Engine.TEXTURETYPE_FLOAT), new t(e, i, r, Wi.Engine.TEXTUREFORMAT_R, n, o, s, a, l) }, t }((Wi = $a || ($a = {})).Texture), Wi.RawTexture = Hi, ji = function (e) { function t(t, i, r, n, o, s, a, l, c, h) { void 0 === a && (a = !0), void 0 === l && (l = !1), void 0 === c && (c = Xi.Texture.TRILINEAR_SAMPLINGMODE), void 0 === h && (h = Xi.Engine.TEXTURETYPE_UNSIGNED_INT); var u = e.call(this, null, s, !a, l) || this; return u.format = o, u._engine = s.getEngine(), u._texture = s.getEngine().createRawTexture3D(t, i, r, n, o, a, l, c, void 0, h), u.is3D = !0, u } return T(t, e), t.prototype.update = function (e) { this._texture && this._engine.updateRawTexture3D(this._texture, e, this._texture.format, this._texture.invertY, void 0, this._texture.type) }, t }((Xi = $a || ($a = {})).Texture), Xi.RawTexture3D = ji, Yi = $a || ($a = {}), Ki = function () { function e(e) { this._vertexBuffers = {}, this._scene = e } return e.prototype._prepareBuffers = function () { if (!this._vertexBuffers[Yi.VertexBuffer.PositionKind]) { var e = []; e.push(1, 1), e.push(-1, 1), e.push(-1, -1), e.push(1, -1), this._vertexBuffers[Yi.VertexBuffer.PositionKind] = new Yi.VertexBuffer(this._scene.getEngine(), e, Yi.VertexBuffer.PositionKind, !1, !1, 2), this._buildIndexBuffer() } }, e.prototype._buildIndexBuffer = function () { var e = []; e.push(0), e.push(1), e.push(2), e.push(0), e.push(2), e.push(3), this._indexBuffer = this._scene.getEngine().createIndexBuffer(e) }, e.prototype._rebuild = function () { var e = this._vertexBuffers[Yi.VertexBuffer.PositionKind]; e && (e._rebuild(), this._buildIndexBuffer()) }, e.prototype._prepareFrame = function (e, t) { void 0 === e && (e = null), void 0 === t && (t = null); var i = this._scene.activeCamera; return !(!i || !(t = t || i._postProcesses.filter(function (e) { return null != e })) || 0 === t.length || !this._scene.postProcessesEnabled || (t[0].activate(i, e, null != t), 0)) }, e.prototype.directRender = function (e, t, i, r, n) { void 0 === t && (t = null), void 0 === i && (i = !1), void 0 === r && (r = 0), void 0 === n && (n = 0); for (var o = this._scene.getEngine(), s = 0; s < e.length; s++) { s < e.length - 1 ? e[s + 1].activate(this._scene.activeCamera, t) : t ? o.bindFramebuffer(t, r, void 0, void 0, i, void 0, n) : o.restoreDefaultFramebuffer(); var a = e[s], l = a.apply(); l && (a.onBeforeRenderObservable.notifyObservers(l), this._prepareBuffers(), o.bindBuffers(this._vertexBuffers, this._indexBuffer, l), o.drawElementsType(Yi.Material.TriangleFillMode, 0, 6), a.onAfterRenderObservable.notifyObservers(l)) } o.setDepthBuffer(!0), o.setDepthWrite(!0) }, e.prototype._finalizeFrame = function (e, t, i, r, n) { void 0 === n && (n = !1); var o = this._scene.activeCamera; if (o && 0 !== (r = r || o._postProcesses.filter(function (e) { return null != e })).length && this._scene.postProcessesEnabled) { for (var s = this._scene.getEngine(), a = 0, l = r.length; a < l; a++) { var c = r[a]; if (a < l - 1 ? c._outputTexture = r[a + 1].activate(o, t) : t ? (s.bindFramebuffer(t, i, void 0, void 0, n), c._outputTexture = t) : (s.restoreDefaultFramebuffer(), c._outputTexture = null), e) break; var h = c.apply(); h && (c.onBeforeRenderObservable.notifyObservers(h), this._prepareBuffers(), s.bindBuffers(this._vertexBuffers, this._indexBuffer, h), s.drawElementsType(Yi.Material.TriangleFillMode, 0, 6), c.onAfterRenderObservable.notifyObservers(h)) } s.setDepthBuffer(!0), s.setDepthWrite(!0), s.setAlphaMode(Yi.Engine.ALPHA_DISABLE) } }, e.prototype.dispose = function () { var e = this._vertexBuffers[Yi.VertexBuffer.PositionKind]; e && (e.dispose(), this._vertexBuffers[Yi.VertexBuffer.PositionKind] = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null) }, e }(), Yi.PostProcessManager = Ki, Qi = $a || ($a = {}), Zi = function () { function e(e, t, i, r, n, o, s, a, l, c, h, u, d, f) { void 0 === s && (s = Qi.Texture.NEAREST_SAMPLINGMODE), void 0 === c && (c = null), void 0 === h && (h = Qi.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === u && (u = "postprocess"), void 0 === f && (f = !1), this.name = e, this.width = -1, this.height = -1, this._outputTexture = null, this.autoClear = !0, this.alphaMode = Qi.Engine.ALPHA_DISABLE, this.animations = new Array, this.enablePixelPerfectMode = !1, this.forceFullscreenViewport = !0, this.scaleMode = Qi.Engine.SCALEMODE_FLOOR, this.alwaysForcePOT = !1, this._samples = 1, this.adaptScaleToCurrentViewport = !1, this._reusable = !1, this._textures = new Qi.SmartArray(2), this._currentRenderTextureInd = 0, this._scaleRatio = new Qi.Vector2(1, 1), this._texelSize = Qi.Vector2.Zero(), this.onActivateObservable = new Qi.Observable, this.onSizeChangedObservable = new Qi.Observable, this.onApplyObservable = new Qi.Observable, this.onBeforeRenderObservable = new Qi.Observable, this.onAfterRenderObservable = new Qi.Observable, null != o ? (this._camera = o, this._scene = o.getScene(), o.attachPostProcess(this), this._engine = this._scene.getEngine(), this._scene.postProcesses.push(this)) : a && (this._engine = a, this._engine.postProcesses.push(this)), this._options = n, this.renderTargetSamplingMode = s || Qi.Texture.NEAREST_SAMPLINGMODE, this._reusable = l || !1, this._textureType = h, this._samplers = r || [], this._samplers.push("textureSampler"), this._fragmentUrl = t, this._vertexUrl = u, this._parameters = i || [], this._parameters.push("scale"), this._indexParameters = d, f || this.updateEffect(c) } return Object.defineProperty(e.prototype, "samples", { get: function () { return this._samples }, set: function (e) { var t = this; this._samples = e, this._textures.forEach(function (e) { e.samples !== t._samples && t._engine.updateRenderTargetTextureSampleCount(e, t._samples) }) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "onActivate", { set: function (e) { this._onActivateObserver && this.onActivateObservable.remove(this._onActivateObserver), e && (this._onActivateObserver = this.onActivateObservable.add(e)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "onSizeChanged", { set: function (e) { this._onSizeChangedObserver && this.onSizeChangedObservable.remove(this._onSizeChangedObserver), this._onSizeChangedObserver = this.onSizeChangedObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "onApply", { set: function (e) { this._onApplyObserver && this.onApplyObservable.remove(this._onApplyObserver), this._onApplyObserver = this.onApplyObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "onBeforeRender", { set: function (e) { this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver), this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "onAfterRender", { set: function (e) { this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver), this._onAfterRenderObserver = this.onAfterRenderObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "inputTexture", { get: function () { return this._textures.data[this._currentRenderTextureInd] }, set: function (e) { this._forcedOutputTexture = e }, enumerable: !0, configurable: !0 }), e.prototype.getCamera = function () { return this._camera }, Object.defineProperty(e.prototype, "texelSize", { get: function () { return this._shareOutputWithPostProcess ? this._shareOutputWithPostProcess.texelSize : (this._forcedOutputTexture && this._texelSize.copyFromFloats(1 / this._forcedOutputTexture.width, 1 / this._forcedOutputTexture.height), this._texelSize) }, enumerable: !0, configurable: !0 }), e.prototype.getEngine = function () { return this._engine }, e.prototype.getEffect = function () { return this._effect }, e.prototype.shareOutputWith = function (e) { return this._disposeTextures(), this._shareOutputWithPostProcess = e, this }, e.prototype.useOwnOutput = function () { 0 == this._textures.length && (this._textures = new Qi.SmartArray(2)), this._shareOutputWithPostProcess = null }, e.prototype.updateEffect = function (e, t, i, r, n, o) { void 0 === e && (e = null), void 0 === t && (t = null), void 0 === i && (i = null), this._effect = this._engine.createEffect({ vertex: this._vertexUrl, fragment: this._fragmentUrl }, ["position"], t || this._parameters, i || this._samplers, null !== e ? e : "", void 0, n, o, r || this._indexParameters) }, e.prototype.isReusable = function () { return this._reusable }, e.prototype.markTextureDirty = function () { this.width = -1 }, e.prototype.activate = function (e, t, i) { var r = this; void 0 === t && (t = null); var n = (e = e || this._camera).getScene(), o = n.getEngine(), s = o.getCaps().maxTextureSize, a = (t ? t.width : this._engine.getRenderWidth(!0)) * this._options | 0, l = (t ? t.height : this._engine.getRenderHeight(!0)) * this._options | 0, c = e.parent; !c || c.leftCamera != e && c.rightCamera != e || (a /= 2); var h, u = this._options.width || a, d = this._options.height || l; if (!this._shareOutputWithPostProcess && !this._forcedOutputTexture) { if (this.adaptScaleToCurrentViewport) { var f = o.currentViewport; f && (u *= f.width, d *= f.height) } if ((this.renderTargetSamplingMode === Qi.Texture.TRILINEAR_SAMPLINGMODE || this.alwaysForcePOT) && (this._options.width || (u = o.needPOTTextures ? Qi.Tools.GetExponentOfTwo(u, s, this.scaleMode) : u), this._options.height || (d = o.needPOTTextures ? Qi.Tools.GetExponentOfTwo(d, s, this.scaleMode) : d)), this.width !== u || this.height !== d) { if (0 < this._textures.length) { for (var p = 0; p < this._textures.length; p++)this._engine._releaseTexture(this._textures.data[p]); this._textures.reset() } this.width = u, this.height = d; var _ = { width: this.width, height: this.height }, m = { generateMipMaps: !1, generateDepthBuffer: i || 0 === e._postProcesses.indexOf(this), generateStencilBuffer: (i || 0 === e._postProcesses.indexOf(this)) && this._engine.isStencilEnable, samplingMode: this.renderTargetSamplingMode, type: this._textureType }; this._textures.push(this._engine.createRenderTargetTexture(_, m)), this._reusable && this._textures.push(this._engine.createRenderTargetTexture(_, m)), this._texelSize.copyFromFloats(1 / this.width, 1 / this.height), this.onSizeChangedObservable.notifyObservers(this) } this._textures.forEach(function (e) { e.samples !== r.samples && r._engine.updateRenderTargetTextureSampleCount(e, r.samples) }) } return this._shareOutputWithPostProcess ? h = this._shareOutputWithPostProcess.inputTexture : this._forcedOutputTexture ? (h = this._forcedOutputTexture, this.width = this._forcedOutputTexture.width, this.height = this._forcedOutputTexture.height) : h = this.inputTexture, this.enablePixelPerfectMode ? (this._scaleRatio.copyFromFloats(a / u, l / d), this._engine.bindFramebuffer(h, 0, a, l, this.forceFullscreenViewport)) : (this._scaleRatio.copyFromFloats(1, 1), this._engine.bindFramebuffer(h, 0, void 0, void 0, this.forceFullscreenViewport)), this.onActivateObservable.notifyObservers(e), this.autoClear && this.alphaMode === Qi.Engine.ALPHA_DISABLE && this._engine.clear(this.clearColor ? this.clearColor : n.clearColor, n._allowPostProcessClearColor, !0, !0), this._reusable && (this._currentRenderTextureInd = (this._currentRenderTextureInd + 1) % 2), h }, Object.defineProperty(e.prototype, "isSupported", { get: function () { return this._effect.isSupported }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "aspectRatio", { get: function () { return this._shareOutputWithPostProcess ? this._shareOutputWithPostProcess.aspectRatio : this._forcedOutputTexture ? this._forcedOutputTexture.width / this._forcedOutputTexture.height : this.width / this.height }, enumerable: !0, configurable: !0 }), e.prototype.isReady = function () { return this._effect && this._effect.isReady() }, e.prototype.apply = function () { return this._effect && this._effect.isReady() ? (this._engine.enableEffect(this._effect), this._engine.setState(!1), this._engine.setDepthBuffer(!1), this._engine.setDepthWrite(!1), this._engine.setAlphaMode(this.alphaMode), this.alphaConstants && this.getEngine().setAlphaConstants(this.alphaConstants.r, this.alphaConstants.g, this.alphaConstants.b, this.alphaConstants.a), e = this._shareOutputWithPostProcess ? this._shareOutputWithPostProcess.inputTexture : this._forcedOutputTexture ? this._forcedOutputTexture : this.inputTexture, this._effect._bindTexture("textureSampler", e), this._effect.setVector2("scale", this._scaleRatio), this.onApplyObservable.notifyObservers(this._effect), this._effect) : null; var e }, e.prototype._disposeTextures = function () { if (!this._shareOutputWithPostProcess && !this._forcedOutputTexture) { if (0 < this._textures.length) for (var e = 0; e < this._textures.length; e++)this._engine._releaseTexture(this._textures.data[e]); this._textures.dispose() } }, e.prototype.dispose = function (e) { if (e = e || this._camera, this._disposeTextures(), this._scene) { var t = this._scene.postProcesses.indexOf(this); -1 !== t && this._scene.postProcesses.splice(t, 1) } else { var i = this._engine.postProcesses.indexOf(this); -1 !== i && this._engine.postProcesses.splice(i, 1) } if (e) { if (e.detachPostProcess(this), 0 === e._postProcesses.indexOf(this) && 0 < e._postProcesses.length) { var r = this._camera._getFirstPostProcess(); r && r.markTextureDirty() } this.onActivateObservable.clear(), this.onAfterRenderObservable.clear(), this.onApplyObservable.clear(), this.onBeforeRenderObservable.clear(), this.onSizeChangedObservable.clear() } }, e }(), Qi.PostProcess = Zi, Ji = function (e) { function t(t, i, r, n, o, s, a, l) { return void 0 === r && (r = null), void 0 === a && (a = qi.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === l && (l = !1), e.call(this, t, "pass", null, null, i, r, n, o, s, void 0, a, void 0, null, l) || this } return T(t, e), t }((qi = $a || ($a = {})).PostProcess), qi.PassPostProcess = Ji, tl = this && this.__assign || function () { return (tl = Object.assign || function (e) { for (var t, i = 1, r = arguments.length; i < r; i++)for (var n in t = arguments[i]) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]); return e }).apply(this, arguments) }, $i = $a || ($a = {}), er = function () { function e(t, i, r) { this._bias = 5e-5, this._normalBias = 0, this._blurBoxOffset = 1, this._blurScale = 2, this._blurKernel = 1, this._useKernelBlur = !1, this._filter = e.FILTER_NONE, this._filteringQuality = e.QUALITY_HIGH, this._contactHardeningLightSizeUVRatio = .1, this._darkness = 0, this._transparencyShadow = !1, this.frustumEdgeFalloff = 0, this.forceBackFacesOnly = !1, this._lightDirection = $i.Vector3.Zero(), this._viewMatrix = $i.Matrix.Zero(), this._projectionMatrix = $i.Matrix.Zero(), this._transformMatrix = $i.Matrix.Zero(), this._cachedPosition = new $i.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cachedDirection = new $i.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._currentFaceIndex = 0, this._currentFaceIndexCache = 0, this._defaultTextureMatrix = $i.Matrix.Identity(), this._mapSize = t, this._light = i, this._scene = i.getScene(); var n = (i._shadowGenerator = this)._scene._getComponent($i.SceneComponentConstants.NAME_SHADOWGENERATOR); n || (n = new $i.ShadowGeneratorSceneComponent(this._scene), this._scene._addComponent(n)); var o = this._scene.getEngine().getCaps(); r ? o.textureFloatRender && o.textureFloatLinearFiltering ? this._textureType = $i.Engine.TEXTURETYPE_FLOAT : o.textureHalfFloatRender && o.textureHalfFloatLinearFiltering ? this._textureType = $i.Engine.TEXTURETYPE_HALF_FLOAT : this._textureType = $i.Engine.TEXTURETYPE_UNSIGNED_INT : o.textureHalfFloatRender && o.textureHalfFloatLinearFiltering ? this._textureType = $i.Engine.TEXTURETYPE_HALF_FLOAT : o.textureFloatRender && o.textureFloatLinearFiltering ? this._textureType = $i.Engine.TEXTURETYPE_FLOAT : this._textureType = $i.Engine.TEXTURETYPE_UNSIGNED_INT, this._initializeGenerator(), this._applyFilterValues() } return Object.defineProperty(e.prototype, "bias", { get: function () { return this._bias }, set: function (e) { this._bias = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "normalBias", { get: function () { return this._normalBias }, set: function (e) { this._normalBias = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "blurBoxOffset", { get: function () { return this._blurBoxOffset }, set: function (e) { this._blurBoxOffset !== e && (this._blurBoxOffset = e, this._disposeBlurPostProcesses()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "blurScale", { get: function () { return this._blurScale }, set: function (e) { this._blurScale !== e && (this._blurScale = e, this._disposeBlurPostProcesses()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "blurKernel", { get: function () { return this._blurKernel }, set: function (e) { this._blurKernel !== e && (this._blurKernel = e, this._disposeBlurPostProcesses()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "useKernelBlur", { get: function () { return this._useKernelBlur }, set: function (e) { this._useKernelBlur !== e && (this._useKernelBlur = e, this._disposeBlurPostProcesses()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "depthScale", { get: function () { return void 0 !== this._depthScale ? this._depthScale : this._light.getDepthScale() }, set: function (e) { this._depthScale = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "filter", { get: function () { return this._filter }, set: function (t) { if (this._light.needCube()) { if (t === e.FILTER_BLUREXPONENTIALSHADOWMAP) return void (this.useExponentialShadowMap = !0); if (t === e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP) return void (this.useCloseExponentialShadowMap = !0); if (t === e.FILTER_PCF || t === e.FILTER_PCSS) return void (this.usePoissonSampling = !0) } t !== e.FILTER_PCF && t !== e.FILTER_PCSS || 1 !== this._scene.getEngine().webGLVersion ? this._filter !== t && (this._filter = t, this._disposeBlurPostProcesses(), this._applyFilterValues(), this._light._markMeshesAsLightDirty()) : this.usePoissonSampling = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "usePoissonSampling", { get: function () { return this.filter === e.FILTER_POISSONSAMPLING }, set: function (t) { (t || this.filter === e.FILTER_POISSONSAMPLING) && (this.filter = t ? e.FILTER_POISSONSAMPLING : e.FILTER_NONE) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "useVarianceShadowMap", { get: function () { return $i.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."), this.useExponentialShadowMap }, set: function (e) { $i.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."), this.useExponentialShadowMap = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "useBlurVarianceShadowMap", { get: function () { return $i.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."), this.useBlurExponentialShadowMap }, set: function (e) { $i.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."), this.useBlurExponentialShadowMap = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "useExponentialShadowMap", { get: function () { return this.filter === e.FILTER_EXPONENTIALSHADOWMAP }, set: function (t) { (t || this.filter === e.FILTER_EXPONENTIALSHADOWMAP) && (this.filter = t ? e.FILTER_EXPONENTIALSHADOWMAP : e.FILTER_NONE) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "useBlurExponentialShadowMap", { get: function () { return this.filter === e.FILTER_BLUREXPONENTIALSHADOWMAP }, set: function (t) { (t || this.filter === e.FILTER_BLUREXPONENTIALSHADOWMAP) && (this.filter = t ? e.FILTER_BLUREXPONENTIALSHADOWMAP : e.FILTER_NONE) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "useCloseExponentialShadowMap", { get: function () { return this.filter === e.FILTER_CLOSEEXPONENTIALSHADOWMAP }, set: function (t) { (t || this.filter === e.FILTER_CLOSEEXPONENTIALSHADOWMAP) && (this.filter = t ? e.FILTER_CLOSEEXPONENTIALSHADOWMAP : e.FILTER_NONE) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "useBlurCloseExponentialShadowMap", { get: function () { return this.filter === e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP }, set: function (t) { (t || this.filter === e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP) && (this.filter = t ? e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP : e.FILTER_NONE) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "usePercentageCloserFiltering", { get: function () { return this.filter === e.FILTER_PCF }, set: function (t) { (t || this.filter === e.FILTER_PCF) && (this.filter = t ? e.FILTER_PCF : e.FILTER_NONE) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "filteringQuality", { get: function () { return this._filteringQuality }, set: function (e) { this._filteringQuality = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "useContactHardeningShadow", { get: function () { return this.filter === e.FILTER_PCSS }, set: function (t) { (t || this.filter === e.FILTER_PCSS) && (this.filter = t ? e.FILTER_PCSS : e.FILTER_NONE) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "contactHardeningLightSizeUVRatio", { get: function () { return this._contactHardeningLightSizeUVRatio }, set: function (e) { this._contactHardeningLightSizeUVRatio = e }, enumerable: !0, configurable: !0 }), e.prototype.getDarkness = function () { return this._darkness }, e.prototype.setDarkness = function (e) { return this._darkness = 1 <= e ? 1 : e <= 0 ? 0 : e, this }, e.prototype.setTransparencyShadow = function (e) { return this._transparencyShadow = e, this }, e.prototype.getShadowMap = function () { return this._shadowMap }, e.prototype.getShadowMapForRendering = function () { return this._shadowMap2 ? this._shadowMap2 : this._shadowMap }, e.prototype.addShadowCaster = function (e, t) { var i; return void 0 === t && (t = !0), this._shadowMap && (this._shadowMap.renderList || (this._shadowMap.renderList = []), this._shadowMap.renderList.push(e), t && (i = this._shadowMap.renderList).push.apply(i, e.getChildMeshes())), this }, e.prototype.removeShadowCaster = function (e, t) { if (void 0 === t && (t = !0), !this._shadowMap || !this._shadowMap.renderList) return this; var i = this._shadowMap.renderList.indexOf(e); if (-1 !== i && this._shadowMap.renderList.splice(i, 1), t) for (var r = 0, n = e.getChildren(); r < n.length; r++) { var o = n[r]; this.removeShadowCaster(o) } return this }, e.prototype.getLight = function () { return this._light }, e.prototype._initializeGenerator = function () { this._light._markMeshesAsLightDirty(), this._initializeShadowMap() }, e.prototype._initializeShadowMap = function () { var t = this, i = this._scene.getEngine(); 1 < i.webGLVersion ? (this._shadowMap = new $i.RenderTargetTexture(this._light.name + "_shadowMap", this._mapSize, this._scene, !1, !0, this._textureType, this._light.needCube(), void 0, !1, !1), this._shadowMap.createDepthStencilTexture($i.Engine.LESS, !0)) : this._shadowMap = new $i.RenderTargetTexture(this._light.name + "_shadowMap", this._mapSize, this._scene, !1, !0, this._textureType, this._light.needCube()), this._shadowMap.wrapU = $i.Texture.CLAMP_ADDRESSMODE, this._shadowMap.wrapV = $i.Texture.CLAMP_ADDRESSMODE, this._shadowMap.anisotropicFilteringLevel = 1, this._shadowMap.updateSamplingMode($i.Texture.BILINEAR_SAMPLINGMODE), this._shadowMap.renderParticles = !1, this._shadowMap.ignoreCameraViewport = !0, this._shadowMap.onBeforeRenderObservable.add(function (r) { t._currentFaceIndex = r, t._filter === e.FILTER_PCF && i.setColorWrite(!1) }), this._shadowMap.customRenderFunction = this._renderForShadowMap.bind(this), this._shadowMap.onAfterUnbindObservable.add(function () { if (t._filter === e.FILTER_PCF && i.setColorWrite(!0), t.useBlurExponentialShadowMap || t.useBlurCloseExponentialShadowMap) { var r = t.getShadowMapForRendering(); r && t._scene.postProcessManager.directRender(t._blurPostProcesses, r.getInternalTexture(), !0) } }); var r = new $i.Color4(0, 0, 0, 0), n = new $i.Color4(1, 1, 1, 1); this._shadowMap.onClearObservable.add(function (i) { t._filter === e.FILTER_PCF ? i.clear(n, !1, !0, !1) : t.useExponentialShadowMap || t.useBlurExponentialShadowMap ? i.clear(r, !0, !0, !1) : i.clear(n, !0, !0, !1) }) }, e.prototype._initializeBlurRTTAndPostProcesses = function () { var e = this, t = this._scene.getEngine(), i = this._mapSize / this.blurScale; this.useKernelBlur && 1 === this.blurScale || (this._shadowMap2 = new $i.RenderTargetTexture(this._light.name + "_shadowMap2", i, this._scene, !1, !0, this._textureType), this._shadowMap2.wrapU = $i.Texture.CLAMP_ADDRESSMODE, this._shadowMap2.wrapV = $i.Texture.CLAMP_ADDRESSMODE, this._shadowMap2.updateSamplingMode($i.Texture.BILINEAR_SAMPLINGMODE)), this.useKernelBlur ? (this._kernelBlurXPostprocess = new $i.BlurPostProcess(this._light.name + "KernelBlurX", new $i.Vector2(1, 0), this.blurKernel, 1, null, $i.Texture.BILINEAR_SAMPLINGMODE, t, !1, this._textureType), this._kernelBlurXPostprocess.width = i, this._kernelBlurXPostprocess.height = i, this._kernelBlurXPostprocess.onApplyObservable.add(function (t) { t.setTexture("textureSampler", e._shadowMap) }), this._kernelBlurYPostprocess = new $i.BlurPostProcess(this._light.name + "KernelBlurY", new $i.Vector2(0, 1), this.blurKernel, 1, null, $i.Texture.BILINEAR_SAMPLINGMODE, t, !1, this._textureType), this._kernelBlurXPostprocess.autoClear = !1, this._kernelBlurYPostprocess.autoClear = !1, this._textureType === $i.Engine.TEXTURETYPE_UNSIGNED_INT && (this._kernelBlurXPostprocess.packedFloat = !0, this._kernelBlurYPostprocess.packedFloat = !0), this._blurPostProcesses = [this._kernelBlurXPostprocess, this._kernelBlurYPostprocess]) : (this._boxBlurPostprocess = new $i.PostProcess(this._light.name + "DepthBoxBlur", "depthBoxBlur", ["screenSize", "boxOffset"], [], 1, null, $i.Texture.BILINEAR_SAMPLINGMODE, t, !1, "#define OFFSET " + this._blurBoxOffset, this._textureType), this._boxBlurPostprocess.onApplyObservable.add(function (t) { t.setFloat2("screenSize", i, i), t.setTexture("textureSampler", e._shadowMap) }), this._boxBlurPostprocess.autoClear = !1, this._blurPostProcesses = [this._boxBlurPostprocess]) }, e.prototype._renderForShadowMap = function (e, t, i, r) { var n, o = this._scene.getEngine(); if (r.length) { for (o.setColorWrite(!1), n = 0; n < r.length; n++)this._renderSubMeshForShadowMap(r.data[n]); o.setColorWrite(!0) } for (n = 0; n < e.length; n++)this._renderSubMeshForShadowMap(e.data[n]); for (n = 0; n < t.length; n++)this._renderSubMeshForShadowMap(t.data[n]); if (this._transparencyShadow) for (n = 0; n < i.length; n++)this._renderSubMeshForShadowMap(i.data[n]) }, e.prototype._renderSubMeshForShadowMap = function (e) { var t = this, i = e.getRenderingMesh(), r = this._scene, n = r.getEngine(), o = e.getMaterial(); if (o) { n.setState(o.backFaceCulling); var s = i._getInstancesRenderList(e._id); if (!s.mustReturn) { var a = n.getCaps().instancedArrays && null !== s.visibleInstances[e._id] && void 0 !== s.visibleInstances[e._id]; if (this.isReady(e, a)) { if (n.enableEffect(this._effect), i._bind(e, this._effect, $i.Material.TriangleFillMode), this._effect.setFloat3("biasAndScale", this.bias, this.normalBias, this.depthScale), this._effect.setMatrix("viewProjection", this.getTransformMatrix()), this.getLight().getTypeID() === $i.Light.LIGHTTYPEID_DIRECTIONALLIGHT ? this._effect.setVector3("lightData", this._cachedDirection) : this._effect.setVector3("lightData", this._cachedPosition), r.activeCamera && this._effect.setFloat2("depthValues", this.getLight().getDepthMinZ(r.activeCamera), this.getLight().getDepthMinZ(r.activeCamera) + this.getLight().getDepthMaxZ(r.activeCamera)), o && o.needAlphaTesting()) { var l = o.getAlphaTestTexture(); l && (this._effect.setTexture("diffuseSampler", l), this._effect.setMatrix("diffuseMatrix", l.getTextureMatrix() || this._defaultTextureMatrix)) } i.useBones && i.computeBonesUsingShaders && this._effect.setMatrices("mBones", i.skeleton.getTransformMatrices(i)), $i.MaterialHelper.BindMorphTargetParameters(i, this._effect), this.forceBackFacesOnly && n.setState(!0, 0, !1, !0), i._processRendering(e, this._effect, $i.Material.TriangleFillMode, s, a, function (e, i) { return t._effect.setMatrix("world", i) }), this.forceBackFacesOnly && n.setState(!0, 0, !1, !1) } else this._shadowMap && this._shadowMap.resetRefreshCounter() } } }, e.prototype._applyFilterValues = function () { this._shadowMap && (this.filter === e.FILTER_NONE || this.filter === e.FILTER_PCSS ? this._shadowMap.updateSamplingMode($i.Texture.NEAREST_SAMPLINGMODE) : this._shadowMap.updateSamplingMode($i.Texture.BILINEAR_SAMPLINGMODE)) }, e.prototype.forceCompilation = function (e, t) { var i = this, r = tl({ useInstances: !1 }, t), n = this.getShadowMap(); if (n) { var o = n.renderList; if (o) { for (var s = new Array, a = 0, l = o; a < l.length; a++) { var c = l[a]; s.push.apply(s, c.subMeshes) } if (0 !== s.length) { var h = 0, u = function () { if (i._scene && i._scene.getEngine()) { for (; i.isReady(s[h], r.useInstances);)if (++h >= s.length) return void (e && e(i)); setTimeout(u, 16) } }; u() } else e && e(this) } else e && e(this) } else e && e(this) }, e.prototype.forceCompilationAsync = function (e) { var t = this; return new Promise(function (i) { t.forceCompilation(function () { i() }, e) }) }, e.prototype.isReady = function (e, t) { var i = []; this._textureType !== $i.Engine.TEXTURETYPE_UNSIGNED_INT && i.push("#define FLOAT"), this.useExponentialShadowMap || this.useBlurExponentialShadowMap ? i.push("#define ESM") : (this.usePercentageCloserFiltering || this.useContactHardeningShadow) && i.push("#define DEPTHTEXTURE"); var r = [$i.VertexBuffer.PositionKind], n = e.getMesh(), o = e.getMaterial(); if (this.normalBias && n.isVerticesDataPresent($i.VertexBuffer.NormalKind) && (r.push($i.VertexBuffer.NormalKind), i.push("#define NORMAL"), n.nonUniformScaling && i.push("#define NONUNIFORMSCALING"), this.getLight().getTypeID() === $i.Light.LIGHTTYPEID_DIRECTIONALLIGHT && i.push("#define DIRECTIONINLIGHTDATA")), o && o.needAlphaTesting()) { var s = o.getAlphaTestTexture(); s && (i.push("#define ALPHATEST"), n.isVerticesDataPresent($i.VertexBuffer.UVKind) && (r.push($i.VertexBuffer.UVKind), i.push("#define UV1")), n.isVerticesDataPresent($i.VertexBuffer.UV2Kind) && 1 === s.coordinatesIndex && (r.push($i.VertexBuffer.UV2Kind), i.push("#define UV2"))) } n.useBones && n.computeBonesUsingShaders ? (r.push($i.VertexBuffer.MatricesIndicesKind), r.push($i.VertexBuffer.MatricesWeightsKind), 4 < n.numBoneInfluencers && (r.push($i.VertexBuffer.MatricesIndicesExtraKind), r.push($i.VertexBuffer.MatricesWeightsExtraKind)), i.push("#define NUM_BONE_INFLUENCERS " + n.numBoneInfluencers), i.push("#define BonesPerMesh " + (n.skeleton.bones.length + 1))) : i.push("#define NUM_BONE_INFLUENCERS 0"); var a = n.morphTargetManager, l = 0; a && 0 < a.numInfluencers && (i.push("#define MORPHTARGETS"), l = a.numInfluencers, i.push("#define NUM_MORPH_INFLUENCERS " + l), $i.MaterialHelper.PrepareAttributesForMorphTargets(r, n, { NUM_MORPH_INFLUENCERS: l })), t && (i.push("#define INSTANCES"), r.push("world0"), r.push("world1"), r.push("world2"), r.push("world3")); var c = i.join("\n"); return this._cachedDefines !== c && (this._cachedDefines = c, this._effect = this._scene.getEngine().createEffect("shadowMap", r, ["world", "mBones", "viewProjection", "diffuseMatrix", "lightData", "depthValues", "biasAndScale", "morphTargetInfluences"], ["diffuseSampler"], c, void 0, void 0, void 0, { maxSimultaneousMorphTargets: l })), !(!this._effect.isReady() || ((this.useBlurExponentialShadowMap || this.useBlurCloseExponentialShadowMap) && (this._blurPostProcesses && this._blurPostProcesses.length || this._initializeBlurRTTAndPostProcesses()), this._kernelBlurXPostprocess && !this._kernelBlurXPostprocess.isReady() || this._kernelBlurYPostprocess && !this._kernelBlurYPostprocess.isReady() || this._boxBlurPostprocess && !this._boxBlurPostprocess.isReady())) }, e.prototype.prepareDefines = function (t, i) { var r = this._scene, n = this._light; r.shadowsEnabled && n.shadowEnabled && (t["SHADOW" + i] = !0, this.useContactHardeningShadow && (t["SHADOWPCSS" + i] = !0, this._filteringQuality === e.QUALITY_LOW ? t["SHADOWLOWQUALITY" + i] = !0 : this._filteringQuality === e.QUALITY_MEDIUM && (t["SHADOWMEDIUMQUALITY" + i] = !0)), this.usePercentageCloserFiltering ? (t["SHADOWPCF" + i] = !0, this._filteringQuality === e.QUALITY_LOW ? t["SHADOWLOWQUALITY" + i] = !0 : this._filteringQuality === e.QUALITY_MEDIUM && (t["SHADOWMEDIUMQUALITY" + i] = !0)) : this.usePoissonSampling ? t["SHADOWPOISSON" + i] = !0 : this.useExponentialShadowMap || this.useBlurExponentialShadowMap ? t["SHADOWESM" + i] = !0 : (this.useCloseExponentialShadowMap || this.useBlurCloseExponentialShadowMap) && (t["SHADOWCLOSEESM" + i] = !0), n.needCube() && (t["SHADOWCUBE" + i] = !0)) }, e.prototype.bindShadowLight = function (t, i) { var r = this._light, n = this._scene; if (n.shadowsEnabled && r.shadowEnabled) { var o = n.activeCamera; if (o) { var s = this.getShadowMap(); s && (r.needCube() || i.setMatrix("lightMatrix" + t, this.getTransformMatrix()), this._filter === e.FILTER_PCF ? (i.setDepthStencilTexture("shadowSampler" + t, this.getShadowMapForRendering()), r._uniformBuffer.updateFloat4("shadowsInfo", this.getDarkness(), s.getSize().width, 1 / s.getSize().width, this.frustumEdgeFalloff, t)) : this._filter === e.FILTER_PCSS ? (i.setDepthStencilTexture("shadowSampler" + t, this.getShadowMapForRendering()), i.setTexture("depthSampler" + t, this.getShadowMapForRendering()), r._uniformBuffer.updateFloat4("shadowsInfo", this.getDarkness(), 1 / s.getSize().width, this._contactHardeningLightSizeUVRatio * s.getSize().width, this.frustumEdgeFalloff, t)) : (i.setTexture("shadowSampler" + t, this.getShadowMapForRendering()), r._uniformBuffer.updateFloat4("shadowsInfo", this.getDarkness(), this.blurScale / s.getSize().width, this.depthScale, this.frustumEdgeFalloff, t)), r._uniformBuffer.updateFloat2("depthValues", this.getLight().getDepthMinZ(o), this.getLight().getDepthMinZ(o) + this.getLight().getDepthMaxZ(o), t)) } } }, e.prototype.getTransformMatrix = function () { var e = this._scene; if (this._currentRenderID === e.getRenderId() && this._currentFaceIndexCache === this._currentFaceIndex) return this._transformMatrix; this._currentRenderID = e.getRenderId(), this._currentFaceIndexCache = this._currentFaceIndex; var t = this._light.position; if (this._light.computeTransformedInformation() && (t = this._light.transformedPosition), $i.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex), this._lightDirection), 1 === Math.abs($i.Vector3.Dot(this._lightDirection, $i.Vector3.Up())) && (this._lightDirection.z = 1e-13), this._light.needProjectionMatrixCompute() || !this._cachedPosition || !this._cachedDirection || !t.equals(this._cachedPosition) || !this._lightDirection.equals(this._cachedDirection)) { this._cachedPosition.copyFrom(t), this._cachedDirection.copyFrom(this._lightDirection), $i.Matrix.LookAtLHToRef(t, t.add(this._lightDirection), $i.Vector3.Up(), this._viewMatrix); var i = this.getShadowMap(); if (i) { var r = i.renderList; r && this._light.setShadowProjectionMatrix(this._projectionMatrix, this._viewMatrix, r) } this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix) } return this._transformMatrix }, e.prototype.recreateShadowMap = function () { var e = this._shadowMap; if (e) { var t = e.renderList; this._disposeRTTandPostProcesses(), this._initializeGenerator(), this.filter = this.filter, this._applyFilterValues(), this._shadowMap.renderList = t } }, e.prototype._disposeBlurPostProcesses = function () { this._shadowMap2 && (this._shadowMap2.dispose(), this._shadowMap2 = null), this._boxBlurPostprocess && (this._boxBlurPostprocess.dispose(), this._boxBlurPostprocess = null), this._kernelBlurXPostprocess && (this._kernelBlurXPostprocess.dispose(), this._kernelBlurXPostprocess = null), this._kernelBlurYPostprocess && (this._kernelBlurYPostprocess.dispose(), this._kernelBlurYPostprocess = null), this._blurPostProcesses = [] }, e.prototype._disposeRTTandPostProcesses = function () { this._shadowMap && (this._shadowMap.dispose(), this._shadowMap = null), this._disposeBlurPostProcesses() }, e.prototype.dispose = function () { this._disposeRTTandPostProcesses(), this._light && (this._light._shadowGenerator = null, this._light._markMeshesAsLightDirty()) }, e.prototype.serialize = function () { var e = {}, t = this.getShadowMap(); if (!t) return e; if (e.lightId = this._light.id, e.mapSize = t.getRenderSize(), e.useExponentialShadowMap = this.useExponentialShadowMap, e.useBlurExponentialShadowMap = this.useBlurExponentialShadowMap, e.useCloseExponentialShadowMap = this.useBlurExponentialShadowMap, e.useBlurCloseExponentialShadowMap = this.useBlurExponentialShadowMap, e.usePoissonSampling = this.usePoissonSampling, e.forceBackFacesOnly = this.forceBackFacesOnly, e.depthScale = this.depthScale, e.darkness = this.getDarkness(), e.blurBoxOffset = this.blurBoxOffset, e.blurKernel = this.blurKernel, e.blurScale = this.blurScale, e.useKernelBlur = this.useKernelBlur, e.transparencyShadow = this._transparencyShadow, e.frustumEdgeFalloff = this.frustumEdgeFalloff, e.bias = this.bias, e.normalBias = this.normalBias, e.usePercentageCloserFiltering = this.usePercentageCloserFiltering, e.useContactHardeningShadow = this.useContactHardeningShadow, e.filteringQuality = this.filteringQuality, e.contactHardeningLightSizeUVRatio = this.contactHardeningLightSizeUVRatio, e.renderList = [], t.renderList) for (var i = 0; i < t.renderList.length; i++) { var r = t.renderList[i]; e.renderList.push(r.id) } return e }, e.Parse = function (t, i) { for (var r = i.getLightByID(t.lightId), n = new e(t.mapSize, r), o = n.getShadowMap(), s = 0; s < t.renderList.length; s++)i.getMeshesByID(t.renderList[s]).forEach(function (e) { o && (o.renderList || (o.renderList = []), o.renderList.push(e)) }); return t.usePoissonSampling ? n.usePoissonSampling = !0 : t.useExponentialShadowMap ? n.useExponentialShadowMap = !0 : t.useBlurExponentialShadowMap ? n.useBlurExponentialShadowMap = !0 : t.useCloseExponentialShadowMap ? n.useCloseExponentialShadowMap = !0 : t.useBlurCloseExponentialShadowMap ? n.useBlurCloseExponentialShadowMap = !0 : t.usePercentageCloserFiltering ? n.usePercentageCloserFiltering = !0 : t.useContactHardeningShadow && (n.useContactHardeningShadow = !0), t.filteringQuality && (n.filteringQuality = t.filteringQuality), t.contactHardeningLightSizeUVRatio ? n.contactHardeningLightSizeUVRatio = t.contactHardeningLightSizeUVRatio : t.useVarianceShadowMap ? n.useExponentialShadowMap = !0 : t.useBlurVarianceShadowMap && (n.useBlurExponentialShadowMap = !0), t.depthScale && (n.depthScale = t.depthScale), t.blurScale && (n.blurScale = t.blurScale), t.blurBoxOffset && (n.blurBoxOffset = t.blurBoxOffset), t.useKernelBlur && (n.useKernelBlur = t.useKernelBlur), t.blurKernel && (n.blurKernel = t.blurKernel), void 0 !== t.bias && (n.bias = t.bias), void 0 !== t.normalBias && (n.normalBias = t.normalBias), void 0 !== t.frustumEdgeFalloff && (n.frustumEdgeFalloff = t.frustumEdgeFalloff), t.darkness && n.setDarkness(t.darkness), t.transparencyShadow && n.setTransparencyShadow(!0), n.forceBackFacesOnly = t.forceBackFacesOnly, n }, e.FILTER_NONE = 0, e.FILTER_EXPONENTIALSHADOWMAP = 1, e.FILTER_POISSONSAMPLING = 2, e.FILTER_BLUREXPONENTIALSHADOWMAP = 3, e.FILTER_CLOSEEXPONENTIALSHADOWMAP = 4, e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP = 5, e.FILTER_PCF = 6, e.FILTER_PCSS = 7, e.QUALITY_HIGH = 0, e.QUALITY_MEDIUM = 1, e.QUALITY_LOW = 2, e }(), $i.ShadowGenerator = er, function (e) { e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_SHADOWGENERATOR, function (t, i, r, n) { if (void 0 !== t.shadowGenerators && null !== t.shadowGenerators) for (var o = 0, s = t.shadowGenerators.length; o < s; o++) { var a = t.shadowGenerators[o]; e.ShadowGenerator.Parse(a, i) } }); var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_SHADOWGENERATOR, this.scene = t } return t.prototype.register = function () { this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR, this, this._gatherRenderTargets) }, t.prototype.rebuild = function () { }, t.prototype.serialize = function (e) { e.shadowGenerators = []; for (var t = 0, i = this.scene.lights; t < i.length; t++) { var r = i[t].getShadowGenerator(); r && e.shadowGenerators.push(r.serialize()) } }, t.prototype.addFromContainer = function (e) { }, t.prototype.removeFromContainer = function (e) { }, t.prototype.dispose = function () { }, t.prototype._gatherRenderTargets = function (e) { var t = this.scene; if (this.scene.shadowsEnabled) for (var i = 0; i < t.lights.length; i++) { var r = t.lights[i], n = r.getShadowGenerator(); if (r.isEnabled() && r.shadowEnabled && n) { var o = n.getShadowMap(); -1 !== t.textures.indexOf(o) && e.push(o) } } }, t }(); e.ShadowGeneratorSceneComponent = t }($a || ($a = {})), tr = $a || ($a = {}), ir = function () { function e(e, t, i) { void 0 === t && (t = ""), void 0 === i && (i = "black"); var r = this; this._renderingCanvas = e, this._loadingText = t, this._loadingDivBackgroundColor = i, this._resizeLoadingUI = function () { var e = r._renderingCanvas.getBoundingClientRect(), t = window.getComputedStyle(r._renderingCanvas).position; r._loadingDiv && (r._loadingDiv.style.position = "fixed" === t ? "fixed" : "absolute", r._loadingDiv.style.left = e.left + "px", r._loadingDiv.style.top = e.top + "px", r._loadingDiv.style.width = e.width + "px", r._loadingDiv.style.height = e.height + "px") } } return e.prototype.displayLoadingUI = function () { if (!this._loadingDiv) { this._loadingDiv = document.createElement("div"), this._loadingDiv.id = "babylonjsLoadingDiv", this._loadingDiv.style.opacity = "0", this._loadingDiv.style.transition = "opacity 1.5s ease", this._loadingDiv.style.pointerEvents = "none", this._loadingTextDiv = document.createElement("div"), this._loadingTextDiv.style.position = "absolute", this._loadingTextDiv.style.left = "0", this._loadingTextDiv.style.top = "50%", this._loadingTextDiv.style.marginTop = "80px", this._loadingTextDiv.style.width = "100%", this._loadingTextDiv.style.height = "20px", this._loadingTextDiv.style.fontFamily = "Arial", this._loadingTextDiv.style.fontSize = "14px", this._loadingTextDiv.style.color = "white", this._loadingTextDiv.style.textAlign = "center", this._loadingTextDiv.innerHTML = "Loading", this._loadingDiv.appendChild(this._loadingTextDiv), this._loadingTextDiv.innerHTML = this._loadingText; var e = document.createElement("style"); e.type = "text/css", e.innerHTML = "@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }", document.getElementsByTagName("head")[0].appendChild(e); var t = new Image; t.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAYq0lEQVR4Xu2dCZRcVZnHScAJUZSwjSOIbAJmEAZwQCCMoAInYRGIg8AwegQx7AFzUBBmzAFlE4EAwxz2GRk2w7AnAURZBiEOZgyEQDAQAjmEJqTpNd3V1V3Vmd+/6utKV7/1vnpVXd2p/zn3vOV+27vfu/fd/W3QQAPrBZqbm7fJZrN79vf3T+/r67uf4wO9vb37WXQDIwWtra0Tenp6voQTv5XP56/BkfcR3iLk1g6B7hEeI+zP5V+ZiAbqBZ2dnZ8lV+6Gg87CobfhpOc4byf0FjwYE9DneBkWcXrM2tmzNzTxDdQKJPyETCazI46YgiMuI9zJuXJltuChFIHsP/PSfIfTjU19A2mira1tcxy3ey6XO5vEnkV4kes11XBmENDVj97XOT2O03FmWgMuoNLzGRJva8IUnPkzjjcT/kLoKCZzfQB7XiX8M2G8md7AUJgzJ+Z6e88gZ1xGuj3HsY17PcVkrG9gp7CUF/F8PUvxqdZDrFq1ahNVfKjwTCYxZuDE2wjKlc2WViMePM+HPNsFPOdf22OPblD5OZQHvphnV65cjTMzxaQY3eA5V9OO/hmnm1lSjE7woFsQbiXki4++foHnXkW4mLC1JUl947333tsMY3emqfB9jtPJlXN5U0+bOXPmWCPxgOccSy4+AfqPio+9/oFnbyatbqVE28GSZfjQ1NT0KQzaHMcdyPfyaNoE12HcvdxT29K3Fkv8A2vWrPmcifAFZNtD91yRY+SBZ+9UsMtEgD+jTpeenp6JXI6xpKkuUDqRcA6Kr0Wpens+InQTnIpV6Fdi+BQT64ulS5eOIzefD62na7CeoGcnLCM8ykt5OWlzcPv772/BS/w3nP+K+xU11+DvQe5dcrQlTfWAwbNMb8XA8AyGX80xtLlA6TAJuteMbVhhia1v5VMcr+LWMeoZ4xiYw7q6urbhHbgG+paCkIRQehHu4pO3O5fVydEomF5Ulx548JfVD2wqfKE2I3R3ob/f2GoC1DWhdz7HG3i5j2pvb9+Z24m6HvVZQtYsZFWcowlzePEP4jJdR/OQhxTVpAs9NMXxmZxuZKo8IG4s+v8R2tUFphSBTBWzH+OAFwn/gS3TuN55xYoVqfc6dXd3fwHZ1xFaTX0iyGbwjJqXXAammxP00EXx6UMGEx7ram7+vKnzBZ/87Xiwp40tEdDTgYwlHG/CmadSjO7L+XiialOZAej7POFG2VK0Khngl6Pn8/LL0YEtlFh4n8oDAqvaAYH8tzH2iNDm1IIFn8Ax50G7xtgCAU07CfAG4RHOz+vLZL7e0dGxlYlKHaj8BHo25xgrsfV5wrYH4KmouxV+ZZDnCUdwmXxMGgFvFUVWD+jQuOot6rI0tb4gcfaG9v+MrcAn+wj38gL8C7cObmlp2ZRjOkWYD6ypuAf6zjFHLSJ0c/6YQ813DM/yZXgehreiVgP8cvSfsOeExYsXuzs6n8v9j8mqBRZQmdjXVPuira1NHSpn8UDf4Xu0vd2uCtDzacJOlDDf5ng94X8JTWarB8R1EK7ju7udiYgEz/v3pLFKm4oHUHhh3iZdfshpaEYpA4pvKLLXBujLYKRq71XLhUHg27z12rW9B6L/QhLrWWxRH7nzeDK8awi/5HRTEx0K6MZQ694LHk0DqrgfADkreIYz1q5c+UlTEQzesIuMryrggYQWjNL3RGO7p2tuFMeqjaOidgzyCz1yJMTJ6L6d66WEVCcHIO/dQkI75Chs2g97Hoc3jRz9Lge1ED5l4r0gckqRPB0gTw34t1B+h3IqxZkmrn2SULUa7ezZszdE5xfR9130Xsm5ilrnHrmkQOcKvrkncxqrIiY6wlewbw7BOUfDo/b84zzvj9C7J7eCS0NrUiRKCPjUE7ScMBdlF/B2HqBi0ERXBcuXL99YnQz9fX2ah3Up4UnsWGEmDRuUhoTn+Z5PfvbZZ2N/fuCZRJgnfhNVBu73EZoIKt7l0L2UBsYeDZg016nb5EUCWuXQewinUtTuyq2aTStF14a8SD+VDQVj6hDYxjuXf4Hjl83sSMCmTp8j4FtoMuRQ5dAZcii3kk/0s2bBhxIcBxjxUlib1hWInEDO/6qKV+y4geO5HAMntEE/pq+nZyo0ywsG1SmwL4Orf+0yqGCfmvR73LAn9lAeBjQTEhkA+1h49a08iRflcq4H5iuXFU9cz4lqihC/LXS/NZa6Bc+pz5gql5ub6VXD2tZWTSPeyS7XgeLhXrMnEhj6MSHSwaIhFGZH8oA/JzzFeexvJbRN2HW03moT6cEChx6w4QY2rurn85JWrxsiCy0FwjcIqos8w7GZNPulkawDEbFHlaBtjzODEDrVztuKXMmADPWA3RaljyJeNdKq98ilAez8iJdyGqfO31V4NoV/EvyaCqR54V2EshE5Lqcb+TrkstkTLD4WKB4PNNZQ8P05HAelMXNSPWChC8JsYvwthJo0jSoF6fIqjjqe08Aat+LIkd+AVjn09zxbZFqK3tjXAUbXUaWDjTUSyN4J45YZX2Igo4cEOVfFson2ALIxSjR0jog5YNgpfNHM90BxIjDyWIB8Z2NfB01HISJ20wPaw4w1FlavXq1v8aPGXhFw9JNRFTDItifU/RwwpfmKxYsDK180kU4x0lhAXvOSJUs+bezlIDL2N4xi4GpjK4MGCuzUA+SPxzn3m4iKgKyV2DCV08DeMWg0B+zHHOt2DpjS3Mz1BfFOM25C5ZH4LxldJBB0g7GVARkaXgv8VsKqZtIMPpN9RUnJgRzU5Wfp22vifcG3+2vQvmdsdQXsX2pm+oKX+GYjjQXkPWqsXshpRhcJ0RpbGShSHiSuheP37ZYHsGusVHOrU1lMxkO9od4eE+8LlSzQqfetpnPAooBN/2Um+gISp89MkF8K4G3RrMJYoOhbYGxlQEGhSOGogfoLwipExGtUZVVBYIVAluaAaUpuWA+YujlPF22Ra/iBLYEOsV6tV4w0FiitfmLsXiBMU0NiAVrfsp77Zd8MHPgbDoHtva6uLs1jiv1piAKy5tCG+4KJ9wVO/p6RDzvy+b5rzSwP9Okh/WKPERiCWzfk4K8bUSTiOljAyCdx5DZG4gE8W5Dov+NYUfsV/j50fUC4dmXIQDh0qQ6PVgJsOcLM8oA410Ggvo6Ojr81di+g2TKuQOiyJOKWxlpCJpM5zUjKAL3awTsamQfEbYhjtDGKa5tPsyn/wAuiURftlBO56h6aunEwCMxxvV1d+2Fr7Jce2vAu5LUtLeoGi/19gtbToCaR97BoD6BvUs+WkXqgbw6OuhC6wH5l4rRGaCFOvYnjYbyxnpcsCvDVhYOxo6+zszNwSNHVTtJEmSiwzlMAQmNPwIPW42Dds2hfEK/5WJo0Fth+5VNxFHSlkoTzFRh/N3wnq0OGWxXtdoO8enFwaI4jsyidYgNZTxhrMEjEJ4w+En65ESWRXZ7Q4K/COqDAPlhka87WedB8KawmngTIHREOJs5pMiRp+p/GGgxL1FiA9hxjK6G1tVVdhJGAV15+cPXq1f7dahVC20Wg4miCp0uTe3Xh4Hwu93rY1B7SR/t7xQbP5R1FGgpy8IlKe+MJhZ9Aa7u5jPm+pGLX2BMDOZ+hDXgQiXIJ5xoXHZg96anEEFcvOTi0SMUXS4w0FijSTzTWYEA3hkTSEtDI2qw6RoytDLA6jctCvzKqJ8oPFOO7kAhnYe9cZGiWiZ/N9ezguWaSL4h3TUfvKJIfoN0I4sjigYSdZyxlcDVMgEczEY41ER6oZFBOh2Yqegf2zYoziFC3DuZZrjSTPLDtMlxaNPmPP/54W2OPxksrVozP5fLPGr8vEOpbxJCr3jQSJyDvGRNRhv7iHh8vE5LMpKznHBz4zSTOaXwe+mXGGh9tbWvVQf+iyfCAON/ZlTj4v43ECfB94Le4CuMrWVpTtw7O9fZOM5M8oD7xVSOLBdLuNWN1g7bgJUF8+4qpBjf7Te9M6hD4tBDc0289Wh2MHbuaSR7gsHOMLBaQ9W/G6o5MJrNDPu9dcYdQ33Yc95I6OFV5hnp2cGCliDingX5KU+9MShd0dmqta/k8J4zwnV2JsuuNxAnI83VwNpO52kiSoC4djA255cuXBzYPycGzjTQWkPdNY00OfRcQVLafRnd39ySLLsG1i20AyPZ3cDb7AyNJgnp1cOhUHUhcFiL045v9jTUa8Gjlm29fsQQhb3DzJLUEhC+oiK7EISPOwapoEh+7JQJti5YfGXs0YNC62ouC1h9lsrlToClsjc/RM7uSe0kd3EmlzTO/Kqk8Q106mM/Yw2aOB9jnOg6sWTHxJ9FraSJMy6nGz7RbZUDYmN7e3BnQ5Gisez7u3J9c0JwA6Pb0aCFvNObgwKk6NoU59uJwaJ8y1viAT4vCtEFXYO8SFQGtCZpllyXQtNqL+4lmZ/BN/5qJKQFZozEHe9JtAGSaw4wsFnie4JmUQcjleh8yZq0Fnmq3y0D02IzPMgnonYqYIfA4pC+TcXrgIahLB+PEb5s5HrjaR0b7kbHGB0pK7TDO1/T39x1lUZGAPlUH0xTbz+KSoC4dDDx2DQCHzTCaWOB5zjbW+KCSpW0IS0BIJmy6zWCk7WDuxZ4r5oO6dHB7e/sBZo4H2OfUsYOv9jHW+ECJdkAtA/c6MpmMd+XaEKj7km9M4F5TEfBzSKovDLKG1cHobw+b6EDa3WOksYBPAhevBUJMxl8GJTRhFyMLBKSJFn5ls9nvmogS0DfaHOzb3h8AcUuNNBLQNiWa0gRv4MwMMyBwCqxAfCIH82JdYSJKQN+ocjA5NHD2I/e1aj/23iPyhbG6A+bAgXsZoUEII/UAkkQORu71JqIE7o22HBw4VaelpWU74mPPDc/39d1trO5Qb4vJ8QXxbwat06WofcTInMCzeToAtN4VXUn/l1AXDkan9tDSfmL6C81BZooHxDkN9CMveLFZFFAWWZtDwVta3G0sJcAbe3bmYEiniShBXabcL+wflQDD5mD0yKlvk0b/Tk33AG5F7idG+/ibRe54oEl1nLG6A+ZYe1jyAIuG/u2LB3MazxwAfL5vJFGJinxQUwcju6c/n3+FNPm5JhJyy2k/sQTp5nm+2HBJCGi1X1WpwzuBoQXAN+IcjDz8mdePKi/WhH1uxd7GcCjIVBcWpUYDfZ0VbclEJSr2akMBhVrdX6j+Jx3DpSh7vKB8CIiqKwcrcXGqdr05k3RKbU9ryTQVkUB3aHMrEshw7kGCXiv8xxG0h6Uzent6Fpn6MhA17A6GT/3yTxNO1coJbgWur3JFf1fXNuTes5AZe18xXobFHJKv04JZc3O7CtIcgGL9KW03u3QCfL4D4b292dhrpoYgsYOhEz4kaOuHqXKqiagYiN9QnUlyKgX84JUYsQFP9GKzMFRSe8XJb9upE9Dn62CK/KQT75wdTLz+NXgPNdrDuYzeUd0ByN4Wp07n+EdCRZuTY1/ymZQDwIjQye9pA32xdw6IiUgHc639mN8kzCLRjkxzQRzitUpkZ8LZBP1CILUd55EVvdgsCrzJl5i8mgCja+Zgjst4Pq3DUnMmtSWqyNIuQruRU3+CbO08n+pvBAZAjf1IU5kcGJc0YRMBfVV3MPd2RN4+YbvYukI/3sSpe+LUmbw0ryG/6ts1oSLeYrMw6C0xeaFAGc+Wq3hbfeRk582b55lrzf3UHJwWkD0Wp+6BQ3+BfXEXw6UCdHX4TVB0BoJi9Y1Cp59XbUWN8HW7lRjLli3zbINE+1hNiCRI1cGakIhT99ani/A6z1z1nDoUqNQfbO40kyqDfrCBwMg3E5rsCy+8sFlHR8dEnFzRTq/I8hQ9NFFOtGhXVOxgFeUqfknUK7Ctpjl1ANKJ/vmUkvrdwRZmWjpA4J9MTyja2toKY8TQa/ufxP/Whdd5c5cQJHIwfBsTvkKiaqd6/fRyOHKqavdL0H+V2sxmWvrQCAeKItfmQlNyDG/8SVwnetMHyxmA7lm0K2I7GFrlVBW/V6FPP9GqeU4V0Kt2+O2yhctUN6AJBEWD9ngMnessJxh5AfCoQe+8q+xQOYLuWbQrQh2MXP1XYh8S9DKC2sI1z6kCatW3/RCZ6Vj9fNPMqx2wQVNJQlcNEl/mGG5pv48bi7HxMVSOoHsW7QqPg5GlvnJtk6/B9+HMqYUfaXE6rampqWy4dVhgi8FfLprnBXEex+i/wCSkNiSNDSpUxxt7Ccj2nQQYAwUHc9yE3HEotuifDklnfFYMdGNC/lWCxotDf4PvB/jHZTs71c+f2n+ryqCPPcb5/pKdGrTvbH2MUjH4ByOLBDpON9YSFi5cuI1FOwFbbyTox5T6y+iwFL8CqvWvwVtolWgSv/N4sXbl5ZP3r8hRLT50d56KgYJDCYXVhYOhtqqReKDdZuGJtSQSOk8f67x581SspvH3lpoBe9Vefbg/lzveaXmnAf6tEDMNGRp3LnV3ch29o10lQIf+bOKZc+XnmMGARF2EK4vUwQiSw33n7ZlqDWwcaK9Ob29vd26vwj+OT8m3kKFxdd9tlILSJ1Wo8Y8RZT/YiKOY4le5P3SGZJAc7telg7FroL16Jc/n/a1cBBCxsSblwT8LOfofcCh4AQ4x1uoCXZtgVKnYDXLMUECnPSQD29VBcrhfVw7GHrVXb6WylGg0SvUZcrr+YPYuwWVfaE9ltmpA2Q6EQq2UY+yigzf2oqCH4v4MIysD94fdwdig9uqDnB4T5/d+gwHPGNVFcOopyJiPLOfmGTwa0Ek8qS8RKDKORLFWH95utwbDd94SRqqN/Cv4PDXbTFfXfUZWBvRUPJCRBJiIqfnnccy0Dz74wHkWoypY2D4ZGU8gK+kKjQKQ8RcTW1uQI2fmc7nH7LIMFEW+sw6xdyN4CgvNByNIDjp+ZyRVhzlV7dVLaZc7t1cRoW0w9of/No6ptbuRdZupqC3QPZY33HchMkbJiRPssgyaHkN82XaJXPtOJuN+JRuixQI6Cu1VXiZtJehcFGpeNPyXI6cqPWTIvsxU1R7o912akevre4OHfTHot3fEfRbD3y8+Qu0djO5Ce5UXNGl7dTt4z0RGqnOuhgLZgmcPk2FHrrd3jgwkAVQ58e1ioxjcHeMLPWQcq+5gZKm9+hJHjXo5z4xQBQsxxyDjEfir+nNq5GfQo/nYh6f9e4NUgGEFx3DEzvw1nPrOhSJ+kh6GUBUHw6//Kmls96dJ2qv6FxNF9z8g405kVLVXDfkaiFAd4JIkttYUGFpyDOf91Ch/YVEe8DA/gORpuywDfLNMjBOQt4qEupbTPTX4YeJig+/qrnoxkfMeIdH2UHGBfP0H6kFepElc1rY5lBQYXZbzuO7BWYH7b3V3d/+TX1FEG/JSExEJdOi7qsnrx3DuNM8Zdg2NqnN/BjK0EXlVhxORr56wP6Lv/DT+X1FzYLynaOWe2s1TjCQW4An9t6Jk4hBVdH6YpB9YNXoS+SRk/JaQZHd5J2CnesLuyGaze3KZ2hTemoNcpO+uB3pAQuzvC7SeJSfc0258Wo97aX9PT+TmMEMB73jsO0wJzXnVx4llL7pe5kWaFtSqGHHgu6rpPr5jsdx+hyI59G+hA4C25GDO1V69mbf/77h0+lZpzZX44B+Ye1X1cWKz92pKrYlcjtzc6gfN+ufhApd/ErcwTvuTRNI0m4c4Tg77u6gfbCHdTuQcrRFaRKiFU7Xl1O/RqX9RObevRxR43gmEBYUn9wEJIMeF/jk0yVKTta2tE0jg43kx1OatWifEYKDrHYKGDnfkMrU1xHUPaoh7k8i+030EvoV3c6i4aTCoc/9+9NVkFgh6BmZFaig08he3oxYkwBEkQGCzg7gfG6kzaDvuSyLfgIyqt1cF6SAspoS4iJf3c9xaf3JrGEgUzZcOGgvO4agzjTQUkI9V5z4851MuLhBvUUp1gR7tjXEHL+shXFZnduNIBomi6T73FVLLByQePu4N3CxMbVxyzfeQUTYZrdpA3yvoPVf/1jdTGggC6aXx0ieLSecFcWoj72vkhU4IcswU7gVORksb6FHnufbouJ4Xbv+gf1g0EADav9uSeO9YenpA3IfURFVZ0gqEms1rRg0qCzM4TuYy1T061jt0dXXpX0xJ96FMDXIqQXtJ3tSfze6OaY0KU1ogfTUgUJMK0lBIL06dS/F/LJeRe0k2kAAk7BgSWN2GVW/aCOjRuPCbBHVGBG6J3ECKIN3VlfjroguqA+RrMsFvCNqisf5mRox2qPlB4s8vuiMdIE/fVjVvLlRnhKlqYLig7QIpOiva40PAqR2E22neJFrN10AVgWMOIDgPuMOjmRFa+HVaR0fHliaugXoEOe80nBWrZg2dZkZoYffuaW5u1kCVkadmbT70AGdqJodWOhxHqP2eFg1UDvsLatnSFq41M+KKnp6eXbhsdB2OdGiCeX8+/2ecqgnmk/VXNYtqYLSAnNposzpjgw3+H/belpVa8J7TAAAAAElFTkSuQmCC", t.style.position = "absolute", t.style.left = "50%", t.style.top = "50%", t.style.marginLeft = "-60px", t.style.marginTop = "-60px", t.style.animation = "spin1 2s infinite ease-in-out", t.style.webkitAnimation = "spin1 2s infinite ease-in-out", t.style.transformOrigin = "50% 50%", t.style.webkitTransformOrigin = "50% 50%", this._loadingDiv.appendChild(t), this._resizeLoadingUI(), window.addEventListener("resize", this._resizeLoadingUI), this._loadingDiv.style.backgroundColor = this._loadingDivBackgroundColor, document.body.appendChild(this._loadingDiv), this._loadingDiv.style.opacity = "1" } }, e.prototype.hideLoadingUI = function () { var e = this; this._loadingDiv && (this._loadingDiv.style.opacity = "0", this._loadingDiv.addEventListener("transitionend", function () { e._loadingDiv && (document.body.removeChild(e._loadingDiv), window.removeEventListener("resize", e._resizeLoadingUI), e._loadingDiv = null) })) }, Object.defineProperty(e.prototype, "loadingUIText", { get: function () { return this._loadingText }, set: function (e) { this._loadingText = e, this._loadingTextDiv && (this._loadingTextDiv.innerHTML = this._loadingText) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "loadingUIBackgroundColor", { get: function () { return this._loadingDivBackgroundColor }, set: function (e) { this._loadingDivBackgroundColor = e, this._loadingDiv && (this._loadingDiv.style.backgroundColor = this._loadingDivBackgroundColor) }, enumerable: !0, configurable: !0 }), e }(), tr.DefaultLoadingScreen = ir, function (e) { var t = function () { function e(e, t, i) { this.lengthComputable = e, this.loaded = t, this.total = i } return e.FromProgressEvent = function (t) { return new e(t.lengthComputable, t.loaded, t.total) }, e }(); e.SceneLoaderProgressEvent = t; var i = function () { function i() { } return Object.defineProperty(i, "ForceFullSceneLoadingForIncremental", { get: function () { return i._ForceFullSceneLoadingForIncremental }, set: function (e) { i._ForceFullSceneLoadingForIncremental = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "ShowLoadingScreen", { get: function () { return i._ShowLoadingScreen }, set: function (e) { i._ShowLoadingScreen = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "loggingLevel", { get: function () { return i._loggingLevel }, set: function (e) { i._loggingLevel = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(i, "CleanBoneMatrixWeights", { get: function () { return i._CleanBoneMatrixWeights }, set: function (e) { i._CleanBoneMatrixWeights = e }, enumerable: !0, configurable: !0 }), i._getDefaultPlugin = function () { return i._registeredPlugins[".babylon"] }, i._getPluginForExtension = function (t) { return i._registeredPlugins[t] || (e.Tools.Warn("Unable to find a plugin to load " + t + " files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"), i._getDefaultPlugin()) }, i._getPluginForDirectLoad = function (e) { for (var t in i._registeredPlugins) { var r = i._registeredPlugins[t].plugin; if (r.canDirectLoad && r.canDirectLoad(e)) return i._registeredPlugins[t] } return i._getDefaultPlugin() }, i._getPluginForFilename = function (e) { var t = e.indexOf("?"); -1 !== t && (e = e.substring(0, t)); var r = e.lastIndexOf("."), n = e.substring(r, e.length).toLowerCase(); return i._getPluginForExtension(n) }, i._getDirectLoad = function (e) { return "data:" === e.substr(0, 5) ? e.substr(5) : null }, i._loadData = function (r, n, o, s, a, l, c) { var h, u = i._getDirectLoad(r.name), d = c ? i._getPluginForExtension(c) : u ? i._getPluginForDirectLoad(r.name) : i._getPluginForFilename(r.name); h = d.plugin.createPlugin ? d.plugin.createPlugin() : d.plugin; var f, p = d.isBinary; i.OnPluginActivatedObservable.notifyObservers(h); var _ = function (e, t) { n.isDisposed ? a("Scene has been disposed") : (n.database = f, o(h, e, t)) }, m = null, g = !1, v = h.onDisposeObservable; v && v.add(function () { g = !0, m && (m.abort(), m = null), l() }); var y = function () { g || (m = e.Tools.LoadFile(r.url, _, s ? function (e) { s(t.FromProgressEvent(e)) } : void 0, f, p, function (e, t) { a("Failed to load scene." + (t ? " " + t.message : ""), t) })) }; if (u) return _(u), h; if (-1 === r.rootUrl.indexOf("file:")) { var b = n.getEngine(), T = b.enableOfflineSupport; if (T) { for (var E = !1, x = 0, P = n.disableOfflineSupportExceptionRules; x < P.length; x++)if (P[x].test(r.url)) { E = !0; break } T = !E } T ? f = new e.Database(r.url, y, b.disableManifestCheck) : y() } else { var A = e.FilesInput.FilesToLoad[r.name.toLowerCase()]; A ? m = e.Tools.ReadFile(A, _, s, p) : a("Unable to find file named " + r.name) } return h }, i._getFileInfo = function (t, i) { var r, n; if (i) { if ("/" === i.substr(0, 1)) return e.Tools.Error("Wrong sceneFilename parameter"), null; r = t + i, n = i } else r = t, n = e.Tools.GetFilename(t), t = e.Tools.GetFolderPath(t); return { url: r, rootUrl: t, name: n } }, i.GetPluginForExtension = function (e) { return i._getPluginForExtension(e).plugin }, i.IsPluginForExtensionAvailable = function (e) { return !!i._registeredPlugins[e] }, i.RegisterPlugin = function (e) { if ("string" == typeof e.extensions) { var t = e.extensions; i._registeredPlugins[t.toLowerCase()] = { plugin: e, isBinary: !1 } } else { var r = e.extensions; Object.keys(r).forEach(function (t) { i._registeredPlugins[t.toLowerCase()] = { plugin: e, isBinary: r[t].isBinary } }) } }, i.ImportMesh = function (t, r, n, o, s, a, l, c) { if (void 0 === n && (n = ""), void 0 === o && (o = e.Engine.LastCreatedScene), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === l && (l = null), void 0 === c && (c = null), !o) return e.Tools.Error("No scene available to import mesh to"), null; var h = i._getFileInfo(r, n); if (!h) return null; var u = {}; o._addPendingData(u); var d = function () { o._removePendingData(u) }, f = function (t, i) { var r = "Unable to import meshes from " + h.url + ": " + t; l ? l(o, r, i) : e.Tools.Error(r), d() }, p = a ? function (e) { try { a(e) } catch (e) { f("Error in onProgress callback", e) } } : void 0, _ = function (e, t, i, r) { if (o.importedMeshesFiles.push(h.url), s) try { s(e, t, i, r) } catch (e) { f("Error in onSuccess callback", e) } o._removePendingData(u) }; return i._loadData(h, o, function (e, i, r) { if (e.rewriteRootURL && (h.rootUrl = e.rewriteRootURL(h.rootUrl, r)), e.importMesh) { var n = e, s = new Array, a = new Array, l = new Array; if (!n.importMesh(t, o, i, h.rootUrl, s, a, l, f)) return; o.loadingPluginName = e.name, _(s, a, l, []) } else e.importMeshAsync(t, o, i, h.rootUrl, p, h.name).then(function (t) { o.loadingPluginName = e.name, _(t.meshes, t.particleSystems, t.skeletons, t.animationGroups) }).catch(function (e) { f(e.message, e) }) }, p, f, d, c) }, i.ImportMeshAsync = function (t, r, n, o, s, a) { return void 0 === n && (n = ""), void 0 === o && (o = e.Engine.LastCreatedScene), void 0 === s && (s = null), void 0 === a && (a = null), new Promise(function (e, l) { i.ImportMesh(t, r, n, o, function (t, i, r, n) { e({ meshes: t, particleSystems: i, skeletons: r, animationGroups: n }) }, s, function (e, t, i) { l(i || new Error(t)) }, a) }) }, i.Load = function (t, r, n, o, s, a, l) { return void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === l && (l = null), i.Append(t, r, new e.Scene(n), o, s, a, l) }, i.LoadAsync = function (e, t, r, n, o) { return void 0 === n && (n = null), void 0 === o && (o = null), new Promise(function (s, a) { i.Load(e, t, r, function (e) { s(e) }, n, function (e, t, i) { a(i || new Error(t)) }, o) }) }, i.Append = function (t, r, n, o, s, a, l) { if (void 0 === r && (r = ""), void 0 === n && (n = e.Engine.LastCreatedScene), void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === l && (l = null), !n) return e.Tools.Error("No scene available to append to"), null; var c = i._getFileInfo(t, r); if (!c) return null; i.ShowLoadingScreen && n.getEngine().displayLoadingUI(); var h = {}; n._addPendingData(h); var u = function () { n._removePendingData(h), n.getEngine().hideLoadingUI() }, d = function (t, i) { var r = "Unable to load from " + c.url + (t ? ": " + t : ""); a ? a(n, r, i) : e.Tools.Error(r), u() }, f = s ? function (e) { try { s(e) } catch (e) { d("Error in onProgress callback", e) } } : void 0, p = function () { if (o) try { o(n) } catch (t) { d("Error in onSuccess callback", t) } n._removePendingData(h) }; return i._loadData(c, n, function (e, t, r) { if (e.load) { if (!e.load(n, t, c.rootUrl, d)) return; n.loadingPluginName = e.name, p() } else e.loadAsync(n, t, c.rootUrl, f, c.name).then(function () { n.loadingPluginName = e.name, p() }).catch(function (e) { d(e.message, e) }); i.ShowLoadingScreen && n.executeWhenReady(function () { n.getEngine().hideLoadingUI() }) }, f, d, u, l) }, i.AppendAsync = function (t, r, n, o, s) { return void 0 === r && (r = ""), void 0 === n && (n = e.Engine.LastCreatedScene), void 0 === o && (o = null), void 0 === s && (s = null), new Promise(function (e, a) { i.Append(t, r, n, function (t) { e(t) }, o, function (e, t, i) { a(i || new Error(t)) }, s) }) }, i.LoadAssetContainer = function (t, r, n, o, s, a, l) { if (void 0 === r && (r = ""), void 0 === n && (n = e.Engine.LastCreatedScene), void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === l && (l = null), !n) return e.Tools.Error("No scene available to load asset container to"), null; var c = i._getFileInfo(t, r); if (!c) return null; var h = {}; n._addPendingData(h); var u = function () { n._removePendingData(h) }, d = function (t, i) { var r = "Unable to load assets from " + c.url + (t ? ": " + t : ""); a ? a(n, r, i) : e.Tools.Error(r), u() }, f = s ? function (e) { try { s(e) } catch (e) { d("Error in onProgress callback", e) } } : void 0, p = function (e) { if (o) try { o(e) } catch (e) { d("Error in onSuccess callback", e) } n._removePendingData(h) }; return i._loadData(c, n, function (e, t, r) { if (e.loadAssetContainer) { var o = e.loadAssetContainer(n, t, c.rootUrl, d); if (!o) return; n.loadingPluginName = e.name, p(o) } else e.loadAssetContainerAsync ? e.loadAssetContainerAsync(n, t, c.rootUrl, f, c.name).then(function (t) { n.loadingPluginName = e.name, p(t) }).catch(function (e) { d(e.message, e) }) : d("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method."); i.ShowLoadingScreen && n.executeWhenReady(function () { n.getEngine().hideLoadingUI() }) }, f, d, u, l) }, i.LoadAssetContainerAsync = function (t, r, n, o, s) { return void 0 === r && (r = ""), void 0 === n && (n = e.Engine.LastCreatedScene), void 0 === o && (o = null), void 0 === s && (s = null), new Promise(function (e, a) { i.LoadAssetContainer(t, r, n, function (t) { e(t) }, o, function (e, t, i) { a(i || new Error(t)) }, s) }) }, i._ForceFullSceneLoadingForIncremental = !1, i._ShowLoadingScreen = !0, i._CleanBoneMatrixWeights = !1, i.NO_LOGGING = 0, i.MINIMAL_LOGGING = 1, i.SUMMARY_LOGGING = 2, i.DETAILED_LOGGING = 3, i._loggingLevel = i.NO_LOGGING, i.OnPluginActivatedObservable = new e.Observable, i._registeredPlugins = {}, i }(); e.SceneLoader = i }($a || ($a = {})), rr = $a || ($a = {}), nr = function (e, t, i, r) { for (var n = 0, o = t.materials.length; n < o; n++) { var s = t.materials[n]; if (s.id === e) return rr.Material.Parse(s, i, r) } return null }, or = function (e, t, i) { for (var r in t) if (e.name === t[r]) return i.push(e.id), !0; return !(!e.parentId || -1 === i.indexOf(e.parentId) || (i.push(e.id), 0)) }, sr = function (e, t) { return e + " of " + (t ? t.file + " from " + t.name + " version: " + t.version + ", exporter version: " + t.exporter_version : "unknown") }, ar = function (e, t, i, r, n) { void 0 === n && (n = !1); var o = new rr.AssetContainer(e), s = "importScene has failed JSON parse"; try { var a = JSON.parse(t); s = ""; var l, c, h = rr.SceneLoader.loggingLevel === rr.SceneLoader.DETAILED_LOGGING; if (void 0 !== a.lights && null !== a.lights) for (l = 0, c = a.lights.length; l < c; l++) { var u = a.lights[l], d = rr.Light.Parse(u, e); d && (o.lights.push(d), s += 0 === l ? "\n\tLights:" : "", s += "\n\t\t" + d.toString(h)) } if (void 0 !== a.animations && null !== a.animations) for (l = 0, c = a.animations.length; l < c; l++) { var f = a.animations[l], p = rr.Animation.Parse(f); e.animations.push(p), o.animations.push(p), s += 0 === l ? "\n\tAnimations:" : "", s += "\n\t\t" + p.toString(h) } if (void 0 !== a.materials && null !== a.materials) for (l = 0, c = a.materials.length; l < c; l++) { var _ = a.materials[l], m = rr.Material.Parse(_, e, i); o.materials.push(m), s += 0 === l ? "\n\tMaterials:" : "", s += "\n\t\t" + m.toString(h) } if (void 0 !== a.multiMaterials && null !== a.multiMaterials) for (l = 0, c = a.multiMaterials.length; l < c; l++) { var g = a.multiMaterials[l], v = rr.Material.ParseMultiMaterial(g, e); o.multiMaterials.push(v), s += 0 === l ? "\n\tMultiMaterials:" : "", s += "\n\t\t" + v.toString(h) } if (void 0 !== a.morphTargetManagers && null !== a.morphTargetManagers) for (var y = 0, b = a.morphTargetManagers; y < b.length; y++) { var T = b[y]; o.morphTargetManagers.push(rr.MorphTargetManager.Parse(T, e)) } if (void 0 !== a.skeletons && null !== a.skeletons) for (l = 0, c = a.skeletons.length; l < c; l++) { var E = a.skeletons[l], x = rr.Skeleton.Parse(E, e); o.skeletons.push(x), s += 0 === l ? "\n\tSkeletons:" : "", s += "\n\t\t" + x.toString(h) } var P = a.geometries; if (null != P) { var A = new Array, S = P.boxes; if (null != S) for (l = 0, c = S.length; l < c; l++) { var M = S[l]; A.push(rr.BoxGeometry.Parse(M, e)) } var R = P.spheres; if (null != R) for (l = 0, c = R.length; l < c; l++) { var C = R[l]; A.push(rr.SphereGeometry.Parse(C, e)) } var O = P.cylinders; if (null != O) for (l = 0, c = O.length; l < c; l++) { var D = O[l]; A.push(rr.CylinderGeometry.Parse(D, e)) } var I = P.toruses; if (null != I) for (l = 0, c = I.length; l < c; l++) { var w = I[l]; A.push(rr.TorusGeometry.Parse(w, e)) } var L = P.grounds; if (null != L) for (l = 0, c = L.length; l < c; l++) { var F = L[l]; A.push(rr.GroundGeometry.Parse(F, e)) } var B = P.planes; if (null != B) for (l = 0, c = B.length; l < c; l++) { var N = B[l]; A.push(rr.PlaneGeometry.Parse(N, e)) } var V = P.torusKnots; if (null != V) for (l = 0, c = V.length; l < c; l++) { var U = V[l]; A.push(rr.TorusKnotGeometry.Parse(U, e)) } var z = P.vertexData; if (null != z) for (l = 0, c = z.length; l < c; l++) { var G = z[l]; A.push(rr.Geometry.Parse(G, e, i)) } A.forEach(function (e) { e && o.geometries.push(e) }) } if (void 0 !== a.transformNodes && null !== a.transformNodes) for (l = 0, c = a.transformNodes.length; l < c; l++) { var k = a.transformNodes[l], W = rr.TransformNode.Parse(k, e, i); o.transformNodes.push(W) } if (void 0 !== a.meshes && null !== a.meshes) for (l = 0, c = a.meshes.length; l < c; l++) { var H = a.meshes[l], X = rr.Mesh.Parse(H, e, i); o.meshes.push(X), s += 0 === l ? "\n\tMeshes:" : "", s += "\n\t\t" + X.toString(h) } if (void 0 !== a.cameras && null !== a.cameras) for (l = 0, c = a.cameras.length; l < c; l++) { var j = a.cameras[l], Y = rr.Camera.Parse(j, e); o.cameras.push(Y), s += 0 === l ? "\n\tCameras:" : "", s += "\n\t\t" + Y.toString(h) } if (void 0 !== a.animationGroups && null !== a.animationGroups) for (l = 0, c = a.animationGroups.length; l < c; l++) { var K = a.animationGroups[l], Q = rr.AnimationGroup.Parse(K, e); o.animationGroups.push(Q), s += 0 === l ? "\n\tAnimationGroups:" : "", s += "\n\t\t" + Q.toString(h) } for (l = 0, c = e.cameras.length; l < c; l++)(Y = e.cameras[l])._waitingParentId && (Y.parent = e.getLastEntryByID(Y._waitingParentId), Y._waitingParentId = null); for (l = 0, c = e.lights.length; l < c; l++) { var Z = e.lights[l]; Z && Z._waitingParentId && (Z.parent = e.getLastEntryByID(Z._waitingParentId), Z._waitingParentId = null) } for (l = 0, c = e.transformNodes.length; l < c; l++) { var q = e.transformNodes[l]; q._waitingParentId && (q.parent = e.getLastEntryByID(q._waitingParentId), q._waitingParentId = null) } for (l = 0, c = e.meshes.length; l < c; l++)(X = e.meshes[l])._waitingParentId && (X.parent = e.getLastEntryByID(X._waitingParentId), X._waitingParentId = null); for (l = 0, c = e.meshes.length; l < c; l++) { var J = e.meshes[l]; J._waitingFreezeWorldMatrix ? (J.freezeWorldMatrix(), J._waitingFreezeWorldMatrix = null) : J.computeWorldMatrix(!0) } for (l = 0, c = e.lights.length; l < c; l++) { var $ = e.lights[l]; if (0 < $._excludedMeshesIds.length) { for (var ee = 0; ee < $._excludedMeshesIds.length; ee++) { var te = e.getMeshByID($._excludedMeshesIds[ee]); te && $.excludedMeshes.push(te) } $._excludedMeshesIds = [] } if (0 < $._includedOnlyMeshesIds.length) { for (var ie = 0; ie < $._includedOnlyMeshesIds.length; ie++) { var re = e.getMeshByID($._includedOnlyMeshesIds[ie]); re && $.includedOnlyMeshes.push(re) } $._includedOnlyMeshesIds = [] } } for (rr.AbstractScene.Parse(a, e, o, i), l = 0, c = e.meshes.length; l < c; l++)(X = e.meshes[l])._waitingActions && (rr.ActionManager.Parse(X._waitingActions, X, e), X._waitingActions = null); void 0 !== a.actions && null !== a.actions && rr.ActionManager.Parse(a.actions, null, e), n || o.removeAllFromScene() } catch (e) { var ne = sr("loadAssets", a ? a.producer : "Unknown") + s; if (!r) throw rr.Tools.Log(ne), e; r(ne, e) } finally { null !== s && rr.SceneLoader.loggingLevel !== rr.SceneLoader.NO_LOGGING && rr.Tools.Log(sr("loadAssets", a ? a.producer : "Unknown") + (rr.SceneLoader.loggingLevel !== rr.SceneLoader.MINIMAL_LOGGING ? s : "")) } return o }, rr.SceneLoader.RegisterPlugin({ name: "babylon.js", extensions: ".babylon", canDirectLoad: function (e) { return -1 !== e.indexOf("babylon") }, importMesh: function (e, t, i, r, n, o, s, a) { var l = "importMesh has failed JSON parse"; try { var c = JSON.parse(i); l = ""; var h = rr.SceneLoader.loggingLevel === rr.SceneLoader.DETAILED_LOGGING; e ? Array.isArray(e) || (e = [e]) : e = null; var u = new Array; if (void 0 !== c.meshes && null !== c.meshes) { var d, f, p, _ = [], m = []; for (d = 0, f = c.meshes.length; d < f; d++) { var g = c.meshes[d]; if (null === e || or(g, e, u)) { if (null !== e && delete e[e.indexOf(g.name)], void 0 !== g.geometryId && null !== g.geometryId && void 0 !== c.geometries && null !== c.geometries) { var v = !1;["boxes", "spheres", "cylinders", "toruses", "grounds", "planes", "torusKnots", "vertexData"].forEach(function (e) { !0 !== v && c.geometries[e] && Array.isArray(c.geometries[e]) && c.geometries[e].forEach(function (i) { if (i.id === g.geometryId) { switch (e) { case "boxes": rr.BoxGeometry.Parse(i, t); break; case "spheres": rr.SphereGeometry.Parse(i, t); break; case "cylinders": rr.CylinderGeometry.Parse(i, t); break; case "toruses": rr.TorusGeometry.Parse(i, t); break; case "grounds": rr.GroundGeometry.Parse(i, t); break; case "planes": rr.PlaneGeometry.Parse(i, t); break; case "torusKnots": rr.TorusKnotGeometry.Parse(i, t); break; case "vertexData": rr.Geometry.Parse(i, t, r) }v = !0 } }) }), !1 === v && rr.Tools.Warn("Geometry not found for mesh " + g.id) } if (g.materialId) { var y = -1 !== m.indexOf(g.materialId); if (!1 === y && void 0 !== c.multiMaterials && null !== c.multiMaterials) for (var b = 0, T = c.multiMaterials.length; b < T; b++) { var E = c.multiMaterials[b]; if (E.id === g.materialId) { for (var x = 0, P = E.materials.length; x < P; x++) { var A, S = E.materials[x]; m.push(S), (A = nr(S, c, t, r)) && (l += "\n\tMaterial " + A.toString(h)) } m.push(E.id); var M = rr.Material.ParseMultiMaterial(E, t); M && (y = !0, l += "\n\tMulti-Material " + M.toString(h)); break } } !1 === y && (m.push(g.materialId), (A = nr(g.materialId, c, t, r)) ? l += "\n\tMaterial " + A.toString(h) : rr.Tools.Warn("Material not found for mesh " + g.id)) } if (-1 < g.skeletonId && void 0 !== c.skeletons && null !== c.skeletons && 0 == -1 < _.indexOf(g.skeletonId)) for (var R = 0, C = c.skeletons.length; R < C; R++) { var O = c.skeletons[R]; if (O.id === g.skeletonId) { var D = rr.Skeleton.Parse(O, t); s.push(D), _.push(O.id), l += "\n\tSkeleton " + D.toString(h) } } if (void 0 !== c.morphTargetManagers && null !== c.morphTargetManagers) for (var I = 0, w = c.morphTargetManagers; I < w.length; I++) { var L = w[I]; rr.MorphTargetManager.Parse(L, t) } var F = rr.Mesh.Parse(g, t, r); n.push(F), l += "\n\tMesh " + F.toString(h) } } for (d = 0, f = t.meshes.length; d < f; d++)(p = t.meshes[d])._waitingParentId && (p.parent = t.getLastEntryByID(p._waitingParentId), p._waitingParentId = null); for (d = 0, f = t.meshes.length; d < f; d++)(p = t.meshes[d])._waitingFreezeWorldMatrix ? (p.freezeWorldMatrix(), p._waitingFreezeWorldMatrix = null) : p.computeWorldMatrix(!0) } if (void 0 !== c.particleSystems && null !== c.particleSystems) { var B = rr.AbstractScene.GetIndividualParser(rr.SceneComponentConstants.NAME_PARTICLESYSTEM); if (B) for (d = 0, f = c.particleSystems.length; d < f; d++) { var N = c.particleSystems[d]; -1 !== u.indexOf(N.emitterId) && o.push(B(N, t, r)) } } return !0 } catch (e) { var V = sr("importMesh", c ? c.producer : "Unknown") + l; if (!a) throw rr.Tools.Log(V), e; a(V, e) } finally { null !== l && rr.SceneLoader.loggingLevel !== rr.SceneLoader.NO_LOGGING && rr.Tools.Log(sr("importMesh", c ? c.producer : "Unknown") + (rr.SceneLoader.loggingLevel !== rr.SceneLoader.MINIMAL_LOGGING ? l : "")) } return !1 }, load: function (e, t, i, r) { var n = "importScene has failed JSON parse"; try { var o = JSON.parse(t); if (n = "", void 0 !== o.useDelayedTextureLoading && null !== o.useDelayedTextureLoading && (e.useDelayedTextureLoading = o.useDelayedTextureLoading && !rr.SceneLoader.ForceFullSceneLoadingForIncremental), void 0 !== o.autoClear && null !== o.autoClear && (e.autoClear = o.autoClear), void 0 !== o.clearColor && null !== o.clearColor && (e.clearColor = rr.Color4.FromArray(o.clearColor)), void 0 !== o.ambientColor && null !== o.ambientColor && (e.ambientColor = rr.Color3.FromArray(o.ambientColor)), void 0 !== o.gravity && null !== o.gravity && (e.gravity = rr.Vector3.FromArray(o.gravity)), o.fogMode && 0 !== o.fogMode) switch (e.fogMode = o.fogMode, e.fogColor = rr.Color3.FromArray(o.fogColor), e.fogStart = o.fogStart, e.fogEnd = o.fogEnd, e.fogDensity = o.fogDensity, n += "\tFog mode for scene:  ", e.fogMode) { case 1: n += "exp\n"; break; case 2: n += "exp2\n"; break; case 3: n += "linear\n" }if (o.physicsEnabled) { var s; "cannon" === o.physicsEngine ? s = new rr.CannonJSPlugin : "oimo" === o.physicsEngine && (s = new rr.OimoJSPlugin), n = "\tPhysics engine " + (o.physicsEngine ? o.physicsEngine : "oimo") + " enabled\n"; var a = o.physicsGravity ? rr.Vector3.FromArray(o.physicsGravity) : null; e.enablePhysics(a, s) } if (void 0 !== o.metadata && null !== o.metadata && (e.metadata = o.metadata), void 0 !== o.collisionsEnabled && null !== o.collisionsEnabled && (e.collisionsEnabled = o.collisionsEnabled), e.workerCollisions = !!o.workerCollisions, !ar(e, t, i, r, !0)) return !1; if (o.autoAnimate && e.beginAnimation(e, o.autoAnimateFrom, o.autoAnimateTo, o.autoAnimateLoop, o.autoAnimateSpeed || 1), void 0 !== o.activeCameraID && null !== o.activeCameraID && e.setActiveCameraByID(o.activeCameraID), void 0 !== o.environmentTexture && null !== o.environmentTexture) { if (o.environmentTextureType && "BABYLON.HDRCubeTexture" === o.environmentTextureType) { var l = o.environmentTextureSize ? o.environmentTextureSize : 128, c = new rr.HDRCubeTexture(i + o.environmentTexture, e, l); o.environmentTextureRotationY && (c.rotationY = o.environmentTextureRotationY), e.environmentTexture = c } else { var h = rr.CubeTexture.CreateFromPrefilteredData(i + o.environmentTexture, e); o.environmentTextureRotationY && (h.rotationY = o.environmentTextureRotationY), e.environmentTexture = h } if (!0 === o.createDefaultSkybox) { var u = void 0 !== e.activeCamera && null !== e.activeCamera ? (e.activeCamera.maxZ - e.activeCamera.minZ) / 2 : 1e3, d = o.skyboxBlurLevel || 0; e.createDefaultSkybox(void 0, !0, u, d) } } return !0 } catch (e) { var f = sr("importScene", o ? o.producer : "Unknown") + n; if (!r) throw rr.Tools.Log(f), e; r(f, e) } finally { null !== n && rr.SceneLoader.loggingLevel !== rr.SceneLoader.NO_LOGGING && rr.Tools.Log(sr("importScene", o ? o.producer : "Unknown") + (rr.SceneLoader.loggingLevel !== rr.SceneLoader.MINIMAL_LOGGING ? n : "")) } return !1 }, loadAssetContainer: function (e, t, i, r) { return ar(e, t, i, r) } }), lr = $a || ($a = {}), cr = function () { function e(e, t, i, r, n, o, s, a, l) { this.onProcessFileCallback = function () { return !0 }, this._engine = e, this._currentScene = t, this._sceneLoadedCallback = i, this._progressCallback = r, this._additionalRenderLoopLogicCallback = n, this._textureLoadingCallback = o, this._startingProcessingFilesCallback = s, this._onReloadCallback = a, this._errorCallback = l } return e.prototype.monitorElementForDragNDrop = function (e) { var t = this; e && (this._elementToMonitor = e, this._dragEnterHandler = function (e) { t.drag(e) }, this._dragOverHandler = function (e) { t.drag(e) }, this._dropHandler = function (e) { t.drop(e) }, this._elementToMonitor.addEventListener("dragenter", this._dragEnterHandler, !1), this._elementToMonitor.addEventListener("dragover", this._dragOverHandler, !1), this._elementToMonitor.addEventListener("drop", this._dropHandler, !1)) }, e.prototype.dispose = function () { this._elementToMonitor && (this._elementToMonitor.removeEventListener("dragenter", this._dragEnterHandler), this._elementToMonitor.removeEventListener("dragover", this._dragOverHandler), this._elementToMonitor.removeEventListener("drop", this._dropHandler)) }, e.prototype.renderFunction = function () { if (this._additionalRenderLoopLogicCallback && this._additionalRenderLoopLogicCallback(), this._currentScene) { if (this._textureLoadingCallback) { var e = this._currentScene.getWaitingItemsCount(); 0 < e && this._textureLoadingCallback(e) } this._currentScene.render() } }, e.prototype.drag = function (e) { e.stopPropagation(), e.preventDefault() }, e.prototype.drop = function (e) { e.stopPropagation(), e.preventDefault(), this.loadFiles(e) }, e.prototype._traverseFolder = function (e, t, i, r) { var n = this, o = e.createReader(), s = e.fullPath.replace(/^\//, "").replace(/(.+?)\/?$/, "$1/"); o.readEntries(function (e) { i.count += e.length; for (var o = 0, a = e; o < a.length; o++) { var l = a[o]; l.isFile ? l.file(function (e) { e.correctName = s + e.name, t.push(e), 0 == --i.count && r() }) : l.isDirectory && n._traverseFolder(l, t, i, r) } --i.count && r() }) }, e.prototype._processFiles = function (t) { for (var i = 0; i < t.length; i++) { var r = t[i].correctName.toLowerCase(), n = r.split(".").pop(); this.onProcessFileCallback(t[i], r, n) && ("babylon" !== n && "stl" !== n && "obj" !== n && "gltf" !== n && "glb" !== n || -1 !== r.indexOf(".binary.babylon") || -1 !== r.indexOf(".incremental.babylon") || (this._sceneFileToLoad = t[i]), e.FilesToLoad[r] = t[i]) } }, e.prototype.loadFiles = function (e) { var t = this; if (e && e.dataTransfer && e.dataTransfer.files && (this._filesToLoad = e.dataTransfer.files), e && e.target && e.target.files && (this._filesToLoad = e.target.files), this._filesToLoad && 0 !== this._filesToLoad.length && (this._startingProcessingFilesCallback && this._startingProcessingFilesCallback(this._filesToLoad), this._filesToLoad && 0 < this._filesToLoad.length)) { for (var i = new Array, r = [], n = e.dataTransfer ? e.dataTransfer.items : null, o = 0; o < this._filesToLoad.length; o++) { var s = this._filesToLoad[o], a = s.name.toLowerCase(), l = void 0; if (s.correctName = a, n) { var c = n[o]; c.getAsEntry ? l = c.getAsEntry() : c.webkitGetAsEntry && (l = c.webkitGetAsEntry()) } l && l.isDirectory ? r.push(l) : i.push(s) } if (0 === r.length) this._processFiles(i), this._processReload(); else for (var h = { count: r.length }, u = 0, d = r; u < d.length; u++) { var f = d[u]; this._traverseFolder(f, i, h, function () { t._processFiles(i), 0 === h.count && t._processReload() }) } } }, e.prototype._processReload = function () { this._onReloadCallback ? this._onReloadCallback(this._sceneFileToLoad) : this.reload() }, e.prototype.reload = function () { var e = this; this._sceneFileToLoad ? (this._currentScene && (0 < lr.Tools.errorsCount && lr.Tools.ClearLogCache(), this._engine.stopRenderLoop()), lr.SceneLoader.LoadAsync("file:", this._sceneFileToLoad.name, this._engine, function (t) { e._progressCallback && e._progressCallback(t) }).then(function (t) { e._currentScene && e._currentScene.dispose(), e._currentScene = t, e._sceneLoadedCallback && e._sceneLoadedCallback(e._sceneFileToLoad, e._currentScene), e._currentScene.executeWhenReady(function () { e._engine.runRenderLoop(function () { e.renderFunction() }) }) }).catch(function (t) { e._errorCallback && e._errorCallback(e._sceneFileToLoad, e._currentScene, t.message) })) : lr.Tools.Error("Please provide a valid .babylon file.") }, e.FilesToLoad = {}, e }(), lr.FilesInput = cr, hr = $a || ($a = {}), ur = function () { function e() { } return e.EnableFor = function (t) { t._tags = t._tags || {}, t.hasTags = function () { return e.HasTags(t) }, t.addTags = function (i) { return e.AddTagsTo(t, i) }, t.removeTags = function (i) { return e.RemoveTagsFrom(t, i) }, t.matchesTagsQuery = function (i) { return e.MatchesQuery(t, i) } }, e.DisableFor = function (e) { delete e._tags, delete e.hasTags, delete e.addTags, delete e.removeTags, delete e.matchesTagsQuery }, e.HasTags = function (e) { return !!e._tags && !hr.Tools.IsEmpty(e._tags) }, e.GetTags = function (e, t) { if (void 0 === t && (t = !0), !e._tags) return null; if (t) { var i = []; for (var r in e._tags) e._tags.hasOwnProperty(r) && !0 === e._tags[r] && i.push(r); return i.join(" ") } return e._tags }, e.AddTagsTo = function (t, i) { i && "string" == typeof i && i.split(" ").forEach(function (i, r, n) { e._AddTagTo(t, i) }) }, e._AddTagTo = function (t, i) { "" !== (i = i.trim()) && "true" !== i && "false" !== i && (i.match(/[\s]/) || i.match(/^([!]|([|]|[&]){2})/) || (e.EnableFor(t), t._tags[i] = !0)) }, e.RemoveTagsFrom = function (t, i) { if (e.HasTags(t)) { var r = i.split(" "); for (var n in r) e._RemoveTagFrom(t, r[n]) } }, e._RemoveTagFrom = function (e, t) { delete e._tags[t] }, e.MatchesQuery = function (t, i) { return void 0 === i || ("" === i ? e.HasTags(t) : hr.AndOrNotEvaluator.Eval(i, function (i) { return e.HasTags(t) && t._tags[i] })) }, e }(), hr.Tags = ur, dr = $a || ($a = {}), fr = function () { function e() { } return e.Eval = function (t, i) { return "true" === (t = t.match(/\([^\(\)]*\)/g) ? t.replace(/\([^\(\)]*\)/g, function (t) { return t = t.slice(1, t.length - 1), e._HandleParenthesisContent(t, i) }) : e._HandleParenthesisContent(t, i)) || "false" !== t && e.Eval(t, i) }, e._HandleParenthesisContent = function (t, i) { var r; i = i || function (e) { return "true" === e }; var n = t.split("||"); for (var o in n) if (n.hasOwnProperty(o)) { var s = e._SimplifyNegation(n[o].trim()), a = s.split("&&"); if (1 < a.length) for (var l = 0; l < a.length; ++l) { var c = e._SimplifyNegation(a[l].trim()); if (!(r = "true" !== c && "false" !== c ? "!" === c[0] ? !i(c.substring(1)) : i(c) : "true" === c)) { s = "false"; break } } if (r || "true" === s) { r = !0; break } r = "true" !== s && "false" !== s ? "!" === s[0] ? !i(s.substring(1)) : i(s) : "true" === s } return r ? "true" : "false" }, e._SimplifyNegation = function (e) { return "!true" === (e = (e = e.replace(/^[\s!]+/, function (e) { return (e = e.replace(/[\s]/g, function () { return "" })).length % 2 ? "!" : "" })).trim()) ? e = "false" : "!false" === e && (e = "true"), e }, e }(), dr.AndOrNotEvaluator = fr, pr = $a || ($a = {}), _r = function () { function e(t, i, r) { void 0 === r && (r = !1); var n = this; this.idbFactory = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB, this.callbackManifestChecked = i, this.currentSceneUrl = e._ReturnFullUrlLocation(t), this.db = null, this._enableSceneOffline = !1, this._enableTexturesOffline = !1, this.manifestVersionFound = 0, this.mustUpdateRessources = !1, this.hasReachedQuota = !1, e.IDBStorageEnabled ? r ? (this._enableSceneOffline = !0, this._enableTexturesOffline = !0, this.manifestVersionFound = 1, pr.Tools.SetImmediate(function () { n.callbackManifestChecked(!0) })) : this._checkManifestFile() : this.callbackManifestChecked(!0) } return Object.defineProperty(e.prototype, "enableSceneOffline", { get: function () { return this._enableSceneOffline }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "enableTexturesOffline", { get: function () { return this._enableTexturesOffline }, enumerable: !0, configurable: !0 }), e.prototype._checkManifestFile = function () { var e = this, t = function () { e._enableSceneOffline = !1, e._enableTexturesOffline = !1, e.callbackManifestChecked(!1) }, i = !1, r = this.currentSceneUrl + ".manifest", n = new XMLHttpRequest; navigator.onLine && (i = !0, r = r + (null == r.match(/\?/) ? "?" : "&") + Date.now()), n.open("GET", r, !0), n.addEventListener("load", function () { if (200 === n.status || pr.Tools.ValidateXHRData(n, 1)) try { var i = JSON.parse(n.response); e._enableSceneOffline = i.enableSceneOffline, e._enableTexturesOffline = i.enableTexturesOffline, i.version && !isNaN(parseInt(i.version)) && (e.manifestVersionFound = i.version), e.callbackManifestChecked && e.callbackManifestChecked(!0) } catch (i) { t() } else t() }, !1), n.addEventListener("error", function (r) { if (i) { i = !1; var o = e.currentSceneUrl + ".manifest"; n.open("GET", o, !0), n.send() } else t() }, !1); try { n.send() } catch (r) { pr.Tools.Error("Error on XHR send request."), this.callbackManifestChecked(!1) } }, e.prototype.openAsync = function (e, t) { var i = this, r = function () { i.isSupported = !1, t && t() }; if (this.idbFactory && (this._enableSceneOffline || this._enableTexturesOffline)) if (this.db) e && e(); else { this.hasReachedQuota = !1, this.isSupported = !0; var n = this.idbFactory.open("babylonjs", 1); n.onerror = function (e) { r() }, n.onblocked = function (e) { pr.Tools.Error("IDB request blocked. Please reload the page."), r() }, n.onsuccess = function (t) { i.db = n.result, e() }, n.onupgradeneeded = function (e) { if (i.db = e.target.result, i.db) try { i.db.createObjectStore("scenes", { keyPath: "sceneUrl" }), i.db.createObjectStore("versions", { keyPath: "sceneUrl" }), i.db.createObjectStore("textures", { keyPath: "textureUrl" }) } catch (e) { pr.Tools.Error("Error while creating object stores. Exception: " + e.message), r() } } } else this.isSupported = !1, t && t() }, e.prototype.loadImageFromDB = function (t, i) { var r = this, n = e._ReturnFullUrlLocation(t), o = function () { r.hasReachedQuota || null === r.db ? i.src = t : r._saveImageIntoDBAsync(n, i) }; this.mustUpdateRessources ? o() : this._loadImageFromDBAsync(n, i, o) }, e.prototype._loadImageFromDBAsync = function (e, t, i) { if (this.isSupported && null !== this.db) { var r, n = this.db.transaction(["textures"]); n.onabort = function (i) { t.src = e }, n.oncomplete = function (n) { var o; if (r) { var s = window.URL || window.webkitURL; o = s.createObjectURL(r.data), t.onerror = function () { pr.Tools.Error("Error loading image from blob URL: " + o + " switching back to web url: " + e), t.src = e }, t.src = o } else i() }; var o = n.objectStore("textures").get(e); o.onsuccess = function (e) { r = e.target.result }, o.onerror = function (i) { pr.Tools.Error("Error loading texture " + e + " from DB."), t.src = e } } else pr.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), t.src = e }, e.prototype._saveImageIntoDBAsync = function (t, i) { var r = this; if (this.isSupported) { var n = function () { var e; if (s) { var t = window.URL || window.webkitURL; try { e = t.createObjectURL(s) } catch (o) { e = t.createObjectURL(s) } } e && (i.src = e) }; if (e.IsUASupportingBlobStorage) { var s, a = new XMLHttpRequest; a.open("GET", t, !0), a.responseType = "blob", a.addEventListener("load", function () { if (200 === a.status && r.db) { s = a.response; var o = r.db.transaction(["textures"], "readwrite"); o.onabort = function (e) { try { var t = (e.srcElement || e.target).error; t && "QuotaExceededError" === t.name && (r.hasReachedQuota = !0) } catch (e) { } n() }, o.oncomplete = function (e) { n() }; var l = { textureUrl: t, data: s }; try { var c = o.objectStore("textures").put(l); c.onsuccess = function (e) { }, c.onerror = function (e) { n() } } catch (o) { 25 === o.code && (e.IsUASupportingBlobStorage = !1), i.src = t } } else i.src = t }, !1), a.addEventListener("error", function (e) { pr.Tools.Error("Error in XHR request in BABYLON.Database."), i.src = t }, !1), a.send() } else i.src = t } else pr.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), i.src = t }, e.prototype._checkVersionFromDB = function (e, t) { var i = this; this._loadVersionFromDBAsync(e, t, function () { i._saveVersionIntoDBAsync(e, t) }) }, e.prototype._loadVersionFromDBAsync = function (e, t, i) { var r, n = this; if (this.isSupported && this.db) try { var o = this.db.transaction(["versions"]); o.oncomplete = function (e) { r ? n.manifestVersionFound !== r.data ? (n.mustUpdateRessources = !0, i()) : t(r.data) : (n.mustUpdateRessources = !0, i()) }, o.onabort = function (e) { t(-1) }; var s = o.objectStore("versions").get(e); s.onsuccess = function (e) { r = e.target.result }, s.onerror = function (i) { pr.Tools.Error("Error loading version for scene " + e + " from DB."), t(-1) } } catch (o) { pr.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: " + o.message), t(-1) } else pr.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), t(-1) }, e.prototype._saveVersionIntoDBAsync = function (e, t) { var i = this; if (this.isSupported && !this.hasReachedQuota && this.db) try { var r = this.db.transaction(["versions"], "readwrite"); r.onabort = function (e) { try { var r = e.srcElement.error; r && "QuotaExceededError" === r.name && (i.hasReachedQuota = !0) } catch (e) { } t(-1) }, r.oncomplete = function (e) { t(i.manifestVersionFound) }; var n = { sceneUrl: e, data: this.manifestVersionFound }, o = r.objectStore("versions").put(n); o.onsuccess = function (e) { }, o.onerror = function (e) { pr.Tools.Error("Error in DB add version request in BABYLON.Database.") } } catch (e) { pr.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: " + e.message), t(-1) } else t(-1) }, e.prototype.loadFileFromDB = function (t, i, r, n, o) { var s = this, a = e._ReturnFullUrlLocation(t), l = function () { s._saveFileIntoDBAsync(a, i, r, o, n) }; this._checkVersionFromDB(a, function (e) { -1 !== e ? s.mustUpdateRessources ? s._saveFileIntoDBAsync(a, i, r, o, n) : s._loadFileFromDBAsync(a, i, l, o) : n && n() }) }, e.prototype._loadFileFromDBAsync = function (e, t, i, r) { if (this.isSupported && this.db) { var n, o; n = -1 !== e.indexOf(".babylon") ? "scenes" : "textures"; var s = this.db.transaction([n]); s.oncomplete = function (e) { o ? t(o.data) : i() }, s.onabort = function (e) { i() }; var a = s.objectStore(n).get(e); a.onsuccess = function (e) { o = e.target.result }, a.onerror = function (t) { pr.Tools.Error("Error loading file " + e + " from DB."), i() } } else pr.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), t() }, e.prototype._saveFileIntoDBAsync = function (e, t, i, r, n) { var o = this; if (this.isSupported) { var s; s = -1 !== e.indexOf(".babylon") ? "scenes" : "textures"; var a, l = new XMLHttpRequest; l.open("GET", e + "?" + Date.now(), !0), r && (l.responseType = "arraybuffer"), i && (l.onprogress = i), l.addEventListener("load", function () { if (200 === l.status || l.status < 400 && pr.Tools.ValidateXHRData(l, r ? 6 : 1)) if (a = r ? l.response : l.responseText, !o.hasReachedQuota && o.db) { var i, c = o.db.transaction([s], "readwrite"); c.onabort = function (e) { try { var i = e.srcElement.error; i && "QuotaExceededError" === i.name && (o.hasReachedQuota = !0) } catch (e) { } t(a) }, c.oncomplete = function (e) { t(a) }, i = "scenes" === s ? { sceneUrl: e, data: a, version: o.manifestVersionFound } : { textureUrl: e, data: a }; try { var h = c.objectStore(s).put(i); h.onsuccess = function (e) { }, h.onerror = function (e) { pr.Tools.Error("Error in DB add file request in BABYLON.Database.") } } catch (i) { t(a) } } else t(a); else 400 <= l.status && n ? n(l) : t() }, !1), l.addEventListener("error", function (e) { pr.Tools.Error("error on XHR request."), t() }, !1), l.send() } else pr.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), t() }, e.IsUASupportingBlobStorage = !0, e.IDBStorageEnabled = !0, e._ParseURL = function (e) { var t = (document.createElement("a").href = e).substring(0, e.lastIndexOf("#")), i = e.substring(t.lastIndexOf("/") + 1, e.length); return e.substring(0, e.indexOf(i, 0)) }, e._ReturnFullUrlLocation = function (t) { return -1 === t.indexOf("http:/") && -1 === t.indexOf("https:/") ? e._ParseURL(window.location.href) + t : t }, e }(), pr.Database = _r, mr = $a || ($a = {}), gr = function () { function e() { this._isEnabled = !0, this.leftColor = mr.Color3.White(), this.rightColor = mr.Color3.Black(), this.bias = 0, this.power = 1 } return Object.defineProperty(e.prototype, "isEnabled", { get: function () { return this._isEnabled }, set: function (e) { this._isEnabled !== e && (this._isEnabled = e, mr.Engine.MarkAllMaterialsAsDirty(mr.Material.FresnelDirtyFlag | mr.Material.MiscDirtyFlag)) }, enumerable: !0, configurable: !0 }), e.prototype.clone = function () { var t = new e; return mr.Tools.DeepCopy(this, t), t }, e.prototype.serialize = function () { var e = {}; return e.isEnabled = this.isEnabled, e.leftColor = this.leftColor.asArray(), e.rightColor = this.rightColor.asArray(), e.bias = this.bias, e.power = this.power, e }, e.Parse = function (t) { var i = new e; return i.isEnabled = t.isEnabled, i.leftColor = mr.Color3.FromArray(t.leftColor), i.rightColor = mr.Color3.FromArray(t.rightColor), i.bias = t.bias, i.power = t.power || 1, i }, e }(), mr.FresnelParameters = gr, yr = function (e) { function t(t, i) { var r = e.call(this, t, i, !0) || this; return i.multiMaterials.push(r), r.subMaterials = new Array, r.storeEffectOnSubMeshes = !0, r } return T(t, e), Object.defineProperty(t.prototype, "subMaterials", { get: function () { return this._subMaterials }, set: function (e) { this._subMaterials = e, this._hookArray(e) }, enumerable: !0, configurable: !0 }), t.prototype._hookArray = function (e) { var t = this, i = e.push; e.push = function () { for (var r = [], n = 0; n < arguments.length; n++)r[n] = arguments[n]; var o = i.apply(e, r); return t._markAllSubMeshesAsTexturesDirty(), o }; var r = e.splice; e.splice = function (i, n) { var o = r.apply(e, [i, n]); return t._markAllSubMeshesAsTexturesDirty(), o } }, t.prototype.getSubMaterial = function (e) { return e < 0 || e >= this.subMaterials.length ? this.getScene().defaultMaterial : this.subMaterials[e] }, t.prototype.getActiveTextures = function () { var t; return (t = e.prototype.getActiveTextures.call(this)).concat.apply(t, this.subMaterials.map(function (e) { return e ? e.getActiveTextures() : [] })) }, t.prototype.getClassName = function () { return "MultiMaterial" }, t.prototype.isReadyForSubMesh = function (e, t, i) { for (var r = 0; r < this.subMaterials.length; r++) { var n = this.subMaterials[r]; if (n) { if (n.storeEffectOnSubMeshes) { if (!n.isReadyForSubMesh(e, t, i)) return !1; continue } if (!n.isReady(e)) return !1 } } return !0 }, t.prototype.clone = function (e, i) { for (var r = new t(e, this.getScene()), n = 0; n < this.subMaterials.length; n++) { var o, s = this.subMaterials[n]; o = i && s ? s.clone(e + "-" + s.name) : this.subMaterials[n], r.subMaterials.push(o) } return r }, t.prototype.serialize = function () { var e = {}; e.name = this.name, e.id = this.id, vr.Tags && (e.tags = vr.Tags.GetTags(this)), e.materials = []; for (var t = 0; t < this.subMaterials.length; t++) { var i = this.subMaterials[t]; i ? e.materials.push(i.id) : e.materials.push(null) } return e }, t.prototype.dispose = function (t, i) { var r = this.getScene(); if (r) { var n = r.multiMaterials.indexOf(this); 0 <= n && r.multiMaterials.splice(n, 1), e.prototype.dispose.call(this, t, i) } }, t }((vr = $a || ($a = {})).Material), vr.MultiMaterial = yr, br = $a || ($a = {}), Tr = function () { function e() { this.touchAngularSensibility = 2e5, this.touchMoveSensibility = 250, this._offsetX = null, this._offsetY = null, this._pointerPressed = new Array } return e.prototype.attachControl = function (e, t) { var i = this, r = null; void 0 === this._pointerInput && (this._onLostFocus = function (e) { i._offsetX = null, i._offsetY = null }, this._pointerInput = function (e, n) { var o = e.event; if ("mouse" !== o.pointerType) if (e.type === br.PointerEventTypes.POINTERDOWN) { if (t || o.preventDefault(), i._pointerPressed.push(o.pointerId), 1 !== i._pointerPressed.length) return; r = { x: o.clientX, y: o.clientY } } else if (e.type === br.PointerEventTypes.POINTERUP) { if (t || o.preventDefault(), -1 === (s = i._pointerPressed.indexOf(o.pointerId))) return; if (i._pointerPressed.splice(s, 1), 0 != s) return; r = null, i._offsetX = null, i._offsetY = null } else if (e.type === br.PointerEventTypes.POINTERMOVE) { if (t || o.preventDefault(), !r) return; var s; if (0 != (s = i._pointerPressed.indexOf(o.pointerId))) return; i._offsetX = o.clientX - r.x, i._offsetY = -(o.clientY - r.y) } }), this._observer = this.camera.getScene().onPointerObservable.add(this._pointerInput, br.PointerEventTypes.POINTERDOWN | br.PointerEventTypes.POINTERUP | br.PointerEventTypes.POINTERMOVE), this._onLostFocus && e.addEventListener("blur", this._onLostFocus) }, e.prototype.detachControl = function (e) { this._pointerInput && e && (this._observer && (this.camera.getScene().onPointerObservable.remove(this._observer), this._observer = null), this._onLostFocus && (e.removeEventListener("blur", this._onLostFocus), this._onLostFocus = null), this._pointerPressed = [], this._offsetX = null, this._offsetY = null) }, e.prototype.checkInputs = function () { if (this._offsetX && this._offsetY) { var e = this.camera; if (e.cameraRotation.y += this._offsetX / this.touchAngularSensibility, 1 < this._pointerPressed.length) e.cameraRotation.x += -this._offsetY / this.touchAngularSensibility; else { var t = e._computeLocalCameraSpeed(), i = new br.Vector3(0, 0, t * this._offsetY / this.touchMoveSensibility); br.Matrix.RotationYawPitchRollToRef(e.rotation.y, e.rotation.x, 0, e._cameraRotationMatrix), e.cameraDirection.addInPlace(br.Vector3.TransformCoordinates(i, e._cameraRotationMatrix)) } } }, e.prototype.getClassName = function () { return "FreeCameraTouchInput" }, e.prototype.getSimpleName = function () { return "touch" }, b([br.serialize()], e.prototype, "touchAngularSensibility", void 0), b([br.serialize()], e.prototype, "touchMoveSensibility", void 0), e }(), br.FreeCameraTouchInput = Tr, br.CameraInputTypes.FreeCameraTouchInput = Tr, function (e) { e.Node.AddNodeConstructor("TouchCamera", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (e) { function t(t, i, r) { var n = e.call(this, t, i, r) || this; return n.inputs.addTouch(), n._setupInputs(), n } return T(t, e), Object.defineProperty(t.prototype, "touchAngularSensibility", { get: function () { var e = this.inputs.attached.touch; return e ? e.touchAngularSensibility : 0 }, set: function (e) { var t = this.inputs.attached.touch; t && (t.touchAngularSensibility = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "touchMoveSensibility", { get: function () { var e = this.inputs.attached.touch; return e ? e.touchMoveSensibility : 0 }, set: function (e) { var t = this.inputs.attached.touch; t && (t.touchMoveSensibility = e) }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "TouchCamera" }, t.prototype._setupInputs = function () { var e = this.inputs.attached.mouse; e && (e.touchEnabled = !1) }, t }(e.FreeCamera); e.TouchCamera = t }($a || ($a = {})), xr = function (e) { function t(t, i, r, n, o, s, a) { void 0 === o && (o = null), void 0 === s && (s = !0), void 0 === a && (a = !1); var l = e.call(this, null, n, !s) || this; l.isCube = a, l.isEnabled = !0, l.autoClear = !0, l.onGeneratedObservable = new Er.Observable, l._textures = {}, l._currentRefreshId = -1, l._refreshRate = 1, l._vertexBuffers = {}, l._uniforms = new Array, l._samplers = new Array, l._floats = {}, l._ints = {}, l._floatsArrays = {}, l._colors3 = {}, l._colors4 = {}, l._vectors2 = {}, l._vectors3 = {}, l._matrices = {}, l._fallbackTextureUsed = !1, l._cachedDefines = "", l._contentUpdateId = -1; var c = (n = l.getScene())._getComponent(Er.SceneComponentConstants.NAME_PROCEDURALTEXTURE); c || (c = new Er.ProceduralTextureSceneComponent(n), n._addComponent(c)), n.proceduralTextures.push(l), l._engine = n.getEngine(), l.name = t, l.isRenderTarget = !0, l._size = i, l._generateMipMaps = s, l.setFragment(r), l._fallbackTexture = o, a ? (l._texture = l._engine.createRenderTargetCubeTexture(i, { generateMipMaps: s, generateDepthBuffer: !1, generateStencilBuffer: !1 }), l.setFloat("face", 0)) : l._texture = l._engine.createRenderTargetTexture(i, { generateMipMaps: s, generateDepthBuffer: !1, generateStencilBuffer: !1 }); var h = []; return h.push(1, 1), h.push(-1, 1), h.push(-1, -1), h.push(1, -1), l._vertexBuffers[Er.VertexBuffer.PositionKind] = new Er.VertexBuffer(l._engine, h, Er.VertexBuffer.PositionKind, !1, !1, 2), l._createIndexBuffer(), l } return T(t, e), t.prototype.getContent = function () { return this._contentData && this._currentRefreshId == this._contentUpdateId || (this._contentData = this.readPixels(0, 0, this._contentData), this._contentUpdateId = this._currentRefreshId), this._contentData }, t.prototype._createIndexBuffer = function () { var e = this._engine, t = []; t.push(0), t.push(1), t.push(2), t.push(0), t.push(2), t.push(3), this._indexBuffer = e.createIndexBuffer(t) }, t.prototype._rebuild = function () { var e = this._vertexBuffers[Er.VertexBuffer.PositionKind]; e && e._rebuild(), this._createIndexBuffer(), this.refreshRate === Er.RenderTargetTexture.REFRESHRATE_RENDER_ONCE && (this.refreshRate = Er.RenderTargetTexture.REFRESHRATE_RENDER_ONCE) }, t.prototype.reset = function () { void 0 !== this._effect && this._engine._releaseEffect(this._effect) }, t.prototype._getDefines = function () { return "" }, t.prototype.isReady = function () { var e, t = this, i = this._engine; if (!this._fragment) return !1; if (this._fallbackTextureUsed) return !0; var r = this._getDefines(); return !(!this._effect || r !== this._cachedDefines || !this._effect.isReady()) || (e = void 0 !== this._fragment.fragmentElement ? { vertex: "procedural", fragmentElement: this._fragment.fragmentElement } : { vertex: "procedural", fragment: this._fragment }, this._cachedDefines = r, this._effect = i.createEffect(e, [Er.VertexBuffer.PositionKind], this._uniforms, this._samplers, r, void 0, void 0, function () { t.releaseInternalTexture(), t._fallbackTexture && (t._texture = t._fallbackTexture._texture, t._texture && t._texture.incrementReferences()), t._fallbackTextureUsed = !0 }), this._effect.isReady()) }, t.prototype.resetRefreshCounter = function () { this._currentRefreshId = -1 }, t.prototype.setFragment = function (e) { this._fragment = e }, Object.defineProperty(t.prototype, "refreshRate", { get: function () { return this._refreshRate }, set: function (e) { this._refreshRate = e, this.resetRefreshCounter() }, enumerable: !0, configurable: !0 }), t.prototype._shouldRender = function () { return this.isEnabled && this.isReady() && this._texture ? !(this._fallbackTextureUsed || (-1 === this._currentRefreshId ? (this._currentRefreshId = 1, 0) : this.refreshRate === this._currentRefreshId ? (this._currentRefreshId = 1, 0) : (this._currentRefreshId++ , 1))) : (this._texture && (this._texture.isReady = !1), !1) }, t.prototype.getRenderSize = function () { return this._size }, t.prototype.resize = function (e, t) { this._fallbackTextureUsed || (this.releaseInternalTexture(), this._texture = this._engine.createRenderTargetTexture(e, t), this._size = e, this._generateMipMaps = t) }, t.prototype._checkUniform = function (e) { -1 === this._uniforms.indexOf(e) && this._uniforms.push(e) }, t.prototype.setTexture = function (e, t) { return -1 === this._samplers.indexOf(e) && this._samplers.push(e), this._textures[e] = t, this }, t.prototype.setFloat = function (e, t) { return this._checkUniform(e), this._floats[e] = t, this }, t.prototype.setInt = function (e, t) { return this._checkUniform(e), this._ints[e] = t, this }, t.prototype.setFloats = function (e, t) { return this._checkUniform(e), this._floatsArrays[e] = t, this }, t.prototype.setColor3 = function (e, t) { return this._checkUniform(e), this._colors3[e] = t, this }, t.prototype.setColor4 = function (e, t) { return this._checkUniform(e), this._colors4[e] = t, this }, t.prototype.setVector2 = function (e, t) { return this._checkUniform(e), this._vectors2[e] = t, this }, t.prototype.setVector3 = function (e, t) { return this._checkUniform(e), this._vectors3[e] = t, this }, t.prototype.setMatrix = function (e, t) { return this._checkUniform(e), this._matrices[e] = t, this }, t.prototype.render = function (e) { var t = this.getScene(); if (t) { var i = this._engine; for (var r in i.enableEffect(this._effect), i.setState(!1), this._textures) this._effect.setTexture(r, this._textures[r]); for (r in this._ints) this._effect.setInt(r, this._ints[r]); for (r in this._floats) this._effect.setFloat(r, this._floats[r]); for (r in this._floatsArrays) this._effect.setArray(r, this._floatsArrays[r]); for (r in this._colors3) this._effect.setColor3(r, this._colors3[r]); for (r in this._colors4) { var n = this._colors4[r]; this._effect.setFloat4(r, n.r, n.g, n.b, n.a) } for (r in this._vectors2) this._effect.setVector2(r, this._vectors2[r]); for (r in this._vectors3) this._effect.setVector3(r, this._vectors3[r]); for (r in this._matrices) this._effect.setMatrix(r, this._matrices[r]); if (this._texture) { if (this.isCube) for (var o = 0; o < 6; o++)i.bindFramebuffer(this._texture, o, void 0, void 0, !0), i.bindBuffers(this._vertexBuffers, this._indexBuffer, this._effect), this._effect.setFloat("face", o), this.autoClear && i.clear(t.clearColor, !0, !1, !1), i.drawElementsType(Er.Material.TriangleFillMode, 0, 6), 5 === o && i.generateMipMapsForCubemap(this._texture); else i.bindFramebuffer(this._texture, 0, void 0, void 0, !0), i.bindBuffers(this._vertexBuffers, this._indexBuffer, this._effect), this.autoClear && i.clear(t.clearColor, !0, !1, !1), i.drawElementsType(Er.Material.TriangleFillMode, 0, 6); i.unBindFramebuffer(this._texture, this.isCube), this.onGenerated && this.onGenerated(), this.onGeneratedObservable.notifyObservers(this) } } }, t.prototype.clone = function () { var e = this.getSize(), i = new t(this.name, e.width, this._fragment, this.getScene(), this._fallbackTexture, this._generateMipMaps); return i.hasAlpha = this.hasAlpha, i.level = this.level, i.coordinatesMode = this.coordinatesMode, i }, t.prototype.dispose = function () { var t = this.getScene(); if (t) { var i = t.proceduralTextures.indexOf(this); 0 <= i && t.proceduralTextures.splice(i, 1); var r = this._vertexBuffers[Er.VertexBuffer.PositionKind]; r && (r.dispose(), this._vertexBuffers[Er.VertexBuffer.PositionKind] = null), this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer) && (this._indexBuffer = null), e.prototype.dispose.call(this) } }, b([Er.serialize()], t.prototype, "isEnabled", void 0), b([Er.serialize()], t.prototype, "autoClear", void 0), b([Er.serialize()], t.prototype, "_generateMipMaps", void 0), b([Er.serialize()], t.prototype, "_size", void 0), b([Er.serialize()], t.prototype, "refreshRate", null), t }((Er = $a || ($a = {})).Texture), Er.ProceduralTexture = xr, Pr = $a || ($a = {}), Ar = function () { function e(e) { this.name = Pr.SceneComponentConstants.NAME_PROCEDURALTEXTURE, this.scene = e, this.scene.proceduralTextures = new Array, e.layers = new Array } return e.prototype.register = function () { this.scene._beforeClearStage.registerStep(Pr.SceneComponentConstants.STEP_BEFORECLEAR_PROCEDURALTEXTURE, this, this._beforeClear) }, e.prototype.rebuild = function () { }, e.prototype.dispose = function () { }, e.prototype._beforeClear = function () { if (this.scene.proceduralTexturesEnabled) { Pr.Tools.StartPerformanceCounter("Procedural textures", 0 < this.scene.proceduralTextures.length); for (var e = 0; e < this.scene.proceduralTextures.length; e++) { var t = this.scene.proceduralTextures[e]; t._shouldRender() && t.render() } Pr.Tools.EndPerformanceCounter("Procedural textures", 0 < this.scene.proceduralTextures.length) } }, e }(), Pr.ProceduralTextureSceneComponent = Ar, Mr = function (e) { function t(t, i, r, n, o, s) { var a = e.call(this, t, r, null, n, o, s) || this; return a._animate = !0, a._time = 0, a._texturePath = i, a._loadJson(i), a.refreshRate = 1, a } return T(t, e), t.prototype._loadJson = function (e) { var t = this, i = function () { Sr.Tools.Log("No config file found in " + e + " trying to use ShadersStore or DOM element"); try { t.setFragment(t._texturePath) } catch (e) { Sr.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture") } }, r = e + "/config.json", n = new XMLHttpRequest; n.open("GET", r, !0), n.addEventListener("load", function () { if (200 === n.status || Sr.Tools.ValidateXHRData(n, 1)) try { t._config = JSON.parse(n.response), t.updateShaderUniforms(), t.updateTextures(), t.setFragment(t._texturePath + "/custom"), t._animate = t._config.animate, t.refreshRate = t._config.refreshrate } catch (e) { i() } else i() }, !1), n.addEventListener("error", function () { i() }, !1); try { n.send() } catch (e) { Sr.Tools.Error("CustomProceduralTexture: Error on XHR send request.") } }, t.prototype.isReady = function () { if (!e.prototype.isReady.call(this)) return !1; for (var t in this._textures) if (!this._textures[t].isReady()) return !1; return !0 }, t.prototype.render = function (t) { var i = this.getScene(); this._animate && i && (this._time += .03 * i.getAnimationRatio(), this.updateShaderUniforms()), e.prototype.render.call(this, t) }, t.prototype.updateTextures = function () { for (var e = 0; e < this._config.sampler2Ds.length; e++)this.setTexture(this._config.sampler2Ds[e].sample2Dname, new Sr.Texture(this._texturePath + "/" + this._config.sampler2Ds[e].textureRelativeUrl, this.getScene())) }, t.prototype.updateShaderUniforms = function () { if (this._config) for (var e = 0; e < this._config.uniforms.length; e++) { var t = this._config.uniforms[e]; switch (t.type) { case "float": this.setFloat(t.name, t.value); break; case "color3": this.setColor3(t.name, new Sr.Color3(t.r, t.g, t.b)); break; case "color4": this.setColor4(t.name, new Sr.Color4(t.r, t.g, t.b, t.a)); break; case "vector2": this.setVector2(t.name, new Sr.Vector2(t.x, t.y)); break; case "vector3": this.setVector3(t.name, new Sr.Vector3(t.x, t.y, t.z)) } } this.setFloat("time", this._time) }, Object.defineProperty(t.prototype, "animate", { get: function () { return this._animate }, set: function (e) { this._animate = e }, enumerable: !0, configurable: !0 }), t }((Sr = $a || ($a = {})).ProceduralTexture), Sr.CustomProceduralTexture = Mr, Rr = $a || ($a = {}), Cr = function () { function e() { this.gamepadAngularSensibility = 200, this.gamepadMoveSensibility = 40, this._cameraTransform = Rr.Matrix.Identity(), this._deltaTransform = Rr.Vector3.Zero(), this._vector3 = Rr.Vector3.Zero(), this._vector2 = Rr.Vector2.Zero() } return e.prototype.attachControl = function (e, t) { var i = this, r = this.camera.getScene().gamepadManager; this._onGamepadConnectedObserver = r.onGamepadConnectedObservable.add(function (e) { e.type !== Rr.Gamepad.POSE_ENABLED && (i.gamepad && e.type !== Rr.Gamepad.XBOX || (i.gamepad = e)) }), this._onGamepadDisconnectedObserver = r.onGamepadDisconnectedObservable.add(function (e) { i.gamepad === e && (i.gamepad = null) }), this.gamepad = r.getGamepadByType(Rr.Gamepad.XBOX) }, e.prototype.detachControl = function (e) { this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver), this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver), this.gamepad = null }, e.prototype.checkInputs = function () { if (this.gamepad && this.gamepad.leftStick) { var e = this.camera, t = this.gamepad.leftStick, i = t.x / this.gamepadMoveSensibility, r = t.y / this.gamepadMoveSensibility; t.x = .005 < Math.abs(i) ? 0 + i : 0, t.y = .005 < Math.abs(r) ? 0 + r : 0; var n = this.gamepad.rightStick; if (n) { var o = n.x / this.gamepadAngularSensibility, s = n.y / this.gamepadAngularSensibility; n.x = .001 < Math.abs(o) ? 0 + o : 0, n.y = .001 < Math.abs(s) ? 0 + s : 0 } else n = { x: 0, y: 0 }; e.rotationQuaternion ? e.rotationQuaternion.toRotationMatrix(this._cameraTransform) : Rr.Matrix.RotationYawPitchRollToRef(e.rotation.y, e.rotation.x, 0, this._cameraTransform); var a = 50 * e._computeLocalCameraSpeed(); this._vector3.copyFromFloats(t.x * a, 0, -t.y * a), Rr.Vector3.TransformCoordinatesToRef(this._vector3, this._cameraTransform, this._deltaTransform), e.cameraDirection.addInPlace(this._deltaTransform), this._vector2.copyFromFloats(n.y, n.x), e.cameraRotation.addInPlace(this._vector2) } }, e.prototype.getClassName = function () { return "FreeCameraGamepadInput" }, e.prototype.getSimpleName = function () { return "gamepad" }, b([Rr.serialize()], e.prototype, "gamepadAngularSensibility", void 0), b([Rr.serialize()], e.prototype, "gamepadMoveSensibility", void 0), e }(), Rr.FreeCameraGamepadInput = Cr, Rr.CameraInputTypes.FreeCameraGamepadInput = Cr, Or = $a || ($a = {}), Dr = function () { function e() { this.gamepadRotationSensibility = 80, this.gamepadMoveSensibility = 40 } return e.prototype.attachControl = function (e, t) { var i = this, r = this.camera.getScene().gamepadManager; this._onGamepadConnectedObserver = r.onGamepadConnectedObservable.add(function (e) { e.type !== Or.Gamepad.POSE_ENABLED && (i.gamepad && e.type !== Or.Gamepad.XBOX || (i.gamepad = e)) }), this._onGamepadDisconnectedObserver = r.onGamepadDisconnectedObservable.add(function (e) { i.gamepad === e && (i.gamepad = null) }), this.gamepad = r.getGamepadByType(Or.Gamepad.XBOX) }, e.prototype.detachControl = function (e) { this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver), this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver), this.gamepad = null }, e.prototype.checkInputs = function () { if (this.gamepad) { var e = this.camera, t = this.gamepad.rightStick; if (t) { if (0 != t.x) { var i = t.x / this.gamepadRotationSensibility; 0 != i && .005 < Math.abs(i) && (e.inertialAlphaOffset += i) } if (0 != t.y) { var r = t.y / this.gamepadRotationSensibility; 0 != r && .005 < Math.abs(r) && (e.inertialBetaOffset += r) } } var n = this.gamepad.leftStick; if (n && 0 != n.y) { var o = n.y / this.gamepadMoveSensibility; 0 != o && .005 < Math.abs(o) && (this.camera.inertialRadiusOffset -= o) } } }, e.prototype.getClassName = function () { return "ArcRotateCameraGamepadInput" }, e.prototype.getSimpleName = function () { return "gamepad" }, b([Or.serialize()], e.prototype, "gamepadRotationSensibility", void 0), b([Or.serialize()], e.prototype, "gamepadMoveSensibility", void 0), e }(), Or.ArcRotateCameraGamepadInput = Dr, Or.CameraInputTypes.ArcRotateCameraGamepadInput = Dr, Ir = $a || ($a = {}), wr = function () { function e(e) { var t = this; this._scene = e, this._babylonGamepads = [], this._oneGamepadConnected = !1, this._isMonitoring = !1, this.onGamepadDisconnectedObservable = new Ir.Observable, Ir.Tools.IsWindowObjectExist() ? (this._gamepadEventSupported = "GamepadEvent" in window, this._gamepadSupport = navigator.getGamepads || navigator.webkitGetGamepads || navigator.msGetGamepads || navigator.webkitGamepads) : this._gamepadEventSupported = !1, this.onGamepadConnectedObservable = new Ir.Observable(function (e) { for (var i in t._babylonGamepads) { var r = t._babylonGamepads[i]; r && r._isConnected && t.onGamepadConnectedObservable.notifyObserver(e, r) } }), this._onGamepadConnectedEvent = function (e) { var i, r = e.gamepad; r.index in t._babylonGamepads && t._babylonGamepads[r.index].isConnected || (t._babylonGamepads[r.index] ? ((i = t._babylonGamepads[r.index]).browserGamepad = r, i._isConnected = !0) : i = t._addNewGamepad(r), t.onGamepadConnectedObservable.notifyObservers(i), t._startMonitoringGamepads()) }, this._onGamepadDisconnectedEvent = function (e) { var i = e.gamepad; for (var r in t._babylonGamepads) if (t._babylonGamepads[r].index === i.index) { var n = t._babylonGamepads[r]; n._isConnected = !1, t.onGamepadDisconnectedObservable.notifyObservers(n); break } }, this._gamepadSupport && (this._updateGamepadObjects(), this._babylonGamepads.length && this._startMonitoringGamepads(), this._gamepadEventSupported ? (window.addEventListener("gamepadconnected", this._onGamepadConnectedEvent, !1), window.addEventListener("gamepaddisconnected", this._onGamepadDisconnectedEvent, !1)) : this._startMonitoringGamepads()) } return Object.defineProperty(e.prototype, "gamepads", { get: function () { return this._babylonGamepads }, enumerable: !0, configurable: !0 }), e.prototype.getGamepadByType = function (e) { void 0 === e && (e = Ir.Gamepad.XBOX); for (var t = 0, i = this._babylonGamepads; t < i.length; t++) { var r = i[t]; if (r && r.type === e) return r } return null }, e.prototype.dispose = function () { this._gamepadEventSupported && (this._onGamepadConnectedEvent && window.removeEventListener("gamepadconnected", this._onGamepadConnectedEvent), this._onGamepadDisconnectedEvent && window.removeEventListener("gamepaddisconnected", this._onGamepadDisconnectedEvent), this._onGamepadConnectedEvent = null, this._onGamepadDisconnectedEvent = null), this._babylonGamepads.forEach(function (e) { e.dispose() }), this.onGamepadConnectedObservable.clear(), this.onGamepadDisconnectedObservable.clear(), this._oneGamepadConnected = !1, this._stopMonitoringGamepads(), this._babylonGamepads = [] }, e.prototype._addNewGamepad = function (e) { var t; this._oneGamepadConnected || (this._oneGamepadConnected = !0); var i = -1 !== e.id.search("Xbox One"); return t = i || -1 !== e.id.search("Xbox 360") || -1 !== e.id.search("xinput") ? new Ir.Xbox360Pad(e.id, e.index, e, i) : e.pose ? Ir.PoseEnabledControllerHelper.InitiateController(e) : new Ir.GenericPad(e.id, e.index, e), this._babylonGamepads[t.index] = t }, e.prototype._startMonitoringGamepads = function () { this._isMonitoring || (this._isMonitoring = !0, this._scene || this._checkGamepadsStatus()) }, e.prototype._stopMonitoringGamepads = function () { this._isMonitoring = !1 }, e.prototype._checkGamepadsStatus = function () { var e = this; for (var t in this._updateGamepadObjects(), this._babylonGamepads) { var i = this._babylonGamepads[t]; i && i.isConnected && i.update() } this._isMonitoring && !this._scene && Ir.Tools.QueueNewFrame(function () { e._checkGamepadsStatus() }) }, e.prototype._updateGamepadObjects = function () { for (var e = navigator.getGamepads ? navigator.getGamepads() : navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : [], t = 0; t < e.length; t++) { var i = e[t]; if (i) if (this._babylonGamepads[i.index]) this._babylonGamepads[t].browserGamepad = i, this._babylonGamepads[t].isConnected || (this._babylonGamepads[t]._isConnected = !0, this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t])); else { var r = this._addNewGamepad(i); this.onGamepadConnectedObservable.notifyObservers(r) } } }, e }(), Ir.GamepadManager = wr, function (e) { e.StickValues = function (e, t) { this.x = e, this.y = t }; var t = function () { function e(t, i, r, n, o, s, a) { void 0 === n && (n = 0), void 0 === o && (o = 1), void 0 === s && (s = 2), void 0 === a && (a = 3), this.id = t, this.index = i, this.browserGamepad = r, this._leftStick = { x: 0, y: 0 }, this._rightStick = { x: 0, y: 0 }, this._isConnected = !0, this._invertLeftStickY = !1, this.type = e.GAMEPAD, this._leftStickAxisX = n, this._leftStickAxisY = o, this._rightStickAxisX = s, this._rightStickAxisY = a, 2 <= this.browserGamepad.axes.length && (this._leftStick = { x: this.browserGamepad.axes[this._leftStickAxisX], y: this.browserGamepad.axes[this._leftStickAxisY] }), 4 <= this.browserGamepad.axes.length && (this._rightStick = { x: this.browserGamepad.axes[this._rightStickAxisX], y: this.browserGamepad.axes[this._rightStickAxisY] }) } return Object.defineProperty(e.prototype, "isConnected", { get: function () { return this._isConnected }, enumerable: !0, configurable: !0 }), e.prototype.onleftstickchanged = function (e) { this._onleftstickchanged = e }, e.prototype.onrightstickchanged = function (e) { this._onrightstickchanged = e }, Object.defineProperty(e.prototype, "leftStick", { get: function () { return this._leftStick }, set: function (e) { !this._onleftstickchanged || this._leftStick.x === e.x && this._leftStick.y === e.y || this._onleftstickchanged(e), this._leftStick = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "rightStick", { get: function () { return this._rightStick }, set: function (e) { !this._onrightstickchanged || this._rightStick.x === e.x && this._rightStick.y === e.y || this._onrightstickchanged(e), this._rightStick = e }, enumerable: !0, configurable: !0 }), e.prototype.update = function () { this._leftStick && (this.leftStick = { x: this.browserGamepad.axes[this._leftStickAxisX], y: this.browserGamepad.axes[this._leftStickAxisY] }, this._invertLeftStickY && (this.leftStick.y *= -1)), this._rightStick && (this.rightStick = { x: this.browserGamepad.axes[this._rightStickAxisX], y: this.browserGamepad.axes[this._rightStickAxisY] }) }, e.prototype.dispose = function () { }, e.GAMEPAD = 0, e.GENERIC = 1, e.XBOX = 2, e.POSE_ENABLED = 3, e }(), i = function (i) { function r(r, n, o) { var s = i.call(this, r, n, o) || this; return s.onButtonDownObservable = new e.Observable, s.onButtonUpObservable = new e.Observable, s.type = t.GENERIC, s._buttons = new Array(o.buttons.length), s } return T(r, i), r.prototype.onbuttondown = function (e) { this._onbuttondown = e }, r.prototype.onbuttonup = function (e) { this._onbuttonup = e }, r.prototype._setButtonValue = function (e, t, i) { return e !== t && (1 === e && (this._onbuttondown && this._onbuttondown(i), this.onButtonDownObservable.notifyObservers(i)), 0 === e && (this._onbuttonup && this._onbuttonup(i), this.onButtonUpObservable.notifyObservers(i))), e }, r.prototype.update = function () { i.prototype.update.call(this); for (var e = 0; e < this._buttons.length; e++)this._buttons[e] = this._setButtonValue(this.browserGamepad.buttons[e].value, this._buttons[e], e) }, r.prototype.dispose = function () { i.prototype.dispose.call(this), this.onButtonDownObservable.clear(), this.onButtonUpObservable.clear() }, r }(e.Gamepad = t); e.GenericPad = i }($a || ($a = {})), function (e) { var t, i, r, n; (i = t = e.Xbox360Button || (e.Xbox360Button = {}))[i.A = 0] = "A", i[i.B = 1] = "B", i[i.X = 2] = "X", i[i.Y = 3] = "Y", i[i.Start = 4] = "Start", i[i.Back = 5] = "Back", i[i.LB = 6] = "LB", i[i.RB = 7] = "RB", i[i.LeftStick = 8] = "LeftStick", i[i.RightStick = 9] = "RightStick", (n = r = e.Xbox360Dpad || (e.Xbox360Dpad = {}))[n.Up = 0] = "Up", n[n.Down = 1] = "Down", n[n.Left = 2] = "Left", n[n.Right = 3] = "Right"; var o = function (i) { function n(t, r, n, o) { void 0 === o && (o = !1); var s = i.call(this, t, r, n, 0, 1, 2, 3) || this; return s._leftTrigger = 0, s._rightTrigger = 0, s.onButtonDownObservable = new e.Observable, s.onButtonUpObservable = new e.Observable, s.onPadDownObservable = new e.Observable, s.onPadUpObservable = new e.Observable, s._buttonA = 0, s._buttonB = 0, s._buttonX = 0, s._buttonY = 0, s._buttonBack = 0, s._buttonStart = 0, s._buttonLB = 0, s._buttonRB = 0, s._buttonLeftStick = 0, s._buttonRightStick = 0, s._dPadUp = 0, s._dPadDown = 0, s._dPadLeft = 0, s._dPadRight = 0, s._isXboxOnePad = !1, s.type = e.Gamepad.XBOX, s._isXboxOnePad = o, s } return T(n, i), n.prototype.onlefttriggerchanged = function (e) { this._onlefttriggerchanged = e }, n.prototype.onrighttriggerchanged = function (e) { this._onrighttriggerchanged = e }, Object.defineProperty(n.prototype, "leftTrigger", { get: function () { return this._leftTrigger }, set: function (e) { this._onlefttriggerchanged && this._leftTrigger !== e && this._onlefttriggerchanged(e), this._leftTrigger = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "rightTrigger", { get: function () { return this._rightTrigger }, set: function (e) { this._onrighttriggerchanged && this._rightTrigger !== e && this._onrighttriggerchanged(e), this._rightTrigger = e }, enumerable: !0, configurable: !0 }), n.prototype.onbuttondown = function (e) { this._onbuttondown = e }, n.prototype.onbuttonup = function (e) { this._onbuttonup = e }, n.prototype.ondpaddown = function (e) { this._ondpaddown = e }, n.prototype.ondpadup = function (e) { this._ondpadup = e }, n.prototype._setButtonValue = function (e, t, i) { return e !== t && (1 === e && (this._onbuttondown && this._onbuttondown(i), this.onButtonDownObservable.notifyObservers(i)), 0 === e && (this._onbuttonup && this._onbuttonup(i), this.onButtonUpObservable.notifyObservers(i))), e }, n.prototype._setDPadValue = function (e, t, i) { return e !== t && (1 === e && (this._ondpaddown && this._ondpaddown(i), this.onPadDownObservable.notifyObservers(i)), 0 === e && (this._ondpadup && this._ondpadup(i), this.onPadUpObservable.notifyObservers(i))), e }, Object.defineProperty(n.prototype, "buttonA", { get: function () { return this._buttonA }, set: function (e) { this._buttonA = this._setButtonValue(e, this._buttonA, t.A) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "buttonB", { get: function () { return this._buttonB }, set: function (e) { this._buttonB = this._setButtonValue(e, this._buttonB, t.B) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "buttonX", { get: function () { return this._buttonX }, set: function (e) { this._buttonX = this._setButtonValue(e, this._buttonX, t.X) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "buttonY", { get: function () { return this._buttonY }, set: function (e) { this._buttonY = this._setButtonValue(e, this._buttonY, t.Y) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "buttonStart", { get: function () { return this._buttonStart }, set: function (e) { this._buttonStart = this._setButtonValue(e, this._buttonStart, t.Start) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "buttonBack", { get: function () { return this._buttonBack }, set: function (e) { this._buttonBack = this._setButtonValue(e, this._buttonBack, t.Back) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "buttonLB", { get: function () { return this._buttonLB }, set: function (e) { this._buttonLB = this._setButtonValue(e, this._buttonLB, t.LB) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "buttonRB", { get: function () { return this._buttonRB }, set: function (e) { this._buttonRB = this._setButtonValue(e, this._buttonRB, t.RB) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "buttonLeftStick", { get: function () { return this._buttonLeftStick }, set: function (e) { this._buttonLeftStick = this._setButtonValue(e, this._buttonLeftStick, t.LeftStick) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "buttonRightStick", { get: function () { return this._buttonRightStick }, set: function (e) { this._buttonRightStick = this._setButtonValue(e, this._buttonRightStick, t.RightStick) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "dPadUp", { get: function () { return this._dPadUp }, set: function (e) { this._dPadUp = this._setDPadValue(e, this._dPadUp, r.Up) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "dPadDown", { get: function () { return this._dPadDown }, set: function (e) { this._dPadDown = this._setDPadValue(e, this._dPadDown, r.Down) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "dPadLeft", { get: function () { return this._dPadLeft }, set: function (e) { this._dPadLeft = this._setDPadValue(e, this._dPadLeft, r.Left) }, enumerable: !0, configurable: !0 }), Object.defineProperty(n.prototype, "dPadRight", { get: function () { return this._dPadRight }, set: function (e) { this._dPadRight = this._setDPadValue(e, this._dPadRight, r.Right) }, enumerable: !0, configurable: !0 }), n.prototype.update = function () { i.prototype.update.call(this), this._isXboxOnePad ? (this.buttonA = this.browserGamepad.buttons[0].value, this.buttonB = this.browserGamepad.buttons[1].value, this.buttonX = this.browserGamepad.buttons[2].value, this.buttonY = this.browserGamepad.buttons[3].value, this.buttonLB = this.browserGamepad.buttons[4].value, this.buttonRB = this.browserGamepad.buttons[5].value, this.leftTrigger = this.browserGamepad.axes[2], this.rightTrigger = this.browserGamepad.axes[5], this.buttonBack = this.browserGamepad.buttons[9].value, this.buttonStart = this.browserGamepad.buttons[8].value, this.buttonLeftStick = this.browserGamepad.buttons[6].value, this.buttonRightStick = this.browserGamepad.buttons[7].value, this.dPadUp = this.browserGamepad.buttons[11].value, this.dPadDown = this.browserGamepad.buttons[12].value, this.dPadLeft = this.browserGamepad.buttons[13].value, this.dPadRight = this.browserGamepad.buttons[14].value) : (this.buttonA = this.browserGamepad.buttons[0].value, this.buttonB = this.browserGamepad.buttons[1].value, this.buttonX = this.browserGamepad.buttons[2].value, this.buttonY = this.browserGamepad.buttons[3].value, this.buttonLB = this.browserGamepad.buttons[4].value, this.buttonRB = this.browserGamepad.buttons[5].value, this.leftTrigger = this.browserGamepad.buttons[6].value, this.rightTrigger = this.browserGamepad.buttons[7].value, this.buttonBack = this.browserGamepad.buttons[8].value, this.buttonStart = this.browserGamepad.buttons[9].value, this.buttonLeftStick = this.browserGamepad.buttons[10].value, this.buttonRightStick = this.browserGamepad.buttons[11].value, this.dPadUp = this.browserGamepad.buttons[12].value, this.dPadDown = this.browserGamepad.buttons[13].value, this.dPadLeft = this.browserGamepad.buttons[14].value, this.dPadRight = this.browserGamepad.buttons[15].value) }, n.prototype.dispose = function () { i.prototype.dispose.call(this), this.onButtonDownObservable.clear(), this.onButtonUpObservable.clear(), this.onPadDownObservable.clear(), this.onPadUpObservable.clear() }, n }(e.Gamepad); e.Xbox360Pad = o }($a || ($a = {})), function (e) { var t, i; (i = t = e.PoseEnabledControllerType || (e.PoseEnabledControllerType = {}))[i.VIVE = 0] = "VIVE", i[i.OCULUS = 1] = "OCULUS", i[i.WINDOWS = 2] = "WINDOWS", i[i.GEAR_VR = 3] = "GEAR_VR", i[i.DAYDREAM = 4] = "DAYDREAM", i[i.GENERIC = 5] = "GENERIC"; var r = function () { function t() { } return t.InitiateController = function (t) { return -1 !== t.id.indexOf("Oculus Touch") ? new e.OculusTouchController(t) : 0 === t.id.indexOf(e.WindowsMotionController.GAMEPAD_ID_PREFIX) ? new e.WindowsMotionController(t) : -1 !== t.id.toLowerCase().indexOf("openvr") ? new e.ViveController(t) : 0 === t.id.indexOf(e.GearVRController.GAMEPAD_ID_PREFIX) || -1 !== t.id.indexOf("Oculus Go") ? new e.GearVRController(t) : 0 === t.id.indexOf(e.DaydreamController.GAMEPAD_ID_PREFIX) ? new e.DaydreamController(t) : new e.GenericController(t) }, t }(); e.PoseEnabledControllerHelper = r; var n = function (i) { function r(r) { var n = i.call(this, r.id, r.index, r) || this; return n._deviceRoomPosition = e.Vector3.Zero(), n._deviceRoomRotationQuaternion = new e.Quaternion, n.devicePosition = e.Vector3.Zero(), n.deviceRotationQuaternion = new e.Quaternion, n.deviceScaleFactor = 1, n._trackPosition = !0, n._maxRotationDistFromHeadset = Math.PI / 5, n._draggedRoomRotation = 0, n._leftHandSystemQuaternion = new e.Quaternion, n._deviceToWorld = e.Matrix.Identity(), n._pointingPoseNode = null, n._workingMatrix = e.Matrix.Identity(), n._meshAttachedObservable = new e.Observable, n.type = e.Gamepad.POSE_ENABLED, n.controllerType = t.GENERIC, n.position = e.Vector3.Zero(), n.rotationQuaternion = new e.Quaternion, n._calculatedPosition = e.Vector3.Zero(), n._calculatedRotation = new e.Quaternion, e.Quaternion.RotationYawPitchRollToRef(Math.PI, 0, 0, n._leftHandSystemQuaternion), n } return T(r, i), r.prototype._disableTrackPosition = function (e) { this._trackPosition && (this._calculatedPosition.copyFrom(e), this._trackPosition = !1) }, r.prototype.update = function () { i.prototype.update.call(this), this._updatePoseAndMesh() }, r.prototype._updatePoseAndMesh = function () { var t = this.browserGamepad.pose; if (this.updateFromDevice(t), !this._trackPosition && e.Engine.LastCreatedScene && e.Engine.LastCreatedScene.activeCamera && e.Engine.LastCreatedScene.activeCamera.devicePosition && ((i = e.Engine.LastCreatedScene.activeCamera)._computeDevicePosition(), this._deviceToWorld.setTranslation(i.devicePosition), i.deviceRotationQuaternion)) { var i; (i = i)._deviceRoomRotationQuaternion.toEulerAnglesToRef(e.Tmp.Vector3[0]); var r = Math.atan2(Math.sin(e.Tmp.Vector3[0].y - this._draggedRoomRotation), Math.cos(e.Tmp.Vector3[0].y - this._draggedRoomRotation)); if (Math.abs(r) > this._maxRotationDistFromHeadset) { var n = r - (r < 0 ? -this._maxRotationDistFromHeadset : this._maxRotationDistFromHeadset); this._draggedRoomRotation += n; var o = Math.sin(-n), s = Math.cos(-n); this._calculatedPosition.x = this._calculatedPosition.x * s - this._calculatedPosition.z * o, this._calculatedPosition.z = this._calculatedPosition.x * o + this._calculatedPosition.z * s } } e.Vector3.TransformCoordinatesToRef(this._calculatedPosition, this._deviceToWorld, this.devicePosition), this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix), e.Quaternion.FromRotationMatrixToRef(this._workingMatrix, this.deviceRotationQuaternion), this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation), this._mesh && (this._mesh.position.copyFrom(this.devicePosition), this._mesh.rotationQuaternion && this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion)) }, r.prototype.updateFromDevice = function (e) { if (e) { (this.rawPose = e).position && (this._deviceRoomPosition.copyFromFloats(e.position[0], e.position[1], -e.position[2]), this._mesh && this._mesh.getScene().useRightHandedSystem && (this._deviceRoomPosition.z *= -1), this._trackPosition && this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor, this._calculatedPosition), this._calculatedPosition.addInPlace(this.position)); var t = this.rawPose; e.orientation && t.orientation && (this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0], t.orientation[1], -t.orientation[2], -t.orientation[3]), this._mesh && (this._mesh.getScene().useRightHandedSystem ? (this._deviceRoomRotationQuaternion.z *= -1, this._deviceRoomRotationQuaternion.w *= -1) : this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion, this._deviceRoomRotationQuaternion)), this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion, this._calculatedRotation)) } }, r.prototype.attachToMesh = function (t) { if (this._mesh && (this._mesh.parent = null), this._mesh = t, this._poseControlledCamera && (this._mesh.parent = this._poseControlledCamera), this._mesh.rotationQuaternion || (this._mesh.rotationQuaternion = new e.Quaternion), this._updatePoseAndMesh(), this._pointingPoseNode) { for (var i = [], r = this._pointingPoseNode; r.parent;)i.push(r.parent), r = r.parent; i.reverse().forEach(function (e) { e.computeWorldMatrix(!0) }) } this._meshAttachedObservable.notifyObservers(t) }, r.prototype.attachToPoseControlledCamera = function (e) { this._poseControlledCamera = e, this._mesh && (this._mesh.parent = this._poseControlledCamera) }, r.prototype.dispose = function () { this._mesh && this._mesh.dispose(), this._mesh = null, i.prototype.dispose.call(this) }, Object.defineProperty(r.prototype, "mesh", { get: function () { return this._mesh }, enumerable: !0, configurable: !0 }), r.prototype.getForwardRay = function (t) { if (void 0 === t && (t = 100), !this.mesh) return new e.Ray(e.Vector3.Zero(), new e.Vector3(0, 0, 1), t); var i = this._pointingPoseNode ? this._pointingPoseNode.getWorldMatrix() : this.mesh.getWorldMatrix(), r = i.getTranslation(), n = new e.Vector3(0, 0, -1), o = e.Vector3.TransformNormal(n, i), s = e.Vector3.Normalize(o); return new e.Ray(r, s, t) }, r.POINTING_POSE = "POINTING_POSE", r }(e.Gamepad); e.PoseEnabledController = n }($a || ($a = {})), Fr = function (e) { function t(t) { var i = e.call(this, t) || this; return i.onTriggerStateChangedObservable = new Lr.Observable, i.onMainButtonStateChangedObservable = new Lr.Observable, i.onSecondaryButtonStateChangedObservable = new Lr.Observable, i.onPadStateChangedObservable = new Lr.Observable, i.onPadValuesChangedObservable = new Lr.Observable, i.pad = { x: 0, y: 0 }, i._changes = { pressChanged: !1, touchChanged: !1, valueChanged: !1, changed: !1 }, i._buttons = new Array(t.buttons.length), i.hand = t.hand, i } return T(t, e), t.prototype.onButtonStateChange = function (e) { this._onButtonStateChange = e }, Object.defineProperty(t.prototype, "defaultModel", { get: function () { return this._defaultModel }, enumerable: !0, configurable: !0 }), t.prototype.update = function () { e.prototype.update.call(this); for (var t = 0; t < this._buttons.length; t++)this._setButtonValue(this.browserGamepad.buttons[t], this._buttons[t], t); this.leftStick.x === this.pad.x && this.leftStick.y === this.pad.y || (this.pad.x = this.leftStick.x, this.pad.y = this.leftStick.y, this.onPadValuesChangedObservable.notifyObservers(this.pad)) }, t.prototype._setButtonValue = function (e, t, i) { e || (e = { pressed: !1, touched: !1, value: 0 }), t ? (this._checkChanges(e, t), this._changes.changed && (this._onButtonStateChange && this._onButtonStateChange(this.index, i, e), this._handleButtonChange(i, e, this._changes)), this._buttons[i].pressed = e.pressed, this._buttons[i].touched = e.touched, this._buttons[i].value = e.value < 1e-8 ? 0 : e.value) : this._buttons[i] = { pressed: e.pressed, touched: e.touched, value: e.value } }, t.prototype._checkChanges = function (e, t) { return this._changes.pressChanged = e.pressed !== t.pressed, this._changes.touchChanged = e.touched !== t.touched, this._changes.valueChanged = e.value !== t.value, this._changes.changed = this._changes.pressChanged || this._changes.touchChanged || this._changes.valueChanged, this._changes }, t.prototype.dispose = function () { e.prototype.dispose.call(this), this.onTriggerStateChangedObservable.clear(), this.onMainButtonStateChangedObservable.clear(), this.onSecondaryButtonStateChangedObservable.clear(), this.onPadStateChangedObservable.clear(), this.onPadValuesChangedObservable.clear() }, t }((Lr = $a || ($a = {})).PoseEnabledController), Lr.WebVRController = Fr, Nr = function (e) { function t(t) { var i = e.call(this, t) || this; return i.onSecondaryTriggerStateChangedObservable = new Br.Observable, i.onThumbRestChangedObservable = new Br.Observable, i.controllerType = Br.PoseEnabledControllerType.OCULUS, i } return T(t, e), t.prototype.initControllerMesh = function (e, i) { var r, n = this; r = "left" === this.hand ? t.MODEL_LEFT_FILENAME : t.MODEL_RIGHT_FILENAME, Br.SceneLoader.ImportMesh("", t.MODEL_BASE_URL, r, e, function (e) { n._defaultModel = e[1], n.attachToMesh(n._defaultModel), i && i(n._defaultModel) }) }, Object.defineProperty(t.prototype, "onAButtonStateChangedObservable", { get: function () { if ("right" === this.hand) return this.onMainButtonStateChangedObservable; throw new Error("No A button on left hand") }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onBButtonStateChangedObservable", { get: function () { if ("right" === this.hand) return this.onSecondaryButtonStateChangedObservable; throw new Error("No B button on left hand") }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onXButtonStateChangedObservable", { get: function () { if ("left" === this.hand) return this.onMainButtonStateChangedObservable; throw new Error("No X button on right hand") }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onYButtonStateChangedObservable", { get: function () { if ("left" === this.hand) return this.onSecondaryButtonStateChangedObservable; throw new Error("No Y button on right hand") }, enumerable: !0, configurable: !0 }), t.prototype._handleButtonChange = function (e, t, i) { var r = t, n = "right" === this.hand ? -1 : 1; switch (e) { case 0: return void this.onPadStateChangedObservable.notifyObservers(r); case 1: return this._defaultModel && (this._defaultModel.getChildren()[3].rotation.x = .2 * -r.value, this._defaultModel.getChildren()[3].position.y = .005 * -r.value, this._defaultModel.getChildren()[3].position.z = .005 * -r.value), void this.onTriggerStateChangedObservable.notifyObservers(r); case 2: return this._defaultModel && (this._defaultModel.getChildren()[4].position.x = n * r.value * .0035), void this.onSecondaryTriggerStateChangedObservable.notifyObservers(r); case 3: return this._defaultModel && (r.pressed ? this._defaultModel.getChildren()[1].position.y = -.001 : this._defaultModel.getChildren()[1].position.y = 0), void this.onMainButtonStateChangedObservable.notifyObservers(r); case 4: return this._defaultModel && (r.pressed ? this._defaultModel.getChildren()[2].position.y = -.001 : this._defaultModel.getChildren()[2].position.y = 0), void this.onSecondaryButtonStateChangedObservable.notifyObservers(r); case 5: return void this.onThumbRestChangedObservable.notifyObservers(r) } }, t.MODEL_BASE_URL = "https://controllers.babylonjs.com/oculus/", t.MODEL_LEFT_FILENAME = "left.babylon", t.MODEL_RIGHT_FILENAME = "right.babylon", t }((Br = $a || ($a = {})).WebVRController), Br.OculusTouchController = Nr, Ur = function (e) { function t(t) { var i = e.call(this, t) || this; return i.controllerType = Vr.PoseEnabledControllerType.VIVE, i._invertLeftStickY = !0, i } return T(t, e), t.prototype.initControllerMesh = function (e, i) { var r = this; Vr.SceneLoader.ImportMesh("", t.MODEL_BASE_URL, t.MODEL_FILENAME, e, function (e) { r._defaultModel = e[1], r.attachToMesh(r._defaultModel), i && i(r._defaultModel) }) }, Object.defineProperty(t.prototype, "onLeftButtonStateChangedObservable", { get: function () { return this.onMainButtonStateChangedObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onRightButtonStateChangedObservable", { get: function () { return this.onMainButtonStateChangedObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onMenuButtonStateChangedObservable", { get: function () { return this.onSecondaryButtonStateChangedObservable }, enumerable: !0, configurable: !0 }), t.prototype._handleButtonChange = function (e, t, i) { var r = t; switch (e) { case 0: return void this.onPadStateChangedObservable.notifyObservers(r); case 1: return this._defaultModel && (this._defaultModel.getChildren()[6].rotation.x = .15 * -r.value), void this.onTriggerStateChangedObservable.notifyObservers(r); case 2: return void this.onMainButtonStateChangedObservable.notifyObservers(r); case 3: return this._defaultModel && (r.pressed ? this._defaultModel.getChildren()[2].position.y = -.001 : this._defaultModel.getChildren()[2].position.y = 0), void this.onSecondaryButtonStateChangedObservable.notifyObservers(r) } }, t.MODEL_BASE_URL = "https://controllers.babylonjs.com/vive/", t.MODEL_FILENAME = "wand.babylon", t }((Vr = $a || ($a = {})).WebVRController), Vr.ViveController = Ur, Gr = function (e) { function t(t) { return e.call(this, t) || this } return T(t, e), t.prototype.initControllerMesh = function (e, i) { var r = this; zr.SceneLoader.ImportMesh("", t.MODEL_BASE_URL, t.MODEL_FILENAME, e, function (e) { r._defaultModel = e[1], r.attachToMesh(r._defaultModel), i && i(r._defaultModel) }) }, t.prototype._handleButtonChange = function (e, t, i) { console.log("Button id: " + e + "state: "), console.dir(t) }, t.MODEL_BASE_URL = "https://controllers.babylonjs.com/generic/", t.MODEL_FILENAME = "generic.babylon", t }((zr = $a || ($a = {})).WebVRController), zr.GenericController = Gr, kr = $a || ($a = {}), Wr = function () { this.buttonMeshes = {}, this.axisMeshes = {} }, Hr = function (e) { function t(t) { var i = e.call(this, t) || this; return i._mapping = { buttons: ["thumbstick", "trigger", "grip", "menu", "trackpad"], buttonMeshNames: { trigger: "SELECT", menu: "MENU", grip: "GRASP", thumbstick: "THUMBSTICK_PRESS", trackpad: "TOUCHPAD_PRESS" }, buttonObservableNames: { trigger: "onTriggerStateChangedObservable", menu: "onSecondaryButtonStateChangedObservable", grip: "onMainButtonStateChangedObservable", thumbstick: "onPadStateChangedObservable", trackpad: "onTrackpadChangedObservable" }, axisMeshNames: ["THUMBSTICK_X", "THUMBSTICK_Y", "TOUCHPAD_TOUCH_X", "TOUCHPAD_TOUCH_Y"], pointingPoseMeshName: kr.PoseEnabledController.POINTING_POSE }, i.onTrackpadChangedObservable = new kr.Observable, i.onTrackpadValuesChangedObservable = new kr.Observable, i.trackpad = { x: 0, y: 0 }, i.controllerType = kr.PoseEnabledControllerType.WINDOWS, i._loadedMeshInfo = null, i } return T(t, e), Object.defineProperty(t.prototype, "onTriggerButtonStateChangedObservable", { get: function () { return this.onTriggerStateChangedObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onMenuButtonStateChangedObservable", { get: function () { return this.onSecondaryButtonStateChangedObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onGripButtonStateChangedObservable", { get: function () { return this.onMainButtonStateChangedObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onThumbstickButtonStateChangedObservable", { get: function () { return this.onPadStateChangedObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onTouchpadButtonStateChangedObservable", { get: function () { return this.onTrackpadChangedObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "onTouchpadValuesChangedObservable", { get: function () { return this.onTrackpadValuesChangedObservable }, enumerable: !0, configurable: !0 }), t.prototype._updateTrackpad = function () { !this.browserGamepad.axes || this.browserGamepad.axes[2] == this.trackpad.x && this.browserGamepad.axes[3] == this.trackpad.y || (this.trackpad.x = this.browserGamepad.axes[2], this.trackpad.y = this.browserGamepad.axes[3], this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad)) }, t.prototype.update = function () { if (e.prototype.update.call(this), this.browserGamepad.axes && (this._updateTrackpad(), this._loadedMeshInfo)) for (var t = 0; t < this._mapping.axisMeshNames.length; t++)this._lerpAxisTransform(t, this.browserGamepad.axes[t]) }, t.prototype._handleButtonChange = function (e, t, i) { var r = this._mapping.buttons[e]; if (r) { this._updateTrackpad(); var n = this[this._mapping.buttonObservableNames[r]]; n && n.notifyObservers(t), this._lerpButtonTransform(r, t.value) } }, t.prototype._lerpButtonTransform = function (e, t) { if (this._loadedMeshInfo) { var i = this._loadedMeshInfo.buttonMeshes[e]; i.unpressed.rotationQuaternion && i.pressed.rotationQuaternion && i.value.rotationQuaternion && (kr.Quaternion.SlerpToRef(i.unpressed.rotationQuaternion, i.pressed.rotationQuaternion, t, i.value.rotationQuaternion), kr.Vector3.LerpToRef(i.unpressed.position, i.pressed.position, t, i.value.position)) } }, t.prototype._lerpAxisTransform = function (e, t) { if (this._loadedMeshInfo) { var i = this._loadedMeshInfo.axisMeshes[e]; if (i && i.min.rotationQuaternion && i.max.rotationQuaternion && i.value.rotationQuaternion) { var r = .5 * t + .5; kr.Quaternion.SlerpToRef(i.min.rotationQuaternion, i.max.rotationQuaternion, r, i.value.rotationQuaternion), kr.Vector3.LerpToRef(i.min.position, i.max.position, r, i.value.position) } } }, t.prototype.initControllerMesh = function (e, i, r) { var n, o, s = this; if (void 0 === r && (r = !1), kr.SceneLoader.IsPluginForExtensionAvailable(".glb")) { var a = "default"; if (this.id && !r) { var l = this.id.match(t.GAMEPAD_ID_PATTERN); a = l && l[0] || a } o = "left" === this.hand ? t.MODEL_LEFT_FILENAME : t.MODEL_RIGHT_FILENAME, n = t.MODEL_BASE_URL + a + "/" } else kr.Tools.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"), n = kr.GenericController.MODEL_BASE_URL, o = kr.GenericController.MODEL_FILENAME; kr.SceneLoader.ImportMesh("", n, o, e, function (t) { s._loadedMeshInfo = s.processModel(e, t), s._loadedMeshInfo && (s._defaultModel = s._loadedMeshInfo.rootNode, s.attachToMesh(s._defaultModel), i && i(s._defaultModel)) }, null, function (e, t) { kr.Tools.Log(t), kr.Tools.Warn("Failed to retrieve controller model from the remote server: " + n + o), r || s.initControllerMesh(e, i, !0) }) }, t.prototype.processModel = function (e, t) { for (var i = null, r = new kr.Mesh(this.id + " " + this.hand, e), n = null, o = 0; o < t.length; o++) { var s = t[o]; if (!s.parent) { s.isPickable = !1, n = s; break } } return n ? (n.setParent(r), i = this.createMeshInfo(r)) : kr.Tools.Warn("Could not find root node in model file."), i }, t.prototype.createMeshInfo = function (e) { var t, i = new Wr; for (i.rootNode = e, i.buttonMeshes = {}, i.axisMeshes = {}, t = 0; t < this._mapping.buttons.length; t++) { var r = this._mapping.buttonMeshNames[this._mapping.buttons[t]]; if (r) { var n = c(e, r); if (n) { var o = { index: t, value: h(n, "VALUE"), pressed: h(n, "PRESSED"), unpressed: h(n, "UNPRESSED") }; o.value && o.pressed && o.unpressed ? i.buttonMeshes[this._mapping.buttons[t]] = o : kr.Tools.Warn("Missing button submesh under mesh with name: " + r + "(VALUE: " + !!o.value + ", PRESSED: " + !!o.pressed + ", UNPRESSED:" + !!o.unpressed + ")") } else kr.Tools.Warn("Missing button mesh with name: " + r) } else kr.Tools.Log("Skipping unknown button at index: " + t + " with mapped name: " + this._mapping.buttons[t]) } for (t = 0; t < this._mapping.axisMeshNames.length; t++) { var s = this._mapping.axisMeshNames[t]; if (s) { var a = c(e, s); if (a) { var l = { index: t, value: h(a, "VALUE"), min: h(a, "MIN"), max: h(a, "MAX") }; l.value && l.min && l.max ? i.axisMeshes[t] = l : kr.Tools.Warn("Missing axis submesh under mesh with name: " + s + "(VALUE: " + !!l.value + ", MIN: " + !!l.min + ", MAX:" + !!l.max + ")") } else kr.Tools.Warn("Missing axis mesh with name: " + s) } else kr.Tools.Log("Skipping unknown axis at index: " + t) } return i.pointingPoseNode = c(e, this._mapping.pointingPoseMeshName), i.pointingPoseNode ? this._pointingPoseNode = i.pointingPoseNode : kr.Tools.Warn("Missing pointing pose mesh with name: " + this._mapping.pointingPoseMeshName), i; function c(e, t) { return e.getChildMeshes(!1, function (e) { return e.name === t })[0] } function h(e, t) { return e.getChildMeshes(!0, function (e) { return e.name == t })[0] } }, t.prototype.getForwardRay = function (t) { if (void 0 === t && (t = 100), !this._loadedMeshInfo || !this._loadedMeshInfo.pointingPoseNode) return e.prototype.getForwardRay.call(this, t); var i = this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(), r = i.getTranslation(), n = new kr.Vector3(0, 0, -1), o = kr.Vector3.TransformNormal(n, i), s = kr.Vector3.Normalize(o); return new kr.Ray(r, s, t) }, t.prototype.dispose = function () { e.prototype.dispose.call(this), this.onTrackpadChangedObservable.clear() }, t.MODEL_BASE_URL = "https://controllers.babylonjs.com/microsoft/", t.MODEL_LEFT_FILENAME = "left.glb", t.MODEL_RIGHT_FILENAME = "right.glb", t.GAMEPAD_ID_PREFIX = "Spatial Controller (Spatial Interaction Source) ", t.GAMEPAD_ID_PATTERN = /([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/, t }(kr.WebVRController), kr.WindowsMotionController = Hr, jr = function (e) { function t(t) { var i = e.call(this, t) || this; return i._buttonIndexToObservableNameMap = ["onTrackpadChangedObservable", "onTriggerStateChangedObservable"], i.controllerType = Xr.PoseEnabledControllerType.GEAR_VR, i._calculatedPosition = new Xr.Vector3("left" == i.hand ? -.15 : .15, -.5, .25), i._disableTrackPosition(i._calculatedPosition), i } return T(t, e), t.prototype.initControllerMesh = function (e, i) { var r = this; Xr.SceneLoader.ImportMesh("", t.MODEL_BASE_URL, t.MODEL_FILENAME, e, function (t) { var n = new Xr.Mesh("", e); t[1].parent = n, t[1].position.z = -.15, r._defaultModel = n, r.attachToMesh(r._defaultModel), i && i(r._defaultModel) }) }, t.prototype._handleButtonChange = function (e, t, i) { if (e < this._buttonIndexToObservableNameMap.length) { var r = this[this._buttonIndexToObservableNameMap[e]]; r && r.notifyObservers(t) } }, t.MODEL_BASE_URL = "https://controllers.babylonjs.com/generic/", t.MODEL_FILENAME = "generic.babylon", t.GAMEPAD_ID_PREFIX = "Gear VR", t }((Xr = $a || ($a = {})).WebVRController), Xr.GearVRController = jr, Kr = function (e) { function t(t) { var i = e.call(this, t) || this; return i.controllerType = Yr.PoseEnabledControllerType.DAYDREAM, i } return T(t, e), t.prototype.initControllerMesh = function (e, i) { var r = this; Yr.SceneLoader.ImportMesh("", t.MODEL_BASE_URL, t.MODEL_FILENAME, e, function (e) { r._defaultModel = e[1], r.attachToMesh(r._defaultModel), i && i(r._defaultModel) }) }, t.prototype._handleButtonChange = function (e, t, i) { if (0 === e) { var r = this.onTriggerStateChangedObservable; r && r.notifyObservers(t) } else Yr.Tools.Warn("Unrecognized Daydream button index: " + e) }, t.MODEL_BASE_URL = "https://controllers.babylonjs.com/generic/", t.MODEL_FILENAME = "generic.babylon", t.GAMEPAD_ID_PREFIX = "Daydream", t }((Yr = $a || ($a = {})).WebVRController), Yr.DaydreamController = Kr, function (e) { Object.defineProperty(e.Scene.prototype, "gamepadManager", { get: function () { if (!this._gamepadManager) { this._gamepadManager = new e.GamepadManager(this); var i = this._getComponent(e.SceneComponentConstants.NAME_GAMEPAD); i || (i = new t(this), this._addComponent(i)) } return this._gamepadManager }, enumerable: !0, configurable: !0 }), e.FreeCameraInputsManager.prototype.addGamepad = function () { return this.add(new e.FreeCameraGamepadInput), this }, e.ArcRotateCameraInputsManager.prototype.addGamepad = function () { return this.add(new e.ArcRotateCameraGamepadInput), this }; var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_GAMEPAD, this.scene = t } return t.prototype.register = function () { this.scene._beforeCameraUpdateStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERAUPDATE_GAMEPAD, this, this._beforeCameraUpdate) }, t.prototype.rebuild = function () { }, t.prototype.dispose = function () { var e = this.scene._gamepadManager; e && (e.dispose(), this.scene._gamepadManager = null) }, t.prototype._beforeCameraUpdate = function () { var e = this.scene._gamepadManager; e && e._isMonitoring && e._checkGamepadsStatus() }, t }(); e.GamepadSystemSceneComponent = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("FollowCamera", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }), e.Node.AddNodeConstructor("ArcFollowCamera", function (e, t) { return function () { return new i(e, 0, 0, 1, null, t) } }); var t = function (t) { function i(e, i, r, n) { void 0 === n && (n = null); var o = t.call(this, e, i, r) || this; return o.radius = 12, o.rotationOffset = 0, o.heightOffset = 4, o.cameraAcceleration = .05, o.maxCameraSpeed = 20, o.lockedTarget = n, o } return T(i, t), i.prototype._follow = function (t) { if (t) { var i; if (t.rotationQuaternion) { var r = new e.Matrix; t.rotationQuaternion.toRotationMatrix(r), i = Math.atan2(r.m[8], r.m[10]) } else i = t.rotation.y; var n = e.Tools.ToRadians(this.rotationOffset) + i, o = t.getAbsolutePosition(), s = o.x + Math.sin(n) * this.radius, a = o.z + Math.cos(n) * this.radius, l = s - this.position.x, c = o.y + this.heightOffset - this.position.y, h = a - this.position.z, u = l * this.cameraAcceleration * 2, d = c * this.cameraAcceleration, f = h * this.cameraAcceleration * 2; (u > this.maxCameraSpeed || u < -this.maxCameraSpeed) && (u = u < 1 ? -this.maxCameraSpeed : this.maxCameraSpeed), (d > this.maxCameraSpeed || d < -this.maxCameraSpeed) && (d = d < 1 ? -this.maxCameraSpeed : this.maxCameraSpeed), (f > this.maxCameraSpeed || f < -this.maxCameraSpeed) && (f = f < 1 ? -this.maxCameraSpeed : this.maxCameraSpeed), this.position = new e.Vector3(this.position.x + u, this.position.y + d, this.position.z + f), this.setTarget(o) } }, i.prototype._checkInputs = function () { t.prototype._checkInputs.call(this), this.lockedTarget && this._follow(this.lockedTarget) }, i.prototype.getClassName = function () { return "FollowCamera" }, b([e.serialize()], i.prototype, "radius", void 0), b([e.serialize()], i.prototype, "rotationOffset", void 0), b([e.serialize()], i.prototype, "heightOffset", void 0), b([e.serialize()], i.prototype, "cameraAcceleration", void 0), b([e.serialize()], i.prototype, "maxCameraSpeed", void 0), b([e.serializeAsMeshReference("lockedTargetId")], i.prototype, "lockedTarget", void 0), i }(e.TargetCamera); e.FollowCamera = t; var i = function (t) { function i(i, r, n, o, s, a) { var l = t.call(this, i, e.Vector3.Zero(), a) || this; return l.alpha = r, l.beta = n, l.radius = o, l.target = s, l._cartesianCoordinates = e.Vector3.Zero(), l._follow(), l } return T(i, t), i.prototype._follow = function () { if (this.target) { this._cartesianCoordinates.x = this.radius * Math.cos(this.alpha) * Math.cos(this.beta), this._cartesianCoordinates.y = this.radius * Math.sin(this.beta), this._cartesianCoordinates.z = this.radius * Math.sin(this.alpha) * Math.cos(this.beta); var e = this.target.getAbsolutePosition(); this.position = e.add(this._cartesianCoordinates), this.setTarget(e) } }, i.prototype._checkInputs = function () { t.prototype._checkInputs.call(this), this._follow() }, i.prototype.getClassName = function () { return "ArcFollowCamera" }, i }(e.TargetCamera); e.ArcFollowCamera = i }($a || ($a = {})), Zr = function (e) { function t(t, i, r) { var n = e.call(this, t, i, r) || this; return n.inputs.addGamepad(), n } return T(t, e), Object.defineProperty(t.prototype, "gamepadAngularSensibility", { get: function () { var e = this.inputs.attached.gamepad; return e ? e.gamepadAngularSensibility : 0 }, set: function (e) { var t = this.inputs.attached.gamepad; t && (t.gamepadAngularSensibility = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "gamepadMoveSensibility", { get: function () { var e = this.inputs.attached.gamepad; return e ? e.gamepadMoveSensibility : 0 }, set: function (e) { var t = this.inputs.attached.gamepad; t && (t.gamepadMoveSensibility = e) }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "UniversalCamera" }, t }((Qr = $a || ($a = {})).TouchCamera), Qr.UniversalCamera = Zr, function (e) { e.Node.AddNodeConstructor("GamepadCamera", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (e) { function t(t, i, r) { return e.call(this, t, i, r) || this } return T(t, e), t.prototype.getClassName = function () { return "GamepadCamera" }, t }(e.UniversalCamera); e.GamepadCamera = t }($a || ($a = {})), qr = $a || ($a = {}), Jr = function () { function e() { this._renderPipelines = {} } return e.prototype.addPipeline = function (e) { this._renderPipelines[e._name] = e }, e.prototype.attachCamerasToRenderPipeline = function (e, t, i) { void 0 === i && (i = !1); var r = this._renderPipelines[e]; r && r._attachCameras(t, i) }, e.prototype.detachCamerasFromRenderPipeline = function (e, t) { var i = this._renderPipelines[e]; i && i._detachCameras(t) }, e.prototype.enableEffectInPipeline = function (e, t, i) { var r = this._renderPipelines[e]; r && r._enableEffect(t, i) }, e.prototype.disableEffectInPipeline = function (e, t, i) { var r = this._renderPipelines[e]; r && r._disableEffect(t, i) }, e.prototype.update = function () { for (var e in this._renderPipelines) if (this._renderPipelines.hasOwnProperty(e)) { var t = this._renderPipelines[e]; t.isSupported ? t._update() : (t.dispose(), delete this._renderPipelines[e]) } }, e.prototype._rebuild = function () { for (var e in this._renderPipelines) this._renderPipelines.hasOwnProperty(e) && this._renderPipelines[e]._rebuild() }, e.prototype.dispose = function () { for (var e in this._renderPipelines) this._renderPipelines.hasOwnProperty(e) && this._renderPipelines[e].dispose() }, e }(), qr.PostProcessRenderPipelineManager = Jr, function (e) { Object.defineProperty(e.Scene.prototype, "postProcessRenderPipelineManager", { get: function () { if (!this._postProcessRenderPipelineManager) { var i = this._getComponent(e.SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER); i || (i = new t(this), this._addComponent(i)), this._postProcessRenderPipelineManager = new e.PostProcessRenderPipelineManager } return this._postProcessRenderPipelineManager }, enumerable: !0, configurable: !0 }); var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER, this.scene = t } return t.prototype.register = function () { this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER, this, this._gatherRenderTargets) }, t.prototype.rebuild = function () { this.scene._postProcessRenderPipelineManager && this.scene._postProcessRenderPipelineManager._rebuild() }, t.prototype.dispose = function () { this.scene._postProcessRenderPipelineManager && this.scene._postProcessRenderPipelineManager.dispose() }, t.prototype._gatherRenderTargets = function (e) { this.scene._postProcessRenderPipelineManager && this.scene._postProcessRenderPipelineManager.update() }, t }(); e.PostProcessRenderPipelineManagerSceneComponent = t }($a || ($a = {})), $r = $a || ($a = {}), en = function () { function e(e, t, i, r) { this._name = t, this._singleInstance = r || !0, this._getPostProcesses = i, this._cameras = {}, this._indicesForCamera = {}, this._postProcesses = {} } return Object.defineProperty(e.prototype, "isSupported", { get: function () { for (var e in this._postProcesses) if (this._postProcesses.hasOwnProperty(e)) for (var t = this._postProcesses[e], i = 0; i < t.length; i++)if (!t[i].isSupported) return !1; return !0 }, enumerable: !0, configurable: !0 }), e.prototype._update = function () { }, e.prototype._attachCameras = function (e) { var t, i = this, r = $r.Tools.MakeArray(e || this._cameras); if (r) for (var n = 0; n < r.length; n++) { var o = r[n], s = o.name; if (t = this._singleInstance ? 0 : s, !this._postProcesses[t]) { var a = this._getPostProcesses(); a && (this._postProcesses[t] = Array.isArray(a) ? a : [a]) } this._indicesForCamera[s] || (this._indicesForCamera[s] = []), this._postProcesses[t].forEach(function (e) { var t = o.attachPostProcess(e); i._indicesForCamera[s].push(t) }), this._cameras[s] || (this._cameras[s] = o) } }, e.prototype._detachCameras = function (e) { var t = $r.Tools.MakeArray(e || this._cameras); if (t) for (var i = 0; i < t.length; i++) { var r = t[i], n = r.name; this._postProcesses[this._singleInstance ? 0 : n].forEach(function (e) { r.detachPostProcess(e) }), this._cameras[n] && (this._cameras[n] = null) } }, e.prototype._enable = function (e) { var t = this, i = $r.Tools.MakeArray(e || this._cameras); if (i) for (var r = 0; r < i.length; r++)for (var n = i[r], o = n.name, s = 0; s < this._indicesForCamera[o].length; s++)void 0 !== n._postProcesses[this._indicesForCamera[o][s]] && null !== n._postProcesses[this._indicesForCamera[o][s]] || this._postProcesses[this._singleInstance ? 0 : o].forEach(function (e) { i[r].attachPostProcess(e, t._indicesForCamera[o][s]) }) }, e.prototype._disable = function (e) { var t = $r.Tools.MakeArray(e || this._cameras); if (t) for (var i = 0; i < t.length; i++) { var r = t[i], n = r.name; this._postProcesses[this._singleInstance ? 0 : n].forEach(function (e) { r.detachPostProcess(e) }) } }, e.prototype.getPostProcesses = function (e) { return this._singleInstance ? this._postProcesses[0] : e ? this._postProcesses[e.name] : null }, e }(), $r.PostProcessRenderEffect = en, tn = $a || ($a = {}), rn = function () { function e(e, t) { this.engine = e, this._name = t, this._renderEffects = {}, this._renderEffectsForIsolatedPass = new Array, this._cameras = [] } return e.prototype.getClassName = function () { return "PostProcessRenderPipeline" }, Object.defineProperty(e.prototype, "isSupported", { get: function () { for (var e in this._renderEffects) if (this._renderEffects.hasOwnProperty(e) && !this._renderEffects[e].isSupported) return !1; return !0 }, enumerable: !0, configurable: !0 }), e.prototype.addEffect = function (e) { this._renderEffects[e._name] = e }, e.prototype._rebuild = function () { }, e.prototype._enableEffect = function (e, t) { var i = this._renderEffects[e]; i && i._enable(tn.Tools.MakeArray(t || this._cameras)) }, e.prototype._disableEffect = function (e, t) { var i = this._renderEffects[e]; i && i._disable(tn.Tools.MakeArray(t || this._cameras)) }, e.prototype._attachCameras = function (e, t) { var i = tn.Tools.MakeArray(e || this._cameras); if (i) { var r, n = []; for (r = 0; r < i.length; r++) { var o = i[r], s = o.name; -1 === this._cameras.indexOf(o) ? this._cameras[s] = o : t && n.push(r) } for (r = 0; r < n.length; r++)e.splice(n[r], 1); for (var a in this._renderEffects) this._renderEffects.hasOwnProperty(a) && this._renderEffects[a]._attachCameras(i) } }, e.prototype._detachCameras = function (e) { var t = tn.Tools.MakeArray(e || this._cameras); if (t) { for (var i in this._renderEffects) this._renderEffects.hasOwnProperty(i) && this._renderEffects[i]._detachCameras(t); for (var r = 0; r < t.length; r++)this._cameras.splice(this._cameras.indexOf(t[r]), 1) } }, e.prototype._update = function () { for (var e in this._renderEffects) this._renderEffects.hasOwnProperty(e) && this._renderEffects[e]._update(); for (var t = 0; t < this._cameras.length; t++) { var i = this._cameras[t].name; this._renderEffectsForIsolatedPass[i] && this._renderEffectsForIsolatedPass[i]._update() } }, e.prototype._reset = function () { this._renderEffects = {}, this._renderEffectsForIsolatedPass = new Array }, e.prototype._enableMSAAOnFirstPostProcess = function (e) { var t = Object.keys(this._renderEffects); if (2 <= this.engine.webGLVersion && 0 < t.length) { var i = this._renderEffects[t[0]].getPostProcesses(); if (i) return i[0].samples = e, !0 } return !1 }, e.prototype.dispose = function () { }, b([tn.serialize()], e.prototype, "_name", void 0), e }(), tn.PostProcessRenderPipeline = rn, nn = $a || ($a = {}), on = function () { function e(e, t, i) { void 0 === t && (t = nn.Engine.TEXTURETYPE_FLOAT), void 0 === i && (i = null); var r = this; this.useOnlyInActiveCamera = !1; var n = (this._scene = e)._getComponent(nn.SceneComponentConstants.NAME_DEPTHRENDERER); n || (n = new nn.DepthRendererSceneComponent(e), e._addComponent(n)), this._camera = i; var o = e.getEngine(); this._depthMap = new nn.RenderTargetTexture("depthMap", { width: o.getRenderWidth(), height: o.getRenderHeight() }, this._scene, !1, !0, t), this._depthMap.wrapU = nn.Texture.CLAMP_ADDRESSMODE, this._depthMap.wrapV = nn.Texture.CLAMP_ADDRESSMODE, this._depthMap.refreshRate = 1, this._depthMap.renderParticles = !1, this._depthMap.renderList = null, this._depthMap.activeCamera = this._camera, this._depthMap.ignoreCameraViewport = !0, this._depthMap.useCameraPostProcesses = !1, this._depthMap.onClearObservable.add(function (e) { e.clear(new nn.Color4(1, 1, 1, 1), !0, !0, !0) }); var s = function (e) { var t = e.getRenderingMesh(), i = r._scene, n = i.getEngine(), o = e.getMaterial(); if (o) { n.setState(o.backFaceCulling, 0, !1, i.useRightHandedSystem); var s = t._getInstancesRenderList(e._id); if (!s.mustReturn) { var a = n.getCaps().instancedArrays && null !== s.visibleInstances[e._id], l = r._camera || i.activeCamera; if (r.isReady(e, a) && l) { if (n.enableEffect(r._effect), t._bind(e, r._effect, nn.Material.TriangleFillMode), r._effect.setMatrix("viewProjection", i.getTransformMatrix()), r._effect.setFloat2("depthValues", l.minZ, l.minZ + l.maxZ), o && o.needAlphaTesting()) { var c = o.getAlphaTestTexture(); c && (r._effect.setTexture("diffuseSampler", c), r._effect.setMatrix("diffuseMatrix", c.getTextureMatrix())) } t.useBones && t.computeBonesUsingShaders && t.skeleton && r._effect.setMatrices("mBones", t.skeleton.getTransformMatrices(t)), t._processRendering(e, r._effect, nn.Material.TriangleFillMode, s, a, function (e, t) { return r._effect.setMatrix("world", t) }) } } } }; this._depthMap.customRenderFunction = function (e, t, i, r) { var n; if (r.length) { for (o.setColorWrite(!1), n = 0; n < r.length; n++)s(r.data[n]); o.setColorWrite(!0) } for (n = 0; n < e.length; n++)s(e.data[n]); for (n = 0; n < t.length; n++)s(t.data[n]) } } return e.prototype.isReady = function (e, t) { var i = e.getMaterial(); if (i.disableDepthWrite) return !1; var r = [], n = [nn.VertexBuffer.PositionKind], o = e.getMesh(); i && i.needAlphaTesting() && i.getAlphaTestTexture() && (r.push("#define ALPHATEST"), o.isVerticesDataPresent(nn.VertexBuffer.UVKind) && (n.push(nn.VertexBuffer.UVKind), r.push("#define UV1")), o.isVerticesDataPresent(nn.VertexBuffer.UV2Kind) && (n.push(nn.VertexBuffer.UV2Kind), r.push("#define UV2"))), o.useBones && o.computeBonesUsingShaders ? (n.push(nn.VertexBuffer.MatricesIndicesKind), n.push(nn.VertexBuffer.MatricesWeightsKind), 4 < o.numBoneInfluencers && (n.push(nn.VertexBuffer.MatricesIndicesExtraKind), n.push(nn.VertexBuffer.MatricesWeightsExtraKind)), r.push("#define NUM_BONE_INFLUENCERS " + o.numBoneInfluencers), r.push("#define BonesPerMesh " + (o.skeleton ? o.skeleton.bones.length + 1 : 0))) : r.push("#define NUM_BONE_INFLUENCERS 0"), t && (r.push("#define INSTANCES"), n.push("world0"), n.push("world1"), n.push("world2"), n.push("world3")); var s = r.join("\n"); return this._cachedDefines !== s && (this._cachedDefines = s, this._effect = this._scene.getEngine().createEffect("depth", n, ["world", "mBones", "viewProjection", "diffuseMatrix", "depthValues"], ["diffuseSampler"], s)), this._effect.isReady() }, e.prototype.getDepthMap = function () { return this._depthMap }, e.prototype.dispose = function () { this._depthMap.dispose() }, e }(), nn.DepthRenderer = on, function (e) { e.Scene.prototype.enableDepthRenderer = function (t) { if (!(t = t || this.activeCamera)) throw "No camera available to enable depth renderer"; if (this._depthRenderer || (this._depthRenderer = {}), !this._depthRenderer[t.id]) { var i = 0; if (this.getEngine().getCaps().textureHalfFloatRender) i = e.Engine.TEXTURETYPE_HALF_FLOAT; else { if (!this.getEngine().getCaps().textureFloatRender) throw "Depth renderer does not support int texture type"; i = e.Engine.TEXTURETYPE_FLOAT } this._depthRenderer[t.id] = new e.DepthRenderer(this, i, t) } return this._depthRenderer[t.id] }, e.Scene.prototype.disableDepthRenderer = function (e) { (e = e || this.activeCamera) && this._depthRenderer && this._depthRenderer[e.id] && (this._depthRenderer[e.id].dispose(), delete this._depthRenderer[e.id]) }; var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_DEPTHRENDERER, this.scene = t } return t.prototype.register = function () { this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_DEPTHRENDERER, this, this._gatherRenderTargets), this.scene._gatherActiveCameraRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER, this, this._gatherActiveCameraRenderTargets) }, t.prototype.rebuild = function () { }, t.prototype.dispose = function () { for (var e in this.scene._depthRenderer) this.scene._depthRenderer[e].dispose() }, t.prototype._gatherRenderTargets = function (e) { if (this.scene._depthRenderer) for (var t in this.scene._depthRenderer) { var i = this.scene._depthRenderer[t]; i.useOnlyInActiveCamera || e.push(i.getDepthMap()) } }, t.prototype._gatherActiveCameraRenderTargets = function (e) { if (this.scene._depthRenderer) for (var t in this.scene._depthRenderer) { var i = this.scene._depthRenderer[t]; i.useOnlyInActiveCamera && this.scene.activeCamera.id === t && e.push(i.getDepthMap()) } }, t }(); e.DepthRendererSceneComponent = t }($a || ($a = {})), sn = $a || ($a = {}), an = function () { function e(e, t) { void 0 === t && (t = 1), this._enablePosition = !1, this._scene = e, this._ratio = t; var i = e._getComponent(sn.SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER); i || (i = new sn.GeometryBufferRendererSceneComponent(e), e._addComponent(i)), this._createRenderTargets() } return Object.defineProperty(e.prototype, "renderList", { set: function (e) { this._multiRenderTarget.renderList = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "isSupported", { get: function () { return this._multiRenderTarget.isSupported }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "enablePosition", { get: function () { return this._enablePosition }, set: function (e) { this._enablePosition = e, this.dispose(), this._createRenderTargets() }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "scene", { get: function () { return this._scene }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "ratio", { get: function () { return this._ratio }, enumerable: !0, configurable: !0 }), e.prototype.isReady = function (e, t) { var i = e.getMaterial(); if (i && i.disableDepthWrite) return !1; var r = [], n = [sn.VertexBuffer.PositionKind, sn.VertexBuffer.NormalKind], o = e.getMesh(); i && i.needAlphaTesting() && (r.push("#define ALPHATEST"), o.isVerticesDataPresent(sn.VertexBuffer.UVKind) && (n.push(sn.VertexBuffer.UVKind), r.push("#define UV1")), o.isVerticesDataPresent(sn.VertexBuffer.UV2Kind) && (n.push(sn.VertexBuffer.UV2Kind), r.push("#define UV2"))), this._enablePosition && r.push("#define POSITION"), o.useBones && o.computeBonesUsingShaders ? (n.push(sn.VertexBuffer.MatricesIndicesKind), n.push(sn.VertexBuffer.MatricesWeightsKind), 4 < o.numBoneInfluencers && (n.push(sn.VertexBuffer.MatricesIndicesExtraKind), n.push(sn.VertexBuffer.MatricesWeightsExtraKind)), r.push("#define NUM_BONE_INFLUENCERS " + o.numBoneInfluencers), r.push("#define BonesPerMesh " + (o.skeleton ? o.skeleton.bones.length + 1 : 0))) : r.push("#define NUM_BONE_INFLUENCERS 0"), t && (r.push("#define INSTANCES"), n.push("world0"), n.push("world1"), n.push("world2"), n.push("world3")); var s = r.join("\n"); return this._cachedDefines !== s && (this._cachedDefines = s, this._effect = this._scene.getEngine().createEffect("geometry", n, ["world", "mBones", "viewProjection", "diffuseMatrix", "view"], ["diffuseSampler"], s, void 0, void 0, void 0, { buffersCount: this._enablePosition ? 3 : 2 })), this._effect.isReady() }, e.prototype.getGBuffer = function () { return this._multiRenderTarget }, Object.defineProperty(e.prototype, "samples", { get: function () { return this._multiRenderTarget.samples }, set: function (e) { this._multiRenderTarget.samples = e }, enumerable: !0, configurable: !0 }), e.prototype.dispose = function () { this.getGBuffer().dispose() }, e.prototype._createRenderTargets = function () { var e = this, t = this._scene.getEngine(), i = this._enablePosition ? 3 : 2; if (this._multiRenderTarget = new sn.MultiRenderTarget("gBuffer", { width: t.getRenderWidth() * this._ratio, height: t.getRenderHeight() * this._ratio }, i, this._scene, { generateMipMaps: !1, generateDepthTexture: !0, defaultType: sn.Engine.TEXTURETYPE_FLOAT }), this.isSupported) { this._multiRenderTarget.wrapU = sn.Texture.CLAMP_ADDRESSMODE, this._multiRenderTarget.wrapV = sn.Texture.CLAMP_ADDRESSMODE, this._multiRenderTarget.refreshRate = 1, this._multiRenderTarget.renderParticles = !1, this._multiRenderTarget.renderList = null, this._multiRenderTarget.onClearObservable.add(function (e) { e.clear(new sn.Color4(0, 0, 0, 1), !0, !0, !0) }); var r = function (t) { var i = t.getRenderingMesh(), r = e._scene, n = r.getEngine(), o = t.getMaterial(); if (o) { n.setState(o.backFaceCulling, 0, !1, r.useRightHandedSystem); var s = i._getInstancesRenderList(t._id); if (!s.mustReturn) { var a = n.getCaps().instancedArrays && null !== s.visibleInstances[t._id]; if (e.isReady(t, a)) { if (n.enableEffect(e._effect), i._bind(t, e._effect, sn.Material.TriangleFillMode), e._effect.setMatrix("viewProjection", r.getTransformMatrix()), e._effect.setMatrix("view", r.getViewMatrix()), o && o.needAlphaTesting()) { var l = o.getAlphaTestTexture(); l && (e._effect.setTexture("diffuseSampler", l), e._effect.setMatrix("diffuseMatrix", l.getTextureMatrix())) } i.useBones && i.computeBonesUsingShaders && i.skeleton && e._effect.setMatrices("mBones", i.skeleton.getTransformMatrices(i)), i._processRendering(t, e._effect, sn.Material.TriangleFillMode, s, a, function (t, i) { return e._effect.setMatrix("world", i) }) } } } }; this._multiRenderTarget.customRenderFunction = function (e, i, n, o) { var s; if (o.length) { for (t.setColorWrite(!1), s = 0; s < o.length; s++)r(o.data[s]); t.setColorWrite(!0) } for (s = 0; s < e.length; s++)r(e.data[s]); for (s = 0; s < i.length; s++)r(i.data[s]) } } }, e }(), sn.GeometryBufferRenderer = an, function (e) { Object.defineProperty(e.Scene.prototype, "geometryBufferRenderer", { get: function () { this._geometryBufferRenderer }, set: function (e) { e && e.isSupported && (this._geometryBufferRenderer = e) }, enumerable: !0, configurable: !0 }), e.Scene.prototype.enableGeometryBufferRenderer = function (t) { return void 0 === t && (t = 1), this._geometryBufferRenderer || (this._geometryBufferRenderer = new e.GeometryBufferRenderer(this, t), this._geometryBufferRenderer.isSupported || (this._geometryBufferRenderer = null)), this._geometryBufferRenderer }, e.Scene.prototype.disableGeometryBufferRenderer = function () { this._geometryBufferRenderer && (this._geometryBufferRenderer.dispose(), this._geometryBufferRenderer = null) }; var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER, this.scene = t } return t.prototype.register = function () { this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER, this, this._gatherRenderTargets) }, t.prototype.rebuild = function () { }, t.prototype.dispose = function () { }, t.prototype._gatherRenderTargets = function (e) { this.scene._geometryBufferRenderer && e.push(this.scene._geometryBufferRenderer.getGBuffer()) }, t }(); e.GeometryBufferRendererSceneComponent = t }($a || ($a = {})), cn = function (e) { function t(t, i, r, n) { var o = e.call(this, i.getEngine(), t) || this; o.SSAOOriginalSceneColorEffect = "SSAOOriginalSceneColorEffect", o.SSAORenderEffect = "SSAORenderEffect", o.SSAOBlurHRenderEffect = "SSAOBlurHRenderEffect", o.SSAOBlurVRenderEffect = "SSAOBlurVRenderEffect", o.SSAOCombineRenderEffect = "SSAOCombineRenderEffect", o.totalStrength = 1, o.radius = 1e-4, o.area = .0075, o.fallOff = 1e-6, o.base = .5, o._firstUpdate = !0, o._scene = i, o._createRandomTexture(), o._depthTexture = i.enableDepthRenderer().getDepthMap(); var s = r.ssaoRatio || r, a = r.combineRatio || r; return o._originalColorPostProcess = new ln.PassPostProcess("SSAOOriginalSceneColor", a, null, ln.Texture.BILINEAR_SAMPLINGMODE, i.getEngine(), !1), o._createSSAOPostProcess(s), o._createBlurPostProcess(s), o._createSSAOCombinePostProcess(a), o.addEffect(new ln.PostProcessRenderEffect(i.getEngine(), o.SSAOOriginalSceneColorEffect, function () { return o._originalColorPostProcess }, !0)), o.addEffect(new ln.PostProcessRenderEffect(i.getEngine(), o.SSAORenderEffect, function () { return o._ssaoPostProcess }, !0)), o.addEffect(new ln.PostProcessRenderEffect(i.getEngine(), o.SSAOBlurHRenderEffect, function () { return o._blurHPostProcess }, !0)), o.addEffect(new ln.PostProcessRenderEffect(i.getEngine(), o.SSAOBlurVRenderEffect, function () { return o._blurVPostProcess }, !0)), o.addEffect(new ln.PostProcessRenderEffect(i.getEngine(), o.SSAOCombineRenderEffect, function () { return o._ssaoCombinePostProcess }, !0)), i.postProcessRenderPipelineManager.addPipeline(o), n && i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t, n), o } return T(t, e), t.prototype.dispose = function (t) { void 0 === t && (t = !1); for (var i = 0; i < this._scene.cameras.length; i++) { var r = this._scene.cameras[i]; this._originalColorPostProcess.dispose(r), this._ssaoPostProcess.dispose(r), this._blurHPostProcess.dispose(r), this._blurVPostProcess.dispose(r), this._ssaoCombinePostProcess.dispose(r) } this._randomTexture.dispose(), t && this._scene.disableDepthRenderer(), this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._scene.cameras), e.prototype.dispose.call(this) }, t.prototype._createBlurPostProcess = function (e) { var t = this; this._blurHPostProcess = new ln.BlurPostProcess("BlurH", new ln.Vector2(1, 0), 16, e, null, ln.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, ln.Engine.TEXTURETYPE_UNSIGNED_INT), this._blurVPostProcess = new ln.BlurPostProcess("BlurV", new ln.Vector2(0, 1), 16, e, null, ln.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, ln.Engine.TEXTURETYPE_UNSIGNED_INT), this._blurHPostProcess.onActivateObservable.add(function () { var e = t._blurHPostProcess.width / t._scene.getEngine().getRenderWidth(); t._blurHPostProcess.kernel = 16 * e }), this._blurVPostProcess.onActivateObservable.add(function () { var e = t._blurVPostProcess.height / t._scene.getEngine().getRenderHeight(); t._blurVPostProcess.kernel = 16 * e }) }, t.prototype._rebuild = function () { this._firstUpdate = !0, e.prototype._rebuild.call(this) }, t.prototype._createSSAOPostProcess = function (e) { var t = this, i = [.5381, .1856, -.4319, .1379, .2486, .443, .3371, .5679, -.0057, -.6999, -.0451, -.0019, .0689, -.1598, -.8547, .056, .0069, -.1843, -.0146, .1402, .0762, .01, -.1924, -.0344, -.3577, -.5301, -.4358, -.3169, .1063, .0158, .0103, -.5869, .0046, -.0897, -.494, .3287, .7119, -.0154, -.0918, -.0533, .0596, -.5411, .0352, -.0631, .546, -.4776, .2847, -.0271]; this._ssaoPostProcess = new ln.PostProcess("ssao", "ssao", ["sampleSphere", "samplesFactor", "randTextureTiles", "totalStrength", "radius", "area", "fallOff", "base", "range", "viewport"], ["randomSampler"], e, null, ln.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, "#define SAMPLES 16\n#define SSAO"), this._ssaoPostProcess.onApply = function (e) { t._firstUpdate && (e.setArray3("sampleSphere", i), e.setFloat("samplesFactor", 1 / 16), e.setFloat("randTextureTiles", 4)), e.setFloat("totalStrength", t.totalStrength), e.setFloat("radius", t.radius), e.setFloat("area", t.area), e.setFloat("fallOff", t.fallOff), e.setFloat("base", t.base), e.setTexture("textureSampler", t._depthTexture), e.setTexture("randomSampler", t._randomTexture) } }, t.prototype._createSSAOCombinePostProcess = function (e) { var t = this; this._ssaoCombinePostProcess = new ln.PostProcess("ssaoCombine", "ssaoCombine", [], ["originalColor", "viewport"], e, null, ln.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1), this._ssaoCombinePostProcess.onApply = function (e) { e.setVector4("viewport", ln.Tmp.Vector4[0].copyFromFloats(0, 0, 1, 1)), e.setTextureFromPostProcess("originalColor", t._originalColorPostProcess) } }, t.prototype._createRandomTexture = function () { this._randomTexture = new ln.DynamicTexture("SSAORandomTexture", 512, this._scene, !1, ln.Texture.TRILINEAR_SAMPLINGMODE), this._randomTexture.wrapU = ln.Texture.WRAP_ADDRESSMODE, this._randomTexture.wrapV = ln.Texture.WRAP_ADDRESSMODE; for (var e = this._randomTexture.getContext(), t = function (e, t) { return Math.random() * (t - e) + e }, i = ln.Vector3.Zero(), r = 0; r < 512; r++)for (var n = 0; n < 512; n++)i.x = Math.floor(255 * t(-1, 1)), i.y = Math.floor(255 * t(-1, 1)), i.z = Math.floor(255 * t(-1, 1)), e.fillStyle = "rgb(" + i.x + ", " + i.y + ", " + i.z + ")", e.fillRect(r, n, 1, 1); this._randomTexture.update(!1) }, b([ln.serialize()], t.prototype, "totalStrength", void 0), b([ln.serialize()], t.prototype, "radius", void 0), b([ln.serialize()], t.prototype, "area", void 0), b([ln.serialize()], t.prototype, "fallOff", void 0), b([ln.serialize()], t.prototype, "base", void 0), t }((ln = $a || ($a = {})).PostProcessRenderPipeline), ln.SSAORenderingPipeline = cn, un = function (e) { function t(t, i, r, n) { var o = e.call(this, i.getEngine(), t) || this; if (o.SSAOOriginalSceneColorEffect = "SSAOOriginalSceneColorEffect", o.SSAORenderEffect = "SSAORenderEffect", o.SSAOBlurHRenderEffect = "SSAOBlurHRenderEffect", o.SSAOBlurVRenderEffect = "SSAOBlurVRenderEffect", o.SSAOCombineRenderEffect = "SSAOCombineRenderEffect", o.totalStrength = 1, o.maxZ = 100, o.minZAspect = .2, o._samples = 8, o._textureSamples = 1, o._expensiveBlur = !0, o.radius = 2, o.base = 0, o._firstUpdate = !0, o._bits = new Uint32Array(1), o._scene = i, o._ratio = r, !o.isSupported) return hn.Tools.Error("SSAO 2 needs WebGL 2 support."), o; var s = o._ratio.ssaoRatio || r, a = o._ratio.blurRatio || r, l = i.enableGeometryBufferRenderer(); return o._createRandomTexture(), o._depthTexture = l.getGBuffer().textures[0], o._normalTexture = l.getGBuffer().textures[1], o._originalColorPostProcess = new hn.PassPostProcess("SSAOOriginalSceneColor", 1, null, hn.Texture.BILINEAR_SAMPLINGMODE, i.getEngine(), !1), o._originalColorPostProcess.samples = o.textureSamples, o._createSSAOPostProcess(1), o._createBlurPostProcess(s, a), o._createSSAOCombinePostProcess(a), o.addEffect(new hn.PostProcessRenderEffect(i.getEngine(), o.SSAOOriginalSceneColorEffect, function () { return o._originalColorPostProcess }, !0)), o.addEffect(new hn.PostProcessRenderEffect(i.getEngine(), o.SSAORenderEffect, function () { return o._ssaoPostProcess }, !0)), o.addEffect(new hn.PostProcessRenderEffect(i.getEngine(), o.SSAOBlurHRenderEffect, function () { return o._blurHPostProcess }, !0)), o.addEffect(new hn.PostProcessRenderEffect(i.getEngine(), o.SSAOBlurVRenderEffect, function () { return o._blurVPostProcess }, !0)), o.addEffect(new hn.PostProcessRenderEffect(i.getEngine(), o.SSAOCombineRenderEffect, function () { return o._ssaoCombinePostProcess }, !0)), i.postProcessRenderPipelineManager.addPipeline(o), n && i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t, n), o } return T(t, e), Object.defineProperty(t.prototype, "samples", { get: function () { return this._samples }, set: function (e) { this._ssaoPostProcess.updateEffect("#define SAMPLES " + e + "\n#define SSAO"), this._samples = e, this._sampleSphere = this._generateHemisphere(), this._firstUpdate = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "textureSamples", { get: function () { return this._textureSamples }, set: function (e) { this._textureSamples = e, this._originalColorPostProcess.samples = e, this._blurHPostProcess.samples = e, this._blurVPostProcess.samples = e, this._ssaoPostProcess.samples = e, this._ssaoCombinePostProcess.samples = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "expensiveBlur", { get: function () { return this._expensiveBlur }, set: function (e) { this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE " + (e ? "1" : "0") + "\n", null, ["textureSampler", "depthSampler"]), this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE " + (e ? "1" : "0") + "\n", null, ["textureSampler", "depthSampler"]), this._expensiveBlur = e, this._firstUpdate = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "IsSupported", { get: function () { var e = hn.Engine.LastCreatedEngine; return !!e && e.getCaps().drawBuffersExtension }, enumerable: !0, configurable: !0 }), t.prototype.dispose = function (t) { void 0 === t && (t = !1); for (var i = 0; i < this._scene.cameras.length; i++) { var r = this._scene.cameras[i]; this._originalColorPostProcess.dispose(r), this._ssaoPostProcess.dispose(r), this._blurHPostProcess.dispose(r), this._blurVPostProcess.dispose(r), this._ssaoCombinePostProcess.dispose(r) } this._randomTexture.dispose(), t && this._scene.disableGeometryBufferRenderer(), this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._scene.cameras), e.prototype.dispose.call(this) }, t.prototype._createBlurPostProcess = function (e, t) { var i = this; this._samplerOffsets = []; for (var r = this.expensiveBlur, n = -8; n < 8; n++)this._samplerOffsets.push(2 * n + .5); this._blurHPostProcess = new hn.PostProcess("BlurH", "ssao2", ["outSize", "samplerOffsets", "near", "far", "radius"], ["depthSampler"], e, null, hn.Texture.TRILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, "#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE " + (r ? "1" : "0") + "\n"), this._blurHPostProcess.onApply = function (e) { i._scene.activeCamera && (e.setFloat("outSize", 0 < i._ssaoCombinePostProcess.width ? i._ssaoCombinePostProcess.width : i._originalColorPostProcess.width), e.setFloat("near", i._scene.activeCamera.minZ), e.setFloat("far", i._scene.activeCamera.maxZ), e.setFloat("radius", i.radius), e.setTexture("depthSampler", i._depthTexture), i._firstUpdate && e.setArray("samplerOffsets", i._samplerOffsets)) }, this._blurVPostProcess = new hn.PostProcess("BlurV", "ssao2", ["outSize", "samplerOffsets", "near", "far", "radius"], ["depthSampler"], t, null, hn.Texture.TRILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, "#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE " + (r ? "1" : "0") + "\n"), this._blurVPostProcess.onApply = function (e) { i._scene.activeCamera && (e.setFloat("outSize", 0 < i._ssaoCombinePostProcess.height ? i._ssaoCombinePostProcess.height : i._originalColorPostProcess.height), e.setFloat("near", i._scene.activeCamera.minZ), e.setFloat("far", i._scene.activeCamera.maxZ), e.setFloat("radius", i.radius), e.setTexture("depthSampler", i._depthTexture), i._firstUpdate && (e.setArray("samplerOffsets", i._samplerOffsets), i._firstUpdate = !1)) }, this._blurHPostProcess.samples = this.textureSamples, this._blurVPostProcess.samples = this.textureSamples }, t.prototype._rebuild = function () { this._firstUpdate = !0, e.prototype._rebuild.call(this) }, t.prototype._radicalInverse_VdC = function (e) { return this._bits[0] = e, this._bits[0] = (this._bits[0] << 16 | this._bits[0] >> 16) >>> 0, this._bits[0] = (1431655765 & this._bits[0]) << 1 | (2863311530 & this._bits[0]) >>> 1 >>> 0, this._bits[0] = (858993459 & this._bits[0]) << 2 | (3435973836 & this._bits[0]) >>> 2 >>> 0, this._bits[0] = (252645135 & this._bits[0]) << 4 | (4042322160 & this._bits[0]) >>> 4 >>> 0, this._bits[0] = (16711935 & this._bits[0]) << 8 | (4278255360 & this._bits[0]) >>> 8 >>> 0, 2.3283064365386963e-10 * this._bits[0] }, t.prototype._hammersley = function (e, t) { return [e / t, this._radicalInverse_VdC(e)] }, t.prototype._hemisphereSample_uniform = function (e, t) { var i = 2 * t * Math.PI, r = 1 - (.85 * e + .15), n = Math.sqrt(1 - r * r); return new hn.Vector3(Math.cos(i) * n, Math.sin(i) * n, r) }, t.prototype._generateHemisphere = function () { for (var e, t = this.samples, i = [], r = 0; r < t;) { if (t < 16) e = this._hemisphereSample_uniform(Math.random(), Math.random()); else { var n = this._hammersley(r, t); e = this._hemisphereSample_uniform(n[0], n[1]) } i.push(e.x, e.y, e.z), r++ } return i }, t.prototype._createSSAOPostProcess = function (e) { var t = this, i = this.samples; this._sampleSphere = this._generateHemisphere(), this._ssaoPostProcess = new hn.PostProcess("ssao2", "ssao2", ["sampleSphere", "samplesFactor", "randTextureTiles", "totalStrength", "radius", "base", "range", "projection", "near", "far", "texelSize", "xViewport", "yViewport", "maxZ", "minZAspect"], ["randomSampler", "normalSampler"], e, null, hn.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, "#define SAMPLES " + i + "\n#define SSAO"), this._ssaoPostProcess.onApply = function (e) { t._firstUpdate && (e.setArray3("sampleSphere", t._sampleSphere), e.setFloat("randTextureTiles", 32)), t._scene.activeCamera && (e.setFloat("samplesFactor", 1 / t.samples), e.setFloat("totalStrength", t.totalStrength), e.setFloat2("texelSize", 1 / t._ssaoPostProcess.width, 1 / t._ssaoPostProcess.height), e.setFloat("radius", t.radius), e.setFloat("maxZ", t.maxZ), e.setFloat("minZAspect", t.minZAspect), e.setFloat("base", t.base), e.setFloat("near", t._scene.activeCamera.minZ), e.setFloat("far", t._scene.activeCamera.maxZ), e.setFloat("xViewport", Math.tan(t._scene.activeCamera.fov / 2) * t._scene.getEngine().getAspectRatio(t._scene.activeCamera, !0)), e.setFloat("yViewport", Math.tan(t._scene.activeCamera.fov / 2)), e.setMatrix("projection", t._scene.getProjectionMatrix()), e.setTexture("textureSampler", t._depthTexture), e.setTexture("normalSampler", t._normalTexture), e.setTexture("randomSampler", t._randomTexture)) }, this._ssaoPostProcess.samples = this.textureSamples }, t.prototype._createSSAOCombinePostProcess = function (e) { var t = this; this._ssaoCombinePostProcess = new hn.PostProcess("ssaoCombine", "ssaoCombine", [], ["originalColor", "viewport"], e, null, hn.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1), this._ssaoCombinePostProcess.onApply = function (e) { var i = t._scene.activeCamera.viewport; e.setVector4("viewport", hn.Tmp.Vector4[0].copyFromFloats(i.x, i.y, i.width, i.height)), e.setTextureFromPostProcess("originalColor", t._originalColorPostProcess) }, this._ssaoCombinePostProcess.samples = this.textureSamples }, t.prototype._createRandomTexture = function () { this._randomTexture = new hn.DynamicTexture("SSAORandomTexture", 128, this._scene, !1, hn.Texture.TRILINEAR_SAMPLINGMODE), this._randomTexture.wrapU = hn.Texture.WRAP_ADDRESSMODE, this._randomTexture.wrapV = hn.Texture.WRAP_ADDRESSMODE; for (var e = this._randomTexture.getContext(), t = function (e, t) { return Math.random() * (t - e) + e }, i = hn.Vector3.Zero(), r = 0; r < 128; r++)for (var n = 0; n < 128; n++)i.x = t(0, 1), i.y = t(0, 1), i.z = 0, i.normalize(), i.scaleInPlace(255), i.x = Math.floor(i.x), i.y = Math.floor(i.y), e.fillStyle = "rgb(" + i.x + ", " + i.y + ", " + i.z + ")", e.fillRect(r, n, 1, 1); this._randomTexture.update(!1) }, t.prototype.serialize = function () { var e = hn.SerializationHelper.Serialize(this); return e.customType = "SSAO2RenderingPipeline", e }, t.Parse = function (e, i, r) { return hn.SerializationHelper.Parse(function () { return new t(e._name, i, e._ratio) }, e, i, r) }, b([hn.serialize()], t.prototype, "totalStrength", void 0), b([hn.serialize()], t.prototype, "maxZ", void 0), b([hn.serialize()], t.prototype, "minZAspect", void 0), b([hn.serialize("samples")], t.prototype, "_samples", void 0), b([hn.serialize("textureSamples")], t.prototype, "_textureSamples", void 0), b([hn.serialize()], t.prototype, "_ratio", void 0), b([hn.serialize("expensiveBlur")], t.prototype, "_expensiveBlur", void 0), b([hn.serialize()], t.prototype, "radius", void 0), b([hn.serialize()], t.prototype, "base", void 0), t }((hn = $a || ($a = {})).PostProcessRenderPipeline), hn.SSAO2RenderingPipeline = un, fn = function (e) { function t(t, i, r, n, o) { void 0 === n && (n = 1); var s = e.call(this, r.getEngine(), t) || this; return s.LensChromaticAberrationEffect = "LensChromaticAberrationEffect", s.HighlightsEnhancingEffect = "HighlightsEnhancingEffect", s.LensDepthOfFieldEffect = "LensDepthOfFieldEffect", s._scene = r, s._depthTexture = r.enableDepthRenderer().getDepthMap(), i.grain_texture ? s._grainTexture = i.grain_texture : s._createGrainTexture(), s._edgeBlur = i.edge_blur ? i.edge_blur : 0, s._grainAmount = i.grain_amount ? i.grain_amount : 0, s._chromaticAberration = i.chromatic_aberration ? i.chromatic_aberration : 0, s._distortion = i.distortion ? i.distortion : 0, s._highlightsGain = void 0 !== i.dof_gain ? i.dof_gain : -1, s._highlightsThreshold = i.dof_threshold ? i.dof_threshold : 1, s._dofDistance = void 0 !== i.dof_focus_distance ? i.dof_focus_distance : -1, s._dofAperture = i.dof_aperture ? i.dof_aperture : 1, s._dofDarken = i.dof_darken ? i.dof_darken : 0, s._dofPentagon = void 0 === i.dof_pentagon || i.dof_pentagon, s._blurNoise = void 0 === i.blur_noise || i.blur_noise, s._createChromaticAberrationPostProcess(n), s._createHighlightsPostProcess(n), s._createDepthOfFieldPostProcess(n / 4), s.addEffect(new dn.PostProcessRenderEffect(r.getEngine(), s.LensChromaticAberrationEffect, function () { return s._chromaticAberrationPostProcess }, !0)), s.addEffect(new dn.PostProcessRenderEffect(r.getEngine(), s.HighlightsEnhancingEffect, function () { return s._highlightsPostProcess }, !0)), s.addEffect(new dn.PostProcessRenderEffect(r.getEngine(), s.LensDepthOfFieldEffect, function () { return s._depthOfFieldPostProcess }, !0)), -1 === s._highlightsGain && s._disableEffect(s.HighlightsEnhancingEffect, null), r.postProcessRenderPipelineManager.addPipeline(s), o && r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t, o), s } return T(t, e), t.prototype.setEdgeBlur = function (e) { this._edgeBlur = e }, t.prototype.disableEdgeBlur = function () { this._edgeBlur = 0 }, t.prototype.setGrainAmount = function (e) { this._grainAmount = e }, t.prototype.disableGrain = function () { this._grainAmount = 0 }, t.prototype.setChromaticAberration = function (e) { this._chromaticAberration = e }, t.prototype.disableChromaticAberration = function () { this._chromaticAberration = 0 }, t.prototype.setEdgeDistortion = function (e) { this._distortion = e }, t.prototype.disableEdgeDistortion = function () { this._distortion = 0 }, t.prototype.setFocusDistance = function (e) { this._dofDistance = e }, t.prototype.disableDepthOfField = function () { this._dofDistance = -1 }, t.prototype.setAperture = function (e) { this._dofAperture = e }, t.prototype.setDarkenOutOfFocus = function (e) { this._dofDarken = e }, t.prototype.enablePentagonBokeh = function () { this._highlightsPostProcess.updateEffect("#define PENTAGON\n") }, t.prototype.disablePentagonBokeh = function () { this._highlightsPostProcess.updateEffect() }, t.prototype.enableNoiseBlur = function () { this._blurNoise = !0 }, t.prototype.disableNoiseBlur = function () { this._blurNoise = !1 }, t.prototype.setHighlightsGain = function (e) { this._highlightsGain = e }, t.prototype.setHighlightsThreshold = function (e) { -1 === this._highlightsGain && (this._highlightsGain = 1), this._highlightsThreshold = e }, t.prototype.disableHighlights = function () { this._highlightsGain = -1 }, t.prototype.dispose = function (e) { void 0 === e && (e = !1), this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._scene.cameras), this._chromaticAberrationPostProcess = null, this._highlightsPostProcess = null, this._depthOfFieldPostProcess = null, this._grainTexture.dispose(), e && this._scene.disableDepthRenderer() }, t.prototype._createChromaticAberrationPostProcess = function (e) { var t = this; this._chromaticAberrationPostProcess = new dn.PostProcess("LensChromaticAberration", "chromaticAberration", ["chromatic_aberration", "screen_width", "screen_height", "direction", "radialIntensity", "centerPosition"], [], e, null, dn.Texture.TRILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1), this._chromaticAberrationPostProcess.onApply = function (e) { e.setFloat("chromatic_aberration", t._chromaticAberration), e.setFloat("screen_width", t._scene.getEngine().getRenderWidth()), e.setFloat("screen_height", t._scene.getEngine().getRenderHeight()), e.setFloat("radialIntensity", 1), e.setFloat2("direction", 17, 17), e.setFloat2("centerPosition", .5, .5) } }, t.prototype._createHighlightsPostProcess = function (e) { var t = this; this._highlightsPostProcess = new dn.PostProcess("LensHighlights", "lensHighlights", ["gain", "threshold", "screen_width", "screen_height"], [], e, null, dn.Texture.TRILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, this._dofPentagon ? "#define PENTAGON\n" : ""), this._highlightsPostProcess.onApply = function (e) { e.setFloat("gain", t._highlightsGain), e.setFloat("threshold", t._highlightsThreshold), e.setTextureFromPostProcess("textureSampler", t._chromaticAberrationPostProcess), e.setFloat("screen_width", t._scene.getEngine().getRenderWidth()), e.setFloat("screen_height", t._scene.getEngine().getRenderHeight()) } }, t.prototype._createDepthOfFieldPostProcess = function (e) { var t = this; this._depthOfFieldPostProcess = new dn.PostProcess("LensDepthOfField", "depthOfField", ["grain_amount", "blur_noise", "screen_width", "screen_height", "distortion", "dof_enabled", "screen_distance", "aperture", "darken", "edge_blur", "highlights", "near", "far"], ["depthSampler", "grainSampler", "highlightsSampler"], e, null, dn.Texture.TRILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1), this._depthOfFieldPostProcess.onApply = function (e) { e.setTexture("depthSampler", t._depthTexture), e.setTexture("grainSampler", t._grainTexture), e.setTextureFromPostProcess("textureSampler", t._highlightsPostProcess), e.setTextureFromPostProcess("highlightsSampler", t._depthOfFieldPostProcess), e.setFloat("grain_amount", t._grainAmount), e.setBool("blur_noise", t._blurNoise), e.setFloat("screen_width", t._scene.getEngine().getRenderWidth()), e.setFloat("screen_height", t._scene.getEngine().getRenderHeight()), e.setFloat("distortion", t._distortion), e.setBool("dof_enabled", -1 !== t._dofDistance), e.setFloat("screen_distance", 1 / (.1 - 1 / t._dofDistance)), e.setFloat("aperture", t._dofAperture), e.setFloat("darken", t._dofDarken), e.setFloat("edge_blur", t._edgeBlur), e.setBool("highlights", -1 !== t._highlightsGain), t._scene.activeCamera && (e.setFloat("near", t._scene.activeCamera.minZ), e.setFloat("far", t._scene.activeCamera.maxZ)) } }, t.prototype._createGrainTexture = function () { this._grainTexture = new dn.DynamicTexture("LensNoiseTexture", 512, this._scene, !1, dn.Texture.BILINEAR_SAMPLINGMODE), this._grainTexture.wrapU = dn.Texture.WRAP_ADDRESSMODE, this._grainTexture.wrapV = dn.Texture.WRAP_ADDRESSMODE; for (var e, t = this._grainTexture.getContext(), i = 0; i < 512; i++)for (var r = 0; r < 512; r++)e = Math.floor(255 * (.42, .58, Math.random() * (.58 - .42) + .42)), t.fillStyle = "rgb(" + e + ", " + e + ", " + e + ")", t.fillRect(i, r, 1, 1); this._grainTexture.update(!1) }, t }((dn = $a || ($a = {})).PostProcessRenderPipeline), dn.LensRenderingPipeline = fn, _n = function (e) { function t(t, i, r, n, o) { void 0 === n && (n = null); var s = e.call(this, i.getEngine(), t) || this; return s.downSampleX4PostProcess = null, s.brightPassPostProcess = null, s.blurHPostProcesses = [], s.blurVPostProcesses = [], s.textureAdderPostProcess = null, s.volumetricLightPostProcess = null, s.volumetricLightSmoothXPostProcess = null, s.volumetricLightSmoothYPostProcess = null, s.volumetricLightMergePostProces = null, s.volumetricLightFinalPostProcess = null, s.luminancePostProcess = null, s.luminanceDownSamplePostProcesses = [], s.hdrPostProcess = null, s.textureAdderFinalPostProcess = null, s.lensFlareFinalPostProcess = null, s.hdrFinalPostProcess = null, s.lensFlarePostProcess = null, s.lensFlareComposePostProcess = null, s.motionBlurPostProcess = null, s.depthOfFieldPostProcess = null, s.fxaaPostProcess = null, s.brightThreshold = 1, s.blurWidth = 512, s.horizontalBlur = !1, s.exposure = 1, s.lensTexture = null, s.volumetricLightCoefficient = .2, s.volumetricLightPower = 4, s.volumetricLightBlurScale = 64, s.sourceLight = null, s.hdrMinimumLuminance = 1, s.hdrDecreaseRate = .5, s.hdrIncreaseRate = .5, s.lensColorTexture = null, s.lensFlareStrength = 20, s.lensFlareGhostDispersal = 1.4, s.lensFlareHaloWidth = .7, s.lensFlareDistortionStrength = 16, s.lensStarTexture = null, s.lensFlareDirtTexture = null, s.depthOfFieldDistance = 10, s.depthOfFieldBlurWidth = 64, s.motionStrength = 1, s.animations = [], s._currentDepthOfFieldSource = null, s._hdrCurrentLuminance = 1, s._bloomEnabled = !1, s._depthOfFieldEnabled = !1, s._vlsEnabled = !1, s._lensFlareEnabled = !1, s._hdrEnabled = !1, s._motionBlurEnabled = !1, s._fxaaEnabled = !1, s._motionBlurSamples = 64, s._volumetricLightStepsCount = 50, s._samples = 1, s._cameras = o || [], s._scene = i, s._basePostProcess = n, s._ratio = r, s._floatTextureType = i.getEngine().getCaps().textureFloatRender ? pn.Engine.TEXTURETYPE_FLOAT : pn.Engine.TEXTURETYPE_HALF_FLOAT, i.postProcessRenderPipelineManager.addPipeline(s), s._buildPipeline(), s } return T(t, e), Object.defineProperty(t.prototype, "BloomEnabled", { get: function () { return this._bloomEnabled }, set: function (e) { this._bloomEnabled !== e && (this._bloomEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "DepthOfFieldEnabled", { get: function () { return this._depthOfFieldEnabled }, set: function (e) { this._depthOfFieldEnabled !== e && (this._depthOfFieldEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "LensFlareEnabled", { get: function () { return this._lensFlareEnabled }, set: function (e) { this._lensFlareEnabled !== e && (this._lensFlareEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "HDREnabled", { get: function () { return this._hdrEnabled }, set: function (e) { this._hdrEnabled !== e && (this._hdrEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "VLSEnabled", { get: function () { return this._vlsEnabled }, set: function (e) { if (this._vlsEnabled !== e) { if (e && !this._scene.enableGeometryBufferRenderer()) return void pn.Tools.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline"); this._vlsEnabled = e, this._buildPipeline() } }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "MotionBlurEnabled", { get: function () { return this._motionBlurEnabled }, set: function (e) { this._motionBlurEnabled !== e && (this._motionBlurEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "fxaaEnabled", { get: function () { return this._fxaaEnabled }, set: function (e) { this._fxaaEnabled !== e && (this._fxaaEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "volumetricLightStepsCount", { get: function () { return this._volumetricLightStepsCount }, set: function (e) { this.volumetricLightPostProcess && this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS " + e.toFixed(1)), this._volumetricLightStepsCount = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "motionBlurSamples", { get: function () { return this._motionBlurSamples }, set: function (e) { this.motionBlurPostProcess && this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES " + e.toFixed(1)), this._motionBlurSamples = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "samples", { get: function () { return this._samples }, set: function (e) { this._samples !== e && (this._samples = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), t.prototype._buildPipeline = function () { var e = this, t = this._ratio, i = this._scene; this._disposePostProcesses(), this._reset(), this._basePostProcess ? this.originalPostProcess = this._basePostProcess : (this.originalPostProcess = new pn.PostProcess("HDRPass", "standard", [], [], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, i.getEngine(), !1, "#define PASS_POST_PROCESS", this._floatTextureType), this.originalPostProcess.onApply = function (t) { e._currentDepthOfFieldSource = e.originalPostProcess }), (this._bloomEnabled || this._vlsEnabled || this._lensFlareEnabled || this._depthOfFieldEnabled || this._motionBlurEnabled) && this.addEffect(new pn.PostProcessRenderEffect(i.getEngine(), "HDRPassPostProcess", function () { return e.originalPostProcess }, !0)), this._currentDepthOfFieldSource = this.originalPostProcess, this._bloomEnabled && (this._createDownSampleX4PostProcess(i, t / 2), this._createBrightPassPostProcess(i, t / 2), this._createBlurPostProcesses(i, t / 4, 1), this._createTextureAdderPostProcess(i, t), this.textureAdderFinalPostProcess = new pn.PostProcess("HDRDepthOfFieldSource", "standard", [], [], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, i.getEngine(), !1, "#define PASS_POST_PROCESS", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.addEffect(new pn.PostProcessRenderEffect(i.getEngine(), "HDRBaseDepthOfFieldSource", function () { return e.textureAdderFinalPostProcess }, !0))), this._vlsEnabled && (this._createVolumetricLightPostProcess(i, t), this.volumetricLightFinalPostProcess = new pn.PostProcess("HDRVLSFinal", "standard", [], [], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, i.getEngine(), !1, "#define PASS_POST_PROCESS", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.addEffect(new pn.PostProcessRenderEffect(i.getEngine(), "HDRVLSFinal", function () { return e.volumetricLightFinalPostProcess }, !0))), this._lensFlareEnabled && (this._createLensFlarePostProcess(i, t), this.lensFlareFinalPostProcess = new pn.PostProcess("HDRPostLensFlareDepthOfFieldSource", "standard", [], [], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, i.getEngine(), !1, "#define PASS_POST_PROCESS", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.addEffect(new pn.PostProcessRenderEffect(i.getEngine(), "HDRPostLensFlareDepthOfFieldSource", function () { return e.lensFlareFinalPostProcess }, !0))), this._hdrEnabled && (this._createLuminancePostProcesses(i, this._floatTextureType), this._createHdrPostProcess(i, t), this.hdrFinalPostProcess = new pn.PostProcess("HDRPostHDReDepthOfFieldSource", "standard", [], [], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, i.getEngine(), !1, "#define PASS_POST_PROCESS", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.addEffect(new pn.PostProcessRenderEffect(i.getEngine(), "HDRPostHDReDepthOfFieldSource", function () { return e.hdrFinalPostProcess }, !0))), this._depthOfFieldEnabled && (this._createBlurPostProcesses(i, t / 2, 3, "depthOfFieldBlurWidth"), this._createDepthOfFieldPostProcess(i, t)), this._motionBlurEnabled && this._createMotionBlurPostProcess(i, t), this._fxaaEnabled && (this.fxaaPostProcess = new pn.FxaaPostProcess("fxaa", 1, null, pn.Texture.BILINEAR_SAMPLINGMODE, i.getEngine(), !1, pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.addEffect(new pn.PostProcessRenderEffect(i.getEngine(), "HDRFxaa", function () { return e.fxaaPostProcess }, !0))), null !== this._cameras && this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name, this._cameras), !this._enableMSAAOnFirstPostProcess(this._samples) && 1 < this._samples && pn.Tools.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0") }, t.prototype._createDownSampleX4PostProcess = function (e, t) { var i = this, r = new Array(32); this.downSampleX4PostProcess = new pn.PostProcess("HDRDownSampleX4", "standard", ["dsOffsets"], [], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define DOWN_SAMPLE_X4", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.downSampleX4PostProcess.onApply = function (e) { for (var t = 0, n = i.downSampleX4PostProcess.width, o = i.downSampleX4PostProcess.height, s = -2; s < 2; s++)for (var a = -2; a < 2; a++)r[t] = (s + .5) * (1 / n), r[t + 1] = (a + .5) * (1 / o), t += 2; e.setArray2("dsOffsets", r) }, this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRDownSampleX4", function () { return i.downSampleX4PostProcess }, !0)) }, t.prototype._createBrightPassPostProcess = function (e, t) { var i = this, r = new Array(8); this.brightPassPostProcess = new pn.PostProcess("HDRBrightPass", "standard", ["dsOffsets", "brightThreshold"], [], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define BRIGHT_PASS", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.brightPassPostProcess.onApply = function (e) { var t = 1 / i.brightPassPostProcess.width, n = 1 / i.brightPassPostProcess.height; r[0] = -.5 * t, r[1] = .5 * n, r[2] = .5 * t, r[3] = .5 * n, r[4] = -.5 * t, r[5] = -.5 * n, r[6] = .5 * t, r[7] = -.5 * n, e.setArray2("dsOffsets", r), e.setFloat("brightThreshold", i.brightThreshold) }, this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRBrightPass", function () { return i.brightPassPostProcess }, !0)) }, t.prototype._createBlurPostProcesses = function (e, t, i, r) { var n = this; void 0 === r && (r = "blurWidth"); var o = e.getEngine(), s = new pn.BlurPostProcess("HDRBlurH_" + i, new pn.Vector2(1, 0), this[r], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, pn.Engine.TEXTURETYPE_UNSIGNED_INT), a = new pn.BlurPostProcess("HDRBlurV_" + i, new pn.Vector2(0, 1), this[r], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, pn.Engine.TEXTURETYPE_UNSIGNED_INT); s.onActivateObservable.add(function () { var e = s.width / o.getRenderWidth(); s.kernel = n[r] * e }), a.onActivateObservable.add(function () { var e = a.height / o.getRenderHeight(); a.kernel = n.horizontalBlur ? 64 * e : n[r] * e }), this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRBlurH" + i, function () { return s }, !0)), this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRBlurV" + i, function () { return a }, !0)), this.blurHPostProcesses.push(s), this.blurVPostProcesses.push(a) }, t.prototype._createTextureAdderPostProcess = function (e, t) { var i = this; this.textureAdderPostProcess = new pn.PostProcess("HDRTextureAdder", "standard", ["exposure"], ["otherSampler", "lensSampler"], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define TEXTURE_ADDER", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.textureAdderPostProcess.onApply = function (e) { e.setTextureFromPostProcess("otherSampler", i._vlsEnabled ? i._currentDepthOfFieldSource : i.originalPostProcess), e.setTexture("lensSampler", i.lensTexture), e.setFloat("exposure", i.exposure), i._currentDepthOfFieldSource = i.textureAdderFinalPostProcess }, this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRTextureAdder", function () { return i.textureAdderPostProcess }, !0)) }, t.prototype._createVolumetricLightPostProcess = function (e, t) { var i = this, r = e.enableGeometryBufferRenderer(); r.enablePosition = !0; var n = r.getGBuffer(); this.volumetricLightPostProcess = new pn.PostProcess("HDRVLS", "standard", ["shadowViewProjection", "cameraPosition", "sunDirection", "sunColor", "scatteringCoefficient", "scatteringPower", "depthValues"], ["shadowMapSampler", "positionSampler"], t / 8, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define VLS\n#define NB_STEPS " + this._volumetricLightStepsCount.toFixed(1)); var o = pn.Vector2.Zero(); this.volumetricLightPostProcess.onApply = function (e) { if (i.sourceLight && i.sourceLight.getShadowGenerator() && i._scene.activeCamera) { var t = i.sourceLight.getShadowGenerator(); e.setTexture("shadowMapSampler", t.getShadowMap()), e.setTexture("positionSampler", n.textures[2]), e.setColor3("sunColor", i.sourceLight.diffuse), e.setVector3("sunDirection", i.sourceLight.getShadowDirection()), e.setVector3("cameraPosition", i._scene.activeCamera.globalPosition), e.setMatrix("shadowViewProjection", t.getTransformMatrix()), e.setFloat("scatteringCoefficient", i.volumetricLightCoefficient), e.setFloat("scatteringPower", i.volumetricLightPower), o.x = i.sourceLight.getDepthMinZ(i._scene.activeCamera), o.y = i.sourceLight.getDepthMaxZ(i._scene.activeCamera), e.setVector2("depthValues", o) } }, this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRVLS", function () { return i.volumetricLightPostProcess }, !0)), this._createBlurPostProcesses(e, t / 4, 0, "volumetricLightBlurScale"), this.volumetricLightMergePostProces = new pn.PostProcess("HDRVLSMerge", "standard", [], ["originalSampler"], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define VLSMERGE"), this.volumetricLightMergePostProces.onApply = function (e) { e.setTextureFromPostProcess("originalSampler", i._bloomEnabled ? i.textureAdderFinalPostProcess : i.originalPostProcess), i._currentDepthOfFieldSource = i.volumetricLightFinalPostProcess }, this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRVLSMerge", function () { return i.volumetricLightMergePostProces }, !0)) }, t.prototype._createLuminancePostProcesses = function (e, i) { var r = this, n = Math.pow(3, t.LuminanceSteps); this.luminancePostProcess = new pn.PostProcess("HDRLuminance", "standard", ["lumOffsets"], [], { width: n, height: n }, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define LUMINANCE", i); var o = []; this.luminancePostProcess.onApply = function (e) { var t = 1 / r.luminancePostProcess.width, i = 1 / r.luminancePostProcess.height; o[0] = -.5 * t, o[1] = .5 * i, o[2] = .5 * t, o[3] = .5 * i, o[4] = -.5 * t, o[5] = -.5 * i, o[6] = .5 * t, o[7] = -.5 * i, e.setArray2("lumOffsets", o) }, this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRLuminance", function () { return r.luminancePostProcess }, !0)); for (var s = t.LuminanceSteps - 1; 0 <= s; s--) { n = Math.pow(3, s); var a = "#define LUMINANCE_DOWN_SAMPLE\n"; 0 === s && (a += "#define FINAL_DOWN_SAMPLER"); var l = new pn.PostProcess("HDRLuminanceDownSample" + s, "standard", ["dsOffsets", "halfDestPixelSize"], [], { width: n, height: n }, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, a, i); this.luminanceDownSamplePostProcesses.push(l) } var c = this.luminancePostProcess; this.luminanceDownSamplePostProcesses.forEach(function (t, i) { var n = new Array(18); t.onApply = function (e) { if (c) { for (var o = 0, s = -1; s < 2; s++)for (var a = -1; a < 2; a++)n[o] = s / c.width, n[o + 1] = a / c.height, o += 2; e.setArray2("dsOffsets", n), e.setFloat("halfDestPixelSize", .5 / c.width), c = i === r.luminanceDownSamplePostProcesses.length - 1 ? r.luminancePostProcess : t } }, i === r.luminanceDownSamplePostProcesses.length - 1 && (t.onAfterRender = function (t) { var i = e.getEngine().readPixels(0, 0, 1, 1), n = new pn.Vector4(1 / 16581375, 1 / 65025, 1 / 255, 1); r._hdrCurrentLuminance = (i[0] * n.x + i[1] * n.y + i[2] * n.z + i[3] * n.w) / 100 }), r.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRLuminanceDownSample" + i, function () { return t }, !0)) }) }, t.prototype._createHdrPostProcess = function (e, t) { var i = this; this.hdrPostProcess = new pn.PostProcess("HDR", "standard", ["averageLuminance"], ["textureAdderSampler"], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define HDR", pn.Engine.TEXTURETYPE_UNSIGNED_INT); var r = 1, n = 0, o = 0; this.hdrPostProcess.onApply = function (t) { if (t.setTextureFromPostProcess("textureAdderSampler", i._currentDepthOfFieldSource), n += e.getEngine().getDeltaTime(), r < 0) r = i._hdrCurrentLuminance; else { var s = (o - n) / 1e3; i._hdrCurrentLuminance < r + i.hdrDecreaseRate * s ? r += i.hdrDecreaseRate * s : i._hdrCurrentLuminance > r - i.hdrIncreaseRate * s ? r -= i.hdrIncreaseRate * s : r = i._hdrCurrentLuminance } r = pn.Scalar.Clamp(r, i.hdrMinimumLuminance, 1e20), t.setFloat("averageLuminance", r), o = n, i._currentDepthOfFieldSource = i.hdrFinalPostProcess }, this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDR", function () { return i.hdrPostProcess }, !0)) }, t.prototype._createLensFlarePostProcess = function (e, t) { var i = this; this.lensFlarePostProcess = new pn.PostProcess("HDRLensFlare", "standard", ["strength", "ghostDispersal", "haloWidth", "resolution", "distortionStrength"], ["lensColorSampler"], t / 2, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define LENS_FLARE", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRLensFlare", function () { return i.lensFlarePostProcess }, !0)), this._createBlurPostProcesses(e, t / 4, 2), this.lensFlareComposePostProcess = new pn.PostProcess("HDRLensFlareCompose", "standard", ["lensStarMatrix"], ["otherSampler", "lensDirtSampler", "lensStarSampler"], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define LENS_FLARE_COMPOSE", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRLensFlareCompose", function () { return i.lensFlareComposePostProcess }, !0)); var r = new pn.Vector2(0, 0); this.lensFlarePostProcess.onApply = function (e) { e.setTextureFromPostProcess("textureSampler", i._bloomEnabled ? i.blurHPostProcesses[0] : i.originalPostProcess), e.setTexture("lensColorSampler", i.lensColorTexture), e.setFloat("strength", i.lensFlareStrength), e.setFloat("ghostDispersal", i.lensFlareGhostDispersal), e.setFloat("haloWidth", i.lensFlareHaloWidth), r.x = i.lensFlarePostProcess.width, r.y = i.lensFlarePostProcess.height, e.setVector2("resolution", r), e.setFloat("distortionStrength", i.lensFlareDistortionStrength) }; var n = pn.Matrix.FromValues(2, 0, -1, 0, 0, 2, -1, 0, 0, 0, 1, 0, 0, 0, 0, 1), o = pn.Matrix.FromValues(.5, 0, .5, 0, 0, .5, .5, 0, 0, 0, 1, 0, 0, 0, 0, 1); this.lensFlareComposePostProcess.onApply = function (e) { if (i._scene.activeCamera) { e.setTextureFromPostProcess("otherSampler", i._currentDepthOfFieldSource), e.setTexture("lensDirtSampler", i.lensFlareDirtTexture), e.setTexture("lensStarSampler", i.lensStarTexture); var t = i._scene.activeCamera.getViewMatrix().getRow(0), r = i._scene.activeCamera.getViewMatrix().getRow(2), s = pn.Vector3.Dot(t.toVector3(), new pn.Vector3(1, 0, 0)) + pn.Vector3.Dot(r.toVector3(), new pn.Vector3(0, 0, 1)); s *= 4; var a = pn.Matrix.FromValues(.5 * Math.cos(s), -Math.sin(s), 0, 0, Math.sin(s), .5 * Math.cos(s), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1), l = o.multiply(a).multiply(n); e.setMatrix("lensStarMatrix", l), i._currentDepthOfFieldSource = i.lensFlareFinalPostProcess } } }, t.prototype._createDepthOfFieldPostProcess = function (e, t) { var i = this; this.depthOfFieldPostProcess = new pn.PostProcess("HDRDepthOfField", "standard", ["distance"], ["otherSampler", "depthSampler"], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define DEPTH_OF_FIELD", pn.Engine.TEXTURETYPE_UNSIGNED_INT), this.depthOfFieldPostProcess.onApply = function (e) { e.setTextureFromPostProcess("otherSampler", i._currentDepthOfFieldSource), e.setTexture("depthSampler", i._getDepthTexture()), e.setFloat("distance", i.depthOfFieldDistance) }, this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRDepthOfField", function () { return i.depthOfFieldPostProcess }, !0)) }, t.prototype._createMotionBlurPostProcess = function (e, t) { var i = this; this.motionBlurPostProcess = new pn.PostProcess("HDRMotionBlur", "standard", ["inverseViewProjection", "prevViewProjection", "screenSize", "motionScale", "motionStrength"], ["depthSampler"], t, null, pn.Texture.BILINEAR_SAMPLINGMODE, e.getEngine(), !1, "#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES " + this.motionBlurSamples.toFixed(1), pn.Engine.TEXTURETYPE_UNSIGNED_INT); var r = 0, n = pn.Matrix.Identity(), o = pn.Matrix.Identity(), s = pn.Matrix.Identity(), a = pn.Vector2.Zero(); this.motionBlurPostProcess.onApply = function (t) { (s = e.getProjectionMatrix().multiply(e.getViewMatrix())).invertToRef(o), t.setMatrix("inverseViewProjection", o), t.setMatrix("prevViewProjection", n), n = s, a.x = i.motionBlurPostProcess.width, a.y = i.motionBlurPostProcess.height, t.setVector2("screenSize", a), r = e.getEngine().getFps() / 60, t.setFloat("motionScale", r), t.setFloat("motionStrength", i.motionStrength), t.setTexture("depthSampler", i._getDepthTexture()) }, this.addEffect(new pn.PostProcessRenderEffect(e.getEngine(), "HDRMotionBlur", function () { return i.motionBlurPostProcess }, !0)) }, t.prototype._getDepthTexture = function () { return this._scene.getEngine().getCaps().drawBuffersExtension ? this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0] : this._scene.enableDepthRenderer().getDepthMap() }, t.prototype._disposePostProcesses = function () { for (var e = 0; e < this._cameras.length; e++) { var t = this._cameras[e]; this.originalPostProcess && this.originalPostProcess.dispose(t), this.downSampleX4PostProcess && this.downSampleX4PostProcess.dispose(t), this.brightPassPostProcess && this.brightPassPostProcess.dispose(t), this.textureAdderPostProcess && this.textureAdderPostProcess.dispose(t), this.textureAdderFinalPostProcess && this.textureAdderFinalPostProcess.dispose(t), this.volumetricLightPostProcess && this.volumetricLightPostProcess.dispose(t), this.volumetricLightSmoothXPostProcess && this.volumetricLightSmoothXPostProcess.dispose(t), this.volumetricLightSmoothYPostProcess && this.volumetricLightSmoothYPostProcess.dispose(t), this.volumetricLightMergePostProces && this.volumetricLightMergePostProces.dispose(t), this.volumetricLightFinalPostProcess && this.volumetricLightFinalPostProcess.dispose(t), this.lensFlarePostProcess && this.lensFlarePostProcess.dispose(t), this.lensFlareComposePostProcess && this.lensFlareComposePostProcess.dispose(t); for (var i = 0; i < this.luminanceDownSamplePostProcesses.length; i++)this.luminanceDownSamplePostProcesses[i].dispose(t); for (this.luminancePostProcess && this.luminancePostProcess.dispose(t), this.hdrPostProcess && this.hdrPostProcess.dispose(t), this.hdrFinalPostProcess && this.hdrFinalPostProcess.dispose(t), this.depthOfFieldPostProcess && this.depthOfFieldPostProcess.dispose(t), this.motionBlurPostProcess && this.motionBlurPostProcess.dispose(t), this.fxaaPostProcess && this.fxaaPostProcess.dispose(t), i = 0; i < this.blurHPostProcesses.length; i++)this.blurHPostProcesses[i].dispose(t); for (i = 0; i < this.blurVPostProcesses.length; i++)this.blurVPostProcesses[i].dispose(t) } this.originalPostProcess = null, this.downSampleX4PostProcess = null, this.brightPassPostProcess = null, this.textureAdderPostProcess = null, this.textureAdderFinalPostProcess = null, this.volumetricLightPostProcess = null, this.volumetricLightSmoothXPostProcess = null, this.volumetricLightSmoothYPostProcess = null, this.volumetricLightMergePostProces = null, this.volumetricLightFinalPostProcess = null, this.lensFlarePostProcess = null, this.lensFlareComposePostProcess = null, this.luminancePostProcess = null, this.hdrPostProcess = null, this.hdrFinalPostProcess = null, this.depthOfFieldPostProcess = null, this.motionBlurPostProcess = null, this.fxaaPostProcess = null, this.luminanceDownSamplePostProcesses = [], this.blurHPostProcesses = [], this.blurVPostProcesses = [] }, t.prototype.dispose = function () { this._disposePostProcesses(), this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._cameras), e.prototype.dispose.call(this) }, t.prototype.serialize = function () { var e = pn.SerializationHelper.Serialize(this); return this.sourceLight && (e.sourceLightId = this.sourceLight.id), e.customType = "StandardRenderingPipeline", e }, t.Parse = function (e, i, r) { var n = pn.SerializationHelper.Parse(function () { return new t(e._name, i, e._ratio) }, e, i, r); return e.sourceLightId && (n.sourceLight = i.getLightByID(e.sourceLightId)), n }, t.LuminanceSteps = 6, b([pn.serialize()], t.prototype, "brightThreshold", void 0), b([pn.serialize()], t.prototype, "blurWidth", void 0), b([pn.serialize()], t.prototype, "horizontalBlur", void 0), b([pn.serialize()], t.prototype, "exposure", void 0), b([pn.serializeAsTexture("lensTexture")], t.prototype, "lensTexture", void 0), b([pn.serialize()], t.prototype, "volumetricLightCoefficient", void 0), b([pn.serialize()], t.prototype, "volumetricLightPower", void 0), b([pn.serialize()], t.prototype, "volumetricLightBlurScale", void 0), b([pn.serialize()], t.prototype, "hdrMinimumLuminance", void 0), b([pn.serialize()], t.prototype, "hdrDecreaseRate", void 0), b([pn.serialize()], t.prototype, "hdrIncreaseRate", void 0), b([pn.serializeAsTexture("lensColorTexture")], t.prototype, "lensColorTexture", void 0), b([pn.serialize()], t.prototype, "lensFlareStrength", void 0), b([pn.serialize()], t.prototype, "lensFlareGhostDispersal", void 0), b([pn.serialize()], t.prototype, "lensFlareHaloWidth", void 0), b([pn.serialize()], t.prototype, "lensFlareDistortionStrength", void 0), b([pn.serializeAsTexture("lensStarTexture")], t.prototype, "lensStarTexture", void 0), b([pn.serializeAsTexture("lensFlareDirtTexture")], t.prototype, "lensFlareDirtTexture", void 0), b([pn.serialize()], t.prototype, "depthOfFieldDistance", void 0), b([pn.serialize()], t.prototype, "depthOfFieldBlurWidth", void 0), b([pn.serialize()], t.prototype, "motionStrength", void 0), b([pn.serialize()], t.prototype, "_ratio", void 0), b([pn.serialize()], t.prototype, "BloomEnabled", null), b([pn.serialize()], t.prototype, "DepthOfFieldEnabled", null), b([pn.serialize()], t.prototype, "LensFlareEnabled", null), b([pn.serialize()], t.prototype, "HDREnabled", null), b([pn.serialize()], t.prototype, "VLSEnabled", null), b([pn.serialize()], t.prototype, "MotionBlurEnabled", null), b([pn.serialize()], t.prototype, "fxaaEnabled", null), b([pn.serialize()], t.prototype, "volumetricLightStepsCount", null), b([pn.serialize()], t.prototype, "motionBlurSamples", null), b([pn.serialize()], t.prototype, "samples", null), t }((pn = $a || ($a = {})).PostProcessRenderPipeline), pn.StandardRenderingPipeline = _n, gn = function (e) { function t(t, i, r, n, o, s, a) { void 0 === r && (r = null), void 0 === a && (a = mn.Engine.TEXTURETYPE_UNSIGNED_INT); var l = e.call(this, t, "fxaa", ["texelSize"], null, i, r, n || mn.Texture.BILINEAR_SAMPLINGMODE, o, s, null, a, "fxaa", void 0, !0) || this, c = l._getDefines(); return l.updateEffect(c), l.onApplyObservable.add(function (e) { var t = l.texelSize; e.setFloat2("texelSize", t.x, t.y) }), l } return T(t, e), t.prototype._getDefines = function () { var e = this.getEngine(); if (!e) return null; var t = e.getGlInfo(); return t && t.renderer && -1 < t.renderer.toLowerCase().indexOf("mali") ? "#define MALI 1\n" : null }, t }((mn = $a || ($a = {})).PostProcess), mn.FxaaPostProcess = gn, yn = function (e) { function t(t, i, r, n, o, s, a, l, c, h) { void 0 === c && (c = vn.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === h && (h = !1); var u = e.call(this, t, "chromaticAberration", ["chromatic_aberration", "screen_width", "screen_height", "direction", "radialIntensity", "centerPosition"], [], n, o, s, a, l, null, c, void 0, null, h) || this; return u.aberrationAmount = 30, u.radialIntensity = 0, u.direction = new vn.Vector2(.707, .707), u.centerPosition = new vn.Vector2(.5, .5), u.onApplyObservable.add(function (e) { e.setFloat("chromatic_aberration", u.aberrationAmount), e.setFloat("screen_width", i), e.setFloat("screen_height", r), e.setFloat("radialIntensity", u.radialIntensity), e.setFloat2("direction", u.direction.x, u.direction.y), e.setFloat2("centerPosition", u.centerPosition.x, u.centerPosition.y) }), u } return T(t, e), t }((vn = $a || ($a = {})).PostProcess), vn.ChromaticAberrationPostProcess = yn, Tn = function (e) { function t(t, i, r, n, o, s, a, l) { void 0 === a && (a = bn.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === l && (l = !1); var c = e.call(this, t, "grain", ["intensity", "animatedSeed"], [], i, r, n, o, s, null, a, void 0, null, l) || this; return c.intensity = 30, c.animated = !1, c.onApplyObservable.add(function (e) { e.setFloat("intensity", c.intensity), e.setFloat("animatedSeed", c.animated ? Math.random() + 1 : 1) }), c } return T(t, e), t }((bn = $a || ($a = {})).PostProcess), bn.GrainPostProcess = Tn, xn = function (e) { function t(t, i, r, n, o, s, a, l) { void 0 === a && (a = En.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === l && (l = !1); var c = e.call(this, t, "sharpen", ["sharpnessAmounts", "screenSize"], null, i, r, n, o, s, null, a, void 0, null, l) || this; return c.colorAmount = 1, c.edgeAmount = .3, c.onApply = function (e) { e.setFloat2("screenSize", c.width, c.height), e.setFloat2("sharpnessAmounts", c.edgeAmount, c.colorAmount) }, c } return T(t, e), t }((En = $a || ($a = {})).PostProcess), En.SharpenPostProcess = xn, An = function (e) { function t(t, i, r, n, o, s, a, l, c, h, u) { void 0 === s && (s = Pn.Texture.BILINEAR_SAMPLINGMODE), void 0 === c && (c = Pn.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === h && (h = ""), void 0 === u && (u = !1); var d = e.call(this, t, "kernelBlur", ["delta", "direction", "cameraMinMaxZ"], ["circleOfConfusionSampler"], n, o, s, a, l, null, c, "kernelBlur", { varyingCount: 0, depCount: 0 }, !0) || this; return d.direction = i, d.blockCompilation = u, d._packedFloat = !1, d._staticDefines = "", d._staticDefines = h, d.onApplyObservable.add(function (e) { d._outputTexture ? e.setFloat2("delta", 1 / d._outputTexture.width * d.direction.x, 1 / d._outputTexture.height * d.direction.y) : e.setFloat2("delta", 1 / d.width * d.direction.x, 1 / d.height * d.direction.y) }), d.kernel = r, d } return T(t, e), Object.defineProperty(t.prototype, "kernel", { get: function () { return this._idealKernel }, set: function (e) { this._idealKernel !== e && (e = Math.max(e, 1), this._idealKernel = e, this._kernel = this._nearestBestKernel(e), this.blockCompilation || this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "packedFloat", { get: function () { return this._packedFloat }, set: function (e) { this._packedFloat !== e && (this._packedFloat = e, this.blockCompilation || this._updateParameters()) }, enumerable: !0, configurable: !0 }), t.prototype.updateEffect = function (e, t, i, r, n, o) { void 0 === e && (e = null), void 0 === t && (t = null), void 0 === i && (i = null), this._updateParameters(n, o) }, t.prototype._updateParameters = function (t, i) { for (var r = this._kernel, n = (r - 1) / 2, o = [], s = [], a = 0, l = 0; l < r; l++) { var c = l / (r - 1), h = this._gaussianWeight(2 * c - 1); o[l] = l - n, a += s[l] = h } for (l = 0; l < s.length; l++)s[l] /= a; var u = [], d = [], f = []; for (l = 0; l <= n; l += 2) { var p = Math.min(l + 1, Math.floor(n)); if (l === p) f.push({ o: o[l], w: s[l] }); else { var _ = p === n, m = s[l] + s[p] * (_ ? .5 : 1), g = o[l] + 1 / (1 + s[l] / s[p]); 0 === g ? (f.push({ o: o[l], w: s[l] }), f.push({ o: o[l + 1], w: s[l + 1] })) : (f.push({ o: g, w: m }), f.push({ o: -g, w: m })) } } for (l = 0; l < f.length; l++)d[l] = f[l].o, u[l] = f[l].w; o = d, s = u; var v = this.getEngine().getCaps().maxVaryingVectors, y = Math.max(v, 0) - 1, b = Math.min(o.length, y), T = ""; for (T += this._staticDefines, -1 != this._staticDefines.indexOf("DOF") && (T += "#define CENTER_WEIGHT " + this._glslFloat(s[b - 1]) + "\r\n", b--), l = 0; l < b; l++)T += "#define KERNEL_OFFSET" + l + " " + this._glslFloat(o[l]) + "\r\n", T += "#define KERNEL_WEIGHT" + l + " " + this._glslFloat(s[l]) + "\r\n"; var E = 0; for (l = y; l < o.length; l++)T += "#define KERNEL_DEP_OFFSET" + E + " " + this._glslFloat(o[l]) + "\r\n", T += "#define KERNEL_DEP_WEIGHT" + E + " " + this._glslFloat(s[l]) + "\r\n", E++; this.packedFloat && (T += "#define PACKEDFLOAT 1"), this.blockCompilation = !1, e.prototype.updateEffect.call(this, T, null, null, { varyingCount: b, depCount: E }, t, i) }, t.prototype._nearestBestKernel = function (e) { for (var t = Math.round(e), i = 0, r = [t, t - 1, t + 1, t - 2, t + 2]; i < r.length; i++) { var n = r[i]; if (n % 2 != 0 && Math.floor(n / 2) % 2 == 0 && 0 < n) return Math.max(n, 3) } return Math.max(t, 3) }, t.prototype._gaussianWeight = function (e) { var t = -e * e / (1 / 3 * 2 * (1 / 3)); return 1 / (Math.sqrt(2 * Math.PI) * (1 / 3)) * Math.exp(t) }, t.prototype._glslFloat = function (e, t) { return void 0 === t && (t = 8), e.toFixed(t).replace(/0+$/, "") }, t }((Pn = $a || ($a = {})).PostProcess), Pn.BlurPostProcess = An, Mn = function (e) { function t(t, i, r, n, o, s, a, l, c, h, u, d, f) { void 0 === l && (l = null), void 0 === c && (c = Sn.Texture.BILINEAR_SAMPLINGMODE), void 0 === d && (d = Sn.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === f && (f = !1); var p = e.call(this, t, r, n, o, s, c = Sn.Texture.BILINEAR_SAMPLINGMODE, h, u, d = Sn.Engine.TEXTURETYPE_UNSIGNED_INT, "#define DOF 1\r\n", f) || this; return p.direction = r, p.onApplyObservable.add(function (e) { null != l && e.setTextureFromPostProcess("textureSampler", l), e.setTextureFromPostProcessOutput("circleOfConfusionSampler", a), i.activeCamera && e.setFloat2("cameraMinMaxZ", i.activeCamera.minZ, i.activeCamera.maxZ) }), p } return T(t, e), t }((Sn = $a || ($a = {})).BlurPostProcess), Sn.DepthOfFieldBlurPostProcess = Mn, function (e) { e.DepthOfFieldMergePostProcessOptions = function () { }; var t = function (t) { function i(i, r, n, o, s, a, l, c, h, u, d) { void 0 === u && (u = e.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === d && (d = !1); var f = t.call(this, i, "depthOfFieldMerge", [], ["circleOfConfusionSampler", "blurStep0", "blurStep1", "blurStep2"], s, a, l, c, h, null, u, void 0, null, !0) || this; return f.blurSteps = o, f.onApplyObservable.add(function (e) { e.setTextureFromPostProcess("textureSampler", r), e.setTextureFromPostProcessOutput("circleOfConfusionSampler", n), o.forEach(function (t, i) { e.setTextureFromPostProcessOutput("blurStep" + (o.length - i - 1), t) }) }), d || f.updateEffect(), f } return T(i, t), i.prototype.updateEffect = function (e, i, r, n, o, s) { void 0 === e && (e = null), void 0 === i && (i = null), void 0 === r && (r = null), e || (e = "", e += "#define BLUR_LEVEL " + (this.blurSteps.length - 1) + "\n"), t.prototype.updateEffect.call(this, e, i, r, n, o, s) }, i }(e.PostProcess); e.DepthOfFieldMergePostProcess = t }($a || ($a = {})), Cn = function (e) { function t(t, i, r, n, o, s, a, l, c) { void 0 === l && (l = Rn.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === c && (c = !1); var h = e.call(this, t, "circleOfConfusion", ["cameraMinMaxZ", "focusDistance", "cocPrecalculation"], ["depthSampler"], r, n, o, s, a, null, l, void 0, null, c) || this; return h.lensSize = 50, h.fStop = 1.4, h.focusDistance = 2e3, h.focalLength = 50, h._depthTexture = null, h._depthTexture = i, h.onApplyObservable.add(function (e) { if (h._depthTexture) { e.setTexture("depthSampler", h._depthTexture); var t = h.lensSize / h.fStop * h.focalLength / (h.focusDistance - h.focalLength); e.setFloat("focusDistance", h.focusDistance), e.setFloat("cocPrecalculation", t), e.setFloat2("cameraMinMaxZ", h._depthTexture.activeCamera.minZ, h._depthTexture.activeCamera.maxZ) } else Rn.Tools.Warn("No depth texture set on CircleOfConfusionPostProcess") }), h } return T(t, e), Object.defineProperty(t.prototype, "depthTexture", { set: function (e) { this._depthTexture = e }, enumerable: !0, configurable: !0 }), t }((Rn = $a || ($a = {})).PostProcess), Rn.CircleOfConfusionPostProcess = Cn, function (e) { var t, i; (i = t = e.DepthOfFieldEffectBlurLevel || (e.DepthOfFieldEffectBlurLevel = {}))[i.Low = 0] = "Low", i[i.Medium = 1] = "Medium", i[i.High = 2] = "High"; var r = function (i) { function r(r, n, o, s, a) { void 0 === o && (o = t.Low), void 0 === s && (s = 0), void 0 === a && (a = !1); var l = i.call(this, r.getEngine(), "depth of field", function () { return l._effects }, !0) || this; l._effects = [], l._circleOfConfusion = new e.CircleOfConfusionPostProcess("circleOfConfusion", n, 1, null, e.Texture.BILINEAR_SAMPLINGMODE, r.getEngine(), !1, s, a), l._depthOfFieldBlurY = [], l._depthOfFieldBlurX = []; var c = 1, h = 15; switch (o) { case t.High: c = 3, h = 51; break; case t.Medium: c = 2, h = 31; break; default: h = 15, c = 1 }for (var u = h / Math.pow(2, c - 1), d = 1, f = 0; f < c; f++) { var p = new e.DepthOfFieldBlurPostProcess("verticle blur", r, new e.Vector2(0, 1), u, d, null, l._circleOfConfusion, 0 == f ? l._circleOfConfusion : null, e.Texture.BILINEAR_SAMPLINGMODE, r.getEngine(), !1, s, a); p.autoClear = !1, d = .75 / Math.pow(2, f); var _ = new e.DepthOfFieldBlurPostProcess("horizontal blur", r, new e.Vector2(1, 0), u, d, null, l._circleOfConfusion, null, e.Texture.BILINEAR_SAMPLINGMODE, r.getEngine(), !1, s, a); _.autoClear = !1, l._depthOfFieldBlurY.push(p), l._depthOfFieldBlurX.push(_) } for (l._effects = [l._circleOfConfusion], f = 0; f < l._depthOfFieldBlurX.length; f++)l._effects.push(l._depthOfFieldBlurY[f]), l._effects.push(l._depthOfFieldBlurX[f]); return l._dofMerge = new e.DepthOfFieldMergePostProcess("dofMerge", l._circleOfConfusion, l._circleOfConfusion, l._depthOfFieldBlurX, d, null, e.Texture.BILINEAR_SAMPLINGMODE, r.getEngine(), !1, s, a), l._dofMerge.autoClear = !1, l._effects.push(l._dofMerge), l } return T(r, i), Object.defineProperty(r.prototype, "focalLength", { get: function () { return this._circleOfConfusion.focalLength }, set: function (e) { this._circleOfConfusion.focalLength = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "fStop", { get: function () { return this._circleOfConfusion.fStop }, set: function (e) { this._circleOfConfusion.fStop = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "focusDistance", { get: function () { return this._circleOfConfusion.focusDistance }, set: function (e) { this._circleOfConfusion.focusDistance = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "lensSize", { get: function () { return this._circleOfConfusion.lensSize }, set: function (e) { this._circleOfConfusion.lensSize = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "depthTexture", { set: function (e) { this._circleOfConfusion.depthTexture = e }, enumerable: !0, configurable: !0 }), r.prototype.disposeEffects = function (e) { for (var t = 0; t < this._effects.length; t++)this._effects[t].dispose(e) }, r.prototype._updateEffects = function () { for (var e = 0; e < this._effects.length; e++)this._effects[e].updateEffect() }, r.prototype._isReady = function () { for (var e = 0; e < this._effects.length; e++)if (!this._effects[e].isReady()) return !1; return !0 }, r }(e.PostProcessRenderEffect); e.DepthOfFieldEffect = r }($a || ($a = {})), Dn = function (e) { function t(t, i, r, n, o, s, a, l, c, h, u) { void 0 === h && (h = On.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === u && (u = !1); var d = e.call(this, t, "bloomMerge", ["bloomWeight"], ["circleOfConfusionSampler", "blurStep0", "blurStep1", "blurStep2", "bloomBlur"], o, s, a, l, c, null, h, void 0, null, !0) || this; return d.weight = n, d.onApplyObservable.add(function (e) { e.setTextureFromPostProcess("textureSampler", i), e.setTextureFromPostProcessOutput("bloomBlur", r), e.setFloat("bloomWeight", d.weight) }), u || d.updateEffect(), d } return T(t, e), t }((On = $a || ($a = {})).PostProcess), On.BloomMergePostProcess = Dn, wn = function (e) { function t(t, i, r, n, o, s, a, l) { void 0 === a && (a = In.Engine.TEXTURETYPE_UNSIGNED_INT), void 0 === l && (l = !1); var c = e.call(this, t, "extractHighlights", ["threshold", "exposure"], null, i, r, n, o, s, null, a, void 0, null, l) || this; return c.threshold = .9, c._exposure = 1, c._inputPostProcess = null, c.onApplyObservable.add(function (e) { c._inputPostProcess && e.setTextureFromPostProcess("textureSampler", c._inputPostProcess), e.setFloat("threshold", Math.pow(c.threshold, In.ToGammaSpace)), e.setFloat("exposure", c._exposure) }), c } return T(t, e), t }((In = $a || ($a = {})).PostProcess), In.ExtractHighlightsPostProcess = wn, Fn = function (e) { function t(t, i, r, n, o, s) { void 0 === o && (o = 0), void 0 === s && (s = !1); var a = e.call(this, t.getEngine(), "bloom", function () { return a._effects }, !0) || this; return a.bloomScale = i, a._effects = [], a._downscale = new Ln.ExtractHighlightsPostProcess("highlights", 1, null, Ln.Texture.BILINEAR_SAMPLINGMODE, t.getEngine(), !1, o, s), a._blurX = new Ln.BlurPostProcess("horizontal blur", new Ln.Vector2(1, 0), 10, i, null, Ln.Texture.BILINEAR_SAMPLINGMODE, t.getEngine(), !1, o, void 0, s), a._blurX.alwaysForcePOT = !0, a._blurX.autoClear = !1, a._blurY = new Ln.BlurPostProcess("vertical blur", new Ln.Vector2(0, 1), 10, i, null, Ln.Texture.BILINEAR_SAMPLINGMODE, t.getEngine(), !1, o, void 0, s), a._blurY.alwaysForcePOT = !0, a._blurY.autoClear = !1, a.kernel = n, a._effects = [a._downscale, a._blurX, a._blurY], a._merge = new Ln.BloomMergePostProcess("bloomMerge", a._downscale, a._blurY, r, i, null, Ln.Texture.BILINEAR_SAMPLINGMODE, t.getEngine(), !1, o, s), a._merge.autoClear = !1, a._effects.push(a._merge), a } return T(t, e), Object.defineProperty(t.prototype, "threshold", { get: function () { return this._downscale.threshold }, set: function (e) { this._downscale.threshold = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "weight", { get: function () { return this._merge.weight }, set: function (e) { this._merge.weight = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "kernel", { get: function () { return this._blurX.kernel / this.bloomScale }, set: function (e) { this._blurX.kernel = e * this.bloomScale, this._blurY.kernel = e * this.bloomScale }, enumerable: !0, configurable: !0 }), t.prototype.disposeEffects = function (e) { for (var t = 0; t < this._effects.length; t++)this._effects[t].dispose(e) }, t.prototype._updateEffects = function () { for (var e = 0; e < this._effects.length; e++)this._effects[e].updateEffect() }, t.prototype._isReady = function () { for (var e = 0; e < this._effects.length; e++)if (!this._effects[e].isReady()) return !1; return !0 }, t }((Ln = $a || ($a = {})).PostProcessRenderEffect), Ln.BloomEffect = Fn, Nn = function (e) { function t(t, i, r, n, o) { void 0 === t && (t = ""), void 0 === i && (i = !0), void 0 === r && (r = Bn.Engine.LastCreatedScene), void 0 === o && (o = !0); var s = e.call(this, r.getEngine(), t) || this; s._camerasToBeAttached = [], s.SharpenPostProcessId = "SharpenPostProcessEffect", s.ImageProcessingPostProcessId = "ImageProcessingPostProcessEffect", s.FxaaPostProcessId = "FxaaPostProcessEffect", s.ChromaticAberrationPostProcessId = "ChromaticAberrationPostProcessEffect", s.GrainPostProcessId = "GrainPostProcessEffect", s._glowLayer = null, s.animations = [], s._imageProcessingConfigurationObserver = null, s._sharpenEnabled = !1, s._bloomEnabled = !1, s._depthOfFieldEnabled = !1, s._depthOfFieldBlurLevel = Bn.DepthOfFieldEffectBlurLevel.Low, s._fxaaEnabled = !1, s._imageProcessingEnabled = !0, s._bloomScale = .5, s._chromaticAberrationEnabled = !1, s._grainEnabled = !1, s._buildAllowed = !0, s._resizeObserver = null, s._hardwareScaleLevel = 1, s._bloomKernel = 64, s._bloomWeight = .15, s._bloomThreshold = .9, s._samples = 1, s._hasCleared = !1, s._prevPostProcess = null, s._prevPrevPostProcess = null, s._depthOfFieldSceneObserver = null, s._cameras = n || r.cameras, s._cameras = s._cameras.slice(), s._camerasToBeAttached = s._cameras.slice(), s._buildAllowed = o, s._scene = r; var a = s._scene.getEngine().getCaps(); s._hdr = i && (a.textureHalfFloatRender || a.textureFloatRender), s._hdr ? a.textureHalfFloatRender ? s._defaultPipelineTextureType = Bn.Engine.TEXTURETYPE_HALF_FLOAT : a.textureFloatRender && (s._defaultPipelineTextureType = Bn.Engine.TEXTURETYPE_FLOAT) : s._defaultPipelineTextureType = Bn.Engine.TEXTURETYPE_UNSIGNED_INT, r.postProcessRenderPipelineManager.addPipeline(s); var l = s._scene.getEngine(); return s.sharpen = new Bn.SharpenPostProcess("sharpen", 1, null, Bn.Texture.BILINEAR_SAMPLINGMODE, l, !1, s._defaultPipelineTextureType, !0), s._sharpenEffect = new Bn.PostProcessRenderEffect(l, s.SharpenPostProcessId, function () { return s.sharpen }, !0), s.depthOfField = new Bn.DepthOfFieldEffect(s._scene, null, s._depthOfFieldBlurLevel, s._defaultPipelineTextureType, !0), s.bloom = new Bn.BloomEffect(s._scene, s._bloomScale, s._bloomWeight, s.bloomKernel, s._defaultPipelineTextureType, !0), s.chromaticAberration = new Bn.ChromaticAberrationPostProcess("ChromaticAberration", l.getRenderWidth(), l.getRenderHeight(), 1, null, Bn.Texture.BILINEAR_SAMPLINGMODE, l, !1, s._defaultPipelineTextureType, !0), s._chromaticAberrationEffect = new Bn.PostProcessRenderEffect(l, s.ChromaticAberrationPostProcessId, function () { return s.chromaticAberration }, !0), s.grain = new Bn.GrainPostProcess("Grain", 1, null, Bn.Texture.BILINEAR_SAMPLINGMODE, l, !1, s._defaultPipelineTextureType, !0), s._grainEffect = new Bn.PostProcessRenderEffect(l, s.GrainPostProcessId, function () { return s.grain }, !0), s._resizeObserver = l.onResizeObservable.add(function () { s._hardwareScaleLevel = l.getHardwareScalingLevel(), s.bloomKernel = s.bloomKernel }), s._imageProcessingConfigurationObserver = s._scene.imageProcessingConfiguration.onUpdateParameters.add(function () { s.bloom._downscale._exposure = s._scene.imageProcessingConfiguration.exposure }), s._buildPipeline(), s } return T(t, e), Object.defineProperty(t.prototype, "sharpenEnabled", { get: function () { return this._sharpenEnabled }, set: function (e) { this._sharpenEnabled !== e && (this._sharpenEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "bloomKernel", { get: function () { return this._bloomKernel }, set: function (e) { this._bloomKernel = e, this.bloom.kernel = e / this._hardwareScaleLevel }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "bloomWeight", { get: function () { return this._bloomWeight }, set: function (e) { this._bloomWeight !== e && (this.bloom.weight = e, this._bloomWeight = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "bloomThreshold", { get: function () { return this._bloomThreshold }, set: function (e) { this._bloomThreshold !== e && (this.bloom.threshold = e, this._bloomThreshold = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "bloomScale", { get: function () { return this._bloomScale }, set: function (e) { this._bloomScale !== e && (this._bloomScale = e, this._rebuildBloom(), this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "bloomEnabled", { get: function () { return this._bloomEnabled }, set: function (e) { this._bloomEnabled !== e && (this._bloomEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), t.prototype._rebuildBloom = function () { var e = this.bloom; this.bloom = new Bn.BloomEffect(this._scene, this.bloomScale, this._bloomWeight, this.bloomKernel, this._defaultPipelineTextureType, !1), this.bloom.threshold = e.threshold; for (var t = 0; t < this._cameras.length; t++)e.disposeEffects(this._cameras[t]) }, Object.defineProperty(t.prototype, "depthOfFieldEnabled", { get: function () { return this._depthOfFieldEnabled }, set: function (e) { this._depthOfFieldEnabled !== e && (this._depthOfFieldEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "depthOfFieldBlurLevel", { get: function () { return this._depthOfFieldBlurLevel }, set: function (e) { if (this._depthOfFieldBlurLevel !== e) { this._depthOfFieldBlurLevel = e; var t = this.depthOfField; this.depthOfField = new Bn.DepthOfFieldEffect(this._scene, null, this._depthOfFieldBlurLevel, this._defaultPipelineTextureType, !1), this.depthOfField.focalLength = t.focalLength, this.depthOfField.focusDistance = t.focusDistance, this.depthOfField.fStop = t.fStop, this.depthOfField.lensSize = t.lensSize; for (var i = 0; i < this._cameras.length; i++)t.disposeEffects(this._cameras[i]); this._buildPipeline() } }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "fxaaEnabled", { get: function () { return this._fxaaEnabled }, set: function (e) { this._fxaaEnabled !== e && (this._fxaaEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "samples", { get: function () { return this._samples }, set: function (e) { this._samples !== e && (this._samples = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "imageProcessingEnabled", { get: function () { return this._imageProcessingEnabled }, set: function (e) { this._imageProcessingEnabled !== e && (this._imageProcessingEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "glowLayerEnabled", { get: function () { return null == this._glowLayer }, set: function (e) { e && !this._glowLayer ? this._glowLayer = new Bn.GlowLayer("", this._scene) : !e && this._glowLayer && (this._glowLayer.dispose(), this._glowLayer = null) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "chromaticAberrationEnabled", { get: function () { return this._chromaticAberrationEnabled }, set: function (e) { this._chromaticAberrationEnabled !== e && (this._chromaticAberrationEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "grainEnabled", { get: function () { return this._grainEnabled }, set: function (e) { this._grainEnabled !== e && (this._grainEnabled = e, this._buildPipeline()) }, enumerable: !0, configurable: !0 }), t.prototype.prepare = function () { var e = this._buildAllowed; this._buildAllowed = !0, this._buildPipeline(), this._buildAllowed = e }, t.prototype._setAutoClearAndTextureSharing = function (e, t) { void 0 === t && (t = !1), this._hasCleared ? e.autoClear = !1 : (e.autoClear = !0, this._scene.autoClear = !1, this._hasCleared = !0), t || (this._prevPrevPostProcess ? e.shareOutputWith(this._prevPrevPostProcess) : e.useOwnOutput(), this._prevPostProcess && (this._prevPrevPostProcess = this._prevPostProcess), this._prevPostProcess = e) }, t.prototype._buildPipeline = function () { var e = this; if (this._buildAllowed) { this._scene.autoClear = !0; var t = this._scene.getEngine(); if (this._disposePostProcesses(), null !== this._cameras && (this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._cameras), this._cameras = this._camerasToBeAttached.slice()), this._reset(), this._prevPostProcess = null, this._prevPrevPostProcess = null, this._hasCleared = !1, this.depthOfFieldEnabled) { if (1 < this._cameras.length) { for (var i = 0, r = this._cameras; i < r.length; i++) { var n = r[i]; (o = this._scene.enableDepthRenderer(n)).useOnlyInActiveCamera = !0 } this._depthOfFieldSceneObserver = this._scene.onAfterRenderTargetsRenderObservable.add(function (t) { -1 < e._cameras.indexOf(t.activeCamera) && (e.depthOfField.depthTexture = t.enableDepthRenderer(t.activeCamera).getDepthMap()) }) } else { this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver); var o = this._scene.enableDepthRenderer(this._cameras[0]); this.depthOfField.depthTexture = o.getDepthMap() } this.depthOfField._isReady() || this.depthOfField._updateEffects(), this.addEffect(this.depthOfField), this._setAutoClearAndTextureSharing(this.depthOfField._effects[0], !0) } else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver); this.bloomEnabled && (this.bloom._isReady() || this.bloom._updateEffects(), this.addEffect(this.bloom), this._setAutoClearAndTextureSharing(this.bloom._effects[0], !0)), this._imageProcessingEnabled && (this.imageProcessing = new Bn.ImageProcessingPostProcess("imageProcessing", 1, null, Bn.Texture.BILINEAR_SAMPLINGMODE, t, !1, this._defaultPipelineTextureType), this._hdr ? (this.addEffect(new Bn.PostProcessRenderEffect(t, this.ImageProcessingPostProcessId, function () { return e.imageProcessing }, !0)), this._setAutoClearAndTextureSharing(this.imageProcessing)) : this._scene.imageProcessingConfiguration.applyByPostProcess = !1), this.sharpenEnabled && (this.sharpen.isReady() || this.sharpen.updateEffect(), this.addEffect(this._sharpenEffect), this._setAutoClearAndTextureSharing(this.sharpen)), this.grainEnabled && (this.grain.isReady() || this.grain.updateEffect(), this.addEffect(this._grainEffect), this._setAutoClearAndTextureSharing(this.grain)), this.chromaticAberrationEnabled && (this.chromaticAberration.isReady() || this.chromaticAberration.updateEffect(), this.addEffect(this._chromaticAberrationEffect), this._setAutoClearAndTextureSharing(this.chromaticAberration)), this.fxaaEnabled && (this.fxaa = new Bn.FxaaPostProcess("fxaa", 1, null, Bn.Texture.BILINEAR_SAMPLINGMODE, t, !1, this._defaultPipelineTextureType), this.addEffect(new Bn.PostProcessRenderEffect(t, this.FxaaPostProcessId, function () { return e.fxaa }, !0)), this._setAutoClearAndTextureSharing(this.fxaa, !0)), null !== this._cameras && this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name, this._cameras), !this._enableMSAAOnFirstPostProcess(this.samples) && 1 < this.samples && Bn.Tools.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0") } }, t.prototype._disposePostProcesses = function (e) { void 0 === e && (e = !1); for (var t = 0; t < this._cameras.length; t++) { var i = this._cameras[t]; this.imageProcessing && this.imageProcessing.dispose(i), this.fxaa && this.fxaa.dispose(i), e && (this.sharpen && this.sharpen.dispose(i), this.depthOfField && (this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver), this.depthOfField.disposeEffects(i)), this.bloom && this.bloom.disposeEffects(i), this.chromaticAberration && this.chromaticAberration.dispose(i), this.grain && this.grain.dispose(i), this._glowLayer && this._glowLayer.dispose()) } this.imageProcessing = null, this.fxaa = null, e && (this.sharpen = null, this._sharpenEffect = null, this.depthOfField = null, this.bloom = null, this.chromaticAberration = null, this._chromaticAberrationEffect = null, this.grain = null, this._grainEffect = null, this._glowLayer = null) }, t.prototype.addCamera = function (e) { this._camerasToBeAttached.push(e), this._buildPipeline() }, t.prototype.removeCamera = function (e) { var t = this._camerasToBeAttached.indexOf(e); this._camerasToBeAttached.splice(t, 1), this._buildPipeline() }, t.prototype.dispose = function () { this._disposePostProcesses(!0), this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._cameras), this._scene.autoClear = !0, this._resizeObserver && (this._scene.getEngine().onResizeObservable.remove(this._resizeObserver), this._resizeObserver = null), this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver), e.prototype.dispose.call(this) }, t.prototype.serialize = function () { var e = Bn.SerializationHelper.Serialize(this); return e.customType = "DefaultRenderingPipeline", e }, t.Parse = function (e, i, r) { return Bn.SerializationHelper.Parse(function () { return new t(e._name, e._name._hdr, i) }, e, i, r) }, b([Bn.serialize()], t.prototype, "sharpenEnabled", null), b([Bn.serialize()], t.prototype, "bloomKernel", null), b([Bn.serialize()], t.prototype, "_bloomWeight", void 0), b([Bn.serialize()], t.prototype, "_bloomThreshold", void 0), b([Bn.serialize()], t.prototype, "_hdr", void 0), b([Bn.serialize()], t.prototype, "bloomWeight", null), b([Bn.serialize()], t.prototype, "bloomThreshold", null), b([Bn.serialize()], t.prototype, "bloomScale", null), b([Bn.serialize()], t.prototype, "bloomEnabled", null), b([Bn.serialize()], t.prototype, "depthOfFieldEnabled", null), b([Bn.serialize()], t.prototype, "depthOfFieldBlurLevel", null), b([Bn.serialize()], t.prototype, "fxaaEnabled", null), b([Bn.serialize()], t.prototype, "samples", null), b([Bn.serialize()], t.prototype, "imageProcessingEnabled", null), b([Bn.serialize()], t.prototype, "glowLayerEnabled", null), b([Bn.serialize()], t.prototype, "chromaticAberrationEnabled", null), b([Bn.serialize()], t.prototype, "grainEnabled", null), t }((Bn = $a || ($a = {})).PostProcessRenderPipeline), Bn.DefaultRenderingPipeline = Nn, function (e) { var t = function (e) { function t() { var t = e.call(this) || this; return t.IMAGEPROCESSING = !1, t.VIGNETTE = !1, t.VIGNETTEBLENDMODEMULTIPLY = !1, t.VIGNETTEBLENDMODEOPAQUE = !1, t.TONEMAPPING = !1, t.TONEMAPPING_ACES = !1, t.CONTRAST = !1, t.COLORCURVES = !1, t.COLORGRADING = !1, t.COLORGRADING3D = !1, t.SAMPLER3DGREENDEPTH = !1, t.SAMPLER3DBGRMAP = !1, t.IMAGEPROCESSINGPOSTPROCESS = !1, t.EXPOSURE = !1, t.rebuild(), t } return T(t, e), t }(e.MaterialDefines); e.ImageProcessingConfigurationDefines = t; var i = function () { function t() { this.colorCurves = new e.ColorCurves, this._colorCurvesEnabled = !1, this._colorGradingEnabled = !1, this._colorGradingWithGreenDepth = !0, this._colorGradingBGR = !0, this._exposure = 1, this._toneMappingEnabled = !1, this._toneMappingType = t.TONEMAPPING_STANDARD, this._contrast = 1, this.vignetteStretch = 0, this.vignetteCentreX = 0, this.vignetteCentreY = 0, this.vignetteWeight = 1.5, this.vignetteColor = new e.Color4(0, 0, 0, 0), this.vignetteCameraFov = .5, this._vignetteBlendMode = t.VIGNETTEMODE_MULTIPLY, this._vignetteEnabled = !1, this._applyByPostProcess = !1, this._isEnabled = !0, this.onUpdateParameters = new e.Observable } return Object.defineProperty(t.prototype, "colorCurvesEnabled", { get: function () { return this._colorCurvesEnabled }, set: function (e) { this._colorCurvesEnabled !== e && (this._colorCurvesEnabled = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "colorGradingTexture", { get: function () { return this._colorGradingTexture }, set: function (e) { this._colorGradingTexture !== e && (this._colorGradingTexture = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "colorGradingEnabled", { get: function () { return this._colorGradingEnabled }, set: function (e) { this._colorGradingEnabled !== e && (this._colorGradingEnabled = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "colorGradingWithGreenDepth", { get: function () { return this._colorGradingWithGreenDepth }, set: function (e) { this._colorGradingWithGreenDepth !== e && (this._colorGradingWithGreenDepth = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "colorGradingBGR", { get: function () { return this._colorGradingBGR }, set: function (e) { this._colorGradingBGR !== e && (this._colorGradingBGR = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "exposure", { get: function () { return this._exposure }, set: function (e) { this._exposure !== e && (this._exposure = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "toneMappingEnabled", { get: function () { return this._toneMappingEnabled }, set: function (e) { this._toneMappingEnabled !== e && (this._toneMappingEnabled = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "toneMappingType", { get: function () { return this._toneMappingType }, set: function (e) { this._toneMappingType !== e && (this._toneMappingType = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "contrast", { get: function () { return this._contrast }, set: function (e) { this._contrast !== e && (this._contrast = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteBlendMode", { get: function () { return this._vignetteBlendMode }, set: function (e) { this._vignetteBlendMode !== e && (this._vignetteBlendMode = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteEnabled", { get: function () { return this._vignetteEnabled }, set: function (e) { this._vignetteEnabled !== e && (this._vignetteEnabled = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "applyByPostProcess", { get: function () { return this._applyByPostProcess }, set: function (e) { this._applyByPostProcess !== e && (this._applyByPostProcess = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "isEnabled", { get: function () { return this._isEnabled }, set: function (e) { this._isEnabled !== e && (this._isEnabled = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), t.prototype._updateParameters = function () { this.onUpdateParameters.notifyObservers(this) }, t.prototype.getClassName = function () { return "ImageProcessingConfiguration" }, t.PrepareUniforms = function (t, i) { i.EXPOSURE && t.push("exposureLinear"), i.CONTRAST && t.push("contrast"), i.COLORGRADING && t.push("colorTransformSettings"), i.VIGNETTE && (t.push("vInverseScreenSize"), t.push("vignetteSettings1"), t.push("vignetteSettings2")), i.COLORCURVES && e.ColorCurves.PrepareUniforms(t) }, t.PrepareSamplers = function (e, t) { t.COLORGRADING && e.push("txColorTransform") }, t.prototype.prepareDefines = function (e, i) { if (void 0 === i && (i = !1), i !== this.applyByPostProcess || !this._isEnabled) return e.VIGNETTE = !1, e.TONEMAPPING = !1, e.TONEMAPPING_ACES = !1, e.CONTRAST = !1, e.EXPOSURE = !1, e.COLORCURVES = !1, e.COLORGRADING = !1, e.COLORGRADING3D = !1, e.IMAGEPROCESSING = !1, void (e.IMAGEPROCESSINGPOSTPROCESS = this.applyByPostProcess && this._isEnabled); switch (e.VIGNETTE = this.vignetteEnabled, e.VIGNETTEBLENDMODEMULTIPLY = this.vignetteBlendMode === t._VIGNETTEMODE_MULTIPLY, e.VIGNETTEBLENDMODEOPAQUE = !e.VIGNETTEBLENDMODEMULTIPLY, e.TONEMAPPING = this.toneMappingEnabled, this._toneMappingType) { case t.TONEMAPPING_ACES: e.TONEMAPPING_ACES = !0 }e.CONTRAST = 1 !== this.contrast, e.EXPOSURE = 1 !== this.exposure, e.COLORCURVES = this.colorCurvesEnabled && !!this.colorCurves, e.COLORGRADING = this.colorGradingEnabled && !!this.colorGradingTexture, e.COLORGRADING ? e.COLORGRADING3D = this.colorGradingTexture.is3D : e.COLORGRADING3D = !1, e.SAMPLER3DGREENDEPTH = this.colorGradingWithGreenDepth, e.SAMPLER3DBGRMAP = this.colorGradingBGR, e.IMAGEPROCESSINGPOSTPROCESS = this.applyByPostProcess, e.IMAGEPROCESSING = e.VIGNETTE || e.TONEMAPPING || e.CONTRAST || e.EXPOSURE || e.COLORCURVES || e.COLORGRADING }, t.prototype.isReady = function () { return !this.colorGradingEnabled || !this.colorGradingTexture || this.colorGradingTexture.isReady() }, t.prototype.bind = function (t, i) { if (void 0 === i && (i = 1), this._colorCurvesEnabled && this.colorCurves && e.ColorCurves.Bind(this.colorCurves, t), this._vignetteEnabled) { var r = 1 / t.getEngine().getRenderWidth(), n = 1 / t.getEngine().getRenderHeight(); t.setFloat2("vInverseScreenSize", r, n); var o = Math.tan(.5 * this.vignetteCameraFov), s = o * i, a = Math.sqrt(s * o); s = e.Tools.Mix(s, a, this.vignetteStretch), o = e.Tools.Mix(o, a, this.vignetteStretch), t.setFloat4("vignetteSettings1", s, o, -s * this.vignetteCentreX, -o * this.vignetteCentreY); var l = -2 * this.vignetteWeight; t.setFloat4("vignetteSettings2", this.vignetteColor.r, this.vignetteColor.g, this.vignetteColor.b, l) } if (t.setFloat("exposureLinear", this.exposure), t.setFloat("contrast", this.contrast), this.colorGradingTexture) { t.setTexture("txColorTransform", this.colorGradingTexture); var c = this.colorGradingTexture.getSize().height; t.setFloat4("colorTransformSettings", (c - 1) / c, .5 / c, c, this.colorGradingTexture.level) } }, t.prototype.clone = function () { return e.SerializationHelper.Clone(function () { return new t }, this) }, t.prototype.serialize = function () { return e.SerializationHelper.Serialize(this) }, t.Parse = function (i) { return e.SerializationHelper.Parse(function () { return new t }, i, null, null) }, Object.defineProperty(t, "VIGNETTEMODE_MULTIPLY", { get: function () { return this._VIGNETTEMODE_MULTIPLY }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, "VIGNETTEMODE_OPAQUE", { get: function () { return this._VIGNETTEMODE_OPAQUE }, enumerable: !0, configurable: !0 }), t.TONEMAPPING_STANDARD = 0, t.TONEMAPPING_ACES = 1, t._VIGNETTEMODE_MULTIPLY = 0, t._VIGNETTEMODE_OPAQUE = 1, b([e.serializeAsColorCurves()], t.prototype, "colorCurves", void 0), b([e.serialize()], t.prototype, "_colorCurvesEnabled", void 0), b([e.serializeAsTexture("colorGradingTexture")], t.prototype, "_colorGradingTexture", void 0), b([e.serialize()], t.prototype, "_colorGradingEnabled", void 0), b([e.serialize()], t.prototype, "_colorGradingWithGreenDepth", void 0), b([e.serialize()], t.prototype, "_colorGradingBGR", void 0), b([e.serialize()], t.prototype, "_exposure", void 0), b([e.serialize()], t.prototype, "_toneMappingEnabled", void 0), b([e.serialize()], t.prototype, "_toneMappingType", void 0), b([e.serialize()], t.prototype, "_contrast", void 0), b([e.serialize()], t.prototype, "vignetteStretch", void 0), b([e.serialize()], t.prototype, "vignetteCentreX", void 0), b([e.serialize()], t.prototype, "vignetteCentreY", void 0), b([e.serialize()], t.prototype, "vignetteWeight", void 0), b([e.serializeAsColor4()], t.prototype, "vignetteColor", void 0), b([e.serialize()], t.prototype, "vignetteCameraFov", void 0), b([e.serialize()], t.prototype, "_vignetteBlendMode", void 0), b([e.serialize()], t.prototype, "_vignetteEnabled", void 0), b([e.serialize()], t.prototype, "_applyByPostProcess", void 0), b([e.serialize()], t.prototype, "_isEnabled", void 0), t }(); e.ImageProcessingConfiguration = i }($a || ($a = {})), Un = function (e) { function t(t, i) { var r = e.call(this, i) || this; return t && (r._engine = i.getEngine(), r._textureMatrix = Vn.Matrix.Identity(), r.name = t, r.url = t, r.hasAlpha = !1, r.isCube = !1, r.is3D = 1 < r._engine.webGLVersion, r.wrapU = Vn.Texture.CLAMP_ADDRESSMODE, r.wrapV = Vn.Texture.CLAMP_ADDRESSMODE, r.wrapR = Vn.Texture.CLAMP_ADDRESSMODE, r.anisotropicFilteringLevel = 1, r._texture = r._getFromCache(t, !0), r._texture || (i.useDelayedTextureLoading ? r.delayLoadState = Vn.Engine.DELAYLOADSTATE_NOTLOADED : r.loadTexture())), r } return T(t, e), t.prototype.getTextureMatrix = function () { return this._textureMatrix }, t.prototype.load3dlTexture = function () { var e, i = this._engine; e = 1 === i.webGLVersion ? i.createRawTexture(null, 1, 1, Vn.Engine.TEXTUREFORMAT_RGBA, !1, !1, Vn.Texture.BILINEAR_SAMPLINGMODE) : i.createRawTexture3D(null, 1, 1, 1, Vn.Engine.TEXTUREFORMAT_RGBA, !1, !1, Vn.Texture.BILINEAR_SAMPLINGMODE), this._texture = e; var r = function (r) { if ("string" == typeof r) { for (var n, o = null, s = null, a = r.split("\n"), l = 0, c = 0, h = 0, u = 0, d = 0, f = 0; f < a.length; f++)if (n = a[f], t._noneEmptyLineRegex.test(n) && 0 !== n.indexOf("#")) { var p = n.split(" "); if (0 !== l) { if (0 != l) { var _ = Math.max(parseInt(p[0]), 0), m = Math.max(parseInt(p[1]), 0), g = Math.max(parseInt(p[2]), 0); d = Math.max(_, d), d = Math.max(m, d), d = Math.max(g, d); var v = 4 * (c + u * l + h * l * l); s && (s[v + 0] = _, s[v + 1] = m, s[v + 2] = g), ++h % l == 0 && ++u % l == (h = 0) && (c++ , u = 0) } } else l = p.length, o = new Uint8Array(l * l * l * 4), s = new Float32Array(l * l * l * 4) } if (s && o) for (f = 0; f < s.length; f++)if (0 < f && (f + 1) % 4 == 0) o[f] = 255; else { var y = s[f]; o[f] = y / d * 255 } e.is3D ? (e.updateSize(l, l, l), i.updateRawTexture3D(e, o, Vn.Engine.TEXTUREFORMAT_RGBA, !1)) : (e.updateSize(l * l, l), i.updateRawTexture(e, o, Vn.Engine.TEXTUREFORMAT_RGBA, !1)) } }, n = this.getScene(); return n ? n._loadFile(this.url, r) : this._engine._loadFile(this.url, r), this._texture }, t.prototype.loadTexture = function () { this.url && this.url.toLocaleLowerCase().indexOf(".3dl") == this.url.length - 4 && this.load3dlTexture() }, t.prototype.clone = function () { var e = new t(this.url, this.getScene()); return e.level = this.level, e }, t.prototype.delayLoad = function () { this.delayLoadState === Vn.Engine.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = Vn.Engine.DELAYLOADSTATE_LOADED, this._texture = this._getFromCache(this.url, !0), this._texture || this.loadTexture()) }, t.Parse = function (e, i, r) { var n = null; return e.name && !e.isRenderTarget && ((n = new t(e.name, i)).name = e.name, n.level = e.level), n }, t.prototype.serialize = function () { if (!this.name) return null; var e = {}; return e.name = this.name, e.level = this.level, e.customType = "BABYLON.ColorGradingTexture", e }, t._noneEmptyLineRegex = /\S+/, t }((Vn = $a || ($a = {})).BaseTexture), Vn.ColorGradingTexture = Un, zn = $a || ($a = {}), Gn = function () { function e() { this._dirty = !0, this._tempColor = new zn.Color4(0, 0, 0, 0), this._globalCurve = new zn.Color4(0, 0, 0, 0), this._highlightsCurve = new zn.Color4(0, 0, 0, 0), this._midtonesCurve = new zn.Color4(0, 0, 0, 0), this._shadowsCurve = new zn.Color4(0, 0, 0, 0), this._positiveCurve = new zn.Color4(0, 0, 0, 0), this._negativeCurve = new zn.Color4(0, 0, 0, 0), this._globalHue = 30, this._globalDensity = 0, this._globalSaturation = 0, this._globalExposure = 0, this._highlightsHue = 30, this._highlightsDensity = 0, this._highlightsSaturation = 0, this._highlightsExposure = 0, this._midtonesHue = 30, this._midtonesDensity = 0, this._midtonesSaturation = 0, this._midtonesExposure = 0, this._shadowsHue = 30, this._shadowsDensity = 0, this._shadowsSaturation = 0, this._shadowsExposure = 0 } return Object.defineProperty(e.prototype, "globalHue", { get: function () { return this._globalHue }, set: function (e) { this._globalHue = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "globalDensity", { get: function () { return this._globalDensity }, set: function (e) { this._globalDensity = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "globalSaturation", { get: function () { return this._globalSaturation }, set: function (e) { this._globalSaturation = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "globalExposure", { get: function () { return this._globalExposure }, set: function (e) { this._globalExposure = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "highlightsHue", { get: function () { return this._highlightsHue }, set: function (e) { this._highlightsHue = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "highlightsDensity", { get: function () { return this._highlightsDensity }, set: function (e) { this._highlightsDensity = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "highlightsSaturation", { get: function () { return this._highlightsSaturation }, set: function (e) { this._highlightsSaturation = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "highlightsExposure", { get: function () { return this._highlightsExposure }, set: function (e) { this._highlightsExposure = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "midtonesHue", { get: function () { return this._midtonesHue }, set: function (e) { this._midtonesHue = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "midtonesDensity", { get: function () { return this._midtonesDensity }, set: function (e) { this._midtonesDensity = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "midtonesSaturation", { get: function () { return this._midtonesSaturation }, set: function (e) { this._midtonesSaturation = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "midtonesExposure", { get: function () { return this._midtonesExposure }, set: function (e) { this._midtonesExposure = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "shadowsHue", { get: function () { return this._shadowsHue }, set: function (e) { this._shadowsHue = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "shadowsDensity", { get: function () { return this._shadowsDensity }, set: function (e) { this._shadowsDensity = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "shadowsSaturation", { get: function () { return this._shadowsSaturation }, set: function (e) { this._shadowsSaturation = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "shadowsExposure", { get: function () { return this._shadowsExposure }, set: function (e) { this._shadowsExposure = e, this._dirty = !0 }, enumerable: !0, configurable: !0 }), e.prototype.getClassName = function () { return "ColorCurves" }, e.Bind = function (e, t, i, r, n) { void 0 === i && (i = "vCameraColorCurvePositive"), void 0 === r && (r = "vCameraColorCurveNeutral"), void 0 === n && (n = "vCameraColorCurveNegative"), e._dirty && (e._dirty = !1, e.getColorGradingDataToRef(e._globalHue, e._globalDensity, e._globalSaturation, e._globalExposure, e._globalCurve), e.getColorGradingDataToRef(e._highlightsHue, e._highlightsDensity, e._highlightsSaturation, e._highlightsExposure, e._tempColor), e._tempColor.multiplyToRef(e._globalCurve, e._highlightsCurve), e.getColorGradingDataToRef(e._midtonesHue, e._midtonesDensity, e._midtonesSaturation, e._midtonesExposure, e._tempColor), e._tempColor.multiplyToRef(e._globalCurve, e._midtonesCurve), e.getColorGradingDataToRef(e._shadowsHue, e._shadowsDensity, e._shadowsSaturation, e._shadowsExposure, e._tempColor), e._tempColor.multiplyToRef(e._globalCurve, e._shadowsCurve), e._highlightsCurve.subtractToRef(e._midtonesCurve, e._positiveCurve), e._midtonesCurve.subtractToRef(e._shadowsCurve, e._negativeCurve)), t && (t.setFloat4(i, e._positiveCurve.r, e._positiveCurve.g, e._positiveCurve.b, e._positiveCurve.a), t.setFloat4(r, e._midtonesCurve.r, e._midtonesCurve.g, e._midtonesCurve.b, e._midtonesCurve.a), t.setFloat4(n, e._negativeCurve.r, e._negativeCurve.g, e._negativeCurve.b, e._negativeCurve.a)) }, e.PrepareUniforms = function (e) { e.push("vCameraColorCurveNeutral", "vCameraColorCurvePositive", "vCameraColorCurveNegative") }, e.prototype.getColorGradingDataToRef = function (t, i, r, n, o) { null != t && (t = e.clamp(t, 0, 360), i = e.clamp(i, -100, 100), r = e.clamp(r, -100, 100), n = e.clamp(n, -100, 100), i = e.applyColorGradingSliderNonlinear(i), i *= .5, n = e.applyColorGradingSliderNonlinear(n), i < 0 && (i *= -1, t = (t + 180) % 360), e.fromHSBToRef(t, i, 50 + .25 * n, o), o.scaleToRef(2, o), o.a = 1 + .01 * r) }, e.applyColorGradingSliderNonlinear = function (e) { e /= 100; var t = Math.abs(e); return t = Math.pow(t, 2), e < 0 && (t *= -1), 100 * t }, e.fromHSBToRef = function (t, i, r, n) { var o = e.clamp(t, 0, 360), s = e.clamp(i / 100, 0, 1), a = e.clamp(r / 100, 0, 1); if (0 === s) n.r = a, n.g = a, n.b = a; else { o /= 60; var l = Math.floor(o), c = o - l, h = a * (1 - s), u = a * (1 - s * c), d = a * (1 - s * (1 - c)); switch (l) { case 0: n.r = a, n.g = d, n.b = h; break; case 1: n.r = u, n.g = a, n.b = h; break; case 2: n.r = h, n.g = a, n.b = d; break; case 3: n.r = h, n.g = u, n.b = a; break; case 4: n.r = d, n.g = h, n.b = a; break; default: n.r = a, n.g = h, n.b = u } } n.a = 1 }, e.clamp = function (e, t, i) { return Math.min(Math.max(e, t), i) }, e.prototype.clone = function () { return zn.SerializationHelper.Clone(function () { return new e }, this) }, e.prototype.serialize = function () { return zn.SerializationHelper.Serialize(this) }, e.Parse = function (t) { return zn.SerializationHelper.Parse(function () { return new e }, t, null, null) }, b([zn.serialize()], e.prototype, "_globalHue", void 0), b([zn.serialize()], e.prototype, "_globalDensity", void 0), b([zn.serialize()], e.prototype, "_globalSaturation", void 0), b([zn.serialize()], e.prototype, "_globalExposure", void 0), b([zn.serialize()], e.prototype, "_highlightsHue", void 0), b([zn.serialize()], e.prototype, "_highlightsDensity", void 0), b([zn.serialize()], e.prototype, "_highlightsSaturation", void 0), b([zn.serialize()], e.prototype, "_highlightsExposure", void 0), b([zn.serialize()], e.prototype, "_midtonesHue", void 0), b([zn.serialize()], e.prototype, "_midtonesDensity", void 0), b([zn.serialize()], e.prototype, "_midtonesSaturation", void 0), b([zn.serialize()], e.prototype, "_midtonesExposure", void 0), e }(), zn.ColorCurves = Gn, Wn = function (e) { function t(t, i, r, n, o, s, a, l, c, h) { var u = e.call(this, t, "refraction", ["baseColor", "depth", "colorLevel"], ["refractionSampler"], s, a, l, c, h) || this; return u.color = r, u.depth = n, u.colorLevel = o, u._ownRefractionTexture = !0, u.onActivateObservable.add(function (e) { u._refTexture = u._refTexture || new kn.Texture(i, e.getScene()) }), u.onApplyObservable.add(function (e) { e.setColor3("baseColor", u.color), e.setFloat("depth", u.depth), e.setFloat("colorLevel", u.colorLevel), e.setTexture("refractionSampler", u._refTexture) }), u } return T(t, e), Object.defineProperty(t.prototype, "refractionTexture", { get: function () { return this._refTexture }, set: function (e) { this._refTexture && this._ownRefractionTexture && this._refTexture.dispose(), this._refTexture = e, this._ownRefractionTexture = !1 }, enumerable: !0, configurable: !0 }), t.prototype.dispose = function (t) { this._refTexture && this._ownRefractionTexture && (this._refTexture.dispose(), this._refTexture = null), e.prototype.dispose.call(this, t) }, t }((kn = $a || ($a = {})).PostProcess), kn.RefractionPostProcess = Wn, Xn = function (e) { function t(t, i, r, n, o, s) { var a = e.call(this, t, "blackAndWhite", ["degree"], null, i, r, n, o, s) || this; return a.degree = 1, a.onApplyObservable.add(function (e) { e.setFloat("degree", a.degree) }), a } return T(t, e), t }((Hn = $a || ($a = {})).PostProcess), Hn.BlackAndWhitePostProcess = Xn, Yn = function (e) { function t(t, i, r, n, o, s, a, l) { void 0 === l && (l = jn.Engine.TEXTURETYPE_UNSIGNED_INT); var c = e.call(this, t, "convolution", ["kernel", "screenSize"], null, r, n, o, s, a, null, l) || this; return c.kernel = i, c.onApply = function (e) { e.setFloat2("screenSize", c.width, c.height), e.setArray("kernel", c.kernel) }, c } return T(t, e), t.EdgeDetect0Kernel = [1, 0, -1, 0, 0, 0, -1, 0, 1], t.EdgeDetect1Kernel = [0, 1, 0, 1, -4, 1, 0, 1, 0], t.EdgeDetect2Kernel = [-1, -1, -1, -1, 8, -1, -1, -1, -1], t.SharpenKernel = [0, -1, 0, -1, 5, -1, 0, -1, 0], t.EmbossKernel = [-2, -1, 0, -1, 1, 1, 0, 1, 2], t.GaussianKernel = [0, 1, 0, 1, 1, 1, 0, 1, 0], t }((jn = $a || ($a = {})).PostProcess), jn.ConvolutionPostProcess = Yn, Qn = function (e) { function t(t, i, r, n, o, s, a) { var l = e.call(this, t, "filter", ["kernelMatrix"], null, r, n, o, s, a) || this; return l.kernelMatrix = i, l.onApply = function (e) { e.setMatrix("kernelMatrix", l.kernelMatrix) }, l } return T(t, e), t }((Kn = $a || ($a = {})).PostProcess), Kn.FilterPostProcess = Qn, qn = function (e) { function t(i, r, n, o, s, a, l, c, h) { void 0 === s && (s = 100), void 0 === a && (a = Zn.Texture.BILINEAR_SAMPLINGMODE); var u = e.call(this, i, "volumetricLightScattering", ["decay", "exposure", "weight", "meshPositionOnScreen", "density"], ["lightScatteringSampler"], r.postProcessRatio || r, n, a, l, c, "#define NUM_SAMPLES " + s) || this; return u._screenCoordinates = Zn.Vector2.Zero(), u.customMeshPosition = Zn.Vector3.Zero(), u.useCustomMeshPosition = !1, u.invert = !0, u.excludedMeshes = new Array, u.exposure = .3, u.decay = .96815, u.weight = .58767, u.density = .926, l = (h = null === n ? h : n.getScene()).getEngine(), u._viewPort = new Zn.Viewport(0, 0, 1, 1).toGlobal(l.getRenderWidth(), l.getRenderHeight()), u.mesh = null !== o ? o : t.CreateDefaultMesh("VolumetricLightScatteringMesh", h), u._createPass(h, r.passRatio || r), u.onActivate = function (e) { u.isSupported || u.dispose(e), u.onActivate = null }, u.onApplyObservable.add(function (e) { u._updateMeshScreenCoordinates(h), e.setTexture("lightScatteringSampler", u._volumetricLightScatteringRTT), e.setFloat("exposure", u.exposure), e.setFloat("decay", u.decay), e.setFloat("weight", u.weight), e.setFloat("density", u.density), e.setVector2("meshPositionOnScreen", u._screenCoordinates) }), u } return T(t, e), Object.defineProperty(t.prototype, "useDiffuseColor", { get: function () { return Zn.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"), !1 }, set: function (e) { Zn.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead") }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "VolumetricLightScatteringPostProcess" }, t.prototype._isReady = function (e, t) { var i = e.getMesh(); if (i === this.mesh && i.material) return i.material.isReady(i); var r = [], n = [Zn.VertexBuffer.PositionKind], o = e.getMaterial(); o && (o.needAlphaTesting() && r.push("#define ALPHATEST"), i.isVerticesDataPresent(Zn.VertexBuffer.UVKind) && (n.push(Zn.VertexBuffer.UVKind), r.push("#define UV1")), i.isVerticesDataPresent(Zn.VertexBuffer.UV2Kind) && (n.push(Zn.VertexBuffer.UV2Kind), r.push("#define UV2"))), i.useBones && i.computeBonesUsingShaders ? (n.push(Zn.VertexBuffer.MatricesIndicesKind), n.push(Zn.VertexBuffer.MatricesWeightsKind), r.push("#define NUM_BONE_INFLUENCERS " + i.numBoneInfluencers), r.push("#define BonesPerMesh " + (i.skeleton ? i.skeleton.bones.length + 1 : 0))) : r.push("#define NUM_BONE_INFLUENCERS 0"), t && (r.push("#define INSTANCES"), n.push("world0"), n.push("world1"), n.push("world2"), n.push("world3")); var s = r.join("\n"); return this._cachedDefines !== s && (this._cachedDefines = s, this._volumetricLightScatteringPass = i.getScene().getEngine().createEffect({ vertexElement: "depth", fragmentElement: "volumetricLightScatteringPass" }, n, ["world", "mBones", "viewProjection", "diffuseMatrix"], ["diffuseSampler"], s)), this._volumetricLightScatteringPass.isReady() }, t.prototype.setCustomMeshPosition = function (e) { this.customMeshPosition = e }, t.prototype.getCustomMeshPosition = function () { return this.customMeshPosition }, t.prototype.dispose = function (t) { var i = t.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT); -1 !== i && t.getScene().customRenderTargets.splice(i, 1), this._volumetricLightScatteringRTT.dispose(), e.prototype.dispose.call(this, t) }, t.prototype.getPass = function () { return this._volumetricLightScatteringRTT }, t.prototype._meshExcluded = function (e) { return 0 < this.excludedMeshes.length && -1 !== this.excludedMeshes.indexOf(e) }, t.prototype._createPass = function (e, t) { var i = this, r = e.getEngine(); this._volumetricLightScatteringRTT = new Zn.RenderTargetTexture("volumetricLightScatteringMap", { width: r.getRenderWidth() * t, height: r.getRenderHeight() * t }, e, !1, !0, Zn.Engine.TEXTURETYPE_UNSIGNED_INT), this._volumetricLightScatteringRTT.wrapU = Zn.Texture.CLAMP_ADDRESSMODE, this._volumetricLightScatteringRTT.wrapV = Zn.Texture.CLAMP_ADDRESSMODE, this._volumetricLightScatteringRTT.renderList = null, this._volumetricLightScatteringRTT.renderParticles = !1, this._volumetricLightScatteringRTT.ignoreCameraViewport = !0; var n = this.getCamera(); n ? n.customRenderTargets.push(this._volumetricLightScatteringRTT) : e.customRenderTargets.push(this._volumetricLightScatteringRTT); var o, s = function (e) { var t = e.getRenderingMesh(); if (!i._meshExcluded(t)) { var r = e.getMaterial(); if (r) { var n = t.getScene(), o = n.getEngine(); o.setState(r.backFaceCulling); var s = t._getInstancesRenderList(e._id); if (!s.mustReturn) { var a = o.getCaps().instancedArrays && null !== s.visibleInstances[e._id]; if (i._isReady(e, a)) { var l = i._volumetricLightScatteringPass; if (t === i.mesh && (l = e.effect ? e.effect : r.getEffect()), o.enableEffect(l), t._bind(e, l, Zn.Material.TriangleFillMode), t === i.mesh) r.bind(t.getWorldMatrix(), t); else { if (i._volumetricLightScatteringPass.setMatrix("viewProjection", n.getTransformMatrix()), r && r.needAlphaTesting()) { var c = r.getAlphaTestTexture(); i._volumetricLightScatteringPass.setTexture("diffuseSampler", c), c && i._volumetricLightScatteringPass.setMatrix("diffuseMatrix", c.getTextureMatrix()) } t.useBones && t.computeBonesUsingShaders && t.skeleton && i._volumetricLightScatteringPass.setMatrices("mBones", t.skeleton.getTransformMatrices(t)) } t._processRendering(e, i._volumetricLightScatteringPass, Zn.Material.TriangleFillMode, s, a, function (e, t) { return l.setMatrix("world", t) }) } } } } }, a = new Zn.Color4(0, 0, 0, 1); this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function () { o = e.clearColor, e.clearColor = a }), this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function () { e.clearColor = o }), this._volumetricLightScatteringRTT.customRenderFunction = function (t, i, r, n) { var o, a = e.getEngine(); if (n.length) { for (a.setColorWrite(!1), o = 0; o < n.length; o++)s(n.data[o]); a.setColorWrite(!0) } for (o = 0; o < t.length; o++)s(t.data[o]); for (o = 0; o < i.length; o++)s(i.data[o]); if (r.length) { for (o = 0; o < r.length; o++) { var l = r.data[o], c = l.getBoundingInfo(); c && e.activeCamera && (l._alphaIndex = l.getMesh().alphaIndex, l._distanceToCamera = c.boundingSphere.centerWorld.subtract(e.activeCamera.position).length()) } var h = r.data.slice(0, r.length); for (h.sort(function (e, t) { return e._alphaIndex > t._alphaIndex ? 1 : e._alphaIndex < t._alphaIndex ? -1 : e._distanceToCamera < t._distanceToCamera ? 1 : e._distanceToCamera > t._distanceToCamera ? -1 : 0 }), a.setAlphaMode(Zn.Engine.ALPHA_COMBINE), o = 0; o < h.length; o++)s(h[o]); a.setAlphaMode(Zn.Engine.ALPHA_DISABLE) } } }, t.prototype._updateMeshScreenCoordinates = function (e) { var t, i = e.getTransformMatrix(); t = this.useCustomMeshPosition ? this.customMeshPosition : this.attachedNode ? this.attachedNode.position : this.mesh.parent ? this.mesh.getAbsolutePosition() : this.mesh.position; var r = Zn.Vector3.Project(t, Zn.Matrix.Identity(), i, this._viewPort); this._screenCoordinates.x = r.x / this._viewPort.width, this._screenCoordinates.y = r.y / this._viewPort.height, this.invert && (this._screenCoordinates.y = 1 - this._screenCoordinates.y) }, t.CreateDefaultMesh = function (e, t) { var i = Zn.Mesh.CreatePlane(e, 1, t); i.billboardMode = Zn.AbstractMesh.BILLBOARDMODE_ALL; var r = new Zn.StandardMaterial(e + "Material", t); return r.emissiveColor = new Zn.Color3(1, 1, 1), i.material = r, i }, b([Zn.serializeAsVector3()], t.prototype, "customMeshPosition", void 0), b([Zn.serialize()], t.prototype, "useCustomMeshPosition", void 0), b([Zn.serialize()], t.prototype, "invert", void 0), b([Zn.serializeAsMeshReference()], t.prototype, "mesh", void 0), b([Zn.serialize()], t.prototype, "excludedMeshes", void 0), b([Zn.serialize()], t.prototype, "exposure", void 0), b([Zn.serialize()], t.prototype, "decay", void 0), b([Zn.serialize()], t.prototype, "weight", void 0), b([Zn.serialize()], t.prototype, "density", void 0), t }((Zn = $a || ($a = {})).PostProcess), Zn.VolumetricLightScatteringPostProcess = qn, $n = function (e) { function t(t, i, r, n, o, s, a) { var l = e.call(this, t, "colorCorrection", null, ["colorTable"], r, n, o, s, a) || this; return l._colorTableTexture = new Jn.Texture(i, n.getScene(), !0, !1, Jn.Texture.TRILINEAR_SAMPLINGMODE), l._colorTableTexture.anisotropicFilteringLevel = 1, l._colorTableTexture.wrapU = Jn.Texture.CLAMP_ADDRESSMODE, l._colorTableTexture.wrapV = Jn.Texture.CLAMP_ADDRESSMODE, l.onApply = function (e) { e.setTexture("colorTable", l._colorTableTexture) }, l } return T(t, e), t }((Jn = $a || ($a = {})).PostProcess), Jn.ColorCorrectionPostProcess = $n, function (e) { var t, i; (i = t = e.TonemappingOperator || (e.TonemappingOperator = {}))[i.Hable = 0] = "Hable", i[i.Reinhard = 1] = "Reinhard", i[i.HejiDawson = 2] = "HejiDawson", i[i.Photographic = 3] = "Photographic"; var r = function (i) { function r(r, n, o, s, a, l, c) { void 0 === a && (a = e.Texture.BILINEAR_SAMPLINGMODE), void 0 === c && (c = e.Engine.TEXTURETYPE_UNSIGNED_INT); var h = i.call(this, r, "tonemap", ["_ExposureAdjustment"], null, 1, s, a, l, !0, null, c) || this; h._operator = n, h.exposureAdjustment = o; var u = "#define "; return h._operator === t.Hable ? u += "HABLE_TONEMAPPING" : h._operator === t.Reinhard ? u += "REINHARD_TONEMAPPING" : h._operator === t.HejiDawson ? u += "OPTIMIZED_HEJIDAWSON_TONEMAPPING" : h._operator === t.Photographic && (u += "PHOTOGRAPHIC_TONEMAPPING"), h.updateEffect(u), h.onApply = function (e) { e.setFloat("_ExposureAdjustment", h.exposureAdjustment) }, h } return T(r, i), r }(e.PostProcess); e.TonemapPostProcess = r }($a || ($a = {})), to = function (e) { function t(t, i, r, n, o, s) { return e.call(this, t, "displayPass", ["passSampler"], ["passSampler"], i, r, n, o, s) || this } return T(t, e), t }((eo = $a || ($a = {})).PostProcess), eo.DisplayPassPostProcess = to, ro = function (e) { function t(t, i, r, n, o, s, a) { return void 0 === a && (a = io.Engine.TEXTURETYPE_UNSIGNED_INT), e.call(this, t, "highlights", null, null, i, r, n, o, s, null, a) || this } return T(t, e), t }((io = $a || ($a = {})).PostProcess), io.HighlightsPostProcess = ro, oo = function (e) { function t(t, i, r, n, o, s, a, l) { void 0 === r && (r = null), void 0 === a && (a = no.Engine.TEXTURETYPE_UNSIGNED_INT); var c = e.call(this, t, "imageProcessing", [], [], i, r, n, o, s, null, a, "postprocess", null, !0) || this; return c._fromLinearSpace = !0, c._defines = { IMAGEPROCESSING: !1, VIGNETTE: !1, VIGNETTEBLENDMODEMULTIPLY: !1, VIGNETTEBLENDMODEOPAQUE: !1, TONEMAPPING: !1, TONEMAPPING_ACES: !1, CONTRAST: !1, COLORCURVES: !1, COLORGRADING: !1, COLORGRADING3D: !1, FROMLINEARSPACE: !1, SAMPLER3DGREENDEPTH: !1, SAMPLER3DBGRMAP: !1, IMAGEPROCESSINGPOSTPROCESS: !1, EXPOSURE: !1 }, l ? (l.applyByPostProcess = !0, c._attachImageProcessingConfiguration(l, !0), c.fromLinearSpace = !1) : (c._attachImageProcessingConfiguration(null, !0), c.imageProcessingConfiguration.applyByPostProcess = !0), c.onApply = function (e) { c.imageProcessingConfiguration.bind(e, c.aspectRatio) }, c } return T(t, e), Object.defineProperty(t.prototype, "imageProcessingConfiguration", { get: function () { return this._imageProcessingConfiguration }, set: function (e) { this._attachImageProcessingConfiguration(e) }, enumerable: !0, configurable: !0 }), t.prototype._attachImageProcessingConfiguration = function (e, t) { var i = this; if (void 0 === t && (t = !1), e !== this._imageProcessingConfiguration) { if (this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), e) this._imageProcessingConfiguration = e; else { var r = null, n = this.getEngine(), o = this.getCamera(); if (o) r = o.getScene(); else if (n && n.scenes) { var s = n.scenes; r = s[s.length - 1] } else r = no.Engine.LastCreatedScene; this._imageProcessingConfiguration = r.imageProcessingConfiguration } this._imageProcessingConfiguration && (this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add(function (e) { i._updateParameters() })), t || this._updateParameters() } }, Object.defineProperty(t.prototype, "colorCurves", { get: function () { return this.imageProcessingConfiguration.colorCurves }, set: function (e) { this.imageProcessingConfiguration.colorCurves = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "colorCurvesEnabled", { get: function () { return this.imageProcessingConfiguration.colorCurvesEnabled }, set: function (e) { this.imageProcessingConfiguration.colorCurvesEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "colorGradingTexture", { get: function () { return this.imageProcessingConfiguration.colorGradingTexture }, set: function (e) { this.imageProcessingConfiguration.colorGradingTexture = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "colorGradingEnabled", { get: function () { return this.imageProcessingConfiguration.colorGradingEnabled }, set: function (e) { this.imageProcessingConfiguration.colorGradingEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "exposure", { get: function () { return this.imageProcessingConfiguration.exposure }, set: function (e) { this.imageProcessingConfiguration.exposure = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "toneMappingEnabled", { get: function () { return this._imageProcessingConfiguration.toneMappingEnabled }, set: function (e) { this._imageProcessingConfiguration.toneMappingEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "contrast", { get: function () { return this.imageProcessingConfiguration.contrast }, set: function (e) { this.imageProcessingConfiguration.contrast = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteStretch", { get: function () { return this.imageProcessingConfiguration.vignetteStretch }, set: function (e) { this.imageProcessingConfiguration.vignetteStretch = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteCentreX", { get: function () { return this.imageProcessingConfiguration.vignetteCentreX }, set: function (e) { this.imageProcessingConfiguration.vignetteCentreX = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteCentreY", { get: function () { return this.imageProcessingConfiguration.vignetteCentreY }, set: function (e) { this.imageProcessingConfiguration.vignetteCentreY = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteWeight", { get: function () { return this.imageProcessingConfiguration.vignetteWeight }, set: function (e) { this.imageProcessingConfiguration.vignetteWeight = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteColor", { get: function () { return this.imageProcessingConfiguration.vignetteColor }, set: function (e) { this.imageProcessingConfiguration.vignetteColor = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteCameraFov", { get: function () { return this.imageProcessingConfiguration.vignetteCameraFov }, set: function (e) { this.imageProcessingConfiguration.vignetteCameraFov = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteBlendMode", { get: function () { return this.imageProcessingConfiguration.vignetteBlendMode }, set: function (e) { this.imageProcessingConfiguration.vignetteBlendMode = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "vignetteEnabled", { get: function () { return this.imageProcessingConfiguration.vignetteEnabled }, set: function (e) { this.imageProcessingConfiguration.vignetteEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "fromLinearSpace", { get: function () { return this._fromLinearSpace }, set: function (e) { this._fromLinearSpace !== e && (this._fromLinearSpace = e, this._updateParameters()) }, enumerable: !0, configurable: !0 }), t.prototype.getClassName = function () { return "ImageProcessingPostProcess" }, t.prototype._updateParameters = function () { this._defines.FROMLINEARSPACE = this._fromLinearSpace, this.imageProcessingConfiguration.prepareDefines(this._defines, !0); var e = ""; for (var t in this._defines) this._defines[t] && (e += "#define " + t + ";\r\n"); var i = ["textureSampler"], r = ["scale"]; no.ImageProcessingConfiguration && (no.ImageProcessingConfiguration.PrepareSamplers(i, this._defines), no.ImageProcessingConfiguration.PrepareUniforms(r, this._defines)), this.updateEffect(e, r, i) }, t.prototype.dispose = function (t) { e.prototype.dispose.call(this, t), this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), this._imageProcessingConfiguration && (this.imageProcessingConfiguration.applyByPostProcess = !1) }, b([no.serialize()], t.prototype, "_fromLinearSpace", void 0), t }((no = $a || ($a = {})).PostProcess), no.ImageProcessingPostProcess = oo, ao = function (e) { function t(t, i, r, n, o, s, a) { void 0 === r && (r = null), void 0 === n && (n = null), void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null); var l = e.call(this, t, i.getScene()) || this; return l.name = t, l.children = new Array, l.animations = new Array, l._index = null, l._absoluteTransform = new so.Matrix, l._invertedAbsoluteTransform = new so.Matrix, l._scalingDeterminant = 1, l._worldTransform = new so.Matrix, l._needToDecompose = !0, l._needToCompose = !1, l._skeleton = i, l._localMatrix = n ? n.clone() : so.Matrix.Identity(), l._restPose = o || l._localMatrix.clone(), l._baseMatrix = s || l._localMatrix.clone(), l._index = a, i.bones.push(l), l.setParent(r, !1), (s || n) && l._updateDifferenceMatrix(), l } return T(t, e), Object.defineProperty(t.prototype, "_matrix", { get: function () { return this._compose(), this._localMatrix }, set: function (e) { this._localMatrix.copyFrom(e), this._needToDecompose = !0 }, enumerable: !0, configurable: !0 }), t.prototype.getSkeleton = function () { return this._skeleton }, t.prototype.getParent = function () { return this._parent }, t.prototype.setParent = function (e, t) { if (void 0 === t && (t = !0), this._parent !== e) { if (this._parent) { var i = this._parent.children.indexOf(this); -1 !== i && this._parent.children.splice(i, 1) } this._parent = e, this._parent && this._parent.children.push(this), t && this._updateDifferenceMatrix(), this.markAsDirty() } }, t.prototype.getLocalMatrix = function () { return this._compose(), this._localMatrix }, t.prototype.getBaseMatrix = function () { return this._baseMatrix }, t.prototype.getRestPose = function () { return this._restPose }, t.prototype.getWorldMatrix = function () { return this._worldTransform }, t.prototype.returnToRest = function () { this.updateMatrix(this._restPose.clone()) }, t.prototype.getInvertedAbsoluteTransform = function () { return this._invertedAbsoluteTransform }, t.prototype.getAbsoluteTransform = function () { return this._absoluteTransform }, Object.defineProperty(t.prototype, "position", { get: function () { return this._decompose(), this._localPosition }, set: function (e) { this._decompose(), this._localPosition.copyFrom(e), this._markAsDirtyAndCompose() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "rotation", { get: function () { return this.getRotation() }, set: function (e) { this.setRotation(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "rotationQuaternion", { get: function () { return this._decompose(), this._localRotation }, set: function (e) { this.setRotationQuaternion(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "scaling", { get: function () { return this.getScale() }, set: function (e) { this.setScale(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "animationPropertiesOverride", { get: function () { return this._skeleton.animationPropertiesOverride }, enumerable: !0, configurable: !0 }), t.prototype._decompose = function () { this._needToDecompose && (this._needToDecompose = !1, this._localScaling || (this._localScaling = so.Vector3.Zero(), this._localRotation = so.Quaternion.Zero(), this._localPosition = so.Vector3.Zero()), this._localMatrix.decompose(this._localScaling, this._localRotation, this._localPosition)) }, t.prototype._compose = function () { this._needToCompose && (this._needToCompose = !1, so.Matrix.ComposeToRef(this._localScaling, this._localRotation, this._localPosition, this._localMatrix)) }, t.prototype.updateMatrix = function (e, t, i) { void 0 === t && (t = !0), void 0 === i && (i = !0), this._baseMatrix.copyFrom(e), t && this._updateDifferenceMatrix(), i ? (this._localMatrix.copyFrom(e), this._markAsDirtyAndDecompose()) : this.markAsDirty() }, t.prototype._updateDifferenceMatrix = function (e, t) { if (void 0 === t && (t = !0), e || (e = this._baseMatrix), this._parent ? e.multiplyToRef(this._parent._absoluteTransform, this._absoluteTransform) : this._absoluteTransform.copyFrom(e), this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform), t) for (var i = 0; i < this.children.length; i++)this.children[i]._updateDifferenceMatrix(); this._scalingDeterminant = this._absoluteTransform.determinant() < 0 ? -1 : 1 }, t.prototype.markAsDirty = function () { this._currentRenderId++ , this._childRenderId++ , this._skeleton._markAsDirty() }, t.prototype._markAsDirtyAndCompose = function () { this.markAsDirty(), this._needToCompose = !0 }, t.prototype._markAsDirtyAndDecompose = function () { this.markAsDirty(), this._needToDecompose = !0 }, t.prototype.copyAnimationRange = function (e, t, i, r, n) { void 0 === r && (r = !1), void 0 === n && (n = null), 0 === this.animations.length && (this.animations.push(new so.Animation(this.name, "_matrix", e.animations[0].framePerSecond, so.Animation.ANIMATIONTYPE_MATRIX, 0)), this.animations[0].setKeys([])); var o = e.animations[0].getRange(t); if (!o) return !1; for (var s, a, l, c = o.from, h = o.to, u = e.animations[0].getKeys(), d = e.length, f = e.getParent(), p = this.getParent(), _ = r && f && d && this.length && d !== this.length, m = _ && p && f ? p.length / f.length : 1, g = r && !p && n && (1 !== n.x || 1 !== n.y || 1 !== n.z), v = this.animations[0].getKeys(), y = 0, b = u.length; y < b; y++)(s = u[y]).frame >= c && s.frame <= h && (r ? (l = s.value.clone(), _ ? (a = l.getTranslation(), l.setTranslation(a.scaleInPlace(m))) : g && n ? (a = l.getTranslation(), l.setTranslation(a.multiplyInPlace(n))) : l = s.value) : l = s.value, v.push({ frame: s.frame + i, value: l })); return this.animations[0].createRange(t, c + i, h + i), !0 }, t.prototype.translate = function (e, i, r) { void 0 === i && (i = so.Space.LOCAL); var n = this.getLocalMatrix(); if (i == so.Space.LOCAL) n.m[12] += e.x, n.m[13] += e.y, n.m[14] += e.z; else { var o = null; r && (o = r.getWorldMatrix()), this._skeleton.computeAbsoluteTransforms(); var s = t._tmpMats[0], a = t._tmpVecs[0]; this._parent && (r && o ? (s.copyFrom(this._parent.getAbsoluteTransform()), s.multiplyToRef(o, s)) : s.copyFrom(this._parent.getAbsoluteTransform())), s.m[12] = 0, s.m[13] = 0, s.m[14] = 0, s.invert(), so.Vector3.TransformCoordinatesToRef(e, s, a), n.m[12] += a.x, n.m[13] += a.y, n.m[14] += a.z } this._markAsDirtyAndDecompose() }, t.prototype.setPosition = function (e, i, r) { void 0 === i && (i = so.Space.LOCAL); var n = this.getLocalMatrix(); if (i == so.Space.LOCAL) n.m[12] = e.x, n.m[13] = e.y, n.m[14] = e.z; else { var o = null; r && (o = r.getWorldMatrix()), this._skeleton.computeAbsoluteTransforms(); var s = t._tmpMats[0], a = t._tmpVecs[0]; this._parent && (r && o ? (s.copyFrom(this._parent.getAbsoluteTransform()), s.multiplyToRef(o, s)) : s.copyFrom(this._parent.getAbsoluteTransform())), s.invert(), so.Vector3.TransformCoordinatesToRef(e, s, a), n.m[12] = a.x, n.m[13] = a.y, n.m[14] = a.z } this._markAsDirtyAndDecompose() }, t.prototype.setAbsolutePosition = function (e, t) { this.setPosition(e, so.Space.WORLD, t) }, t.prototype.scale = function (e, i, r, n) { void 0 === n && (n = !1); var o = this.getLocalMatrix(), s = t._tmpMats[0]; so.Matrix.ScalingToRef(e, i, r, s), s.multiplyToRef(o, o), s.invert(); for (var a = 0, l = this.children; a < l.length; a++) { var c = (d = l[a]).getLocalMatrix(); c.multiplyToRef(s, c), c.m[12] *= e, c.m[13] *= i, c.m[14] *= r, d._markAsDirtyAndDecompose() } if (this._markAsDirtyAndDecompose(), n) for (var h = 0, u = this.children; h < u.length; h++) { var d; (d = u[h]).scale(e, i, r, n) } }, t.prototype.setScale = function (e) { this._decompose(), this._localScaling.copyFrom(e), this._markAsDirtyAndCompose() }, t.prototype.getScale = function () { return this._decompose(), this._localScaling }, t.prototype.getScaleToRef = function (e) { this._decompose(), e.copyFrom(this._localScaling) }, t.prototype.setYawPitchRoll = function (e, i, r, n, o) { if (void 0 === n && (n = so.Space.LOCAL), n === so.Space.LOCAL) { var s = t._tmpQuat; return so.Quaternion.RotationYawPitchRollToRef(e, i, r, s), void this.setRotationQuaternion(s, n, o) } var a = t._tmpMats[0]; if (this._getNegativeRotationToRef(a, o)) { var l = t._tmpMats[1]; so.Matrix.RotationYawPitchRollToRef(e, i, r, l), a.multiplyToRef(l, l), this._rotateWithMatrix(l, n, o) } }, t.prototype.rotate = function (e, i, r, n) { void 0 === r && (r = so.Space.LOCAL); var o = t._tmpMats[0]; o.m[12] = 0, o.m[13] = 0, o.m[14] = 0, so.Matrix.RotationAxisToRef(e, i, o), this._rotateWithMatrix(o, r, n) }, t.prototype.setAxisAngle = function (e, i, r, n) { if (void 0 === r && (r = so.Space.LOCAL), r === so.Space.LOCAL) { var o = t._tmpQuat; return so.Quaternion.RotationAxisToRef(e, i, o), void this.setRotationQuaternion(o, r, n) } var s = t._tmpMats[0]; if (this._getNegativeRotationToRef(s, n)) { var a = t._tmpMats[1]; so.Matrix.RotationAxisToRef(e, i, a), s.multiplyToRef(a, a), this._rotateWithMatrix(a, r, n) } }, t.prototype.setRotation = function (e, t, i) { void 0 === t && (t = so.Space.LOCAL), this.setYawPitchRoll(e.y, e.x, e.z, t, i) }, t.prototype.setRotationQuaternion = function (e, i, r) { if (void 0 === i && (i = so.Space.LOCAL), i === so.Space.LOCAL) return this._decompose(), this._localRotation.copyFrom(e), void this._markAsDirtyAndCompose(); var n = t._tmpMats[0]; if (this._getNegativeRotationToRef(n, r)) { var o = t._tmpMats[1]; so.Matrix.FromQuaternionToRef(e, o), n.multiplyToRef(o, o), this._rotateWithMatrix(o, i, r) } }, t.prototype.setRotationMatrix = function (e, i, r) { if (void 0 === i && (i = so.Space.LOCAL), i === so.Space.LOCAL) { var n = t._tmpQuat; return so.Quaternion.FromRotationMatrixToRef(e, n), void this.setRotationQuaternion(n, i, r) } var o = t._tmpMats[0]; if (this._getNegativeRotationToRef(o, r)) { var s = t._tmpMats[1]; s.copyFrom(e), o.multiplyToRef(e, s), this._rotateWithMatrix(s, i, r) } }, t.prototype._rotateWithMatrix = function (e, i, r) { void 0 === i && (i = so.Space.LOCAL); var n = this.getLocalMatrix(), o = n.m[12], s = n.m[13], a = n.m[14], l = this.getParent(), c = t._tmpMats[3], h = t._tmpMats[4]; l && i == so.Space.WORLD ? (r ? (c.copyFrom(r.getWorldMatrix()), l.getAbsoluteTransform().multiplyToRef(c, c)) : c.copyFrom(l.getAbsoluteTransform()), h.copyFrom(c), h.invert(), n.multiplyToRef(c, n), n.multiplyToRef(e, n), n.multiplyToRef(h, n)) : i == so.Space.WORLD && r ? (c.copyFrom(r.getWorldMatrix()), h.copyFrom(c), h.invert(), n.multiplyToRef(c, n), n.multiplyToRef(e, n), n.multiplyToRef(h, n)) : n.multiplyToRef(e, n), n.m[12] = o, n.m[13] = s, n.m[14] = a, this.computeAbsoluteTransforms(), this._markAsDirtyAndDecompose() }, t.prototype._getNegativeRotationToRef = function (e, i) { var r = t._tmpMats[2]; return e.copyFrom(this.getAbsoluteTransform()), i && (e.multiplyToRef(i.getWorldMatrix(), e), so.Matrix.ScalingToRef(i.scaling.x, i.scaling.y, i.scaling.z, r)), e.invert(), !isNaN(e.m[0]) && (r.m[0] *= this._scalingDeterminant, e.multiplyToRef(r, e), !0) }, t.prototype.getPosition = function (e, t) { void 0 === e && (e = so.Space.LOCAL), void 0 === t && (t = null); var i = so.Vector3.Zero(); return this.getPositionToRef(e, t, i), i }, t.prototype.getPositionToRef = function (e, i, r) { if (void 0 === e && (e = so.Space.LOCAL), e == so.Space.LOCAL) { var n = this.getLocalMatrix(); r.x = n.m[12], r.y = n.m[13], r.z = n.m[14] } else { var o = null; i && (o = i.getWorldMatrix()), this._skeleton.computeAbsoluteTransforms(); var s = t._tmpMats[0]; i && o ? (s.copyFrom(this.getAbsoluteTransform()), s.multiplyToRef(o, s)) : s = this.getAbsoluteTransform(), r.x = s.m[12], r.y = s.m[13], r.z = s.m[14] } }, t.prototype.getAbsolutePosition = function (e) { void 0 === e && (e = null); var t = so.Vector3.Zero(); return this.getPositionToRef(so.Space.WORLD, e, t), t }, t.prototype.getAbsolutePositionToRef = function (e, t) { this.getPositionToRef(so.Space.WORLD, e, t) }, t.prototype.computeAbsoluteTransforms = function () { if (this._compose(), this._parent) this._localMatrix.multiplyToRef(this._parent._absoluteTransform, this._absoluteTransform); else { this._absoluteTransform.copyFrom(this._localMatrix); var e = this._skeleton.getPoseMatrix(); e && this._absoluteTransform.multiplyToRef(e, this._absoluteTransform) } for (var t = this.children, i = t.length, r = 0; r < i; r++)t[r].computeAbsoluteTransforms() }, t.prototype.getDirection = function (e, t) { void 0 === t && (t = null); var i = so.Vector3.Zero(); return this.getDirectionToRef(e, t, i), i }, t.prototype.getDirectionToRef = function (e, i, r) { void 0 === i && (i = null); var n = null; i && (n = i.getWorldMatrix()), this._skeleton.computeAbsoluteTransforms(); var o = t._tmpMats[0]; o.copyFrom(this.getAbsoluteTransform()), i && n && o.multiplyToRef(n, o), so.Vector3.TransformNormalToRef(e, o, r), r.normalize() }, t.prototype.getRotation = function (e, t) { void 0 === e && (e = so.Space.LOCAL), void 0 === t && (t = null); var i = so.Vector3.Zero(); return this.getRotationToRef(e, t, i), i }, t.prototype.getRotationToRef = function (e, i, r) { void 0 === e && (e = so.Space.LOCAL), void 0 === i && (i = null); var n = t._tmpQuat; this.getRotationQuaternionToRef(e, i, n), n.toEulerAnglesToRef(r) }, t.prototype.getRotationQuaternion = function (e, t) { void 0 === e && (e = so.Space.LOCAL), void 0 === t && (t = null); var i = so.Quaternion.Identity(); return this.getRotationQuaternionToRef(e, t, i), i }, t.prototype.getRotationQuaternionToRef = function (e, i, r) { if (void 0 === e && (e = so.Space.LOCAL), void 0 === i && (i = null), e == so.Space.LOCAL) this._decompose(), r.copyFrom(this._localRotation); else { var n = t._tmpMats[0], o = this.getAbsoluteTransform(); i ? o.multiplyToRef(i.getWorldMatrix(), n) : n.copyFrom(o), n.m[0] *= this._scalingDeterminant, n.m[1] *= this._scalingDeterminant, n.m[2] *= this._scalingDeterminant, n.decompose(void 0, r, void 0) } }, t.prototype.getRotationMatrix = function (e, t) { void 0 === e && (e = so.Space.LOCAL); var i = so.Matrix.Identity(); return this.getRotationMatrixToRef(e, t, i), i }, t.prototype.getRotationMatrixToRef = function (e, i, r) { if (void 0 === e && (e = so.Space.LOCAL), e == so.Space.LOCAL) this.getLocalMatrix().getRotationMatrixToRef(r); else { var n = t._tmpMats[0], o = this.getAbsoluteTransform(); i ? o.multiplyToRef(i.getWorldMatrix(), n) : n.copyFrom(o), n.m[0] *= this._scalingDeterminant, n.m[1] *= this._scalingDeterminant, n.m[2] *= this._scalingDeterminant, n.getRotationMatrixToRef(r) } }, t.prototype.getAbsolutePositionFromLocal = function (e, t) { void 0 === t && (t = null); var i = so.Vector3.Zero(); return this.getAbsolutePositionFromLocalToRef(e, t, i), i }, t.prototype.getAbsolutePositionFromLocalToRef = function (e, i, r) { void 0 === i && (i = null); var n = null; i && (n = i.getWorldMatrix()), this._skeleton.computeAbsoluteTransforms(); var o = t._tmpMats[0]; i && n ? (o.copyFrom(this.getAbsoluteTransform()), o.multiplyToRef(n, o)) : o = this.getAbsoluteTransform(), so.Vector3.TransformCoordinatesToRef(e, o, r) }, t.prototype.getLocalPositionFromAbsolute = function (e, t) { void 0 === t && (t = null); var i = so.Vector3.Zero(); return this.getLocalPositionFromAbsoluteToRef(e, t, i), i }, t.prototype.getLocalPositionFromAbsoluteToRef = function (e, i, r) { void 0 === i && (i = null); var n = null; i && (n = i.getWorldMatrix()), this._skeleton.computeAbsoluteTransforms(); var o = t._tmpMats[0]; o.copyFrom(this.getAbsoluteTransform()), i && n && o.multiplyToRef(n, o), o.invert(), so.Vector3.TransformCoordinatesToRef(e, o, r) }, t._tmpVecs = [so.Vector3.Zero(), so.Vector3.Zero()], t._tmpQuat = so.Quaternion.Identity(), t._tmpMats = [so.Matrix.Identity(), so.Matrix.Identity(), so.Matrix.Identity(), so.Matrix.Identity(), so.Matrix.Identity()], t }((so = $a || ($a = {})).Node), so.Bone = ao, lo = $a || ($a = {}), co = function () { function e(e, t, i) { if (this.targetPosition = lo.Vector3.Zero(), this.poleTargetPosition = lo.Vector3.Zero(), this.poleTargetLocalOffset = lo.Vector3.Zero(), this.poleAngle = 0, this.slerpAmount = 1, this._bone1Quat = lo.Quaternion.Identity(), this._bone1Mat = lo.Matrix.Identity(), this._bone2Ang = Math.PI, this._maxAngle = Math.PI, this._rightHandedSystem = !1, this._bendAxis = lo.Vector3.Right(), this._slerping = !1, this._adjustRoll = 0, this._bone2 = t, this._bone1 = t.getParent(), this._bone1) { this.mesh = e; var r = t.getPosition(); if (0 < t.getAbsoluteTransform().determinant() && (this._rightHandedSystem = !0, this._bendAxis.x = 0, this._bendAxis.y = 0, this._bendAxis.z = -1, r.x > r.y && r.x > r.z && (this._adjustRoll = .5 * Math.PI, this._bendAxis.z = 1)), this._bone1.length) { var n = this._bone1.getScale(), o = this._bone2.getScale(); this._bone1Length = this._bone1.length * n.y * this.mesh.scaling.y, this._bone2Length = this._bone2.length * o.y * this.mesh.scaling.y } else if (this._bone1.children[0]) { e.computeWorldMatrix(!0); var s = this._bone2.children[0].getAbsolutePosition(e), a = this._bone2.getAbsolutePosition(e), l = this._bone1.getAbsolutePosition(e); this._bone1Length = lo.Vector3.Distance(s, a), this._bone2Length = lo.Vector3.Distance(a, l) } this._bone1.getRotationMatrixToRef(lo.Space.WORLD, e, this._bone1Mat), this.maxAngle = Math.PI, i && (i.targetMesh && (this.targetMesh = i.targetMesh, this.targetMesh.computeWorldMatrix(!0)), i.poleTargetMesh ? (this.poleTargetMesh = i.poleTargetMesh, this.poleTargetMesh.computeWorldMatrix(!0)) : i.poleTargetBone ? this.poleTargetBone = i.poleTargetBone : this._bone1.getParent() && (this.poleTargetBone = this._bone1.getParent()), i.poleTargetLocalOffset && this.poleTargetLocalOffset.copyFrom(i.poleTargetLocalOffset), i.poleAngle && (this.poleAngle = i.poleAngle), i.bendAxis && this._bendAxis.copyFrom(i.bendAxis), i.maxAngle && (this.maxAngle = i.maxAngle), i.slerpAmount && (this.slerpAmount = i.slerpAmount)) } } return Object.defineProperty(e.prototype, "maxAngle", { get: function () { return this._maxAngle }, set: function (e) { this._setMaxAngle(e) }, enumerable: !0, configurable: !0 }), e.prototype._setMaxAngle = function (e) { e < 0 && (e = 0), (e > Math.PI || null == e) && (e = Math.PI), this._maxAngle = e; var t = this._bone1Length, i = this._bone2Length; this._maxReach = Math.sqrt(t * t + i * i - 2 * t * i * Math.cos(e)) }, e.prototype.update = function () { var t = this._bone1; if (t) { var i = this.targetPosition, r = this.poleTargetPosition, n = e._tmpMats[0], o = e._tmpMats[1]; this.targetMesh && i.copyFrom(this.targetMesh.getAbsolutePosition()), this.poleTargetBone ? this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset, this.mesh, r) : this.poleTargetMesh && lo.Vector3.TransformCoordinatesToRef(this.poleTargetLocalOffset, this.poleTargetMesh.getWorldMatrix(), r); var s = e._tmpVecs[0], a = e._tmpVecs[1], l = e._tmpVecs[2], c = e._tmpVecs[3], h = e._tmpVecs[4], u = e._tmpQuat; t.getAbsolutePositionToRef(this.mesh, s), r.subtractToRef(s, h), 0 == h.x && 0 == h.y && 0 == h.z ? h.y = 1 : h.normalize(), i.subtractToRef(s, c), c.normalize(), lo.Vector3.CrossToRef(c, h, a), a.normalize(), lo.Vector3.CrossToRef(c, a, l), l.normalize(), lo.Matrix.FromXYZAxesToRef(l, c, a, n); var d = this._bone1Length, f = this._bone2Length, p = lo.Vector3.Distance(s, i); 0 < this._maxReach && (p = Math.min(this._maxReach, p)); var _ = (f * f + p * p - d * d) / (2 * f * p), m = (p * p + d * d - f * f) / (2 * p * d); 1 < _ && (_ = 1), 1 < m && (m = 1), _ < -1 && (_ = -1), m < -1 && (m = -1); var g = Math.acos(_), v = Math.acos(m), y = -g - v; if (this._rightHandedSystem) lo.Matrix.RotationYawPitchRollToRef(0, 0, this._adjustRoll, o), o.multiplyToRef(n, n), lo.Matrix.RotationAxisToRef(this._bendAxis, v, o), o.multiplyToRef(n, n); else { var b = e._tmpVecs[5]; b.copyFrom(this._bendAxis), b.x *= -1, lo.Matrix.RotationAxisToRef(b, -v, o), o.multiplyToRef(n, n) } this.poleAngle && (lo.Matrix.RotationAxisToRef(c, this.poleAngle, o), n.multiplyToRef(o, n)), this._bone1 && (this.slerpAmount < 1 ? (this._slerping || lo.Quaternion.FromRotationMatrixToRef(this._bone1Mat, this._bone1Quat), lo.Quaternion.FromRotationMatrixToRef(n, u), lo.Quaternion.SlerpToRef(this._bone1Quat, u, this.slerpAmount, this._bone1Quat), y = this._bone2Ang * (1 - this.slerpAmount) + y * this.slerpAmount, this._bone1.setRotationQuaternion(this._bone1Quat, lo.Space.WORLD, this.mesh), this._slerping = !0) : (this._bone1.setRotationMatrix(n, lo.Space.WORLD, this.mesh), this._bone1Mat.copyFrom(n), this._slerping = !1)), this._bone2.setAxisAngle(this._bendAxis, y, lo.Space.LOCAL), this._bone2Ang = y } }, e._tmpVecs = [lo.Vector3.Zero(), lo.Vector3.Zero(), lo.Vector3.Zero(), lo.Vector3.Zero(), lo.Vector3.Zero(), lo.Vector3.Zero()], e._tmpQuat = lo.Quaternion.Identity(), e._tmpMats = [lo.Matrix.Identity(), lo.Matrix.Identity()], e }(), lo.BoneIKController = co, ho = $a || ($a = {}), uo = function () { function e(e, t, i, r) { if (this.upAxis = ho.Vector3.Up(), this.upAxisSpace = ho.Space.LOCAL, this.adjustYaw = 0, this.adjustPitch = 0, this.adjustRoll = 0, this.slerpAmount = 1, this._boneQuat = ho.Quaternion.Identity(), this._slerping = !1, this._firstFrameSkipped = !1, this._fowardAxis = ho.Vector3.Forward(), this.mesh = e, this.bone = t, this.target = i, r && (r.adjustYaw && (this.adjustYaw = r.adjustYaw), r.adjustPitch && (this.adjustPitch = r.adjustPitch), r.adjustRoll && (this.adjustRoll = r.adjustRoll), null != r.maxYaw ? this.maxYaw = r.maxYaw : this.maxYaw = Math.PI, null != r.minYaw ? this.minYaw = r.minYaw : this.minYaw = -Math.PI, null != r.maxPitch ? this.maxPitch = r.maxPitch : this.maxPitch = Math.PI, null != r.minPitch ? this.minPitch = r.minPitch : this.minPitch = -Math.PI, null != r.slerpAmount && (this.slerpAmount = r.slerpAmount), null != r.upAxis && (this.upAxis = r.upAxis), null != r.upAxisSpace && (this.upAxisSpace = r.upAxisSpace), null != r.yawAxis || null != r.pitchAxis)) { var n = ho.Axis.Y, o = ho.Axis.X; null != r.yawAxis && (n = r.yawAxis.clone()).normalize(), null != r.pitchAxis && (o = r.pitchAxis.clone()).normalize(); var s = ho.Vector3.Cross(o, n); this._transformYawPitch = ho.Matrix.Identity(), ho.Matrix.FromXYZAxesToRef(o, n, s, this._transformYawPitch), this._transformYawPitchInv = this._transformYawPitch.clone(), this._transformYawPitch.invert() } t.getParent() || this.upAxisSpace != ho.Space.BONE || (this.upAxisSpace = ho.Space.LOCAL) } return Object.defineProperty(e.prototype, "minYaw", { get: function () { return this._minYaw }, set: function (e) { this._minYaw = e, this._minYawSin = Math.sin(e), this._minYawCos = Math.cos(e), null != this._maxYaw && (this._midYawConstraint = .5 * this._getAngleDiff(this._minYaw, this._maxYaw) + this._minYaw, this._yawRange = this._maxYaw - this._minYaw) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "maxYaw", { get: function () { return this._maxYaw }, set: function (e) { this._maxYaw = e, this._maxYawSin = Math.sin(e), this._maxYawCos = Math.cos(e), null != this._minYaw && (this._midYawConstraint = .5 * this._getAngleDiff(this._minYaw, this._maxYaw) + this._minYaw, this._yawRange = this._maxYaw - this._minYaw) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "minPitch", { get: function () { return this._minPitch }, set: function (e) { this._minPitch = e, this._minPitchTan = Math.tan(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "maxPitch", { get: function () { return this._maxPitch }, set: function (e) { this._maxPitch = e, this._maxPitchTan = Math.tan(e) }, enumerable: !0, configurable: !0 }), e.prototype.update = function () { if (this.slerpAmount < 1 && !this._firstFrameSkipped) this._firstFrameSkipped = !0; else { var t = this.bone, i = e._tmpVecs[0]; t.getAbsolutePositionToRef(this.mesh, i); var r = this.target, n = e._tmpMats[0], o = e._tmpMats[1], s = this.mesh, a = t.getParent(), l = e._tmpVecs[1]; l.copyFrom(this.upAxis), this.upAxisSpace == ho.Space.BONE && a ? (this._transformYawPitch && ho.Vector3.TransformCoordinatesToRef(l, this._transformYawPitchInv, l), a.getDirectionToRef(l, this.mesh, l)) : this.upAxisSpace == ho.Space.LOCAL && (s.getDirectionToRef(l, l), 1 == s.scaling.x && 1 == s.scaling.y && 1 == s.scaling.z || l.normalize()); var c = !1, h = !1; if (this._maxYaw == Math.PI && this._minYaw == -Math.PI || (c = !0), this._maxPitch == Math.PI && this._minPitch == -Math.PI || (h = !0), c || h) { var u = e._tmpMats[2], d = e._tmpMats[3]; if (this.upAxisSpace == ho.Space.BONE && 1 == l.y && a) a.getRotationMatrixToRef(ho.Space.WORLD, this.mesh, u); else if (this.upAxisSpace != ho.Space.LOCAL || 1 != l.y || a) { (p = e._tmpVecs[2]).copyFrom(this._fowardAxis), this._transformYawPitch && ho.Vector3.TransformCoordinatesToRef(p, this._transformYawPitchInv, p), a ? a.getDirectionToRef(p, this.mesh, p) : s.getDirectionToRef(p, p); var f = ho.Vector3.Cross(l, p); f.normalize(); var p = ho.Vector3.Cross(f, l); ho.Matrix.FromXYZAxesToRef(f, l, p, u) } else u.copyFrom(s.getWorldMatrix()); u.invertToRef(d); var _ = null; if (h) { var m = e._tmpVecs[3]; r.subtractToRef(i, m), ho.Vector3.TransformCoordinatesToRef(m, d, m), _ = Math.sqrt(m.x * m.x + m.z * m.z); var g = Math.atan2(m.y, _), v = g; g > this._maxPitch ? (m.y = this._maxPitchTan * _, v = this._maxPitch) : g < this._minPitch && (m.y = this._minPitchTan * _, v = this._minPitch), g != v && (ho.Vector3.TransformCoordinatesToRef(m, u, m), m.addInPlace(i), r = m) } if (c) { m = e._tmpVecs[4], r.subtractToRef(i, m), ho.Vector3.TransformCoordinatesToRef(m, d, m); var y = Math.atan2(m.x, m.z), b = y; if ((y > this._maxYaw || y < this._minYaw) && (null == _ && (_ = Math.sqrt(m.x * m.x + m.z * m.z)), this._yawRange > Math.PI ? this._isAngleBetween(y, this._maxYaw, this._midYawConstraint) ? (m.z = this._maxYawCos * _, m.x = this._maxYawSin * _, b = this._maxYaw) : this._isAngleBetween(y, this._midYawConstraint, this._minYaw) && (m.z = this._minYawCos * _, m.x = this._minYawSin * _, b = this._minYaw) : y > this._maxYaw ? (m.z = this._maxYawCos * _, m.x = this._maxYawSin * _, b = this._maxYaw) : y < this._minYaw && (m.z = this._minYawCos * _, m.x = this._minYawSin * _, b = this._minYaw)), this._slerping && this._yawRange > Math.PI) { var T = e._tmpVecs[8]; T.copyFrom(ho.Axis.Z), this._transformYawPitch && ho.Vector3.TransformCoordinatesToRef(T, this._transformYawPitchInv, T); var E = e._tmpMats[4]; this._boneQuat.toRotationMatrix(E), this.mesh.getWorldMatrix().multiplyToRef(E, E), ho.Vector3.TransformCoordinatesToRef(T, E, T), ho.Vector3.TransformCoordinatesToRef(T, d, T); var x = Math.atan2(T.x, T.z), P = this._getAngleBetween(x, y); if (this._getAngleBetween(x, this._midYawConstraint) < P) { null == _ && (_ = Math.sqrt(m.x * m.x + m.z * m.z)); var A = this._getAngleBetween(x, this._maxYaw); b = this._getAngleBetween(x, this._minYaw) < A ? x + .75 * Math.PI : x - .75 * Math.PI, m.z = Math.cos(b) * _, m.x = Math.sin(b) * _ } } y != b && (ho.Vector3.TransformCoordinatesToRef(m, u, m), m.addInPlace(i), r = m) } } var S = e._tmpVecs[5], M = e._tmpVecs[6], R = e._tmpVecs[7], C = e._tmpQuat; r.subtractToRef(i, S), S.normalize(), ho.Vector3.CrossToRef(l, S, M), M.normalize(), ho.Vector3.CrossToRef(S, M, R), R.normalize(), ho.Matrix.FromXYZAxesToRef(M, R, S, n), 0 === M.x && 0 === M.y && 0 === M.z || 0 === R.x && 0 === R.y && 0 === R.z || 0 === S.x && 0 === S.y && 0 === S.z || ((this.adjustYaw || this.adjustPitch || this.adjustRoll) && (ho.Matrix.RotationYawPitchRollToRef(this.adjustYaw, this.adjustPitch, this.adjustRoll, o), o.multiplyToRef(n, n)), this.slerpAmount < 1 ? (this._slerping || this.bone.getRotationQuaternionToRef(ho.Space.WORLD, this.mesh, this._boneQuat), this._transformYawPitch && this._transformYawPitch.multiplyToRef(n, n), ho.Quaternion.FromRotationMatrixToRef(n, C), ho.Quaternion.SlerpToRef(this._boneQuat, C, this.slerpAmount, this._boneQuat), this.bone.setRotationQuaternion(this._boneQuat, ho.Space.WORLD, this.mesh), this._slerping = !0) : (this._transformYawPitch && this._transformYawPitch.multiplyToRef(n, n), this.bone.setRotationMatrix(n, ho.Space.WORLD, this.mesh), this._slerping = !1)) } }, e.prototype._getAngleDiff = function (e, t) { var i = t - e; return (i %= 2 * Math.PI) > Math.PI ? i -= 2 * Math.PI : i < -Math.PI && (i += 2 * Math.PI), i }, e.prototype._getAngleBetween = function (e, t) { var i = 0; return (i = (e = (e %= 2 * Math.PI) < 0 ? e + 2 * Math.PI : e) < (t = (t %= 2 * Math.PI) < 0 ? t + 2 * Math.PI : t) ? t - e : e - t) > Math.PI && (i = 2 * Math.PI - i), i }, e.prototype._isAngleBetween = function (e, t, i) { if (e = (e %= 2 * Math.PI) < 0 ? e + 2 * Math.PI : e, (t = (t %= 2 * Math.PI) < 0 ? t + 2 * Math.PI : t) < (i = (i %= 2 * Math.PI) < 0 ? i + 2 * Math.PI : i)) { if (t < e && e < i) return !0 } else if (i < e && e < t) return !0; return !1 }, e._tmpVecs = [ho.Vector3.Zero(), ho.Vector3.Zero(), ho.Vector3.Zero(), ho.Vector3.Zero(), ho.Vector3.Zero(), ho.Vector3.Zero(), ho.Vector3.Zero(), ho.Vector3.Zero(), ho.Vector3.Zero(), ho.Vector3.Zero()], e._tmpQuat = ho.Quaternion.Identity(), e._tmpMats = [ho.Matrix.Identity(), ho.Matrix.Identity(), ho.Matrix.Identity(), ho.Matrix.Identity(), ho.Matrix.Identity()], e }(), ho.BoneLookController = uo, fo = $a || ($a = {}), po = function () { function e(e, t, i) { this.name = e, this.id = t, this.bones = new Array, this.needInitialSkinMatrix = !1, this._isDirty = !0, this._meshesWithPoseMatrix = new Array, this._identity = fo.Matrix.Identity(), this._ranges = {}, this._lastAbsoluteTransformsUpdateId = -1, this.doNotSerialize = !1, this._animationPropertiesOverride = null, this.onBeforeComputeObservable = new fo.Observable, this.bones = [], this._scene = i || fo.Engine.LastCreatedScene, i.skeletons.push(this), this._isDirty = !0 } return Object.defineProperty(e.prototype, "animationPropertiesOverride", { get: function () { return this._animationPropertiesOverride ? this._animationPropertiesOverride : this._scene.animationPropertiesOverride }, set: function (e) { this._animationPropertiesOverride = e }, enumerable: !0, configurable: !0 }), e.prototype.getTransformMatrices = function (e) { return this.needInitialSkinMatrix && e._bonesTransformMatrices ? e._bonesTransformMatrices : (this._transformMatrices || this.prepare(), this._transformMatrices) }, e.prototype.getScene = function () { return this._scene }, e.prototype.toString = function (e) { var t = "Name: " + this.name + ", nBones: " + this.bones.length; if (t += ", nAnimationRanges: " + (this._ranges ? Object.keys(this._ranges).length : "none"), e) { t += ", Ranges: {"; var i = !0; for (var r in this._ranges) i && (t += ", ", i = !1), t += r; t += "}" } return t }, e.prototype.getBoneIndexByName = function (e) { for (var t = 0, i = this.bones.length; t < i; t++)if (this.bones[t].name === e) return t; return -1 }, e.prototype.createAnimationRange = function (e, t, i) { if (!this._ranges[e]) { this._ranges[e] = new fo.AnimationRange(e, t, i); for (var r = 0, n = this.bones.length; r < n; r++)this.bones[r].animations[0] && this.bones[r].animations[0].createRange(e, t, i) } }, e.prototype.deleteAnimationRange = function (e, t) { void 0 === t && (t = !0); for (var i = 0, r = this.bones.length; i < r; i++)this.bones[i].animations[0] && this.bones[i].animations[0].deleteRange(e, t); this._ranges[e] = null }, e.prototype.getAnimationRange = function (e) { return this._ranges[e] }, e.prototype.getAnimationRanges = function () { var e, t = [], i = 0; for (e in this._ranges) t[i] = this._ranges[e], i++; return t }, e.prototype.copyAnimationRange = function (e, t, i) { if (void 0 === i && (i = !1), this._ranges[t] || !e.getAnimationRange(t)) return !1; var r, n, o = !0, s = this._getHighestAnimationFrame() + 1, a = {}, l = e.bones; for (n = 0, r = l.length; n < r; n++)a[l[n].name] = l[n]; this.bones.length !== l.length && (fo.Tools.Warn("copyAnimationRange: this rig has " + this.bones.length + " bones, while source as " + l.length), o = !1); var c = i && this.dimensionsAtRest && e.dimensionsAtRest ? this.dimensionsAtRest.divide(e.dimensionsAtRest) : null; for (n = 0, r = this.bones.length; n < r; n++) { var h = this.bones[n].name, u = a[h]; u ? o = o && this.bones[n].copyAnimationRange(u, t, s, i, c) : (fo.Tools.Warn("copyAnimationRange: not same rig, missing source bone " + h), o = !1) } var d = e.getAnimationRange(t); return d && (this._ranges[t] = new fo.AnimationRange(t, d.from + s, d.to + s)), o }, e.prototype.returnToRest = function () { for (var e = 0; e < this.bones.length; e++)this.bones[e].returnToRest() }, e.prototype._getHighestAnimationFrame = function () { for (var e = 0, t = 0, i = this.bones.length; t < i; t++)if (this.bones[t].animations[0]) { var r = this.bones[t].animations[0].getHighestFrame(); e < r && (e = r) } return e }, e.prototype.beginAnimation = function (e, t, i, r) { var n = this.getAnimationRange(e); return n ? this._scene.beginAnimation(this, n.from, n.to, t, i, r) : null }, e.prototype._markAsDirty = function () { this._isDirty = !0 }, e.prototype._registerMeshWithPoseMatrix = function (e) { this._meshesWithPoseMatrix.push(e) }, e.prototype._unregisterMeshWithPoseMatrix = function (e) { var t = this._meshesWithPoseMatrix.indexOf(e); -1 < t && this._meshesWithPoseMatrix.splice(t, 1) }, e.prototype._computeTransformMatrices = function (e, t) { this.onBeforeComputeObservable.notifyObservers(this); for (var i = 0; i < this.bones.length; i++) { var r = this.bones[i], n = r.getParent(); if (n ? r.getLocalMatrix().multiplyToRef(n.getWorldMatrix(), r.getWorldMatrix()) : t ? r.getLocalMatrix().multiplyToRef(t, r.getWorldMatrix()) : r.getWorldMatrix().copyFrom(r.getLocalMatrix()), -1 !== r._index) { var o = null === r._index ? i : r._index; r.getInvertedAbsoluteTransform().multiplyToArray(r.getWorldMatrix(), e, 16 * o) } } this._identity.copyToArray(e, 16 * this.bones.length) }, e.prototype.prepare = function () { if (this._isDirty) { if (this.needInitialSkinMatrix) for (var e = 0; e < this._meshesWithPoseMatrix.length; e++) { var t = this._meshesWithPoseMatrix[e], i = t.getPoseMatrix(); if (t._bonesTransformMatrices && t._bonesTransformMatrices.length === 16 * (this.bones.length + 1) || (t._bonesTransformMatrices = new Float32Array(16 * (this.bones.length + 1))), this._synchronizedWithMesh !== t) { this._synchronizedWithMesh = t; for (var r = 0; r < this.bones.length; r++) { var n = this.bones[r]; n.getParent() || (n.getBaseMatrix().multiplyToRef(i, fo.Tmp.Matrix[1]), n._updateDifferenceMatrix(fo.Tmp.Matrix[1])) } } this._computeTransformMatrices(t._bonesTransformMatrices, i) } else this._transformMatrices && this._transformMatrices.length === 16 * (this.bones.length + 1) || (this._transformMatrices = new Float32Array(16 * (this.bones.length + 1))), this._computeTransformMatrices(this._transformMatrices, null); this._isDirty = !1, this._scene._activeBones.addCount(this.bones.length, !1) } }, e.prototype.getAnimatables = function () { if (!this._animatables || this._animatables.length !== this.bones.length) { this._animatables = []; for (var e = 0; e < this.bones.length; e++)this._animatables.push(this.bones[e]) } return this._animatables }, e.prototype.clone = function (t, i) { var r = new e(t, i || t, this._scene); r.needInitialSkinMatrix = this.needInitialSkinMatrix; for (var n = 0; n < this.bones.length; n++) { var o = this.bones[n], s = null, a = o.getParent(); if (a) { var l = this.bones.indexOf(a); s = r.bones[l] } var c = new fo.Bone(o.name, r, s, o.getBaseMatrix().clone(), o.getRestPose().clone()); fo.Tools.DeepCopy(o.animations, c.animations) } if (this._ranges) for (var h in r._ranges = {}, this._ranges) { var u = this._ranges[h]; u && (r._ranges[h] = u.clone()) } return this._isDirty = !0, r }, e.prototype.enableBlending = function (e) { void 0 === e && (e = .01), this.bones.forEach(function (t) { t.animations.forEach(function (t) { t.enableBlending = !0, t.blendingSpeed = e }) }) }, e.prototype.dispose = function () { this._meshesWithPoseMatrix = [], this.getScene().stopAnimation(this), this.getScene().removeSkeleton(this) }, e.prototype.serialize = function () { var e = {}; e.name = this.name, e.id = this.id, this.dimensionsAtRest && (e.dimensionsAtRest = this.dimensionsAtRest.asArray()), e.bones = [], e.needInitialSkinMatrix = this.needInitialSkinMatrix; for (var t = 0; t < this.bones.length; t++) { var i = this.bones[t], r = i.getParent(), n = { parentBoneIndex: r ? this.bones.indexOf(r) : -1, name: i.name, matrix: i.getBaseMatrix().toArray(), rest: i.getRestPose().toArray() }; for (var o in e.bones.push(n), i.length && (n.length = i.length), i.metadata && (n.metadata = i.metadata), i.animations && 0 < i.animations.length && (n.animation = i.animations[0].serialize()), e.ranges = [], this._ranges) { var s = this._ranges[o]; if (s) { var a = {}; a.name = o, a.from = s.from, a.to = s.to, e.ranges.push(a) } } } return e }, e.Parse = function (t, i) { var r, n = new e(t.name, t.id, i); for (t.dimensionsAtRest && (n.dimensionsAtRest = fo.Vector3.FromArray(t.dimensionsAtRest)), n.needInitialSkinMatrix = t.needInitialSkinMatrix, r = 0; r < t.bones.length; r++) { var o = t.bones[r], s = null; -1 < o.parentBoneIndex && (s = n.bones[o.parentBoneIndex]); var a = o.rest ? fo.Matrix.FromArray(o.rest) : null, l = new fo.Bone(o.name, n, s, fo.Matrix.FromArray(o.matrix), a); void 0 !== o.id && null !== o.id && (l.id = o.id), o.length && (l.length = o.length), o.metadata && (l.metadata = o.metadata), o.animation && l.animations.push(fo.Animation.Parse(o.animation)) } if (t.ranges) for (r = 0; r < t.ranges.length; r++) { var c = t.ranges[r]; n.createAnimationRange(c.name, c.from, c.to) } return n }, e.prototype.computeAbsoluteTransforms = function (e) { void 0 === e && (e = !1); var t = this._scene.getRenderId(); (this._lastAbsoluteTransformsUpdateId != t || e) && (this.bones[0].computeAbsoluteTransforms(), this._lastAbsoluteTransformsUpdateId = t) }, e.prototype.getPoseMatrix = function () { var e = null; return 0 < this._meshesWithPoseMatrix.length && (e = this._meshesWithPoseMatrix[0].getPoseMatrix()), e }, e.prototype.sortBones = function () { for (var e = new Array, t = new Array(this.bones.length), i = 0; i < this.bones.length; i++)this._sortBones(i, e, t); this.bones = e }, e.prototype._sortBones = function (e, t, i) { if (!i[e]) { i[e] = !0; var r = this.bones[e]; void 0 === r._index && (r._index = e); var n = r.getParent(); n && this._sortBones(this.bones.indexOf(n), t, i), t.push(r) } }, e }(), fo.Skeleton = po, _o = $a || ($a = {}), mo = function () { function e() { } return e.Ldexp = function (e, t) { return 1023 < t ? e * Math.pow(2, 1023) * Math.pow(2, t - 1023) : t < -1074 ? e * Math.pow(2, -1074) * Math.pow(2, t + 1074) : e * Math.pow(2, t) }, e.Rgbe2float = function (e, t, i, r, n, o) { 0 < n ? (n = this.Ldexp(1, n - 136), e[o + 0] = t * n, e[o + 1] = i * n, e[o + 2] = r * n) : (e[o + 0] = 0, e[o + 1] = 0, e[o + 2] = 0) }, e.readStringLine = function (e, t) { for (var i = "", r = "", n = t; n < e.length - t && "\n" != (r = String.fromCharCode(e[n])); n++)i += r; return i }, e.RGBE_ReadHeader = function (e) { var t, i, r = this.readStringLine(e, 0); if ("#" != r[0] || "?" != r[1]) throw "Bad HDR Format."; for (var n = !1, o = !1, s = 0; s += r.length + 1, "FORMAT=32-bit_rle_rgbe" == (r = this.readStringLine(e, s)) ? o = !0 : 0 == r.length && (n = !0), !n;); if (!o) throw "HDR Bad header format, unsupported FORMAT"; s += r.length + 1, r = this.readStringLine(e, s); var a = /^\-Y (.*) \+X (.*)$/g.exec(r); if (!a || a.length < 3) throw "HDR Bad header format, no size"; if (i = parseInt(a[2]), t = parseInt(a[1]), i < 8 || 32767 < i) throw "HDR Bad header format, unsupported size"; return { height: t, width: i, dataPosition: s += r.length + 1 } }, e.GetCubeMapTextureData = function (e, t) { var i = new Uint8Array(e), r = this.RGBE_ReadHeader(i), n = this.RGBE_ReadPixels_RLE(i, r); return _o.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(n, r.width, r.height, t) }, e.RGBE_ReadPixels = function (e, t) { return this.RGBE_ReadPixels_RLE(e, t) }, e.RGBE_ReadPixels_RLE = function (e, t) { for (var i, r, n, o, s, a = t.height, l = t.width, c = t.dataPosition, h = 0, u = 0, d = 0, f = new ArrayBuffer(4 * l), p = new Uint8Array(f), _ = new ArrayBuffer(t.width * t.height * 4 * 3), m = new Float32Array(_); 0 < a;) { if (i = e[c++], r = e[c++], n = e[c++], o = e[c++], 2 != i || 2 != r || 128 & n) throw "HDR Bad header format, not RLE"; if ((n << 8 | o) != l) throw "HDR Bad header format, wrong scan line width"; for (d = h = 0; d < 4; d++)for (u = (d + 1) * l; h < u;)if (i = e[c++], r = e[c++], 128 < i) { if (0 == (s = i - 128) || u - h < s) throw "HDR Bad Format, bad scanline data (run)"; for (; 0 < s--;)p[h++] = r } else { if (0 == (s = i) || u - h < s) throw "HDR Bad Format, bad scanline data (non-run)"; if (p[h++] = r, 0 < --s) for (var g = 0; g < s; g++)p[h++] = e[c++] } for (d = 0; d < l; d++)i = p[d], r = p[d + l], n = p[d + 2 * l], o = p[d + 3 * l], this.Rgbe2float(m, i, r, n, o, (t.height - a) * l * 3 + 3 * d); a-- } return m }, e }(), _o.HDRTools = mo, vo = function (e) { function t(t, i, r, n, o, s, a, l, c) { void 0 === n && (n = !1), void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = !1), void 0 === l && (l = null), void 0 === c && (c = null); var h = e.call(this, i) || this; return h._generateHarmonics = !0, h._onLoad = null, h._onError = null, h.coordinatesMode = go.Texture.CUBIC_MODE, h._isBlocking = !0, h._rotationY = 0, h.boundingBoxPosition = go.Vector3.Zero(), t && (h.name = t, h.url = t, h.hasAlpha = !1, h.isCube = !0, h._textureMatrix = go.Matrix.Identity(), h._onLoad = l, h._onError = c, h.gammaSpace = s, h._noMipmap = n, h._size = r, h._texture = h._getFromCache(t, h._noMipmap), h._texture || (i.useDelayedTextureLoading ? h.delayLoadState = go.Engine.DELAYLOADSTATE_NOTLOADED : h.loadTexture())), h } return T(t, e), Object.defineProperty(t.prototype, "isBlocking", { get: function () { return this._isBlocking }, set: function (e) { this._isBlocking = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "rotationY", { get: function () { return this._rotationY }, set: function (e) { this._rotationY = e, this.setReflectionTextureMatrix(go.Matrix.RotationY(this._rotationY)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "boundingBoxSize", { get: function () { return this._boundingBoxSize }, set: function (e) { if (!this._boundingBoxSize || !this._boundingBoxSize.equals(e)) { this._boundingBoxSize = e; var t = this.getScene(); t && t.markAllMaterialsAsDirty(go.Material.TextureDirtyFlag) } }, enumerable: !0, configurable: !0 }), t.prototype.loadTexture = function () { var e = this, i = this.getScene(); i && (this._texture = i.getEngine().createRawCubeTextureFromUrl(this.url, i, this._size, go.Engine.TEXTUREFORMAT_RGB, i.getEngine().getCaps().textureFloat ? go.Engine.TEXTURETYPE_FLOAT : go.Engine.TEXTURETYPE_UNSIGNED_INT, this._noMipmap, function (i) { e.lodGenerationOffset = 0, e.lodGenerationScale = .8; var r = e.getScene(); if (!r) return null; var n = go.HDRTools.GetCubeMapTextureData(i, e._size); if (e._generateHarmonics) { var o = go.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(n); e.sphericalPolynomial = o } for (var s = [], a = null, l = 0; l < 6; l++) { if (!r.getEngine().getCaps().textureFloat) { var c = new ArrayBuffer(e._size * e._size * 3); a = new Uint8Array(c) } var h = n[t._facesMapping[l]]; if (e.gammaSpace || a) for (var u = 0; u < e._size * e._size; u++)if (e.gammaSpace && (h[3 * u + 0] = Math.pow(h[3 * u + 0], go.ToGammaSpace), h[3 * u + 1] = Math.pow(h[3 * u + 1], go.ToGammaSpace), h[3 * u + 2] = Math.pow(h[3 * u + 2], go.ToGammaSpace)), a) { var d = Math.max(255 * h[3 * u + 0], 0), f = Math.max(255 * h[3 * u + 1], 0), p = Math.max(255 * h[3 * u + 2], 0), _ = Math.max(Math.max(d, f), p); if (255 < _) { var m = 255 / _; d *= m, f *= m, p *= m } a[3 * u + 0] = d, a[3 * u + 1] = f, a[3 * u + 2] = p } a ? s.push(a) : s.push(h) } return s }, null, this._onLoad, this._onError)) }, t.prototype.clone = function () { var e = this.getScene(); if (!e) return this; var i = new t(this.url, e, this._size, this._noMipmap, this._generateHarmonics, this.gammaSpace); return i.level = this.level, i.wrapU = this.wrapU, i.wrapV = this.wrapV, i.coordinatesIndex = this.coordinatesIndex, i.coordinatesMode = this.coordinatesMode, i }, t.prototype.delayLoad = function () { this.delayLoadState === go.Engine.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = go.Engine.DELAYLOADSTATE_LOADED, this._texture = this._getFromCache(this.url, this._noMipmap), this._texture || this.loadTexture()) }, t.prototype.getReflectionTextureMatrix = function () { return this._textureMatrix }, t.prototype.setReflectionTextureMatrix = function (e) { this._textureMatrix = e }, t.Parse = function (e, i, r) { var n = null; return e.name && !e.isRenderTarget && ((n = new t(r + e.name, i, e.size, e.noMipmap, e.generateHarmonics, e.useInGammaSpace)).name = e.name, n.hasAlpha = e.hasAlpha, n.level = e.level, n.coordinatesMode = e.coordinatesMode, n.isBlocking = e.isBlocking), n && (e.boundingBoxPosition && (n.boundingBoxPosition = go.Vector3.FromArray(e.boundingBoxPosition)), e.boundingBoxSize && (n.boundingBoxSize = go.Vector3.FromArray(e.boundingBoxSize)), e.rotationY && (n.rotationY = e.rotationY)), n }, t.prototype.serialize = function () { if (!this.name) return null; var e = {}; return e.name = this.name, e.hasAlpha = this.hasAlpha, e.isCube = !0, e.level = this.level, e.size = this._size, e.coordinatesMode = this.coordinatesMode, e.useInGammaSpace = this.gammaSpace, e.generateHarmonics = this._generateHarmonics, e.customType = "BABYLON.HDRCubeTexture", e.noMipmap = this._noMipmap, e.isBlocking = this._isBlocking, e.rotationY = this._rotationY, e }, t._facesMapping = ["right", "left", "up", "down", "front", "back"], t }((go = $a || ($a = {})).BaseTexture), go.HDRCubeTexture = vo, yo = $a || ($a = {}), bo = function () { function e() { } return e.ConvertPanoramaToCubemap = function (e, t, i, r) { if (!e) throw "ConvertPanoramaToCubemap: input cannot be null"; if (e.length != t * i * 3) throw "ConvertPanoramaToCubemap: input size is wrong"; return { front: this.CreateCubemapTexture(r, this.FACE_FRONT, e, t, i), back: this.CreateCubemapTexture(r, this.FACE_BACK, e, t, i), left: this.CreateCubemapTexture(r, this.FACE_LEFT, e, t, i), right: this.CreateCubemapTexture(r, this.FACE_RIGHT, e, t, i), up: this.CreateCubemapTexture(r, this.FACE_UP, e, t, i), down: this.CreateCubemapTexture(r, this.FACE_DOWN, e, t, i), size: r, type: yo.Engine.TEXTURETYPE_FLOAT, format: yo.Engine.TEXTUREFORMAT_RGB, gammaSpace: !1 } }, e.CreateCubemapTexture = function (e, t, i, r, n) { for (var o = new ArrayBuffer(e * e * 4 * 3), s = new Float32Array(o), a = t[1].subtract(t[0]).scale(1 / e), l = t[3].subtract(t[2]).scale(1 / e), c = 1 / e, h = 0, u = 0; u < e; u++) { for (var d = t[0], f = t[2], p = 0; p < e; p++) { var _ = f.subtract(d).scale(h).add(d); _.normalize(); var m = this.CalcProjectionSpherical(_, i, r, n); s[u * e * 3 + 3 * p + 0] = m.r, s[u * e * 3 + 3 * p + 1] = m.g, s[u * e * 3 + 3 * p + 2] = m.b, d = d.add(a), f = f.add(l) } h += c } return s }, e.CalcProjectionSpherical = function (e, t, i, r) { for (var n = Math.atan2(e.z, e.x), o = Math.acos(e.y); n < -Math.PI;)n += 2 * Math.PI; for (; n > Math.PI;)n -= 2 * Math.PI; var s = n / Math.PI, a = o / Math.PI; s = .5 * s + .5; var l = Math.round(s * i); l < 0 ? l = 0 : i <= l && (l = i - 1); var c = Math.round(a * r); c < 0 ? c = 0 : r <= c && (c = r - 1); var h = r - c - 1; return { r: t[h * i * 3 + 3 * l + 0], g: t[h * i * 3 + 3 * l + 1], b: t[h * i * 3 + 3 * l + 2] } }, e.FACE_FRONT = [new yo.Vector3(-1, -1, -1), new yo.Vector3(1, -1, -1), new yo.Vector3(-1, 1, -1), new yo.Vector3(1, 1, -1)], e.FACE_BACK = [new yo.Vector3(1, -1, 1), new yo.Vector3(-1, -1, 1), new yo.Vector3(1, 1, 1), new yo.Vector3(-1, 1, 1)], e.FACE_RIGHT = [new yo.Vector3(1, -1, -1), new yo.Vector3(1, -1, 1), new yo.Vector3(1, 1, -1), new yo.Vector3(1, 1, 1)], e.FACE_LEFT = [new yo.Vector3(-1, -1, 1), new yo.Vector3(-1, -1, -1), new yo.Vector3(-1, 1, 1), new yo.Vector3(-1, 1, -1)], e.FACE_DOWN = [new yo.Vector3(-1, 1, -1), new yo.Vector3(1, 1, -1), new yo.Vector3(-1, 1, 1), new yo.Vector3(1, 1, 1)], e.FACE_UP = [new yo.Vector3(-1, -1, 1), new yo.Vector3(1, -1, 1), new yo.Vector3(-1, -1, -1), new yo.Vector3(1, -1, -1)], e }(), yo.PanoramaToCubeMapTools = bo, function (e) { var t = function (e) { function t(t, i) { var r = e.call(this, t.x, t.y) || this; return r.index = i, r } return T(t, e), t }(e.Vector2), i = function () { function i() { this.elements = new Array } return i.prototype.add = function (e) { var i = this, r = new Array; return e.forEach(function (e) { if (0 === r.length || !e.equalsWithEpsilon(r[0])) { var n = new t(e, i.elements.length); r.push(n), i.elements.push(n) } }), r }, i.prototype.computeBounds = function () { var t = new e.Vector2(this.elements[0].x, this.elements[0].y), i = new e.Vector2(this.elements[0].x, this.elements[0].y); return this.elements.forEach(function (e) { e.x < t.x ? t.x = e.x : e.x > i.x && (i.x = e.x), e.y < t.y ? t.y = e.y : e.y > i.y && (i.y = e.y) }), { min: t, max: i, width: i.x - t.x, height: i.y - t.y } }, i }(), n = function () { function t() { } return t.Rectangle = function (t, i, r, n) { return [new e.Vector2(t, i), new e.Vector2(r, i), new e.Vector2(r, n), new e.Vector2(t, n)] }, t.Circle = function (t, i, r, n) { void 0 === i && (i = 0), void 0 === r && (r = 0), void 0 === n && (n = 32); for (var o = new Array, s = 0, a = 2 * Math.PI / n, l = 0; l < n; l++)o.push(new e.Vector2(i + Math.cos(s) * t, r + Math.sin(s) * t)), s -= a; return o }, t.Parse = function (t) { var i, r = t.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function (e) { return !isNaN(e) }), n = []; for (i = 0; i < (2147483646 & r.length); i += 2)n.push(new e.Vector2(r[i], r[i + 1])); return n }, t.StartingAt = function (t, i) { return e.Path2.StartingAt(t, i) }, t }(); e.Polygon = n; var o = function () { function t(t, n, o) { var s; this._points = new i, this._outlinepoints = new i, this._holes = new Array, this._epoints = new Array, this._eholes = new Array, this._name = t, this._scene = o, s = n instanceof e.Path2 ? n.getPoints() : n, this._addToepoint(s), this._points.add(s), this._outlinepoints.add(s), void 0 === r && e.Tools.Warn("Earcut was not found, the polygon will not be built.") } return t.prototype._addToepoint = function (e) { for (var t = 0, i = e; t < i.length; t++) { var r = i[t]; this._epoints.push(r.x, r.y) } }, t.prototype.addHole = function (e) { this._points.add(e); var t = new i; return t.add(e), this._holes.push(t), this._eholes.push(this._epoints.length / 2), this._addToepoint(e), this }, t.prototype.build = function (t, i) { var n = this; void 0 === t && (t = !1), void 0 === i && (i = 0); var o = new e.Mesh(this._name, this._scene), s = new Array, a = new Array, l = new Array, c = this._points.computeBounds(); this._points.elements.forEach(function (e) { s.push(0, 1, 0), a.push(e.x, 0, e.y), l.push((e.x - c.min.x) / c.width, (e.y - c.min.y) / c.height) }); for (var h = new Array, u = r(this._epoints, this._eholes, 2), d = 0; d < u.length; d++)h.push(u[d]); if (0 < i) { var f = a.length / 3; this._points.elements.forEach(function (e) { s.push(0, -1, 0), a.push(e.x, -i, e.y), l.push(1 - (e.x - c.min.x) / c.width, 1 - (e.y - c.min.y) / c.height) }); var p = h.length; for (d = 0; d < p; d += 3) { var _ = h[d + 0], m = h[d + 1], g = h[d + 2]; h.push(g + f), h.push(m + f), h.push(_ + f) } this.addSide(a, s, l, h, c, this._outlinepoints, i, !1), this._holes.forEach(function (e) { n.addSide(a, s, l, h, c, e, i, !0) }) } return o.setVerticesData(e.VertexBuffer.PositionKind, a, t), o.setVerticesData(e.VertexBuffer.NormalKind, s, t), o.setVerticesData(e.VertexBuffer.UVKind, l, t), o.setIndices(h), o }, t.prototype.addSide = function (t, i, r, n, o, s, a, l) { for (var c = t.length / 3, h = 0, u = 0; u < s.elements.length; u++) { var d, f = s.elements[u]; d = u + 1 > s.elements.length - 1 ? s.elements[0] : s.elements[u + 1], t.push(f.x, 0, f.y), t.push(f.x, -a, f.y), t.push(d.x, 0, d.y), t.push(d.x, -a, d.y); var p = new e.Vector3(f.x, 0, f.y), _ = new e.Vector3(d.x, 0, d.y).subtract(p), m = new e.Vector3(0, 1, 0), g = e.Vector3.Cross(_, m); g = g.normalize(), r.push(h / o.width, 0), r.push(h / o.width, 1), h += _.length(), r.push(h / o.width, 0), r.push(h / o.width, 1), l ? (i.push(g.x, g.y, g.z), i.push(g.x, g.y, g.z), i.push(g.x, g.y, g.z), i.push(g.x, g.y, g.z), n.push(c), n.push(c + 2), n.push(c + 1), n.push(c + 1), n.push(c + 2), n.push(c + 3)) : (i.push(-g.x, -g.y, -g.z), i.push(-g.x, -g.y, -g.z), i.push(-g.x, -g.y, -g.z), i.push(-g.x, -g.y, -g.z), n.push(c), n.push(c + 1), n.push(c + 2), n.push(c + 1), n.push(c + 3), n.push(c + 2)), c += 4 } }, t }(); e.PolygonMeshBuilder = o }($a || ($a = {})), To = $a || ($a = {}), Eo = 0, xo = function () { function e(e, t, i) { this.pos = e, this.normal = t, this.uv = i } return e.prototype.clone = function () { return new e(this.pos.clone(), this.normal.clone(), this.uv.clone()) }, e.prototype.flip = function () { this.normal = this.normal.scale(-1) }, e.prototype.interpolate = function (t, i) { return new e(To.Vector3.Lerp(this.pos, t.pos, i), To.Vector3.Lerp(this.normal, t.normal, i), To.Vector2.Lerp(this.uv, t.uv, i)) }, e }(), Po = function () { function e(e, t) { this.normal = e, this.w = t } return e.FromPoints = function (t, i, r) { var n = r.subtract(t), o = i.subtract(t); if (0 === n.lengthSquared() || 0 === o.lengthSquared()) return null; var s = To.Vector3.Normalize(To.Vector3.Cross(n, o)); return new e(s, To.Vector3.Dot(s, t)) }, e.prototype.clone = function () { return new e(this.normal.clone(), this.w) }, e.prototype.flip = function () { this.normal.scaleInPlace(-1), this.w = -this.w }, e.prototype.splitPolygon = function (t, i, r, n, o) { var s, a, l = 0, c = []; for (s = 0; s < t.vertices.length; s++) { var h = (a = To.Vector3.Dot(this.normal, t.vertices[s].pos) - this.w) < -e.EPSILON ? 2 : e.EPSILON < a ? 1 : 0; l |= h, c.push(h) } switch (l) { case 0: (0 < To.Vector3.Dot(this.normal, t.plane.normal) ? i : r).push(t); break; case 1: n.push(t); break; case 2: o.push(t); break; case 3: var u, d = [], f = []; for (s = 0; s < t.vertices.length; s++) { var p = (s + 1) % t.vertices.length, _ = c[s], m = c[p], g = t.vertices[s], v = t.vertices[p]; if (2 !== _ && d.push(g), 1 !== _ && f.push(2 !== _ ? g.clone() : g), 3 == (_ | m)) { a = (this.w - To.Vector3.Dot(this.normal, g.pos)) / To.Vector3.Dot(this.normal, v.pos.subtract(g.pos)); var y = g.interpolate(v, a); d.push(y), f.push(y.clone()) } } 3 <= d.length && (u = new Ao(d, t.shared)).plane && n.push(u), 3 <= f.length && (u = new Ao(f, t.shared)).plane && o.push(u) } }, e.EPSILON = 1e-5, e }(), Ao = function () { function e(e, t) { this.vertices = e, this.shared = t, this.plane = Po.FromPoints(e[0].pos, e[1].pos, e[2].pos) } return e.prototype.clone = function () { return new e(this.vertices.map(function (e) { return e.clone() }), this.shared) }, e.prototype.flip = function () { this.vertices.reverse().map(function (e) { e.flip() }), this.plane.flip() }, e }(), So = function () { function e(e) { this.plane = null, this.front = null, this.back = null, this.polygons = new Array, e && this.build(e) } return e.prototype.clone = function () { var t = new e; return t.plane = this.plane && this.plane.clone(), t.front = this.front && this.front.clone(), t.back = this.back && this.back.clone(), t.polygons = this.polygons.map(function (e) { return e.clone() }), t }, e.prototype.invert = function () { for (var e = 0; e < this.polygons.length; e++)this.polygons[e].flip(); this.plane && this.plane.flip(), this.front && this.front.invert(), this.back && this.back.invert(); var t = this.front; this.front = this.back, this.back = t }, e.prototype.clipPolygons = function (e) { if (!this.plane) return e.slice(); for (var t = new Array, i = new Array, r = 0; r < e.length; r++)this.plane.splitPolygon(e[r], t, i, t, i); return this.front && (t = this.front.clipPolygons(t)), i = this.back ? this.back.clipPolygons(i) : [], t.concat(i) }, e.prototype.clipTo = function (e) { this.polygons = e.clipPolygons(this.polygons), this.front && this.front.clipTo(e), this.back && this.back.clipTo(e) }, e.prototype.allPolygons = function () { var e = this.polygons.slice(); return this.front && (e = e.concat(this.front.allPolygons())), this.back && (e = e.concat(this.back.allPolygons())), e }, e.prototype.build = function (t) { if (t.length) { this.plane || (this.plane = t[0].plane.clone()); for (var i = new Array, r = new Array, n = 0; n < t.length; n++)this.plane.splitPolygon(t[n], this.polygons, this.polygons, i, r); i.length && (this.front || (this.front = new e), this.front.build(i)), r.length && (this.back || (this.back = new e), this.back.build(r)) } }, e }(), Mo = function () { function e() { this.polygons = new Array } return e.FromMesh = function (t) { var i, r, n, o, s, a, l, c, h, u, d = new Array, f = null; if (!(t instanceof To.Mesh)) throw "BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh"; t.computeWorldMatrix(!0), l = t.getWorldMatrix(), c = t.position.clone(), h = t.rotation.clone(), t.rotationQuaternion && (f = t.rotationQuaternion.clone()), u = t.scaling.clone(); for (var p = t.getIndices(), _ = t.getVerticesData(To.VertexBuffer.PositionKind), m = t.getVerticesData(To.VertexBuffer.NormalKind), g = t.getVerticesData(To.VertexBuffer.UVKind), v = t.subMeshes, y = 0, b = v.length; y < b; y++)for (var T = v[y].indexStart, E = v[y].indexCount + v[y].indexStart; T < E; T += 3) { a = []; for (var x = 0; x < 3; x++) { var P = new To.Vector3(m[3 * p[T + x]], m[3 * p[T + x] + 1], m[3 * p[T + x] + 2]); n = new To.Vector2(g[2 * p[T + x]], g[2 * p[T + x] + 1]); var A = new To.Vector3(_[3 * p[T + x]], _[3 * p[T + x] + 1], _[3 * p[T + x] + 2]); o = To.Vector3.TransformCoordinates(A, l), r = To.Vector3.TransformNormal(P, l), i = new xo(o, r, n), a.push(i) } (s = new Ao(a, { subMeshId: y, meshId: Eo, materialIndex: v[y].materialIndex })).plane && d.push(s) } var S = e.FromPolygons(d); return S.matrix = l, S.position = c, S.rotation = h, S.scaling = u, S.rotationQuaternion = f, Eo++ , S }, e.FromPolygons = function (t) { var i = new e; return i.polygons = t, i }, e.prototype.clone = function () { var t = new e; return t.polygons = this.polygons.map(function (e) { return e.clone() }), t.copyTransformAttributes(this), t }, e.prototype.union = function (t) { var i = new So(this.clone().polygons), r = new So(t.clone().polygons); return i.clipTo(r), r.clipTo(i), r.invert(), r.clipTo(i), r.invert(), i.build(r.allPolygons()), e.FromPolygons(i.allPolygons()).copyTransformAttributes(this) }, e.prototype.unionInPlace = function (e) { var t = new So(this.polygons), i = new So(e.polygons); t.clipTo(i), i.clipTo(t), i.invert(), i.clipTo(t), i.invert(), t.build(i.allPolygons()), this.polygons = t.allPolygons() }, e.prototype.subtract = function (t) { var i = new So(this.clone().polygons), r = new So(t.clone().polygons); return i.invert(), i.clipTo(r), r.clipTo(i), r.invert(), r.clipTo(i), r.invert(), i.build(r.allPolygons()), i.invert(), e.FromPolygons(i.allPolygons()).copyTransformAttributes(this) }, e.prototype.subtractInPlace = function (e) { var t = new So(this.polygons), i = new So(e.polygons); t.invert(), t.clipTo(i), i.clipTo(t), i.invert(), i.clipTo(t), i.invert(), t.build(i.allPolygons()), t.invert(), this.polygons = t.allPolygons() }, e.prototype.intersect = function (t) { var i = new So(this.clone().polygons), r = new So(t.clone().polygons); return i.invert(), r.clipTo(i), r.invert(), i.clipTo(r), r.clipTo(i), i.build(r.allPolygons()), i.invert(), e.FromPolygons(i.allPolygons()).copyTransformAttributes(this) }, e.prototype.intersectInPlace = function (e) { var t = new So(this.polygons), i = new So(e.polygons); t.invert(), i.clipTo(t), i.invert(), t.clipTo(i), i.clipTo(t), t.build(i.allPolygons()), t.invert(), this.polygons = t.allPolygons() }, e.prototype.inverse = function () { var e = this.clone(); return e.inverseInPlace(), e }, e.prototype.inverseInPlace = function () { this.polygons.map(function (e) { e.flip() }) }, e.prototype.copyTransformAttributes = function (e) { return this.matrix = e.matrix, this.position = e.position, this.rotation = e.rotation, this.scaling = e.scaling, this.rotationQuaternion = e.rotationQuaternion, this }, e.prototype.buildMeshGeometry = function (e, t, i) { var r = this.matrix.clone(); r.invert(); var n, o, s, a = new To.Mesh(e, t), l = [], c = [], h = [], u = [], d = To.Vector3.Zero(), f = To.Vector3.Zero(), p = To.Vector2.Zero(), _ = this.polygons, m = [0, 0, 0], g = {}, v = 0, y = {}; i && _.sort(function (e, t) { return e.shared.meshId === t.shared.meshId ? e.shared.subMeshId - t.shared.subMeshId : e.shared.meshId - t.shared.meshId }); for (var b = 0, T = _.length; b < T; b++) { y[(n = _[b]).shared.meshId] || (y[n.shared.meshId] = {}), y[n.shared.meshId][n.shared.subMeshId] || (y[n.shared.meshId][n.shared.subMeshId] = { indexStart: 1 / 0, indexEnd: -1 / 0, materialIndex: n.shared.materialIndex }), s = y[n.shared.meshId][n.shared.subMeshId]; for (var E = 2, x = n.vertices.length; E < x; E++) { m[0] = 0, m[1] = E - 1, m[2] = E; for (var P = 0; P < 3; P++) { d.copyFrom(n.vertices[m[P]].pos), f.copyFrom(n.vertices[m[P]].normal), p.copyFrom(n.vertices[m[P]].uv); var A = To.Vector3.TransformCoordinates(d, r), S = To.Vector3.TransformNormal(f, r); void 0 !== (o = g[A.x + "," + A.y + "," + A.z]) && h[3 * o] === S.x && h[3 * o + 1] === S.y && h[3 * o + 2] === S.z && u[2 * o] === p.x && u[2 * o + 1] === p.y || (l.push(A.x, A.y, A.z), u.push(p.x, p.y), h.push(f.x, f.y, f.z), o = g[A.x + "," + A.y + "," + A.z] = l.length / 3 - 1), c.push(o), s.indexStart = Math.min(v, s.indexStart), s.indexEnd = Math.max(v, s.indexEnd), v++ } } } if (a.setVerticesData(To.VertexBuffer.PositionKind, l), a.setVerticesData(To.VertexBuffer.NormalKind, h), a.setVerticesData(To.VertexBuffer.UVKind, u), a.setIndices(c, null), i) { var M, R = 0; for (var C in a.subMeshes = new Array, y) { for (var O in M = -1, y[C]) s = y[C][O], To.SubMesh.CreateFromIndices(s.materialIndex + R, s.indexStart, s.indexEnd - s.indexStart + 1, a), M = Math.max(s.materialIndex, M); R += ++M } } return a }, e.prototype.toMesh = function (e, t, i, r) { var n = this.buildMeshGeometry(e, i, r); return n.material = t, n.position.copyFrom(this.position), n.rotation.copyFrom(this.rotation), this.rotationQuaternion && (n.rotationQuaternion = this.rotationQuaternion.clone()), n.scaling.copyFrom(this.scaling), n.computeWorldMatrix(!0), n }, e }(), To.CSG = Mo, Ro = $a || ($a = {}), Co = function () { function e(e, t, i, r, n) { this.size = e, this.position = t, this.alphaMode = Ro.Engine.ALPHA_ONEONE, this.color = i || new Ro.Color3(1, 1, 1), this.texture = r ? new Ro.Texture(r, n.getScene(), !0) : null, (this._system = n).lensFlares.push(this) } return e.AddFlare = function (t, i, r, n, o) { return new e(t, i, r, n, o) }, e.prototype.dispose = function () { this.texture && this.texture.dispose(); var e = this._system.lensFlares.indexOf(this); this._system.lensFlares.splice(e, 1) }, e }(), Ro.LensFlare = Co, function (e) { e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_LENSFLARESYSTEM, function (t, i, r, n) { if (void 0 !== t.lensFlareSystems && null !== t.lensFlareSystems) { r.lensFlareSystems || (r.lensFlareSystems = new Array); for (var o = 0, s = t.lensFlareSystems.length; o < s; o++) { var a = t.lensFlareSystems[o], l = e.LensFlareSystem.Parse(a, i, n); r.lensFlareSystems.push(l) } } }), e.AbstractScene.prototype.getLensFlareSystemByName = function (e) { for (var t = 0; t < this.lensFlareSystems.length; t++)if (this.lensFlareSystems[t].name === e) return this.lensFlareSystems[t]; return null }, e.AbstractScene.prototype.getLensFlareSystemByID = function (e) { for (var t = 0; t < this.lensFlareSystems.length; t++)if (this.lensFlareSystems[t].id === e) return this.lensFlareSystems[t]; return null }, e.AbstractScene.prototype.removeLensFlareSystem = function (e) { var t = this.lensFlareSystems.indexOf(e); return -1 !== t && this.lensFlareSystems.splice(t, 1), t }, e.AbstractScene.prototype.addLensFlareSystem = function (e) { this.lensFlareSystems.push(e) }; var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_LENSFLARESYSTEM, (this.scene = t).lensFlareSystems = new Array } return t.prototype.register = function () { this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM, this, this._draw) }, t.prototype.rebuild = function () { }, t.prototype.addFromContainer = function (e) { var t = this; e.lensFlareSystems && e.lensFlareSystems.forEach(function (e) { t.scene.addLensFlareSystem(e) }) }, t.prototype.removeFromContainer = function (e) { var t = this; e.lensFlareSystems && e.lensFlareSystems.forEach(function (e) { t.scene.removeLensFlareSystem(e) }) }, t.prototype.serialize = function (e) { e.lensFlareSystems = []; for (var t = 0, i = this.scene.lensFlareSystems; t < i.length; t++) { var r = i[t]; e.lensFlareSystems.push(r.serialize()) } }, t.prototype.dispose = function () { for (var e = this.scene.lensFlareSystems; e.length;)e[0].dispose() }, t.prototype._draw = function (t) { if (this.scene.lensFlaresEnabled) { var i = this.scene.lensFlareSystems; e.Tools.StartPerformanceCounter("Lens flares", 0 < i.length); for (var r = 0, n = i; r < n.length; r++) { var o = n[r]; 0 != (t.layerMask & o.layerMask) && o.render() } e.Tools.EndPerformanceCounter("Lens flares", 0 < i.length) } }, t }(); e.LensFlareSystemSceneComponent = t }($a || ($a = {})), Oo = $a || ($a = {}), Do = function () { function e(e, t, i) { this.name = e, this.lensFlares = new Array, this.borderLimit = 300, this.viewportBorder = 0, this.layerMask = 268435455, this._vertexBuffers = {}, this._isEnabled = !0, this._scene = i || Oo.Engine.LastCreatedScene; var r = this._scene._getComponent(Oo.SceneComponentConstants.NAME_LENSFLARESYSTEM); r || (r = new Oo.LensFlareSystemSceneComponent(this._scene), i._addComponent(r)), this._emitter = t, this.id = e, i.lensFlareSystems.push(this), this.meshesSelectionPredicate = function (e) { return i.activeCamera && e.material && e.isVisible && e.isEnabled() && e.isBlocker && 0 != (e.layerMask & i.activeCamera.layerMask) }; var n = i.getEngine(), o = []; o.push(1, 1), o.push(-1, 1), o.push(-1, -1), o.push(1, -1), this._vertexBuffers[Oo.VertexBuffer.PositionKind] = new Oo.VertexBuffer(n, o, Oo.VertexBuffer.PositionKind, !1, !1, 2); var s = []; s.push(0), s.push(1), s.push(2), s.push(0), s.push(2), s.push(3), this._indexBuffer = n.createIndexBuffer(s), this._effect = n.createEffect("lensFlare", [Oo.VertexBuffer.PositionKind], ["color", "viewportMatrix"], ["textureSampler"], "") } return Object.defineProperty(e.prototype, "isEnabled", { get: function () { return this._isEnabled }, set: function (e) { this._isEnabled = e }, enumerable: !0, configurable: !0 }), e.prototype.getScene = function () { return this._scene }, e.prototype.getEmitter = function () { return this._emitter }, e.prototype.setEmitter = function (e) { this._emitter = e }, e.prototype.getEmitterPosition = function () { return this._emitter.getAbsolutePosition ? this._emitter.getAbsolutePosition() : this._emitter.position }, e.prototype.computeEffectivePosition = function (e) { var t = this.getEmitterPosition(); return t = Oo.Vector3.Project(t, Oo.Matrix.Identity(), this._scene.getTransformMatrix(), e), this._positionX = t.x, this._positionY = t.y, t = Oo.Vector3.TransformCoordinates(this.getEmitterPosition(), this._scene.getViewMatrix()), 0 < this.viewportBorder && (e.x -= this.viewportBorder, e.y -= this.viewportBorder, e.width += 2 * this.viewportBorder, e.height += 2 * this.viewportBorder, t.x += this.viewportBorder, t.y += this.viewportBorder, this._positionX += this.viewportBorder, this._positionY += this.viewportBorder), 0 < t.z && (this._positionX > e.x && this._positionX < e.x + e.width && this._positionY > e.y && (this._positionY, e.y, e.height), !0) }, e.prototype._isVisible = function () { if (!this._isEnabled || !this._scene.activeCamera) return !1; var e = this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition), t = e.length(); e.normalize(); var i = new Oo.Ray(this._scene.activeCamera.globalPosition, e), r = this._scene.pickWithRay(i, this.meshesSelectionPredicate, !0); return !r || !r.hit || r.distance > t }, e.prototype.render = function () { if (!this._effect.isReady() || !this._scene.activeCamera) return !1; var e, t, i = this._scene.getEngine(), r = this._scene.activeCamera.viewport.toGlobal(i.getRenderWidth(!0), i.getRenderHeight(!0)); if (!this.computeEffectivePosition(r)) return !1; if (!this._isVisible()) return !1; e = this._positionX < this.borderLimit + r.x ? this.borderLimit + r.x - this._positionX : this._positionX > r.x + r.width - this.borderLimit ? this._positionX - r.x - r.width + this.borderLimit : 0; var n = (t = this._positionY < this.borderLimit + r.y ? this.borderLimit + r.y - this._positionY : this._positionY > r.y + r.height - this.borderLimit ? this._positionY - r.y - r.height + this.borderLimit : 0) < e ? e : t; (n -= this.viewportBorder) > this.borderLimit && (n = this.borderLimit); var o = 1 - Oo.Scalar.Clamp(n / this.borderLimit, 0, 1); if (o < 0) return !1; 1 < o && (o = 1), 0 < this.viewportBorder && (r.x += this.viewportBorder, r.y += this.viewportBorder, r.width -= 2 * this.viewportBorder, r.height -= 2 * this.viewportBorder, this._positionX -= this.viewportBorder, this._positionY -= this.viewportBorder); var s = r.x + r.width / 2, a = r.y + r.height / 2, l = s - this._positionX, c = a - this._positionY; i.enableEffect(this._effect), i.setState(!1), i.setDepthBuffer(!1), i.bindBuffers(this._vertexBuffers, this._indexBuffer, this._effect); for (var h = 0; h < this.lensFlares.length; h++) { var u = this.lensFlares[h]; i.setAlphaMode(u.alphaMode); var d = s - l * u.position, f = a - c * u.position, p = u.size, _ = u.size * i.getAspectRatio(this._scene.activeCamera, !0), m = d / (r.width + 2 * r.x) * 2 - 1, g = 1 - f / (r.height + 2 * r.y) * 2, v = Oo.Matrix.FromValues(p / 2, 0, 0, 0, 0, _ / 2, 0, 0, 0, 0, 1, 0, m, g, 0, 1); this._effect.setMatrix("viewportMatrix", v), this._effect.setTexture("textureSampler", u.texture), this._effect.setFloat4("color", u.color.r * o, u.color.g * o, u.color.b * o, 1), i.drawElementsType(Oo.Material.TriangleFillMode, 0, 6) } return i.setDepthBuffer(!0), i.setAlphaMode(Oo.Engine.ALPHA_DISABLE), !0 }, e.prototype.dispose = function () { var e = this._vertexBuffers[Oo.VertexBuffer.PositionKind]; for (e && (e.dispose(), this._vertexBuffers[Oo.VertexBuffer.PositionKind] = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null); this.lensFlares.length;)this.lensFlares[0].dispose(); var t = this._scene.lensFlareSystems.indexOf(this); this._scene.lensFlareSystems.splice(t, 1) }, e.Parse = function (t, i, r) { var n = i.getLastEntryByID(t.emitterId), o = t.name || "lensFlareSystem#" + t.emitterId, s = new e(o, n, i); s.id = t.id || o, s.borderLimit = t.borderLimit; for (var a = 0; a < t.flares.length; a++) { var l = t.flares[a]; Oo.LensFlare.AddFlare(l.size, l.position, Oo.Color3.FromArray(l.color), l.textureName ? r + l.textureName : "", s) } return s }, e.prototype.serialize = function () { var e = {}; e.id = this.id, e.name = this.name, e.emitterId = this.getEmitter().id, e.borderLimit = this.borderLimit, e.flares = []; for (var t = 0; t < this.lensFlares.length; t++) { var i = this.lensFlares[t]; e.flares.push({ size: i.size, position: i.position, color: i.color.asArray(), textureName: Oo.Tools.GetFilename(i.texture ? i.texture.name : "") }) } return e }, e }(), Oo.LensFlareSystem = Do, function (e) { var t = function () { function e(e, t) { this.type = e, (this.jointData = t).nativeParams = t.nativeParams || {} } return Object.defineProperty(e.prototype, "physicsJoint", { get: function () { return this._physicsJoint }, set: function (e) { this._physicsJoint, this._physicsJoint = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "physicsPlugin", { set: function (e) { this._physicsPlugin = e }, enumerable: !0, configurable: !0 }), e.prototype.executeNativeFunction = function (e) { e(this._physicsPlugin.world, this._physicsJoint) }, e.DistanceJoint = 0, e.HingeJoint = 1, e.BallAndSocketJoint = 2, e.WheelJoint = 3, e.SliderJoint = 4, e.PrismaticJoint = 5, e.UniversalJoint = 6, e.Hinge2Joint = e.WheelJoint, e.PointToPointJoint = 8, e.SpringJoint = 9, e.LockJoint = 10, e }(), i = function (e) { function i(i) { return e.call(this, t.DistanceJoint, i) || this } return T(i, e), i.prototype.updateDistance = function (e, t) { this._physicsPlugin.updateDistanceJoint(this, e, t) }, i }(e.PhysicsJoint = t); e.DistanceJoint = i; var r = function (e) { function t(t, i) { return e.call(this, t, i) || this } return T(t, e), t.prototype.setMotor = function (e, t) { this._physicsPlugin.setMotor(this, e || 0, t) }, t.prototype.setLimit = function (e, t) { this._physicsPlugin.setLimit(this, e, t) }, t }(t), n = function (e) { function i(i) { return e.call(this, t.HingeJoint, i) || this } return T(i, e), i.prototype.setMotor = function (e, t) { this._physicsPlugin.setMotor(this, e || 0, t) }, i.prototype.setLimit = function (e, t) { this._physicsPlugin.setLimit(this, e, t) }, i }(e.MotorEnabledJoint = r); e.HingeJoint = n; var o = function (e) { function i(i) { return e.call(this, t.Hinge2Joint, i) || this } return T(i, e), i.prototype.setMotor = function (e, t, i) { void 0 === i && (i = 0), this._physicsPlugin.setMotor(this, e || 0, t, i) }, i.prototype.setLimit = function (e, t, i) { void 0 === i && (i = 0), this._physicsPlugin.setLimit(this, e, t, i) }, i }(r); e.Hinge2Joint = o }($a || ($a = {})), Io = $a || ($a = {}), wo = function () { function e(e, t, i, r) { void 0 === i && (i = { mass: 0 }); var n = this; this.object = e, this.type = t, this._options = i, this._scene = r, this._bodyUpdateRequired = !1, this._onBeforePhysicsStepCallbacks = new Array, this._onAfterPhysicsStepCallbacks = new Array, this._onPhysicsCollideCallbacks = [], this._deltaPosition = Io.Vector3.Zero(), this._isDisposed = !1, this._tmpQuat = new Io.Quaternion, this._tmpQuat2 = new Io.Quaternion, this.beforeStep = function () { n._physicsEngine && (n.object.translate(n._deltaPosition, -1), n._deltaRotationConjugated && n.object.rotationQuaternion && n.object.rotationQuaternion.multiplyToRef(n._deltaRotationConjugated, n.object.rotationQuaternion), n.object.computeWorldMatrix(!1), n.object.parent && n.object.rotationQuaternion ? (n.getParentsRotation(), n._tmpQuat.multiplyToRef(n.object.rotationQuaternion, n._tmpQuat)) : n._tmpQuat.copyFrom(n.object.rotationQuaternion || new Io.Quaternion), n._options.disableBidirectionalTransformation || n.object.rotationQuaternion && n._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(n, n.object.getAbsolutePivotPoint(), n._tmpQuat), n._onBeforePhysicsStepCallbacks.forEach(function (e) { e(n) })) }, this.afterStep = function () { n._physicsEngine && (n._onAfterPhysicsStepCallbacks.forEach(function (e) { e(n) }), n._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(n), n.object.parent && n.object.rotationQuaternion && (n.getParentsRotation(), n._tmpQuat.conjugateInPlace(), n._tmpQuat.multiplyToRef(n.object.rotationQuaternion, n.object.rotationQuaternion)), n.object.setAbsolutePosition(n.object.position), n._deltaRotation && n.object.rotationQuaternion && n.object.rotationQuaternion.multiplyToRef(n._deltaRotation, n.object.rotationQuaternion), n.object.translate(n._deltaPosition, 1)) }, this.onCollideEvent = null, this.onCollide = function (e) { if ((n._onPhysicsCollideCallbacks.length || n.onCollideEvent) && n._physicsEngine) { var t = n._physicsEngine.getImpostorWithPhysicsBody(e.body); t && (n.onCollideEvent && n.onCollideEvent(n, t), n._onPhysicsCollideCallbacks.filter(function (e) { return -1 !== e.otherImpostors.indexOf(t) }).forEach(function (e) { e.callback(n, t) })) } }, this.object ? (!this._scene && e.getScene && (this._scene = e.getScene()), this._scene && (this._physicsEngine = this._scene.getPhysicsEngine(), this._physicsEngine ? (this.object.rotationQuaternion || (this.object.rotation ? this.object.rotationQuaternion = Io.Quaternion.RotationYawPitchRoll(this.object.rotation.y, this.object.rotation.x, this.object.rotation.z) : this.object.rotationQuaternion = new Io.Quaternion), this._options.mass = void 0 === i.mass ? 0 : i.mass, this._options.friction = void 0 === i.friction ? .2 : i.friction, this._options.restitution = void 0 === i.restitution ? .2 : i.restitution, this._joints = [], !this.object.parent || this._options.ignoreParent ? this._init() : this.object.parent.physicsImpostor && Io.Tools.Warn("You must affect impostors to children before affecting impostor to parent.")) : Io.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))) : Io.Tools.Error("No object was provided. A physics object is obligatory") } return Object.defineProperty(e.prototype, "isDisposed", { get: function () { return this._isDisposed }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "mass", { get: function () { return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getBodyMass(this) : 0 }, set: function (e) { this.setMass(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "friction", { get: function () { return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getBodyFriction(this) : 0 }, set: function (e) { this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setBodyFriction(this, e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "restitution", { get: function () { return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this) : 0 }, set: function (e) { this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this, e) }, enumerable: !0, configurable: !0 }), e.prototype._init = function () { this._physicsEngine && (this._physicsEngine.removeImpostor(this), this.physicsBody = null, this._parent = this._parent || this._getPhysicsParent(), this._isDisposed || this.parent && !this._options.ignoreParent || this._physicsEngine.addImpostor(this)) }, e.prototype._getPhysicsParent = function () { return this.object.parent instanceof Io.AbstractMesh ? this.object.parent.physicsImpostor : null }, e.prototype.isBodyInitRequired = function () { return this._bodyUpdateRequired || !this._physicsBody && !this._parent }, e.prototype.setScalingUpdated = function (e) { this.forceUpdate() }, e.prototype.forceUpdate = function () { this._init(), this.parent && !this._options.ignoreParent && this.parent.forceUpdate() }, Object.defineProperty(e.prototype, "physicsBody", { get: function () { return this._parent && !this._options.ignoreParent ? this._parent.physicsBody : this._physicsBody }, set: function (e) { this._physicsBody && this._physicsEngine && this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this), this._physicsBody = e, this.resetUpdateFlags() }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "parent", { get: function () { return !this._options.ignoreParent && this._parent ? this._parent : null }, set: function (e) { this._parent = e }, enumerable: !0, configurable: !0 }), e.prototype.resetUpdateFlags = function () { this._bodyUpdateRequired = !1 }, e.prototype.getObjectExtendSize = function () { if (this.object.getBoundingInfo) { var t = this.object.rotationQuaternion; this.object.rotationQuaternion = e.IDENTITY_QUATERNION, this.object.computeWorldMatrix && this.object.computeWorldMatrix(!0); var i = this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2); return this.object.rotationQuaternion = t, this.object.computeWorldMatrix && this.object.computeWorldMatrix(!0), i } return e.DEFAULT_OBJECT_SIZE }, e.prototype.getObjectCenter = function () { return this.object.getBoundingInfo ? this.object.getBoundingInfo().boundingBox.centerWorld : this.object.position }, e.prototype.getParam = function (e) { return this._options[e] }, e.prototype.setParam = function (e, t) { this._options[e] = t, this._bodyUpdateRequired = !0 }, e.prototype.setMass = function (e) { this.getParam("mass") !== e && this.setParam("mass", e), this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setBodyMass(this, e) }, e.prototype.getLinearVelocity = function () { return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this) : Io.Vector3.Zero() }, e.prototype.setLinearVelocity = function (e) { this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this, e) }, e.prototype.getAngularVelocity = function () { return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this) : Io.Vector3.Zero() }, e.prototype.setAngularVelocity = function (e) { this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this, e) }, e.prototype.executeNativeFunction = function (e) { this._physicsEngine && e(this._physicsEngine.getPhysicsPlugin().world, this.physicsBody) }, e.prototype.registerBeforePhysicsStep = function (e) { this._onBeforePhysicsStepCallbacks.push(e) }, e.prototype.unregisterBeforePhysicsStep = function (e) { var t = this._onBeforePhysicsStepCallbacks.indexOf(e); -1 < t ? this._onBeforePhysicsStepCallbacks.splice(t, 1) : Io.Tools.Warn("Function to remove was not found") }, e.prototype.registerAfterPhysicsStep = function (e) { this._onAfterPhysicsStepCallbacks.push(e) }, e.prototype.unregisterAfterPhysicsStep = function (e) { var t = this._onAfterPhysicsStepCallbacks.indexOf(e); -1 < t ? this._onAfterPhysicsStepCallbacks.splice(t, 1) : Io.Tools.Warn("Function to remove was not found") }, e.prototype.registerOnPhysicsCollide = function (e, t) { var i = e instanceof Array ? e : [e]; this._onPhysicsCollideCallbacks.push({ callback: t, otherImpostors: i }) }, e.prototype.unregisterOnPhysicsCollide = function (e, t) { var i = e instanceof Array ? e : [e], r = -1; this._onPhysicsCollideCallbacks.some(function (e, n) { if (e.callback === t && e.otherImpostors.length === i.length) { var o = e.otherImpostors.every(function (e) { return -1 < i.indexOf(e) }); return o && (r = n), o } return !1 }) ? this._onPhysicsCollideCallbacks.splice(r, 1) : Io.Tools.Warn("Function to remove was not found") }, e.prototype.getParentsRotation = function () { var e = this.object.parent; for (this._tmpQuat.copyFromFloats(0, 0, 0, 1); e;)e.rotationQuaternion ? this._tmpQuat2.copyFrom(e.rotationQuaternion) : Io.Quaternion.RotationYawPitchRollToRef(e.rotation.y, e.rotation.x, e.rotation.z, this._tmpQuat2), this._tmpQuat.multiplyToRef(this._tmpQuat2, this._tmpQuat), e = e.parent; return this._tmpQuat }, e.prototype.applyForce = function (e, t) { return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().applyForce(this, e, t), this }, e.prototype.applyImpulse = function (e, t) { return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().applyImpulse(this, e, t), this }, e.prototype.createJoint = function (e, t, i) { var r = new Io.PhysicsJoint(t, i); return this.addJoint(e, r), this }, e.prototype.addJoint = function (e, t) { return this._joints.push({ otherImpostor: e, joint: t }), this._physicsEngine && this._physicsEngine.addJoint(this, e, t), this }, e.prototype.sleep = function () { return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().sleepBody(this), this }, e.prototype.wakeUp = function () { return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().wakeUpBody(this), this }, e.prototype.clone = function (t) { return t ? new e(t, this.type, this._options, this._scene) : null }, e.prototype.dispose = function () { var e = this; this._physicsEngine && (this._joints.forEach(function (t) { e._physicsEngine && e._physicsEngine.removeJoint(e, t.otherImpostor, t.joint) }), this._physicsEngine.removeImpostor(this), this.parent && this.parent.forceUpdate(), this._isDisposed = !0) }, e.prototype.setDeltaPosition = function (e) { this._deltaPosition.copyFrom(e) }, e.prototype.setDeltaRotation = function (e) { this._deltaRotation || (this._deltaRotation = new Io.Quaternion), this._deltaRotation.copyFrom(e), this._deltaRotationConjugated = this._deltaRotation.conjugate() }, e.prototype.getBoxSizeToRef = function (e) { return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this, e), this }, e.prototype.getRadius = function () { return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getRadius(this) : 0 }, e.prototype.syncBoneWithImpostor = function (t, i, r, n, o) { var s = e._tmpVecs[0], a = this.object; if (a.rotationQuaternion) if (o) { var l = e._tmpQuat; a.rotationQuaternion.multiplyToRef(o, l), t.setRotationQuaternion(l, Io.Space.WORLD, i) } else t.setRotationQuaternion(a.rotationQuaternion, Io.Space.WORLD, i); s.x = 0, s.y = 0, s.z = 0, r && (s.x = r.x, s.y = r.y, s.z = r.z, t.getDirectionToRef(s, i, s), null == n && (n = r.length()), s.x *= n, s.y *= n, s.z *= n), t.getParent() ? (s.addInPlace(a.getAbsolutePosition()), t.setAbsolutePosition(s, i)) : (i.setAbsolutePosition(a.getAbsolutePosition()), i.position.x -= s.x, i.position.y -= s.y, i.position.z -= s.z) }, e.prototype.syncImpostorWithBone = function (t, i, r, n, o, s) { var a = this.object; if (a.rotationQuaternion) if (o) { var l = e._tmpQuat; t.getRotationQuaternionToRef(Io.Space.WORLD, i, l), l.multiplyToRef(o, a.rotationQuaternion) } else t.getRotationQuaternionToRef(Io.Space.WORLD, i, a.rotationQuaternion); var c = e._tmpVecs[0], h = e._tmpVecs[1]; s || ((s = e._tmpVecs[2]).x = 0, s.y = 1, s.z = 0), t.getDirectionToRef(s, i, h), t.getAbsolutePositionToRef(i, c), null == n && r && (n = r.length()), null != n && (c.x += h.x * n, c.y += h.y * n, c.z += h.z * n), a.setAbsolutePosition(c) }, e.DEFAULT_OBJECT_SIZE = new Io.Vector3(1, 1, 1), e.IDENTITY_QUATERNION = Io.Quaternion.Identity(), e._tmpVecs = [Io.Vector3.Zero(), Io.Vector3.Zero(), Io.Vector3.Zero()], e._tmpQuat = Io.Quaternion.Identity(), e.NoImpostor = 0, e.SphereImpostor = 1, e.BoxImpostor = 2, e.PlaneImpostor = 3, e.MeshImpostor = 4, e.CylinderImpostor = 7, e.ParticleImpostor = 8, e.HeightmapImpostor = 9, e }(), Io.PhysicsImpostor = wo, Lo = $a || ($a = {}), Fo = function () { function e(e, t) { if (void 0 === t && (t = new Lo.CannonJSPlugin), this._physicsPlugin = t, this._impostors = [], this._joints = [], !this._physicsPlugin.isSupported()) throw new Error("Physics Engine " + this._physicsPlugin.name + " cannot be found. Please make sure it is included."); e = e || new Lo.Vector3(0, -9.807, 0), this.setGravity(e), this.setTimeStep() } return e.prototype.setGravity = function (e) { this.gravity = e, this._physicsPlugin.setGravity(this.gravity) }, e.prototype.setTimeStep = function (e) { void 0 === e && (e = 1 / 60), this._physicsPlugin.setTimeStep(e) }, e.prototype.getTimeStep = function () { return this._physicsPlugin.getTimeStep() }, e.prototype.dispose = function () { this._impostors.forEach(function (e) { e.dispose() }), this._physicsPlugin.dispose() }, e.prototype.getPhysicsPluginName = function () { return this._physicsPlugin.name }, e.prototype.addImpostor = function (e) { e.uniqueId = this._impostors.push(e), e.parent || this._physicsPlugin.generatePhysicsBody(e) }, e.prototype.removeImpostor = function (e) { var t = this._impostors.indexOf(e); if (-1 < t) { var i = this._impostors.splice(t, 1); i.length && (i[0].physicsBody = null) } }, e.prototype.addJoint = function (e, t, i) { var r = { mainImpostor: e, connectedImpostor: t, joint: i }; i.physicsPlugin = this._physicsPlugin, this._joints.push(r), this._physicsPlugin.generateJoint(r) }, e.prototype.removeJoint = function (e, t, i) { var r = this._joints.filter(function (r) { return r.connectedImpostor === t && r.joint === i && r.mainImpostor === e }); r.length && this._physicsPlugin.removeJoint(r[0]) }, e.prototype._step = function (e) { var t = this; this._impostors.forEach(function (e) { e.isBodyInitRequired() && t._physicsPlugin.generatePhysicsBody(e) }), .1 < e ? e = .1 : e <= 0 && (e = 1 / 60), this._physicsPlugin.executeStep(e, this._impostors) }, e.prototype.getPhysicsPlugin = function () { return this._physicsPlugin }, e.prototype.getImpostors = function () { return this._impostors }, e.prototype.getImpostorForPhysicsObject = function (e) { for (var t = 0; t < this._impostors.length; ++t)if (this._impostors[t].object === e) return this._impostors[t]; return null }, e.prototype.getImpostorWithPhysicsBody = function (e) { for (var t = 0; t < this._impostors.length; ++t)if (this._impostors[t].physicsBody === e) return this._impostors[t]; return null }, e.Epsilon = .001, e }(), Lo.PhysicsEngine = Fo, function (e) { var t = function () { function t(t) { this._scene = t, this._physicsEngine = this._scene.getPhysicsEngine(), this._physicsEngine || e.Tools.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.") } return t.prototype.applyRadialExplosionImpulse = function (t, r, n, s) { if (void 0 === s && (s = o.Constant), !this._physicsEngine) return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call this method."), null; var a = this._physicsEngine.getImpostors(); if (0 === a.length) return null; var l = new i(this._scene); return a.forEach(function (e) { var i = l.getImpostorForceAndContactPoint(e, t, r, n, s); i && e.applyImpulse(i.force, i.contactPoint) }), l.dispose(!1), l }, t.prototype.applyRadialExplosionForce = function (t, r, n, s) { if (void 0 === s && (s = o.Constant), !this._physicsEngine) return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."), null; var a = this._physicsEngine.getImpostors(); if (0 === a.length) return null; var l = new i(this._scene); return a.forEach(function (e) { var i = l.getImpostorForceAndContactPoint(e, t, r, n, s); i && e.applyForce(i.force, i.contactPoint) }), l.dispose(!1), l }, t.prototype.gravitationalField = function (t, i, n, s) { if (void 0 === s && (s = o.Constant), !this._physicsEngine) return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."), null; if (0 === this._physicsEngine.getImpostors().length) return null; var a = new r(this, this._scene, t, i, n, s); return a.dispose(!1), a }, t.prototype.updraft = function (t, i, r, o, s) { if (void 0 === s && (s = a.Center), !this._physicsEngine) return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."), null; if (0 === this._physicsEngine.getImpostors().length) return null; var l = new n(this._scene, t, i, r, o, s); return l.dispose(!1), l }, t.prototype.vortex = function (t, i, r, n) { if (!this._physicsEngine) return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."), null; if (0 === this._physicsEngine.getImpostors().length) return null; var o = new c(this._scene, t, i, r, n); return o.dispose(!1), o }, t }(); e.PhysicsHelper = t; var i = function () { function t(e) { this._sphereOptions = { segments: 32, diameter: 1 }, this._rays = [], this._dataFetched = !1, this._scene = e } return t.prototype.getData = function () { return this._dataFetched = !0, { sphere: this._sphere, rays: this._rays } }, t.prototype.getImpostorForceAndContactPoint = function (t, i, r, n, s) { if (0 === t.mass) return null; if (!this._intersectsWithSphere(t, i, r)) return null; if ("Mesh" !== t.object.getClassName() && "InstancedMesh" !== t.object.getClassName()) return null; var a = t.getObjectCenter().subtract(i), l = new e.Ray(i, a, r); this._rays.push(l); var c = l.intersectsMesh(t.object).pickedPoint; if (!c) return null; var h = e.Vector3.Distance(i, c); if (r < h) return null; var u = s === o.Constant ? n : n * (1 - h / r); return { force: a.multiplyByFloats(u, u, u), contactPoint: c } }, t.prototype.dispose = function (e) { var t = this; void 0 === e && (e = !0), e ? this._sphere.dispose() : setTimeout(function () { t._dataFetched || t._sphere.dispose() }, 0) }, t.prototype._prepareSphere = function () { this._sphere || (this._sphere = e.MeshBuilder.CreateSphere("radialExplosionEventSphere", this._sphereOptions, this._scene), this._sphere.isVisible = !1) }, t.prototype._intersectsWithSphere = function (t, i, r) { var n = t.object; return this._prepareSphere(), this._sphere.position = i, this._sphere.scaling = new e.Vector3(2 * r, 2 * r, 2 * r), this._sphere._updateBoundingInfo(), this._sphere.computeWorldMatrix(!0), this._sphere.intersectsMesh(n, !0) }, t }(); e.PhysicsRadialExplosionEvent = i; var r = function () { function e(e, t, i, r, n, s) { void 0 === s && (s = o.Constant), this._dataFetched = !1, this._physicsHelper = e, this._scene = t, this._origin = i, this._radius = r, this._strength = n, this._falloff = s, this._tickCallback = this._tick.bind(this) } return e.prototype.getData = function () { return this._dataFetched = !0, { sphere: this._sphere } }, e.prototype.enable = function () { this._tickCallback.call(this), this._scene.registerBeforeRender(this._tickCallback) }, e.prototype.disable = function () { this._scene.unregisterBeforeRender(this._tickCallback) }, e.prototype.dispose = function (e) { var t = this; void 0 === e && (e = !0), e ? this._sphere.dispose() : setTimeout(function () { t._dataFetched || t._sphere.dispose() }, 0) }, e.prototype._tick = function () { if (this._sphere) this._physicsHelper.applyRadialExplosionForce(this._origin, this._radius, -1 * this._strength, this._falloff); else { var e = this._physicsHelper.applyRadialExplosionForce(this._origin, this._radius, -1 * this._strength, this._falloff); e && (this._sphere = e.getData().sphere.clone("radialExplosionEventSphereClone")) } }, e }(); e.PhysicsGravitationalFieldEvent = r; var n = function () { function t(t, i, r, n, o, s) { this._scene = t, this._origin = i, this._radius = r, this._strength = n, this._height = o, this._updraftMode = s, this._originTop = e.Vector3.Zero(), this._originDirection = e.Vector3.Zero(), this._cylinderPosition = e.Vector3.Zero(), this._dataFetched = !1, this._physicsEngine = this._scene.getPhysicsEngine(), this._origin.addToRef(new e.Vector3(0, this._height / 2, 0), this._cylinderPosition), this._origin.addToRef(new e.Vector3(0, this._height, 0), this._originTop), this._updraftMode === a.Perpendicular && (this._originDirection = this._origin.subtract(this._originTop).normalize()), this._tickCallback = this._tick.bind(this) } return t.prototype.getData = function () { return this._dataFetched = !0, { cylinder: this._cylinder } }, t.prototype.enable = function () { this._tickCallback.call(this), this._scene.registerBeforeRender(this._tickCallback) }, t.prototype.disable = function () { this._scene.unregisterBeforeRender(this._tickCallback) }, t.prototype.dispose = function (e) { var t = this; void 0 === e && (e = !0), e ? this._cylinder.dispose() : setTimeout(function () { t._dataFetched || t._cylinder.dispose() }, 0) }, t.prototype.getImpostorForceAndContactPoint = function (e) { if (0 === e.mass) return null; if (!this._intersectsWithCylinder(e)) return null; var t = e.getObjectCenter(); if (this._updraftMode === a.Perpendicular) var i = this._originDirection; else i = t.subtract(this._originTop); var r = -1 * this._strength; return { force: i.multiplyByFloats(r, r, r), contactPoint: t } }, t.prototype._tick = function () { var e = this; this._physicsEngine.getImpostors().forEach(function (t) { var i = e.getImpostorForceAndContactPoint(t); i && t.applyForce(i.force, i.contactPoint) }) }, t.prototype._prepareCylinder = function () { this._cylinder || (this._cylinder = e.MeshBuilder.CreateCylinder("updraftEventCylinder", { height: this._height, diameter: 2 * this._radius }, this._scene), this._cylinder.isVisible = !1) }, t.prototype._intersectsWithCylinder = function (e) { var t = e.object; return this._prepareCylinder(), this._cylinder.position = this._cylinderPosition, this._cylinder.intersectsMesh(t, !0) }, t }(); e.PhysicsUpdraftEvent = n; var o, s, a, l, c = function () { function t(t, i, r, n, o) { this._scene = t, this._origin = i, this._radius = r, this._strength = n, this._height = o, this._originTop = e.Vector3.Zero(), this._centripetalForceThreshold = .7, this._updraftMultiplier = .02, this._cylinderPosition = e.Vector3.Zero(), this._dataFetched = !1, this._physicsEngine = this._scene.getPhysicsEngine(), this._origin.addToRef(new e.Vector3(0, this._height / 2, 0), this._cylinderPosition), this._origin.addToRef(new e.Vector3(0, this._height, 0), this._originTop), this._tickCallback = this._tick.bind(this) } return t.prototype.getData = function () { return this._dataFetched = !0, { cylinder: this._cylinder } }, t.prototype.enable = function () { this._tickCallback.call(this), this._scene.registerBeforeRender(this._tickCallback) }, t.prototype.disable = function () { this._scene.unregisterBeforeRender(this._tickCallback) }, t.prototype.dispose = function (e) { var t = this; void 0 === e && (e = !0), e ? this._cylinder.dispose() : setTimeout(function () { t._dataFetched || t._cylinder.dispose() }, 0) }, t.prototype.getImpostorForceAndContactPoint = function (t) { if (0 === t.mass) return null; if (!this._intersectsWithCylinder(t)) return null; if ("Mesh" !== t.object.getClassName() && "InstancedMesh" !== t.object.getClassName()) return null; var i = t.getObjectCenter(), r = new e.Vector3(this._origin.x, i.y, this._origin.z), n = i.subtract(r), o = new e.Ray(r, n, this._radius).intersectsMesh(t.object), s = o.pickedPoint; if (!s) return null; var a = o.distance / this._radius, l = e.Vector3.Cross(r, i).normalize(), c = s.normalize(); if (a > this._centripetalForceThreshold && (c = c.negate()), a > this._centripetalForceThreshold) var h = c.x * this._strength / 8, u = c.y * this._updraftMultiplier, d = c.z * this._strength / 8; else h = (l.x + c.x) / 2, u = this._originTop.y * this._updraftMultiplier, d = (l.z + c.z) / 2; var f = new e.Vector3(h, u, d); return { force: f = f.multiplyByFloats(this._strength, this._strength, this._strength), contactPoint: i } }, t.prototype._tick = function () { var e = this; this._physicsEngine.getImpostors().forEach(function (t) { var i = e.getImpostorForceAndContactPoint(t); i && t.applyForce(i.force, i.contactPoint) }) }, t.prototype._prepareCylinder = function () { this._cylinder || (this._cylinder = e.MeshBuilder.CreateCylinder("vortexEventCylinder", { height: this._height, diameter: 2 * this._radius }, this._scene), this._cylinder.isVisible = !1) }, t.prototype._intersectsWithCylinder = function (e) { var t = e.object; return this._prepareCylinder(), this._cylinder.position = this._cylinderPosition, this._cylinder.intersectsMesh(t, !0) }, t }(); e.PhysicsVortexEvent = c, (s = o = e.PhysicsRadialImpulseFalloff || (e.PhysicsRadialImpulseFalloff = {}))[s.Constant = 0] = "Constant", s[s.Linear = 1] = "Linear", (l = a = e.PhysicsUpdraftMode || (e.PhysicsUpdraftMode = {}))[l.Center = 0] = "Center", l[l.Perpendicular = 1] = "Perpendicular" }($a || ($a = {})), Bo = $a || ($a = {}), No = function () { function t(t, i) { void 0 === t && (t = !0), void 0 === i && (i = 10), this._useDeltaForWorldStep = t, this.name = "CannonJSPlugin", this._physicsMaterials = new Array, this._fixedTimeStep = 1 / 60, this.BJSCANNON = e, this._minus90X = new Bo.Quaternion(-.7071067811865475, 0, 0, .7071067811865475), this._plus90X = new Bo.Quaternion(.7071067811865475, 0, 0, .7071067811865475), this._tmpPosition = Bo.Vector3.Zero(), this._tmpDeltaPosition = Bo.Vector3.Zero(), this._tmpUnityRotation = new Bo.Quaternion, this.isSupported() ? (this._extendNamespace(), this.world = new this.BJSCANNON.World, this.world.broadphase = new this.BJSCANNON.NaiveBroadphase, this.world.solver.iterations = i) : Bo.Tools.Error("CannonJS is not available. Please make sure you included the js file.") } return t.prototype.setGravity = function (e) { this.world.gravity.copy(e) }, t.prototype.setTimeStep = function (e) { this._fixedTimeStep = e }, t.prototype.getTimeStep = function () { return this._fixedTimeStep }, t.prototype.executeStep = function (e, t) { this.world.step(this._fixedTimeStep, this._useDeltaForWorldStep ? e : 0, 3) }, t.prototype.applyImpulse = function (e, t, i) { var r = new this.BJSCANNON.Vec3(i.x, i.y, i.z), n = new this.BJSCANNON.Vec3(t.x, t.y, t.z); e.physicsBody.applyImpulse(n, r) }, t.prototype.applyForce = function (e, t, i) { var r = new this.BJSCANNON.Vec3(i.x, i.y, i.z), n = new this.BJSCANNON.Vec3(t.x, t.y, t.z); e.physicsBody.applyForce(n, r) }, t.prototype.generatePhysicsBody = function (e) { if (e.parent) e.physicsBody && (this.removePhysicsBody(e), e.forceUpdate()); else { if (e.isBodyInitRequired()) { var t = this._createShape(e), i = e.physicsBody; i && this.removePhysicsBody(e); var r = this._addMaterial("mat-" + e.uniqueId, e.getParam("friction"), e.getParam("restitution")), n = { mass: e.getParam("mass"), material: r }, o = e.getParam("nativeOptions"); for (var s in o) o.hasOwnProperty(s) && (n[s] = o[s]); e.physicsBody = new this.BJSCANNON.Body(n), e.physicsBody.addEventListener("collide", e.onCollide), this.world.addEventListener("preStep", e.beforeStep), this.world.addEventListener("postStep", e.afterStep), e.physicsBody.addShape(t), this.world.add(e.physicsBody), i && ["force", "torque", "velocity", "angularVelocity"].forEach(function (t) { e.physicsBody[t].copy(i[t]) }), this._processChildMeshes(e) } this._updatePhysicsBodyTransformation(e) } }, t.prototype._processChildMeshes = function (e) { var t = this, i = e.object.getChildMeshes ? e.object.getChildMeshes(!0) : [], r = e.object.rotationQuaternion; if (i.length) { var n = function (i, o) { if (r && o.rotationQuaternion) { var s = o.getPhysicsImpostor(); if (s && s.parent !== e) { var a = o.getAbsolutePosition().subtract(e.object.getAbsolutePosition()), l = o.rotationQuaternion.multiply(Bo.Quaternion.Inverse(r)); s.physicsBody && (t.removePhysicsBody(s), s.physicsBody = null), s.parent = e, s.resetUpdateFlags(), e.physicsBody.addShape(t._createShape(s), new t.BJSCANNON.Vec3(a.x, a.y, a.z), new t.BJSCANNON.Quaternion(l.x, l.y, l.z, l.w)), e.physicsBody.mass += s.getParam("mass") } r.multiplyInPlace(o.rotationQuaternion), o.getChildMeshes(!0).filter(function (e) { return !!e.physicsImpostor }).forEach(n.bind(t, o.getAbsolutePosition())) } }; i.filter(function (e) { return !!e.physicsImpostor }).forEach(n.bind(this, e.object.getAbsolutePosition())) } }, t.prototype.removePhysicsBody = function (e) { e.physicsBody.removeEventListener("collide", e.onCollide), this.world.removeEventListener("preStep", e.beforeStep), this.world.removeEventListener("postStep", e.afterStep), this.world.remove(e.physicsBody) }, t.prototype.generateJoint = function (e) { var t = e.mainImpostor.physicsBody, i = e.connectedImpostor.physicsBody; if (t && i) { var r, n = e.joint.jointData, o = { pivotA: n.mainPivot ? (new this.BJSCANNON.Vec3).copy(n.mainPivot) : null, pivotB: n.connectedPivot ? (new this.BJSCANNON.Vec3).copy(n.connectedPivot) : null, axisA: n.mainAxis ? (new this.BJSCANNON.Vec3).copy(n.mainAxis) : null, axisB: n.connectedAxis ? (new this.BJSCANNON.Vec3).copy(n.connectedAxis) : null, maxForce: n.nativeParams.maxForce, collideConnected: !!n.collision }; switch (e.joint.type) { case Bo.PhysicsJoint.HingeJoint: case Bo.PhysicsJoint.Hinge2Joint: r = new this.BJSCANNON.HingeConstraint(t, i, o); break; case Bo.PhysicsJoint.DistanceJoint: r = new this.BJSCANNON.DistanceConstraint(t, i, n.maxDistance || 2); break; case Bo.PhysicsJoint.SpringJoint: var s = n; r = new this.BJSCANNON.Spring(t, i, { restLength: s.length, stiffness: s.stiffness, damping: s.damping, localAnchorA: o.pivotA, localAnchorB: o.pivotB }); break; case Bo.PhysicsJoint.LockJoint: r = new this.BJSCANNON.LockConstraint(t, i, o); break; case Bo.PhysicsJoint.PointToPointJoint: case Bo.PhysicsJoint.BallAndSocketJoint: default: r = new this.BJSCANNON.PointToPointConstraint(t, o.pivotA, i, o.pivotA, o.maxForce) }r.collideConnected = !!n.collision, e.joint.physicsJoint = r, e.joint.type !== Bo.PhysicsJoint.SpringJoint ? this.world.addConstraint(r) : (e.joint.jointData.forceApplicationCallback = e.joint.jointData.forceApplicationCallback || function () { r.applyForce() }, e.mainImpostor.registerAfterPhysicsStep(e.joint.jointData.forceApplicationCallback)) } }, t.prototype.removeJoint = function (e) { e.joint.type !== Bo.PhysicsJoint.SpringJoint ? this.world.removeConstraint(e.joint.physicsJoint) : e.mainImpostor.unregisterAfterPhysicsStep(e.joint.jointData.forceApplicationCallback) }, t.prototype._addMaterial = function (e, t, i) { var r, n; for (r = 0; r < this._physicsMaterials.length; r++)if ((n = this._physicsMaterials[r]).friction === t && n.restitution === i) return n; var o = new this.BJSCANNON.Material(e); return o.friction = t, o.restitution = i, this._physicsMaterials.push(o), o }, t.prototype._checkWithEpsilon = function (e) { return e < Bo.PhysicsEngine.Epsilon ? Bo.PhysicsEngine.Epsilon : e }, t.prototype._createShape = function (e) { var t, i = e.object, r = e.getObjectExtendSize(); switch (e.type) { case Bo.PhysicsImpostor.SphereImpostor: var n = r.x, o = r.y, s = r.z; t = new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(n), this._checkWithEpsilon(o), this._checkWithEpsilon(s)) / 2); break; case Bo.PhysicsImpostor.CylinderImpostor: t = new this.BJSCANNON.Cylinder(this._checkWithEpsilon(r.x) / 2, this._checkWithEpsilon(r.x) / 2, this._checkWithEpsilon(r.y), 16); break; case Bo.PhysicsImpostor.BoxImpostor: var a = r.scale(.5); t = new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(a.x), this._checkWithEpsilon(a.y), this._checkWithEpsilon(a.z))); break; case Bo.PhysicsImpostor.PlaneImpostor: Bo.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"), t = new this.BJSCANNON.Plane; break; case Bo.PhysicsImpostor.MeshImpostor: var l = i.getVerticesData ? i.getVerticesData(Bo.VertexBuffer.PositionKind) : [], c = i.getIndices ? i.getIndices() : []; if (!l) return; var h = i.position.clone(), u = i.rotation && i.rotation.clone(), d = i.rotationQuaternion && i.rotationQuaternion.clone(); i.position.copyFromFloats(0, 0, 0), i.rotation && i.rotation.copyFromFloats(0, 0, 0), i.rotationQuaternion && i.rotationQuaternion.copyFrom(e.getParentsRotation()), i.rotationQuaternion && i.parent && i.rotationQuaternion.conjugateInPlace(); var f, p = i.computeWorldMatrix(!0), _ = new Array; for (f = 0; f < l.length; f += 3)Bo.Vector3.TransformCoordinates(Bo.Vector3.FromArray(l, f), p).toArray(_, f); Bo.Tools.Warn("MeshImpostor only collides against spheres."), t = new this.BJSCANNON.Trimesh(_, c), i.position.copyFrom(h), u && i.rotation && i.rotation.copyFrom(u), d && i.rotationQuaternion && i.rotationQuaternion.copyFrom(d); break; case Bo.PhysicsImpostor.HeightmapImpostor: var m = i.position.clone(), g = i.rotation && i.rotation.clone(), v = i.rotationQuaternion && i.rotationQuaternion.clone(); i.position.copyFromFloats(0, 0, 0), i.rotation && i.rotation.copyFromFloats(0, 0, 0), i.rotationQuaternion && i.rotationQuaternion.copyFrom(e.getParentsRotation()), i.rotationQuaternion && i.parent && i.rotationQuaternion.conjugateInPlace(), i.rotationQuaternion && i.rotationQuaternion.multiplyInPlace(this._minus90X), t = this._createHeightmap(i), i.position.copyFrom(m), g && i.rotation && i.rotation.copyFrom(g), v && i.rotationQuaternion && i.rotationQuaternion.copyFrom(v), i.computeWorldMatrix(!0); break; case Bo.PhysicsImpostor.ParticleImpostor: t = new this.BJSCANNON.Particle }return t }, t.prototype._createHeightmap = function (e, t) { var i, r = e.getVerticesData(Bo.VertexBuffer.PositionKind), n = e.computeWorldMatrix(!0), o = new Array; for (i = 0; i < r.length; i += 3)Bo.Vector3.TransformCoordinates(Bo.Vector3.FromArray(r, i), n).toArray(o, i); r = o; for (var s = new Array, a = t || ~~(Math.sqrt(r.length / 3) - 1), l = e.getBoundingInfo(), c = Math.min(l.boundingBox.extendSizeWorld.x, l.boundingBox.extendSizeWorld.y), h = l.boundingBox.extendSizeWorld.z, u = 2 * c / a, d = 0; d < r.length; d += 3) { var f = Math.round(r[d + 0] / u + a / 2), p = Math.round(-1 * (r[d + 1] / u - a / 2)), _ = -r[d + 2] + h; s[f] || (s[f] = []), s[f][p] || (s[f][p] = _), s[f][p] = Math.max(_, s[f][p]) } for (f = 0; f <= a; ++f) { if (!s[f]) { for (var m = 1; !s[(f + m) % a];)m++; s[f] = s[(f + m) % a].slice() } for (p = 0; p <= a; ++p)if (!s[f][p]) { var g; for (m = 1; void 0 === g;)g = s[f][(p + m++) % a]; s[f][p] = g } } var v = new this.BJSCANNON.Heightfield(s, { elementSize: u }); return v.minY = h, v }, t.prototype._updatePhysicsBodyTransformation = function (e) { var t = e.object; if (t.computeWorldMatrix && t.computeWorldMatrix(!0), t.getBoundingInfo()) { var i = e.getObjectCenter(); this._tmpDeltaPosition.copyFrom(t.getAbsolutePivotPoint().subtract(i)), this._tmpDeltaPosition.divideInPlace(e.object.scaling), this._tmpPosition.copyFrom(i); var r = t.rotationQuaternion; if (r) { if (e.type !== Bo.PhysicsImpostor.PlaneImpostor && e.type !== Bo.PhysicsImpostor.HeightmapImpostor && e.type !== Bo.PhysicsImpostor.CylinderImpostor || (r = r.multiply(this._minus90X), e.setDeltaRotation(this._plus90X)), e.type === Bo.PhysicsImpostor.HeightmapImpostor) { var n = t, o = n.getBoundingInfo(), s = n.rotationQuaternion; n.rotationQuaternion = this._tmpUnityRotation, n.computeWorldMatrix(!0); var a = i.clone(), l = n.getPivotMatrix() || Bo.Matrix.Translation(0, 0, 0), c = Bo.Matrix.Translation(o.boundingBox.extendSizeWorld.x, 0, -o.boundingBox.extendSizeWorld.z); n.setPreTransformMatrix(c), n.computeWorldMatrix(!0); var h = o.boundingBox.centerWorld.subtract(i).subtract(n.position).negate(); this._tmpPosition.copyFromFloats(h.x, h.y - o.boundingBox.extendSizeWorld.y, h.z), this._tmpDeltaPosition.copyFrom(o.boundingBox.centerWorld.subtract(a)), this._tmpDeltaPosition.y += o.boundingBox.extendSizeWorld.y, n.rotationQuaternion = s, n.setPreTransformMatrix(l), n.computeWorldMatrix(!0) } else e.type === Bo.PhysicsImpostor.MeshImpostor && this._tmpDeltaPosition.copyFromFloats(0, 0, 0); e.setDeltaPosition(this._tmpDeltaPosition), e.physicsBody.position.copy(this._tmpPosition), e.physicsBody.quaternion.copy(r) } } }, t.prototype.setTransformationFromPhysicsBody = function (e) { e.object.position.copyFrom(e.physicsBody.position), e.object.rotationQuaternion && e.object.rotationQuaternion.copyFrom(e.physicsBody.quaternion) }, t.prototype.setPhysicsBodyTransformation = function (e, t, i) { e.physicsBody.position.copy(t), e.physicsBody.quaternion.copy(i) }, t.prototype.isSupported = function () { return void 0 !== this.BJSCANNON }, t.prototype.setLinearVelocity = function (e, t) { e.physicsBody.velocity.copy(t) }, t.prototype.setAngularVelocity = function (e, t) { e.physicsBody.angularVelocity.copy(t) }, t.prototype.getLinearVelocity = function (e) { var t = e.physicsBody.velocity; return t ? new Bo.Vector3(t.x, t.y, t.z) : null }, t.prototype.getAngularVelocity = function (e) { var t = e.physicsBody.angularVelocity; return t ? new Bo.Vector3(t.x, t.y, t.z) : null }, t.prototype.setBodyMass = function (e, t) { e.physicsBody.mass = t, e.physicsBody.updateMassProperties() }, t.prototype.getBodyMass = function (e) { return e.physicsBody.mass }, t.prototype.getBodyFriction = function (e) { return e.physicsBody.material.friction }, t.prototype.setBodyFriction = function (e, t) { e.physicsBody.material.friction = t }, t.prototype.getBodyRestitution = function (e) { return e.physicsBody.material.restitution }, t.prototype.setBodyRestitution = function (e, t) { e.physicsBody.material.restitution = t }, t.prototype.sleepBody = function (e) { e.physicsBody.sleep() }, t.prototype.wakeUpBody = function (e) { e.physicsBody.wakeUp() }, t.prototype.updateDistanceJoint = function (e, t, i) { e.physicsJoint.distance = t }, t.prototype.setMotor = function (e, t, i, r) { r || (e.physicsJoint.enableMotor(), e.physicsJoint.setMotorSpeed(t), i && this.setLimit(e, i)) }, t.prototype.setLimit = function (e, t, i) { e.physicsJoint.motorEquation.maxForce = t, e.physicsJoint.motorEquation.minForce = void 0 === i ? -t : i }, t.prototype.syncMeshWithImpostor = function (e, t) { var i = t.physicsBody; e.position.x = i.position.x, e.position.y = i.position.y, e.position.z = i.position.z, e.rotationQuaternion && (e.rotationQuaternion.x = i.quaternion.x, e.rotationQuaternion.y = i.quaternion.y, e.rotationQuaternion.z = i.quaternion.z, e.rotationQuaternion.w = i.quaternion.w) }, t.prototype.getRadius = function (e) { return e.physicsBody.shapes[0].boundingSphereRadius }, t.prototype.getBoxSizeToRef = function (e, t) { var i = e.physicsBody.shapes[0]; t.x = 2 * i.halfExtents.x, t.y = 2 * i.halfExtents.y, t.z = 2 * i.halfExtents.z }, t.prototype.dispose = function () { }, t.prototype._extendNamespace = function () { var e = new this.BJSCANNON.Vec3, t = this.BJSCANNON; this.BJSCANNON.World.prototype.step = function (i, r, n) { if (n = n || 10, 0 === (r = r || 0)) this.internalStep(i), this.time += i; else { var o = Math.floor((this.time + r) / i) - Math.floor(this.time / i); o = Math.min(o, n) || 1; for (var s = performance.now(), a = 0; a !== o && (this.internalStep(i), !(performance.now() - s > 1e3 * i)); a++); this.time += r; for (var l = this.time % i / i, c = e, h = this.bodies, u = 0; u !== h.length; u++) { var d = h[u]; d.type !== t.Body.STATIC && d.sleepState !== t.Body.SLEEPING ? (d.position.vsub(d.previousPosition, c), c.scale(l, c), d.position.vadd(c, d.interpolatedPosition)) : (d.interpolatedPosition.copy(d.position), d.interpolatedQuaternion.copy(d.quaternion)) } } } }, t }(), Bo.CannonJSPlugin = No, Vo = $a || ($a = {}), Uo = function () { function e(e) { this.name = "OimoJSPlugin", this._tmpImpostorsArray = [], this._tmpPositionVector = Vo.Vector3.Zero(), this.BJSOIMO = i, this.world = new this.BJSOIMO.World({ iterations: e }), this.world.clear() } return e.prototype.setGravity = function (e) { this.world.gravity.copy(e) }, e.prototype.setTimeStep = function (e) { this.world.timeStep = e }, e.prototype.getTimeStep = function () { return this.world.timeStep }, e.prototype.executeStep = function (e, t) { var i = this; t.forEach(function (e) { e.beforeStep() }), this.world.step(), t.forEach(function (e) { e.afterStep(), i._tmpImpostorsArray[e.uniqueId] = e }); for (var r = this.world.contacts; null !== r;)if (!r.touching || r.body1.sleeping || r.body2.sleeping) { var n = this._tmpImpostorsArray[+r.body1.name], o = this._tmpImpostorsArray[+r.body2.name]; n && o && (n.onCollide({ body: o.physicsBody }), o.onCollide({ body: n.physicsBody })), r = r.next } else r = r.next }, e.prototype.applyImpulse = function (e, t, i) { var r = e.physicsBody.mass; e.physicsBody.applyImpulse(i.scale(this.world.invScale), t.scale(this.world.invScale * r)) }, e.prototype.applyForce = function (e, t, i) { Vo.Tools.Warn("Oimo doesn't support applying force. Using impule instead."), this.applyImpulse(e, t, i) }, e.prototype.generatePhysicsBody = function (e) { var t = this; if (e.parent) e.physicsBody && (this.removePhysicsBody(e), e.forceUpdate()); else { if (e.isBodyInitRequired()) { var i = { name: e.uniqueId, config: [e.getParam("mass") || 1, e.getParam("friction"), e.getParam("restitution")], size: [], type: [], pos: [], posShape: [], rot: [], rotShape: [], move: 0 !== e.getParam("mass"), density: e.getParam("mass"), friction: e.getParam("friction"), restitution: e.getParam("restitution"), world: this.world }, r = [e]; (s = e.object).getChildMeshes && s.getChildMeshes().forEach(function (e) { e.physicsImpostor && r.push(e.physicsImpostor) }); var n = function (e) { return Math.max(e, Vo.PhysicsEngine.Epsilon) }, o = new Vo.Quaternion; r.forEach(function (r) { if (r.object.rotationQuaternion) { var s = r.object.rotationQuaternion; o = s.clone(); var a = s.toEulerAngles(), l = r.getObjectExtendSize(), c = 57.29577951308232; if (r === e) { var h = e.getObjectCenter(); e.object.getAbsolutePivotPoint().subtractToRef(h, t._tmpPositionVector), t._tmpPositionVector.divideInPlace(e.object.scaling), i.pos.push(h.x), i.pos.push(h.y), i.pos.push(h.z), i.posShape.push(0, 0, 0), i.rot.push(0), i.rot.push(0), i.rot.push(0), i.rotShape.push(0, 0, 0) } else { var u = r.object.getAbsolutePosition().subtract(e.object.getAbsolutePosition()); i.posShape.push(u.x), i.posShape.push(u.y), i.posShape.push(u.z), i.pos.push(0, 0, 0), i.rot.push(0), i.rot.push(0), i.rot.push(0), i.rotShape.push(a.x * c), i.rotShape.push(a.y * c), i.rotShape.push(a.z * c) } switch (r.type) { case Vo.PhysicsImpostor.ParticleImpostor: Vo.Tools.Warn("No Particle support in OIMO.js. using SphereImpostor instead"); case Vo.PhysicsImpostor.SphereImpostor: var d = l.x, f = l.y, p = l.z, _ = Math.max(n(d), n(f), n(p)) / 2; i.type.push("sphere"), i.size.push(_), i.size.push(_), i.size.push(_); break; case Vo.PhysicsImpostor.CylinderImpostor: var m = n(l.x) / 2, g = n(l.y); i.type.push("cylinder"), i.size.push(m), i.size.push(g), i.size.push(g); break; case Vo.PhysicsImpostor.PlaneImpostor: case Vo.PhysicsImpostor.BoxImpostor: default: m = n(l.x), g = n(l.y); var v = n(l.z); i.type.push("box"), i.size.push(m), i.size.push(g), i.size.push(v) }r.object.rotationQuaternion = s } }), e.physicsBody = this.world.add(i), e.physicsBody.resetQuaternion(o), e.physicsBody.updatePosition(0) } else this._tmpPositionVector.copyFromFloats(0, 0, 0); var s; e.setDeltaPosition(this._tmpPositionVector) } }, e.prototype.removePhysicsBody = function (e) { this.world.removeRigidBody(e.physicsBody) }, e.prototype.generateJoint = function (e) { var t = e.mainImpostor.physicsBody, i = e.connectedImpostor.physicsBody; if (t && i) { var r, n = e.joint.jointData, o = n.nativeParams || {}, s = { body1: t, body2: i, axe1: o.axe1 || (n.mainAxis ? n.mainAxis.asArray() : null), axe2: o.axe2 || (n.connectedAxis ? n.connectedAxis.asArray() : null), pos1: o.pos1 || (n.mainPivot ? n.mainPivot.asArray() : null), pos2: o.pos2 || (n.connectedPivot ? n.connectedPivot.asArray() : null), min: o.min, max: o.max, collision: o.collision || n.collision, spring: o.spring, world: this.world }; switch (e.joint.type) { case Vo.PhysicsJoint.BallAndSocketJoint: r = "jointBall"; break; case Vo.PhysicsJoint.SpringJoint: Vo.Tools.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead"); var a = n; s.min = a.length || s.min, s.max = Math.max(s.min, s.max); case Vo.PhysicsJoint.DistanceJoint: r = "jointDistance", s.max = n.maxDistance; break; case Vo.PhysicsJoint.PrismaticJoint: r = "jointPrisme"; break; case Vo.PhysicsJoint.SliderJoint: r = "jointSlide"; break; case Vo.PhysicsJoint.WheelJoint: r = "jointWheel"; break; case Vo.PhysicsJoint.HingeJoint: default: r = "jointHinge" }s.type = r, e.joint.physicsJoint = this.world.add(s) } }, e.prototype.removeJoint = function (e) { try { this.world.removeJoint(e.joint.physicsJoint) } catch (e) { Vo.Tools.Warn(e) } }, e.prototype.isSupported = function () { return void 0 !== this.BJSOIMO }, e.prototype.setTransformationFromPhysicsBody = function (e) { e.physicsBody.sleeping || (e.object.position.copyFrom(e.physicsBody.getPosition()), e.object.rotationQuaternion && e.object.rotationQuaternion.copyFrom(e.physicsBody.getQuaternion())) }, e.prototype.setPhysicsBodyTransformation = function (e, t, i) { var r = e.physicsBody; r.position.copy(t), r.orientation.copy(i), r.syncShapes(), r.awake() }, e.prototype.setLinearVelocity = function (e, t) { e.physicsBody.linearVelocity.copy(t) }, e.prototype.setAngularVelocity = function (e, t) { e.physicsBody.angularVelocity.copy(t) }, e.prototype.getLinearVelocity = function (e) { var t = e.physicsBody.linearVelocity; return t ? new Vo.Vector3(t.x, t.y, t.z) : null }, e.prototype.getAngularVelocity = function (e) { var t = e.physicsBody.angularVelocity; return t ? new Vo.Vector3(t.x, t.y, t.z) : null }, e.prototype.setBodyMass = function (e, t) { var i = 0 === t; e.physicsBody.shapes.density = i ? 1 : t, e.physicsBody.setupMass(i ? 2 : 1) }, e.prototype.getBodyMass = function (e) { return e.physicsBody.shapes.density }, e.prototype.getBodyFriction = function (e) { return e.physicsBody.shapes.friction }, e.prototype.setBodyFriction = function (e, t) { e.physicsBody.shapes.friction = t }, e.prototype.getBodyRestitution = function (e) { return e.physicsBody.shapes.restitution }, e.prototype.setBodyRestitution = function (e, t) { e.physicsBody.shapes.restitution = t }, e.prototype.sleepBody = function (e) { e.physicsBody.sleep() }, e.prototype.wakeUpBody = function (e) { e.physicsBody.awake() }, e.prototype.updateDistanceJoint = function (e, t, i) { e.physicsJoint.limitMotor.upperLimit = t, void 0 !== i && (e.physicsJoint.limitMotor.lowerLimit = i) }, e.prototype.setMotor = function (e, t, i, r) { var n = r ? e.physicsJoint.rotationalLimitMotor2 : e.physicsJoint.rotationalLimitMotor1 || e.physicsJoint.rotationalLimitMotor || e.physicsJoint.limitMotor; n && n.setMotor(t, i) }, e.prototype.setLimit = function (e, t, i, r) { var n = r ? e.physicsJoint.rotationalLimitMotor2 : e.physicsJoint.rotationalLimitMotor1 || e.physicsJoint.rotationalLimitMotor || e.physicsJoint.limitMotor; n && n.setLimit(t, void 0 === i ? -t : i) }, e.prototype.syncMeshWithImpostor = function (e, t) { var i = t.physicsBody; e.position.x = i.position.x, e.position.y = i.position.y, e.position.z = i.position.z, e.rotationQuaternion && (e.rotationQuaternion.x = i.orientation.x, e.rotationQuaternion.y = i.orientation.y, e.rotationQuaternion.z = i.orientation.z, e.rotationQuaternion.w = i.orientation.s) }, e.prototype.getRadius = function (e) { return e.physicsBody.shapes.radius }, e.prototype.getBoxSizeToRef = function (e, t) { var i = e.physicsBody.shapes; t.x = 2 * i.halfWidth, t.y = 2 * i.halfHeight, t.z = 2 * i.halfDepth }, e.prototype.dispose = function () { this.world.clear() }, e }(), Vo.OimoJSPlugin = Uo, function (e) { e.Scene.prototype.getPhysicsEngine = function () { return this._physicsEngine }, e.Scene.prototype.enablePhysics = function (i, r) { if (void 0 === i && (i = null), this._physicsEngine) return !0; var n = this._getComponent(e.SceneComponentConstants.NAME_PHYSICSENGINE); n || (n = new t(this), this._addComponent(n)); try { return this._physicsEngine = new e.PhysicsEngine(i, r), !0 } catch (i) { return e.Tools.Error(i.message), !1 } }, e.Scene.prototype.disablePhysicsEngine = function () { this._physicsEngine && (this._physicsEngine.dispose(), this._physicsEngine = null) }, e.Scene.prototype.isPhysicsEnabled = function () { return void 0 !== this._physicsEngine }, e.Scene.prototype.deleteCompoundImpostor = function (e) { var t = e.parts[0].mesh; t.physicsImpostor && (t.physicsImpostor.dispose(), t.physicsImpostor = null) }, e.Scene.prototype._advancePhysicsEngineStep = function (e) { this._physicsEngine && (this.onBeforePhysicsObservable.notifyObservers(this), this._physicsEngine._step(e / 1e3), this.onAfterPhysicsObservable.notifyObservers(this)) }, Object.defineProperty(e.AbstractMesh.prototype, "physicsImpostor", { get: function () { return this._physicsImpostor }, set: function (e) { var t = this; this._physicsImpostor !== e && (this._disposePhysicsObserver && this.onDisposeObservable.remove(this._disposePhysicsObserver), (this._physicsImpostor = e) && (this._disposePhysicsObserver = this.onDisposeObservable.add(function () { t.physicsImpostor && (t.physicsImpostor.dispose(), t.physicsImpostor = null) }))) }, enumerable: !0, configurable: !0 }), e.AbstractMesh.prototype.getPhysicsImpostor = function () { return this.physicsImpostor }, e.AbstractMesh.prototype.applyImpulse = function (e, t) { return this.physicsImpostor && this.physicsImpostor.applyImpulse(e, t), this }, e.AbstractMesh.prototype.setPhysicsLinkWith = function (t, i, r, n) { return this.physicsImpostor && t.physicsImpostor && this.physicsImpostor.createJoint(t.physicsImpostor, e.PhysicsJoint.HingeJoint, { mainPivot: i, connectedPivot: r, nativeParams: n }), this }; var t = function () { function t(t) { var i = this; this.name = e.SceneComponentConstants.NAME_PHYSICSENGINE, this.scene = t, this.scene.onBeforePhysicsObservable = new e.Observable, this.scene.onAfterPhysicsObservable = new e.Observable, this.scene.getDeterministicFrameTime = function () { return i.scene._physicsEngine ? 1e3 * i.scene._physicsEngine.getTimeStep() : 1e3 / 60 } } return t.prototype.register = function () { }, t.prototype.rebuild = function () { }, t.prototype.dispose = function () { this.scene.onBeforePhysicsObservable.clear(), this.scene.onAfterPhysicsObservable.clear(), this.scene._physicsEngine && this.scene.disablePhysicsEngine() }, t }(); e.PhysicsEngineSceneComponent = t }($a || ($a = {})), function (e) { function t(e) { return e.charCodeAt(0) + (e.charCodeAt(1) << 8) + (e.charCodeAt(2) << 16) + (e.charCodeAt(3) << 24) } var i = t("DXT1"), r = t("DXT3"), n = t("DXT5"), o = t("DX10"), s = function () { function t() { } return t.GetDDSInfo = function (t) { var s = new Int32Array(t, 0, 31), a = new Int32Array(t, 0, 35), l = 1; 131072 & s[2] && (l = Math.max(1, s[7])); var c = s[21], h = c === o ? a[32] : 0, u = e.Engine.TEXTURETYPE_UNSIGNED_INT; switch (c) { case 113: u = e.Engine.TEXTURETYPE_HALF_FLOAT; break; case 116: u = e.Engine.TEXTURETYPE_FLOAT; break; case o: if (10 === h) { u = e.Engine.TEXTURETYPE_HALF_FLOAT; break } }return { width: s[4], height: s[3], mipmapCount: l, isFourCC: 4 == (4 & s[20]), isRGB: 64 == (64 & s[20]), isLuminance: 131072 == (131072 & s[20]), isCube: 512 == (512 & s[28]), isCompressed: c === i || c === r || c === n, dxgiFormat: h, textureType: u } }, t._ToHalfFloat = function (e) { t._FloatView || (t._FloatView = new Float32Array(1), t._Int32View = new Int32Array(t._FloatView.buffer)), t._FloatView[0] = e; var i = t._Int32View[0], r = i >> 16 & 32768, n = i >> 12 & 2047, o = i >> 23 & 255; return o < 103 ? r : 142 < o ? (r |= 31744, r |= (255 == o ? 0 : 1) && 8388607 & i) : o < 113 ? r |= ((n |= 2048) >> 114 - o) + (n >> 113 - o & 1) : (r |= o - 112 << 10 | n >> 1, r += 1 & n) }, t._FromHalfFloat = function (e) { var t = (32768 & e) >> 15, i = (31744 & e) >> 10, r = 1023 & e; return 0 === i ? (t ? -1 : 1) * Math.pow(2, -14) * (r / Math.pow(2, 10)) : 31 == i ? r ? NaN : 1 / 0 * (t ? -1 : 1) : (t ? -1 : 1) * Math.pow(2, i - 15) * (1 + r / Math.pow(2, 10)) }, t._GetHalfFloatAsFloatRGBAArrayBuffer = function (e, i, r, n, o, s) { for (var a = new Float32Array(n), l = new Uint16Array(o, r), c = 0, h = 0; h < i; h++)for (var u = 0; u < e; u++) { var d = 4 * (u + h * e); a[c] = t._FromHalfFloat(l[d]), a[c + 1] = t._FromHalfFloat(l[d + 1]), a[c + 2] = t._FromHalfFloat(l[d + 2]), a[c + 3] = t.StoreLODInAlphaChannel ? s : t._FromHalfFloat(l[d + 3]), c += 4 } return a }, t._GetHalfFloatRGBAArrayBuffer = function (e, i, r, n, o, s) { if (t.StoreLODInAlphaChannel) { for (var a = new Uint16Array(n), l = new Uint16Array(o, r), c = 0, h = 0; h < i; h++)for (var u = 0; u < e; u++) { var d = 4 * (u + h * e); a[c] = l[d], a[c + 1] = l[d + 1], a[c + 2] = l[d + 2], a[c + 3] = t._ToHalfFloat(s), c += 4 } return a } return new Uint16Array(o, r, n) }, t._GetFloatRGBAArrayBuffer = function (e, i, r, n, o, s) { if (t.StoreLODInAlphaChannel) { for (var a = new Float32Array(n), l = new Float32Array(o, r), c = 0, h = 0; h < i; h++)for (var u = 0; u < e; u++) { var d = 4 * (u + h * e); a[c] = l[d], a[c + 1] = l[d + 1], a[c + 2] = l[d + 2], a[c + 3] = s, c += 4 } return a } return new Float32Array(o, r, n) }, t._GetFloatAsUIntRGBAArrayBuffer = function (i, r, n, o, s, a) { for (var l = new Uint8Array(o), c = new Float32Array(s, n), h = 0, u = 0; u < r; u++)for (var d = 0; d < i; d++) { var f = 4 * (d + u * i); l[h] = 255 * e.Scalar.Clamp(c[f]), l[h + 1] = 255 * e.Scalar.Clamp(c[f + 1]), l[h + 2] = 255 * e.Scalar.Clamp(c[f + 2]), l[h + 3] = t.StoreLODInAlphaChannel ? a : 255 * e.Scalar.Clamp(c[f + 3]), h += 4 } return l }, t._GetHalfFloatAsUIntRGBAArrayBuffer = function (i, r, n, o, s, a) { for (var l = new Uint8Array(o), c = new Uint16Array(s, n), h = 0, u = 0; u < r; u++)for (var d = 0; d < i; d++) { var f = 4 * (d + u * i); l[h] = 255 * e.Scalar.Clamp(t._FromHalfFloat(c[f])), l[h + 1] = 255 * e.Scalar.Clamp(t._FromHalfFloat(c[f + 1])), l[h + 2] = 255 * e.Scalar.Clamp(t._FromHalfFloat(c[f + 2])), l[h + 3] = t.StoreLODInAlphaChannel ? a : 255 * e.Scalar.Clamp(t._FromHalfFloat(c[f + 3])), h += 4 } return l }, t._GetRGBAArrayBuffer = function (e, t, i, r, n, o, s, a, l) { for (var c = new Uint8Array(r), h = new Uint8Array(n, i), u = 0, d = 0; d < t; d++)for (var f = 0; f < e; f++) { var p = 4 * (f + d * e); c[u] = h[p + o], c[u + 1] = h[p + s], c[u + 2] = h[p + a], c[u + 3] = h[p + l], u += 4 } return c }, t._ExtractLongWordOrder = function (e) { return 0 === e || 255 === e || -16777216 === e ? 0 : 1 + t._ExtractLongWordOrder(e >> 8) }, t._GetRGBArrayBuffer = function (e, t, i, r, n, o, s, a) { for (var l = new Uint8Array(r), c = new Uint8Array(n, i), h = 0, u = 0; u < t; u++)for (var d = 0; d < e; d++) { var f = 3 * (d + u * e); l[h] = c[f + o], l[h + 1] = c[f + s], l[h + 2] = c[f + a], h += 3 } return l }, t._GetLuminanceArrayBuffer = function (e, t, i, r, n) { for (var o = new Uint8Array(r), s = new Uint8Array(n, i), a = 0, l = 0; l < t; l++)for (var c = 0; c < e; c++) { var h = c + l * e; o[a] = s[h], a++ } return o }, t.UploadDDSLevels = function (s, a, l, c, h, u, d, f) { void 0 === d && (d = -1); var p = null; c.sphericalPolynomial && (p = new Array); var _, m, g, v, y, b, T, E = s.getCaps().s3tc, x = new Int32Array(l, 0, 31), P = 0, A = 0, S = 1; if (542327876 === x[0]) if (c.isFourCC || c.isRGB || c.isLuminance) if (!c.isCompressed || E) { var M = x[22]; v = x[1] + 4; var R, C = !1; if (c.isFourCC) switch (_ = x[21]) { case i: S = 8, A = E.COMPRESSED_RGBA_S3TC_DXT1_EXT; break; case r: S = 16, A = E.COMPRESSED_RGBA_S3TC_DXT3_EXT; break; case n: S = 16, A = E.COMPRESSED_RGBA_S3TC_DXT5_EXT; break; case 113: case 116: C = !0; break; case o: v += 20; var O = !1; switch (c.dxgiFormat) { case 10: O = C = !0; break; case 88: c.isRGB = !0, M = 32, O = !(c.isFourCC = !1) }if (O) break; default: return void console.error("Unsupported FourCC code:", (R = _, String.fromCharCode(255 & R, R >> 8 & 255, R >> 16 & 255, R >> 24 & 255))) }var D = t._ExtractLongWordOrder(x[23]), I = t._ExtractLongWordOrder(x[24]), w = t._ExtractLongWordOrder(x[25]), L = t._ExtractLongWordOrder(x[26]); C && (A = s._getRGBABufferInternalSizedFormat(c.textureType)), b = 1, 131072 & x[2] && !1 !== h && (b = Math.max(1, x[7])); for (var F = 0; F < u; F++) { for (m = x[4], g = x[3], T = 0; T < b; ++T) { if (-1 === d || d === T) { var B = -1 === d ? T : 0; if (!c.isCompressed && c.isFourCC) { a.format = e.Engine.TEXTUREFORMAT_RGBA, P = m * g * 4; var N = null; s._badOS || s._badDesktopOS || !s.getCaps().textureHalfFloat && !s.getCaps().textureFloat ? (128 === M ? (N = t._GetFloatAsUIntRGBAArrayBuffer(m, g, v, P, l, B), p && 0 == B && p.push(t._GetFloatRGBAArrayBuffer(m, g, v, P, l, B))) : 64 === M && (N = t._GetHalfFloatAsUIntRGBAArrayBuffer(m, g, v, P, l, B), p && 0 == B && p.push(t._GetHalfFloatAsFloatRGBAArrayBuffer(m, g, v, P, l, B))), a.type = e.Engine.TEXTURETYPE_UNSIGNED_INT) : 128 === M ? (a.type = e.Engine.TEXTURETYPE_FLOAT, N = t._GetFloatRGBAArrayBuffer(m, g, v, P, l, B), p && 0 == B && p.push(N)) : 64 !== M || s.getCaps().textureHalfFloat ? (a.type = e.Engine.TEXTURETYPE_HALF_FLOAT, N = t._GetHalfFloatRGBAArrayBuffer(m, g, v, P, l, B), p && 0 == B && p.push(t._GetHalfFloatAsFloatRGBAArrayBuffer(m, g, v, P, l, B))) : (a.type = e.Engine.TEXTURETYPE_FLOAT, N = t._GetHalfFloatAsFloatRGBAArrayBuffer(m, g, v, P, l, B), p && 0 == B && p.push(N)), N && s._uploadDataToTextureDirectly(a, N, F, B) } else if (c.isRGB) a.type = e.Engine.TEXTURETYPE_UNSIGNED_INT, 24 === M ? (a.format = e.Engine.TEXTUREFORMAT_RGB, y = t._GetRGBArrayBuffer(m, g, v, P = m * g * 3, l, D, I, w)) : (a.format = e.Engine.TEXTUREFORMAT_RGBA, y = t._GetRGBAArrayBuffer(m, g, v, P = m * g * 4, l, D, I, w, L)), s._uploadDataToTextureDirectly(a, y, F, B); else if (c.isLuminance) { var V = s._getUnpackAlignement(), U = m, z = Math.floor((m + V - 1) / V) * V; y = t._GetLuminanceArrayBuffer(m, g, v, P = z * (g - 1) + U, l), a.format = e.Engine.TEXTUREFORMAT_LUMINANCE, a.type = e.Engine.TEXTURETYPE_UNSIGNED_INT, s._uploadDataToTextureDirectly(a, y, F, B) } else P = Math.max(4, m) / 4 * Math.max(4, g) / 4 * S, y = new Uint8Array(l, v, P), a.type = e.Engine.TEXTURETYPE_UNSIGNED_INT, s._uploadCompressedDataToTextureDirectly(a, A, m, g, y, F, B) } v += M ? m * g * (M / 8) : P, m *= .5, g *= .5, m = Math.max(1, m), g = Math.max(1, g) } if (void 0 !== f) break } p && 0 < p.length ? c.sphericalPolynomial = e.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial({ size: x[4], right: p[0], left: p[1], up: p[2], down: p[3], front: p[4], back: p[5], format: e.Engine.TEXTUREFORMAT_RGBA, type: e.Engine.TEXTURETYPE_FLOAT, gammaSpace: !1 }) : c.sphericalPolynomial = void 0 } else e.Tools.Error("Compressed textures are not supported on this platform."); else e.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code"); else e.Tools.Error("Invalid magic number in DDS header") }, t.StoreLODInAlphaChannel = !1, t }(); e.DDSTools = s }($a || ($a = {})), zo = $a || ($a = {}), Go = function () { function e() { this.supportCascades = !0 } return e.prototype.canLoad = function (e, t, i, r, n) { return 0 === e.indexOf(".dds") }, e.prototype.transformUrl = function (e, t) { return e }, e.prototype.getFallbackTextureUrl = function (e, t) { return null }, e.prototype.loadCubeData = function (e, t, i, r, n) { var o, s = t.getEngine(), a = !1; if (Array.isArray(e)) for (var l = 0; l < e.length; l++) { var c = e[l]; o = zo.DDSTools.GetDDSInfo(c), t.width = o.width, t.height = o.height, a = (o.isRGB || o.isLuminance || 1 < o.mipmapCount) && t.generateMipMaps, s._unpackFlipY(o.isCompressed), zo.DDSTools.UploadDDSLevels(s, t, c, o, a, 6, -1, l), o.isFourCC || 1 !== o.mipmapCount || s.generateMipMapsForCubemap(t) } else { var h = e; o = zo.DDSTools.GetDDSInfo(h), t.width = o.width, t.height = o.height, i && (o.sphericalPolynomial = new zo.SphericalPolynomial), a = (o.isRGB || o.isLuminance || 1 < o.mipmapCount) && t.generateMipMaps, s._unpackFlipY(o.isCompressed), zo.DDSTools.UploadDDSLevels(s, t, h, o, a, 6), o.isFourCC || 1 !== o.mipmapCount || s.generateMipMapsForCubemap(t) } s._setCubeMapTextureParams(a), t.isReady = !0, r && r({ isDDS: !0, width: t.width, info: o, data: e, texture: t }) }, e.prototype.loadData = function (e, t, i) { var r = zo.DDSTools.GetDDSInfo(e), n = (r.isRGB || r.isLuminance || 1 < r.mipmapCount) && t.generateMipMaps && r.width >> r.mipmapCount - 1 == 1; i(r.width, r.height, n, r.isFourCC, function () { zo.DDSTools.UploadDDSLevels(t.getEngine(), t, e, r, n, 1) }) }, e }(), zo.Engine._TextureLoaders.push(new Go), ko = $a || ($a = {}), Wo = function () { function e() { } return e.GetTGAHeader = function (e) { var t = 0; return { id_length: e[t++], colormap_type: e[t++], image_type: e[t++], colormap_index: e[t++] | e[t++] << 8, colormap_length: e[t++] | e[t++] << 8, colormap_size: e[t++], origin: [e[t++] | e[t++] << 8, e[t++] | e[t++] << 8], width: e[t++] | e[t++] << 8, height: e[t++] | e[t++] << 8, pixel_size: e[t++], flags: e[t++] } }, e.UploadContent = function (t, i) { if (i.length < 19) ko.Tools.Error("Unable to load TGA file - Not enough data to contain header"); else { var r = 18, n = e.GetTGAHeader(i); if (n.id_length + r > i.length) ko.Tools.Error("Unable to load TGA file - Not enough data"); else { r += n.id_length; var o, s = !1, a = !1, l = !1; switch (n.image_type) { case e._TYPE_RLE_INDEXED: s = !0; case e._TYPE_INDEXED: a = !0; break; case e._TYPE_RLE_RGB: s = !0; case e._TYPE_RGB: break; case e._TYPE_RLE_GREY: s = !0; case e._TYPE_GREY: l = !0 }var c, h, u, d, f, p, _, m = n.pixel_size >> 3, g = n.width * n.height * m; if (a && (c = i.subarray(r, r += n.colormap_length * (n.colormap_size >> 3))), s) { var v, y, b; o = new Uint8Array(g); for (var T = 0, E = new Uint8Array(m); r < g && T < g;)if (y = 1 + (127 & (v = i[r++])), 128 & v) { for (b = 0; b < m; ++b)E[b] = i[r++]; for (b = 0; b < y; ++b)o.set(E, T + b * m); T += m * y } else { for (y *= m, b = 0; b < y; ++b)o[T + b] = i[r++]; T += y } } else o = i.subarray(r, r += a ? n.width * n.height : g); switch ((n.flags & e._ORIGIN_MASK) >> e._ORIGIN_SHIFT) { default: case e._ORIGIN_UL: h = 0, d = 1, _ = n.width, u = 0, f = 1, p = n.height; break; case e._ORIGIN_BL: h = 0, d = 1, _ = n.width, u = n.height - 1, p = f = -1; break; case e._ORIGIN_UR: h = n.width - 1, _ = d = -1, u = 0, f = 1, p = n.height; break; case e._ORIGIN_BR: h = n.width - 1, _ = d = -1, u = n.height - 1, p = f = -1 }var x = e["_getImageData" + (l ? "Grey" : "") + n.pixel_size + "bits"](n, c, o, u, f, p, h, d, _); t.getEngine()._uploadDataToTextureDirectly(t, x) } } }, e._getImageData8bits = function (e, t, i, r, n, o, s, a, l) { var c, h, u, d = i, f = t, p = e.width, _ = e.height, m = 0, g = new Uint8Array(p * _ * 4); for (u = r; u !== o; u += n)for (h = s; h !== l; h += a, m++)c = d[m], g[4 * (h + p * u) + 3] = 255, g[4 * (h + p * u) + 2] = f[3 * c + 0], g[4 * (h + p * u) + 1] = f[3 * c + 1], g[4 * (h + p * u) + 0] = f[3 * c + 2]; return g }, e._getImageData16bits = function (e, t, i, r, n, o, s, a, l) { var c, h, u, d = i, f = e.width, p = e.height, _ = 0, m = new Uint8Array(f * p * 4); for (u = r; u !== o; u += n)for (h = s; h !== l; h += a, _ += 2) { var g = 255 * ((31744 & (c = d[_ + 0] + (d[_ + 1] << 8))) >> 10) / 31 | 0, v = 255 * ((992 & c) >> 5) / 31 | 0, y = 255 * (31 & c) / 31 | 0; m[4 * (h + f * u) + 0] = g, m[4 * (h + f * u) + 1] = v, m[4 * (h + f * u) + 2] = y, m[4 * (h + f * u) + 3] = 32768 & c ? 0 : 255 } return m }, e._getImageData24bits = function (e, t, i, r, n, o, s, a, l) { var c, h, u = i, d = e.width, f = e.height, p = 0, _ = new Uint8Array(d * f * 4); for (h = r; h !== o; h += n)for (c = s; c !== l; c += a, p += 3)_[4 * (c + d * h) + 3] = 255, _[4 * (c + d * h) + 2] = u[p + 0], _[4 * (c + d * h) + 1] = u[p + 1], _[4 * (c + d * h) + 0] = u[p + 2]; return _ }, e._getImageData32bits = function (e, t, i, r, n, o, s, a, l) { var c, h, u = i, d = e.width, f = e.height, p = 0, _ = new Uint8Array(d * f * 4); for (h = r; h !== o; h += n)for (c = s; c !== l; c += a, p += 4)_[4 * (c + d * h) + 2] = u[p + 0], _[4 * (c + d * h) + 1] = u[p + 1], _[4 * (c + d * h) + 0] = u[p + 2], _[4 * (c + d * h) + 3] = u[p + 3]; return _ }, e._getImageDataGrey8bits = function (e, t, i, r, n, o, s, a, l) { var c, h, u, d = i, f = e.width, p = e.height, _ = 0, m = new Uint8Array(f * p * 4); for (u = r; u !== o; u += n)for (h = s; h !== l; h += a, _++)c = d[_], m[4 * (h + f * u) + 0] = c, m[4 * (h + f * u) + 1] = c, m[4 * (h + f * u) + 2] = c, m[4 * (h + f * u) + 3] = 255; return m }, e._getImageDataGrey16bits = function (e, t, i, r, n, o, s, a, l) { var c, h, u = i, d = e.width, f = e.height, p = 0, _ = new Uint8Array(d * f * 4); for (h = r; h !== o; h += n)for (c = s; c !== l; c += a, p += 2)_[4 * (c + d * h) + 0] = u[p + 0], _[4 * (c + d * h) + 1] = u[p + 0], _[4 * (c + d * h) + 2] = u[p + 0], _[4 * (c + d * h) + 3] = u[p + 1]; return _ }, e._TYPE_INDEXED = 1, e._TYPE_RGB = 2, e._TYPE_GREY = 3, e._TYPE_RLE_INDEXED = 9, e._TYPE_RLE_RGB = 10, e._TYPE_RLE_GREY = 11, e._ORIGIN_MASK = 48, e._ORIGIN_SHIFT = 4, e._ORIGIN_BL = 0, e._ORIGIN_BR = 1, e._ORIGIN_UL = 2, e._ORIGIN_UR = 3, e }(), ko.TGATools = Wo, Ho = $a || ($a = {}), Xo = function () { function e() { this.supportCascades = !1 } return e.prototype.canLoad = function (e, t, i, r, n) { return 0 === e.indexOf(".tga") }, e.prototype.transformUrl = function (e, t) { return e }, e.prototype.getFallbackTextureUrl = function (e, t) { return null }, e.prototype.loadCubeData = function (e, t, i, r, n) { throw ".env not supported in Cube." }, e.prototype.loadData = function (e, t, i) { var r = new Uint8Array(e), n = Ho.TGATools.GetTGAHeader(r); i(n.width, n.height, t.generateMipMaps, !1, function () { Ho.TGATools.UploadContent(t, r) }) }, e }(), Ho.Engine._TextureLoaders.push(new Xo), jo = $a || ($a = {}), Yo = function () { function e(t, i, r, n) { this.arrayBuffer = t; var o = new Uint8Array(this.arrayBuffer, 0, 12); if (171 === o[0] && 75 === o[1] && 84 === o[2] && 88 === o[3] && 32 === o[4] && 49 === o[5] && 49 === o[6] && 187 === o[7] && 13 === o[8] && 10 === o[9] && 26 === o[10] && 10 === o[11]) { var s = new Int32Array(this.arrayBuffer, 12, 13), a = 16909060 === s[0]; this.glType = a ? this.switchEndianness(s[1]) : s[1], this.glTypeSize = a ? this.switchEndianness(s[2]) : s[2], this.glFormat = a ? this.switchEndianness(s[3]) : s[3], this.glInternalFormat = a ? this.switchEndianness(s[4]) : s[4], this.glBaseInternalFormat = a ? this.switchEndianness(s[5]) : s[5], this.pixelWidth = a ? this.switchEndianness(s[6]) : s[6], this.pixelHeight = a ? this.switchEndianness(s[7]) : s[7], this.pixelDepth = a ? this.switchEndianness(s[8]) : s[8], this.numberOfArrayElements = a ? this.switchEndianness(s[9]) : s[9], this.numberOfFaces = a ? this.switchEndianness(s[10]) : s[10], this.numberOfMipmapLevels = a ? this.switchEndianness(s[11]) : s[11], this.bytesOfKeyValueData = a ? this.switchEndianness(s[12]) : s[12], 0 === this.glType ? (this.numberOfMipmapLevels = Math.max(1, this.numberOfMipmapLevels), 0 !== this.pixelHeight && 0 === this.pixelDepth ? 0 === this.numberOfArrayElements ? this.numberOfFaces === i ? this.loadType = e.COMPRESSED_2D : jo.Tools.Error("number of faces expected" + i + ", but found " + this.numberOfFaces) : jo.Tools.Error("texture arrays not currently supported") : jo.Tools.Error("only 2D textures currently supported")) : jo.Tools.Error("only compressed formats currently supported") } else jo.Tools.Error("texture missing KTX identifier") } return e.prototype.switchEndianness = function (e) { return (255 & e) << 24 | (65280 & e) << 8 | e >> 8 & 65280 | e >> 24 & 255 }, e.prototype.uploadLevels = function (t, i) { switch (this.loadType) { case e.COMPRESSED_2D: this._upload2DCompressedLevels(t, i) } }, e.prototype._upload2DCompressedLevels = function (t, i) { for (var r = e.HEADER_LEN + this.bytesOfKeyValueData, n = this.pixelWidth, o = this.pixelHeight, s = i ? this.numberOfMipmapLevels : 1, a = 0; a < s; a++) { var l = new Int32Array(this.arrayBuffer, r, 1)[0]; r += 4; for (var c = 0; c < this.numberOfFaces; c++) { var h = new Uint8Array(this.arrayBuffer, r, l); t.getEngine()._uploadCompressedDataToTextureDirectly(t, this.glInternalFormat, n, o, h, c, a), r += l, r += 3 - (l + 3) % 4 } n = Math.max(1, .5 * n), o = Math.max(1, .5 * o) } }, e.HEADER_LEN = 64, e.COMPRESSED_2D = 0, e.COMPRESSED_3D = 1, e.TEX_2D = 2, e.TEX_3D = 3, e }(), jo.KhronosTextureContainer = Yo, Ko = $a || ($a = {}), Qo = function () { function e() { this.supportCascades = !1 } return e.prototype.canLoad = function (e, t, i, r, n) { return !(!t || r || i || n) }, e.prototype.transformUrl = function (e, t) { var i = e.lastIndexOf("."); return (-1 < i ? e.substring(0, i) : e) + t }, e.prototype.getFallbackTextureUrl = function (e, t) { var i = new RegExp(t + "$"); return e.replace(i, "") }, e.prototype.loadCubeData = function (e, t, i, r, n) { if (!Array.isArray(e)) { var o = t.getEngine(), s = new Ko.KhronosTextureContainer(e, 6), a = 1 < s.numberOfMipmapLevels && t.generateMipMaps; o._unpackFlipY(!0), s.uploadLevels(t, t.generateMipMaps), t.width = s.pixelWidth, t.height = s.pixelHeight, o._setCubeMapTextureParams(a), t.isReady = !0 } }, e.prototype.loadData = function (e, t, i) { var r = new Ko.KhronosTextureContainer(e, 1); i(r.pixelWidth, r.pixelHeight, !1, !0, function () { r.uploadLevels(t, t.generateMipMaps) }) }, e }(), Ko.Engine._TextureLoaders.unshift(new Qo), Zo = $a || ($a = {}), qo = function () { function e() { } return e.GetEnvInfo = function (t) { for (var i = new DataView(t), r = 0, n = 0; n < e._MagicBytes.length; n++)if (i.getUint8(r++) !== e._MagicBytes[n]) return Zo.Tools.Error("Not a babylon environment map"), null; for (var o = "", s = 0; s = i.getUint8(r++);)o += String.fromCharCode(s); var a = JSON.parse(o); return a.specular && (a.specular.specularDataPosition = r, a.specular.lodGenerationScale = a.specular.lodGenerationScale || .8), a }, e.CreateEnvTextureAsync = function (t) { var i = this, r = t.getInternalTexture(); if (!r) return Promise.reject("The cube texture is invalid."); if (!t._prefiltered) return Promise.reject("The cube texture is invalid (not prefiltered)."); var n = r.getEngine(); if (n && n.premultipliedAlpha) return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false."); if (t.textureType === Zo.Engine.TEXTURETYPE_UNSIGNED_INT) return Promise.reject("The cube texture should allow HDR (Full Float or Half Float)."); var o = n.getRenderingCanvas(); if (!o) return Promise.reject("Env texture can only be created when the engine is associated to a canvas."); var s = Zo.Engine.TEXTURETYPE_FLOAT; if (!n.getCaps().textureFloatRender && (s = Zo.Engine.TEXTURETYPE_HALF_FLOAT, !n.getCaps().textureHalfFloatRender)) return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering."); var a = r.width, l = new Zo.Scene(n), c = {}, h = [], u = Zo.Scalar.Log2(r.width); u = Math.round(u); for (var d = function (e) { for (var i = Math.pow(2, u - e), r = function (r) { var a = t.readPixels(r, e), u = n.createRawTexture(a, i, i, Zo.Engine.TEXTUREFORMAT_RGBA, !1, !1, Zo.Texture.NEAREST_SAMPLINGMODE, null, s), d = new Promise(function (t, s) { var a = new Zo.PostProcess("rgbdEncode", "rgbdEncode", null, null, 1, null, Zo.Texture.NEAREST_SAMPLINGMODE, n, !1, void 0, Zo.Engine.TEXTURETYPE_UNSIGNED_INT, void 0, null, !1); a.getEffect().executeWhenCompiled(function () { a.onApply = function (e) { e._bindTexture("textureSampler", u) }; var s = n.getRenderWidth(), h = n.getRenderHeight(); n.setSize(i, i), l.postProcessManager.directRender([a], null), Zo.Tools.ToBlob(o, function (i) { var n = new FileReader; n.onload = function (i) { var n = i.target.result; c[6 * e + r] = n, t() }, n.readAsArrayBuffer(i) }), n.setSize(s, h) }) }); h.push(d) }, a = 0; a < 6; a++)r(a) }, f = 0; f <= u; f++)d(f); return Promise.all(h).then(function () { l.dispose(); for (var r = { version: 1, width: a, irradiance: i._CreateEnvTextureIrradiance(t), specular: { mipmaps: [], lodGenerationScale: t.lodGenerationScale } }, n = 0, o = 0; o <= u; o++)for (var s = 0; s < 6; s++) { var h = c[6 * o + s].byteLength; r.specular.mipmaps.push({ length: h, position: n }), n += h } for (var d = JSON.stringify(r), f = new ArrayBuffer(d.length + 1), p = new Uint8Array(f), _ = (o = 0, d.length); o < _; o++)p[o] = d.charCodeAt(o); p[d.length] = 0; var m = e._MagicBytes.length + n + f.byteLength, g = new ArrayBuffer(m), v = new Uint8Array(g), y = new DataView(g), b = 0; for (o = 0; o < e._MagicBytes.length; o++)y.setUint8(b++, e._MagicBytes[o]); for (v.set(new Uint8Array(f), b), b += f.byteLength, o = 0; o <= u; o++)for (s = 0; s < 6; s++) { var T = c[6 * o + s]; v.set(new Uint8Array(T), b), b += T.byteLength } return g }) }, e._CreateEnvTextureIrradiance = function (e) { var t = e.sphericalPolynomial; return null == t ? null : { x: [t.x.x, t.x.y, t.x.z], y: [t.y.x, t.y.y, t.y.z], z: [t.z.x, t.z.y, t.z.z], xx: [t.xx.x, t.xx.y, t.xx.z], yy: [t.yy.x, t.yy.y, t.yy.z], zz: [t.zz.x, t.zz.y, t.zz.z], yz: [t.yz.x, t.yz.y, t.yz.z], zx: [t.zx.x, t.zx.y, t.zx.z], xy: [t.xy.x, t.xy.y, t.xy.z] } }, e.UploadEnvLevelsAsync = function (t, i, r) { if (1 !== r.version) throw new Error('Unsupported babylon environment map version "' + r.version + '"'); var n = r.specular; if (!n) return Promise.resolve(); var o = Zo.Scalar.Log2(r.width); if (o = Math.round(o) + 1, n.mipmaps.length !== 6 * o) throw new Error('Unsupported specular mipmaps number "' + n.mipmaps.length + '"'); t._lodGenerationScale = n.lodGenerationScale; for (var s = new Array(o), a = 0; a < o; a++) { s[a] = new Array(6); for (var l = 0; l < 6; l++) { var c = n.mipmaps[6 * a + l]; s[a][l] = new Uint8Array(i, n.specularDataPosition + c.position, c.length) } } return e.UploadLevelsAsync(t, s) }, e.UploadLevelsAsync = function (e, t) { if (!Zo.Tools.IsExponentOfTwo(e.width)) throw new Error("Texture size must be a power of two"); var i = Math.round(Zo.Scalar.Log2(e.width)) + 1, r = e.getEngine(), n = !1, o = !1, s = null, a = null, l = null, c = r.getCaps(); if (e.format = Zo.Engine.TEXTUREFORMAT_RGBA, e.type = Zo.Engine.TEXTURETYPE_UNSIGNED_INT, e.generateMipMaps = !0, r.updateTextureSamplingMode(Zo.Texture.TRILINEAR_SAMPLINGMODE, e), c.textureLOD ? r.webGLVersion < 2 ? n = !1 : c.textureHalfFloatRender && c.textureHalfFloatLinearFiltering ? (n = !0, e.type = Zo.Engine.TEXTURETYPE_HALF_FLOAT) : c.textureFloatRender && c.textureFloatLinearFiltering && (n = !0, e.type = Zo.Engine.TEXTURETYPE_FLOAT) : (o = !(n = !1), l = {}), n) s = new Zo.PostProcess("rgbdDecode", "rgbdDecode", null, null, 1, null, Zo.Texture.TRILINEAR_SAMPLINGMODE, r, !1, void 0, e.type, void 0, null, !1), e._isRGBD = !1, e.invertY = !1, a = r.createRenderTargetCubeTexture(e.width, { generateDepthBuffer: !1, generateMipMaps: !0, generateStencilBuffer: !1, samplingMode: Zo.Texture.TRILINEAR_SAMPLINGMODE, type: e.type, format: Zo.Engine.TEXTUREFORMAT_RGBA }); else if (e._isRGBD = !0, e.invertY = !0, o) for (var h = e._lodGenerationScale, u = e._lodGenerationOffset, d = 0; d < 3; d++) { var f = (i - 1) * h + u, p = u + (f - u) * (1 - d / 2), _ = Math.round(Math.min(Math.max(p, 0), f)), m = new Zo.InternalTexture(r, Zo.InternalTexture.DATASOURCE_TEMP); m.isCube = !0, m.invertY = !0, m.generateMipMaps = !1, r.updateTextureSamplingMode(Zo.Texture.LINEAR_LINEAR, m); var g = new Zo.BaseTexture(null); switch (g.isCube = !0, g._texture = m, l[_] = g, d) { case 0: e._lodTextureLow = g; break; case 1: e._lodTextureMid = g; break; case 2: e._lodTextureHigh = g } } var v = [], y = function (i) { for (var c = function (c) { var h = t[i][c], u = new Blob([h], { type: "image/png" }), d = URL.createObjectURL(u), f = new Image; f.src = d; var p = new Promise(function (t, h) { f.onload = function () { if (n) { var u = r.createTexture(null, !0, !0, null, Zo.Texture.NEAREST_SAMPLINGMODE, null, function (e) { h(e) }, f); s.getEffect().executeWhenCompiled(function () { s.onApply = function (e) { e._bindTexture("textureSampler", u), e.setFloat2("scale", 1, 1) }, r.scenes[0].postProcessManager.directRender([s], a, !0, c, i), r.restoreDefaultFramebuffer(), u.dispose(), window.URL.revokeObjectURL(d), t() }) } else { if (r._uploadImageToTexture(e, f, c, i), o) { var p = l[i]; p && r._uploadImageToTexture(p._texture, f, c, 0) } t() } }, f.onerror = function (e) { h(e) } }); v.push(p) }, h = 0; h < 6; h++)c(h) }; for (d = 0; d < t.length; d++)y(d); if (t.length < i) { var b = void 0, T = Math.pow(2, i - 1 - t.length), E = T * T * 4; switch (e.type) { case Zo.Engine.TEXTURETYPE_UNSIGNED_INT: b = new Uint8Array(E); break; case Zo.Engine.TEXTURETYPE_HALF_FLOAT: b = new Uint16Array(E); break; case Zo.Engine.TEXTURETYPE_FLOAT: b = new Float32Array(E) }for (d = t.length; d < i; d++)for (var x = 0; x < 6; x++)r._uploadArrayBufferViewToTexture(e, b, x, d) } return Promise.all(v).then(function () { a && (r._releaseFramebufferObjects(a), a._swapAndDie(e)), s && s.dispose(), o && (e._lodTextureHigh && e._lodTextureHigh._texture && (e._lodTextureHigh._texture.isReady = !0), e._lodTextureMid && e._lodTextureMid._texture && (e._lodTextureMid._texture.isReady = !0), e._lodTextureLow && e._lodTextureLow._texture && (e._lodTextureLow._texture.isReady = !0)) }) }, e.UploadEnvSpherical = function (e, t) { 1 !== t.version && Zo.Tools.Warn('Unsupported babylon environment map version "' + t.version + '"'); var i = t.irradiance; if (i) { var r = new Zo.SphericalPolynomial; Zo.Vector3.FromArrayToRef(i.x, 0, r.x), Zo.Vector3.FromArrayToRef(i.y, 0, r.y), Zo.Vector3.FromArrayToRef(i.z, 0, r.z), Zo.Vector3.FromArrayToRef(i.xx, 0, r.xx), Zo.Vector3.FromArrayToRef(i.yy, 0, r.yy), Zo.Vector3.FromArrayToRef(i.zz, 0, r.zz), Zo.Vector3.FromArrayToRef(i.yz, 0, r.yz), Zo.Vector3.FromArrayToRef(i.zx, 0, r.zx), Zo.Vector3.FromArrayToRef(i.xy, 0, r.xy), e._sphericalPolynomial = r } }, e._MagicBytes = [134, 22, 135, 150, 246, 214, 150, 54], e }(), Zo.EnvironmentTextureTools = qo, Jo = $a || ($a = {}), $o = function () { function e() { this.supportCascades = !1 } return e.prototype.canLoad = function (e, t, i, r, n) { return 0 === e.indexOf(".env") }, e.prototype.transformUrl = function (e, t) { return e }, e.prototype.getFallbackTextureUrl = function (e, t) { return null }, e.prototype.loadCubeData = function (e, t, i, r, n) { if (!Array.isArray(e)) { e = e; var o = Jo.EnvironmentTextureTools.GetEnvInfo(e); o ? (t.width = o.width, t.height = o.width, Jo.EnvironmentTextureTools.UploadEnvSpherical(t, o), Jo.EnvironmentTextureTools.UploadEnvLevelsAsync(t, e, o).then(function () { t.isReady = !0, r && r() })) : n && n("Can not parse the environment file", null) } }, e.prototype.loadData = function (e, t, i) { throw ".env not supported in 2d." }, e }(), Jo.Engine._TextureLoaders.push(new $o), es = $a || ($a = {}), ts = function () { function e(e) { var t = this; this.originalScene = e, this._pointerCaptures = {}, this._lastPointerEvents = {}, this.shouldRender = !0, this.onlyCheckPointerDownEvents = !0, this.processAllEvents = !1, this.onPointerOutObservable = new es.Observable, this.utilityLayerScene = new es.Scene(e.getEngine()), this.utilityLayerScene.useRightHandedSystem = e.useRightHandedSystem, this.utilityLayerScene._allowPostProcessClearColor = !1, e.getEngine().scenes.pop(), this.utilityLayerScene.detachControl(), this._originalPointerObserver = e.onPrePointerObservable.add(function (i, r) { if (t.processAllEvents || i.type === es.PointerEventTypes.POINTERMOVE || i.type === es.PointerEventTypes.POINTERUP || i.type === es.PointerEventTypes.POINTERDOWN) { var n = i.event; if (e.isPointerCaptured(n.pointerId)) t._pointerCaptures[n.pointerId] = !1; else { var o = i.ray ? t.utilityLayerScene.pickWithRay(i.ray) : t.utilityLayerScene.pick(e.pointerX, e.pointerY); if (!i.ray && o && (i.ray = o.ray), t.utilityLayerScene.onPrePointerObservable.notifyObservers(i), t.onlyCheckPointerDownEvents && i.type != es.PointerEventTypes.POINTERDOWN) return i.skipOnPointerObservable || t.utilityLayerScene.onPointerObservable.notifyObservers(new es.PointerInfo(i.type, i.event, o)), void (i.type === es.PointerEventTypes.POINTERUP && t._pointerCaptures[n.pointerId] && (t._pointerCaptures[n.pointerId] = !1)); if (t.utilityLayerScene.autoClearDepthAndStencil) o && o.hit && (i.skipOnPointerObservable || t.utilityLayerScene.onPointerObservable.notifyObservers(new es.PointerInfo(i.type, i.event, o)), i.skipOnPointerObservable = !0); else { var s = i.ray ? e.pickWithRay(i.ray) : e.pick(e.pointerX, e.pointerY), a = i.event; s && o && (0 === o.distance && s.pickedMesh ? t.mainSceneTrackerPredicate && t.mainSceneTrackerPredicate(s.pickedMesh) ? (t._notifyObservers(i, s, a), i.skipOnPointerObservable = !0) : i.type === es.PointerEventTypes.POINTERDOWN ? t._pointerCaptures[a.pointerId] = !0 : t._lastPointerEvents[a.pointerId] && (t.onPointerOutObservable.notifyObservers(a.pointerId), delete t._lastPointerEvents[a.pointerId]) : !t._pointerCaptures[a.pointerId] && (o.distance < s.distance || 0 === s.distance) ? (t._notifyObservers(i, o, a), i.skipOnPointerObservable || (i.skipOnPointerObservable = 0 < o.distance)) : !t._pointerCaptures[a.pointerId] && o.distance > s.distance && (t.mainSceneTrackerPredicate && t.mainSceneTrackerPredicate(s.pickedMesh) ? (t._notifyObservers(i, s, a), i.skipOnPointerObservable = !0) : t._lastPointerEvents[a.pointerId] && (t.onPointerOutObservable.notifyObservers(a.pointerId), delete t._lastPointerEvents[a.pointerId])), i.type === es.PointerEventTypes.POINTERUP && t._pointerCaptures[a.pointerId] && (t._pointerCaptures[a.pointerId] = !1)) } } } }), this.utilityLayerScene.autoClear = !1, this._afterRenderObserver = this.originalScene.onAfterRenderObservable.add(function () { t.shouldRender && t.render() }), this._sceneDisposeObserver = this.originalScene.onDisposeObservable.add(function () { t.dispose() }), this._updateCamera() } return Object.defineProperty(e, "DefaultUtilityLayer", { get: function () { return null == e._DefaultUtilityLayer && (e._DefaultUtilityLayer = new e(es.Engine.LastCreatedScene)).originalScene.onDisposeObservable.addOnce(function () { e._DefaultUtilityLayer = null }), e._DefaultUtilityLayer }, enumerable: !0, configurable: !0 }), Object.defineProperty(e, "DefaultKeepDepthUtilityLayer", { get: function () { return null == e._DefaultKeepDepthUtilityLayer && ((e._DefaultKeepDepthUtilityLayer = new e(es.Engine.LastCreatedScene)).utilityLayerScene.autoClearDepthAndStencil = !1, e._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function () { e._DefaultKeepDepthUtilityLayer = null })), e._DefaultKeepDepthUtilityLayer }, enumerable: !0, configurable: !0 }), e.prototype._notifyObservers = function (e, t, i) { e.skipOnPointerObservable || (this.utilityLayerScene.onPointerObservable.notifyObservers(new es.PointerInfo(e.type, e.event, t)), this._lastPointerEvents[i.pointerId] = !0) }, e.prototype.render = function () { if (this._updateCamera(), this.utilityLayerScene.activeCamera) { var e = this.utilityLayerScene.activeCamera.getScene(), t = this.utilityLayerScene.activeCamera; t._scene = this.utilityLayerScene, t.leftCamera && (t.leftCamera._scene = this.utilityLayerScene), t.rightCamera && (t.rightCamera._scene = this.utilityLayerScene), this.utilityLayerScene.render(!1), t._scene = e, t.leftCamera && (t.leftCamera._scene = e), t.rightCamera && (t.rightCamera._scene = e) } }, e.prototype.dispose = function () { this.onPointerOutObservable.clear(), this._afterRenderObserver && this.originalScene.onAfterRenderObservable.remove(this._afterRenderObserver), this._sceneDisposeObserver && this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver), this._originalPointerObserver && this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver), this.utilityLayerScene.dispose() }, e.prototype._updateCamera = function () { this.utilityLayerScene.activeCamera = this.originalScene.activeCamera }, e._DefaultUtilityLayer = null, e._DefaultKeepDepthUtilityLayer = null, e }(), es.UtilityLayerRenderer = ts, is = $a || ($a = {}), rs = function () { function e(e) { this.maxDragAngle = 0, this._useAlternatePickedPointAboveMaxDragAngle = !1, this.currentDraggingPointerID = -1, this.dragging = !1, this.dragDeltaRatio = .2, this.updateDragPlane = !0, this._debugMode = !1, this._moving = !1, this.onDragObservable = new is.Observable, this.onDragStartObservable = new is.Observable, this.onDragEndObservable = new is.Observable, this.moveAttached = !0, this.enabled = !0, this.detachCameraControls = !0, this.useObjectOrienationForDragging = !0, this._tmpVector = new is.Vector3(0, 0, 0), this._alternatePickedPoint = new is.Vector3(0, 0, 0), this._worldDragAxis = new is.Vector3(0, 0, 0), this._targetPosition = new is.Vector3(0, 0, 0), this._attachedElement = null, this._startDragRay = new is.Ray(new is.Vector3, new is.Vector3), this._lastPointerRay = {}, this._dragDelta = new is.Vector3, this._pointA = new is.Vector3(0, 0, 0), this._pointB = new is.Vector3(0, 0, 0), this._pointC = new is.Vector3(0, 0, 0), this._lineA = new is.Vector3(0, 0, 0), this._lineB = new is.Vector3(0, 0, 0), this._localAxis = new is.Vector3(0, 0, 0), this._lookAt = new is.Vector3(0, 0, 0), this._options = e || {}; var t = 0; if (this._options.dragAxis && t++ , this._options.dragPlaneNormal && t++ , 1 < t) throw "Multiple drag modes specified in dragBehavior options. Only one expected" } return Object.defineProperty(e.prototype, "name", { get: function () { return "PointerDrag" }, enumerable: !0, configurable: !0 }), e.prototype.init = function () { }, e.prototype.attach = function (t) { var i = this; this._scene = t.getScene(), this._attachedNode = t, e._planeScene || (this._debugMode ? e._planeScene = this._scene : ((e._planeScene = new is.Scene(this._scene.getEngine())).detachControl(), this._scene.getEngine().scenes.pop(), this._scene.onDisposeObservable.addOnce(function () { e._planeScene.dispose(), e._planeScene = null }))), this._dragPlane = is.Mesh.CreatePlane("pointerDragPlane", this._debugMode ? 1 : 1e4, e._planeScene, !1, is.Mesh.DOUBLESIDE), this.lastDragPosition = new is.Vector3(0, 0, 0), this._pointerObserver = this._scene.onPointerObservable.add(function (t, r) { var n; if (i.enabled) if (t.type == is.PointerEventTypes.POINTERDOWN) !i.dragging && t.pickInfo && t.pickInfo.hit && t.pickInfo.pickedMesh && t.pickInfo.pickedPoint && t.pickInfo.ray && (n = t.pickInfo.pickedMesh, i._attachedNode == n || n.isDescendantOf(i._attachedNode)) && i._startDrag(t.event.pointerId, t.pickInfo.ray, t.pickInfo.pickedPoint); else if (t.type == is.PointerEventTypes.POINTERUP) i.currentDraggingPointerID == t.event.pointerId && i.releaseDrag(); else if (t.type == is.PointerEventTypes.POINTERMOVE) { var o = t.event.pointerId; i.currentDraggingPointerID === e._AnyMouseID && o !== e._AnyMouseID && "mouse" == t.event.pointerType && (i._lastPointerRay[i.currentDraggingPointerID] && (i._lastPointerRay[o] = i._lastPointerRay[i.currentDraggingPointerID], delete i._lastPointerRay[i.currentDraggingPointerID]), i.currentDraggingPointerID = o), i._lastPointerRay[o] || (i._lastPointerRay[o] = new is.Ray(new is.Vector3, new is.Vector3)), t.pickInfo && t.pickInfo.ray && (i._lastPointerRay[o].origin.copyFrom(t.pickInfo.ray.origin), i._lastPointerRay[o].direction.copyFrom(t.pickInfo.ray.direction), i.currentDraggingPointerID == o && i.dragging && i._moveDrag(t.pickInfo.ray)) } }), this._beforeRenderObserver = this._scene.onBeforeRenderObservable.add(function () { i._moving && i.moveAttached && (is.BoundingBoxGizmo._RemoveAndStorePivotPoint(i._attachedNode), i._targetPosition.subtractToRef(i._attachedNode.absolutePosition, i._tmpVector), i._tmpVector.scaleInPlace(i.dragDeltaRatio), i._attachedNode.getAbsolutePosition().addToRef(i._tmpVector, i._tmpVector), i._attachedNode.setAbsolutePosition(i._tmpVector), is.BoundingBoxGizmo._RestorePivotPoint(i._attachedNode)) }) }, e.prototype.releaseDrag = function () { this.dragging = !1, this.onDragEndObservable.notifyObservers({ dragPlanePoint: this.lastDragPosition, pointerId: this.currentDraggingPointerID }), this.currentDraggingPointerID = -1, this._moving = !1, this.detachCameraControls && this._attachedElement && this._scene.activeCamera && !this._scene.activeCamera.leftCamera && this._scene.activeCamera.attachControl(this._attachedElement, !0) }, e.prototype.startDrag = function (t, i, r) { void 0 === t && (t = e._AnyMouseID), this._startDrag(t, i, r); var n = this._lastPointerRay[t]; t === e._AnyMouseID && (n = this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]), n && this._moveDrag(n) }, e.prototype._startDrag = function (e, t, i) { if (this._scene.activeCamera && !this.dragging && this._attachedNode) { is.BoundingBoxGizmo._RemoveAndStorePivotPoint(this._attachedNode), t ? (this._startDragRay.direction.copyFrom(t.direction), this._startDragRay.origin.copyFrom(t.origin)) : (this._startDragRay.origin.copyFrom(this._scene.activeCamera.position), this._attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector), this._tmpVector.subtractToRef(this._scene.activeCamera.position, this._startDragRay.direction)), this._updateDragPlanePosition(this._startDragRay, i || this._tmpVector); var r = this._pickWithRayOnDragPlane(this._startDragRay); r && (this.dragging = !0, this.currentDraggingPointerID = e, this.lastDragPosition.copyFrom(r), this.onDragStartObservable.notifyObservers({ dragPlanePoint: r, pointerId: this.currentDraggingPointerID }), this._targetPosition.copyFrom(this._attachedNode.absolutePosition), this.detachCameraControls && this._scene.activeCamera && !this._scene.activeCamera.leftCamera && (this._scene.activeCamera.inputs.attachedElement ? (this._attachedElement = this._scene.activeCamera.inputs.attachedElement, this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)) : this._attachedElement = null)), is.BoundingBoxGizmo._RestorePivotPoint(this._attachedNode) } }, e.prototype._moveDrag = function (e) { this._moving = !0; var t = this._pickWithRayOnDragPlane(e); if (t) { this.updateDragPlane && this._updateDragPlanePosition(e, t); var i = 0; this._options.dragAxis ? (is.Vector3.TransformCoordinatesToRef(this._options.dragAxis, this._attachedNode.getWorldMatrix().getRotationMatrix(), this._worldDragAxis), t.subtractToRef(this.lastDragPosition, this._tmpVector), i = is.Vector3.Dot(this._tmpVector, this._worldDragAxis), this._worldDragAxis.scaleToRef(i, this._dragDelta)) : (i = this._dragDelta.length(), t.subtractToRef(this.lastDragPosition, this._dragDelta)), this._targetPosition.addInPlace(this._dragDelta), this.onDragObservable.notifyObservers({ dragDistance: i, delta: this._dragDelta, dragPlanePoint: t, dragPlaneNormal: this._dragPlane.forward, pointerId: this.currentDraggingPointerID }), this.lastDragPosition.copyFrom(t) } }, e.prototype._pickWithRayOnDragPlane = function (t) { var i = this; if (!t) return null; var r = Math.acos(is.Vector3.Dot(this._dragPlane.forward, t.direction)); if (r > Math.PI / 2 && (r = Math.PI - r), 0 < this.maxDragAngle && r > this.maxDragAngle) { if (this._useAlternatePickedPointAboveMaxDragAngle) { this._tmpVector.copyFrom(t.direction), this._attachedNode.absolutePosition.subtractToRef(t.origin, this._alternatePickedPoint), this._alternatePickedPoint.normalize(), this._alternatePickedPoint.scaleInPlace(-2 * is.Vector3.Dot(this._alternatePickedPoint, this._tmpVector)), this._tmpVector.addInPlace(this._alternatePickedPoint); var n = is.Vector3.Dot(this._dragPlane.forward, this._tmpVector); return this._dragPlane.forward.scaleToRef(-n, this._alternatePickedPoint), this._alternatePickedPoint.addInPlace(this._tmpVector), this._alternatePickedPoint.addInPlace(this._attachedNode.absolutePosition), this._alternatePickedPoint } return null } var o = e._planeScene.pickWithRay(t, function (e) { return e == i._dragPlane }); return o && o.hit && o.pickedMesh && o.pickedPoint ? o.pickedPoint : null }, e.prototype._updateDragPlanePosition = function (e, t) { this._pointA.copyFrom(t), this._options.dragAxis ? (this.useObjectOrienationForDragging ? is.Vector3.TransformCoordinatesToRef(this._options.dragAxis, this._attachedNode.getWorldMatrix().getRotationMatrix(), this._localAxis) : this._localAxis.copyFrom(this._options.dragAxis), this._pointA.addToRef(this._localAxis, this._pointB), e.origin.subtractToRef(this._pointA, this._pointC), this._pointA.addToRef(this._pointC.normalize(), this._pointC), this._pointB.subtractToRef(this._pointA, this._lineA), this._pointC.subtractToRef(this._pointA, this._lineB), is.Vector3.CrossToRef(this._lineA, this._lineB, this._lookAt), is.Vector3.CrossToRef(this._lineA, this._lookAt, this._lookAt), this._lookAt.normalize(), this._dragPlane.position.copyFrom(this._pointA), this._pointA.subtractToRef(this._lookAt, this._lookAt), this._dragPlane.lookAt(this._lookAt)) : this._options.dragPlaneNormal ? (this.useObjectOrienationForDragging ? is.Vector3.TransformCoordinatesToRef(this._options.dragPlaneNormal, this._attachedNode.getWorldMatrix().getRotationMatrix(), this._localAxis) : this._localAxis.copyFrom(this._options.dragPlaneNormal), this._dragPlane.position.copyFrom(this._pointA), this._pointA.subtractToRef(this._localAxis, this._lookAt), this._dragPlane.lookAt(this._lookAt)) : (this._dragPlane.position.copyFrom(this._pointA), this._dragPlane.lookAt(e.origin)), this._dragPlane.computeWorldMatrix(!0) }, e.prototype.detach = function () { this._pointerObserver && this._scene.onPointerObservable.remove(this._pointerObserver), this._beforeRenderObserver && this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver) }, e._AnyMouseID = -2, e }(), is.PointerDragBehavior = rs, ns = $a || ($a = {}), os = function () { function e() { this._startDistance = 0, this._initialScale = new ns.Vector3(0, 0, 0), this._targetScale = new ns.Vector3(0, 0, 0), this._sceneRenderObserver = null, this._dragBehaviorA = new ns.PointerDragBehavior({}), this._dragBehaviorA.moveAttached = !1, this._dragBehaviorB = new ns.PointerDragBehavior({}), this._dragBehaviorB.moveAttached = !1 } return Object.defineProperty(e.prototype, "name", { get: function () { return "MultiPointerScale" }, enumerable: !0, configurable: !0 }), e.prototype.init = function () { }, e.prototype._getCurrentDistance = function () { return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length() }, e.prototype.attach = function (e) { var t = this; this._ownerNode = e, this._dragBehaviorA.onDragStartObservable.add(function (i) { t._dragBehaviorA.dragging && t._dragBehaviorB.dragging && (t._dragBehaviorA.currentDraggingPointerID == t._dragBehaviorB.currentDraggingPointerID ? t._dragBehaviorA.releaseDrag() : (t._initialScale.copyFrom(e.scaling), t._startDistance = t._getCurrentDistance())) }), this._dragBehaviorB.onDragStartObservable.add(function (i) { t._dragBehaviorA.dragging && t._dragBehaviorB.dragging && (t._dragBehaviorA.currentDraggingPointerID == t._dragBehaviorB.currentDraggingPointerID ? t._dragBehaviorB.releaseDrag() : (t._initialScale.copyFrom(e.scaling), t._startDistance = t._getCurrentDistance())) }), [this._dragBehaviorA, this._dragBehaviorB].forEach(function (e) { e.onDragObservable.add(function () { if (t._dragBehaviorA.dragging && t._dragBehaviorB.dragging) { var e = t._getCurrentDistance() / t._startDistance; t._initialScale.scaleToRef(e, t._targetScale) } }) }), e.addBehavior(this._dragBehaviorA), e.addBehavior(this._dragBehaviorB), this._sceneRenderObserver = e.getScene().onBeforeRenderObservable.add(function () { if (t._dragBehaviorA.dragging && t._dragBehaviorB.dragging) { var i = t._targetScale.subtract(e.scaling).scaleInPlace(.1); .01 < i.length() && e.scaling.addInPlace(i) } }) }, e.prototype.detach = function () { var e = this; this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver), [this._dragBehaviorA, this._dragBehaviorB].forEach(function (t) { t.onDragStartObservable.clear(), t.onDragObservable.clear(), e._ownerNode.removeBehavior(t) }) }, e }(), ns.MultiPointerScaleBehavior = os, ss = $a || ($a = {}), as = function () { function e() { this._sceneRenderObserver = null, this._targetPosition = new ss.Vector3(0, 0, 0), this._moving = !1, this._startingOrientation = new ss.Quaternion, this.zDragFactor = 3, this.dragging = !1, this.dragDeltaRatio = .2, this.currentDraggingPointerID = -1, this.detachCameraControls = !0, this.onDragStartObservable = new ss.Observable, this.onDragEndObservable = new ss.Observable } return Object.defineProperty(e.prototype, "name", { get: function () { return "SixDofDrag" }, enumerable: !0, configurable: !0 }), e.prototype.init = function () { }, e.prototype.attach = function (t) { var i = this; this._ownerNode = t, this._scene = this._ownerNode.getScene(), e._virtualScene || ((e._virtualScene = new ss.Scene(this._scene.getEngine())).detachControl(), this._scene.getEngine().scenes.pop()); var r = null, n = new ss.Vector3(0, 0, 0); this._virtualOriginMesh = new ss.AbstractMesh("", e._virtualScene), this._virtualOriginMesh.rotationQuaternion = new ss.Quaternion, this._virtualDragMesh = new ss.AbstractMesh("", e._virtualScene), this._virtualDragMesh.rotationQuaternion = new ss.Quaternion; var o = null; this._pointerObserver = this._scene.onPointerObservable.add(function (e, t) { if (e.type == ss.PointerEventTypes.POINTERDOWN) { if (!i.dragging && e.pickInfo && e.pickInfo.hit && e.pickInfo.pickedMesh && e.pickInfo.ray && (h = e.pickInfo.pickedMesh, i._ownerNode == h || h.isDescendantOf(i._ownerNode))) { i._scene.activeCamera && i._scene.activeCamera.cameraRigMode == ss.Camera.RIG_MODE_NONE && e.pickInfo.ray.origin.copyFrom(i._scene.activeCamera.position), r = i._ownerNode, ss.BoundingBoxGizmo._RemoveAndStorePivotPoint(r), n.copyFrom(e.pickInfo.ray.origin), i._virtualOriginMesh.position.copyFrom(e.pickInfo.ray.origin), i._virtualOriginMesh.lookAt(e.pickInfo.ray.origin.subtract(e.pickInfo.ray.direction)), i._virtualOriginMesh.removeChild(i._virtualDragMesh), r.computeWorldMatrix(), i._virtualDragMesh.position.copyFrom(r.absolutePosition), r.rotationQuaternion || (r.rotationQuaternion = ss.Quaternion.RotationYawPitchRoll(r.rotation.y, r.rotation.x, r.rotation.z)); var s = r.parent; r.setParent(null), i._virtualDragMesh.rotationQuaternion.copyFrom(r.rotationQuaternion), r.setParent(s), i._virtualOriginMesh.addChild(i._virtualDragMesh), i._targetPosition.copyFrom(i._virtualDragMesh.absolutePosition), i.dragging = !0, i.currentDraggingPointerID = e.event.pointerId, i.detachCameraControls && i._scene.activeCamera && !i._scene.activeCamera.leftCamera && (i._scene.activeCamera.inputs.attachedElement ? (o = i._scene.activeCamera.inputs.attachedElement, i._scene.activeCamera.detachControl(i._scene.activeCamera.inputs.attachedElement)) : o = null), ss.BoundingBoxGizmo._RestorePivotPoint(r), i.onDragStartObservable.notifyObservers({}) } } else if (e.type == ss.PointerEventTypes.POINTERUP) i.currentDraggingPointerID == e.event.pointerId && (i.dragging = !1, i._moving = !1, i.currentDraggingPointerID = -1, r = null, i._virtualOriginMesh.removeChild(i._virtualDragMesh), i.detachCameraControls && o && i._scene.activeCamera && !i._scene.activeCamera.leftCamera && i._scene.activeCamera.attachControl(o, !0), i.onDragEndObservable.notifyObservers({})); else if (e.type == ss.PointerEventTypes.POINTERMOVE && i.currentDraggingPointerID == e.event.pointerId && i.dragging && e.pickInfo && e.pickInfo.ray && r) { var a = i.zDragFactor; i._scene.activeCamera && i._scene.activeCamera.cameraRigMode == ss.Camera.RIG_MODE_NONE && (e.pickInfo.ray.origin.copyFrom(i._scene.activeCamera.position), a = 0); var l = e.pickInfo.ray.origin.subtract(n); n.copyFrom(e.pickInfo.ray.origin); var c = -ss.Vector3.Dot(l, e.pickInfo.ray.direction); i._virtualOriginMesh.addChild(i._virtualDragMesh), i._virtualDragMesh.position.z -= i._virtualDragMesh.position.z < 1 ? c * i.zDragFactor : c * a * i._virtualDragMesh.position.z, i._virtualDragMesh.position.z < 0 && (i._virtualDragMesh.position.z = 0), i._virtualOriginMesh.position.copyFrom(e.pickInfo.ray.origin), i._virtualOriginMesh.lookAt(e.pickInfo.ray.origin.subtract(e.pickInfo.ray.direction)), i._virtualOriginMesh.removeChild(i._virtualDragMesh), i._targetPosition.copyFrom(i._virtualDragMesh.absolutePosition), r.parent && ss.Vector3.TransformCoordinatesToRef(i._targetPosition, ss.Matrix.Invert(r.parent.getWorldMatrix()), i._targetPosition), i._moving || i._startingOrientation.copyFrom(i._virtualDragMesh.rotationQuaternion), i._moving = !0 } var h }); var s = new ss.Quaternion; this._sceneRenderObserver = t.getScene().onBeforeRenderObservable.add(function () { if (i.dragging && i._moving && r) { ss.BoundingBoxGizmo._RemoveAndStorePivotPoint(r), r.position.addInPlace(i._targetPosition.subtract(r.position).scale(i.dragDeltaRatio)), s.copyFrom(i._startingOrientation), s.x = -s.x, s.y = -s.y, s.z = -s.z, i._virtualDragMesh.rotationQuaternion.multiplyToRef(s, s), ss.Quaternion.RotationYawPitchRollToRef(s.toEulerAngles("xyz").y, 0, 0, s), s.multiplyToRef(i._startingOrientation, s); var e = r.parent; r.setParent(null), ss.Quaternion.SlerpToRef(r.rotationQuaternion, s, i.dragDeltaRatio, r.rotationQuaternion), r.setParent(e), ss.BoundingBoxGizmo._RestorePivotPoint(r) } }) }, e.prototype.detach = function () { this._scene && this._scene.onPointerObservable.remove(this._pointerObserver), this._ownerNode && this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver), this._virtualOriginMesh && this._virtualOriginMesh.dispose(), this._virtualDragMesh && this._virtualDragMesh.dispose(), this.onDragEndObservable.clear(), this.onDragStartObservable.clear() }, e }(), ss.SixDofDragBehavior = as, ls = $a || ($a = {}), cs = function (e, t, i, r) { void 0 === t && (t = new ls.Vector3), void 0 === i && (i = 0), void 0 === r && (r = !1), this.direction = e, this.rotatedDirection = t, this.diff = i, this.ignore = r }, hs = function () { function e(e) { this.ui = e, this.name = "AttachToBoxBehavior", this.distanceAwayFromFace = .15, this.distanceAwayFromBottomOfFace = .15, this._faceVectors = [new cs(ls.Vector3.Up()), new cs(ls.Vector3.Down()), new cs(ls.Vector3.Left()), new cs(ls.Vector3.Right()), new cs(ls.Vector3.Forward()), new cs(ls.Vector3.Forward().scaleInPlace(-1))], this._tmpMatrix = new ls.Matrix, this._tmpVector = new ls.Vector3, this._zeroVector = ls.Vector3.Zero(), this._lookAtTmpMatrix = new ls.Matrix } return e.prototype.init = function () { }, e.prototype._closestFace = function (e) { var t = this; return this._faceVectors.forEach(function (i) { t._target.rotationQuaternion || (t._target.rotationQuaternion = ls.Quaternion.RotationYawPitchRoll(t._target.rotation.y, t._target.rotation.x, t._target.rotation.z)), t._target.rotationQuaternion.toRotationMatrix(t._tmpMatrix), ls.Vector3.TransformCoordinatesToRef(i.direction, t._tmpMatrix, i.rotatedDirection), i.diff = ls.Vector3.GetAngleBetweenVectors(i.rotatedDirection, e, ls.Vector3.Cross(i.rotatedDirection, e)) }), this._faceVectors.reduce(function (e, t) { return e.ignore ? t : t.ignore ? e : e.diff < t.diff ? e : t }, this._faceVectors[0]) }, e.prototype._lookAtToRef = function (e, t, i) { void 0 === t && (t = new ls.Vector3(0, 1, 0)), ls.Matrix.LookAtLHToRef(this._zeroVector, e, t, this._lookAtTmpMatrix), this._lookAtTmpMatrix.invert(), ls.Quaternion.FromRotationMatrixToRef(this._lookAtTmpMatrix, i) }, e.prototype.attach = function (e) { var t = this; this._target = e, this._scene = this._target.getScene(), this._onRenderObserver = this._scene.onBeforeRenderObservable.add(function () { if (t._scene.activeCamera) { var i = t._scene.activeCamera.position; t._scene.activeCamera.devicePosition && (i = t._scene.activeCamera.devicePosition); var r = t._closestFace(i.subtract(e.position)); t._scene.activeCamera.leftCamera ? t._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(t._tmpMatrix) : t._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(t._tmpMatrix), ls.Vector3.TransformCoordinatesToRef(ls.Vector3.Up(), t._tmpMatrix, t._tmpVector), t._faceVectors.forEach(function (e) { r.direction.x && e.direction.x && (e.ignore = !0), r.direction.y && e.direction.y && (e.ignore = !0), r.direction.z && e.direction.z && (e.ignore = !0) }); var n = t._closestFace(t._tmpVector); t._faceVectors.forEach(function (e) { e.ignore = !1 }), t.ui.position.copyFrom(e.position), r.direction.x && (r.rotatedDirection.scaleToRef(e.scaling.x / 2 + t.distanceAwayFromFace, t._tmpVector), t.ui.position.addInPlace(t._tmpVector)), r.direction.y && (r.rotatedDirection.scaleToRef(e.scaling.y / 2 + t.distanceAwayFromFace, t._tmpVector), t.ui.position.addInPlace(t._tmpVector)), r.direction.z && (r.rotatedDirection.scaleToRef(e.scaling.z / 2 + t.distanceAwayFromFace, t._tmpVector), t.ui.position.addInPlace(t._tmpVector)), t.ui.rotationQuaternion || (t.ui.rotationQuaternion = ls.Quaternion.RotationYawPitchRoll(t.ui.rotation.y, t.ui.rotation.x, t.ui.rotation.z)), r.rotatedDirection.scaleToRef(-1, t._tmpVector), t._lookAtToRef(t._tmpVector, n.rotatedDirection, t.ui.rotationQuaternion), n.direction.x && t.ui.up.scaleToRef(t.distanceAwayFromBottomOfFace - e.scaling.x / 2, t._tmpVector), n.direction.y && t.ui.up.scaleToRef(t.distanceAwayFromBottomOfFace - e.scaling.y / 2, t._tmpVector), n.direction.z && t.ui.up.scaleToRef(t.distanceAwayFromBottomOfFace - e.scaling.z / 2, t._tmpVector), t.ui.position.addInPlace(t._tmpVector) } }) }, e.prototype.detach = function () { this._scene.onBeforeRenderObservable.remove(this._onRenderObserver) }, e }(), ls.AttachToBoxBehavior = hs, us = $a || ($a = {}), ds = function () { function e() { var e = this; this.delay = 0, this.fadeInTime = 300, this._millisecondsPerFrame = 1e3 / 60, this._hovered = !1, this._hoverValue = 0, this._ownerNode = null, this._update = function () { if (e._ownerNode) { if (e._hoverValue += e._hovered ? e._millisecondsPerFrame : -e._millisecondsPerFrame, e._setAllVisibility(e._ownerNode, (e._hoverValue - e.delay) / e.fadeInTime), 1 < e._ownerNode.visibility) return e._setAllVisibility(e._ownerNode, 1), void (e._hoverValue = e.fadeInTime + e.delay); if (e._ownerNode.visibility < 0 && (e._setAllVisibility(e._ownerNode, 0), e._hoverValue < 0)) return void (e._hoverValue = 0); setTimeout(e._update, e._millisecondsPerFrame) } } } return Object.defineProperty(e.prototype, "name", { get: function () { return "FadeInOut" }, enumerable: !0, configurable: !0 }), e.prototype.init = function () { }, e.prototype.attach = function (e) { this._ownerNode = e, this._setAllVisibility(this._ownerNode, 0) }, e.prototype.detach = function () { this._ownerNode = null }, e.prototype.fadeIn = function (e) { this._hovered = e, this._update() }, e.prototype._setAllVisibility = function (e, t) { var i = this; e.visibility = t, e.getChildMeshes().forEach(function (e) { i._setAllVisibility(e, t) }) }, e }(), us.FadeInOutBehavior = ds, fs = $a || ($a = {}), ps = function () { function e(e) { void 0 === e && (e = fs.UtilityLayerRenderer.DefaultUtilityLayer); var t = this; this.gizmoLayer = e, this.scaleRatio = 1, this._tmpMatrix = new fs.Matrix, this._customMeshSet = !1, this.updateGizmoRotationToMatchAttachedMesh = !0, this.updateGizmoPositionToMatchAttachedMesh = !0, this._updateScale = !0, this._interactionsEnabled = !0, this._tempVector = new fs.Vector3, this._rootMesh = new fs.Mesh("gizmoRootNode", e.utilityLayerScene), this._beforeRenderObserver = this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function () { t._update() }), this.attachedMesh = null } return Object.defineProperty(e.prototype, "attachedMesh", { get: function () { return this._attachedMesh }, set: function (e) { this._attachedMesh = e, this._rootMesh.setEnabled(!!e), this._attachedMeshChanged(e) }, enumerable: !0, configurable: !0 }), e.prototype.setCustomMesh = function (e) { if (e.getScene() != this.gizmoLayer.utilityLayerScene) throw "When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)"; this._rootMesh.getChildMeshes().forEach(function (e) { e.dispose() }), e.parent = this._rootMesh, this._customMeshSet = !0 }, e.prototype._attachedMeshChanged = function (e) { }, e.prototype._update = function () { if (this.attachedMesh && (this.updateGizmoRotationToMatchAttachedMesh ? (this._rootMesh.rotationQuaternion || (this._rootMesh.rotationQuaternion = fs.Quaternion.RotationYawPitchRoll(this._rootMesh.rotation.y, this._rootMesh.rotation.x, this._rootMesh.rotation.z)), this._tempVector.copyFrom(this.attachedMesh.scaling), this.attachedMesh.scaling.x < 0 && (this.attachedMesh.scaling.x *= -1), this.attachedMesh.scaling.y < 0 && (this.attachedMesh.scaling.y *= -1), this.attachedMesh.scaling.z < 0 && (this.attachedMesh.scaling.z *= -1), this.attachedMesh.computeWorldMatrix().getRotationMatrixToRef(this._tmpMatrix), this.attachedMesh.scaling.copyFrom(this._tempVector), this.attachedMesh.computeWorldMatrix(), fs.Quaternion.FromRotationMatrixToRef(this._tmpMatrix, this._rootMesh.rotationQuaternion)) : this._rootMesh.rotationQuaternion && this._rootMesh.rotationQuaternion.set(0, 0, 0, 1), this.updateGizmoPositionToMatchAttachedMesh && this._rootMesh.position.copyFrom(this.attachedMesh.absolutePosition), this._updateScale && this.gizmoLayer.utilityLayerScene.activeCamera && this.attachedMesh)) { var e = this.gizmoLayer.utilityLayerScene.activeCamera.position; this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition && (e = this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition), this._rootMesh.position.subtractToRef(e, this._tempVector); var t = this._tempVector.length() * this.scaleRatio; this._rootMesh.scaling.set(t, t, t) } }, e.prototype.dispose = function () { this._rootMesh.dispose(), this._beforeRenderObserver && this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver) }, e }(), fs.Gizmo = ps, ms = function (e) { function t(t, i, r) { void 0 === i && (i = _s.Color3.Gray()), void 0 === r && (r = _s.UtilityLayerRenderer.DefaultUtilityLayer); var n = e.call(this, r) || this; n._pointerObserver = null, n.snapDistance = 0, n.onSnapObservable = new _s.Observable; var o = new _s.StandardMaterial("", r.utilityLayerScene); o.disableLighting = !0, o.emissiveColor = i; var s = new _s.StandardMaterial("", r.utilityLayerScene); s.disableLighting = !0, s.emissiveColor = i.add(new _s.Color3(.3, .3, .3)); var a = new _s.AbstractMesh("", r.utilityLayerScene), l = _s.MeshBuilder.CreateCylinder("yPosMesh", { diameterTop: 0, height: 1.5, diameterBottom: .75, tessellation: 96 }, r.utilityLayerScene), c = _s.MeshBuilder.CreateLines("yPosMesh", { points: [new _s.Vector3(0, 0, 0), new _s.Vector3(0, 1.1, 0)] }, r.utilityLayerScene); c.color = o.emissiveColor, a.addChild(l), a.addChild(c), l.scaling.scaleInPlace(.05), l.material = o, l.rotation.x = Math.PI / 2, l.position.z += .3, c.scaling.scaleInPlace(.26), c.rotation.x = Math.PI / 2, c.material = o, a.lookAt(n._rootMesh.position.subtract(t)), a.scaling.scaleInPlace(1 / 3), n._rootMesh.addChild(a); var h = 0, u = new _s.Vector3, d = { snapDistance: 0 }; n.dragBehavior = new _s.PointerDragBehavior({ dragAxis: t }), n.dragBehavior.moveAttached = !1, n._rootMesh.addBehavior(n.dragBehavior); var f = new _s.Vector3, p = new _s.Matrix; return n.dragBehavior.onDragObservable.add(function (e) { if (n.attachedMesh) if (n.attachedMesh.parent ? (n.attachedMesh.parent.computeWorldMatrix().invertToRef(p), p.setTranslationFromFloats(0, 0, 0), _s.Vector3.TransformCoordinatesToRef(e.delta, p, f)) : f.copyFrom(e.delta), 0 == n.snapDistance) n.attachedMesh.position.addInPlace(f); else if (h += e.dragDistance, Math.abs(h) > n.snapDistance) { var t = Math.floor(Math.abs(h) / n.snapDistance); h %= n.snapDistance, f.normalizeToRef(u), u.scaleInPlace(n.snapDistance * t), n.attachedMesh.position.addInPlace(u), d.snapDistance = n.snapDistance * t, n.onSnapObservable.notifyObservers(d) } }), n._pointerObserver = r.utilityLayerScene.onPointerObservable.add(function (e, t) { if (!n._customMeshSet) { var i = e.pickInfo && -1 != n._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh) ? s : o; n._rootMesh.getChildMeshes().forEach(function (e) { e.material = i, e.color && (e.color = i.emissiveColor) }) } }), n } return T(t, e), t.prototype._attachedMeshChanged = function (e) { this.dragBehavior && (this.dragBehavior.enabled = !!e) }, t.prototype.dispose = function () { this.onSnapObservable.clear(), this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver), this.dragBehavior.detach(), e.prototype.dispose.call(this) }, t }((_s = $a || ($a = {})).Gizmo), _s.AxisDragGizmo = ms, vs = function (e) { function t(t, i, r) { void 0 === i && (i = gs.Color3.Gray()), void 0 === r && (r = gs.UtilityLayerRenderer.DefaultUtilityLayer); var n = e.call(this, r) || this; n._pointerObserver = null, n.snapDistance = 0, n.onSnapObservable = new gs.Observable, n.uniformScaling = !1, n._coloredMaterial = new gs.StandardMaterial("", r.utilityLayerScene), n._coloredMaterial.disableLighting = !0, n._coloredMaterial.emissiveColor = i; var o = new gs.StandardMaterial("", r.utilityLayerScene); o.disableLighting = !0, o.emissiveColor = i.add(new gs.Color3(.3, .3, .3)); var s = new gs.AbstractMesh("", r.utilityLayerScene), a = gs.MeshBuilder.CreateBox("yPosMesh", { size: .4 }, r.utilityLayerScene), l = gs.MeshBuilder.CreateLines("yPosMesh", { points: [new gs.Vector3(0, 0, 0), new gs.Vector3(0, 1.1, 0)] }, r.utilityLayerScene); l.color = n._coloredMaterial.emissiveColor, s.addChild(a), s.addChild(l), a.scaling.scaleInPlace(.1), a.material = n._coloredMaterial, a.rotation.x = Math.PI / 2, a.position.z += .3, l.scaling.scaleInPlace(.26), l.rotation.x = Math.PI / 2, l.material = n._coloredMaterial, s.lookAt(n._rootMesh.position.subtract(t)), n._rootMesh.addChild(s), s.scaling.scaleInPlace(1 / 3), n.dragBehavior = new gs.PointerDragBehavior({ dragAxis: t }), n.dragBehavior.moveAttached = !1, n._rootMesh.addBehavior(n.dragBehavior); var c = 0, h = new gs.Vector3, u = { snapDistance: 0 }; return n.dragBehavior.onDragObservable.add(function (e) { if (n.attachedMesh) { var i = !1, r = 0; n.uniformScaling ? (n.attachedMesh.scaling.normalizeToRef(h), h.y < 0 && h.scaleInPlace(-1)) : h.copyFrom(t), 0 == n.snapDistance ? h.scaleToRef(e.dragDistance, h) : (c += e.dragDistance, Math.abs(c) > n.snapDistance ? (r = Math.floor(c / n.snapDistance), c %= n.snapDistance, h.scaleToRef(n.snapDistance * r, h), i = !0) : h.scaleInPlace(0)), n.attachedMesh.scaling.addInPlace(h), i && (u.snapDistance = n.snapDistance * r, n.onSnapObservable.notifyObservers(u)) } }), n._pointerObserver = r.utilityLayerScene.onPointerObservable.add(function (e, t) { if (!n._customMeshSet) { var i = e.pickInfo && -1 != n._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh) ? o : n._coloredMaterial; n._rootMesh.getChildMeshes().forEach(function (e) { e.material = i, e.color && (e.color = i.emissiveColor) }) } }), n } return T(t, e), t.prototype._attachedMeshChanged = function (e) { this.dragBehavior && (this.dragBehavior.enabled = !!e) }, t.prototype.dispose = function () { this.onSnapObservable.clear(), this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver), this.dragBehavior.detach(), e.prototype.dispose.call(this) }, t.prototype.setCustomMesh = function (t, i) { var r = this; void 0 === i && (i = !1), e.prototype.setCustomMesh.call(this, t), i && (this._rootMesh.getChildMeshes().forEach(function (e) { e.material = r._coloredMaterial, e.color && (e.color = r._coloredMaterial.emissiveColor) }), this._customMeshSet = !1) }, t }((gs = $a || ($a = {})).Gizmo), gs.AxisScaleGizmo = vs, bs = function (e) { function t(t, i, r, n) { void 0 === i && (i = ys.Color3.Gray()), void 0 === r && (r = ys.UtilityLayerRenderer.DefaultUtilityLayer), void 0 === n && (n = 32); var o = e.call(this, r) || this; o._pointerObserver = null, o.snapDistance = 0, o.onSnapObservable = new ys.Observable; var s = new ys.StandardMaterial("", r.utilityLayerScene); s.disableLighting = !0, s.emissiveColor = i; var a = new ys.StandardMaterial("", r.utilityLayerScene); a.disableLighting = !0, a.emissiveColor = i.add(new ys.Color3(.3, .3, .3)); for (var l = new ys.AbstractMesh("", r.utilityLayerScene), c = new Array, h = 0; h < n; h++) { var u = 2 * Math.PI * (h / (n - 1)); c.push(new ys.Vector3(.8 * Math.sin(u), 0, .8 * Math.cos(u))) } var d = ys.Mesh.CreateLines("", c, r.utilityLayerScene); d.color = s.emissiveColor, d.scaling.scaleInPlace(.26), d.material = s, d.rotation.x = Math.PI / 2, l.addChild(d), l.lookAt(o._rootMesh.position.subtract(t)), o._rootMesh.addChild(l), l.scaling.scaleInPlace(1 / 3), o.dragBehavior = new ys.PointerDragBehavior({ dragPlaneNormal: t }), o.dragBehavior.moveAttached = !1, o.dragBehavior.maxDragAngle = 9 * Math.PI / 20, o.dragBehavior._useAlternatePickedPointAboveMaxDragAngle = !0, o._rootMesh.addBehavior(o.dragBehavior); var f = new ys.Vector3; o.dragBehavior.onDragStartObservable.add(function (e) { o.attachedMesh && f.copyFrom(e.dragPlanePoint) }); var p = new ys.Matrix, _ = new ys.Vector3, m = new ys.Vector3, g = { snapDistance: 0 }, v = 0, y = new ys.Matrix, b = new ys.Vector3, T = new ys.Quaternion; return o.dragBehavior.onDragObservable.add(function (e) { if (o.attachedMesh) { o.attachedMesh.rotationQuaternion || (o.attachedMesh.rotationQuaternion = ys.Quaternion.RotationYawPitchRoll(o.attachedMesh.rotation.y, o.attachedMesh.rotation.x, o.attachedMesh.rotation.z)); var i = e.dragPlanePoint.subtract(o.attachedMesh.absolutePosition).normalize(), n = f.subtract(o.attachedMesh.absolutePosition).normalize(), s = ys.Vector3.Cross(i, n), a = ys.Vector3.Dot(i, n), l = Math.atan2(s.length(), a); if (_.copyFrom(t), m.copyFrom(t), o.updateGizmoRotationToMatchAttachedMesh && (o.attachedMesh.rotationQuaternion.toRotationMatrix(p), m = ys.Vector3.TransformCoordinates(_, p)), r.utilityLayerScene.activeCamera) { var c = r.utilityLayerScene.activeCamera.position.subtract(o.attachedMesh.position); 0 < ys.Vector3.Dot(c, m) && (_.scaleInPlace(-1), m.scaleInPlace(-1)) } 0 < ys.Vector3.Dot(m, s) && (l = -l); var h = !1; if (0 != o.snapDistance) if (v += l, Math.abs(v) > o.snapDistance) { var u = Math.floor(v / o.snapDistance); v %= o.snapDistance, l = o.snapDistance * u, h = !0 } else l = 0; y.reset(), o.attachedMesh.parent && (o.attachedMesh.parent.computeWorldMatrix().invertToRef(y), y.getRotationMatrixToRef(y), ys.Vector3.TransformCoordinatesToRef(_, y, _)); var d = Math.sin(l / 2); T.set(_.x * d, _.y * d, _.z * d, Math.cos(l / 2)), 0 < y.determinant() && (T.toEulerAnglesToRef(b), ys.Quaternion.RotationYawPitchRollToRef(b.y, -b.x, -b.z, T)), o.updateGizmoRotationToMatchAttachedMesh ? o.attachedMesh.rotationQuaternion.multiplyToRef(T, o.attachedMesh.rotationQuaternion) : T.multiplyToRef(o.attachedMesh.rotationQuaternion, o.attachedMesh.rotationQuaternion), f.copyFrom(e.dragPlanePoint), h && (g.snapDistance = l, o.onSnapObservable.notifyObservers(g)) } }), o._pointerObserver = r.utilityLayerScene.onPointerObservable.add(function (e, t) { if (!o._customMeshSet) { var i = e.pickInfo && -1 != o._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh) ? a : s; o._rootMesh.getChildMeshes().forEach(function (e) { e.material = i, e.color && (e.color = i.emissiveColor) }) } }), o } return T(t, e), t.prototype._attachedMeshChanged = function (e) { this.dragBehavior && (this.dragBehavior.enabled = !!e) }, t.prototype.dispose = function () { this.onSnapObservable.clear(), this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver), this.dragBehavior.detach(), e.prototype.dispose.call(this) }, t }((ys = $a || ($a = {})).Gizmo), ys.PlaneRotationGizmo = bs, Es = function (e) { function t(t) { void 0 === t && (t = Ts.UtilityLayerRenderer.DefaultUtilityLayer); var i = e.call(this, t) || this; return i.onDragStartObservable = new Ts.Observable, i.onDragEndObservable = new Ts.Observable, i.xGizmo = new Ts.AxisDragGizmo(new Ts.Vector3(1, 0, 0), Ts.Color3.Red().scale(.5), t), i.yGizmo = new Ts.AxisDragGizmo(new Ts.Vector3(0, 1, 0), Ts.Color3.Green().scale(.5), t), i.zGizmo = new Ts.AxisDragGizmo(new Ts.Vector3(0, 0, 1), Ts.Color3.Blue().scale(.5), t), [i.xGizmo, i.yGizmo, i.zGizmo].forEach(function (e) { e.dragBehavior.onDragStartObservable.add(function () { i.onDragStartObservable.notifyObservers({}) }), e.dragBehavior.onDragEndObservable.add(function () { i.onDragEndObservable.notifyObservers({}) }) }), i.attachedMesh = null, i } return T(t, e), Object.defineProperty(t.prototype, "attachedMesh", { set: function (e) { this.xGizmo && (this.xGizmo.attachedMesh = e, this.yGizmo.attachedMesh = e, this.zGizmo.attachedMesh = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "updateGizmoRotationToMatchAttachedMesh", { get: function () { return this.xGizmo.updateGizmoRotationToMatchAttachedMesh }, set: function (e) { this.xGizmo && (this.xGizmo.updateGizmoRotationToMatchAttachedMesh = e, this.yGizmo.updateGizmoRotationToMatchAttachedMesh = e, this.zGizmo.updateGizmoRotationToMatchAttachedMesh = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "snapDistance", { get: function () { return this.xGizmo.snapDistance }, set: function (e) { this.xGizmo && (this.xGizmo.snapDistance = e, this.yGizmo.snapDistance = e, this.zGizmo.snapDistance = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "scaleRatio", { get: function () { return this.xGizmo.scaleRatio }, set: function (e) { this.xGizmo && (this.xGizmo.scaleRatio = e, this.yGizmo.scaleRatio = e, this.zGizmo.scaleRatio = e) }, enumerable: !0, configurable: !0 }), t.prototype.dispose = function () { this.xGizmo.dispose(), this.yGizmo.dispose(), this.zGizmo.dispose(), this.onDragStartObservable.clear(), this.onDragEndObservable.clear() }, t.prototype.setCustomMesh = function (e) { Ts.Tools.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)") }, t }((Ts = $a || ($a = {})).Gizmo), Ts.PositionGizmo = Es, Ps = function (e) { function t(t, i) { void 0 === t && (t = xs.UtilityLayerRenderer.DefaultUtilityLayer), void 0 === i && (i = 32); var r = e.call(this, t) || this; return r.onDragStartObservable = new xs.Observable, r.onDragEndObservable = new xs.Observable, r.xGizmo = new xs.PlaneRotationGizmo(new xs.Vector3(1, 0, 0), xs.Color3.Red().scale(.5), t, i), r.yGizmo = new xs.PlaneRotationGizmo(new xs.Vector3(0, 1, 0), xs.Color3.Green().scale(.5), t, i), r.zGizmo = new xs.PlaneRotationGizmo(new xs.Vector3(0, 0, 1), xs.Color3.Blue().scale(.5), t, i), [r.xGizmo, r.yGizmo, r.zGizmo].forEach(function (e) { e.dragBehavior.onDragStartObservable.add(function () { r.onDragStartObservable.notifyObservers({}) }), e.dragBehavior.onDragEndObservable.add(function () { r.onDragEndObservable.notifyObservers({}) }) }), r.attachedMesh = null, r } return T(t, e), Object.defineProperty(t.prototype, "attachedMesh", { set: function (e) { this.xGizmo && (this.xGizmo.attachedMesh = e, this.yGizmo.attachedMesh = e, this.zGizmo.attachedMesh = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "updateGizmoRotationToMatchAttachedMesh", { get: function () { return this.xGizmo.updateGizmoRotationToMatchAttachedMesh }, set: function (e) { this.xGizmo && (this.xGizmo.updateGizmoRotationToMatchAttachedMesh = e, this.yGizmo.updateGizmoRotationToMatchAttachedMesh = e, this.zGizmo.updateGizmoRotationToMatchAttachedMesh = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "snapDistance", { get: function () { return this.xGizmo.snapDistance }, set: function (e) { this.xGizmo && (this.xGizmo.snapDistance = e, this.yGizmo.snapDistance = e, this.zGizmo.snapDistance = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "scaleRatio", { get: function () { return this.xGizmo.scaleRatio }, set: function (e) { this.xGizmo && (this.xGizmo.scaleRatio = e, this.yGizmo.scaleRatio = e, this.zGizmo.scaleRatio = e) }, enumerable: !0, configurable: !0 }), t.prototype.dispose = function () { this.xGizmo.dispose(), this.yGizmo.dispose(), this.zGizmo.dispose(), this.onDragStartObservable.clear(), this.onDragEndObservable.clear() }, t.prototype.setCustomMesh = function (e) { xs.Tools.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)") }, t }((xs = $a || ($a = {})).Gizmo), xs.RotationGizmo = Ps, Ss = function (e) { function t(t) { void 0 === t && (t = As.UtilityLayerRenderer.DefaultUtilityLayer); var i = e.call(this, t) || this; i.onDragStartObservable = new As.Observable, i.onDragEndObservable = new As.Observable, i.xGizmo = new As.AxisScaleGizmo(new As.Vector3(1, 0, 0), As.Color3.Red().scale(.5), t), i.yGizmo = new As.AxisScaleGizmo(new As.Vector3(0, 1, 0), As.Color3.Green().scale(.5), t), i.zGizmo = new As.AxisScaleGizmo(new As.Vector3(0, 0, 1), As.Color3.Blue().scale(.5), t), i.uniformScaleGizmo = new As.AxisScaleGizmo(new As.Vector3(0, 1, 0), As.Color3.Yellow().scale(.5), t), i.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh = !1, i.uniformScaleGizmo.uniformScaling = !0; var r = As.Mesh.CreatePolyhedron("", { type: 1 }, i.uniformScaleGizmo.gizmoLayer.utilityLayerScene); r.scaling.scaleInPlace(.02), r.visibility = 0; var n = As.Mesh.CreatePolyhedron("", { type: 1 }, i.uniformScaleGizmo.gizmoLayer.utilityLayerScene); return n.scaling.scaleInPlace(.007), r.addChild(n), i.uniformScaleGizmo.setCustomMesh(r, !0), [i.xGizmo, i.yGizmo, i.zGizmo, i.uniformScaleGizmo].forEach(function (e) { e.dragBehavior.onDragStartObservable.add(function () { i.onDragStartObservable.notifyObservers({}) }), e.dragBehavior.onDragEndObservable.add(function () { i.onDragEndObservable.notifyObservers({}) }) }), i.attachedMesh = null, i } return T(t, e), Object.defineProperty(t.prototype, "attachedMesh", { set: function (e) { this.xGizmo && (this.xGizmo.attachedMesh = e, this.yGizmo.attachedMesh = e, this.zGizmo.attachedMesh = e, this.uniformScaleGizmo.attachedMesh = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "updateGizmoRotationToMatchAttachedMesh", { get: function () { return this.xGizmo.updateGizmoRotationToMatchAttachedMesh }, set: function (e) { e || As.Tools.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported."), this.xGizmo && (this.xGizmo.updateGizmoRotationToMatchAttachedMesh = e, this.yGizmo.updateGizmoRotationToMatchAttachedMesh = e, this.zGizmo.updateGizmoRotationToMatchAttachedMesh = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "snapDistance", { get: function () { return this.xGizmo.snapDistance }, set: function (e) { this.xGizmo && (this.xGizmo.snapDistance = e, this.yGizmo.snapDistance = e, this.zGizmo.snapDistance = e, this.uniformScaleGizmo.snapDistance = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "scaleRatio", { get: function () { return this.xGizmo.scaleRatio }, set: function (e) { this.xGizmo && (this.xGizmo.scaleRatio = e, this.yGizmo.scaleRatio = e, this.zGizmo.scaleRatio = e, this.uniformScaleGizmo.scaleRatio = e) }, enumerable: !0, configurable: !0 }), t.prototype.dispose = function () { this.xGizmo.dispose(), this.yGizmo.dispose(), this.zGizmo.dispose(), this.uniformScaleGizmo.dispose(), this.onDragStartObservable.clear(), this.onDragEndObservable.clear() }, t }((As = $a || ($a = {})).Gizmo), As.ScaleGizmo = Ss, Rs = function (e) { function t(i, r) { void 0 === i && (i = Ms.Color3.Gray()), void 0 === r && (r = Ms.UtilityLayerRenderer.DefaultKeepDepthUtilityLayer); var n = e.call(this, r) || this; n._boundingDimensions = new Ms.Vector3(1, 1, 1), n._renderObserver = null, n._pointerObserver = null, n._scaleDragSpeed = .2, n._tmpQuaternion = new Ms.Quaternion, n._tmpVector = new Ms.Vector3(0, 0, 0), n._tmpRotationMatrix = new Ms.Matrix, n.ignoreChildren = !1, n.includeChildPredicate = null, n.rotationSphereSize = .1, n.scaleBoxSize = .1, n.fixedDragMeshScreenSize = !1, n.fixedDragMeshScreenSizeDistanceFactor = 10, n.onDragStartObservable = new Ms.Observable, n.onScaleBoxDragObservable = new Ms.Observable, n.onScaleBoxDragEndObservable = new Ms.Observable, n.onRotationSphereDragObservable = new Ms.Observable, n.onRotationSphereDragEndObservable = new Ms.Observable, n.scalePivot = null, n._existingMeshScale = new Ms.Vector3, n._updateScale = !1, n._anchorMesh = new Ms.AbstractMesh("anchor", r.utilityLayerScene); var o = new Ms.StandardMaterial("", r.utilityLayerScene); o.disableLighting = !0, o.emissiveColor = i; var s = new Ms.StandardMaterial("", r.utilityLayerScene); s.disableLighting = !0, s.emissiveColor = i.clone().add(new Ms.Color3(.3, .3, .3)), n._lineBoundingBox = new Ms.AbstractMesh("", r.utilityLayerScene), n._lineBoundingBox.rotationQuaternion = new Ms.Quaternion; var a = []; a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(0, 0, 0), new Ms.Vector3(n._boundingDimensions.x, 0, 0)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(0, 0, 0), new Ms.Vector3(0, n._boundingDimensions.y, 0)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(0, 0, 0), new Ms.Vector3(0, 0, n._boundingDimensions.z)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(n._boundingDimensions.x, 0, 0), new Ms.Vector3(n._boundingDimensions.x, n._boundingDimensions.y, 0)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(n._boundingDimensions.x, 0, 0), new Ms.Vector3(n._boundingDimensions.x, 0, n._boundingDimensions.z)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(0, n._boundingDimensions.y, 0), new Ms.Vector3(n._boundingDimensions.x, n._boundingDimensions.y, 0)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(0, n._boundingDimensions.y, 0), new Ms.Vector3(0, n._boundingDimensions.y, n._boundingDimensions.z)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(0, 0, n._boundingDimensions.z), new Ms.Vector3(n._boundingDimensions.x, 0, n._boundingDimensions.z)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(0, 0, n._boundingDimensions.z), new Ms.Vector3(0, n._boundingDimensions.y, n._boundingDimensions.z)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(n._boundingDimensions.x, n._boundingDimensions.y, n._boundingDimensions.z), new Ms.Vector3(0, n._boundingDimensions.y, n._boundingDimensions.z)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(n._boundingDimensions.x, n._boundingDimensions.y, n._boundingDimensions.z), new Ms.Vector3(n._boundingDimensions.x, 0, n._boundingDimensions.z)] }, r.utilityLayerScene)), a.push(Ms.MeshBuilder.CreateLines("lines", { points: [new Ms.Vector3(n._boundingDimensions.x, n._boundingDimensions.y, n._boundingDimensions.z), new Ms.Vector3(n._boundingDimensions.x, n._boundingDimensions.y, 0)] }, r.utilityLayerScene)), a.forEach(function (e) { e.color = i, e.position.addInPlace(new Ms.Vector3(-n._boundingDimensions.x / 2, -n._boundingDimensions.y / 2, -n._boundingDimensions.z / 2)), e.isPickable = !1, n._lineBoundingBox.addChild(e) }), n._rootMesh.addChild(n._lineBoundingBox), n._rotateSpheresParent = new Ms.AbstractMesh("", r.utilityLayerScene), n._rotateSpheresParent.rotationQuaternion = new Ms.Quaternion; for (var l = function (e) { var i = Ms.MeshBuilder.CreateSphere("", { diameter: 1 }, r.utilityLayerScene); i.rotationQuaternion = new Ms.Quaternion, i.material = o, (f = new Ms.PointerDragBehavior({})).moveAttached = !1, f.updateDragPlane = !1, i.addBehavior(f); var s = new Ms.Vector3(1, 0, 0), a = 0; f.onDragStartObservable.add(function (e) { s.copyFrom(i.forward), a = 0 }), f.onDragObservable.add(function (i) { if (n.onRotationSphereDragObservable.notifyObservers({}), n.attachedMesh) { t._RemoveAndStorePivotPoint(n.attachedMesh); var r = s, o = i.dragPlaneNormal.scale(Ms.Vector3.Dot(i.dragPlaneNormal, r)), l = r.subtract(o).normalizeToNew(), c = -Ms.Vector3.Dot(l, i.delta); c = c / n._boundingDimensions.length() * n._anchorMesh.scaling.length(), n.attachedMesh.rotationQuaternion || (n.attachedMesh.rotationQuaternion = Ms.Quaternion.RotationYawPitchRoll(n.attachedMesh.rotation.y, n.attachedMesh.rotation.x, n.attachedMesh.rotation.z)), n._anchorMesh.rotationQuaternion || (n._anchorMesh.rotationQuaternion = Ms.Quaternion.RotationYawPitchRoll(n._anchorMesh.rotation.y, n._anchorMesh.rotation.x, n._anchorMesh.rotation.z)), a += c, Math.abs(a) <= 2 * Math.PI && (8 <= e ? Ms.Quaternion.RotationYawPitchRollToRef(0, 0, c, n._tmpQuaternion) : 4 <= e ? Ms.Quaternion.RotationYawPitchRollToRef(c, 0, 0, n._tmpQuaternion) : Ms.Quaternion.RotationYawPitchRollToRef(0, c, 0, n._tmpQuaternion), n._anchorMesh.addChild(n.attachedMesh), n._anchorMesh.rotationQuaternion.multiplyToRef(n._tmpQuaternion, n._anchorMesh.rotationQuaternion), n._anchorMesh.removeChild(n.attachedMesh)), n.updateBoundingBox(), t._RestorePivotPoint(n.attachedMesh) } }), f.onDragStartObservable.add(function () { n.onDragStartObservable.notifyObservers({}), n._selectNode(i) }), f.onDragEndObservable.add(function () { n.onRotationSphereDragEndObservable.notifyObservers({}), n._selectNode(null) }), c._rotateSpheresParent.addChild(i) }, c = this, h = 0; h < 12; h++)l(h); n._rootMesh.addChild(n._rotateSpheresParent), n._scaleBoxesParent = new Ms.AbstractMesh("", r.utilityLayerScene), n._scaleBoxesParent.rotationQuaternion = new Ms.Quaternion; for (var u = 0; u < 2; u++)for (var d = 0; d < 2; d++)for (var f, p = function () { var e = Ms.MeshBuilder.CreateBox("", { size: 1 }, r.utilityLayerScene); e.material = o; var i = new Ms.Vector3(0 == u ? -1 : 1, 0 == d ? -1 : 1, 0 == m ? -1 : 1); (f = new Ms.PointerDragBehavior({ dragAxis: i })).moveAttached = !1, e.addBehavior(f), f.onDragObservable.add(function (i) { if (n.onScaleBoxDragObservable.notifyObservers({}), n.attachedMesh) { t._RemoveAndStorePivotPoint(n.attachedMesh); var r = i.dragDistance / n._boundingDimensions.length() * n._anchorMesh.scaling.length(), o = new Ms.Vector3(r, r, r); o.scaleInPlace(n._scaleDragSpeed), n.updateBoundingBox(), n.scalePivot ? (n.attachedMesh.getWorldMatrix().getRotationMatrixToRef(n._tmpRotationMatrix), n._boundingDimensions.scaleToRef(.5, n._tmpVector), Ms.Vector3.TransformCoordinatesToRef(n._tmpVector, n._tmpRotationMatrix, n._tmpVector), n._anchorMesh.position.subtractInPlace(n._tmpVector), n._boundingDimensions.multiplyToRef(n.scalePivot, n._tmpVector), Ms.Vector3.TransformCoordinatesToRef(n._tmpVector, n._tmpRotationMatrix, n._tmpVector), n._anchorMesh.position.addInPlace(n._tmpVector)) : (e.absolutePosition.subtractToRef(n._anchorMesh.position, n._tmpVector), n._anchorMesh.position.subtractInPlace(n._tmpVector)), n._anchorMesh.addChild(n.attachedMesh), n._anchorMesh.scaling.addInPlace(o), (n._anchorMesh.scaling.x < 0 || n._anchorMesh.scaling.y < 0 || n._anchorMesh.scaling.z < 0) && n._anchorMesh.scaling.subtractInPlace(o), n._anchorMesh.removeChild(n.attachedMesh), t._RestorePivotPoint(n.attachedMesh) } }), f.onDragStartObservable.add(function () { n.onDragStartObservable.notifyObservers({}), n._selectNode(e) }), f.onDragEndObservable.add(function () { n.onScaleBoxDragEndObservable.notifyObservers({}), n._selectNode(null) }), _._scaleBoxesParent.addChild(e) }, _ = this, m = 0; m < 2; m++)p(); n._rootMesh.addChild(n._scaleBoxesParent); var g = new Array; return n._pointerObserver = r.utilityLayerScene.onPointerObservable.add(function (e, t) { g[e.event.pointerId] ? e.pickInfo && e.pickInfo.pickedMesh != g[e.event.pointerId] && (g[e.event.pointerId].material = o, delete g[e.event.pointerId]) : n._rotateSpheresParent.getChildMeshes().concat(n._scaleBoxesParent.getChildMeshes()).forEach(function (t) { e.pickInfo && e.pickInfo.pickedMesh == t && ((g[e.event.pointerId] = t).material = s) }) }), n._renderObserver = n.gizmoLayer.originalScene.onBeforeRenderObservable.add(function () { n.attachedMesh && !n._existingMeshScale.equals(n.attachedMesh.scaling) && n.updateBoundingBox() }), n.updateBoundingBox(), n } return T(t, e), t._RemoveAndStorePivotPoint = function (e) { e && 0 === t._PivotCached && (e.getPivotPointToRef(t._OldPivotPoint), t._OldPivotPoint.equalsToFloats(0, 0, 0) || (e.setPivotMatrix(Ms.Matrix.IdentityReadOnly), t._OldPivotPoint.subtractToRef(e.getPivotPoint(), t._PivotTranslation), t._PivotTmpVector.copyFromFloats(1, 1, 1), t._PivotTmpVector.subtractInPlace(e.scaling), t._PivotTmpVector.multiplyInPlace(t._PivotTranslation), e.position.addInPlace(t._PivotTmpVector))), t._PivotCached++ }, t._RestorePivotPoint = function (e) { e && !t._OldPivotPoint.equalsToFloats(0, 0, 0) && 1 === t._PivotCached && (e.setPivotPoint(t._OldPivotPoint), t._PivotTmpVector.copyFromFloats(1, 1, 1), t._PivotTmpVector.subtractInPlace(e.scaling), t._PivotTmpVector.multiplyInPlace(t._PivotTranslation), e.position.subtractInPlace(t._PivotTmpVector)), this._PivotCached-- }, t.prototype._attachedMeshChanged = function (e) { e && (t._RemoveAndStorePivotPoint(e), this._anchorMesh.addChild(e), this._anchorMesh.removeChild(e), t._RestorePivotPoint(e), this.updateBoundingBox()) }, t.prototype._selectNode = function (e) { this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function (t, i) { t.isVisible = !e || t == e }) }, t.prototype.updateBoundingBox = function () { if (this.attachedMesh) { t._RemoveAndStorePivotPoint(this.attachedMesh), this._update(), this.attachedMesh.rotationQuaternion || (this.attachedMesh.rotationQuaternion = Ms.Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y, this.attachedMesh.rotation.x, this.attachedMesh.rotation.z)), this._anchorMesh.rotationQuaternion || (this._anchorMesh.rotationQuaternion = Ms.Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y, this._anchorMesh.rotation.x, this._anchorMesh.rotation.z)), this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion), this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion), this._tmpVector.copyFrom(this.attachedMesh.position), this.attachedMesh.rotationQuaternion.set(0, 0, 0, 1), this.attachedMesh.position.set(0, 0, 0); var e = this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren, this.includeChildPredicate); e.max.subtractToRef(e.min, this._boundingDimensions), this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions), this._lineBoundingBox.position.set((e.max.x + e.min.x) / 2, (e.max.y + e.min.y) / 2, (e.max.z + e.min.z) / 2), this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position), this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position), this._lineBoundingBox.computeWorldMatrix(), this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition), this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion), this.attachedMesh.position.copyFrom(this._tmpVector) } for (var i = this._rotateSpheresParent.getChildMeshes(), r = 0; r < 3; r++)for (var n = 0; n < 2; n++)for (var o = 0; o < 2; o++) { var s = 4 * r + 2 * n + o; if (0 == r && (i[s].position.set(this._boundingDimensions.x / 2, this._boundingDimensions.y * n, this._boundingDimensions.z * o), i[s].position.addInPlace(new Ms.Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2)), i[s].lookAt(Ms.Vector3.Cross(Ms.Vector3.Right(), i[s].position.normalizeToNew()).normalizeToNew().add(i[s].position))), 1 == r && (i[s].position.set(this._boundingDimensions.x * n, this._boundingDimensions.y / 2, this._boundingDimensions.z * o), i[s].position.addInPlace(new Ms.Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2)), i[s].lookAt(Ms.Vector3.Cross(Ms.Vector3.Up(), i[s].position.normalizeToNew()).normalizeToNew().add(i[s].position))), 2 == r && (i[s].position.set(this._boundingDimensions.x * n, this._boundingDimensions.y * o, this._boundingDimensions.z / 2), i[s].position.addInPlace(new Ms.Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2)), i[s].lookAt(Ms.Vector3.Cross(Ms.Vector3.Forward(), i[s].position.normalizeToNew()).normalizeToNew().add(i[s].position))), this.fixedDragMeshScreenSize) { this._rootMesh.computeWorldMatrix(), this._rotateSpheresParent.computeWorldMatrix(), i[s].computeWorldMatrix(), i[s].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position, this._tmpVector); var a = this.rotationSphereSize * this._tmpVector.length() / this.fixedDragMeshScreenSizeDistanceFactor; i[s].scaling.set(a, a, a) } else i[s].scaling.set(this.rotationSphereSize, this.rotationSphereSize, this.rotationSphereSize) } var l = this._scaleBoxesParent.getChildMeshes(); for (r = 0; r < 2; r++)for (n = 0; n < 2; n++)for (o = 0; o < 2; o++)l[s = 4 * r + 2 * n + o] && (l[s].position.set(this._boundingDimensions.x * r, this._boundingDimensions.y * n, this._boundingDimensions.z * o), l[s].position.addInPlace(new Ms.Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2)), this.fixedDragMeshScreenSize ? (this._rootMesh.computeWorldMatrix(), this._scaleBoxesParent.computeWorldMatrix(), l[s].computeWorldMatrix(), l[s].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position, this._tmpVector), a = this.scaleBoxSize * this._tmpVector.length() / this.fixedDragMeshScreenSizeDistanceFactor, l[s].scaling.set(a, a, a)) : l[s].scaling.set(this.scaleBoxSize, this.scaleBoxSize, this.scaleBoxSize)); this.attachedMesh && (this._existingMeshScale.copyFrom(this.attachedMesh.scaling), t._RestorePivotPoint(this.attachedMesh)) }, t.prototype.setEnabledRotationAxis = function (e) { this._rotateSpheresParent.getChildMeshes().forEach(function (t, i) { i < 4 ? t.setEnabled(-1 != e.indexOf("x")) : i < 8 ? t.setEnabled(-1 != e.indexOf("y")) : t.setEnabled(-1 != e.indexOf("z")) }) }, t.prototype.dispose = function () { this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver), this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver), this._lineBoundingBox.dispose(), this._rotateSpheresParent.dispose(), this._scaleBoxesParent.dispose(), e.prototype.dispose.call(this) }, t.MakeNotPickableAndWrapInBoundingBox = function (e) { var t = function (e) { e.isPickable = !1, e.getChildMeshes().forEach(function (e) { t(e) }) }; t(e), e.rotationQuaternion || (e.rotationQuaternion = Ms.Quaternion.RotationYawPitchRoll(e.rotation.y, e.rotation.x, e.rotation.z)); var i = e.position.clone(), r = e.rotationQuaternion.clone(); e.rotationQuaternion.set(0, 0, 0, 1), e.position.set(0, 0, 0); var n = Ms.MeshBuilder.CreateBox("box", { size: 1 }, e.getScene()), o = e.getHierarchyBoundingVectors(); return o.max.subtractToRef(o.min, n.scaling), n.position.set((o.max.x + o.min.x) / 2, (o.max.y + o.min.y) / 2, (o.max.z + o.min.z) / 2), e.addChild(n), e.rotationQuaternion.copyFrom(r), e.position.copyFrom(i), e.removeChild(n), n.addChild(e), n.visibility = 0, n }, t.prototype.setCustomMesh = function (e) { Ms.Tools.Error("Custom meshes are not supported on this gizmo") }, t._PivotCached = 0, t._OldPivotPoint = new Ms.Vector3, t._PivotTranslation = new Ms.Vector3, t._PivotTmpVector = new Ms.Vector3, t }((Ms = $a || ($a = {})).Gizmo), Ms.BoundingBoxGizmo = Rs, Cs = $a || ($a = {}), Os = function () { function e(e) { var t = this; this.scene = e, this._gizmosEnabled = { positionGizmo: !1, rotationGizmo: !1, scaleGizmo: !1, boundingBoxGizmo: !1 }, this._pointerObserver = null, this._attachedMesh = null, this._boundingBoxColor = Cs.Color3.FromHexString("#0984e3"), this.boundingBoxDragBehavior = new Cs.SixDofDragBehavior, this.attachableMeshes = null, this.usePointerToAttachGizmos = !0, this._defaultKeepDepthUtilityLayer = new Cs.UtilityLayerRenderer(e), this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil = !1, this._defaultUtilityLayer = new Cs.UtilityLayerRenderer(e), this.gizmos = { positionGizmo: null, rotationGizmo: null, scaleGizmo: null, boundingBoxGizmo: null }, this._pointerObserver = e.onPointerObservable.add(function (e, i) { if (t.usePointerToAttachGizmos && e.type == Cs.PointerEventTypes.POINTERDOWN) if (e.pickInfo && e.pickInfo.pickedMesh) { var r = e.pickInfo.pickedMesh; if (null == t.attachableMeshes) for (; r && null != r.parent;)r = r.parent; else { var n = !1; t.attachableMeshes.forEach(function (e) { r && (r == e || r.isDescendantOf(e)) && (r = e, n = !0) }), n || (r = null) } r instanceof Cs.AbstractMesh ? t._attachedMesh != r && t.attachToMesh(r) : t.attachToMesh(null) } else t.attachToMesh(null) }) } return e.prototype.attachToMesh = function (e) { for (var t in this._attachedMesh && this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior), this._attachedMesh = e, this.gizmos) { var i = this.gizmos[t]; i && this._gizmosEnabled[t] && (i.attachedMesh = e) } this.boundingBoxGizmoEnabled && this._attachedMesh && this._attachedMesh.addBehavior(this.boundingBoxDragBehavior) }, Object.defineProperty(e.prototype, "positionGizmoEnabled", { get: function () { return this._gizmosEnabled.positionGizmo }, set: function (e) { e ? (this.gizmos.positionGizmo || (this.gizmos.positionGizmo = new Cs.PositionGizmo(this._defaultUtilityLayer)), this.gizmos.positionGizmo.attachedMesh = this._attachedMesh) : this.gizmos.positionGizmo && (this.gizmos.positionGizmo.attachedMesh = null), this._gizmosEnabled.positionGizmo = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "rotationGizmoEnabled", { get: function () { return this._gizmosEnabled.rotationGizmo }, set: function (e) { e ? (this.gizmos.rotationGizmo || (this.gizmos.rotationGizmo = new Cs.RotationGizmo(this._defaultUtilityLayer)), this.gizmos.rotationGizmo.attachedMesh = this._attachedMesh) : this.gizmos.rotationGizmo && (this.gizmos.rotationGizmo.attachedMesh = null), this._gizmosEnabled.rotationGizmo = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "scaleGizmoEnabled", { get: function () { return this._gizmosEnabled.scaleGizmo }, set: function (e) { e ? (this.gizmos.scaleGizmo = this.gizmos.scaleGizmo || new Cs.ScaleGizmo(this._defaultUtilityLayer), this.gizmos.scaleGizmo.attachedMesh = this._attachedMesh) : this.gizmos.scaleGizmo && (this.gizmos.scaleGizmo.attachedMesh = null), this._gizmosEnabled.scaleGizmo = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "boundingBoxGizmoEnabled", { get: function () { return this._gizmosEnabled.boundingBoxGizmo }, set: function (e) { e ? (this.gizmos.boundingBoxGizmo = this.gizmos.boundingBoxGizmo || new Cs.BoundingBoxGizmo(this._boundingBoxColor, this._defaultKeepDepthUtilityLayer), this.gizmos.boundingBoxGizmo.attachedMesh = this._attachedMesh, this._attachedMesh && (this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior), this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))) : this.gizmos.boundingBoxGizmo && (this.gizmos.boundingBoxGizmo.attachedMesh = null), this._gizmosEnabled.boundingBoxGizmo = e }, enumerable: !0, configurable: !0 }), e.prototype.dispose = function () { for (var e in this.scene.onPointerObservable.remove(this._pointerObserver), this.gizmos) { var t = this.gizmos[e]; t && t.dispose() } this._defaultKeepDepthUtilityLayer.dispose(), this._defaultUtilityLayer.dispose(), this.boundingBoxDragBehavior.detach() }, e }(), Cs.GizmoManager = Os, Ds = $a || ($a = {}), Is = function () { function e(e, t, i) { void 0 === t && (t = 0), void 0 === i && (i = null), this.name = e, this.animations = new Array, this._positions = null, this._normals = null, this._tangents = null, this.onInfluenceChanged = new Ds.Observable, this._onDataLayoutChanged = new Ds.Observable, this._animationPropertiesOverride = null, this._scene = i || Ds.Engine.LastCreatedScene, this.influence = t } return Object.defineProperty(e.prototype, "influence", { get: function () { return this._influence }, set: function (e) { if (this._influence !== e) { var t = this._influence; this._influence = e, this.onInfluenceChanged.hasObservers && this.onInfluenceChanged.notifyObservers(0 === t || 0 === e) } }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "animationPropertiesOverride", { get: function () { return !this._animationPropertiesOverride && this._scene ? this._scene.animationPropertiesOverride : this._animationPropertiesOverride }, set: function (e) { this._animationPropertiesOverride = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "hasPositions", { get: function () { return !!this._positions }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "hasNormals", { get: function () { return !!this._normals }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "hasTangents", { get: function () { return !!this._tangents }, enumerable: !0, configurable: !0 }), e.prototype.setPositions = function (e) { var t = this.hasPositions; this._positions = e, t !== this.hasPositions && this._onDataLayoutChanged.notifyObservers(void 0) }, e.prototype.getPositions = function () { return this._positions }, e.prototype.setNormals = function (e) { var t = this.hasNormals; this._normals = e, t !== this.hasNormals && this._onDataLayoutChanged.notifyObservers(void 0) }, e.prototype.getNormals = function () { return this._normals }, e.prototype.setTangents = function (e) { var t = this.hasTangents; this._tangents = e, t !== this.hasTangents && this._onDataLayoutChanged.notifyObservers(void 0) }, e.prototype.getTangents = function () { return this._tangents }, e.prototype.serialize = function () { var e = {}; return e.name = this.name, e.influence = this.influence, e.positions = Array.prototype.slice.call(this.getPositions()), this.hasNormals && (e.normals = Array.prototype.slice.call(this.getNormals())), this.hasTangents && (e.tangents = Array.prototype.slice.call(this.getTangents())), Ds.Animation.AppendSerializedAnimations(this, e), e }, e.Parse = function (t) { var i = new e(t.name, t.influence); if (i.setPositions(t.positions), t.normals && i.setNormals(t.normals), t.tangents && i.setTangents(t.tangents), t.animations) for (var r = 0; r < t.animations.length; r++) { var n = t.animations[r]; i.animations.push(Ds.Animation.Parse(n)) } return i }, e.FromMesh = function (t, i, r) { i || (i = t.name); var n = new e(i, r, t.getScene()); return n.setPositions(t.getVerticesData(Ds.VertexBuffer.PositionKind)), t.isVerticesDataPresent(Ds.VertexBuffer.NormalKind) && n.setNormals(t.getVerticesData(Ds.VertexBuffer.NormalKind)), t.isVerticesDataPresent(Ds.VertexBuffer.TangentKind) && n.setTangents(t.getVerticesData(Ds.VertexBuffer.TangentKind)), n }, e }(), Ds.MorphTarget = Is, ws = $a || ($a = {}), Ls = function () { function e(e) { void 0 === e && (e = null), this._targets = new Array, this._targetInfluenceChangedObservers = new Array, this._targetDataLayoutChangedObservers = new Array, this._activeTargets = new ws.SmartArray(16), this._supportsNormals = !1, this._supportsTangents = !1, this._vertexCount = 0, this._uniqueId = 0, this._tempInfluences = new Array, e || (e = ws.Engine.LastCreatedScene), this._scene = e, this._scene && (this._scene.morphTargetManagers.push(this), this._uniqueId = this._scene.getUniqueId()) } return Object.defineProperty(e.prototype, "uniqueId", { get: function () { return this._uniqueId }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "vertexCount", { get: function () { return this._vertexCount }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "supportsNormals", { get: function () { return this._supportsNormals }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "supportsTangents", { get: function () { return this._supportsTangents }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "numTargets", { get: function () { return this._targets.length }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "numInfluencers", { get: function () { return this._activeTargets.length }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "influences", { get: function () { return this._influences }, enumerable: !0, configurable: !0 }), e.prototype.getActiveTarget = function (e) { return this._activeTargets.data[e] }, e.prototype.getTarget = function (e) { return this._targets[e] }, e.prototype.addTarget = function (e) { var t = this; this._targets.push(e), this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add(function (e) { t._syncActiveTargets(e) })), this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add(function () { t._syncActiveTargets(!0) })), this._syncActiveTargets(!0) }, e.prototype.removeTarget = function (e) { var t = this._targets.indexOf(e); 0 <= t && (this._targets.splice(t, 1), e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t, 1)[0]), e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t, 1)[0]), this._syncActiveTargets(!0)) }, e.prototype.serialize = function () { var e = {}; e.id = this.uniqueId, e.targets = []; for (var t = 0, i = this._targets; t < i.length; t++) { var r = i[t]; e.targets.push(r.serialize()) } return e }, e.prototype._syncActiveTargets = function (e) { var t = 0; this._activeTargets.reset(), this._supportsNormals = !0, this._supportsTangents = !0; for (var i = this._vertexCount = 0, r = this._targets; i < r.length; i++) { var n = r[i]; if (0 !== n.influence) { this._activeTargets.push(n), this._tempInfluences[t++] = n.influence, this._supportsNormals = this._supportsNormals && n.hasNormals, this._supportsTangents = this._supportsTangents && n.hasTangents; var o = n.getPositions(); if (o) { var s = o.length / 3; if (0 === this._vertexCount) this._vertexCount = s; else if (this._vertexCount !== s) return void ws.Tools.Error("Incompatible target. Targets must all have the same vertices count.") } } } this._influences && this._influences.length === t || (this._influences = new Float32Array(t)); for (var a = 0; a < t; a++)this._influences[a] = this._tempInfluences[a]; e && this.synchronize() }, e.prototype.synchronize = function () { if (this._scene) for (var e = 0, t = this._scene.meshes; e < t.length; e++) { var i = t[e]; i.morphTargetManager === this && i._syncGeometryWithMorphTargetManager() } }, e.Parse = function (t, i) { var r = new e(i); r._uniqueId = t.id; for (var n = 0, o = t.targets; n < o.length; n++) { var s = o[n]; r.addTarget(ws.MorphTarget.Parse(s)) } return r }, e }(), ws.MorphTargetManager = Ls, Fs = $a || ($a = {}), Bs = function () { function e(e, t, i) { void 0 === i && (i = 2), this.maxDepth = i, this.dynamicContent = new Array, this._maxBlockCapacity = t || 64, this._selectionContent = new Fs.SmartArrayNoDuplicate(1024), this._creationFunc = e } return e.prototype.update = function (t, i, r) { e._CreateBlocks(t, i, r, this._maxBlockCapacity, 0, this.maxDepth, this, this._creationFunc) }, e.prototype.addMesh = function (e) { for (var t = 0; t < this.blocks.length; t++)this.blocks[t].addEntry(e) }, e.prototype.select = function (e, t) { this._selectionContent.reset(); for (var i = 0; i < this.blocks.length; i++)this.blocks[i].select(e, this._selectionContent, t); return t ? this._selectionContent.concat(this.dynamicContent) : this._selectionContent.concatWithNoDuplicate(this.dynamicContent), this._selectionContent }, e.prototype.intersects = function (e, t, i) { this._selectionContent.reset(); for (var r = 0; r < this.blocks.length; r++)this.blocks[r].intersects(e, t, this._selectionContent, i); return i ? this._selectionContent.concat(this.dynamicContent) : this._selectionContent.concatWithNoDuplicate(this.dynamicContent), this._selectionContent }, e.prototype.intersectsRay = function (e) { this._selectionContent.reset(); for (var t = 0; t < this.blocks.length; t++)this.blocks[t].intersectsRay(e, this._selectionContent); return this._selectionContent.concatWithNoDuplicate(this.dynamicContent), this._selectionContent }, e._CreateBlocks = function (e, t, i, r, n, o, s, a) { s.blocks = new Array; for (var l = new Fs.Vector3((t.x - e.x) / 2, (t.y - e.y) / 2, (t.z - e.z) / 2), c = 0; c < 2; c++)for (var h = 0; h < 2; h++)for (var u = 0; u < 2; u++) { var d = e.add(l.multiplyByFloats(c, h, u)), f = e.add(l.multiplyByFloats(c + 1, h + 1, u + 1)), p = new Fs.OctreeBlock(d, f, r, n + 1, o, a); p.addEntries(i), s.blocks.push(p) } }, e.CreationFuncForMeshes = function (e, t) { var i = e.getBoundingInfo(); !e.isBlocked && i.boundingBox.intersectsMinMax(t.minPoint, t.maxPoint) && t.entries.push(e) }, e.CreationFuncForSubMeshes = function (e, t) { e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint, t.maxPoint) && t.entries.push(e) }, e }(), Fs.Octree = Bs, Ns = $a || ($a = {}), Vs = function () { function e(e, t, i, r, n, o) { this.entries = new Array, this._boundingVectors = new Array, this._capacity = i, this._depth = r, this._maxDepth = n, this._creationFunc = o, this._minPoint = e, this._maxPoint = t, this._boundingVectors.push(e.clone()), this._boundingVectors.push(t.clone()), this._boundingVectors.push(e.clone()), this._boundingVectors[2].x = t.x, this._boundingVectors.push(e.clone()), this._boundingVectors[3].y = t.y, this._boundingVectors.push(e.clone()), this._boundingVectors[4].z = t.z, this._boundingVectors.push(t.clone()), this._boundingVectors[5].z = e.z, this._boundingVectors.push(t.clone()), this._boundingVectors[6].x = e.x, this._boundingVectors.push(t.clone()), this._boundingVectors[7].y = e.y } return Object.defineProperty(e.prototype, "capacity", { get: function () { return this._capacity }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "minPoint", { get: function () { return this._minPoint }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "maxPoint", { get: function () { return this._maxPoint }, enumerable: !0, configurable: !0 }), e.prototype.addEntry = function (e) { if (this.blocks) for (var t = 0; t < this.blocks.length; t++)this.blocks[t].addEntry(e); else this._creationFunc(e, this), this.entries.length > this.capacity && this._depth < this._maxDepth && this.createInnerBlocks() }, e.prototype.addEntries = function (e) { for (var t = 0; t < e.length; t++) { var i = e[t]; this.addEntry(i) } }, e.prototype.select = function (e, t, i) { if (Ns.BoundingBox.IsInFrustum(this._boundingVectors, e)) { if (this.blocks) { for (var r = 0; r < this.blocks.length; r++)this.blocks[r].select(e, t, i); return } i ? t.concat(this.entries) : t.concatWithNoDuplicate(this.entries) } }, e.prototype.intersects = function (e, t, i, r) { if (Ns.BoundingBox.IntersectsSphere(this._minPoint, this._maxPoint, e, t)) { if (this.blocks) { for (var n = 0; n < this.blocks.length; n++)this.blocks[n].intersects(e, t, i, r); return } r ? i.concat(this.entries) : i.concatWithNoDuplicate(this.entries) } }, e.prototype.intersectsRay = function (e, t) { if (e.intersectsBoxMinMax(this._minPoint, this._maxPoint)) { if (this.blocks) { for (var i = 0; i < this.blocks.length; i++)this.blocks[i].intersectsRay(e, t); return } t.concatWithNoDuplicate(this.entries) } }, e.prototype.createInnerBlocks = function () { Ns.Octree._CreateBlocks(this._minPoint, this._maxPoint, this.entries, this._capacity, this._depth, this._maxDepth, this, this._creationFunc) }, e }(), Ns.OctreeBlock = Vs, function (e) { e.Scene.prototype.createOrUpdateSelectionOctree = function (i, r) { void 0 === i && (i = 64), void 0 === r && (r = 2); var n = this._getComponent(e.SceneComponentConstants.NAME_OCTREE); n || (n = new t(this), this._addComponent(n)), this._selectionOctree || (this._selectionOctree = new e.Octree(e.Octree.CreationFuncForMeshes, i, r)); var o = this.getWorldExtends(); return this._selectionOctree.update(o.min, o.max, this.meshes), this._selectionOctree }, Object.defineProperty(e.Scene.prototype, "selectionOctree", { get: function () { return this._selectionOctree }, enumerable: !0, configurable: !0 }), e.AbstractMesh.prototype.createOrUpdateSubmeshesOctree = function (i, r) { void 0 === i && (i = 64), void 0 === r && (r = 2); var n = this.getScene(), o = n._getComponent(e.SceneComponentConstants.NAME_OCTREE); o || (o = new t(n), n._addComponent(o)), this._submeshesOctree || (this._submeshesOctree = new e.Octree(e.Octree.CreationFuncForSubMeshes, i, r)), this.computeWorldMatrix(!0); var s = this.getBoundingInfo().boundingBox; return this._submeshesOctree.update(s.minimumWorld, s.maximumWorld, this.subMeshes), this._submeshesOctree }; var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_OCTREE, this.checksIsEnabled = !0, this._tempRay = new e.Ray(e.Vector3.Zero(), new e.Vector3(1, 1, 1)), this.scene = t, this.scene.getActiveMeshCandidates = this.getActiveMeshCandidates.bind(this), this.scene.getActiveSubMeshCandidates = this.getActiveSubMeshCandidates.bind(this), this.scene.getCollidingSubMeshCandidates = this.getCollidingSubMeshCandidates.bind(this), this.scene.getIntersectingSubMeshCandidates = this.getIntersectingSubMeshCandidates.bind(this) } return t.prototype.register = function () { var e = this; this.scene.onMeshRemovedObservable.add(function (t) { var i = e.scene.selectionOctree; if (null != i) { var r = i.dynamicContent.indexOf(t); -1 !== r && i.dynamicContent.splice(r, 1) } }), this.scene.onMeshImportedObservable.add(function (t) { var i = e.scene.selectionOctree; null != i && i.addMesh(t) }) }, t.prototype.getActiveMeshCandidates = function () { return this.scene._selectionOctree ? this.scene._selectionOctree.select(this.scene.frustumPlanes) : this.scene._getDefaultMeshCandidates() }, t.prototype.getActiveSubMeshCandidates = function (e) { return e._submeshesOctree && e.useOctreeForRenderingSelection ? e._submeshesOctree.select(this.scene.frustumPlanes) : this.scene._getDefaultSubMeshCandidates(e) }, t.prototype.getIntersectingSubMeshCandidates = function (t, i) { return t._submeshesOctree && t.useOctreeForPicking ? (e.Ray.TransformToRef(i, t.getWorldMatrix(), this._tempRay), t._submeshesOctree.intersectsRay(this._tempRay)) : this.scene._getDefaultSubMeshCandidates(t) }, t.prototype.getCollidingSubMeshCandidates = function (e, t) { if (e._submeshesOctree && e.useOctreeForCollisions) { var i = t._velocityWorldLength + Math.max(t._radius.x, t._radius.y, t._radius.z); return e._submeshesOctree.intersects(t._basePointWorld, i) } return this.scene._getDefaultSubMeshCandidates(e) }, t.prototype.rebuild = function () { }, t.prototype.dispose = function () { }, t }(); e.OctreeSceneComponent = t }($a || ($a = {})), zs = function (e) { function t(t, i, r, n, o, s) { var a = e.call(this, t, "anaglyph", null, ["leftSampler"], i, r[1], n, o, s) || this; return a._passedProcess = r[0]._rigPostProcess, a.onApplyObservable.add(function (e) { e.setTextureFromPostProcess("leftSampler", a._passedProcess) }), a } return T(t, e), t }((Us = $a || ($a = {})).PostProcess), Us.AnaglyphPostProcess = zs, function (e) { e.Node.AddNodeConstructor("AnaglyphArcRotateCamera", function (i, r, n) { return function () { return new t(i, 0, 0, 1, e.Vector3.Zero(), n.interaxial_distance, r) } }); var t = function (t) { function i(i, r, n, o, s, a, l) { var c = t.call(this, i, r, n, o, s, l) || this; return c.interaxialDistance = a, c.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH, { interaxialDistance: a }), c } return T(i, t), i.prototype.getClassName = function () { return "AnaglyphArcRotateCamera" }, i }(e.ArcRotateCamera); e.AnaglyphArcRotateCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("AnaglyphFreeCamera", function (i, r, n) { return function () { return new t(i, e.Vector3.Zero(), n.interaxial_distance, r) } }); var t = function (t) { function i(i, r, n, o) { var s = t.call(this, i, r, o) || this; return s.interaxialDistance = n, s.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH, { interaxialDistance: n }), s } return T(i, t), i.prototype.getClassName = function () { return "AnaglyphFreeCamera" }, i }(e.FreeCamera); e.AnaglyphFreeCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("AnaglyphGamepadCamera", function (i, r, n) { return function () { return new t(i, e.Vector3.Zero(), n.interaxial_distance, r) } }); var t = function (t) { function i(i, r, n, o) { var s = t.call(this, i, r, o) || this; return s.interaxialDistance = n, s.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH, { interaxialDistance: n }), s } return T(i, t), i.prototype.getClassName = function () { return "AnaglyphGamepadCamera" }, i }(e.GamepadCamera); e.AnaglyphGamepadCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("AnaglyphUniversalCamera", function (i, r, n) { return function () { return new t(i, e.Vector3.Zero(), n.interaxial_distance, r) } }); var t = function (t) { function i(i, r, n, o) { var s = t.call(this, i, r, o) || this; return s.interaxialDistance = n, s.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH, { interaxialDistance: n }), s } return T(i, t), i.prototype.getClassName = function () { return "AnaglyphUniversalCamera" }, i }(e.UniversalCamera); e.AnaglyphUniversalCamera = t }($a || ($a = {})), ks = function (e) { function t(t, i, r, n, o, s) { var a = e.call(this, t, "stereoscopicInterlace", ["stepSize"], ["camASampler"], 1, i[1], n, o, s, r ? "#define IS_STEREOSCOPIC_HORIZ 1" : void 0) || this; return a._passedProcess = i[0]._rigPostProcess, a._stepSize = new Gs.Vector2(1 / a.width, 1 / a.height), a.onSizeChangedObservable.add(function () { a._stepSize = new Gs.Vector2(1 / a.width, 1 / a.height) }), a.onApplyObservable.add(function (e) { e.setTextureFromPostProcess("camASampler", a._passedProcess), e.setFloat2("stepSize", a._stepSize.x, a._stepSize.y) }), a } return T(t, e), t }((Gs = $a || ($a = {})).PostProcess), Gs.StereoscopicInterlacePostProcess = ks, function (e) { e.Node.AddNodeConstructor("StereoscopicArcRotateCamera", function (i, r, n) { return function () { return new t(i, 0, 0, 1, e.Vector3.Zero(), n.interaxial_distance, n.isStereoscopicSideBySide, r) } }); var t = function (t) { function i(i, r, n, o, s, a, l, c) { var h = t.call(this, i, r, n, o, s, c) || this; return h.interaxialDistance = a, h.isStereoscopicSideBySide = l, h.setCameraRigMode(l ? e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL : e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER, { interaxialDistance: a }), h } return T(i, t), i.prototype.getClassName = function () { return "StereoscopicArcRotateCamera" }, i }(e.ArcRotateCamera); e.StereoscopicArcRotateCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("StereoscopicFreeCamera", function (i, r, n) { return function () { return new t(i, e.Vector3.Zero(), n.interaxial_distance, n.isStereoscopicSideBySide, r) } }); var t = function (t) { function i(i, r, n, o, s) { var a = t.call(this, i, r, s) || this; return a.interaxialDistance = n, a.isStereoscopicSideBySide = o, a.setCameraRigMode(o ? e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL : e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER, { interaxialDistance: n }), a } return T(i, t), i.prototype.getClassName = function () { return "StereoscopicFreeCamera" }, i }(e.FreeCamera); e.StereoscopicFreeCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("StereoscopicGamepadCamera", function (i, r, n) { return function () { return new t(i, e.Vector3.Zero(), n.interaxial_distance, n.isStereoscopicSideBySide, r) } }); var t = function (t) { function i(i, r, n, o, s) { var a = t.call(this, i, r, s) || this; return a.interaxialDistance = n, a.isStereoscopicSideBySide = o, a.setCameraRigMode(o ? e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL : e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER, { interaxialDistance: n }), a } return T(i, t), i.prototype.getClassName = function () { return "StereoscopicGamepadCamera" }, i }(e.GamepadCamera); e.StereoscopicGamepadCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("StereoscopicFreeCamera", function (i, r, n) { return function () { return new t(i, e.Vector3.Zero(), n.interaxial_distance, n.isStereoscopicSideBySide, r) } }); var t = function (t) { function i(i, r, n, o, s) { var a = t.call(this, i, r, s) || this; return a.interaxialDistance = n, a.isStereoscopicSideBySide = o, a.setCameraRigMode(o ? e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL : e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER, { interaxialDistance: n }), a } return T(i, t), i.prototype.getClassName = function () { return "StereoscopicUniversalCamera" }, i }(e.UniversalCamera); e.StereoscopicUniversalCamera = t }($a || ($a = {})), Hs = function (e) { function t(t, i, r, n) { var o = e.call(this, t, "vrDistortionCorrection", ["LensCenter", "Scale", "ScaleIn", "HmdWarpParam"], null, n.postProcessScaleFactor, i, Ws.Texture.BILINEAR_SAMPLINGMODE) || this; return o._isRightEye = r, o._distortionFactors = n.distortionK, o._postProcessScaleFactor = n.postProcessScaleFactor, o._lensCenterOffset = n.lensCenterOffset, o.adaptScaleToCurrentViewport = !0, o.onSizeChangedObservable.add(function () { o._scaleIn = new Ws.Vector2(2, 2 / o.aspectRatio), o._scaleFactor = new Ws.Vector2(1 / o._postProcessScaleFactor * .5, 1 / o._postProcessScaleFactor * .5 * o.aspectRatio), o._lensCenter = new Ws.Vector2(o._isRightEye ? .5 - .5 * o._lensCenterOffset : .5 + .5 * o._lensCenterOffset, .5) }), o.onApplyObservable.add(function (e) { e.setFloat2("LensCenter", o._lensCenter.x, o._lensCenter.y), e.setFloat2("Scale", o._scaleFactor.x, o._scaleFactor.y), e.setFloat2("ScaleIn", o._scaleIn.x, o._scaleIn.y), e.setFloat4("HmdWarpParam", o._distortionFactors[0], o._distortionFactors[1], o._distortionFactors[2], o._distortionFactors[3]) }), o } return T(t, e), t }((Ws = $a || ($a = {})).PostProcess), Ws.VRDistortionCorrectionPostProcess = Hs, Xs = $a || ($a = {}), js = function () { function e() { var e = this; this._screenOrientationAngle = 0, this._screenQuaternion = new Xs.Quaternion, this._alpha = 0, this._beta = 0, this._gamma = 0, this._orientationChanged = function () { e._screenOrientationAngle = void 0 !== window.orientation ? +window.orientation : window.screen.orientation && window.screen.orientation.angle ? window.screen.orientation.angle : 0, e._screenOrientationAngle = -Xs.Tools.ToRadians(e._screenOrientationAngle / 2), e._screenQuaternion.copyFromFloats(0, Math.sin(e._screenOrientationAngle), 0, Math.cos(e._screenOrientationAngle)) }, this._deviceOrientation = function (t) { e._alpha = null !== t.alpha ? t.alpha : 0, e._beta = null !== t.beta ? t.beta : 0, e._gamma = null !== t.gamma ? t.gamma : 0 }, this._constantTranform = new Xs.Quaternion(-Math.sqrt(.5), 0, 0, Math.sqrt(.5)), this._orientationChanged() } return Object.defineProperty(e.prototype, "camera", { get: function () { return this._camera }, set: function (e) { this._camera = e, null == this._camera || this._camera.rotationQuaternion || (this._camera.rotationQuaternion = new Xs.Quaternion) }, enumerable: !0, configurable: !0 }), e.prototype.attachControl = function (e, t) { window.addEventListener("orientationchange", this._orientationChanged), window.addEventListener("deviceorientation", this._deviceOrientation), this._orientationChanged() }, e.prototype.detachControl = function (e) { window.removeEventListener("orientationchange", this._orientationChanged), window.removeEventListener("deviceorientation", this._deviceOrientation) }, e.prototype.checkInputs = function () { this._alpha && (Xs.Quaternion.RotationYawPitchRollToRef(Xs.Tools.ToRadians(this._alpha), Xs.Tools.ToRadians(this._beta), -Xs.Tools.ToRadians(this._gamma), this.camera.rotationQuaternion), this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion), this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform), this._camera.rotationQuaternion.z *= -1, this._camera.rotationQuaternion.w *= -1) }, e.prototype.getClassName = function () { return "FreeCameraDeviceOrientationInput" }, e.prototype.getSimpleName = function () { return "deviceOrientation" }, e }(), Xs.FreeCameraDeviceOrientationInput = js, Xs.CameraInputTypes.FreeCameraDeviceOrientationInput = js, Ys = $a || ($a = {}), Ks = function () { function e() { this.alphaCorrection = 1, this.betaCorrection = 1, this.gammaCorrection = 1, this._alpha = 0, this._gamma = 0, this._dirty = !1, this._deviceOrientationHandler = this._onOrientationEvent.bind(this) } return e.prototype.attachControl = function (e, t) { this.camera.attachControl(e, t), window.addEventListener("deviceorientation", this._deviceOrientationHandler) }, e.prototype._onOrientationEvent = function (e) { null !== e.alpha && (this._alpha = 0 | +e.alpha), null !== e.gamma && (this._gamma = 0 | +e.gamma), this._dirty = !0 }, e.prototype.checkInputs = function () { this._dirty && (this._dirty = !1, this._gamma < 0 && (this._gamma = 180 + this._gamma), this.camera.alpha = -this._alpha / 180 * Math.PI % Math.PI * 2, this.camera.beta = this._gamma / 180 * Math.PI) }, e.prototype.detachControl = function (e) { window.removeEventListener("deviceorientation", this._deviceOrientationHandler) }, e.prototype.getClassName = function () { return "ArcRotateCameraVRDeviceOrientationInput" }, e.prototype.getSimpleName = function () { return "VRDeviceOrientation" }, e }(), Ys.ArcRotateCameraVRDeviceOrientationInput = Ks, Ys.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput = Ks, Qs = $a || ($a = {}), Zs = function () { function e() { this.compensateDistortion = !0 } return Object.defineProperty(e.prototype, "aspectRatio", { get: function () { return this.hResolution / (2 * this.vResolution) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "aspectRatioFov", { get: function () { return 2 * Math.atan(this.postProcessScaleFactor * this.vScreenSize / (2 * this.eyeToScreenDistance)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "leftHMatrix", { get: function () { var e = 4 * (this.hScreenSize / 4 - this.lensSeparationDistance / 2) / this.hScreenSize; return Qs.Matrix.Translation(e, 0, 0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "rightHMatrix", { get: function () { var e = 4 * (this.hScreenSize / 4 - this.lensSeparationDistance / 2) / this.hScreenSize; return Qs.Matrix.Translation(-e, 0, 0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "leftPreViewMatrix", { get: function () { return Qs.Matrix.Translation(.5 * this.interpupillaryDistance, 0, 0) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "rightPreViewMatrix", { get: function () { return Qs.Matrix.Translation(-.5 * this.interpupillaryDistance, 0, 0) }, enumerable: !0, configurable: !0 }), e.GetDefault = function () { var t = new e; return t.hResolution = 1280, t.vResolution = 800, t.hScreenSize = .149759993, t.vScreenSize = .0935999975, t.vScreenCenter = .0467999987, t.eyeToScreenDistance = .0410000011, t.lensSeparationDistance = .063500002, t.interpupillaryDistance = .064000003, t.distortionK = [1, .219999999, .239999995, 0], t.chromaAbCorrection = [.995999992, -.00400000019, 1.01400006, 0], t.postProcessScaleFactor = 1.714605507808412, t.lensCenterOffset = .151976421, t }, e }(), Qs.VRCameraMetrics = Zs, function (e) { e.Node.AddNodeConstructor("WebVRFreeCamera", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }), e.Node.AddNodeConstructor("WebVRGamepadCamera", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (t) { function i(i, r, n, o) { void 0 === o && (o = {}); var s = t.call(this, i, r, n) || this; s.webVROptions = o, s._vrDevice = null, s.rawPose = null, s._specsVersion = "1.1", s._attached = !1, s._descendants = [], s._deviceRoomPosition = e.Vector3.Zero(), s._deviceRoomRotationQuaternion = e.Quaternion.Identity(), s._standingMatrix = null, s.devicePosition = e.Vector3.Zero(), s.deviceRotationQuaternion = e.Quaternion.Identity(), s.deviceScaleFactor = 1, s._deviceToWorld = e.Matrix.Identity(), s._worldToDevice = e.Matrix.Identity(), s.controllers = [], s.onControllersAttachedObservable = new e.Observable, s.onControllerMeshLoadedObservable = new e.Observable, s.onPoseUpdatedFromDeviceObservable = new e.Observable, s._poseSet = !1, s.rigParenting = !0, s._defaultHeight = void 0, s._htmlElementAttached = null, s._detachIfAttached = function () { var e = s.getEngine().getVRDevice(); e && !e.isPresenting && s._htmlElementAttached && s.detachControl(s._htmlElementAttached) }, s._workingVector = e.Vector3.Zero(), s._oneVector = e.Vector3.One(), s._workingMatrix = e.Matrix.Identity(), s._tmpMatrix = new e.Matrix, s._cache.position = e.Vector3.Zero(), o.defaultHeight && (s._defaultHeight = o.defaultHeight, s.position.y = s._defaultHeight), s.minZ = .1, 5 === arguments.length && (s.webVROptions = arguments[4]), null == s.webVROptions.trackPosition && (s.webVROptions.trackPosition = !0), null == s.webVROptions.controllerMeshes && (s.webVROptions.controllerMeshes = !0), null == s.webVROptions.defaultLightingOnControllers && (s.webVROptions.defaultLightingOnControllers = !0), s.rotationQuaternion = new e.Quaternion, s.webVROptions && s.webVROptions.positionScale && (s.deviceScaleFactor = s.webVROptions.positionScale); var a = s.getEngine(); return s._onVREnabled = function (e) { e && s.initControllers() }, a.onVRRequestPresentComplete.add(s._onVREnabled), a.initWebVR().add(function (t) { t.vrDisplay && s._vrDevice !== t.vrDisplay && (s._vrDevice = t.vrDisplay, s.setCameraRigMode(e.Camera.RIG_MODE_WEBVR, { parentCamera: s, vrDisplay: s._vrDevice, frameData: s._frameData, specs: s._specsVersion }), s._attached && s.getEngine().enableVR()) }), "undefined" != typeof VRFrameData && (s._frameData = new VRFrameData), n.onBeforeCameraRenderObservable.add(function (e) { e.parent === s && s.rigParenting && (s._descendants = s.getDescendants(!0, function (e) { var t = s.controllers.some(function (t) { return t._mesh === e }), i = -1 !== s._rigCameras.indexOf(e); return !t && !i }), s._descendants.forEach(function (t) { t.parent = e })) }), n.onAfterCameraRenderObservable.add(function (e) { e.parent === s && s.rigParenting && s._descendants.forEach(function (e) { e.parent = s }) }), s } return T(i, t), i.prototype.deviceDistanceToRoomGround = function () { return this._standingMatrix ? (this._standingMatrix.getTranslationToRef(this._workingVector), this._deviceRoomPosition.y + this._workingVector.y) : this._defaultHeight || 0 }, i.prototype.useStandingMatrix = function (t) { var i = this; void 0 === t && (t = function (e) { }), this.getEngine().initWebVRAsync().then(function (r) { r.vrDisplay && r.vrDisplay.stageParameters && r.vrDisplay.stageParameters.sittingToStandingTransform && i.webVROptions.trackPosition ? (i._standingMatrix = new e.Matrix, e.Matrix.FromFloat32ArrayToRefScaled(r.vrDisplay.stageParameters.sittingToStandingTransform, 0, 1, i._standingMatrix), i.getScene().useRightHandedSystem || [2, 6, 8, 9, 14].forEach(function (e) { i._standingMatrix && (i._standingMatrix.m[e] *= -1) }), t(!0)) : t(!1) }) }, i.prototype.useStandingMatrixAsync = function () { var e = this; return new Promise(function (t, i) { e.useStandingMatrix(function (e) { t(e) }) }) }, i.prototype.dispose = function () { this._detachIfAttached(), this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled), this._updateCacheWhenTrackingDisabledObserver && this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver), t.prototype.dispose.call(this) }, i.prototype.getControllerByName = function (e) { for (var t = 0, i = this.controllers; t < i.length; t++) { var r = i[t]; if (r.hand === e) return r } return null }, Object.defineProperty(i.prototype, "leftController", { get: function () { return this._leftController || (this._leftController = this.getControllerByName("left")), this._leftController }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "rightController", { get: function () { return this._rightController || (this._rightController = this.getControllerByName("right")), this._rightController }, enumerable: !0, configurable: !0 }), i.prototype.getForwardRay = function (e) { return void 0 === e && (e = 100), this.leftCamera ? t.prototype.getForwardRay.call(this, e, this.leftCamera.getWorldMatrix(), this.leftCamera.globalPosition) : t.prototype.getForwardRay.call(this, e) }, i.prototype._checkInputs = function () { this._vrDevice && this._vrDevice.isPresenting && (this._vrDevice.getFrameData(this._frameData), this.updateFromDevice(this._frameData.pose)), t.prototype._checkInputs.call(this) }, i.prototype.updateFromDevice = function (e) { e && e.orientation && (this.rawPose = e, this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0], e.orientation[1], -e.orientation[2], -e.orientation[3]), this.getScene().useRightHandedSystem && (this._deviceRoomRotationQuaternion.z *= -1, this._deviceRoomRotationQuaternion.w *= -1), this.webVROptions.trackPosition && this.rawPose.position && (this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0], this.rawPose.position[1], -this.rawPose.position[2]), this.getScene().useRightHandedSystem && (this._deviceRoomPosition.z *= -1)), this._poseSet = !0) }, i.prototype.attachControl = function (i, r) { t.prototype.attachControl.call(this, i, r), this._attached = !0, this._htmlElementAttached = i, r = !e.Camera.ForceAttachControlToAlwaysPreventDefault && r, this._vrDevice && this.getEngine().enableVR(), window.addEventListener("vrdisplaypresentchange", this._detachIfAttached) }, i.prototype.detachControl = function (e) { this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver), this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver), t.prototype.detachControl.call(this, e), this._attached = !1, this.getEngine().disableVR(), window.removeEventListener("vrdisplaypresentchange", this._detachIfAttached) }, i.prototype.getClassName = function () { return "WebVRFreeCamera" }, i.prototype.resetToCurrentRotation = function () { this._vrDevice.resetPose() }, i.prototype._updateRigCameras = function () { var e = this._rigCameras[0], t = this._rigCameras[1]; e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion), t.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion), e.position.copyFrom(this._deviceRoomPosition), t.position.copyFrom(this._deviceRoomPosition) }, i.prototype._correctPositionIfNotTrackPosition = function (t, i) { void 0 === i && (i = !1), this.rawPose && this.rawPose.position && !this.webVROptions.trackPosition && (e.Matrix.TranslationToRef(this.rawPose.position[0], this.rawPose.position[1], -this.rawPose.position[2], this._tmpMatrix), i || this._tmpMatrix.invert(), this._tmpMatrix.multiplyToRef(t, t)) }, i.prototype._updateCache = function (i) { var r = this; this.rotationQuaternion.equals(this._cache.rotationQuaternion) && this.position.equals(this._cache.position) || (this.updateCacheCalled || (this.updateCacheCalled = !0, this.update()), this.rotationQuaternion.toRotationMatrix(this._workingMatrix), e.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition, this._workingMatrix, this._workingVector), this.devicePosition.subtractToRef(this._workingVector, this._workingVector), e.Matrix.ComposeToRef(this._oneVector, this.rotationQuaternion, this._workingVector, this._deviceToWorld), this._deviceToWorld.getTranslationToRef(this._workingVector), this._workingVector.addInPlace(this.position), this._workingVector.subtractInPlace(this._cache.position), this._deviceToWorld.setTranslation(this._workingVector), this._deviceToWorld.invertToRef(this._worldToDevice), this.controllers.forEach(function (e) { e._deviceToWorld.copyFrom(r._deviceToWorld), r._correctPositionIfNotTrackPosition(e._deviceToWorld), e.update() })), i || t.prototype._updateCache.call(this), this.updateCacheCalled = !1 }, i.prototype._computeDevicePosition = function () { e.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition, this._deviceToWorld, this.devicePosition) }, i.prototype.update = function () { this._computeDevicePosition(), e.Matrix.FromQuaternionToRef(this._deviceRoomRotationQuaternion, this._workingMatrix), this._workingMatrix.multiplyToRef(this._deviceToWorld, this._workingMatrix), e.Quaternion.FromRotationMatrixToRef(this._workingMatrix, this.deviceRotationQuaternion), this._poseSet && this.onPoseUpdatedFromDeviceObservable.notifyObservers(null), t.prototype.update.call(this) }, i.prototype._getViewMatrix = function () { return e.Matrix.Identity() }, i.prototype._getWebVRViewMatrix = function () { var t = this, i = this._cameraRigParams.parentCamera; i._updateCache(); var r = this._cameraRigParams.left ? this._cameraRigParams.frameData.leftViewMatrix : this._cameraRigParams.frameData.rightViewMatrix; return e.Matrix.FromArrayToRef(r, 0, this._webvrViewMatrix), this.getScene().useRightHandedSystem || [2, 6, 8, 9, 14].forEach(function (e) { t._webvrViewMatrix.m[e] *= -1 }), this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix), e.Vector3.TransformCoordinatesToRef(this._referencePoint, this._cameraRotationMatrix, this._transformedReferencePoint), this.position.addToRef(this._transformedReferencePoint, this._currentTarget), 1 !== i.deviceScaleFactor && (this._webvrViewMatrix.invert(), i.deviceScaleFactor && (this._webvrViewMatrix.m[12] *= i.deviceScaleFactor, this._webvrViewMatrix.m[13] *= i.deviceScaleFactor, this._webvrViewMatrix.m[14] *= i.deviceScaleFactor), this._webvrViewMatrix.invert()), i._correctPositionIfNotTrackPosition(this._webvrViewMatrix, !0), i._worldToDevice.multiplyToRef(this._webvrViewMatrix, this._webvrViewMatrix), this._workingMatrix = this._workingMatrix || e.Matrix.Identity(), this._webvrViewMatrix.invertToRef(this._workingMatrix), this._workingMatrix.multiplyToRef(i.getWorldMatrix(), this._workingMatrix), this._workingMatrix.getTranslationToRef(this._globalPosition), this._markSyncedWithParent(), this._webvrViewMatrix }, i.prototype._getWebVRProjectionMatrix = function () { var t = this, i = this.parent; i._vrDevice.depthNear = i.minZ, i._vrDevice.depthFar = i.maxZ; var r = this._cameraRigParams.left ? this._cameraRigParams.frameData.leftProjectionMatrix : this._cameraRigParams.frameData.rightProjectionMatrix; return e.Matrix.FromArrayToRef(r, 0, this._projectionMatrix), this.getScene().useRightHandedSystem || [8, 9, 10, 11].forEach(function (e) { t._projectionMatrix.m[e] *= -1 }), this._projectionMatrix }, i.prototype.initControllers = function () { var t = this; this.controllers = []; var i = this.getScene().gamepadManager; this._onGamepadDisconnectedObserver = i.onGamepadDisconnectedObservable.add(function (i) { if (i.type === e.Gamepad.POSE_ENABLED) { var r = i; r.defaultModel && r.defaultModel.setEnabled(!1), "right" === r.hand && (t._rightController = null), "left" === r.hand && (t._leftController = null); var n = t.controllers.indexOf(r); -1 !== n && t.controllers.splice(n, 1) } }), this._onGamepadConnectedObserver = i.onGamepadConnectedObservable.add(function (i) { if (i.type === e.Gamepad.POSE_ENABLED) { var r = i; if (t.webVROptions.trackPosition || (r._disableTrackPosition(new e.Vector3("left" == r.hand ? -.15 : .15, -.5, .25)), t._updateCacheWhenTrackingDisabledObserver || (t._updateCacheWhenTrackingDisabledObserver = t._scene.onBeforeRenderObservable.add(function () { t._updateCache() }))), r.deviceScaleFactor = t.deviceScaleFactor, r._deviceToWorld.copyFrom(t._deviceToWorld), t._correctPositionIfNotTrackPosition(r._deviceToWorld), t.webVROptions.controllerMeshes && (r.defaultModel ? r.defaultModel.setEnabled(!0) : r.initControllerMesh(t.getScene(), function (i) { if (i.scaling.scaleInPlace(t.deviceScaleFactor), t.onControllerMeshLoadedObservable.notifyObservers(r), t.webVROptions.defaultLightingOnControllers) { t._lightOnControllers || (t._lightOnControllers = new e.HemisphericLight("vrControllersLight", new e.Vector3(0, 1, 0), t.getScene())); var n = function (e, t) { var i = e.getChildren(); i && 0 !== i.length && i.forEach(function (e) { t.includedOnlyMeshes.push(e), n(e, t) }) }; t._lightOnControllers.includedOnlyMeshes.push(i), n(i, t._lightOnControllers) } })), r.attachToPoseControlledCamera(t), -1 === t.controllers.indexOf(r)) { t.controllers.push(r); for (var n = !1, o = 0; o < t.controllers.length; o++)t.controllers[o].controllerType === e.PoseEnabledControllerType.VIVE && (n ? t.controllers[o].hand = "right" : (n = !0, t.controllers[o].hand = "left")); 2 <= t.controllers.length && t.onControllersAttachedObservable.notifyObservers(t.controllers) } } }) }, i }(e.FreeCamera); e.WebVRFreeCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("DeviceOrientationCamera", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (t) { function i(i, r, n) { var o = t.call(this, i, r, n) || this; return o._quaternionCache = new e.Quaternion, o.inputs.addDeviceOrientation(), o } return T(i, t), i.prototype.getClassName = function () { return "DeviceOrientationCamera" }, i.prototype._checkInputs = function () { t.prototype._checkInputs.call(this), this._quaternionCache.copyFrom(this.rotationQuaternion), this._initialQuaternion && this._initialQuaternion.multiplyToRef(this.rotationQuaternion, this.rotationQuaternion) }, i.prototype.resetToCurrentRotation = function (t) { var i = this; void 0 === t && (t = e.Axis.Y), this.rotationQuaternion && (this._initialQuaternion || (this._initialQuaternion = new e.Quaternion), this._initialQuaternion.copyFrom(this._quaternionCache || this.rotationQuaternion), ["x", "y", "z"].forEach(function (e) { t[e] ? i._initialQuaternion[e] *= -1 : i._initialQuaternion[e] = 0 }), this._initialQuaternion.normalize(), this._initialQuaternion.multiplyToRef(this.rotationQuaternion, this.rotationQuaternion)) }, i }(e.FreeCamera); e.DeviceOrientationCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("VRDeviceOrientationFreeCamera", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (t) { function i(i, r, n, o, s) { void 0 === o && (o = !0), void 0 === s && (s = e.VRCameraMetrics.GetDefault()); var a = t.call(this, i, r, n) || this; return s.compensateDistortion = o, a.setCameraRigMode(e.Camera.RIG_MODE_VR, { vrCameraMetrics: s }), a } return T(i, t), i.prototype.getClassName = function () { return "VRDeviceOrientationFreeCamera" }, i }(e.DeviceOrientationCamera); e.VRDeviceOrientationFreeCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("VRDeviceOrientationFreeCamera", function (i, r) { return function () { return new t(i, 0, 0, 1, e.Vector3.Zero(), r) } }); var t = function (t) { function i(i, r, n, o, s, a, l, c) { void 0 === l && (l = !0), void 0 === c && (c = e.VRCameraMetrics.GetDefault()); var h = t.call(this, i, r, n, o, s, a) || this; return c.compensateDistortion = l, h.setCameraRigMode(e.Camera.RIG_MODE_VR, { vrCameraMetrics: c }), h.inputs.addVRDeviceOrientation(), h } return T(i, t), i.prototype.getClassName = function () { return "VRDeviceOrientationArcRotateCamera" }, i }(e.ArcRotateCamera); e.VRDeviceOrientationArcRotateCamera = t }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("VRDeviceOrientationGamepadCamera", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (t) { function i(i, r, n, o, s) { void 0 === o && (o = !0), void 0 === s && (s = e.VRCameraMetrics.GetDefault()); var a = t.call(this, i, r, n, o, s) || this; return a.inputs.addGamepad(), a } return T(i, t), i.prototype.getClassName = function () { return "VRDeviceOrientationGamepadCamera" }, i }(e.VRDeviceOrientationFreeCamera); e.VRDeviceOrientationGamepadCamera = t }($a || ($a = {})), qs = $a || ($a = {}), Js = function () { function e(t, i) { if (void 0 === i && (i = null), this.scene = t, this._pointerDownOnMeshAsked = !1, this._isActionableMesh = !1, this._teleportationRequestInitiated = !1, this._teleportationBackRequestInitiated = !1, this._rotationRightAsked = !1, this._rotationLeftAsked = !1, this._dpadPressed = !0, this._activePointer = !1, this._id = e._idCounter++ , i) this._gazeTracker = i.clone("gazeTracker"); else { this._gazeTracker = qs.Mesh.CreateTorus("gazeTracker", .0035, .0025, 20, t, !1), this._gazeTracker.bakeCurrentTransformIntoVertices(), this._gazeTracker.isPickable = !1, this._gazeTracker.isVisible = !1; var r = new qs.StandardMaterial("targetMat", t); r.specularColor = qs.Color3.Black(), r.emissiveColor = new qs.Color3(.7, .7, .7), r.backFaceCulling = !1, this._gazeTracker.material = r } } return e.prototype._getForwardRay = function (e) { return new qs.Ray(qs.Vector3.Zero(), new qs.Vector3(0, 0, e)) }, e.prototype._selectionPointerDown = function () { this._pointerDownOnMeshAsked = !0, this._currentHit && this.scene.simulatePointerDown(this._currentHit, { pointerId: this._id }) }, e.prototype._selectionPointerUp = function () { this._currentHit && this.scene.simulatePointerUp(this._currentHit, { pointerId: this._id }), this._pointerDownOnMeshAsked = !1 }, e.prototype._activatePointer = function () { this._activePointer = !0 }, e.prototype._deactivatePointer = function () { this._activePointer = !1 }, e.prototype._updatePointerDistance = function (e) { void 0 === e && (e = 100) }, e.prototype.dispose = function () { this._interactionsEnabled = !1, this._teleportationEnabled = !1, this._gazeTracker && this._gazeTracker.dispose() }, e._idCounter = 0, e }(), $s = function (e) { function t(t, i, r) { var n = e.call(this, i, r) || this; n.webVRController = t, n._laserPointer = qs.Mesh.CreateCylinder("laserPointer", 1, .004, 2e-4, 20, 1, i, !1); var o = new qs.StandardMaterial("laserPointerMat", i); if (o.emissiveColor = new qs.Color3(.7, .7, .7), o.alpha = .6, n._laserPointer.material = o, n._laserPointer.rotation.x = Math.PI / 2, n._laserPointer.position.z = -.5, n._laserPointer.isVisible = !1, n._laserPointer.isPickable = !1, !t.mesh) { var s = new qs.Mesh("preloadControllerMesh", i), a = new qs.Mesh(qs.PoseEnabledController.POINTING_POSE, i); a.rotation.x = -.7, s.addChild(a), t.attachToMesh(s) } return n._setLaserPointerParent(t.mesh), n._meshAttachedObserver = t._meshAttachedObservable.add(function (e) { n._setLaserPointerParent(e) }), n } return T(t, e), t.prototype._getForwardRay = function (e) { return this.webVRController.getForwardRay(e) }, t.prototype._activatePointer = function () { e.prototype._activatePointer.call(this), this._laserPointer.isVisible = !0 }, t.prototype._deactivatePointer = function () { e.prototype._deactivatePointer.call(this), this._laserPointer.isVisible = !1 }, t.prototype._setLaserPointerColor = function (e) { this._laserPointer.material.emissiveColor = e }, t.prototype._setLaserPointerParent = function (e) { var t = function (e) { e.isPickable = !1, e.getChildMeshes().forEach(function (e) { t(e) }) }; t(e); var i = e.getChildMeshes(); this.webVRController._pointingPoseNode = null; for (var r = 0; r < i.length; r++)if (i[r].name && 0 <= i[r].name.indexOf(qs.PoseEnabledController.POINTING_POSE)) { e = i[r], this.webVRController._pointingPoseNode = e; break } this._laserPointer.parent = e }, t.prototype._updatePointerDistance = function (e) { void 0 === e && (e = 100), this._laserPointer.scaling.y = e, this._laserPointer.position.z = -e / 2 }, t.prototype.dispose = function () { e.prototype.dispose.call(this), this._laserPointer.dispose(), this._meshAttachedObserver && this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver) }, t }(Js), ea = function (e) { function t(t, i) { var r = e.call(this, i) || this; return r.getCamera = t, r } return T(t, e), t.prototype._getForwardRay = function (e) { var t = this.getCamera(); return t ? t.getForwardRay(e) : new qs.Ray(qs.Vector3.Zero(), qs.Vector3.Forward()) }, t }(Js), ta = function () { function e(e, t) { void 0 === t && (t = {}); var i = this; if (this.webVROptions = t, this._webVRsupported = !1, this._webVRready = !1, this._webVRrequesting = !1, this._webVRpresenting = !1, this._fullscreenVRpresenting = !1, this.onEnteringVRObservable = new qs.Observable, this.onExitingVRObservable = new qs.Observable, this.onControllerMeshLoadedObservable = new qs.Observable, this._useCustomVRButton = !1, this._teleportationRequested = !1, this._teleportActive = !1, this._floorMeshesCollection = [], this._rotationAllowed = !0, this._teleportBackwardsVector = new qs.Vector3(0, -1, -1), this._isDefaultTeleportationTarget = !0, this._teleportationFillColor = "#444444", this._teleportationBorderColor = "#FFFFFF", this._rotationAngle = 0, this._haloCenter = new qs.Vector3(0, 0, 0), this._padSensibilityUp = .65, this._padSensibilityDown = .35, this._leftController = null, this._rightController = null, this.onNewMeshSelected = new qs.Observable, this.onNewMeshPicked = new qs.Observable, this.onBeforeCameraTeleport = new qs.Observable, this.onAfterCameraTeleport = new qs.Observable, this.onSelectedMeshUnselected = new qs.Observable, this.teleportationEnabled = !0, this._teleportationInitialized = !1, this._interactionsEnabled = !1, this._interactionsRequested = !1, this._displayGaze = !0, this._displayLaserPointer = !0, this.updateGazeTrackerScale = !0, this._onResize = function () { i.moveButtonToBottomRight(), i._fullscreenVRpresenting && i._webVRready && i.exitVR() }, this._onFullscreenChange = function () { void 0 !== document.fullscreen ? i._fullscreenVRpresenting = document.fullscreen : void 0 !== document.mozFullScreen ? i._fullscreenVRpresenting = document.mozFullScreen : void 0 !== document.webkitIsFullScreen ? i._fullscreenVRpresenting = document.webkitIsFullScreen : void 0 !== document.msIsFullScreen ? i._fullscreenVRpresenting = document.msIsFullScreen : void 0 !== document.msFullscreenElement && (i._fullscreenVRpresenting = document.msFullscreenElement), !i._fullscreenVRpresenting && i._canvas && (i.exitVR(), i._useCustomVRButton || (i._btnVR.style.top = i._canvas.offsetTop + i._canvas.offsetHeight - 70 + "px", i._btnVR.style.left = i._canvas.offsetLeft + i._canvas.offsetWidth - 100 + "px")) }, this.beforeRender = function () { i._leftController && i._leftController._activePointer && i._castRayAndSelectObject(i._leftController), i._rightController && i._rightController._activePointer && i._castRayAndSelectObject(i._rightController), i._noControllerIsActive ? i._castRayAndSelectObject(i._cameraGazer) : i._cameraGazer._gazeTracker.isVisible = !1 }, this._onNewGamepadConnected = function (e) { if (e.type !== qs.Gamepad.POSE_ENABLED) e.leftStick && e.onleftstickchanged(function (e) { i._teleportationInitialized && i.teleportationEnabled && (!i._leftController && !i._rightController || i._leftController && !i._leftController._activePointer && i._rightController && !i._rightController._activePointer) && (i._checkTeleportWithRay(e, i._cameraGazer), i._checkTeleportBackwards(e, i._cameraGazer)) }), e.rightStick && e.onrightstickchanged(function (e) { i._teleportationInitialized && i._checkRotate(e, i._cameraGazer) }), e.type === qs.Gamepad.XBOX && (e.onbuttondown(function (e) { i._interactionsEnabled && e === qs.Xbox360Button.A && i._cameraGazer._selectionPointerDown() }), e.onbuttonup(function (e) { i._interactionsEnabled && e === qs.Xbox360Button.A && i._cameraGazer._selectionPointerUp() })); else { var t = e, r = new $s(t, i._scene, i._cameraGazer._gazeTracker); "right" === t.hand || i._leftController && i._leftController.webVRController != t ? i._rightController = r : i._leftController = r, i._tryEnableInteractionOnController(r) } }, this._tryEnableInteractionOnController = function (e) { i._interactionsRequested && !e._interactionsEnabled && i._enableInteractionOnController(e), i._teleportationRequested && !e._teleportationEnabled && i._enableTeleportationOnController(e) }, this._onNewGamepadDisconnected = function (e) { e instanceof qs.WebVRController && ("left" === e.hand && null != i._leftController && (i._leftController.dispose(), i._leftController = null), "right" === e.hand && null != i._rightController && (i._rightController.dispose(), i._rightController = null)) }, this._workingVector = qs.Vector3.Zero(), this._workingQuaternion = qs.Quaternion.Identity(), this._workingMatrix = qs.Matrix.Identity(), this._scene = e, this._canvas = e.getEngine().getRenderingCanvas(), void 0 === t.createFallbackVRDeviceOrientationFreeCamera && (t.createFallbackVRDeviceOrientationFreeCamera = !0), void 0 === t.createDeviceOrientationCamera && (t.createDeviceOrientationCamera = !0), void 0 === t.laserToggle && (t.laserToggle = !0), void 0 === t.defaultHeight && (t.defaultHeight = 1.7), t.useCustomVRButton && (this._useCustomVRButton = !0, t.customVRButton && (this._btnVR = t.customVRButton)), t.rayLength && (this._rayLength = t.rayLength), this._defaultHeight = t.defaultHeight, t.positionScale && (this._rayLength *= t.positionScale, this._defaultHeight *= t.positionScale), this._hasEnteredVR = !1, this._scene.activeCamera ? this._position = this._scene.activeCamera.position.clone() : this._position = new qs.Vector3(0, this._defaultHeight, 0), t.createDeviceOrientationCamera || !this._scene.activeCamera) { if (this._deviceOrientationCamera = new qs.DeviceOrientationCamera("deviceOrientationVRHelper", this._position.clone(), e), this._scene.activeCamera && (this._deviceOrientationCamera.minZ = this._scene.activeCamera.minZ, this._deviceOrientationCamera.maxZ = this._scene.activeCamera.maxZ, this._scene.activeCamera instanceof qs.TargetCamera && this._scene.activeCamera.rotation)) { var r = this._scene.activeCamera; r.rotationQuaternion ? this._deviceOrientationCamera.rotationQuaternion.copyFrom(r.rotationQuaternion) : this._deviceOrientationCamera.rotationQuaternion.copyFrom(qs.Quaternion.RotationYawPitchRoll(r.rotation.y, r.rotation.x, r.rotation.z)), this._deviceOrientationCamera.rotation = r.rotation.clone() } this._scene.activeCamera = this._deviceOrientationCamera, this._canvas && this._scene.activeCamera.attachControl(this._canvas) } else this._existingCamera = this._scene.activeCamera; if (t.createFallbackVRDeviceOrientationFreeCamera && (this._vrDeviceOrientationCamera = new qs.VRDeviceOrientationFreeCamera("VRDeviceOrientationVRHelper", this._position, this._scene)), this._webVRCamera = new qs.WebVRFreeCamera("WebVRHelper", this._position, this._scene, t), this._webVRCamera.useStandingMatrix(), this._cameraGazer = new ea(function () { return i.currentVRCamera }, e), !this._useCustomVRButton) { this._btnVR = document.createElement("BUTTON"), this._btnVR.className = "babylonVRicon", this._btnVR.id = "babylonVRiconbtn", this._btnVR.title = "Click to switch to VR"; var n = document.createElement("style"); n.appendChild(document.createTextNode(".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }.babylonVRicon.vrdisplaypresenting { display: none; }")), document.getElementsByTagName("head")[0].appendChild(n), this.moveButtonToBottomRight() } this._btnVR && this._btnVR.addEventListener("click", function () { i.isInVRMode ? i.exitVR() : i.enterVR() }), window.addEventListener("resize", this._onResize), document.addEventListener("fullscreenchange", this._onFullscreenChange, !1), document.addEventListener("mozfullscreenchange", this._onFullscreenChange, !1), document.addEventListener("webkitfullscreenchange", this._onFullscreenChange, !1), document.addEventListener("msfullscreenchange", this._onFullscreenChange, !1), document.onmsfullscreenchange = this._onFullscreenChange, t.createFallbackVRDeviceOrientationFreeCamera ? this.displayVRButton() : this._scene.getEngine().onVRDisplayChangedObservable.add(function (e) { e.vrDisplay && i.displayVRButton() }), this._onKeyDown = function (e) { 27 === e.keyCode && i.isInVRMode && i.exitVR() }, document.addEventListener("keydown", this._onKeyDown), this._scene.onPrePointerObservable.add(function (e, t) { i.isInVRMode && (i.exitVR(), i._fullscreenVRpresenting && i._scene.getEngine().switchFullscreen(!0)) }, qs.PointerEventTypes.POINTERDOUBLETAP, !1), this._onVRDisplayChanged = function (e) { return i.onVRDisplayChanged(e) }, this._onVrDisplayPresentChange = function () { return i.onVrDisplayPresentChange() }, this._onVRRequestPresentStart = function () { i._webVRrequesting = !0, i.updateButtonVisibility() }, this._onVRRequestPresentComplete = function (e) { i._webVRrequesting = !1, i.updateButtonVisibility() }, e.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged), e.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart), e.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete), window.addEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange), e.onDisposeObservable.add(function () { i.dispose() }), this._webVRCamera.onControllerMeshLoadedObservable.add(function (e) { return i._onDefaultMeshLoaded(e) }), this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected), this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected), this.updateButtonVisibility(), this._circleEase = new qs.CircleEase, this._circleEase.setEasingMode(qs.EasingFunction.EASINGMODE_EASEINOUT), this.webVROptions.floorMeshes && this.enableTeleportation({ floorMeshes: this.webVROptions.floorMeshes }) } return Object.defineProperty(e.prototype, "onEnteringVR", { get: function () { return this.onEnteringVRObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "onExitingVR", { get: function () { return this.onExitingVRObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "onControllerMeshLoaded", { get: function () { return this.onControllerMeshLoadedObservable }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "teleportationTarget", { get: function () { return this._teleportationTarget }, set: function (e) { e && (e.name = "teleportationTarget", this._isDefaultTeleportationTarget = !1, this._teleportationTarget = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "gazeTrackerMesh", { get: function () { return this._cameraGazer._gazeTracker }, set: function (e) { e && (this._cameraGazer._gazeTracker && this._cameraGazer._gazeTracker.dispose(), this._leftController && this._leftController._gazeTracker && this._leftController._gazeTracker.dispose(), this._rightController && this._rightController._gazeTracker && this._rightController._gazeTracker.dispose(), this._cameraGazer._gazeTracker = e, this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(), this._cameraGazer._gazeTracker.isPickable = !1, this._cameraGazer._gazeTracker.isVisible = !1, this._cameraGazer._gazeTracker.name = "gazeTracker", this._leftController && (this._leftController._gazeTracker = this._cameraGazer._gazeTracker.clone("gazeTracker")), this._rightController && (this._rightController._gazeTracker = this._cameraGazer._gazeTracker.clone("gazeTracker"))) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "leftControllerGazeTrackerMesh", { get: function () { return this._leftController ? this._leftController._gazeTracker : null }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "rightControllerGazeTrackerMesh", { get: function () { return this._rightController ? this._rightController._gazeTracker : null }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "displayGaze", { get: function () { return this._displayGaze }, set: function (e) { (this._displayGaze = e) || (this._cameraGazer._gazeTracker.isVisible = !1, this._leftController && (this._leftController._gazeTracker.isVisible = !1), this._rightController && (this._rightController._gazeTracker.isVisible = !1)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "displayLaserPointer", { get: function () { return this._displayLaserPointer }, set: function (e) { (this._displayLaserPointer = e) ? (this._rightController && this._rightController._activatePointer(), this._leftController && this._leftController._activatePointer()) : (this._rightController && (this._rightController._deactivatePointer(), this._rightController._gazeTracker.isVisible = !1), this._leftController && (this._leftController._deactivatePointer(), this._leftController._gazeTracker.isVisible = !1)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "deviceOrientationCamera", { get: function () { return this._deviceOrientationCamera }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "currentVRCamera", { get: function () { return this._webVRready ? this._webVRCamera : this._scene.activeCamera }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "webVRCamera", { get: function () { return this._webVRCamera }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "vrDeviceOrientationCamera", { get: function () { return this._vrDeviceOrientationCamera }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "_teleportationRequestInitiated", { get: function () { return this._cameraGazer._teleportationRequestInitiated || null !== this._leftController && this._leftController._teleportationRequestInitiated || null !== this._rightController && this._rightController._teleportationRequestInitiated }, enumerable: !0, configurable: !0 }), e.prototype._onDefaultMeshLoaded = function (e) { this._leftController && this._leftController.webVRController == e && e.mesh && this._leftController._setLaserPointerParent(e.mesh), this._rightController && this._rightController.webVRController == e && e.mesh && this._rightController._setLaserPointerParent(e.mesh); try { this.onControllerMeshLoadedObservable.notifyObservers(e) } catch (e) { qs.Tools.Warn("Error in your custom logic onControllerMeshLoaded: " + e) } }, Object.defineProperty(e.prototype, "isInVRMode", { get: function () { return this._webVRpresenting || this._fullscreenVRpresenting }, enumerable: !0, configurable: !0 }), e.prototype.onVrDisplayPresentChange = function () { var e = this._scene.getEngine().getVRDevice(); if (e) { var t = this._webVRpresenting; this._webVRpresenting = e.isPresenting, t && !this._webVRpresenting && this.exitVR() } else qs.Tools.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?"); this.updateButtonVisibility() }, e.prototype.onVRDisplayChanged = function (e) { this._webVRsupported = e.vrSupported, this._webVRready = !!e.vrDisplay, this._webVRpresenting = e.vrDisplay && e.vrDisplay.isPresenting, this.updateButtonVisibility() }, e.prototype.moveButtonToBottomRight = function () { this._canvas && !this._useCustomVRButton && (this._btnVR.style.top = this._canvas.offsetTop + this._canvas.offsetHeight - 70 + "px", this._btnVR.style.left = this._canvas.offsetLeft + this._canvas.offsetWidth - 100 + "px") }, e.prototype.displayVRButton = function () { this._useCustomVRButton || this._btnVRDisplayed || (document.body.appendChild(this._btnVR), this._btnVRDisplayed = !0) }, e.prototype.updateButtonVisibility = function () { this._btnVR && !this._useCustomVRButton && (this._btnVR.className = "babylonVRicon", this.isInVRMode ? this._btnVR.className += " vrdisplaypresenting" : (this._webVRready && (this._btnVR.className += " vrdisplayready"), this._webVRsupported && (this._btnVR.className += " vrdisplaysupported"), this._webVRrequesting && (this._btnVR.className += " vrdisplayrequesting"))) }, e.prototype.enterVR = function () { if (this.onEnteringVRObservable) try { this.onEnteringVRObservable.notifyObservers(this) } catch (e) { qs.Tools.Warn("Error in your custom logic onEnteringVR: " + e) } this._scene.activeCamera && (this._position = this._scene.activeCamera.position.clone(), this._existingCamera = this._scene.activeCamera), this._webVRrequesting || (this._webVRready ? this._webVRpresenting || (this._webVRCamera.position = this._position, this._scene.activeCamera = this._webVRCamera) : this._vrDeviceOrientationCamera && (this._vrDeviceOrientationCamera.position = this._position, this._scene.activeCamera && (this._vrDeviceOrientationCamera.minZ = this._scene.activeCamera.minZ), this._scene.activeCamera = this._vrDeviceOrientationCamera, this._scene.getEngine().switchFullscreen(!0), this.updateButtonVisibility()), this._scene.activeCamera && this._canvas && this._scene.activeCamera.attachControl(this._canvas), this._interactionsEnabled && this._scene.registerBeforeRender(this.beforeRender), this._hasEnteredVR = !0) }, e.prototype.exitVR = function () { if (this._hasEnteredVR) { if (this.onExitingVRObservable) try { this.onExitingVRObservable.notifyObservers(this) } catch (e) { qs.Tools.Warn("Error in your custom logic onExitingVR: " + e) } this._webVRpresenting && this._scene.getEngine().disableVR(), this._scene.activeCamera && (this._position = this._scene.activeCamera.position.clone()), this._deviceOrientationCamera ? (this._deviceOrientationCamera.position = this._position, this._scene.activeCamera = this._deviceOrientationCamera, this._canvas && this._scene.activeCamera.attachControl(this._canvas)) : this._existingCamera && (this._existingCamera.position = this._position, this._scene.activeCamera = this._existingCamera), this.updateButtonVisibility(), this._interactionsEnabled && (this._scene.unregisterBeforeRender(this.beforeRender), this._cameraGazer._gazeTracker.isVisible = !1, this._leftController && (this._leftController._gazeTracker.isVisible = !1), this._rightController && (this._rightController._gazeTracker.isVisible = !1)), this._scene.getEngine().resize(), this._hasEnteredVR = !1 } }, Object.defineProperty(e.prototype, "position", { get: function () { return this._position }, set: function (e) { this._position = e, this._scene.activeCamera && (this._scene.activeCamera.position = e) }, enumerable: !0, configurable: !0 }), e.prototype.enableInteractions = function () { var e = this; this._interactionsEnabled || (this._interactionsRequested = !0, this._leftController && this._enableInteractionOnController(this._leftController), this._rightController && this._enableInteractionOnController(this._rightController), this.raySelectionPredicate = function (t) { return t.isVisible && (t.isPickable || t.name === e._floorMeshName) }, this.meshSelectionPredicate = function (e) { return !0 }, this._raySelectionPredicate = function (t) { return !!(e._isTeleportationFloor(t) || -1 === t.name.indexOf("gazeTracker") && -1 === t.name.indexOf("teleportationTarget") && -1 === t.name.indexOf("torusTeleportation")) && e.raySelectionPredicate(t) }, this._interactionsEnabled = !0) }, Object.defineProperty(e.prototype, "_noControllerIsActive", { get: function () { return !(this._leftController && this._leftController._activePointer || this._rightController && this._rightController._activePointer) }, enumerable: !0, configurable: !0 }), e.prototype._isTeleportationFloor = function (e) { for (var t = 0; t < this._floorMeshesCollection.length; t++)if (this._floorMeshesCollection[t].id === e.id) return !0; return !(!this._floorMeshName || e.name !== this._floorMeshName) }, e.prototype.addFloorMesh = function (e) { this._floorMeshesCollection && (-1 < this._floorMeshesCollection.indexOf(e) || this._floorMeshesCollection.push(e)) }, e.prototype.removeFloorMesh = function (e) { if (this._floorMeshesCollection) { var t = this._floorMeshesCollection.indexOf(e); -1 !== t && this._floorMeshesCollection.splice(t, 1) } }, e.prototype.enableTeleportation = function (e) { if (void 0 === e && (e = {}), !this._teleportationInitialized) { this._teleportationRequested = !0, this.enableInteractions(), e.floorMeshName && (this._floorMeshName = e.floorMeshName), e.floorMeshes && (this._floorMeshesCollection = e.floorMeshes), null != this._leftController && this._enableTeleportationOnController(this._leftController), null != this._rightController && this._enableTeleportationOnController(this._rightController); var t = new qs.ImageProcessingConfiguration; t.vignetteColor = new qs.Color4(0, 0, 0, 0), t.vignetteEnabled = !0, this._postProcessMove = new qs.ImageProcessingPostProcess("postProcessMove", 1, this._webVRCamera, void 0, void 0, void 0, void 0, t), this._webVRCamera.detachPostProcess(this._postProcessMove), this._teleportationInitialized = !0, this._isDefaultTeleportationTarget && (this._createTeleportationCircles(), this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor)) } }, e.prototype._enableInteractionOnController = function (e) { var t = this; e.webVRController.mesh && (e._interactionsEnabled = !0, e._activatePointer(), this.webVROptions.laserToggle && e.webVRController.onMainButtonStateChangedObservable.add(function (i) { t._displayLaserPointer && 1 === i.value && (e._activePointer ? e._deactivatePointer() : e._activatePointer(), t.displayGaze && (e._gazeTracker.isVisible = e._activePointer)) }), e.webVRController.onTriggerStateChangedObservable.add(function (i) { var r = e; t._noControllerIsActive && (r = t._cameraGazer), r._pointerDownOnMeshAsked ? i.value < t._padSensibilityDown && r._selectionPointerUp() : i.value > t._padSensibilityUp && r._selectionPointerDown() })) }, e.prototype._checkTeleportWithRay = function (e, t) { this._teleportationRequestInitiated && !t._teleportationRequestInitiated || (t._teleportationRequestInitiated ? Math.sqrt(e.y * e.y + e.x * e.x) < this._padSensibilityDown && (this._teleportActive && this.teleportCamera(this._haloCenter), t._teleportationRequestInitiated = !1) : e.y < -this._padSensibilityUp && t._dpadPressed && (t._activatePointer(), t._teleportationRequestInitiated = !0)) }, e.prototype._checkRotate = function (e, t) { t._teleportationRequestInitiated || (t._rotationLeftAsked ? e.x > -this._padSensibilityDown && (t._rotationLeftAsked = !1) : e.x < -this._padSensibilityUp && t._dpadPressed && (t._rotationLeftAsked = !0, this._rotationAllowed && this._rotateCamera(!1)), t._rotationRightAsked ? e.x < this._padSensibilityDown && (t._rotationRightAsked = !1) : e.x > this._padSensibilityUp && t._dpadPressed && (t._rotationRightAsked = !0, this._rotationAllowed && this._rotateCamera(!0))) }, e.prototype._checkTeleportBackwards = function (e, t) { if (!t._teleportationRequestInitiated) if (e.y > this._padSensibilityUp && t._dpadPressed) { if (!t._teleportationBackRequestInitiated) { if (!this.currentVRCamera) return; var i = qs.Quaternion.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()), r = this.currentVRCamera.position; this.currentVRCamera.devicePosition && this.currentVRCamera.deviceRotationQuaternion && (i = this.currentVRCamera.deviceRotationQuaternion, r = this.currentVRCamera.devicePosition), i.toEulerAnglesToRef(this._workingVector), this._workingVector.z = 0, this._workingVector.x = 0, qs.Quaternion.RotationYawPitchRollToRef(this._workingVector.y, this._workingVector.x, this._workingVector.z, this._workingQuaternion), this._workingQuaternion.toRotationMatrix(this._workingMatrix), qs.Vector3.TransformCoordinatesToRef(this._teleportBackwardsVector, this._workingMatrix, this._workingVector); var n = new qs.Ray(r, this._workingVector), o = this._scene.pickWithRay(n, this._raySelectionPredicate); o && o.pickedPoint && o.pickedMesh && this._isTeleportationFloor(o.pickedMesh) && o.distance < 5 && this.teleportCamera(o.pickedPoint), t._teleportationBackRequestInitiated = !0 } } else t._teleportationBackRequestInitiated = !1 }, e.prototype._enableTeleportationOnController = function (e) { var t = this; e.webVRController.mesh && (e._interactionsEnabled || this._enableInteractionOnController(e), e._interactionsEnabled = !0, e._teleportationEnabled = !0, e.webVRController.controllerType === qs.PoseEnabledControllerType.VIVE && (e._dpadPressed = !1, e.webVRController.onPadStateChangedObservable.add(function (t) { e._dpadPressed = t.pressed, e._dpadPressed || (e._rotationLeftAsked = !1, e._rotationRightAsked = !1, e._teleportationBackRequestInitiated = !1) })), e.webVRController.onPadValuesChangedObservable.add(function (i) { t.teleportationEnabled && (t._checkTeleportBackwards(i, e), t._checkTeleportWithRay(i, e)), t._checkRotate(i, e) })) }, e.prototype._createTeleportationCircles = function () { this._teleportationTarget = qs.Mesh.CreateGround("teleportationTarget", 2, 2, 2, this._scene), this._teleportationTarget.isPickable = !1; var e = new qs.DynamicTexture("DynamicTexture", 512, this._scene, !0); e.hasAlpha = !0; var t = e.getContext(); t.beginPath(), t.arc(256, 256, 200, 0, 2 * Math.PI, !1), t.fillStyle = this._teleportationFillColor, t.fill(), t.lineWidth = 10, t.strokeStyle = this._teleportationBorderColor, t.stroke(), t.closePath(), e.update(); var i = new qs.StandardMaterial("TextPlaneMaterial", this._scene); i.diffuseTexture = e, this._teleportationTarget.material = i; var r = qs.Mesh.CreateTorus("torusTeleportation", .75, .1, 25, this._scene, !1); r.isPickable = !1, r.parent = this._teleportationTarget; var n = new qs.Animation("animationInnerCircle", "position.y", 30, qs.Animation.ANIMATIONTYPE_FLOAT, qs.Animation.ANIMATIONLOOPMODE_CYCLE), o = []; o.push({ frame: 0, value: 0 }), o.push({ frame: 30, value: .4 }), o.push({ frame: 60, value: 0 }), n.setKeys(o); var s = new qs.SineEase; s.setEasingMode(qs.EasingFunction.EASINGMODE_EASEINOUT), n.setEasingFunction(s), r.animations = [], r.animations.push(n), this._scene.beginAnimation(r, 0, 60, !0), this._hideTeleportationTarget() }, e.prototype._displayTeleportationTarget = function () { this._teleportActive = !0, this._teleportationInitialized && (this._teleportationTarget.isVisible = !0, this._isDefaultTeleportationTarget && (this._teleportationTarget.getChildren()[0].isVisible = !0)) }, e.prototype._hideTeleportationTarget = function () { this._teleportActive = !1, this._teleportationInitialized && (this._teleportationTarget.isVisible = !1, this._isDefaultTeleportationTarget && (this._teleportationTarget.getChildren()[0].isVisible = !1)) }, e.prototype._rotateCamera = function (e) { var t = this; if (this.currentVRCamera instanceof qs.FreeCamera) { e ? this._rotationAngle++ : this._rotationAngle-- , this.currentVRCamera.animations = []; var i = qs.Quaternion.FromRotationMatrix(qs.Matrix.RotationY(Math.PI / 4 * this._rotationAngle)), r = new qs.Animation("animationRotation", "rotationQuaternion", 90, qs.Animation.ANIMATIONTYPE_QUATERNION, qs.Animation.ANIMATIONLOOPMODE_CONSTANT), n = []; n.push({ frame: 0, value: this.currentVRCamera.rotationQuaternion }), n.push({ frame: 6, value: i }), r.setKeys(n), r.setEasingFunction(this._circleEase), this.currentVRCamera.animations.push(r), this._postProcessMove.animations = []; var o = new qs.Animation("animationPP", "vignetteWeight", 90, qs.Animation.ANIMATIONTYPE_FLOAT, qs.Animation.ANIMATIONLOOPMODE_CONSTANT), s = []; s.push({ frame: 0, value: 0 }), s.push({ frame: 3, value: 4 }), s.push({ frame: 6, value: 0 }), o.setKeys(s), o.setEasingFunction(this._circleEase), this._postProcessMove.animations.push(o); var a = new qs.Animation("animationPP2", "vignetteStretch", 90, qs.Animation.ANIMATIONTYPE_FLOAT, qs.Animation.ANIMATIONLOOPMODE_CONSTANT), l = []; l.push({ frame: 0, value: 0 }), l.push({ frame: 3, value: 10 }), l.push({ frame: 6, value: 0 }), a.setKeys(l), a.setEasingFunction(this._circleEase), this._postProcessMove.animations.push(a), this._postProcessMove.imageProcessingConfiguration.vignetteWeight = 0, this._postProcessMove.imageProcessingConfiguration.vignetteStretch = 0, this._postProcessMove.samples = 4, this._webVRCamera.attachPostProcess(this._postProcessMove), this._scene.beginAnimation(this._postProcessMove, 0, 6, !1, 1, function () { t._webVRCamera.detachPostProcess(t._postProcessMove) }), this._scene.beginAnimation(this.currentVRCamera, 0, 6, !1, 1) } }, e.prototype._moveTeleportationSelectorTo = function (e, t, i) { if (e.pickedPoint) { t._teleportationRequestInitiated && (this._displayTeleportationTarget(), this._haloCenter.copyFrom(e.pickedPoint), this._teleportationTarget.position.copyFrom(e.pickedPoint)); var r = this._convertNormalToDirectionOfRay(e.getNormal(!0, !1), i); if (r) { var n = qs.Vector3.Cross(qs.Axis.Y, r), o = qs.Vector3.Cross(r, n); qs.Vector3.RotationFromAxisToRef(o, r, n, this._teleportationTarget.rotation) } this._teleportationTarget.position.y += .1 } }, e.prototype.teleportCamera = function (e) { var t = this; if (this.currentVRCamera instanceof qs.FreeCamera) { this.webVRCamera.leftCamera ? (this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition), this._workingVector.subtractInPlace(this.webVRCamera.position), e.subtractToRef(this._workingVector, this._workingVector)) : this._workingVector.copyFrom(e), this.isInVRMode ? this._workingVector.y += this.webVRCamera.deviceDistanceToRoomGround() * this._webVRCamera.deviceScaleFactor : this._workingVector.y += this._defaultHeight, this.onBeforeCameraTeleport.notifyObservers(this._workingVector), this.currentVRCamera.animations = []; var i = new qs.Animation("animationCameraTeleportation", "position", 90, qs.Animation.ANIMATIONTYPE_VECTOR3, qs.Animation.ANIMATIONLOOPMODE_CONSTANT), r = [{ frame: 0, value: this.currentVRCamera.position }, { frame: 11, value: this._workingVector }]; i.setKeys(r), i.setEasingFunction(this._circleEase), this.currentVRCamera.animations.push(i), this._postProcessMove.animations = []; var n = new qs.Animation("animationPP", "vignetteWeight", 90, qs.Animation.ANIMATIONTYPE_FLOAT, qs.Animation.ANIMATIONLOOPMODE_CONSTANT), o = []; o.push({ frame: 0, value: 0 }), o.push({ frame: 5, value: 8 }), o.push({ frame: 11, value: 0 }), n.setKeys(o), this._postProcessMove.animations.push(n); var s = new qs.Animation("animationPP2", "vignetteStretch", 90, qs.Animation.ANIMATIONTYPE_FLOAT, qs.Animation.ANIMATIONLOOPMODE_CONSTANT), a = []; a.push({ frame: 0, value: 0 }), a.push({ frame: 5, value: 10 }), a.push({ frame: 11, value: 0 }), s.setKeys(a), this._postProcessMove.animations.push(s), this._postProcessMove.imageProcessingConfiguration.vignetteWeight = 0, this._postProcessMove.imageProcessingConfiguration.vignetteStretch = 0, this._webVRCamera.attachPostProcess(this._postProcessMove), this._scene.beginAnimation(this._postProcessMove, 0, 11, !1, 1, function () { t._webVRCamera.detachPostProcess(t._postProcessMove) }), this._scene.beginAnimation(this.currentVRCamera, 0, 11, !1, 1, function () { t.onAfterCameraTeleport.notifyObservers(t._workingVector) }), this._hideTeleportationTarget() } }, e.prototype._convertNormalToDirectionOfRay = function (e, t) { return e && Math.acos(qs.Vector3.Dot(e, t.direction)) < Math.PI / 2 && e.scaleInPlace(-1), e }, e.prototype._castRayAndSelectObject = function (e) { if (this.currentVRCamera instanceof qs.FreeCamera) { var t = e._getForwardRay(this._rayLength), i = this._scene.pickWithRay(t, this._raySelectionPredicate); if (i && (e._laserPointer && (i.originMesh = e._laserPointer.parent), this._scene.simulatePointerMove(i, { pointerId: e._id })), (e._currentHit = i) && i.pickedPoint) { if (this._displayGaze) { var r = 1; e._gazeTracker.isVisible = !0, e._isActionableMesh && (r = 3), this.updateGazeTrackerScale && (e._gazeTracker.scaling.x = i.distance * r, e._gazeTracker.scaling.y = i.distance * r, e._gazeTracker.scaling.z = i.distance * r); var n = this._convertNormalToDirectionOfRay(i.getNormal(), t); if (n) { var o = qs.Vector3.Cross(qs.Axis.Y, n), s = qs.Vector3.Cross(n, o); qs.Vector3.RotationFromAxisToRef(s, n, o, e._gazeTracker.rotation) } e._gazeTracker.position.copyFrom(i.pickedPoint), e._gazeTracker.position.x < 0 ? e._gazeTracker.position.x += .002 : e._gazeTracker.position.x -= .002, e._gazeTracker.position.y < 0 ? e._gazeTracker.position.y += .002 : e._gazeTracker.position.y -= .002, e._gazeTracker.position.z < 0 ? e._gazeTracker.position.z += .002 : e._gazeTracker.position.z -= .002 } e._updatePointerDistance(i.distance) } else e._updatePointerDistance(), e._gazeTracker.isVisible = !1; if (i && i.pickedMesh) { if (this._teleportationInitialized && this._isTeleportationFloor(i.pickedMesh) && i.pickedPoint) return e._currentMeshSelected && !this._isTeleportationFloor(e._currentMeshSelected) && this._notifySelectedMeshUnselected(e._currentMeshSelected), e._currentMeshSelected = null, void (e._teleportationRequestInitiated && this._moveTeleportationSelectorTo(i, e, t)); if (i.pickedMesh !== e._currentMeshSelected) if (this.meshSelectionPredicate(i.pickedMesh)) { this.onNewMeshPicked.notifyObservers(i), e._currentMeshSelected = i.pickedMesh, i.pickedMesh.isPickable && i.pickedMesh.actionManager ? (this.changeGazeColor(new qs.Color3(0, 0, 1)), this.changeLaserColor(new qs.Color3(.2, .2, 1)), e._isActionableMesh = !0) : (this.changeGazeColor(new qs.Color3(.7, .7, .7)), this.changeLaserColor(new qs.Color3(.7, .7, .7)), e._isActionableMesh = !1); try { this.onNewMeshSelected.notifyObservers(i.pickedMesh) } catch (e) { qs.Tools.Warn("Error in your custom logic onNewMeshSelected: " + e) } } else this._notifySelectedMeshUnselected(e._currentMeshSelected), e._currentMeshSelected = null, this.changeGazeColor(new qs.Color3(.7, .7, .7)), this.changeLaserColor(new qs.Color3(.7, .7, .7)) } else this._notifySelectedMeshUnselected(e._currentMeshSelected), e._currentMeshSelected = null, this.changeGazeColor(new qs.Color3(.7, .7, .7)), this.changeLaserColor(new qs.Color3(.7, .7, .7)) } }, e.prototype._notifySelectedMeshUnselected = function (e) { e && this.onSelectedMeshUnselected.notifyObservers(e) }, e.prototype.changeLaserColor = function (e) { this._leftController && this._leftController._setLaserPointerColor(e), this._rightController && this._rightController._setLaserPointerColor(e) }, e.prototype.changeGazeColor = function (e) { this._cameraGazer._gazeTracker.material && (this._cameraGazer._gazeTracker.material.emissiveColor = e, this._leftController && (this._leftController._gazeTracker.material.emissiveColor = e), this._rightController && (this._rightController._gazeTracker.material.emissiveColor = e)) }, e.prototype.dispose = function () { this.isInVRMode && this.exitVR(), this._postProcessMove && this._postProcessMove.dispose(), this._webVRCamera && this._webVRCamera.dispose(), this._vrDeviceOrientationCamera && this._vrDeviceOrientationCamera.dispose(), !this._useCustomVRButton && this._btnVR.parentNode && document.body.removeChild(this._btnVR), this._deviceOrientationCamera && this._scene.activeCamera != this._deviceOrientationCamera && this._deviceOrientationCamera.dispose(), this._cameraGazer && this._cameraGazer.dispose(), this._leftController && this._leftController.dispose(), this._rightController && this._rightController.dispose(), this._teleportationTarget && this._teleportationTarget.dispose(), this._floorMeshesCollection = [], document.removeEventListener("keydown", this._onKeyDown), window.removeEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange), window.removeEventListener("resize", this._onResize), document.removeEventListener("fullscreenchange", this._onFullscreenChange), document.removeEventListener("mozfullscreenchange", this._onFullscreenChange), document.removeEventListener("webkitfullscreenchange", this._onFullscreenChange), document.removeEventListener("msfullscreenchange", this._onFullscreenChange), document.onmsfullscreenchange = null, this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged), this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart), this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete), window.removeEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange), this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected), this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected), this._scene.unregisterBeforeRender(this.beforeRender) }, e.prototype.getClassName = function () { return "VRExperienceHelper" }, e }(), qs.VRExperienceHelper = ta, function (e) { var t, i; (i = t = e.JoystickAxis || (e.JoystickAxis = {}))[i.X = 0] = "X", i[i.Y = 1] = "Y", i[i.Z = 2] = "Z"; var r = function () { function i(r) { var n = this; if (this._leftJoystick = !!r, i._globalJoystickIndex++ , this._axisTargetedByLeftAndRight = t.X, this._axisTargetedByUpAndDown = t.Y, this.reverseLeftRight = !1, this.reverseUpDown = !1, this._touches = new e.StringDictionary, this.deltaPosition = e.Vector3.Zero(), this._joystickSensibility = 25, this._inversedSensibility = 1 / (this._joystickSensibility / 1e3), this._onResize = function (e) { i.vjCanvasWidth = window.innerWidth, i.vjCanvasHeight = window.innerHeight, i.vjCanvas && (i.vjCanvas.width = i.vjCanvasWidth, i.vjCanvas.height = i.vjCanvasHeight), i.halfWidth = i.vjCanvasWidth / 2 }, !i.vjCanvas) { window.addEventListener("resize", this._onResize, !1), i.vjCanvas = document.createElement("canvas"), i.vjCanvasWidth = window.innerWidth, i.vjCanvasHeight = window.innerHeight, i.vjCanvas.width = window.innerWidth, i.vjCanvas.height = window.innerHeight, i.vjCanvas.style.width = "100%", i.vjCanvas.style.height = "100%", i.vjCanvas.style.position = "absolute", i.vjCanvas.style.backgroundColor = "transparent", i.vjCanvas.style.top = "0px", i.vjCanvas.style.left = "0px", i.vjCanvas.style.zIndex = "5", i.vjCanvas.style.msTouchAction = "none", i.vjCanvas.setAttribute("touch-action", "none"); var o = i.vjCanvas.getContext("2d"); if (!o) throw new Error("Unable to create canvas for virtual joystick"); (i.vjCanvasContext = o).strokeStyle = "#ffffff", i.vjCanvasContext.lineWidth = 2, document.body.appendChild(i.vjCanvas) } i.halfWidth = i.vjCanvas.width / 2, this.pressed = !1, this._joystickColor = "cyan", this._joystickPointerID = -1, this._joystickPointerPos = new e.Vector2(0, 0), this._joystickPreviousPointerPos = new e.Vector2(0, 0), this._joystickPointerStartPos = new e.Vector2(0, 0), this._deltaJoystickVector = new e.Vector2(0, 0), this._onPointerDownHandlerRef = function (e) { n._onPointerDown(e) }, this._onPointerMoveHandlerRef = function (e) { n._onPointerMove(e) }, this._onPointerUpHandlerRef = function (e) { n._onPointerUp(e) }, i.vjCanvas.addEventListener("pointerdown", this._onPointerDownHandlerRef, !1), i.vjCanvas.addEventListener("pointermove", this._onPointerMoveHandlerRef, !1), i.vjCanvas.addEventListener("pointerup", this._onPointerUpHandlerRef, !1), i.vjCanvas.addEventListener("pointerout", this._onPointerUpHandlerRef, !1), i.vjCanvas.addEventListener("contextmenu", function (e) { e.preventDefault() }, !1), requestAnimationFrame(function () { n._drawVirtualJoystick() }) } return i.prototype.setJoystickSensibility = function (e) { this._joystickSensibility = e, this._inversedSensibility = 1 / (this._joystickSensibility / 1e3) }, i.prototype._onPointerDown = function (e) { e.preventDefault(), (!0 === this._leftJoystick ? e.clientX < i.halfWidth : e.clientX > i.halfWidth) && this._joystickPointerID < 0 ? (this._joystickPointerID = e.pointerId, this._joystickPointerStartPos.x = e.clientX, this._joystickPointerStartPos.y = e.clientY, this._joystickPointerPos = this._joystickPointerStartPos.clone(), this._joystickPreviousPointerPos = this._joystickPointerStartPos.clone(), this._deltaJoystickVector.x = 0, this._deltaJoystickVector.y = 0, this.pressed = !0, this._touches.add(e.pointerId.toString(), e)) : i._globalJoystickIndex < 2 && this._action && (this._action(), this._touches.add(e.pointerId.toString(), { x: e.clientX, y: e.clientY, prevX: e.clientX, prevY: e.clientY })) }, i.prototype._onPointerMove = function (e) { if (this._joystickPointerID == e.pointerId) { this._joystickPointerPos.x = e.clientX, this._joystickPointerPos.y = e.clientY, this._deltaJoystickVector = this._joystickPointerPos.clone(), this._deltaJoystickVector = this._deltaJoystickVector.subtract(this._joystickPointerStartPos); var i = (this.reverseLeftRight ? -1 : 1) * this._deltaJoystickVector.x / this._inversedSensibility; switch (this._axisTargetedByLeftAndRight) { case t.X: this.deltaPosition.x = Math.min(1, Math.max(-1, i)); break; case t.Y: this.deltaPosition.y = Math.min(1, Math.max(-1, i)); break; case t.Z: this.deltaPosition.z = Math.min(1, Math.max(-1, i)) }var r = (this.reverseUpDown ? 1 : -1) * this._deltaJoystickVector.y / this._inversedSensibility; switch (this._axisTargetedByUpAndDown) { case t.X: this.deltaPosition.x = Math.min(1, Math.max(-1, r)); break; case t.Y: this.deltaPosition.y = Math.min(1, Math.max(-1, r)); break; case t.Z: this.deltaPosition.z = Math.min(1, Math.max(-1, r)) } } else { var n = this._touches.get(e.pointerId.toString()); n && (n.x = e.clientX, n.y = e.clientY) } }, i.prototype._onPointerUp = function (e) { if (this._joystickPointerID == e.pointerId) i.vjCanvasContext.clearRect(this._joystickPointerStartPos.x - 64, this._joystickPointerStartPos.y - 64, 128, 128), i.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x - 42, this._joystickPreviousPointerPos.y - 42, 84, 84), this._joystickPointerID = -1, this.pressed = !1; else { var t = this._touches.get(e.pointerId.toString()); t && i.vjCanvasContext.clearRect(t.prevX - 44, t.prevY - 44, 88, 88) } this._deltaJoystickVector.x = 0, this._deltaJoystickVector.y = 0, this._touches.remove(e.pointerId.toString()) }, i.prototype.setJoystickColor = function (e) { this._joystickColor = e }, i.prototype.setActionOnTouch = function (e) { this._action = e }, i.prototype.setAxisForLeftRight = function (e) { switch (e) { case t.X: case t.Y: case t.Z: this._axisTargetedByLeftAndRight = e; break; default: this._axisTargetedByLeftAndRight = t.X } }, i.prototype.setAxisForUpDown = function (e) { switch (e) { case t.X: case t.Y: case t.Z: this._axisTargetedByUpAndDown = e; break; default: this._axisTargetedByUpAndDown = t.Y } }, i.prototype._drawVirtualJoystick = function () { var e = this; this.pressed && this._touches.forEach(function (t, r) { r.pointerId === e._joystickPointerID ? (i.vjCanvasContext.clearRect(e._joystickPointerStartPos.x - 64, e._joystickPointerStartPos.y - 64, 128, 128), i.vjCanvasContext.clearRect(e._joystickPreviousPointerPos.x - 42, e._joystickPreviousPointerPos.y - 42, 84, 84), i.vjCanvasContext.beginPath(), i.vjCanvasContext.lineWidth = 6, i.vjCanvasContext.strokeStyle = e._joystickColor, i.vjCanvasContext.arc(e._joystickPointerStartPos.x, e._joystickPointerStartPos.y, 40, 0, 2 * Math.PI, !0), i.vjCanvasContext.stroke(), i.vjCanvasContext.closePath(), i.vjCanvasContext.beginPath(), i.vjCanvasContext.strokeStyle = e._joystickColor, i.vjCanvasContext.lineWidth = 2, i.vjCanvasContext.arc(e._joystickPointerStartPos.x, e._joystickPointerStartPos.y, 60, 0, 2 * Math.PI, !0), i.vjCanvasContext.stroke(), i.vjCanvasContext.closePath(), i.vjCanvasContext.beginPath(), i.vjCanvasContext.strokeStyle = e._joystickColor, i.vjCanvasContext.arc(e._joystickPointerPos.x, e._joystickPointerPos.y, 40, 0, 2 * Math.PI, !0), i.vjCanvasContext.stroke(), i.vjCanvasContext.closePath(), e._joystickPreviousPointerPos = e._joystickPointerPos.clone()) : (i.vjCanvasContext.clearRect(r.prevX - 44, r.prevY - 44, 88, 88), i.vjCanvasContext.beginPath(), i.vjCanvasContext.fillStyle = "white", i.vjCanvasContext.beginPath(), i.vjCanvasContext.strokeStyle = "red", i.vjCanvasContext.lineWidth = 6, i.vjCanvasContext.arc(r.x, r.y, 40, 0, 2 * Math.PI, !0), i.vjCanvasContext.stroke(), i.vjCanvasContext.closePath(), r.prevX = r.x, r.prevY = r.y) }), requestAnimationFrame(function () { e._drawVirtualJoystick() }) }, i.prototype.releaseCanvas = function () { i.vjCanvas && (i.vjCanvas.removeEventListener("pointerdown", this._onPointerDownHandlerRef), i.vjCanvas.removeEventListener("pointermove", this._onPointerMoveHandlerRef), i.vjCanvas.removeEventListener("pointerup", this._onPointerUpHandlerRef), i.vjCanvas.removeEventListener("pointerout", this._onPointerUpHandlerRef), window.removeEventListener("resize", this._onResize), document.body.removeChild(i.vjCanvas), i.vjCanvas = null) }, i._globalJoystickIndex = 0, i }(); e.VirtualJoystick = r }($a || ($a = {})), function (e) { e.Node.AddNodeConstructor("VirtualJoysticksCamera", function (i, r) { return function () { return new t(i, e.Vector3.Zero(), r) } }); var t = function (e) { function t(t, i, r) { var n = e.call(this, t, i, r) || this; return n.inputs.addVirtualJoystick(), n } return T(t, e), t.prototype.getClassName = function () { return "VirtualJoysticksCamera" }, t }(e.FreeCamera); e.VirtualJoysticksCamera = t }($a || ($a = {})), ia = $a || ($a = {}), ra = function () { function e() { } return e.prototype.getLeftJoystick = function () { return this._leftjoystick }, e.prototype.getRightJoystick = function () { return this._rightjoystick }, e.prototype.checkInputs = function () { if (this._leftjoystick) { var e = this.camera, t = 50 * e._computeLocalCameraSpeed(), i = ia.Matrix.RotationYawPitchRoll(e.rotation.y, e.rotation.x, 0), r = ia.Vector3.TransformCoordinates(new ia.Vector3(this._leftjoystick.deltaPosition.x * t, this._leftjoystick.deltaPosition.y * t, this._leftjoystick.deltaPosition.z * t), i); e.cameraDirection = e.cameraDirection.add(r), e.cameraRotation = e.cameraRotation.addVector3(this._rightjoystick.deltaPosition), this._leftjoystick.pressed || (this._leftjoystick.deltaPosition = this._leftjoystick.deltaPosition.scale(.9)), this._rightjoystick.pressed || (this._rightjoystick.deltaPosition = this._rightjoystick.deltaPosition.scale(.9)) } }, e.prototype.attachControl = function (e, t) { this._leftjoystick = new ia.VirtualJoystick(!0), this._leftjoystick.setAxisForUpDown(ia.JoystickAxis.Z), this._leftjoystick.setAxisForLeftRight(ia.JoystickAxis.X), this._leftjoystick.setJoystickSensibility(.15), this._rightjoystick = new ia.VirtualJoystick(!1), this._rightjoystick.setAxisForUpDown(ia.JoystickAxis.X), this._rightjoystick.setAxisForLeftRight(ia.JoystickAxis.Y), this._rightjoystick.reverseUpDown = !0, this._rightjoystick.setJoystickSensibility(.05), this._rightjoystick.setJoystickColor("yellow") }, e.prototype.detachControl = function (e) { this._leftjoystick.releaseCanvas(), this._rightjoystick.releaseCanvas() }, e.prototype.getClassName = function () { return "FreeCameraVirtualJoystickInput" }, e.prototype.getSimpleName = function () { return "virtualJoystick" }, e }(), ia.FreeCameraVirtualJoystickInput = ra, ia.CameraInputTypes.FreeCameraVirtualJoystickInput = ra, function (e) { e.SimplificationSettings = function (e, t, i) { this.quality = e, this.distance = t, this.optimizeMesh = i }; var t, i, r = function () { function i() { this.running = !1, this._simplificationArray = [] } return i.prototype.addTask = function (e) { this._simplificationArray.push(e) }, i.prototype.executeNext = function () { var e = this._simplificationArray.pop(); e ? (this.running = !0, this.runSimplification(e)) : this.running = !1 }, i.prototype.runSimplification = function (t) { var i = this; if (t.parallelProcessing) t.settings.forEach(function (e) { i.getSimplifier(t).simplify(e, function (r) { t.mesh.addLODLevel(e.distance, r), r.isVisible = !0, e.quality === t.settings[t.settings.length - 1].quality && t.successCallback && t.successCallback(), i.executeNext() }) }); else { var r = this.getSimplifier(t); e.AsyncLoop.Run(t.settings.length, function (e) { var i, n; i = t.settings[e.index], n = function () { e.executeNext() }, r.simplify(i, function (e) { t.mesh.addLODLevel(i.distance, e), e.isVisible = !0, n() }) }, function () { t.successCallback && t.successCallback(), i.executeNext() }) } }, i.prototype.getSimplifier = function (e) { switch (e.simplificationType) { case t.QUADRATIC: default: return new l(e.mesh) } }, i }(); e.SimplificationQueue = r, (i = t = e.SimplificationType || (e.SimplificationType = {}))[i.QUADRATIC = 0] = "QUADRATIC"; var n = function (e) { this.vertices = e, this.error = new Array(4), this.deleted = !1, this.isDirty = !1, this.deletePending = !1, this.borderFactor = 0 }, o = function () { function e(e, t) { this.position = e, this.id = t, this.isBorder = !0, this.q = new s, this.triangleCount = 0, this.triangleStart = 0, this.originalOffsets = [] } return e.prototype.updatePosition = function (e) { this.position.copyFrom(e) }, e }(), s = function () { function e(e) { this.data = new Array(10); for (var t = 0; t < 10; ++t)e && e[t] ? this.data[t] = e[t] : this.data[t] = 0 } return e.prototype.det = function (e, t, i, r, n, o, s, a, l) { return this.data[e] * this.data[n] * this.data[l] + this.data[i] * this.data[r] * this.data[a] + this.data[t] * this.data[o] * this.data[s] - this.data[i] * this.data[n] * this.data[s] - this.data[e] * this.data[o] * this.data[a] - this.data[t] * this.data[r] * this.data[l] }, e.prototype.addInPlace = function (e) { for (var t = 0; t < 10; ++t)this.data[t] += e.data[t] }, e.prototype.addArrayInPlace = function (e) { for (var t = 0; t < 10; ++t)this.data[t] += e[t] }, e.prototype.add = function (t) { for (var i = new e, r = 0; r < 10; ++r)i.data[r] = this.data[r] + t.data[r]; return i }, e.FromData = function (t, i, r, n) { return new e(e.DataFromNumbers(t, i, r, n)) }, e.DataFromNumbers = function (e, t, i, r) { return [e * e, e * t, e * i, e * r, t * t, t * i, t * r, i * i, i * r, r * r] }, e }(), a = function (e, t) { this.vertexId = e, this.triangleId = t }, l = function () { function t(t) { this._mesh = t, this.syncIterations = 5e3, this.aggressiveness = 7, this.decimationIterations = 100, this.boundingBoxEpsilon = e.Epsilon } return t.prototype.simplify = function (t, i) { var r = this; this.initDecimatedMesh(), e.AsyncLoop.Run(this._mesh.subMeshes.length, function (e) { r.initWithMesh(e.index, function () { r.runDecimation(t, e.index, function () { e.executeNext() }) }, t.optimizeMesh) }, function () { setTimeout(function () { i(r._reconstructedMesh) }, 0) }) }, t.prototype.runDecimation = function (t, i, r) { var n = this, o = ~~(this.triangles.length * t.quality), s = 0, a = this.triangles.length; e.AsyncLoop.Run(this.decimationIterations, function (t) { var i, r; a - s <= o ? t.breakLoop() : (i = t.index, r = function () { t.executeNext() }, setTimeout(function () { i % 5 == 0 && n.updateMesh(0 === i); for (var t = 0; t < n.triangles.length; ++t)n.triangles[t].isDirty = !1; var l = 1e-9 * Math.pow(i + 3, n.aggressiveness); e.AsyncLoop.SyncAsyncForLoop(n.triangles.length, n.syncIterations, function (t) { var i = ~~((n.triangles.length / 2 + t) % n.triangles.length), r = n.triangles[i]; if (r && !(r.error[3] > l || r.deleted || r.isDirty)) for (var o = 0; o < 3; ++o)if (r.error[o] < l) { var a = [], c = [], h = r.vertices[o], u = r.vertices[(o + 1) % 3]; if (h.isBorder || u.isBorder) continue; var d = e.Vector3.Zero(), f = e.Vector3.Zero(), p = e.Vector2.Zero(), _ = new e.Color4(0, 0, 0, 1); n.calculateError(h, u, d, f, p, _); var m = new Array; if (n.isFlipped(h, u, d, a, r.borderFactor, m)) continue; if (n.isFlipped(u, h, d, c, r.borderFactor, m)) continue; if (a.indexOf(!0) < 0 || c.indexOf(!0) < 0) continue; var g = new Array; if (m.forEach(function (e) { -1 === g.indexOf(e) && (e.deletePending = !0, g.push(e)) }), g.length % 2 != 0) continue; h.q = u.q.add(h.q), h.updatePosition(d); var v = n.references.length; s = n.updateTriangles(h, h, a, s), s = n.updateTriangles(h, u, c, s); var y = n.references.length - v; if (y <= h.triangleCount) { if (y) for (var b = 0; b < y; b++)n.references[h.triangleStart + b] = n.references[v + b] } else h.triangleStart = v; h.triangleCount = y; break } }, r, function () { return a - s <= o }) }, 0)) }, function () { setTimeout(function () { n.reconstructMesh(i), r() }, 0) }) }, t.prototype.initWithMesh = function (t, i, r) { var s = this; this.vertices = [], this.triangles = []; var a = this._mesh.getVerticesData(e.VertexBuffer.PositionKind), l = this._mesh.getIndices(), c = this._mesh.subMeshes[t], h = [], u = c.verticesCount; e.AsyncLoop.SyncAsyncForLoop(u, this.syncIterations / 4 >> 0, function (t) { if (a) { var i = t + c.verticesStart, n = e.Vector3.FromArray(a, 3 * i), l = function (e) { if (r) for (var t = 0; t < s.vertices.length; ++t)if (s.vertices[t].position.equals(e)) return s.vertices[t]; return null }(n) || new o(n, s.vertices.length); l.originalOffsets.push(i), l.id === s.vertices.length && s.vertices.push(l), h.push(l.id) } }, function () { e.AsyncLoop.SyncAsyncForLoop(c.indexCount / 3, s.syncIterations, function (e) { if (l) { var t = 3 * (c.indexStart / 3 + e), i = l[t + 0], r = l[t + 1], o = l[t + 2], a = s.vertices[h[i - c.verticesStart]], u = s.vertices[h[r - c.verticesStart]], d = s.vertices[h[o - c.verticesStart]], f = new n([a, u, d]); f.originalOffset = t, s.triangles.push(f) } }, function () { s.init(i) }) }) }, t.prototype.init = function (t) { var i = this; e.AsyncLoop.SyncAsyncForLoop(this.triangles.length, this.syncIterations, function (t) { var r = i.triangles[t]; r.normal = e.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position), r.vertices[2].position.subtract(r.vertices[0].position)).normalize(); for (var n = 0; n < 3; n++)r.vertices[n].q.addArrayInPlace(s.DataFromNumbers(r.normal.x, r.normal.y, r.normal.z, -e.Vector3.Dot(r.normal, r.vertices[0].position))) }, function () { e.AsyncLoop.SyncAsyncForLoop(i.triangles.length, i.syncIterations, function (e) { for (var t = i.triangles[e], r = 0; r < 3; ++r)t.error[r] = i.calculateError(t.vertices[r], t.vertices[(r + 1) % 3]); t.error[3] = Math.min(t.error[0], t.error[1], t.error[2]) }, function () { t() }) }) }, t.prototype.reconstructMesh = function (t) { var i, r, n, o = []; for (i = 0; i < this.vertices.length; ++i)this.vertices[i].triangleCount = 0; for (i = 0; i < this.triangles.length; ++i)if (!this.triangles[i].deleted) { for (r = this.triangles[i], n = 0; n < 3; ++n)r.vertices[n].triangleCount = 1; o.push(r) } var s = this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind) || [], a = this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind) || [], l = this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind) || [], c = this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind) || [], h = this._mesh.getVerticesData(e.VertexBuffer.NormalKind), u = this._mesh.getVerticesData(e.VertexBuffer.UVKind), d = this._mesh.getVerticesData(e.VertexBuffer.ColorKind), f = 0; for (i = 0; i < this.vertices.length; ++i) { var p = this.vertices[i]; p.id = f, p.triangleCount && p.originalOffsets.forEach(function (e) { h && (s.push(p.position.x), s.push(p.position.y), s.push(p.position.z), a.push(h[3 * e]), a.push(h[3 * e + 1]), a.push(h[3 * e + 2]), u && u.length ? (l.push(u[2 * e]), l.push(u[2 * e + 1])) : d && d.length && (c.push(d[4 * e]), c.push(d[4 * e + 1]), c.push(d[4 * e + 2]), c.push(d[4 * e + 3])), ++f) }) } var _ = this._reconstructedMesh.getTotalIndices(), m = this._reconstructedMesh.getTotalVertices(), g = this._reconstructedMesh.subMeshes; this._reconstructedMesh.subMeshes = []; var v = this._reconstructedMesh.getIndices(), y = this._mesh.getIndices(); for (i = 0; i < o.length; ++i)r = o[i], [0, 1, 2].forEach(function (e) { var t = y[r.originalOffset + e], i = r.vertices[e].originalOffsets.indexOf(t); i < 0 && (i = 0), v.push(r.vertices[e].id + i + m) }); this._reconstructedMesh.setIndices(v), this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind, s), this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind, a), 0 < l.length && this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind, l), 0 < c.length && this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind, c); var b = this._mesh.subMeshes[t]; 0 < t && (this._reconstructedMesh.subMeshes = [], g.forEach(function (t) { e.SubMesh.AddToMesh(t.materialIndex, t.verticesStart, t.verticesCount, t.indexStart, t.indexCount, t.getMesh()) }), e.SubMesh.AddToMesh(b.materialIndex, m, f, _, 3 * o.length, this._reconstructedMesh)) }, t.prototype.initDecimatedMesh = function () { this._reconstructedMesh = new e.Mesh(this._mesh.name + "Decimated", this._mesh.getScene()), this._reconstructedMesh.material = this._mesh.material, this._reconstructedMesh.parent = this._mesh.parent, this._reconstructedMesh.isVisible = !1, this._reconstructedMesh.renderingGroupId = this._mesh.renderingGroupId }, t.prototype.isFlipped = function (t, i, r, n, o, s) { for (var a = 0; a < t.triangleCount; ++a) { var l = this.triangles[this.references[t.triangleStart + a].triangleId]; if (!l.deleted) { var c = this.references[t.triangleStart + a].vertexId, h = l.vertices[(c + 1) % 3], u = l.vertices[(c + 2) % 3]; if (h !== i && u !== i) { var d = h.position.subtract(r); d = d.normalize(); var f = u.position.subtract(r); if (f = f.normalize(), .999 < Math.abs(e.Vector3.Dot(d, f))) return !0; var p = e.Vector3.Cross(d, f).normalize(); if (n[a] = !1, e.Vector3.Dot(p, l.normal) < .2) return !0 } else n[a] = !0, s.push(l) } } return !1 }, t.prototype.updateTriangles = function (e, t, i, r) { for (var n = r, o = 0; o < t.triangleCount; ++o) { var s = this.references[t.triangleStart + o], a = this.triangles[s.triangleId]; a.deleted || (i[o] && a.deletePending ? (a.deleted = !0, n++) : (a.vertices[s.vertexId] = e, a.isDirty = !0, a.error[0] = this.calculateError(a.vertices[0], a.vertices[1]) + a.borderFactor / 2, a.error[1] = this.calculateError(a.vertices[1], a.vertices[2]) + a.borderFactor / 2, a.error[2] = this.calculateError(a.vertices[2], a.vertices[0]) + a.borderFactor / 2, a.error[3] = Math.min(a.error[0], a.error[1], a.error[2]), this.references.push(s))) } return n }, t.prototype.identifyBorder = function () { for (var e = 0; e < this.vertices.length; ++e) { var t, i = [], r = [], n = this.vertices[e]; for (t = 0; t < n.triangleCount; ++t)for (var o = this.triangles[this.references[n.triangleStart + t].triangleId], s = 0; s < 3; s++) { for (var a = 0, l = o.vertices[s]; a < i.length && r[a] !== l.id;)++a; a === i.length ? (i.push(1), r.push(l.id)) : i[a]++ } for (t = 0; t < i.length; ++t)1 === i[t] ? this.vertices[r[t]].isBorder = !0 : this.vertices[r[t]].isBorder = !1 } }, t.prototype.updateMesh = function (e) { var t, i, r, n; if (void 0 === e && (e = !1), !e) { var o = []; for (t = 0; t < this.triangles.length; ++t)this.triangles[t].deleted || o.push(this.triangles[t]); this.triangles = o } for (t = 0; t < this.vertices.length; ++t)this.vertices[t].triangleCount = 0, this.vertices[t].triangleStart = 0; for (t = 0; t < this.triangles.length; ++t)for (i = this.triangles[t], r = 0; r < 3; ++r)(n = i.vertices[r]).triangleCount++; var s = 0; for (t = 0; t < this.vertices.length; ++t)this.vertices[t].triangleStart = s, s += this.vertices[t].triangleCount, this.vertices[t].triangleCount = 0; var l = new Array(3 * this.triangles.length); for (t = 0; t < this.triangles.length; ++t)for (i = this.triangles[t], r = 0; r < 3; ++r)l[(n = i.vertices[r]).triangleStart + n.triangleCount] = new a(r, t), n.triangleCount++; this.references = l, e && this.identifyBorder() }, t.prototype.vertexError = function (e, t) { var i = t.x, r = t.y, n = t.z; return e.data[0] * i * i + 2 * e.data[1] * i * r + 2 * e.data[2] * i * n + 2 * e.data[3] * i + e.data[4] * r * r + 2 * e.data[5] * r * n + 2 * e.data[6] * r + e.data[7] * n * n + 2 * e.data[8] * n + e.data[9] }, t.prototype.calculateError = function (t, i, r, n, o, s) { var a = t.q.add(i.q), l = t.isBorder && i.isBorder, c = 0, h = a.det(0, 1, 2, 1, 4, 5, 2, 5, 7); if (0 === h || l) { var u = t.position.add(i.position).divide(new e.Vector3(2, 2, 2)), d = this.vertexError(a, t.position), f = this.vertexError(a, i.position), p = this.vertexError(a, u); (c = Math.min(d, f, p)) === d ? r && r.copyFrom(t.position) : c === f ? r && r.copyFrom(i.position) : r && r.copyFrom(u) } else r || (r = e.Vector3.Zero()), r.x = -1 / h * a.det(1, 2, 3, 4, 5, 6, 5, 7, 8), r.y = 1 / h * a.det(0, 2, 3, 1, 5, 6, 2, 7, 8), r.z = -1 / h * a.det(0, 1, 3, 1, 4, 6, 2, 5, 8), c = this.vertexError(a, r); return c }, t }() }($a || ($a = {})), function (e) { Object.defineProperty(e.Scene.prototype, "simplificationQueue", { get: function () { if (!this._simplificationQueue) { this._simplificationQueue = new e.SimplificationQueue; var i = this._getComponent(e.SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE); i || (i = new t(this), this._addComponent(i)) } return this._simplificationQueue }, set: function (e) { this._simplificationQueue = e }, enumerable: !0, configurable: !0 }), e.Mesh.prototype.simplify = function (t, i, r, n) { return void 0 === i && (i = !0), void 0 === r && (r = e.SimplificationType.QUADRATIC), this.getScene().simplificationQueue.addTask({ settings: t, parallelProcessing: i, mesh: this, simplificationType: r, successCallback: n }), this }; var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE, this.scene = t } return t.prototype.register = function () { this.scene._beforeCameraUpdateStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE, this, this._beforeCameraUpdate) }, t.prototype.rebuild = function () { }, t.prototype.dispose = function () { }, t.prototype._beforeCameraUpdate = function () { this.scene._simplificationQueue && !this.scene._simplificationQueue.running && this.scene._simplificationQueue.executeNext() }, t }(); e.SimplicationQueueSceneComponent = t }($a || ($a = {})), na = function (e, t) { this.distance = e, this.mesh = t }, ($a || ($a = {})).MeshLODLevel = na, function (e) { var t = function () { function e(e) { void 0 === e && (e = 0), this.priority = e } return e.prototype.getDescription = function () { return "" }, e.prototype.apply = function (e, t) { return !0 }, e }(), i = function (e) { function t(t, i, r) { void 0 === t && (t = 0), void 0 === i && (i = 1024), void 0 === r && (r = .5); var n = e.call(this, t) || this; return n.priority = t, n.maximumSize = i, n.step = r, n } return T(t, e), t.prototype.getDescription = function () { return "Reducing render target texture size to " + this.maximumSize }, t.prototype.apply = function (e, t) { for (var i = !0, r = 0; r < e.textures.length; r++) { var n = e.textures[r]; if (n.canRescale && !n.getContext) { var o = n.getSize(); Math.max(o.width, o.height) > this.maximumSize && (n.scale(this.step), i = !1) } } return i }, t }(e.SceneOptimization = t); e.TextureOptimization = i; var r = function (e) { function t(t, i, r) { void 0 === t && (t = 0), void 0 === i && (i = 2), void 0 === r && (r = .25); var n = e.call(this, t) || this; return n.priority = t, n.maximumScale = i, n.step = r, n._currentScale = -1, n._directionOffset = 1, n } return T(t, e), t.prototype.getDescription = function () { return "Setting hardware scaling level to " + this._currentScale }, t.prototype.apply = function (e, t) { return -1 === this._currentScale && (this._currentScale = e.getEngine().getHardwareScalingLevel(), this._currentScale > this.maximumScale && (this._directionOffset = -1)), this._currentScale += this._directionOffset * this.step, e.getEngine().setHardwareScalingLevel(this._currentScale), 1 === this._directionOffset ? this._currentScale >= this.maximumScale : this._currentScale <= this.maximumScale }, t }(t); e.HardwareScalingOptimization = r; var n = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.getDescription = function () { return "Turning shadows on/off" }, t.prototype.apply = function (e, t) { return e.shadowsEnabled = t.isInImprovementMode, !0 }, t }(t); e.ShadowsOptimization = n; var o = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.getDescription = function () { return "Turning post-processes on/off" }, t.prototype.apply = function (e, t) { return e.postProcessesEnabled = t.isInImprovementMode, !0 }, t }(t); e.PostProcessesOptimization = o; var s = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.getDescription = function () { return "Turning lens flares on/off" }, t.prototype.apply = function (e, t) { return e.lensFlaresEnabled = t.isInImprovementMode, !0 }, t }(t); e.LensFlaresOptimization = s; var a = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.getDescription = function () { return this.onGetDescription ? this.onGetDescription() : "Running user defined callback" }, t.prototype.apply = function (e, t) { return !this.onApply || this.onApply(e, t) }, t }(t); e.CustomOptimization = a; var l = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.getDescription = function () { return "Turning particles on/off" }, t.prototype.apply = function (e, t) { return e.particlesEnabled = t.isInImprovementMode, !0 }, t }(t); e.ParticlesOptimization = l; var c = function (e) { function t() { return null !== e && e.apply(this, arguments) || this } return T(t, e), t.prototype.getDescription = function () { return "Turning render targets off" }, t.prototype.apply = function (e, t) { return e.renderTargetsEnabled = t.isInImprovementMode, !0 }, t }(t); e.RenderTargetsOptimization = c; var h = function (t) { function i() { var i = null !== t && t.apply(this, arguments) || this; return i._canBeMerged = function (t) { if (!(t instanceof e.Mesh)) return !1; var i = t; return !(i.isDisposed() || !i.isVisible || !i.isEnabled() || 0 < i.instances.length || i.skeleton || i.hasLODLevels) }, i } return T(i, t), Object.defineProperty(i, "UpdateSelectionTree", { get: function () { return i._UpdateSelectionTree }, set: function (e) { i._UpdateSelectionTree = e }, enumerable: !0, configurable: !0 }), i.prototype.getDescription = function () { return "Merging similar meshes together" }, i.prototype.apply = function (t, r, n) { for (var o = t.meshes.slice(0), s = o.length, a = 0; a < s; a++) { var l = new Array, c = o[a]; if (this._canBeMerged(c)) { l.push(c); for (var h = a + 1; h < s; h++) { var u = o[h]; this._canBeMerged(u) && u.material === c.material && u.checkCollisions === c.checkCollisions && (l.push(u), s-- , o.splice(h, 1), h--) } l.length < 2 || e.Mesh.MergeMeshes(l, void 0, !0) } } var d = t; return d.createOrUpdateSelectionOctree && (null != n ? n && d.createOrUpdateSelectionOctree() : i.UpdateSelectionTree && d.createOrUpdateSelectionOctree()), !0 }, i._UpdateSelectionTree = !1, i }(t); e.MergeMeshesOptimization = h; var u = function () { function e(e, t) { void 0 === e && (e = 60), void 0 === t && (t = 2e3), this.targetFrameRate = e, this.trackerDuration = t, this.optimizations = new Array } return e.prototype.addOptimization = function (e) { return this.optimizations.push(e), this }, e.prototype.addCustomOptimization = function (e, t, i) { void 0 === i && (i = 0); var r = new a(i); return r.onApply = e, r.onGetDescription = t, this.optimizations.push(r), this }, e.LowDegradationAllowed = function (t) { var r = new e(t), a = 0; return r.addOptimization(new h(a)), r.addOptimization(new n(a)), r.addOptimization(new s(a)), a++ , r.addOptimization(new o(a)), r.addOptimization(new l(a)), a++ , r.addOptimization(new i(a, 1024)), r }, e.ModerateDegradationAllowed = function (t) { var a = new e(t), u = 0; return a.addOptimization(new h(u)), a.addOptimization(new n(u)), a.addOptimization(new s(u)), u++ , a.addOptimization(new o(u)), a.addOptimization(new l(u)), u++ , a.addOptimization(new i(u, 512)), u++ , a.addOptimization(new c(u)), u++ , a.addOptimization(new r(u, 2)), a }, e.HighDegradationAllowed = function (t) { var a = new e(t), u = 0; return a.addOptimization(new h(u)), a.addOptimization(new n(u)), a.addOptimization(new s(u)), u++ , a.addOptimization(new o(u)), a.addOptimization(new l(u)), u++ , a.addOptimization(new i(u, 256)), u++ , a.addOptimization(new c(u)), u++ , a.addOptimization(new r(u, 4)), a }, e }(); e.SceneOptimizerOptions = u; var d = function () { function t(t, i, r, n) { void 0 === r && (r = !0), void 0 === n && (n = !1); var o = this; if (this._isRunning = !1, this._currentPriorityLevel = 0, this._targetFrameRate = 60, this._trackerDuration = 2e3, this._currentFrameRate = 0, this._improvementMode = !1, this.onSuccessObservable = new e.Observable, this.onNewOptimizationAppliedObservable = new e.Observable, this.onFailureObservable = new e.Observable, this._options = i || new u, this._options.targetFrameRate && (this._targetFrameRate = this._options.targetFrameRate), this._options.trackerDuration && (this._trackerDuration = this._options.trackerDuration), r) for (var s = 0, a = 0, l = this._options.optimizations; a < l.length; a++)l[a].priority = s++; this._improvementMode = n, this._scene = t || e.Engine.LastCreatedScene, this._sceneDisposeObserver = this._scene.onDisposeObservable.add(function () { o._sceneDisposeObserver = null, o.dispose() }) } return Object.defineProperty(t.prototype, "isInImprovementMode", { get: function () { return this._improvementMode }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "currentPriorityLevel", { get: function () { return this._currentPriorityLevel }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "currentFrameRate", { get: function () { return this._currentFrameRate }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "targetFrameRate", { get: function () { return this._targetFrameRate }, set: function (e) { this._targetFrameRate = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "trackerDuration", { get: function () { return this._trackerDuration }, set: function (e) { this._trackerDuration = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "optimizations", { get: function () { return this._options.optimizations }, enumerable: !0, configurable: !0 }), t.prototype.stop = function () { this._isRunning = !1 }, t.prototype.reset = function () { this._currentPriorityLevel = 0 }, t.prototype.start = function () { var e = this; this._isRunning || (this._isRunning = !0, this._scene.executeWhenReady(function () { setTimeout(function () { e._checkCurrentState() }, e._trackerDuration) })) }, t.prototype._checkCurrentState = function () { var e = this; if (this._isRunning) { var t = this._scene, i = this._options; if (this._currentFrameRate = Math.round(t.getEngine().getFps()), this._improvementMode && this._currentFrameRate <= this._targetFrameRate || !this._improvementMode && this._currentFrameRate >= this._targetFrameRate) return this._isRunning = !1, void this.onSuccessObservable.notifyObservers(this); for (var r = !0, n = !0, o = 0; o < i.optimizations.length; o++) { var s = i.optimizations[o]; s.priority === this._currentPriorityLevel && (n = !1, r = r && s.apply(t, this), this.onNewOptimizationAppliedObservable.notifyObservers(s)) } if (n) return this._isRunning = !1, void this.onFailureObservable.notifyObservers(this); r && this._currentPriorityLevel++ , t.executeWhenReady(function () { setTimeout(function () { e._checkCurrentState() }, e._trackerDuration) }) } }, t.prototype.dispose = function () { this.stop(), this.onSuccessObservable.clear(), this.onFailureObservable.clear(), this.onNewOptimizationAppliedObservable.clear(), this._sceneDisposeObserver && this._scene.onDisposeObservable.remove(this._sceneDisposeObserver) }, t.OptimizeAsync = function (e, i, r, n) { var o = new t(e, i || u.ModerateDegradationAllowed(), !1); return r && o.onSuccessObservable.add(function () { r() }), n && o.onFailureObservable.add(function () { n() }), o.start(), o }, t }(); e.SceneOptimizer = d }($a || ($a = {})), function (e) { e.Scene.prototype.getOutlineRenderer = function () { return this._outlineRenderer || (this._outlineRenderer = new t(this)), this._outlineRenderer }, Object.defineProperty(e.AbstractMesh.prototype, "renderOutline", { get: function () { return this._renderOutline }, set: function (e) { e && this.getScene().getOutlineRenderer(), this._renderOutline = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.AbstractMesh.prototype, "renderOverlay", { get: function () { return this._renderOverlay }, set: function (e) { e && this.getScene().getOutlineRenderer(), this._renderOverlay = e }, enumerable: !0, configurable: !0 }); var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_OUTLINERENDERER, this.zOffset = 1, this.scene = t, this._engine = t.getEngine(), this.scene._addComponent(this) } return t.prototype.register = function () { this.scene._beforeRenderingMeshStage.registerStep(e.SceneComponentConstants.STEP_BEFORERENDERINGMESH_OUTLINE, this, this._beforeRenderingMesh), this.scene._afterRenderingMeshStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDERINGMESH_OUTLINE, this, this._afterRenderingMesh) }, t.prototype.rebuild = function () { }, t.prototype.dispose = function () { }, t.prototype.render = function (t, i, r) { var n = this; void 0 === r && (r = !1); var o = this.scene, s = o.getEngine(), a = s.getCaps().instancedArrays && null !== i.visibleInstances[t._id] && void 0 !== i.visibleInstances[t._id]; if (this.isReady(t, a)) { var l = t.getRenderingMesh(), c = t.getMaterial(); if (c && o.activeCamera) { if (s.enableEffect(this._effect), c.useLogarithmicDepth && this._effect.setFloat("logarithmicDepthConstant", 2 / (Math.log(o.activeCamera.maxZ + 1) / Math.LN2)), this._effect.setFloat("offset", r ? 0 : l.outlineWidth), this._effect.setColor4("color", r ? l.overlayColor : l.outlineColor, r ? l.overlayAlpha : c.alpha), this._effect.setMatrix("viewProjection", o.getTransformMatrix()), l.useBones && l.computeBonesUsingShaders && l.skeleton && this._effect.setMatrices("mBones", l.skeleton.getTransformMatrices(l)), l._bind(t, this._effect, e.Material.TriangleFillMode), c && c.needAlphaTesting()) { var h = c.getAlphaTestTexture(); h && (this._effect.setTexture("diffuseSampler", h), this._effect.setMatrix("diffuseMatrix", h.getTextureMatrix())) } s.setZOffset(-this.zOffset), l._processRendering(t, this._effect, e.Material.TriangleFillMode, i, a, function (e, t) { n._effect.setMatrix("world", t) }), s.setZOffset(0) } } }, t.prototype.isReady = function (t, i) { var r = [], n = [e.VertexBuffer.PositionKind, e.VertexBuffer.NormalKind], o = t.getMesh(), s = t.getMaterial(); s && (s.needAlphaTesting() && (r.push("#define ALPHATEST"), o.isVerticesDataPresent(e.VertexBuffer.UVKind) && (n.push(e.VertexBuffer.UVKind), r.push("#define UV1")), o.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && (n.push(e.VertexBuffer.UV2Kind), r.push("#define UV2"))), s.useLogarithmicDepth && r.push("#define LOGARITHMICDEPTH")), o.useBones && o.computeBonesUsingShaders ? (n.push(e.VertexBuffer.MatricesIndicesKind), n.push(e.VertexBuffer.MatricesWeightsKind), 4 < o.numBoneInfluencers && (n.push(e.VertexBuffer.MatricesIndicesExtraKind), n.push(e.VertexBuffer.MatricesWeightsExtraKind)), r.push("#define NUM_BONE_INFLUENCERS " + o.numBoneInfluencers), r.push("#define BonesPerMesh " + (o.skeleton ? o.skeleton.bones.length + 1 : 0))) : r.push("#define NUM_BONE_INFLUENCERS 0"), i && (r.push("#define INSTANCES"), n.push("world0"), n.push("world1"), n.push("world2"), n.push("world3")); var a = r.join("\n"); return this._cachedDefines !== a && (this._cachedDefines = a, this._effect = this.scene.getEngine().createEffect("outline", n, ["world", "mBones", "viewProjection", "diffuseMatrix", "offset", "color", "logarithmicDepthConstant"], ["diffuseSampler"], a)), this._effect.isReady() }, t.prototype._beforeRenderingMesh = function (e, t, i) { this._savedDepthWrite = this._engine.getDepthWrite(), e.renderOutline && (this._engine.setDepthWrite(!1), this.render(t, i), this._engine.setDepthWrite(this._savedDepthWrite)) }, t.prototype._afterRenderingMesh = function (t, i, r) { if (t.renderOutline && this._savedDepthWrite && (this._engine.setDepthWrite(!0), this._engine.setColorWrite(!1), this.render(i, r), this._engine.setColorWrite(!0)), t.renderOverlay) { var n = this._engine.getAlphaMode(); this._engine.setAlphaMode(e.Engine.ALPHA_COMBINE), this.render(i, r, !0), this._engine.setAlphaMode(n) } }, t }(); e.OutlineRenderer = t }($a || ($a = {})), function (e) { e.AbstractMesh.prototype.disableEdgesRendering = function () { return this._edgesRenderer && (this._edgesRenderer.dispose(), this._edgesRenderer = null), this }, e.AbstractMesh.prototype.enableEdgesRendering = function (e, t) { return void 0 === e && (e = .95), void 0 === t && (t = !1), this.disableEdgesRendering(), this._edgesRenderer = new i(this, e, t), this }, Object.defineProperty(e.AbstractMesh.prototype, "edgesRenderer", { get: function () { return this._edgesRenderer }, enumerable: !0, configurable: !0 }), e.LinesMesh.prototype.enableEdgesRendering = function (t, i) { return void 0 === t && (t = .95), void 0 === i && (i = !1), this.disableEdgesRendering(), this._edgesRenderer = new e.LineEdgesRenderer(this, t, i), this }; var t = function () { this.edges = new Array, this.edgesConnectedCount = 0 }, i = function () { function i(e, t, i, r) { void 0 === t && (t = .95), void 0 === i && (i = !1), void 0 === r && (r = !0); var n = this; this.edgesWidthScalerForOrthographic = 1e3, this.edgesWidthScalerForPerspective = 50, this._linesPositions = new Array, this._linesNormals = new Array, this._linesIndices = new Array, this._buffers = {}, this._checkVerticesInsteadOfIndices = !1, this.isEnabled = !0, this._source = e, this._checkVerticesInsteadOfIndices = i, this._epsilon = t, this._prepareRessources(), r && this._generateEdgesLines(), this._meshRebuildObserver = this._source.onRebuildObservable.add(function () { n._rebuild() }), this._meshDisposeObserver = this._source.onDisposeObservable.add(function () { n.dispose() }) } return i.prototype._prepareRessources = function () { this._lineShader || (this._lineShader = new e.ShaderMaterial("lineShader", this._source.getScene(), "line", { attributes: ["position", "normal"], uniforms: ["worldViewProjection", "color", "width", "aspectRatio"] }), this._lineShader.disableDepthWrite = !0, this._lineShader.backFaceCulling = !1) }, i.prototype._rebuild = function () { var t = this._buffers[e.VertexBuffer.PositionKind]; t && t._rebuild(), (t = this._buffers[e.VertexBuffer.NormalKind]) && t._rebuild(); var i = this._source.getScene().getEngine(); this._ib = i.createIndexBuffer(this._linesIndices) }, i.prototype.dispose = function () { this._source.onRebuildObservable.remove(this._meshRebuildObserver), this._source.onDisposeObservable.remove(this._meshDisposeObserver); var t = this._buffers[e.VertexBuffer.PositionKind]; t && (t.dispose(), this._buffers[e.VertexBuffer.PositionKind] = null), (t = this._buffers[e.VertexBuffer.NormalKind]) && (t.dispose(), this._buffers[e.VertexBuffer.NormalKind] = null), this._source.getScene().getEngine()._releaseBuffer(this._ib), this._lineShader.dispose() }, i.prototype._processEdgeForAdjacencies = function (e, t, i, r, n) { return e === i && t === r || e === r && t === i ? 0 : e === r && t === n || e === n && t === r ? 1 : e === n && t === i || e === i && t === n ? 2 : -1 }, i.prototype._processEdgeForAdjacenciesWithVertices = function (e, t, i, r, n) { return e.equalsWithEpsilon(i) && t.equalsWithEpsilon(r) || e.equalsWithEpsilon(r) && t.equalsWithEpsilon(i) ? 0 : e.equalsWithEpsilon(r) && t.equalsWithEpsilon(n) || e.equalsWithEpsilon(n) && t.equalsWithEpsilon(r) ? 1 : e.equalsWithEpsilon(n) && t.equalsWithEpsilon(i) || e.equalsWithEpsilon(i) && t.equalsWithEpsilon(n) ? 2 : -1 }, i.prototype._checkEdge = function (t, i, r, n, o) { if (void 0 === i || e.Vector3.Dot(r[t], r[i]) < this._epsilon) { var s = this._linesPositions.length / 3; n.subtract(o).normalize(), this._linesPositions.push(n.x), this._linesPositions.push(n.y), this._linesPositions.push(n.z), this._linesPositions.push(n.x), this._linesPositions.push(n.y), this._linesPositions.push(n.z), this._linesPositions.push(o.x), this._linesPositions.push(o.y), this._linesPositions.push(o.z), this._linesPositions.push(o.x), this._linesPositions.push(o.y), this._linesPositions.push(o.z), this._linesNormals.push(o.x), this._linesNormals.push(o.y), this._linesNormals.push(o.z), this._linesNormals.push(-1), this._linesNormals.push(o.x), this._linesNormals.push(o.y), this._linesNormals.push(o.z), this._linesNormals.push(1), this._linesNormals.push(n.x), this._linesNormals.push(n.y), this._linesNormals.push(n.z), this._linesNormals.push(-1), this._linesNormals.push(n.x), this._linesNormals.push(n.y), this._linesNormals.push(n.z), this._linesNormals.push(1), this._linesIndices.push(s), this._linesIndices.push(s + 1), this._linesIndices.push(s + 2), this._linesIndices.push(s), this._linesIndices.push(s + 2), this._linesIndices.push(s + 3) } }, i.prototype._generateEdgesLines = function () { var i = this._source.getVerticesData(e.VertexBuffer.PositionKind), r = this._source.getIndices(); if (r && i) { var n, o, s = new Array, a = new Array; for (n = 0; n < r.length; n += 3) { o = new t; var l = r[n], c = r[n + 1], h = r[n + 2]; o.p0 = new e.Vector3(i[3 * l], i[3 * l + 1], i[3 * l + 2]), o.p1 = new e.Vector3(i[3 * c], i[3 * c + 1], i[3 * c + 2]), o.p2 = new e.Vector3(i[3 * h], i[3 * h + 1], i[3 * h + 2]); var u = e.Vector3.Cross(o.p1.subtract(o.p0), o.p2.subtract(o.p1)); u.normalize(), a.push(u), s.push(o) } for (n = 0; n < s.length; n++) { o = s[n]; for (var d = n + 1; d < s.length; d++) { var f = s[d]; if (3 === o.edgesConnectedCount) break; if (3 !== f.edgesConnectedCount) for (var p = r[3 * d], _ = r[3 * d + 1], m = r[3 * d + 2], g = 0; g < 3; g++) { var v = 0; if (void 0 === o.edges[g]) { switch (g) { case 0: v = this._checkVerticesInsteadOfIndices ? this._processEdgeForAdjacenciesWithVertices(o.p0, o.p1, f.p0, f.p1, f.p2) : this._processEdgeForAdjacencies(r[3 * n], r[3 * n + 1], p, _, m); break; case 1: v = this._checkVerticesInsteadOfIndices ? this._processEdgeForAdjacenciesWithVertices(o.p1, o.p2, f.p0, f.p1, f.p2) : this._processEdgeForAdjacencies(r[3 * n + 1], r[3 * n + 2], p, _, m); break; case 2: v = this._checkVerticesInsteadOfIndices ? this._processEdgeForAdjacenciesWithVertices(o.p2, o.p0, f.p0, f.p1, f.p2) : this._processEdgeForAdjacencies(r[3 * n + 2], r[3 * n], p, _, m) }if (-1 !== v && (o.edges[g] = d, f.edges[v] = n, o.edgesConnectedCount++ , f.edgesConnectedCount++ , 3 === o.edgesConnectedCount)) break } } } } for (n = 0; n < s.length; n++) { var y = s[n]; this._checkEdge(n, y.edges[0], a, y.p0, y.p1), this._checkEdge(n, y.edges[1], a, y.p1, y.p2), this._checkEdge(n, y.edges[2], a, y.p2, y.p0) } var b = this._source.getScene().getEngine(); this._buffers[e.VertexBuffer.PositionKind] = new e.VertexBuffer(b, this._linesPositions, e.VertexBuffer.PositionKind, !1), this._buffers[e.VertexBuffer.NormalKind] = new e.VertexBuffer(b, this._linesNormals, e.VertexBuffer.NormalKind, !1, !1, 4), this._ib = b.createIndexBuffer(this._linesIndices), this._indicesCount = this._linesIndices.length } }, i.prototype.isReady = function () { return this._lineShader.isReady() }, i.prototype.render = function () { var t = this._source.getScene(); if (this.isReady() && t.activeCamera) { var i = t.getEngine(); this._lineShader._preBind(), 1 !== this._source.edgesColor.a ? i.setAlphaMode(e.Engine.ALPHA_COMBINE) : i.setAlphaMode(e.Engine.ALPHA_DISABLE), i.bindBuffers(this._buffers, this._ib, this._lineShader.getEffect()), t.resetCachedMaterial(), this._lineShader.setColor4("color", this._source.edgesColor), t.activeCamera.mode === e.Camera.ORTHOGRAPHIC_CAMERA ? this._lineShader.setFloat("width", this._source.edgesWidth / this.edgesWidthScalerForOrthographic) : this._lineShader.setFloat("width", this._source.edgesWidth / this.edgesWidthScalerForPerspective), this._lineShader.setFloat("aspectRatio", i.getAspectRatio(t.activeCamera)), this._lineShader.bind(this._source.getWorldMatrix()), i.drawElementsType(e.Material.TriangleFillMode, 0, this._indicesCount), this._lineShader.unbind() } }, i }(); e.EdgesRenderer = i }($a || ($a = {})), oa = $a || ($a = {}), sa = function () { this.edges = new Array, this.edgesConnectedCount = 0 }, aa = function (e) { function t(t, i, r) { void 0 === i && (i = .95), void 0 === r && (r = !1); var n = e.call(this, t, i, r, !1) || this; return n._generateEdgesLines(), n } return T(t, e), t.prototype._checkEdge = function (e, t, i, r, n) { var o = this._linesPositions.length / 3; r.subtract(n).normalize(), this._linesPositions.push(r.x), this._linesPositions.push(r.y), this._linesPositions.push(r.z), this._linesPositions.push(r.x), this._linesPositions.push(r.y), this._linesPositions.push(r.z), this._linesPositions.push(n.x), this._linesPositions.push(n.y), this._linesPositions.push(n.z), this._linesPositions.push(n.x), this._linesPositions.push(n.y), this._linesPositions.push(n.z), this._linesNormals.push(n.x), this._linesNormals.push(n.y), this._linesNormals.push(n.z), this._linesNormals.push(-1), this._linesNormals.push(n.x), this._linesNormals.push(n.y), this._linesNormals.push(n.z), this._linesNormals.push(1), this._linesNormals.push(r.x), this._linesNormals.push(r.y), this._linesNormals.push(r.z), this._linesNormals.push(-1), this._linesNormals.push(r.x), this._linesNormals.push(r.y), this._linesNormals.push(r.z), this._linesNormals.push(1), this._linesIndices.push(o), this._linesIndices.push(o + 1), this._linesIndices.push(o + 2), this._linesIndices.push(o), this._linesIndices.push(o + 2), this._linesIndices.push(o + 3) }, t.prototype._generateEdgesLines = function () { var e = this._source.getVerticesData(oa.VertexBuffer.PositionKind); if (this._source.getIndices() && e) { for (var t, i = new Array, r = new Array, n = 0; n < e.length / 3 - 1; n++) { var o = new sa; o.p0 = new oa.Vector3(e[3 * n], e[3 * n + 1], e[3 * n + 2]), o.p1 = new oa.Vector3(e[3 * (n + 1)], e[3 * (n + 1) + 1], e[3 * (n + 1) + 2]), i.push(o) } for (t = 0; t < i.length; t++) { var s = i[t]; this._checkEdge(t, s.edges[0], r, s.p0, s.p1) } var a = this._source.getScene().getEngine(); this._buffers[oa.VertexBuffer.PositionKind] = new oa.VertexBuffer(a, this._linesPositions, oa.VertexBuffer.PositionKind, !1), this._buffers[oa.VertexBuffer.NormalKind] = new oa.VertexBuffer(a, this._linesNormals, oa.VertexBuffer.NormalKind, !1, !1, 4), this._ib = a.createIndexBuffer(this._linesIndices), this._indicesCount = this._linesIndices.length } }, t }(oa.EdgesRenderer), oa.LineEdgesRenderer = aa, function (e) { e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_EFFECTLAYER, function (t, i, r, n) { if (t.effectLayers) { r.effectLayers || (r.effectLayers = new Array); for (var o = 0; o < t.effectLayers.length; o++) { var s = e.EffectLayer.Parse(t.effectLayers[o], i, n); r.effectLayers.push(s) } } }), e.AbstractScene.prototype.removeEffectLayer = function (e) { var t = this.effectLayers.indexOf(e); return -1 !== t && this.effectLayers.splice(t, 1), t }, e.AbstractScene.prototype.addEffectLayer = function (e) { this.effectLayers.push(e) }; var t = function () { function t(t) { this.name = e.SceneComponentConstants.NAME_EFFECTLAYER, this._renderEffects = !1, this._needStencil = !1, this._previousStencilState = !1, this.scene = t, this._engine = t.getEngine(), t.effectLayers = new Array } return t.prototype.register = function () { this.scene._isReadyForMeshStage.registerStep(e.SceneComponentConstants.STEP_ISREADYFORMESH_EFFECTLAYER, this, this._isReadyForMesh), this.scene._cameraDrawRenderTargetStage.registerStep(e.SceneComponentConstants.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER, this, this._renderMainTexture), this.scene._beforeCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERADRAW_EFFECTLAYER, this, this._setStencil), this.scene._afterRenderingGroupDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW, this, this._drawRenderingGroup), this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER, this, this._setStencilBack), this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW, this, this._drawCamera) }, t.prototype.rebuild = function () { for (var e = 0, t = this.scene.effectLayers; e < t.length; e++)t[e]._rebuild() }, t.prototype.serialize = function (e) { e.effectLayers = []; for (var t = 0, i = this.scene.effectLayers; t < i.length; t++) { var r = i[t]; r.serialize && e.effectLayers.push(r.serialize()) } }, t.prototype.addFromContainer = function (e) { var t = this; e.effectLayers && e.effectLayers.forEach(function (e) { t.scene.addEffectLayer(e) }) }, t.prototype.removeFromContainer = function (e) { var t = this; e.effectLayers && e.effectLayers.forEach(function (e) { t.scene.removeEffectLayer(e) }) }, t.prototype.dispose = function () { for (var e = this.scene.effectLayers; e.length;)e[0].dispose() }, t.prototype._isReadyForMesh = function (e, t) { for (var i = 0, r = this.scene.effectLayers; i < r.length; i++) { var n = r[i]; if (n.hasMesh(e)) for (var o = 0, s = e.subMeshes; o < s.length; o++) { var a = s[o]; if (!n.isReady(a, t)) return !1 } } return !0 }, t.prototype._renderMainTexture = function (t) { this._renderEffects = !1, this._needStencil = !1; var i = this.scene.effectLayers; if (i && 0 < i.length) { this._previousStencilState = this._engine.getStencilBuffer(); for (var r = 0, n = i; r < n.length; r++) { var o = n[r]; if (o.shouldRender() && (!o.camera || o.camera.cameraRigMode === e.Camera.RIG_MODE_NONE && t === o.camera || o.camera.cameraRigMode !== e.Camera.RIG_MODE_NONE && -1 < o.camera._rigCameras.indexOf(t))) { this._renderEffects = !0, this._needStencil = this._needStencil || o.needStencil(); var s = o._mainTexture; s._shouldRender() && (this.scene.incrementRenderId(), s.render(!1, !1)) } } this.scene.incrementRenderId() } }, t.prototype._setStencil = function (e) { this._needStencil && this._engine.setStencilBuffer(!0) }, t.prototype._setStencilBack = function (e) { this._needStencil && this._engine.setStencilBuffer(this._previousStencilState) }, t.prototype._draw = function (e) { if (this._renderEffects) { this._engine.setDepthBuffer(!1); for (var t = this.scene.effectLayers, i = 0; i < t.length; i++) { var r = t[i]; r.renderingGroupId === e && r.shouldRender() && r.render() } this._engine.setDepthBuffer(!0) } }, t.prototype._drawCamera = function (e) { this._renderEffects && this._draw(-1) }, t.prototype._drawRenderingGroup = function (e) { !this.scene._isInIntermediateRendering() && this._renderEffects && this._draw(e) }, t }(); e.EffectLayerSceneComponent = t }($a || ($a = {})), tl = this && this.__assign || function () { return (tl = Object.assign || function (e) { for (var t, i = 1, r = arguments.length; i < r; i++)for (var n in t = arguments[i]) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]); return e }).apply(this, arguments) }, la = $a || ($a = {}), ca = function () { function e(e, t) { this._vertexBuffers = {}, this._maxSize = 0, this._mainTextureDesiredSize = { width: 0, height: 0 }, this._shouldRender = !0, this._postProcesses = [], this._textures = [], this._emissiveTextureAndColor = { texture: null, color: new la.Color4 }, this.neutralColor = new la.Color4, this.isEnabled = !0, this.onDisposeObservable = new la.Observable, this.onBeforeRenderMainTextureObservable = new la.Observable, this.onBeforeComposeObservable = new la.Observable, this.onAfterComposeObservable = new la.Observable, this.onSizeChangedObservable = new la.Observable, this.name = e, this._scene = t || la.Engine.LastCreatedScene; var i = this._scene._getComponent(la.SceneComponentConstants.NAME_EFFECTLAYER); i || (i = new la.EffectLayerSceneComponent(this._scene), this._scene._addComponent(i)), this._engine = this._scene.getEngine(), this._maxSize = this._engine.getCaps().maxTextureSize, this._scene.effectLayers.push(this), this._generateIndexBuffer(), this._genrateVertexBuffer() } return Object.defineProperty(e.prototype, "camera", { get: function () { return this._effectLayerOptions.camera }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "renderingGroupId", { get: function () { return this._effectLayerOptions.renderingGroupId }, enumerable: !0, configurable: !0 }), e.prototype._init = function (e) { this._effectLayerOptions = tl({ mainTextureRatio: .5, alphaBlendingMode: la.Engine.ALPHA_COMBINE, camera: null, renderingGroupId: -1 }, e), this._setMainTextureSize(), this._createMainTexture(), this._createTextureAndPostProcesses(), this._mergeEffect = this._createMergeEffect() }, e.prototype._generateIndexBuffer = function () { var e = []; e.push(0), e.push(1), e.push(2), e.push(0), e.push(2), e.push(3), this._indexBuffer = this._engine.createIndexBuffer(e) }, e.prototype._genrateVertexBuffer = function () { var e = []; e.push(1, 1), e.push(-1, 1), e.push(-1, -1), e.push(1, -1); var t = new la.VertexBuffer(this._engine, e, la.VertexBuffer.PositionKind, !1, !1, 2); this._vertexBuffers[la.VertexBuffer.PositionKind] = t }, e.prototype._setMainTextureSize = function () { this._effectLayerOptions.mainTextureFixedSize ? (this._mainTextureDesiredSize.width = this._effectLayerOptions.mainTextureFixedSize, this._mainTextureDesiredSize.height = this._effectLayerOptions.mainTextureFixedSize) : (this._mainTextureDesiredSize.width = this._engine.getRenderWidth() * this._effectLayerOptions.mainTextureRatio, this._mainTextureDesiredSize.height = this._engine.getRenderHeight() * this._effectLayerOptions.mainTextureRatio, this._mainTextureDesiredSize.width = this._engine.needPOTTextures ? la.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.width, this._maxSize) : this._mainTextureDesiredSize.width, this._mainTextureDesiredSize.height = this._engine.needPOTTextures ? la.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.height, this._maxSize) : this._mainTextureDesiredSize.height), this._mainTextureDesiredSize.width = Math.floor(this._mainTextureDesiredSize.width), this._mainTextureDesiredSize.height = Math.floor(this._mainTextureDesiredSize.height) }, e.prototype._createMainTexture = function () { var e = this; this._mainTexture = new la.RenderTargetTexture("HighlightLayerMainRTT", { width: this._mainTextureDesiredSize.width, height: this._mainTextureDesiredSize.height }, this._scene, !1, !0, la.Engine.TEXTURETYPE_UNSIGNED_INT), this._mainTexture.activeCamera = this._effectLayerOptions.camera, this._mainTexture.wrapU = la.Texture.CLAMP_ADDRESSMODE, this._mainTexture.wrapV = la.Texture.CLAMP_ADDRESSMODE, this._mainTexture.anisotropicFilteringLevel = 1, this._mainTexture.updateSamplingMode(la.Texture.BILINEAR_SAMPLINGMODE), this._mainTexture.renderParticles = !1, this._mainTexture.renderList = null, this._mainTexture.ignoreCameraViewport = !0, this._mainTexture.customRenderFunction = function (t, i, r, n) { var o; e.onBeforeRenderMainTextureObservable.notifyObservers(e); var s = e._scene.getEngine(); if (n.length) { for (s.setColorWrite(!1), o = 0; o < n.length; o++)e._renderSubMesh(n.data[o]); s.setColorWrite(!0) } for (o = 0; o < t.length; o++)e._renderSubMesh(t.data[o]); for (o = 0; o < i.length; o++)e._renderSubMesh(i.data[o]); for (o = 0; o < r.length; o++)e._renderSubMesh(r.data[o]) }, this._mainTexture.onClearObservable.add(function (t) { t.clear(e.neutralColor, !0, !0, !0) }) }, e.prototype._isReady = function (e, t, i) { var r = e.getMaterial(); if (!r) return !1; if (!r.isReady(e.getMesh(), t)) return !1; var n = [], o = [la.VertexBuffer.PositionKind], s = e.getMesh(), a = !1, l = !1; if (r && r.needAlphaTesting()) { var c = r.getAlphaTestTexture(); c && (n.push("#define ALPHATEST"), s.isVerticesDataPresent(la.VertexBuffer.UV2Kind) && 1 === c.coordinatesIndex ? (n.push("#define DIFFUSEUV2"), l = !0) : s.isVerticesDataPresent(la.VertexBuffer.UVKind) && (n.push("#define DIFFUSEUV1"), a = !0)) } i && (n.push("#define EMISSIVE"), s.isVerticesDataPresent(la.VertexBuffer.UV2Kind) && 1 === i.coordinatesIndex ? (n.push("#define EMISSIVEUV2"), l = !0) : s.isVerticesDataPresent(la.VertexBuffer.UVKind) && (n.push("#define EMISSIVEUV1"), a = !0)), a && (o.push(la.VertexBuffer.UVKind), n.push("#define UV1")), l && (o.push(la.VertexBuffer.UV2Kind), n.push("#define UV2")), s.useBones && s.computeBonesUsingShaders ? (o.push(la.VertexBuffer.MatricesIndicesKind), o.push(la.VertexBuffer.MatricesWeightsKind), 4 < s.numBoneInfluencers && (o.push(la.VertexBuffer.MatricesIndicesExtraKind), o.push(la.VertexBuffer.MatricesWeightsExtraKind)), n.push("#define NUM_BONE_INFLUENCERS " + s.numBoneInfluencers), n.push("#define BonesPerMesh " + (s.skeleton ? s.skeleton.bones.length + 1 : 0))) : n.push("#define NUM_BONE_INFLUENCERS 0"); var h = s.morphTargetManager, u = 0; h && 0 < h.numInfluencers && (n.push("#define MORPHTARGETS"), u = h.numInfluencers, n.push("#define NUM_MORPH_INFLUENCERS " + u), la.MaterialHelper.PrepareAttributesForMorphTargets(o, s, { NUM_MORPH_INFLUENCERS: u })), t && (n.push("#define INSTANCES"), o.push("world0"), o.push("world1"), o.push("world2"), o.push("world3")); var d = n.join("\n"); return this._cachedDefines !== d && (this._cachedDefines = d, this._effectLayerMapGenerationEffect = this._scene.getEngine().createEffect("glowMapGeneration", o, ["world", "mBones", "viewProjection", "diffuseMatrix", "color", "emissiveMatrix", "morphTargetInfluences"], ["diffuseSampler", "emissiveSampler"], d, void 0, void 0, void 0, { maxSimultaneousMorphTargets: u })), this._effectLayerMapGenerationEffect.isReady() }, e.prototype.render = function () { var e = this._mergeEffect; if (e.isReady()) { for (var t = 0; t < this._postProcesses.length; t++)if (!this._postProcesses[t].isReady()) return; var i = this._scene.getEngine(); this.onBeforeComposeObservable.notifyObservers(this), i.enableEffect(e), i.setState(!1), i.bindBuffers(this._vertexBuffers, this._indexBuffer, e); var r = i.getAlphaMode(); i.setAlphaMode(this._effectLayerOptions.alphaBlendingMode), this._internalRender(e), i.setAlphaMode(r), this.onAfterComposeObservable.notifyObservers(this); var n = this._mainTexture.getSize(); this._setMainTextureSize(), n.width === this._mainTextureDesiredSize.width && n.height === this._mainTextureDesiredSize.height || (this.onSizeChangedObservable.notifyObservers(this), this._disposeTextureAndPostProcesses(), this._createMainTexture(), this._createTextureAndPostProcesses()) } }, e.prototype.hasMesh = function (e) { return -1 === this.renderingGroupId || e.renderingGroupId === this.renderingGroupId }, e.prototype.shouldRender = function () { return this.isEnabled && this._shouldRender }, e.prototype._shouldRenderMesh = function (e) { return !0 }, e.prototype._shouldRenderEmissiveTextureForMesh = function (e) { return !0 }, e.prototype._renderSubMesh = function (e) { var t = this; if (this.shouldRender()) { var i = e.getMaterial(), r = e.getRenderingMesh(), n = this._scene, o = n.getEngine(); if (i && !i.needAlphaBlendingForMesh(r)) { o.setState(i.backFaceCulling); var s = r._getInstancesRenderList(e._id); if (!s.mustReturn && this._shouldRenderMesh(r)) { var a = o.getCaps().instancedArrays && null !== s.visibleInstances[e._id] && void 0 !== s.visibleInstances[e._id]; if (this._setEmissiveTextureAndColor(r, e, i), this._isReady(e, a, this._emissiveTextureAndColor.texture)) { if (o.enableEffect(this._effectLayerMapGenerationEffect), r._bind(e, this._effectLayerMapGenerationEffect, la.Material.TriangleFillMode), this._effectLayerMapGenerationEffect.setMatrix("viewProjection", n.getTransformMatrix()), this._effectLayerMapGenerationEffect.setFloat4("color", this._emissiveTextureAndColor.color.r, this._emissiveTextureAndColor.color.g, this._emissiveTextureAndColor.color.b, this._emissiveTextureAndColor.color.a), i && i.needAlphaTesting()) { var l = i.getAlphaTestTexture(); if (l) { this._effectLayerMapGenerationEffect.setTexture("diffuseSampler", l); var c = l.getTextureMatrix(); c && this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix", c) } } this._emissiveTextureAndColor.texture && (this._effectLayerMapGenerationEffect.setTexture("emissiveSampler", this._emissiveTextureAndColor.texture), this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix", this._emissiveTextureAndColor.texture.getTextureMatrix())), r.useBones && r.computeBonesUsingShaders && r.skeleton && this._effectLayerMapGenerationEffect.setMatrices("mBones", r.skeleton.getTransformMatrices(r)), la.MaterialHelper.BindMorphTargetParameters(r, this._effectLayerMapGenerationEffect), r._processRendering(e, this._effectLayerMapGenerationEffect, la.Material.TriangleFillMode, s, a, function (e, i) { return t._effectLayerMapGenerationEffect.setMatrix("world", i) }) } else this._mainTexture.resetRefreshCounter() } } } }, e.prototype._rebuild = function () { var e = this._vertexBuffers[la.VertexBuffer.PositionKind]; e && e._rebuild(), this._generateIndexBuffer() }, e.prototype._disposeTextureAndPostProcesses = function () { this._mainTexture.dispose(); for (var e = 0; e < this._postProcesses.length; e++)this._postProcesses[e] && this._postProcesses[e].dispose(); for (this._postProcesses = [], e = 0; e < this._textures.length; e++)this._textures[e] && this._textures[e].dispose(); this._textures = [] }, e.prototype.dispose = function () { var e = this._vertexBuffers[la.VertexBuffer.PositionKind]; e && (e.dispose(), this._vertexBuffers[la.VertexBuffer.PositionKind] = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null), this._disposeTextureAndPostProcesses(); var t = this._scene.effectLayers.indexOf(this, 0); -1 < t && this._scene.effectLayers.splice(t, 1), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear(), this.onBeforeRenderMainTextureObservable.clear(), this.onBeforeComposeObservable.clear(), this.onAfterComposeObservable.clear(), this.onSizeChangedObservable.clear() }, e.prototype.getClassName = function () { return "EffectLayer" }, e.Parse = function (e, t, i) { return la.Tools.Instantiate(e.customType).Parse(e, t, i) }, b([la.serialize()], e.prototype, "name", void 0), b([la.serializeAsColor4()], e.prototype, "neutralColor", void 0), b([la.serialize()], e.prototype, "isEnabled", void 0), b([la.serializeAsCameraReference()], e.prototype, "camera", null), b([la.serialize()], e.prototype, "renderingGroupId", null), e }(), la.EffectLayer = ca, function (e) { e.AbstractScene.prototype.getHighlightLayerByName = function (e) { for (var t = 0; t < this.effectLayers.length; t++)if (this.effectLayers[t].name === e && this.effectLayers[t].getEffectName() === i.EffectName) return this.effectLayers[t]; return null }; var t = function (t) { function i(i, r, n, o, s, a, l, c) { void 0 === a && (a = e.Texture.BILINEAR_SAMPLINGMODE); var h = t.call(this, i, "glowBlurPostProcess", ["screenSize", "direction", "blurWidth"], null, o, s, a, l, c) || this; return h.direction = r, h.kernel = n, h.onApplyObservable.add(function (e) { e.setFloat2("screenSize", h.width, h.height), e.setVector2("direction", h.direction), e.setFloat("blurWidth", h.kernel) }), h } return T(i, t), i }(e.PostProcess), i = function (i) { function r(t, n, o) { var s = i.call(this, t, n) || this; return s.name = t, s.innerGlow = !0, s.outerGlow = !0, s.onBeforeBlurObservable = new e.Observable, s.onAfterBlurObservable = new e.Observable, s._instanceGlowingMeshStencilReference = r.GlowingMeshStencilReference++ , s._meshes = {}, s._excludedMeshes = {}, s.neutralColor = r.NeutralColor, s._engine.isStencilEnable || e.Tools.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new BABYLON.Engine(canvas, antialias, { stencil: true }"), s._options = tl({ mainTextureRatio: .5, blurTextureSizeRatio: .5, blurHorizontalSize: 1, blurVerticalSize: 1, alphaBlendingMode: e.Engine.ALPHA_COMBINE, camera: null, renderingGroupId: -1 }, o), s._init({ alphaBlendingMode: s._options.alphaBlendingMode, camera: s._options.camera, mainTextureFixedSize: s._options.mainTextureFixedSize, mainTextureRatio: s._options.mainTextureRatio, renderingGroupId: s._options.renderingGroupId }), s._shouldRender = !1, s } return T(r, i), Object.defineProperty(r.prototype, "blurHorizontalSize", { get: function () { return this._horizontalBlurPostprocess.kernel }, set: function (e) { this._horizontalBlurPostprocess.kernel = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, "blurVerticalSize", { get: function () { return this._verticalBlurPostprocess.kernel }, set: function (e) { this._verticalBlurPostprocess.kernel = e }, enumerable: !0, configurable: !0 }), r.prototype.getEffectName = function () { return r.EffectName }, r.prototype._createMergeEffect = function () { return this._engine.createEffect("glowMapMerge", [e.VertexBuffer.PositionKind], ["offset"], ["textureSampler"], this._options.isStroke ? "#define STROKE \n" : void 0) }, r.prototype._createTextureAndPostProcesses = function () { var i = this, r = this._mainTextureDesiredSize.width * this._options.blurTextureSizeRatio, n = this._mainTextureDesiredSize.height * this._options.blurTextureSizeRatio; r = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(r, this._maxSize) : r, n = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(n, this._maxSize) : n; var o; o = this._engine.getCaps().textureHalfFloatRender ? e.Engine.TEXTURETYPE_HALF_FLOAT : e.Engine.TEXTURETYPE_UNSIGNED_INT, this._blurTexture = new e.RenderTargetTexture("HighlightLayerBlurRTT", { width: r, height: n }, this._scene, !1, !0, o), this._blurTexture.wrapU = e.Texture.CLAMP_ADDRESSMODE, this._blurTexture.wrapV = e.Texture.CLAMP_ADDRESSMODE, this._blurTexture.anisotropicFilteringLevel = 16, this._blurTexture.updateSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE), this._blurTexture.renderParticles = !1, this._blurTexture.ignoreCameraViewport = !0, this._textures = [this._blurTexture], this._options.alphaBlendingMode === e.Engine.ALPHA_COMBINE ? (this._downSamplePostprocess = new e.PassPostProcess("HighlightLayerPPP", this._options.blurTextureSizeRatio, null, e.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine()), this._downSamplePostprocess.onApplyObservable.add(function (e) { e.setTexture("textureSampler", i._mainTexture) }), this._horizontalBlurPostprocess = new t("HighlightLayerHBP", new e.Vector2(1, 0), this._options.blurHorizontalSize, 1, null, e.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine()), this._horizontalBlurPostprocess.onApplyObservable.add(function (e) { e.setFloat2("screenSize", r, n) }), this._verticalBlurPostprocess = new t("HighlightLayerVBP", new e.Vector2(0, 1), this._options.blurVerticalSize, 1, null, e.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine()), this._verticalBlurPostprocess.onApplyObservable.add(function (e) { e.setFloat2("screenSize", r, n) }), this._postProcesses = [this._downSamplePostprocess, this._horizontalBlurPostprocess, this._verticalBlurPostprocess]) : (this._horizontalBlurPostprocess = new e.BlurPostProcess("HighlightLayerHBP", new e.Vector2(1, 0), this._options.blurHorizontalSize / 2, { width: r, height: n }, null, e.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, o), this._horizontalBlurPostprocess.width = r, this._horizontalBlurPostprocess.height = n, this._horizontalBlurPostprocess.onApplyObservable.add(function (e) { e.setTexture("textureSampler", i._mainTexture) }), this._verticalBlurPostprocess = new e.BlurPostProcess("HighlightLayerVBP", new e.Vector2(0, 1), this._options.blurVerticalSize / 2, { width: r, height: n }, null, e.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, o), this._postProcesses = [this._horizontalBlurPostprocess, this._verticalBlurPostprocess]), this._mainTexture.onAfterUnbindObservable.add(function () { i.onBeforeBlurObservable.notifyObservers(i); var e = i._blurTexture.getInternalTexture(); e && i._scene.postProcessManager.directRender(i._postProcesses, e, !0), i.onAfterBlurObservable.notifyObservers(i) }), this._postProcesses.map(function (e) { e.autoClear = !1 }) }, r.prototype.needStencil = function () { return !0 }, r.prototype.isReady = function (e, t) { var r = e.getMaterial(), n = e.getRenderingMesh(); if (!r || !n || !this._meshes) return !1; var o = null, s = this._meshes[n.uniqueId]; return s && s.glowEmissiveOnly && r && (o = r.emissiveTexture), i.prototype._isReady.call(this, e, t, o) }, r.prototype._internalRender = function (t) { t.setTexture("textureSampler", this._blurTexture); var i = this._engine, r = i.getStencilBuffer(), n = i.getStencilFunction(), o = i.getStencilMask(), s = i.getStencilOperationPass(), a = i.getStencilOperationFail(), l = i.getStencilOperationDepthFail(), c = i.getStencilFunctionReference(); i.setStencilOperationPass(e.Engine.REPLACE), i.setStencilOperationFail(e.Engine.KEEP), i.setStencilOperationDepthFail(e.Engine.KEEP), i.setStencilMask(0), i.setStencilBuffer(!0), i.setStencilFunctionReference(this._instanceGlowingMeshStencilReference), this.outerGlow && (t.setFloat("offset", 0), i.setStencilFunction(e.Engine.NOTEQUAL), i.drawElementsType(e.Material.TriangleFillMode, 0, 6)), this.innerGlow && (t.setFloat("offset", 1), i.setStencilFunction(e.Engine.EQUAL), i.drawElementsType(e.Material.TriangleFillMode, 0, 6)), i.setStencilFunction(n), i.setStencilMask(o), i.setStencilBuffer(r), i.setStencilOperationPass(s), i.setStencilOperationFail(a), i.setStencilOperationDepthFail(l), i.setStencilFunctionReference(c) }, r.prototype.shouldRender = function () { return !!i.prototype.shouldRender.call(this) && !!this._meshes }, r.prototype._shouldRenderMesh = function (e) { return !(this._excludedMeshes && this._excludedMeshes[e.uniqueId] || !i.prototype.hasMesh.call(this, e)) }, r.prototype._setEmissiveTextureAndColor = function (e, t, i) { var r = this._meshes[e.uniqueId]; r ? this._emissiveTextureAndColor.color.set(r.color.r, r.color.g, r.color.b, 1) : this._emissiveTextureAndColor.color.set(this.neutralColor.r, this.neutralColor.g, this.neutralColor.b, this.neutralColor.a), r && r.glowEmissiveOnly && i ? (this._emissiveTextureAndColor.texture = i.emissiveTexture, this._emissiveTextureAndColor.color.set(1, 1, 1, 1)) : this._emissiveTextureAndColor.texture = null }, r.prototype.addExcludedMesh = function (e) { this._excludedMeshes && (this._excludedMeshes[e.uniqueId] || (this._excludedMeshes[e.uniqueId] = { mesh: e, beforeRender: e.onBeforeRenderObservable.add(function (e) { e.getEngine().setStencilBuffer(!1) }), afterRender: e.onAfterRenderObservable.add(function (e) { e.getEngine().setStencilBuffer(!0) }) })) }, r.prototype.removeExcludedMesh = function (e) { if (this._excludedMeshes) { var t = this._excludedMeshes[e.uniqueId]; t && (t.beforeRender && e.onBeforeRenderObservable.remove(t.beforeRender), t.afterRender && e.onAfterRenderObservable.remove(t.afterRender)), this._excludedMeshes[e.uniqueId] = null } }, r.prototype.hasMesh = function (e) { return !!this._meshes && !!i.prototype.hasMesh.call(this, e) && void 0 !== this._meshes[e.uniqueId] && null !== this._meshes[e.uniqueId] }, r.prototype.addMesh = function (e, t, i) { var r = this; if (void 0 === i && (i = !1), this._meshes) { var n = this._meshes[e.uniqueId]; n ? n.color = t : (this._meshes[e.uniqueId] = { mesh: e, color: t, observerHighlight: e.onBeforeRenderObservable.add(function (e) { r._excludedMeshes && r._excludedMeshes[e.uniqueId] ? r._defaultStencilReference(e) : e.getScene().getEngine().setStencilFunctionReference(r._instanceGlowingMeshStencilReference) }), observerDefault: e.onAfterRenderObservable.add(this._defaultStencilReference), glowEmissiveOnly: i }, e.onDisposeObservable.add(function () { r._disposeMesh(e) })), this._shouldRender = !0 } }, r.prototype.removeMesh = function (e) { if (this._meshes) { var t = this._meshes[e.uniqueId]; for (var i in t && (t.observerHighlight && e.onBeforeRenderObservable.remove(t.observerHighlight), t.observerDefault && e.onAfterRenderObservable.remove(t.observerDefault), delete this._meshes[e.uniqueId]), this._shouldRender = !1, this._meshes) if (this._meshes[i]) { this._shouldRender = !0; break } } }, r.prototype._defaultStencilReference = function (e) { e.getScene().getEngine().setStencilFunctionReference(r.NormalMeshStencilReference) }, r.prototype._disposeMesh = function (e) { this.removeMesh(e), this.removeExcludedMesh(e) }, r.prototype.dispose = function () { if (this._meshes) { for (var e in this._meshes) (t = this._meshes[e]) && t.mesh && (t.observerHighlight && t.mesh.onBeforeRenderObservable.remove(t.observerHighlight), t.observerDefault && t.mesh.onAfterRenderObservable.remove(t.observerDefault)); this._meshes = null } if (this._excludedMeshes) { for (var e in this._excludedMeshes) { var t; (t = this._excludedMeshes[e]) && (t.beforeRender && t.mesh.onBeforeRenderObservable.remove(t.beforeRender), t.afterRender && t.mesh.onAfterRenderObservable.remove(t.afterRender)) } this._excludedMeshes = null } i.prototype.dispose.call(this) }, r.prototype.getClassName = function () { return "HighlightLayer" }, r.prototype.serialize = function () { var t = e.SerializationHelper.Serialize(this); if (t.customType = "BABYLON.HighlightLayer", t.meshes = [], this._meshes) for (var i in this._meshes) { var r = this._meshes[i]; r && t.meshes.push({ glowEmissiveOnly: r.glowEmissiveOnly, color: r.color.asArray(), meshId: r.mesh.id }) } if (t.excludedMeshes = [], this._excludedMeshes) for (var n in this._excludedMeshes) { var o = this._excludedMeshes[n]; o && t.excludedMeshes.push(o.mesh.id) } return t }, r.Parse = function (t, i, n) { var o, s = e.SerializationHelper.Parse(function () { return new r(t.name, i, t.options) }, t, i, n); for (o = 0; o < t.excludedMeshes.length; o++)(a = i.getMeshByID(t.excludedMeshes[o])) && s.addExcludedMesh(a); for (o = 0; o < t.meshes.length; o++) { var a, l = t.meshes[o]; (a = i.getMeshByID(l.meshId)) && s.addMesh(a, e.Color3.FromArray(l.color), l.glowEmissiveOnly) } return s }, r.EffectName = "HighlightLayer", r.NeutralColor = new e.Color4(0, 0, 0, 0), r.GlowingMeshStencilReference = 2, r.NormalMeshStencilReference = 1, b([e.serialize()], r.prototype, "innerGlow", void 0), b([e.serialize()], r.prototype, "outerGlow", void 0), b([e.serialize()], r.prototype, "blurHorizontalSize", null), b([e.serialize()], r.prototype, "blurVerticalSize", null), b([e.serialize("options")], r.prototype, "_options", void 0), r }(e.EffectLayer); e.HighlightLayer = i }($a || ($a = {})), function (e) { e.AbstractScene.prototype.getGlowLayerByName = function (e) { for (var i = 0; i < this.effectLayers.length; i++)if (this.effectLayers[i].name === e && this.effectLayers[i].getEffectName() === t.EffectName) return this.effectLayers[i]; return null }; var t = function (t) { function i(r, n, o) { var s = t.call(this, r, n) || this; return s._intensity = 1, s._includedOnlyMeshes = [], s._excludedMeshes = [], s.neutralColor = new e.Color4(0, 0, 0, 1), s._options = tl({ mainTextureRatio: i.DefaultTextureRatio, blurKernelSize: 32, mainTextureFixedSize: void 0, camera: null, mainTextureSamples: 1, renderingGroupId: -1 }, o), s._init({ alphaBlendingMode: e.Engine.ALPHA_ADD, camera: s._options.camera, mainTextureFixedSize: s._options.mainTextureFixedSize, mainTextureRatio: s._options.mainTextureRatio, renderingGroupId: s._options.renderingGroupId }), s } return T(i, t), Object.defineProperty(i.prototype, "blurKernelSize", { get: function () { return this._horizontalBlurPostprocess1.kernel }, set: function (e) { this._horizontalBlurPostprocess1.kernel = e, this._verticalBlurPostprocess1.kernel = e, this._horizontalBlurPostprocess2.kernel = e, this._verticalBlurPostprocess2.kernel = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(i.prototype, "intensity", { get: function () { return this._intensity }, set: function (e) { this._intensity = e }, enumerable: !0, configurable: !0 }), i.prototype.getEffectName = function () { return i.EffectName }, i.prototype._createMergeEffect = function () { return this._engine.createEffect("glowMapMerge", [e.VertexBuffer.PositionKind], ["offset"], ["textureSampler", "textureSampler2"], "#define EMISSIVE \n") }, i.prototype._createTextureAndPostProcesses = function () { var t = this, i = this._mainTextureDesiredSize.width, r = this._mainTextureDesiredSize.height; i = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(i, this._maxSize) : i, r = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(r, this._maxSize) : r; var n; n = this._engine.getCaps().textureHalfFloatRender ? e.Engine.TEXTURETYPE_HALF_FLOAT : e.Engine.TEXTURETYPE_UNSIGNED_INT, this._blurTexture1 = new e.RenderTargetTexture("GlowLayerBlurRTT", { width: i, height: r }, this._scene, !1, !0, n), this._blurTexture1.wrapU = e.Texture.CLAMP_ADDRESSMODE, this._blurTexture1.wrapV = e.Texture.CLAMP_ADDRESSMODE, this._blurTexture1.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE), this._blurTexture1.renderParticles = !1, this._blurTexture1.ignoreCameraViewport = !0; var o = Math.floor(i / 2), s = Math.floor(r / 2); this._blurTexture2 = new e.RenderTargetTexture("GlowLayerBlurRTT2", { width: o, height: s }, this._scene, !1, !0, n), this._blurTexture2.wrapU = e.Texture.CLAMP_ADDRESSMODE, this._blurTexture2.wrapV = e.Texture.CLAMP_ADDRESSMODE, this._blurTexture2.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE), this._blurTexture2.renderParticles = !1, this._blurTexture2.ignoreCameraViewport = !0, this._textures = [this._blurTexture1, this._blurTexture2], this._horizontalBlurPostprocess1 = new e.BlurPostProcess("GlowLayerHBP1", new e.Vector2(1, 0), this._options.blurKernelSize / 2, { width: i, height: r }, null, e.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, n), this._horizontalBlurPostprocess1.width = i, this._horizontalBlurPostprocess1.height = r, this._horizontalBlurPostprocess1.onApplyObservable.add(function (e) { e.setTexture("textureSampler", t._mainTexture) }), this._verticalBlurPostprocess1 = new e.BlurPostProcess("GlowLayerVBP1", new e.Vector2(0, 1), this._options.blurKernelSize / 2, { width: i, height: r }, null, e.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, n), this._horizontalBlurPostprocess2 = new e.BlurPostProcess("GlowLayerHBP2", new e.Vector2(1, 0), this._options.blurKernelSize / 2, { width: o, height: s }, null, e.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, n), this._horizontalBlurPostprocess2.width = o, this._horizontalBlurPostprocess2.height = s, this._horizontalBlurPostprocess2.onApplyObservable.add(function (e) { e.setTexture("textureSampler", t._blurTexture1) }), this._verticalBlurPostprocess2 = new e.BlurPostProcess("GlowLayerVBP2", new e.Vector2(0, 1), this._options.blurKernelSize / 2, { width: o, height: s }, null, e.Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), !1, n), this._postProcesses = [this._horizontalBlurPostprocess1, this._verticalBlurPostprocess1, this._horizontalBlurPostprocess2, this._verticalBlurPostprocess2], this._postProcesses1 = [this._horizontalBlurPostprocess1, this._verticalBlurPostprocess1], this._postProcesses2 = [this._horizontalBlurPostprocess2, this._verticalBlurPostprocess2], this._mainTexture.samples = this._options.mainTextureSamples, this._mainTexture.onAfterUnbindObservable.add(function () { var e = t._blurTexture1.getInternalTexture(); e && (t._scene.postProcessManager.directRender(t._postProcesses1, e, !0), (e = t._blurTexture2.getInternalTexture()) && t._scene.postProcessManager.directRender(t._postProcesses2, e, !0)) }), this._postProcesses.map(function (e) { e.autoClear = !1 }) }, i.prototype.isReady = function (e, i) { var r = e.getMaterial(), n = e.getRenderingMesh(); if (!r || !n) return !1; var o = r.emissiveTexture; return t.prototype._isReady.call(this, e, i, o) }, i.prototype.needStencil = function () { return !1 }, i.prototype._internalRender = function (t) { t.setTexture("textureSampler", this._blurTexture1), t.setTexture("textureSampler2", this._blurTexture2), t.setFloat("offset", this._intensity); var i = this._engine, r = i.getStencilBuffer(); i.setStencilBuffer(!1), i.drawElementsType(e.Material.TriangleFillMode, 0, 6), i.setStencilBuffer(r) }, i.prototype._setEmissiveTextureAndColor = function (e, t, i) { var r = 1; this.customEmissiveTextureSelector ? this._emissiveTextureAndColor.texture = this.customEmissiveTextureSelector(e, t, i) : i ? (this._emissiveTextureAndColor.texture = i.emissiveTexture, this._emissiveTextureAndColor.texture && (r = this._emissiveTextureAndColor.texture.level)) : this._emissiveTextureAndColor.texture = null, this.customEmissiveColorSelector ? this.customEmissiveColorSelector(e, t, i, this._emissiveTextureAndColor.color) : i.emissiveColor ? this._emissiveTextureAndColor.color.set(i.emissiveColor.r * r, i.emissiveColor.g * r, i.emissiveColor.b * r, 1) : this._emissiveTextureAndColor.color.set(this.neutralColor.r, this.neutralColor.g, this.neutralColor.b, this.neutralColor.a) }, i.prototype._shouldRenderMesh = function (e) { return this.hasMesh(e) }, i.prototype.addExcludedMesh = function (e) { -1 === this._excludedMeshes.indexOf(e.uniqueId) && this._excludedMeshes.push(e.uniqueId) }, i.prototype.removeExcludedMesh = function (e) { var t = this._excludedMeshes.indexOf(e.uniqueId); -1 !== t && this._excludedMeshes.splice(t, 1) }, i.prototype.addIncludedOnlyMesh = function (e) { -1 === this._includedOnlyMeshes.indexOf(e.uniqueId) && this._includedOnlyMeshes.push(e.uniqueId) }, i.prototype.removeIncludedOnlyMesh = function (e) { var t = this._includedOnlyMeshes.indexOf(e.uniqueId); -1 !== t && this._includedOnlyMeshes.splice(t, 1) }, i.prototype.hasMesh = function (e) { return !!t.prototype.hasMesh.call(this, e) && (this._includedOnlyMeshes.length ? -1 !== this._includedOnlyMeshes.indexOf(e.uniqueId) : !this._excludedMeshes.length || -1 === this._excludedMeshes.indexOf(e.uniqueId)) }, i.prototype._disposeMesh = function (e) { this.removeIncludedOnlyMesh(e), this.removeExcludedMesh(e) }, i.prototype.getClassName = function () { return "GlowLayer" }, i.prototype.serialize = function () { var t, i = e.SerializationHelper.Serialize(this); if (i.customType = "BABYLON.GlowLayer", i.includedMeshes = [], this._includedOnlyMeshes.length) for (t = 0; t < this._includedOnlyMeshes.length; t++)(r = this._scene.getMeshByUniqueID(this._includedOnlyMeshes[t])) && i.includedMeshes.push(r.id); if (i.excludedMeshes = [], this._excludedMeshes.length) for (t = 0; t < this._excludedMeshes.length; t++) { var r; (r = this._scene.getMeshByUniqueID(this._excludedMeshes[t])) && i.excludedMeshes.push(r.id) } return i }, i.Parse = function (t, r, n) { var o, s = e.SerializationHelper.Parse(function () { return new i(t.name, r, t.options) }, t, r, n); for (o = 0; o < t.excludedMeshes.length; o++)(a = r.getMeshByID(t.excludedMeshes[o])) && s.addExcludedMesh(a); for (o = 0; o < t.includedMeshes.length; o++) { var a; (a = r.getMeshByID(t.includedMeshes[o])) && s.addIncludedOnlyMesh(a) } return s }, i.EffectName = "GlowLayer", i.DefaultBlurKernelSize = 32, i.DefaultTextureRatio = .5, b([e.serialize()], i.prototype, "blurKernelSize", null), b([e.serialize()], i.prototype, "intensity", null), b([e.serialize("options")], i.prototype, "_options", void 0), i }(e.EffectLayer); e.GlowLayer = t }($a || ($a = {})), function (e) { var t, i; (i = t = e.AssetTaskState || (e.AssetTaskState = {}))[i.INIT = 0] = "INIT", i[i.RUNNING = 1] = "RUNNING", i[i.DONE = 2] = "DONE", i[i.ERROR = 3] = "ERROR"; var r = function () { function e(e) { this.name = e, this._isCompleted = !1, this._taskState = t.INIT } return Object.defineProperty(e.prototype, "isCompleted", { get: function () { return this._isCompleted }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "taskState", { get: function () { return this._taskState }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "errorObject", { get: function () { return this._errorObject }, enumerable: !0, configurable: !0 }), e.prototype._setErrorObject = function (e, t) { this._errorObject || (this._errorObject = { message: e, exception: t }) }, e.prototype.run = function (e, i, r) { var n = this; this._taskState = t.RUNNING, this.runTask(e, function () { n.onDoneCallback(i, r) }, function (e, t) { n.onErrorCallback(r, e, t) }) }, e.prototype.runTask = function (e, t, i) { throw new Error("runTask is not implemented") }, e.prototype.reset = function () { this._taskState = t.INIT }, e.prototype.onErrorCallback = function (e, i, r) { this._taskState = t.ERROR, this._errorObject = { message: i, exception: r }, this.onError && this.onError(this, i, r), e() }, e.prototype.onDoneCallback = function (e, i) { try { this._taskState = t.DONE, this._isCompleted = !0, this.onSuccess && this.onSuccess(this), e() } catch (e) { this.onErrorCallback(i, "Task is done, error executing success callback(s)", e) } }, e }(); e.AbstractAssetTask = r; var n = function (e, t, i) { this.remainingCount = e, this.totalCount = t, this.task = i }; e.AssetsProgressEvent = n; var o = function (t) { function i(e, i, r, n) { var o = t.call(this, e) || this; return o.name = e, o.meshesNames = i, o.rootUrl = r, o.sceneFilename = n, o } return T(i, t), i.prototype.runTask = function (t, i, r) { var n = this; e.SceneLoader.ImportMesh(this.meshesNames, this.rootUrl, this.sceneFilename, t, function (e, t, r) { n.loadedMeshes = e, n.loadedParticleSystems = t, n.loadedSkeletons = r, i() }, null, function (e, t, i) { r(t, i) }) }, i }(r); e.MeshAssetTask = o; var s = function (e) { function t(t, i) { var r = e.call(this, t) || this; return r.name = t, r.url = i, r } return T(t, e), t.prototype.runTask = function (e, t, i) { var r = this; e._loadFile(this.url, function (e) { r.text = e, t() }, void 0, !1, !1, function (e, t) { e && i(e.status + " " + e.statusText, t) }) }, t }(r); e.TextFileAssetTask = s; var a = function (e) { function t(t, i) { var r = e.call(this, t) || this; return r.name = t, r.url = i, r } return T(t, e), t.prototype.runTask = function (e, t, i) { var r = this; e._loadFile(this.url, function (e) { r.data = e, t() }, void 0, !0, !0, function (e, t) { e && i(e.status + " " + e.statusText, t) }) }, t }(r); e.BinaryFileAssetTask = a; var l = function (t) { function i(e, i) { var r = t.call(this, e) || this; return r.name = e, r.url = i, r } return T(i, t), i.prototype.runTask = function (t, i, r) { var n = this, o = new Image; e.Tools.SetCorsBehavior(this.url, o), o.onload = function () { n.image = o, i() }, o.onerror = function (e) { r("Error loading image", e) }, o.src = this.url }, i }(r); e.ImageAssetTask = l; var c = function (t) { function i(i, r, n, o, s) { void 0 === s && (s = e.Texture.TRILINEAR_SAMPLINGMODE); var a = t.call(this, i) || this; return a.name = i, a.url = r, a.noMipmap = n, a.invertY = o, a.samplingMode = s, a } return T(i, t), i.prototype.runTask = function (t, i, r) { this.texture = new e.Texture(this.url, t, this.noMipmap, this.invertY, this.samplingMode, function () { i() }, function (e, t) { r(e, t) }) }, i }(r); e.TextureAssetTask = c; var h = function (t) { function i(e, i, r, n, o) { var s = t.call(this, e) || this; return s.name = e, s.url = i, s.extensions = r, s.noMipmap = n, s.files = o, s } return T(i, t), i.prototype.runTask = function (t, i, r) { this.texture = new e.CubeTexture(this.url, t, this.extensions, this.noMipmap, this.files, function () { i() }, function (e, t) { r(e, t) }) }, i }(r); e.CubeTextureAssetTask = h; var u = function (t) { function i(e, i, r, n, o, s, a) { void 0 === n && (n = !1), void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = !1); var l = t.call(this, e) || this; return l.name = e, l.url = i, l.size = r, l.noMipmap = n, l.generateHarmonics = o, l.gammaSpace = s, l.reserved = a, l } return T(i, t), i.prototype.run = function (t, i, r) { this.texture = new e.HDRCubeTexture(this.url, t, this.size, this.noMipmap, this.generateHarmonics, this.gammaSpace, this.reserved, function () { i() }, function (e, t) { r(e, t) }) }, i }(r); e.HDRCubeTextureAssetTask = u; var d = function () { function i(t) { this._isLoading = !1, this._tasks = new Array, this._waitingTasksCount = 0, this._totalTasksCount = 0, this.onTaskSuccessObservable = new e.Observable, this.onTaskErrorObservable = new e.Observable, this.onTasksDoneObservable = new e.Observable, this.onProgressObservable = new e.Observable, this.useDefaultLoadingScreen = !0, this._scene = t } return i.prototype.addMeshTask = function (e, t, i, r) { var n = new o(e, t, i, r); return this._tasks.push(n), n }, i.prototype.addTextFileTask = function (e, t) { var i = new s(e, t); return this._tasks.push(i), i }, i.prototype.addBinaryFileTask = function (e, t) { var i = new a(e, t); return this._tasks.push(i), i }, i.prototype.addImageTask = function (e, t) { var i = new l(e, t); return this._tasks.push(i), i }, i.prototype.addTextureTask = function (t, i, r, n, o) { void 0 === o && (o = e.Texture.TRILINEAR_SAMPLINGMODE); var s = new c(t, i, r, n, o); return this._tasks.push(s), s }, i.prototype.addCubeTextureTask = function (e, t, i, r, n) { var o = new h(e, t, i, r, n); return this._tasks.push(o), o }, i.prototype.addHDRCubeTextureTask = function (e, t, i, r, n, o, s) { void 0 === r && (r = !1), void 0 === n && (n = !0), void 0 === o && (o = !1), void 0 === s && (s = !1); var a = new u(e, t, i, r, n, o, s); return this._tasks.push(a), a }, i.prototype.removeTask = function (e) { var t = this._tasks.indexOf(e); -1 < t && this._tasks.splice(t, 1) }, i.prototype._decreaseWaitingTasksCount = function (i) { this._waitingTasksCount--; try { this.onProgress && this.onProgress(this._waitingTasksCount, this._totalTasksCount, i), this.onProgressObservable.notifyObservers(new n(this._waitingTasksCount, this._totalTasksCount, i)) } catch (i) { e.Tools.Error("Error running progress callbacks."), console.log(i) } if (0 === this._waitingTasksCount) { try { this.onFinish && this.onFinish(this._tasks); for (var r = this._tasks.slice(), o = 0, s = r; o < s.length; o++)if ((i = s[o]).taskState === t.DONE) { var a = this._tasks.indexOf(i); -1 < a && this._tasks.splice(a, 1) } this.onTasksDoneObservable.notifyObservers(this._tasks) } catch (i) { e.Tools.Error("Error running tasks-done callbacks."), console.log(i) } this._isLoading = !1, this._scene.getEngine().hideLoadingUI() } }, i.prototype._runTask = function (e) { var t = this, r = function (i, r) { e._setErrorObject(i, r), t.onTaskError && t.onTaskError(e), t.onTaskErrorObservable.notifyObservers(e), t._decreaseWaitingTasksCount(e) }; e.run(this._scene, function () { try { t.onTaskSuccess && t.onTaskSuccess(e), t.onTaskSuccessObservable.notifyObservers(e), t._decreaseWaitingTasksCount(e) } catch (i) { r("Error executing task success callbacks", i) } }, r) }, i.prototype.reset = function () { return this._isLoading = !1, this._tasks = new Array, this }, i.prototype.load = function () { if (this._isLoading) return this; if (this._isLoading = !0, this._waitingTasksCount = this._tasks.length, this._totalTasksCount = this._tasks.length, 0 === this._waitingTasksCount) return this._isLoading = !1, this.onFinish && this.onFinish(this._tasks), this.onTasksDoneObservable.notifyObservers(this._tasks), this; this.useDefaultLoadingScreen && this._scene.getEngine().displayLoadingUI(); for (var e = 0; e < this._tasks.length; e++) { var i = this._tasks[e]; i.taskState === t.INIT && this._runTask(i) } return this }, i }(); e.AssetsManager = d }($a || ($a = {})), ha = $a || ($a = {}), ua = [], da = function (e, t) { if (!ua[e.id] && !e.doNotSerialize) { if (e instanceof ha.BoxGeometry) t.boxes.push(e.serialize()); else if (e instanceof ha.SphereGeometry) t.spheres.push(e.serialize()); else if (e instanceof ha.CylinderGeometry) t.cylinders.push(e.serialize()); else if (e instanceof ha.TorusGeometry) t.toruses.push(e.serialize()); else if (e instanceof ha.GroundGeometry) t.grounds.push(e.serialize()); else if (e instanceof ha.Plane) t.planes.push(e.serialize()); else if (e instanceof ha.TorusKnotGeometry) t.torusKnots.push(e.serialize()); else { if (e instanceof ha._PrimitiveGeometry) throw new Error("Unknown primitive type"); t.vertexData.push(e.serializeVerticeData()) } ua[e.id] = !0 } }, fa = function (e, t) { var i = {}, r = e._geometry; return r && (e.getScene().getGeometryByID(r.id) || da(r, t.geometries)), e.serialize && e.serialize(i), i }, pa = function () { function e() { } return e.ClearCache = function () { ua = [] }, e.Serialize = function (t) { var i, r, n, o = {}; if (e.ClearCache(), o.useDelayedTextureLoading = t.useDelayedTextureLoading, o.autoClear = t.autoClear, o.clearColor = t.clearColor.asArray(), o.ambientColor = t.ambientColor.asArray(), o.gravity = t.gravity.asArray(), o.collisionsEnabled = t.collisionsEnabled, o.workerCollisions = t.workerCollisions, t.fogMode && 0 !== t.fogMode && (o.fogMode = t.fogMode, o.fogColor = t.fogColor.asArray(), o.fogStart = t.fogStart, o.fogEnd = t.fogEnd, o.fogDensity = t.fogDensity), t.isPhysicsEnabled()) { var s = t.getPhysicsEngine(); s && (o.physicsEnabled = !0, o.physicsGravity = s.gravity.asArray(), o.physicsEngine = s.getPhysicsPluginName()) } t.metadata && (o.metadata = t.metadata), o.morphTargetManagers = []; for (var a = 0, l = t.meshes; a < l.length; a++) { var c = (_ = l[a]).morphTargetManager; c && o.morphTargetManagers.push(c.serialize()) } for (o.lights = [], i = 0; i < t.lights.length; i++)(r = t.lights[i]).doNotSerialize || o.lights.push(r.serialize()); for (o.cameras = [], i = 0; i < t.cameras.length; i++) { var h = t.cameras[i]; h.doNotSerialize || o.cameras.push(h.serialize()) } for (t.activeCamera && (o.activeCameraID = t.activeCamera.id), ha.Animation.AppendSerializedAnimations(t, o), o.materials = [], o.multiMaterials = [], i = 0; i < t.materials.length; i++)(n = t.materials[i]).doNotSerialize || o.materials.push(n.serialize()); for (o.multiMaterials = [], i = 0; i < t.multiMaterials.length; i++) { var u = t.multiMaterials[i]; o.multiMaterials.push(u.serialize()) } for (t.environmentTexture && (o.environmentTexture = t.environmentTexture.name), o.skeletons = [], i = 0; i < t.skeletons.length; i++) { var d = t.skeletons[i]; d.doNotSerialize || o.skeletons.push(d.serialize()) } for (o.transformNodes = [], i = 0; i < t.transformNodes.length; i++)o.transformNodes.push(t.transformNodes[i].serialize()); o.geometries = {}, o.geometries.boxes = [], o.geometries.spheres = [], o.geometries.cylinders = [], o.geometries.toruses = [], o.geometries.grounds = [], o.geometries.planes = [], o.geometries.torusKnots = [], o.geometries.vertexData = [], ua = []; var f = t.getGeometries(); for (i = 0; i < f.length; i++) { var p = f[i]; p.isReady() && da(p, o.geometries) } for (o.meshes = [], i = 0; i < t.meshes.length; i++) { var _; if ((_ = t.meshes[i]) instanceof ha.Mesh) { var m = _; m.doNotSerialize || m.delayLoadState !== ha.Engine.DELAYLOADSTATE_LOADED && m.delayLoadState !== ha.Engine.DELAYLOADSTATE_NONE || o.meshes.push(fa(m, o)) } } for (o.particleSystems = [], i = 0; i < t.particleSystems.length; i++)o.particleSystems.push(t.particleSystems[i].serialize()); t.actionManager && (o.actions = t.actionManager.serialize("scene")); for (var g = 0, v = t._serializableComponents; g < v.length; g++)v[g].serialize(o); return o }, e.SerializeMesh = function (t, i, r) { void 0 === i && (i = !1), void 0 === r && (r = !1); var n = {}; if (e.ClearCache(), t = t instanceof Array ? t : [t], i || r) for (var o = 0; o < t.length; ++o)r && t[o].getDescendants().forEach(function (e) { e instanceof ha.Mesh && t.indexOf(e) < 0 && t.push(e) }), i && t[o].parent && t.indexOf(t[o].parent) < 0 && t.push(t[o].parent); return t.forEach(function (e) { !function (e, t) { if (e.delayLoadState === ha.Engine.DELAYLOADSTATE_LOADED || e.delayLoadState === ha.Engine.DELAYLOADSTATE_NONE) { if (e.material) if (e.material instanceof ha.MultiMaterial) { if (t.multiMaterials = t.multiMaterials || [], t.materials = t.materials || [], !t.multiMaterials.some(function (t) { return t.id === e.material.id })) { t.multiMaterials.push(e.material.serialize()); for (var i = function (e) { e && (t.materials.some(function (t) { return t.id === e.id }) || t.materials.push(e.serialize())) }, r = 0, n = e.material.subMaterials; r < n.length; r++)i(n[r]) } } else t.materials = t.materials || [], t.materials.some(function (t) { return t.id === e.material.id }) || t.materials.push(e.material.serialize()); var o = e._geometry; o && (t.geometries || (t.geometries = {}, t.geometries.boxes = [], t.geometries.spheres = [], t.geometries.cylinders = [], t.geometries.toruses = [], t.geometries.grounds = [], t.geometries.planes = [], t.geometries.torusKnots = [], t.geometries.vertexData = []), da(o, t.geometries)), e.skeleton && (t.skeletons = t.skeletons || [], t.skeletons.push(e.skeleton.serialize())), t.meshes = t.meshes || [], t.meshes.push(fa(e, t)) } }(e, n) }), n }, e }(), ha.SceneSerializer = pa, _a = $a || ($a = {}), ma = function () { function e(e, t, i, r, n) { void 0 === r && (r = !0), void 0 === n && (n = !1); var o = this; this.name = e, this._viewMatrix = _a.Matrix.Identity(), this._target = _a.Vector3.Zero(), this._add = _a.Vector3.Zero(), this._invertYAxis = !1, this.position = _a.Vector3.Zero(), this._scene = i, this._scene.reflectionProbes || (this._scene.reflectionProbes = new Array), this._scene.reflectionProbes.push(this), this._renderTargetTexture = new _a.RenderTargetTexture(e, t, i, r, !0, n ? _a.Engine.TEXTURETYPE_FLOAT : _a.Engine.TEXTURETYPE_UNSIGNED_INT, !0), this._renderTargetTexture.onBeforeRenderObservable.add(function (e) { switch (e) { case 0: o._add.copyFromFloats(1, 0, 0); break; case 1: o._add.copyFromFloats(-1, 0, 0); break; case 2: o._add.copyFromFloats(0, o._invertYAxis ? 1 : -1, 0); break; case 3: o._add.copyFromFloats(0, o._invertYAxis ? -1 : 1, 0); break; case 4: o._add.copyFromFloats(0, 0, 1); break; case 5: o._add.copyFromFloats(0, 0, -1) }o._attachedMesh && o.position.copyFrom(o._attachedMesh.getAbsolutePosition()), o.position.addToRef(o._add, o._target), _a.Matrix.LookAtLHToRef(o.position, o._target, _a.Vector3.Up(), o._viewMatrix), i.setTransformMatrix(o._viewMatrix, o._projectionMatrix), i._forcedViewPosition = o.position }), this._renderTargetTexture.onAfterUnbindObservable.add(function () { i._forcedViewPosition = null, i.updateTransformMatrix(!0) }), i.activeCamera && (this._projectionMatrix = _a.Matrix.PerspectiveFovLH(Math.PI / 2, 1, i.activeCamera.minZ, i.activeCamera.maxZ)) } return Object.defineProperty(e.prototype, "samples", { get: function () { return this._renderTargetTexture.samples }, set: function (e) { this._renderTargetTexture.samples = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "refreshRate", { get: function () { return this._renderTargetTexture.refreshRate }, set: function (e) { this._renderTargetTexture.refreshRate = e }, enumerable: !0, configurable: !0 }), e.prototype.getScene = function () { return this._scene }, Object.defineProperty(e.prototype, "cubeTexture", { get: function () { return this._renderTargetTexture }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "renderList", { get: function () { return this._renderTargetTexture.renderList }, enumerable: !0, configurable: !0 }), e.prototype.attachToMesh = function (e) { this._attachedMesh = e }, e.prototype.setRenderingAutoClearDepthStencil = function (e, t) { this._renderTargetTexture.setRenderingAutoClearDepthStencil(e, t) }, e.prototype.dispose = function () { var e = this._scene.reflectionProbes.indexOf(this); -1 !== e && this._scene.reflectionProbes.splice(e, 1), this._renderTargetTexture && (this._renderTargetTexture.dispose(), this._renderTargetTexture = null) }, e }(), _a.ReflectionProbe = ma, ga = $a || ($a = {}), va = function () { function e(e) { this.name = ga.SceneComponentConstants.NAME_LAYER, this.scene = e, this._engine = e.getEngine(), e.layers = new Array } return e.prototype.register = function () { this.scene._beforeCameraDrawStage.registerStep(ga.SceneComponentConstants.STEP_BEFORECAMERADRAW_LAYER, this, this._drawBackground), this.scene._afterCameraDrawStage.registerStep(ga.SceneComponentConstants.STEP_AFTERCAMERADRAW_LAYER, this, this._drawForeground) }, e.prototype.rebuild = function () { for (var e = 0, t = this.scene.layers; e < t.length; e++)t[e]._rebuild() }, e.prototype.dispose = function () { for (var e = this.scene.layers; e.length;)e[0].dispose() }, e.prototype._draw = function (e, t) { var i = this.scene.layers; if (i.length) { this._engine.setDepthBuffer(!1); for (var r = e.layerMask, n = 0, o = i; n < o.length; n++) { var s = o[n]; s.isBackground === t && 0 != (s.layerMask & r) && s.render() } this._engine.setDepthBuffer(!0) } }, e.prototype._drawBackground = function (e) { this._draw(e, !0) }, e.prototype._drawForeground = function (e) { this._draw(e, !1) }, e }(), ga.LayerSceneComponent = va, ya = $a || ($a = {}), ba = function () { function e(e, t, i, r, n) { this.name = e, this.scale = new ya.Vector2(1, 1), this.offset = new ya.Vector2(0, 0), this.alphaBlendingMode = ya.Engine.ALPHA_COMBINE, this.layerMask = 268435455, this._vertexBuffers = {}, this.onDisposeObservable = new ya.Observable, this.onBeforeRenderObservable = new ya.Observable, this.onAfterRenderObservable = new ya.Observable, this.texture = t ? new ya.Texture(t, i, !0) : null, this.isBackground = void 0 === r || r, this.color = void 0 === n ? new ya.Color4(1, 1, 1, 1) : n, this._scene = i || ya.Engine.LastCreatedScene; var o = this._scene._getComponent(ya.SceneComponentConstants.NAME_LAYER); o || (o = new ya.LayerSceneComponent(this._scene), this._scene._addComponent(o)), this._scene.layers.push(this); var s = this._scene.getEngine(), a = []; a.push(1, 1), a.push(-1, 1), a.push(-1, -1), a.push(1, -1); var l = new ya.VertexBuffer(s, a, ya.VertexBuffer.PositionKind, !1, !1, 2); this._vertexBuffers[ya.VertexBuffer.PositionKind] = l, this._createIndexBuffer(), this._effect = s.createEffect("layer", [ya.VertexBuffer.PositionKind], ["textureMatrix", "color", "scale", "offset"], ["textureSampler"], ""), this._alphaTestEffect = s.createEffect("layer", [ya.VertexBuffer.PositionKind], ["textureMatrix", "color", "scale", "offset"], ["textureSampler"], "#define ALPHATEST") } return Object.defineProperty(e.prototype, "onDispose", { set: function (e) { this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "onBeforeRender", { set: function (e) { this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver), this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "onAfterRender", { set: function (e) { this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver), this._onAfterRenderObserver = this.onAfterRenderObservable.add(e) }, enumerable: !0, configurable: !0 }), e.prototype._createIndexBuffer = function () { var e = this._scene.getEngine(), t = []; t.push(0), t.push(1), t.push(2), t.push(0), t.push(2), t.push(3), this._indexBuffer = e.createIndexBuffer(t) }, e.prototype._rebuild = function () { var e = this._vertexBuffers[ya.VertexBuffer.PositionKind]; e && e._rebuild(), this._createIndexBuffer() }, e.prototype.render = function () { var e = this.alphaTest ? this._alphaTestEffect : this._effect; if (e.isReady() && this.texture && this.texture.isReady()) { var t = this._scene.getEngine(); this.onBeforeRenderObservable.notifyObservers(this), t.enableEffect(e), t.setState(!1), e.setTexture("textureSampler", this.texture), e.setMatrix("textureMatrix", this.texture.getTextureMatrix()), e.setFloat4("color", this.color.r, this.color.g, this.color.b, this.color.a), e.setVector2("offset", this.offset), e.setVector2("scale", this.scale), t.bindBuffers(this._vertexBuffers, this._indexBuffer, e), this.alphaTest ? t.drawElementsType(ya.Material.TriangleFillMode, 0, 6) : (t.setAlphaMode(this.alphaBlendingMode), t.drawElementsType(ya.Material.TriangleFillMode, 0, 6), t.setAlphaMode(ya.Engine.ALPHA_DISABLE)), this.onAfterRenderObservable.notifyObservers(this) } }, e.prototype.dispose = function () { var e = this._vertexBuffers[ya.VertexBuffer.PositionKind]; e && (e.dispose(), this._vertexBuffers[ya.VertexBuffer.PositionKind] = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null), this.texture && (this.texture.dispose(), this.texture = null); var t = this._scene.layers.indexOf(this); this._scene.layers.splice(t, 1), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear(), this.onAfterRenderObservable.clear(), this.onBeforeRenderObservable.clear() }, e }(), ya.Layer = ba, Ta = $a || ($a = {}), Ea = function () { function e() { } return e.CreateResizedCopy = function (e, t, i, r) { void 0 === r && (r = !0); var n = e.getScene(), o = n.getEngine(), s = new Ta.RenderTargetTexture("resized" + e.name, { width: t, height: i }, n, !e.noMipmap, !0, e._texture.type, !1, e._samplingMode, !1); s.wrapU = e.wrapU, s.wrapV = e.wrapV, s.uOffset = e.uOffset, s.vOffset = e.vOffset, s.uScale = e.uScale, s.vScale = e.vScale, s.uAng = e.uAng, s.vAng = e.vAng, s.wAng = e.wAng, s.coordinatesIndex = e.coordinatesIndex, s.level = e.level, s.anisotropicFilteringLevel = e.anisotropicFilteringLevel, s._texture.isReady = !1, e.wrapU = Ta.Texture.CLAMP_ADDRESSMODE, e.wrapV = Ta.Texture.CLAMP_ADDRESSMODE; var a = new Ta.PassPostProcess("pass", 1, null, r ? Ta.Texture.BILINEAR_SAMPLINGMODE : Ta.Texture.NEAREST_SAMPLINGMODE, o, !1, Ta.Engine.TEXTURETYPE_UNSIGNED_INT); return a.getEffect().executeWhenCompiled(function () { a.onApply = function (t) { t.setTexture("textureSampler", e) }; var t = s.getInternalTexture(); t && (n.postProcessManager.directRender([a], t), o.unBindFramebuffer(t), s.disposeFramebufferObjects(), a.dispose(), t.isReady = !0) }), s }, e.GetEnvironmentBRDFTexture = function (e) { if (!e._environmentBRDFTexture) { var t = Ta.Texture.CreateFromBase64String(this._environmentBRDFBase64Texture, "EnvironmentBRDFTexture", e, !0, !1, Ta.Texture.BILINEAR_SAMPLINGMODE); t.wrapU = Ta.Texture.CLAMP_ADDRESSMODE, t.wrapV = Ta.Texture.CLAMP_ADDRESSMODE, e._environmentBRDFTexture = t } return e._environmentBRDFTexture }, e._environmentBRDFBase64Texture = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xu19Z7PtTHbW1g3jMMbGmGDAZAMm5xxMLDAU0WSKWOQcCoqccw6eGdtgk4yNbZxnvvAL+Af8Af6AsQl+06ako9X36dXPSi3pnPu+cz/cOntL3S1pq5+w1mrpLs/eud9fvn27rf9evPPwFz+v22S7fGZ/n7/70G79J5/Xv/qzbLP+Pnvvoc/6Tz7jX/15/c62LfeH7fofbpfP3l/ct36Wf+u4+D37+XYb++G26LPsr/zFttnPuh37bm1bt0f7MvtlnOx4uv0H4fty8UUsz77rfn/57u32cgXvDv72eQf0tl0+G38b0Nf9K4Dl704MEfA16KsE8Gw9JgD+DQE8EA0DT2b7GwK4GHnF4a8iguXZt9/vL5/dbisJbEq/uwD5vIK/fbbAv4N9U/8nJIDNCazKvBLBGwdwu62OhajxmQSAx6gqNp5HCg9wPan2nwSNjhLD8ux/3u8vP3y7vbwDAYjtR8AzFyDqLu1Q+YEINnew23rPCYiKb+q/K7o4AVT4tg0t/h4ydJZfkQASQ/d5b9fZ/Z1ENmuPn/cwYCYEELBguKC3nRkCnE0AFOwOKCOAR/sH/L4hgFMpbSWP5dn/uN9ffs7t9mJ5cAHoBLTyszBAFJ/F/xIKdASw5wgaEWDMLySxAk4svf6L+4QAGPiJCziNAPb4f3UZ2dh/m+z7BK4SAPYrxf5FB6ABPgCUAfANAZwKyscc7IEA/vv9/uLzbreXzx9cQCMACAl00m8jAlF7ov6SCMQ8gJsMFFBnCECSg5H6TxJAU3vPAbwhgFfz9AABeOEDBcIbB3AqPzwQwH+731/8sNvt5Ydut5e3B2C/fG9P+jESgGz/RgxG9r9VAwTUUh0goQDafUz+DYnAnSha5l99Z1l/yQVswAZSGIAugNd/9xBgCw9E8aECkHUB22QPHIAVDlQdQAMWAibhBgZAasAVHUAI8Cqg96Tm0bj3VBS9jwd7IIBvuN9ffMHt9vLTbreXy+32QlwAhgMIeuNzKwOqCoB2Aa00KHE+EsIeDuj4H2N+Hf/TfAC6A4nhgQCQDDwiaKDXiq9KgBEJNPArAtCk0AEd2mpAizW3/lYIoANpBPg3BPA+hjs/9eXZV+0E8Bm32wsJA9aEoBCAuAABPiEAC/yDC4gSgRgKRHkAlgsI6v7iEFqJEMgBwb4BGkEfEEDnDlReoAP/SQRgOYIB+IYDMEE/SQBbXoLNr0jhq4qOZc0PHBSf5oKW519xvz//kbfby8+83V68ABfwniIBgwgQ/HoRUMv8w5qAoQqgk4DWQiCw+63eD8k/XAPQgK5s/5a5xzAAqgR6wY9k+ZEMtCOoJABb230hEHMFWQdgAl0Ap/+uc6tKBrrP/n0AuwfiNwTwNKguHHV5/qX3+/M1B/Ddb7cXax7g2e324vaQB3hhkMAW92tHoFb96cVAbimwkgQ0Vv7R+D8iACfuxzKfLvnNlAAjAsBwwP2MwLQAD9sbYJME0AFcg5uBPSAA0x0AobhtcDKDA0j3KYDhk7Hp8uKj9/vzH3C7vfget9uLT9nDgDUZuOYCLBJA8MNKPyGGIftPrL+4gy3eh5p/lwRUYYAs9Fn7tM/E9lvJwCH2DxJ/mPTr4nyyLiDtBgTAGCrgNuPzNuETgN+suEEAFhng9lkCoICMLH7V0isCeEMCxylrefkl9/uzz90J4NNUGLDmAnYXINUBrf5dCCAuQCcCvYVAYPk3G++VAveVfkIAFRLolgbr2F9ifP33pAqAV/fHRF4HcAS7AKlAAEIYFNwITOszs/wMsB6II4BXFZ0QwBsSOEYCDwTw2TsBfPrt9uLlqzCgcwFABI0EVCiANl8Uvq0JWNsi2JPZ/0YKsOiHxftsW4v51ZqAaBWgZf91PsBL/jFHwEqBR1cCiuJ3gAfCmCEA3cf8rmz8AMZHIoA3JDBPAsuHVgL4jNvt+UoCH34ggK0asIYBGArsAB7AD+reQgCl+GwZ8LaNlP3MEEDaSg4ACMGr/+ulwV4JsAEfLH42/vdKgWElAJ4QpBl+LAlKErHwt+oGMgTA2ngE4IUIOH3dGr/hAKT/m/UBdSJYPuVL7vflU26352sScCWAD+0EsCcDVxewKjfmAzAsENVn4EfgdySgnYB81yEAgL4RA8T8mTUASAAYBgylQAkL8K/+zL6rsl8qF6ArAeS7WRGoAB8Sf7isN/VZqTs6jQ5wXlweWfyqpQ8I4I0TmCCAT/3I/b48u92ef9bt9nwNAdZE4FoOFALYXcAGegkDMByAzzQEgJh+cAIs/legH0IA5QTCPADE+7ISkD0TgA/8sBIgLQfOgF/F9kPcr+J8fIYguyCILQRKgV4DNviOzoKqeJS0u4AA3pBAjQSWT//I/b5OmC0MWB3ASgBrGLA+IryvDNxCgRXo+wKhjgwk8bcTwUACsJ09ANRVAALwCxmEoFcrAUsuAJ4M1E8BDuHABAHomJ8RgACrZfQLyT9dBWi2OOEG9NJd/TDQ8HAQuBE97ZhjGKy6o+imnU+4gDckkCeB5cMfud/v6zr9Dz84gOdCAM/3JwQhF9CAD25gBWWz/8wNgMpj3K9Lfy0foMMBVffXyT4r+cceC9bvCcDFP0311QrATPkvWgosYQFLAuoqQEcQuw3v2si25F+M1RkZXLUU+CgBmCBOEsCbvECOBJbP+Oj9fv+u2+3Zp91uz9cy4Kfebs/3ROD6iPD2b10YJCXB+0PyrgsHdtBuRACfBeTN+uM+suJPSEDbfh3/oxPoHgwiC3/06j8Eutj69sAQqj++I0CUfvIpwCEvYCT90O4Pn1XsT5Ve1/+dcp9FBh3woqXBSEJkvjHHEOUPqJPAjUUCeOMGfCJYPvOj9/t7//d2e7YmAlcS2B3A8xcPYcBm/7ULEDIQew+5gS0EIEA31R8Uf6gAoBsgKwBd9ddvBBJAs6XARgLQXQ2o7T8+IETe+9eRACg7rhCMVgCiE8D4O9wOCb2ubOht1/vYd2ubzLlgKbBHEDSnAMfL6durVm8qBPwXWz7rY/f7/X/fbsvL2+3Zqv4QAjzfw4COAMAJbEC3wC8koBJ9lAhgxZ+4hi3Oh/f8dU8EqtV/JhHgWn9cC4CJQZXZp6GAk/1nawMkrrcqAiwPIIA2FwOB2oaAF5UkcX+GADBs0I5gsNbBQqCorJcFJjqWKvhNMjky0Aek7/LZH7vf3/vO2215vruAD91uz/dSYCOAPQzYkoD7vw34sFIQw4LNymNSUKk8Wv0hCYhkoJ74Q6BboO9eDKoWAHXvBiCvAdPZf4nt3QqA924AbfXV8t8uN4Bt2We029WkoErWpSoCSm11TM8AOYA5uRS4RAITIQDDavaYHxCcm5exfM7H7vd3v2N9McDt9uxDD//WKsAG/ue32/M1DEACuO3g1jkBsf57fqCL/7UbIISAio85AAG0VQEYiIC9DJTYfy/+Dx8HlpeDRK8G90IBHQbgWgD2WT8LoOJ7NyeA5JEkAwwxmuqzur5X6y+sBEwDMggrqoBNH7c68Puk/fI9Vwfwvx4e6H724oEA1iSg5AAaAewlweeyLmAnAHQCTfU1CTAH4GyTMt+QDMRFQFEYQB71lXUAOjHYlvTqh4N2xe5yASoh2PpaJUGDBDrLr9cGIDlY1l+vDlQOAQHckYMiA68KMFsGtOy65RCGsMIDT+QqJoD3yUwCy/f+6P3+7koAt50AXrwigM0FrIuEoBrwHMMAUhmQUKAlAwHo7VmAPURo9h/r//ozLv1V7/5v6wGMV4B3rwYPXEBqIZAQwp4TYDE+LQlqtQfw6my/LgsyZaeLg7wVgmDnWQ5AA5ZWCDRx7ECzyn3udgFptFCIgTlyFRMEUCKgA+O/jl2Xz/3o/f7Otz88QvpszQOsLmAPARoBSDVgud02AthdwPZ5BSxUBVr8L3kAVHrvs076KSLQi3/M9QCJ7H/G/rf4n8X41XIgcwHecuBMDgAe+BHA6uQgqnvbF5DB5hwUQM3vQgIWkKOVftH+gAC6cz0RXZ9MjmD5fh/ZCWCd1CsB7CSwhgArAUgIIC5AQoDOCewJwab+CH79WR4C0mQAZT4hEQS9DgfEztNkoEECDfi6FAhZflb6Q1XXqwHDEECpvZX4a0qP1l7bfAS98cQfzQUo9a4mASMC0CsIm6JGK/2i/QkCuFK9PxmIYPm8nQDu795uy3K7LTvwVyJAB7ARwJoAVLkA7QIkJ9A5AQS95Ad2YmgvAJWwQFcBpB38pUuB9wVKbAWgCXwV86Mz2ICKTwUWFgOxMEBicr0eoBwCGBUADfxsDsAiA+zflNay31ZcfnAdAAXgDGkcdAcfZCJYfuCX3O9vf/vtthHAmgcQF7ATwOoAtn9IACsRSDkQ/wqIIUGoXYEQQ/sL5IDJP539776DwodVAGlr5QBgP8sDdApP3gSUXQa8/rZsRaBeHmy+HwDyCI1MUNlZzX9iJSBO9igJGJYCo4RdIqMfJQ4Ztq8C7FXjHuSnQ92XH/yvdwJ4Z68ErOXAlQRW0O9/JRG42v9GBHsuAImAqv+uzDo30C3yAfVHoHeg9xyAp/7wlp+WFCSWv1sOTBb+0EoAZP5DImBrApAUMFHolQG19c+EAkbpjyUEdQ6gm/QEsCzZFxKDlWNwprJVWfBm/1WAvWrcQ0ie7Lz80H91v7/9v263+9sPI2zrAZAEdvXvXMBKBJIIFDcgyUAEvHICg/o7wA/Bvyt35wCc2F9Cg03RvRyAA34N8hD0xsIfXP7bQgDMFSgyYO8GsF4N/hQ5ALak1yUGRQDZZJ5VWXgKEsie8yQuH63b8vn/8oEA3lsJYJ2EQgD73xX4z9bs/74gaHMBQgA7+DsXAJWBBniHCLTtNx2AUnkG/LYNiUCpvX7wp6sIOHF/lwgkNf8UGagwYMgLMBdgLQCyVgOyciCGCs5nz/Jr8EXOQOcQZEbrfjjTU8qaCBseMyx4vxPB8iP+RU8A24Kg9R8Qgaj/av8lDBgcwApQ+QdVgW0bKr3+jsk//AztzBKgtv4K+Kj08rl7JFgt9BnCAIsQcD2AsQAolQj0CAGAqhOFCK5u3cA+84dyIJLCPm6buAgoBa5qDoDF6wzUkZ13iSDKKwTamSKZSf29cuzJUwq7LV/wz18RwH2Nl9dKABLArv6bC5B/+9OBGxmsIIR1AQ3w2gk4RECTfwBulgC0rP96/FYJUOv9SzkAB/xuKTBY/qsTgZ0LILF/s/RW9v81ywEwhbeAwUIH6hRwGp+wEOhqoF49fojqQoPlR/+z+/3t77jd3n3rdru999CzEYAQAYJfXACEAqL8W5lQgA5uoJUK9zxBB3ii9ALiYT2AjvuN72wFILP+XdlP8gLKFeg6f5QM3AC+VlMMZ9ABGuN+VePHWL6tHVD23or3tQPo2iWfBRgShDp0ELcBjmIAbwTWqEzIJvLM6kEDEFcD9erxCzg3my4/9p/e7299x+323lu32+oAtjwAhgE7Cazqv7mAvRLQcgG7A9B5AAwHus87CWBYsIKFfe+eCSBgt2J+7QBQ+VsogOU/9fIPBvLhASEF8AHwlhPQ2wVYFhmo/Wby74QyYLcmQAEbbbue2FcnAb28QTmHQKBwNVCvHv8IESw//h/f7299pyIA7QIE/LsTeIbqL59hPUADvHIBG8jBIWgn0L4rsKMj2Noomz8QgZELsCoAAnh0Caj8lup7ib9tX+ZBoKgUmFkWTGJ8S/UHZa/kAHT+QGaeoeQmMUC/CoAzVYAjYDvSNwPCq8fPnINus/zEfwQE8O7tdt8dwGZjIQQQ9Y9cwAB+RQIC4I4MdvvdLL+O//E7LgLykn6q3Efjf6X8bOUfkoNYcQZ8z/KzBUBYCqT/YQgjBuOBHxPs7JHh7JoAy/IzWz+xEtBKBEYg8fIGw+SeQQQ+CzHZP+oWXWPU/8z9y0/+h/f729/5kAN4791X/6/cpl4SCsDfLRQwHEBLCmJFYH92vssNgBPo7D8qv4CekIHpAjKgx1iffGbKb5UAQwdguIAtz2KsEWj7vIQggNON91lYoIFN2mznYKj9UBmwQgXLLcDstRTdBchEFWAWcLP9MgC9cuzM8aXN8lP//v3+9v/uCUDyAM0FIBFADqAjAsgFiAvYwK3/MfAL8InSd/Yfy37Qpyv3OSTgxf8C5vZXPfF3aB2AA3hJGg5LghMOgCUBo8SgEAyC3Irvh5xAwhW0cT1iQBKYWds/QQLdeVUQcrEjeGoiWH7633sggHfWJOAaAkglYL/wLQyQf3tYsCp9CwmgFIgOgIJ/JwMdBuB3cQTDX4z9wR2whN+WE9idh67761p/F/8bpb8O/OotQCsJDhZfji0qT9p0LsCI83X9H8E9KH8iCSiTrQO29bwAAbvlCipPAw4T/oRKQAVElbaMJ472t7jnqnEjrlt+1t+539/6P4oAxLquawIkF7Bb/40M9hAAHcD2GVzABmBYKSgxfyMGAbROCipl1w6gs/8ZF0Cy/UIOOr7vHAIu9iHP/2v77yX9ROUt29+AHVUCnDJgtvSn8wXsnQGzIUAW3F27qFS4z2CrD07wCogqbR8LtGecUwR4vX/5OX/7FQFsOYC9FCiToBGAEAH83ZwA5AM06BspiPKrNQIt/kcg69iffBegNqVXb/wdQgIMC0DltUuQ+L+Bmz0OrNTdK/91+4JVf15SEPMCYRkwEfc3stBxurMS0AoTMKRocaV8cKw6jpcFsdUn2/8qRT8buGeP55HC8vP+5v3+1v99cADvvfNQBZB4dO24Kv5GAntSUOz/+n1wAis4wAnoMAC/N9svSUKsBABgmwPAbQTwWzsW/2vAI6j14h+1CEjnBYZFQWSxj+sEVFyPjgBBrhf+aOtPY39vRaBVJlQ2vyOGIATQsb6etBguDMSQyAF4IMhUAmZANNNnUNSqBDvtzzif6HSWL/wbuwN4eycA4gDEBQgRYPzfSGC3/BYBdOCHxKBHBAJoAbdWfIz1I9XXsf5g9y0yAJB7iUDPCaC6e2EA2ngMGyIHwAgBldncf4ID0EDXVp1NYmbnrclOtyfDhiPOoCO4CEXB/rOBfOZ4yy/8a7sDAALY1gKAfWMEgOovoNdk0IArKr+7gwH02gWQ2L4t/sEEoLL2IQnoFX96HYC4CIz/jcSgAJSVAtu2RPZ/SPRBHkC7AkYEqceC2fqBfdKaCcHAAeAkpKVBCANcElBVgBQRTC4HngHOTJ+rQo2jhEbP6xf/VU4AmBza7L+EAZgLgGSgxP8dGQDwmQOQbS2xp6oEWAnQn1seIEMCJO4fsv8Q2w/JQU0IJMvPiCCT/NPuQP/noJ0rAFBa23VSr1N/vQhIgxzzB9odMMIAkGvFZPF6JkyIlJeFFl6IcRYYX0ciOOOcll/6l+/3t/7fngPYy4BSCmyT0SGAlgvY4/+BAET10fZjUhAWCg2AV8nBEPQ6D6DJgSUAoQ/G+Dr+T9l/pfg0HxAs/e3WBUhbsihIgHKkHGiGCQHYO/UHomDgdd0BcRkZlYtyAFlgZNtlzqkSJcwc1xr/6FjLL/tLPQG8t+YA3tuXBKPiqISgAB//bjZdkoNE/Rs5EAIYXIAKCwYHYJADlvhalp8RgS4PogNwFN8jgo1A2LoALxRw1gA09TbCAjckQHBZlQEFwEoS0Iv1S3mAYFGPlwOIJn+0v+ocPohEsHzRX9gJYM0BvPvwTyoB2gGsP6iEAowANsBJWAAVgRYeAPCb/WdkAKEAttNJwRbzM+UPQI8K36k9Kf3RagBTe2vhj3o8uAFXLxUGxTdXBrK1AIltTZ2JzUe7Lp/Ralvxvrb5kcWP9nv2fwBzIRF4FRFkx/XcwRljHCGm5Vf++fv9re+63d4xCABVRhOAJoOtRCguQKoCmghwv7L/mBPQwB/KfMQhCEF0ym8RAUkIToUAxrP/gxOwSoDGmn9WCjTzASw3kHQA5poA7Q4g3n+MEMAChiadiopXwHZV26usvB43e/7Lr/pznADakmBdDcB8AFj+5ggcF4AhgAlwwyUM6m+pPgF8U3BS6jOdAAkJ3HUAO5C7ZKBT99/IVDsGhwyY3e8qNfhCERXDa5BrlW/ftaoqe265Ar0U+PIQQCUzqwqYBYfnSK4AcuW8sjmHaMzl1/zZnQDeud3eXRcCrfH/ngNYbyxzAKL8nQNAMiC5gI0gBNz42XIBAnAkBACwqDyWByPlp2BPWP7WD0Crs/5ewq+1JaBnWX8rEajbDiVAlbNpwHRyAJ4D6EqECQcQWfxo/0wI4E3wcPJnUbSLXqH5A26qHaD9kb7ssKaj+nV/ZiSALRG4rwhsJLBfUKt/k3yAJMGwEtCFBGD/PTIY4n6d8ANyaEk/Q/nPUv8h+WeRgXYCVgIwSwbK3osKi4PonEGUC2C2Pngc2LL73Xanlj9bBTg7BIgAFe2vuoxZS14B7wy/DCT8xX/qfn/rrYccwLtrElA7AJkgkrDSJUHJfO/Z/wZ4Kx8g4IXyYKfm0i9QfkoSJK5HghALr51Ce2Jwv0ad9BvAj1WCidKfZf1x3UDnvPQ90HYf7o1WfSQMGbOpU1D3H6oCynpjPE7VfSccpoalMEHNdAxFKkDLgDzTRo5ZaXukz1E34f1Gy2/8kzEB6MUlsjCoCwWMEAAdgOcGTECrnECn+JYTgPyABn0U82vwt7hfJft0rK9DAlHooTSolH94GxBUAnTSL/reAbz6UBADt344SDkIJBIT5E62HgnEAwgFmjq3ChFkAJUFd7Zd9fwsdZ89nnX85Tf/8Z0A1hwAOgDJAxBbuU1usboYCoiCKvWX+L/lAUDlNUG0bD8Bt7dviP9Vf0v9LbV3XQCz/3qbZf2d0h8D+JAPYDb/RAfArL1l92W7Z/OjEICpOZvkw7bES0EisET7M0RxRNkzx78qJGj37rf+MUUA+zoAnQjs1gTAhJNyFy4X7kBtkYHKB0ifDMgrLiADfJMESGa/Cwe0/a+CHsmA5QQ8N6ByAzJZh1IhEobOAegsvwaVDhEKDkCre0cielYbau4SQfIZggyIM0DMtMkc6ywnMHMsduzlt/+R+/2tt2+3d8QBiAtQSUBaEVDxPyYB22cEuiYDQgJtLUFk7539ke1vgAeAR05gC3ekbAclwuaEjEVA3XoAAnLpT6sBCuStrUrIpqsBHhkwcBOVTecFJAteCAFSyk/GzapwBOJofwV0mbEQkNX2p/X9HX9IEcB7eyLw3q8IlPgSbV/LBThEIMreQJkhAeYOIsDrsELV8VmIgHX9ITGo1L+BnxGB5wQY6IvKLzZZCKD7nsj8m+sADjoAVHk9ga19tF1CzSk5GO8T9MCUAdpZbSqEUW17lpNYfucfvN/fBgfwLlQBcEnwdkA9cdGiCjCgGrCpZhACDMSA6wL28dewgKl6GzuI963EXwtf1Nr/wQ0YMb+bCJwAPgKc5gPIPeiImeUC4B5J2zbZnGXBQjI4Mdk2HFNPYqv9MNlJCJByAzPPEezIiUAe7a8ANjPWGYpePc52Db/799/vb7/zKgQQAnhvDwH0cwFWLqBluwkRYJ7AqgoMTiHjApTqR9ZfbLxbCbCUX1wOKQGiO8ASn7XdKgMimL2SoG4nkxGVnqk+OoeBDHR4AN87EmCWnlULBGiBuiNJMFC5RJB8HsACRgYwZ7WpEEY2pNEuYOoYv/f37Q7g3dvtnT3+39YC6BBAv3IK1wVA9p8SAYC5gRDBqz53QDasvag/dQboGMCy0zBA7e/CgoTyszX/VeA35QeH1YGc2Hwr2YchGn5mJNGVd8FdoEOIHEBo9VkeQc3cqFJgEkPhxSBHwoIMCVTAlx1vlggq4y+/7/fe72+tDuDdV2XARgD7isDtd95BpZWjKRUov4Acwa6BT5OEsEjICg1aBUAl8DpwA2kgQeCYbHsjL0zygfKbll9XC5xk3zYGgM1yA0IKERGgI2PJQJ20M13CAQfgWv1kEjBj+Yc2zlqAGdWPgBPtrwI2O16FXMrn8Ad+z04AaxVgTwDiasAtBNgnrK4E6HBgSApichCBBHkBCnQNbmb1iTPoSEXlDXCfTv6x0EAA2OUDtCPA70bMT6sAXjVAlf4sIhieC8BYXy0CYk5gIPKCA8CJGzoAI5QYJqoRzx8NAZ6KCLLgzra7igSWP/i79hzA6gCAAMQFrBMNSUCrFypUm+x78k/cQRffY45AqatOGDJy0CDHkh5dDERielFhWvrTIYHO+icy/jK+qe6sCkCAH70erLsXylXMWv5GFowQrLyACISU6HZ0W+RALX0Qz2ug4NgYUWScRNQ+q6IZ8GbaVMCdHS99jX/4dwIBCAmsoNd5AHAB1sRDArByAV1YgLkBnfRDF6AtPbP4LNY32lkOgMX/tPynSKFzC466Y2JP+mT+mk8BOiVAVP2MA9COgH4nQGcgHxyCAe5uMicqARTcJ+QBIlB5+6O+V4E7c9wMCSx/9HfkCEDyAMPDJiQZ2AABqtZUVwG7s+ZWMlCDO/F9iPFZso9l/IkDaMRgxPqe4g8JQa30yg14pdaM7TddgWHxXcUPVgLqvnqyWw6AqrlT0jPV33AekYJb4IlAdfX+6LwR0BVi8Yhg+WO//X5/e68AyLMAawlwCAEwF2BkpTfgqwlu5QU6G45KrdYNsNi9qwAQMgjBnyEDI77XYGcxfjXut1wAhlfSptsGoNHJPab6XkLwTAeAk1MIidp+mJlRJYCqPxCABwizr0aUDl3I/ogEMsDMjJEZp0oYjECWP/HbSA4ACEDWAbA8gJ6MjADWbYP6i5LqvyRROBBABHgjXEAV14k963s7d0koOkm/s+J+FiaERADqbjkAHKNNrsRCoE7lmYsQ0HjlPm+dgMzKRLmQkkgyBJhR/SPWPwPyTJuriWD5U78FHMB7eyJQ5QDaYiBhXL0mgGWumRNQAO/KbieTASMOL8bvVgUSq2/lAvAaOvDiwiEjs6/BThdZ6bUBJNvfuQN0Z+pzVzI09nXqrT3UMRMAACAASURBVJcKg+J6xKAnLao7Tvruc6ZcyBS6EDpUXUIEvgyAz2oTnQuqe+aYzT386d98v69rALZ1AEIAazVgz/4zBzC8aorlAdS2rkIgC4e8v2TxkOsGMLeA45I6vgZ7ygFg4g8JQhOdl+FPZv+ZnRey0CQhE4PtH1TfCBmkXQd+S+1ZXkCTiQZq0gG4sb6qMHSAKFYQHpsIMoDMtKla/syYy5/9Tb0DWGP/7R8QgOUA2NtnzEw3LhRS6hjlA9CK6/gfS4XU5rOk427p9bg02cfATtS9CwGcSsB6/taTf9Zvx0ItvQ2JgH7WgEYyMMA+5AwmHMBMDsAjAhrPTz5M9H4mggy4M65g+XO/YSeAXf1lLYAsBca/24D7MwKdakBIYOUBxKYyJ0BDAeIOTOW2QI75AgVkXNVH7b+VBFTgDisAQda/gd5LrCrlZpa/WXJrEVBk+cGxNWAkqwDMQWiFNq2/zNKgDOi6A2NFICULRAV8rrSN7HgEzmh/NH4G2MZlDi8qXf78Fz8QgNj/thjIcADtvw9HNcgQwGxIwPIGLHTQVj8BfszWmzkAlZsQwFrlPbcCYOUCjBwKKwl6pUBRWyFhukxY7LmO7414X8f61BVY4YLY9iDBhy6BTX6LPJCoPHtcAXelbQRUD+gZEojGZyCvjrv8hV/fOwArBGBLgnFpcGdJYUJ0gNknxLDNCwm8xKEV6xtqPwt4DWpm92kIQICN7bSNF2Xv/pLfUgNd5wxoCEAA34GbqL0VAmhSuMIBuIqv8wGJRUQWmCzAfNIQwV/8tff7O+9BEhBKgEMiUIUAXjLQinMbAAAcCIruFWMVgBPFX28iLhW2Yvzu+JCo06A21wAQm69XRVJwk+RpaiEQCxeQKEDlaWhgtEWQWEqvt7vhwoQDKAFfjR+5hytdgjf20X1HLH/kIpa//GtUCLATgE4CogOQz628IwzslKx0gosuG1bWnuUGotJhyzUYYUIjBSsnoJKVXZnPCAeYo3EBH1UDDIA38CniiBR/CA1I1r5VEQBUg/1XVt8jjG7iWZUD5WEz5UIK8sRagIhYquQQgfqI/a/aeBYKZMOD5a/86r0MCGsApAqQcQDbgTQBMNuqJ70GE/nuOgMSGjDFj7ZZhNABnxBTIxon459Vfa9yYpUEEfRU5RXounEUkJEgGJlEYNb9O2IQ16hsO07y9nk2ETjzJKG4JIKUSlgQKqyDzgzQM22ic/AcxPLXflXSAew30no8eDsJvBGWyhmJsKojQOAOi3R0yRFtPcvuqxo/tf7qeryYv2T/mZqT0IARgfzmG9Eg6erP8Jvr+4Tk4Sk6IwnWfgA/IxsCPhmfKWuk3ugcqENIgLwC+hl1j4Ac7c+CPDNOd4/++q/ccwCRA1iFHkqAtBrA3ICh/J46Yp7AjM+DHIK27t1aA0YIbKGPIisrw59NAOqSH/0NEKyMCBS4qwnAtNpnk4JGnN8pfKYKoIgiA2R2DEYglW1XE8FZQI6AHu1vv8nf+BUPBNDKgFYOgDkAsHdmQhAnkhP74kNDg72OwgMP0CRuN90GW+CTdCwWoVluQKv3EAYQ1cZjuOpv9JXJNyT49KIgliMwlByVu7kJUFwvPBjcQuaxYSuUOBAGZMjGIxEP1BEQn3z/3/oi4gA0CQD4uxAACMBLCKLNjFSPJd3Q7rtJOWu1oZNcHMgmE+8H5T3P3Xj7OlCzCgEeN+sEVDs8Rpu4Ol9ggd1ScuYWkAQIsDv1lrYqB+BZ/2FfsBqQAe3sbZG6Xwn2aGzr3Ja//cuJA8CnAXfr314SajgBkwBwAs6EAwmwWWFChThY0s8iI297B3DDPYRtCLi3Psb2AdRAHrKvqb9BCEyNtaKXS4OkoqAnomXjKUEo9e/GSjqAs0HvAS8C5WzfaNwKES1/95cZDmAlAbIacPudIRcgi4H0oqBuUirgU6WDSVtJsHnJw8gtZNyGWeJLEJNn61vZzYjzo/3dQ0Ea1DgmUXMWAqTAbil9UOaLynttQj+iAzibCCLQRfstUM+ShJiqqP/y937p7gDuex5gBz5bByD23woDMA9ACeCAG8jkCLTis+8ZUhjCAisZOKvwySw/OoWONFWMrmv4ZsWAqX+wrXMGbLkwnMvgIowEIWuHTsV1CTKz978WeViA88IKDzRnA/Ts8TyCcUng7/+SngC2twFZJLBPljIB4IQ1wgA9waPM+rCfJApN9Tae1beOGZ1LO06CEKj7UbF9A7CVB7AShIa9R3Uf1gOwhF9V6S1iEEQFDqFN3my14IJEYNYRTANNERd+PZMMIsXXp7H8g198v68VgHf2uP9dBX5xAtvbgaUUqEqCg/1HKweAlx9vsLeGIlqxchWojCyqY1RCgXK5jxGHofIsD9B+V92nSAgIxCEkgLEGBU8mAaO4PgoVmEJbOQQG1CzIs+08Msg6kAwRzJBOlgiWf/SLRgewksCq8l0YAKBveQAgBGb/t4vDhJQmAwf4a9dQeZPWnJbiHMfgOYeNlAKlx3BFOxs3L6B+LySS8EUg6rzwuEgQ3luBGugDqx/lCzyCGPbtCBBi05M9Io2OFB4hEXgmGLMgzZDEjIvYruUf/0I7BGgkAJWAbY46SUArGThMyAIZVADH2ppEkiCBir2n5xmpu5ME1I5pUH+LYEnFICKEDpiFEADPSSu0JhQX/MphTBFBIYnI3MRjgLviLs48H9OR/JNf4IcAK9bxPwoV9TerAXgj4T0BOJk9MhAQDZOfACUCNgIy0zbTJpPZpyGAQwTiKug7AYkr0L+N991Vf00gpGyHINbK3yZVMQQwVT2xEMh1BEZ/Nvk1EKsKmgXyGeOeTQQdEf/TL3wggNX2b/H//jqwLRGo1gC0HMCeD9AlQPw+WDqZJEZIoCdaNY6OgOmFAVq5u7ae3Y9AHam7sd8kApUsZHaekclAvrv86eoBcwkZkFvrA1hf1wU4Cu4Btu1T/c8G/hWgrxDEmSFDc0D//OdDCEAqADoPIMnA7a8wrv6LpSEFfJlkoQtAdfKShEmAWlUDN7xgOYYE6DPuBY+Lv0W0HRXdK/cN2X6l0jqcsICubbx2AVeFAK7Sy+zV1YDiasAjgH6MvqZth+vXH6sksfyLn/eKAFaw6yoA5gEE9FYScDsZZfsR8CwhSJNb2Tq5UVLsQO0lE5Pk4bqRiBDU/oEcHFVn9X1T4dFZ6TKhYfWZcltqbm6HsZm6D07QKuGRcqQGgEUKSF5N2QySYPutbZkw4SmJwCIIJIXIYSz/8uf2BEDXAWAosN/w7gUhAHwhge7GY2wGBKFtf5oMGKgcl1Cx/wKwKKQY2hWB3oHbqver7ab6J8t/2L9VbaR6sM8auk4gArlRNbBchQnSaBw5RyV7lRCAgSYCerS/otRZwqiMmSECc7x/9XNUDkCvAyB5AAwDtrlBQgG8KegCOsvolQgrgPKcQKTQSReBhOCquBP3a8LTToXF/vpY8ls2J6AdBFH/rNJfov4YDoL6UzVP5gDc8MBJBFbBnwHrWW08EEcqrvhw+5oNBZZ//bMLBCDqb7kAcAJtUQeyOuQDcGIPnzFeJQClSbJqngBULW3xIzKpkBYe3wGxkISn/u5zASwccLbh5NHhht43ELsFcGeFXwfmA1UAdBsZ9YxU/ej+zDkwJ+RtO5Mkmhh9yc+637cKwJ79lxyAlP/kKcC1IqBzAJgL0K4AQwC0m7hgyAsBrAVEaL0HJU6SQKeiyT6dWictOwsTsqW+9ttosAax/pA3AKJBEqEhQLX+T+J2PG9GEIxEPPC6ag/SNzhOtm/fZo3JABYpfLT/KBFU+leUvxHNR37mSAAC/lYBUDkA76EgIYWOAHASKnXHm4/hwaB8pIxIV8oFFpxlziNws/0diSgF91bwuQQmE7QQ+2fUvwO+pf7KkXRA9db6W6QB1+KCHu1qMgTQE70DoTOG24/Y5qMuIEMOFYBXQ4FM++WjP2MnAFUClGTg5gCEAMhy4M4F7JNou/eZ0qBWELD7qO6D0uNkZXmEwKqb4HXI4wzAa8ejLTYSjb5mfXz8jgCvlP86YrhC/ZH4lfpSFU4SgAfMo88TZFxAlRgyY1aI4Iy2zQF87KfbBLCVAAP199YCaBJAV9AlnAxX0NqwnIBSrHSSziAPa/VeJt/ACMp0AY6l1+CNvofqb6h6NikoJMMUHN2apayZNt3YxRwAPa6Tb2iTXj4cVP2MwkdkUQFz5njsGt1tX/rTHghArwHY7P++DBhdwDanYCWgzgPIfh2TtfUB+6QcJhcBedfGUXoGwAaOyXhdKy4rC1rxPAtlymqfjP0x5h6ArVSdARJdiQa6BWC8t3h8RhQ616AnY+cEigRQdREWUZ1NDBnFz4I5Y+OroMf2y5f9VE4ACH50AS4B7OD28gDtxyEVgW6yOIQwWGlg/Uz8bQLXcBoa/AM56Dq8FcMbCTyx/o3ISF3fsvaMWPRv7JLEPht08nC4TyTDb5UNI1VnwO3coaHQFPBKxa0QwAO/G1LAucwA+2oHkDkny2Vs27/8pygCANUXF9D+h2CdC1CA334rcQf7Z7yxsp8qiFpBOKhPQAiW6jIlN9UdzllAKQBjdtxT9eF8HJLQ5xNae6Lska1nSu+pfyMjb3GOlxwEYrHANwA6sO/abdBxyRiPAf4ZoGf6WOA9y0Es/+YnAwHs4JfsP4v/JSEoTgD/is1veYFZEsB+xAp7gDEX0yRU2asQaHX2wD8QjEEsCDKt0pZqM2LpSqaiiNpteCW7mQSgukc4UTWxsH0Z8EaKT/erRGIW/E/pAo6AOdt35+Pxvwf/t0gA8BKQFfzZMiDmAYakoJ4oUB2gE4UtHDLiYQSa9bnsDEhJj4HfdBYHF/V4Vn8gvh3sh9Rfk60ot7c9Uf+Xc80AkDnCNGng+RrnzCa/RS6Z8zXBJDv0ORnf9bHY96Pbov7LV/ykMQfQrQMgVQABvP67//60BKgXA7UTU9Z/mDgk+TeAndjrBtpCBcEF9Wz23on7j1p9TW74mzaH4jgC/Vtri20uDdakzvIDbTL0y1I9Gx+V8CJHgNeTBfIMEXhjz5LDU5HB8pU/ccwByBOAXQ6AxP9sQVBL5EJGF8uByPYDCehJE1UGAuB7JKD3MadA22iFx9DCiPPpeZAFOZWyH46Jk2cDPiZFRX1IvI7XrMdg2fsOvCRsYGMM25QadgC8KAeQIg5BblAajOL26v5Z4DPrb6m95wKWf/cTxhwAPgJskQAu/aUhAIB5+22J9aelQa0uOuFFQoRBCY2Soc4PNBDBMQVAGJ50amqVI8kYOH4F3FTZsyU9EvuLMs4q/NBP3SNT1Y2FPQyQcs0RYYT7JxYTZQgiAmoE/Ki/8E80DgO+RQYe8Nvx/v2P3wng9updALgAyEoEYrY/ejS4katyBegG2OfOEqpSX7s4K0QohgVUpSft+5VgR7BFsb/nEkxScByD/s31pB2IIOMSIETRE9YLF0wiOGMtwcUu4EoyyIAe79uyEsDwIhAsBSrrT6sAuyJ0i4KU6p9CAkpl9boBNuHT7iCw9vThJBJfe8erKrt2IZZjoWSIcTkLCTwVt6oC6nojwLKYvuoWIsUf1DsZRljn7m3PAPcMBY/GqIK8YU/IHTYs/+HHKQLYAd+tBCQkMIQA7L0AQAxo8bbjI1MXPiOIqMJNOgIEly4HmvsUIaUA7oQ0tD/LuBsAzTqC7XosUnAy/MwBZADtKTl1fjhB2aT19j9RCHAGOWTGyII/Gyos//HHAgEo5c8kAbv4X6m+lRDEmy73EtViSEA5pcFOIVTSMHIEAgTLVuvVceXVeFWwO3F+ByIW5zuxv1ZRRqL6d2TK64E1Y/9dIiDWfVB3veqPEcEThAARcDNgPKtNdC6Dw/lPP+Z+fxcWAOHbgM2FQKDsQ/wP+7TSo+qzsiAqk1apLmGoVUor4kTpcCCDALzZen1EQpbNp+QEjgNdiZWxN8t4pCKQUXeLOChZOFacEoFxTmzsYRIjEZwQAnjjRwCL7Hu0PxofLnVc1IM7gzxGE96vWgkAHwUWF8AWAuGDQOyhIAQ/KwPu+9t5KmVvJwXtMHSgE9BQfU0g7oMy2g4byb9ZMFtkwUCMhNDtJ2VDDVoNLBoSEBLpQBYB18kPpElkv9HM1XRzwFB85gzw2BaArX4uoRRAFYG7up+RQYYgKm5i+aof/RACiPK39wAAEbB3ArSq3v4Bl//qpcAa8Nt3QhAM7N0FE7DTSWc4goEUAAwm8Ky1CNYCG69syWr/BJBWLkArvWflL1H/iDwE2I6dH0hKJkeyYtCRFYCThSdZYLuEwo6hCGwGlE9FBsNx//OP2gkAwwBJBBoVgK4SsE8KyQWwuJ8RAoIdCQJvpMXqVnlQA3z4TpRdjsHA1IEo6hss7JFzQQDQYwaE0AHAUmMrSWgAmJKomuRH7D8DmOVWGMAjgHb7T8oBeORR2XcFOcyMyfps2776C/ocwPr7df8rkEMC23xS/0uQLgVm3IBOAHYni1ldneHVcSMJKdbJEYYOQU7BDR+M8VMZeQZUY1tHVNYxlQJnQgJNKNbk9tzGAFovx0CWDXurDkPF1+MVcgBZhzDbbgaoVWdQsftNaIHcNwLQIYCQgCh9SwaC2jfgQ/lPg92qAnQnokIB6gCUcrlVAqNsZqqco+xMtTM2/FTwVxyBofAsvGGgNe25UxqskgxV+ETIkCaCAgFEzkLmqdXuqZ1ARBam6gMAl6/5kSoEUPYfwa/fBNSeBQBi2MZW7wRox8skBgnYTUfgKLeA11O4KDk3gJ0pWzI00BOYxuhOeU9fhwXWqdg/Io7MfuJKKNhBfRrAJisAFJgH1wF4oPYAF4HxyP6oLwN6xhls/f7Lj7jf5dHf9hdeBNoRgJH5L4UB+2TSpBDmBADsCG5U9izYq+Sg25uKqqsJhnJ64JdrcC13Mfan14tAdDL76MhM0qmOFdh2fRxGJBZQoycKI7BkQZ5tFx0v2h+BPw30BrhXH7bweCOA/eWf+kUgFvjxKcChGqAAbuYADCLQ4N5O14j9I/DjftcGe1UDpn7Ogh2LhCrHfyzw098Hwews/aVkkMzkD8qd7JciggNJQItUjoC0CuAjxMLOMzz3r/3h4ADgLcDM+ktOwKwC4HJg9ZmV/RoXWaGBUv1TiYABO8ofWLHwRDLPBd8JCn8quLMWPeMkiPozK5/dNpBCkAPIgnwWiLP9QqAqBc8of6rN1/3wh4VA8gRg9AxARwI7iFgJUCcAKwlBFg50lQIdDoCbMC1rpYKQrBygW+kUMcjkR+CsxvHus/sReCPQRvsR0A74rPCBnXtK6ZVTsdzgYwK+ovaVthE5zCi/8MnydZ+vQgC1AIiFARveINHnJQMbNlHlAbDbiTj7NBmUiYCoNqsiDBNUT+YjoHaSh3Lz3BDBcivedkaSjvqa8X2ypBe+QEQBVl9vBHrmCCi4H7EKcJban00GFcJYvv6H9UlA+i4AXAuAZT/1WWf/LdXv8G6VAQkxlMHPMsJFJ3CJylugstTaU2FPdT3wZpQ9UZ4LiYvU/TswJ1xDRsWZ88v0a0oIFjtDNt7YEQCPEEc0dnX/AwGQ2P9oDkDCAvld9XdP9dEV4I3tbpaenMZ3V2lIn0yCSlv0wyTh1Nkz9p6ppxVGoFU2VV/UOqn+6NKiMbtzdQgmcgRv1P/hJlXdw/C7/dcfajsAifeFDESU27MB+wa5jzoUaOB3LD4SA4v9NVF4LgAnd3ehgeozAHugHianEx6wCR+FG2YeA294whVQYtjvWQRUMw9BlDIkG7b6j4VmVrusOp9s/y0ncJX6R+POAD4kiI0A4L8BQ+Uf3gfg2H/2MBBTfdP+C7vAzdaPAFfIwLSERHVoIoqUBjNKm3EDGVIwx8kAOFLuaL86hkkkxcU/jDgrSh8CUhG9B6iMzc+0iUB7xO6H4EWszLqBb/ghJARgTwKytwI7OYAhBHBcQDYckOtlTmFYABIA3XILbCEJ3QaE1ampsRItHTbsF+mqqpUryCzZzYA/QzJJN+ICPLFqLwPCI/F/aXy5N4YjiRT6akB7BGmd2/INP/ghBGjJPwL+1QnIfGf2X8CuQ4GGEZXoO9UFEOdwhAxYDiCtXE79ngKh2t7LFWTAHwAbSTEKEby2kaqznEHUJ6XmCUJJjaPUdFbFK4CvtI2IprJ/+caVAHQSkD0ObL0MxCgJbnNNqb7+XlX+KATYLlwdky4NZVaRxY/ZcMGLZwNHkCaXCPwZ1bbOBZXNyS0wkJruSKmll1w9CsrHdACzZOBdYwWwYj7CcAhcijf+8o0/KHYAkgzs/u4Trqm+/g7gKYUDRNG7F4jKhTlAbz+SbgNjdz+g0S5yA0wFO5AQAnHVzwOoZ/vPAn8yMeclKSMlPwOspm1nhO2oeRZEM+0qgH8q9d/O8ZtWAig4AMGQuRDIWQ48JAUBkO3eRcDWuQSi+pETQOBSdpxQ/kjJI7IYljkrVXaBlajpZxbqeGrOQEDzGqA8OoywfvdqHP5+IICznEKFSDJOYhjvm35g0QEkFwIh2Bm4w3AgcAJ6MrV5R+y9BpcmCFQl+oOz8MByE0qNu/EK4UDkJBihWHF7Bvz4m5jAJct+I8Wn+6+I1a8YE0k4+OwBtaLwlbYZwIfjrQQwrP4jK/82+6+2y8q/IQmolR2SiNvvqFUc3x/A9jOwESfAgB6BnxGJFR6E9tWbhJ499ey9FUbIhDT6ejadAjwKMbSVtkgxY7kvAOuZjwFn1fvq0CACeAhucGPycejzzT9gdABYERheCLqDUQhh+0qeC2iYNcBvWf4wMWgQhE7+CdHoC04TAlFy0zkY6+41udAJkyANar8JKVIHEBFEspYfOZLIxofkmSEOr82B+H9WvWcIoALaStuILNj+bdtKAF4JUKu+uQpQx/5AFKj6NBwQeiLOYCCxKEegCELb++GHcCoCA2taYHXU0IrtXTJhjsd5kKcDpziDBEEgQZkkg+MBWVigiYjA/T3gZofjGI4kC+azwTszXgTaqwlgHX/5ls97tRRYVL2tADRCgUH1yYKgDofE4nc4VqDG/EGbE0ZiziMIF/yGYlCHYJEKKzviJLaOEWTbQ5CQpN9AAhcoP5JWGaBA8lmyKYHZI+FgldwMeLNhgncNlX0RWczufyAAWQqcjP2tCgACV+Z+t0RYAUmIpAOxEdtHTmDbTybBsHaAnIMmiuHmatcBk9m8iexcEgrqVgP2c6cxvFL+LMii2HkYJ5Er8H6TaeL4ANj/CKSPofiIowcH8P23COBGnwHQhOBVALxHg1l4kCED0mbIEVjqTIhk+4GT26dJIXAF0yGBQR4U6MR5ZNsNTkIRS0mVsa8ir+o4LnF4ZKvPYXKV3xWK/1o4gG/9/ioJKC8E9dyAAXaM75sDANDp+N8LA7p3CyjF1Y5B3xxKEsZ6AVo5SIDYZHMvGRUlqqLseLCSbzunpBVGMsy6hTA0icAWXf9sIjC45irZyPzKuJUjIH4KxR8cwLd+v50A1PMAmOzTnwXTYvkld7Bth5uM+9uBo3yAodKR8uP4HUEQ5dFtGYEM25QCDwQQqVAEzAgcQdx/JvipC4jICX50Cpxk/wzoorCkAsrM8WbHM0WCEGXU9qr9y0oAWwiglH8LCYz1/w3wqvznqr5BDhqsUwuEqg5BkUwHdgOI2yGsx02tHIHcaGd/pMQIbArMRF7hCGAwFMqAxWwTEdys+sO9zJzfjBuoKPVVba8lgGISsFsApElivyE45wdXADdNhwUdlkm8nnYCCeWXY+l439tecgvG5OxuZqSMjnPoJnwWYJETYUoenWOkaBP9M2C2yDML8my72fg/Am2FLKKxZvZvfb7t+77KAWxOwEj8NXUHp7DNb3QBCvwSAnSCq0MAQhiitugOcCzcbsX71qrAri9OXEY21nMGHUu9GnG4oQVncMg2Z8FPSDEFNMcVHemf6ssIidw3a6wsyM9oVwXhUQLwznkQMVIKbQRAV/45RKDJoAHcIQMhiwjUQwjQscer3hYh0BWBxhhCNCzej/ZZx9FuIsolHLbMFUWfAXIUviAY2ecKOUVjMTIoXH8EmAwhRSA/Cuoj/c255pHot33uQw6A5QFku5cLQGAjMSDmLCcw4BImixUaCDCZkntuwGtPCcABCx6nHBJkVDg7qSuvwEoAcQDIBPi9MTIAKyt59rcKyGWWHCr9IvJ4kv2NAII8gIC1Wwqs1wUAoi0yEABrx82UP+sGziCFDsgkHLDyBN1N80gjqCLg+CkQJOPqdn4BUOhEniENVJtE/2x8TduRa/IAmT1WBMSzxomO8yj7P/65r1YCotIPn0m8j28BFpVvwGdkoCRf2/gOd1k3MNgImIEEyBZZYEKJugVrHYEoi3EsTSzu5HEIZCCFyuQPnMIl4If7kgVMtt0hUkOCMj5XgVex7VM2XU3IlEAQxyPDdP0//n3GlYAh+FWs370OXBbbqWSfblNxAlbbsuUPyMLLBeA9YLafTZruB8+AO2vps+32650Flqem4b4T1d881oyreWICqJLL1e2XjQDkjUDkmX+d5WffEVeWE0CBNJU/qfq6f0eQBdVv/Qw1tdyCBWzGsDJGqBIZgiCAzjqK0kQ6A1hnjOGBNUEwIUmd5AAqxyndB0PFw7nkOAY9R5ePf+9XSUBGBAJudAVt234Ttn37xi4ESGyTE0rnAIBtBqwfAD/+Zl68r8nGdA3RykEsy2TtfJYkKsfWk+wM4GavJwnA2fj/CDCPgqzSPwoLov1HSOUVAeBKwGgtgJH80+AfbL8OC9A66Od0gFy0UiuCa+Sjt0cKboYQRGmHsR0w4vmGE0GRltk+AapuIlTbG9dcDh8mxpkCauL6wt/eUcojfY8AUiv0Wd+tc3ogAA/8xsKfDuykTVP2/YO1GlCLNnUCiii0Cpu7LUfgjUf2WTG/JgXLORwFtbkE2VLQRNKPTgiHjNKASBw7PZZ2J0Vnc+Q4ugsk6gAAG0BJREFUVVKKQH/muZxKCp/4Xv3DQGLn0fI3sEerAPVTghAaaFyllgcDi1Asq43t6yzwI2IIKgHiOFKWjZyjZ3XZBMuAOJqYbTJVwwuDfIb/l8FR2cy5VX6Ts0HmZdunz90i7eClJZnjZdoMv1EjAMcFbLiYAT+x8TpX0DCeAHPXxAA5XTug7YiW7on9NPYPwgLtEEKiSNjcTg2y4YSehCeBv+xUZid98ne5khCmwHaQDGeOGfVZVgKwqgAiiBH4U2XAfTCco1qxNcAZxiOAm+J/kSvwEoYU4Anl325ath0hr5BYNPDYq9Sr4LzY+reJfBZZVa/vhPYRGGf2Z/p4bZZPfM++CmCFAF4YIETR/upnApw3AqUJAQ4ShQPD/ovA3wjdANDwwxvKZbVjN45uSwI427eqnIywpsbIKOT7iAAy4Ix+p5kxMn2kzSsCCKoA+AiwJoOOAJTtF8vPSAK3NSFLhAJdPwLuTKiwHc8jhsx+1YaGBSRxJdeadQgWETBVTJNG0mVEE3TbXww9yg6lmPzL/gapawNSitpXgIdcF40783tlzmUd94EAEiVAuc8m+HWOoCH61fxAy19R/mplAElHicqrryeD3wM1fVkpm1gBkOgxHEV0gZA4VnpiFlQ5MzHNNoXjpM+9APBozKuI59BvpgAwJgE/B0KA6CWgrP7vZP4bWcBJZJYEI1FYQuzlAtw8gTFg2jXs12I+diz7gQA9tu/2GaRkOQvrfYapiZgNR6znyMn1zQCkpG7GOZfG0PenQAAZIM6cS2bcq9osnxAC0C6AgH14+Ie9EIQQwoY5FRo0HAbbKY5In3Yf2QtHEGVWiGEAVhHow1cHPHgeJnAZqAIll3GrSUdKBkdyBmQF41WTsxv3LMK6mAAe5bdwSKt6/AcCMEIAmevrbz88A7Dv1CofVQQ66w9ftAJrMdSuAHD46ucIiEGDeRDcKCwgB43KgZYa47l4biIav0QyybjfOufhWGcRiQHK7nivKQFUATcQ+Ylgnhl7+cT3sEOARgDO038dATjZ/w74AKTM9q05AScjBY8YEHRVy4/Kr4mEKZXbRnaSa/IAvR3HISk3CZkkr3AMOPeM3c2SiTtWAfyzgDyz3+xYZ/6e6XPoCMBZ9tuAboB8cALKIbT5x54H2CeVBrkGOHUFHjFQNlBJ6wnVZ+AWgogA3Fg6cVymuJ1zME/kYQdT0CwgXTUpEFdmUodtCgQQjrVf2NXtMuNn2lTu18x4rxyACgO8sp+n+ts+A+Rs+a+0Z1jFfXS/ASLLGQxjJEAYlgpn1FwdN0UazloDD6wR4aQVH4GTPP+ZCUkn/MmhxtWgsu7H7O9x5fkun/hsFQKw5B+AGsGfjfc9UrDIYjukmmjatlv4taoAFduvyccFWYJIvOSdFvIo7s8Avps0ScBaE606VoVUdFvL9byO4Inc2PvhnEcC2CfL+mf7p+P//ar1dgTsEA7AmJ1gFrZ36k36tXEjV8CshFwT3tEsqBPt2rDQNqX68GNl2kfEUQGmpcQR+VSOkQJIQf2vUMorxkxdd1R+hbl6aLzmAMhCnuEZAKPmrxW+EYAFcGtpsLM9dATgUrSiMvLQbSruYArQCaKIAJxyCjgxnGN6hGLuyy55npicFuEcJZSjAD7aPwvOK46TGfPBAej4nz3959T8B8VXYMR5aK4HIACOLD8DLZvzlp2nZiAB1G1+J9pVbD8jrdR6Awts5PymQL+Pf6j6EBCCNVHN/7iV/lgq6XkWCcn1k2NmwX2UxLLHyQBeLkPGXD7x3cccQGbdP1P9UPmt5CAAqiMLOVvD8re2XkjggHXASALUWfAzl4BzKLT0wblk+kdt0vuNc6lMbBPkhtU9tMpRgfUogGaApfmi8lsdPd9S/44ASLyPQEelZwlATQqIPU/56ctB1MtEGI61slP1NybvU4LfELBXmxMZfzZGxnGkQY8HgB9rxkVM9XkK0imqfYUYqgRYAnHBEelxXzkAJwcg4EOFz9p+5hSasBPlZuGCMgIPIkwmiN50RjWg+22zDsFxHRnwR21cEKtzjADvTUx0OzMgjsY2VbEI/iq4ps+L3JiKslfPszJ2pS2exwMBZHMA+8Re709HAGxxELTtnACgWZNIa5ew/APY9c0xngno+qlBXHxfDP7tBlaOwSZjsn+GFLZJciAMOUQYRQI4dKxHBvWVJDAz9vKJz4rXAYjidiHA/sPRtQDWE4LGOwIt1e+2KxvgEsD7DPyotNPqXwQNO84ApIkxI3IJwXryMcPjnUAAVeCd1f6MaxsJgNX9WXjgKbzlCIwyX7vn3jJhpZCUAGBjRBCKTzjukoraOlfbp04iooTk04mFic4I6QiwvQkvp+XlL44cewYkZwF0uDZ1D2Ztu76VR8ZZPv5ZDxpOwwDr+X9P4ZV9b66B2HodRmgXnHEGrc8Tgz98B4GF4wJp0Bud7B+BqDu9fcxMn6hNaT+5llL/IsnNkMNMn9eZUDYC0M/5I2jXzxqowzaw9l1bZzsCl1p9I1zQJCHkhffeVH+HJBgA9HwysZYE4TA/Z/sZziECi+clPAXOKg62y5xLFHJMjZFU2ciVnA30GRJ4jD7Lxz/zVQ5AwFVa/rt3osAv5gIQ3A+25OFuenbefV6AlBLZeBb4U/hMNSLQC8gonPyzx7Xq7gapyObwfKJx4SfIOJmzjveYQM78VlW7PktU2eseCSCI9wegW5Y/SQwakDpksPYLM1juofVTQHFxE71NKGkJQmyGDTyt9qsFGeCYo8N5ZcfJtnMnsvo9smNm2mWBUHU50bFnjvvYY67H6wiAvvLLyQPgk3xWqKCFRZSdAbdti5KBilws8YrcAd70cgxfJYtAYQPI97uPEog62DbxCmNGE7UKJjx2duwz2kVjXLl/hiAihzEz5isCCFYByhzRCj0A37H92xjE1neuwtmP/V1nQBYKWfMbQ40MCKvtD5EMO6ErgBqMGQGBnWa6z37sdPujoUYUipy4f9a+R0A/c9zl277bXgXYRQABjsDUIK0Anym7DiW0m2CCaS0ZHsggafuzYO6GSwCQNkn0CwnojDESYUwFjDjcTL9osVHZTTwigCMgvu77txCAEkCy7s9IAcHI3IIGNoJwIAV0ppmwYD+4xgn9HoCpAuIQl0aDsF9nH0J6KDWo2v5DKk86zxy/QjCZtq9Tm+hcrtq/EUCn9M4LQIYwYL+x5mpABUgK8H0jgmH47IC/U38Sl1fBnwV+GryzuYILwd+GTl5ENPmyzNONkzx2xg7PklP2ujLtHqtNdJxov3YljQBEibW1t7Y34CVW/Wngt3vv9MXxB4sPd5w5CBY+6PESTvihCUzU7JzF68uCwzrnSnKudCx1MZmJUxo/itWTP+bMeWX7PEW7s46ZGSdq00IA+uYfou4DkEG9vX2W7Weqz8gBccjcAQNPRfnNuUjcCQPB6a7BZIMqBI32SfBVjhZNtm6sxPFL48HglX5XtM2OeWa7zFhWm+VbP6NPAgrYXOX3VH8fwFT9qEqg+rvq76izRxQZfEVlQXcOJ4nDBdgZY6TZKoZ6ZpLFo4iq8JZHj1Htf1X7K8bNjDnTZiCAyPLPxvs4LnUEiaW/HaifCPyReEXEkSGfM22/nO82OaKTTyP4QMOLQo/M5NdnfXWf6viZ9pk263Vm2m0hwOoAUK3NxUCBsrvEkFH9YI1AN3+zFYHki0M6UBog8bCDYcth0SUHOgW3pwxyAPiJ9wvMjp6Z7Gzsx+pXPU62/RntGgFYyt/IQVnS9au3DwHL6vc6RIjWASDIBntvOMvsSkAPwBZuuu0HQBuNUwUFPd+LwZ+diFc4kPSxyQ/52H2rx6u0z7bV7ZZvkRyAEddr694BP3IFmXyAE/NHlt8iAv2fjXju1wJ/Cvhq4AzOzDZO58y4mXxClUxObX/4IvqzyU547xqOjnGkf7VvpX2p7bd8eCIJKIpLXAFTfq322jl0feCOee00qC2HYIHfUt408GFgb26n5v0JawVmiOVUgHuDpX6E+GwqEzseLRcnXz3OzDVV+3jtl5UAEKAIOhO40WO+mZifOA5KBEG7DuCJhUADIcDkZPPUJIQDil21/dP4KXYsNs9g46HNgYGrkz1/UucRwHrMo+c527/abwwBdgLoSIAou1bjSNU98jD/81Ct/t7/IyAuRPocAH9F9be2pEM0x+l+tTEag03u11H55Zy2yTZzURUUH2xbBVDmcEfGfOy+yzfrEMBaCrzfTAbsiBwyYcGg/oSEAOu9sKi2oe2fUP3WJQnacN4XbH84lp6VB9xJZoKn25RPPD3yaQ2PAC5zEkfHP9I/03cjAAbgAegHFv9YBMEsPyqsPgcNbNaWgb+bh4QsNLHgjWV9Q4IxZoZFIubxghmWcRWZSVrgj/xwb8Df/VYZMEY/7hVjPBAAgIIqvKHGkfJ3Y0UEsl99+L4AaQcoxLmm593Z4Gfz2pvrw76kg5giBXIiV+EwHDdsEE336/efAaiZszzzuEfHWr7508k7ARXIEMjMGZhKnnkpKGnDxhu2ESWfAX8K0Jn/ZwBmgjn3E7Y/i5uIWDITM3uszFgdYV01cPVEgvZHwXP0dK46fmXc5Zs+nZcBN8BFqn10v7H8V5NMZ7kTVYHBoicBTMkgqaqhC3AaRHiJ9m8TccJZeBM4dUw2wIHrjABVmdjkJ2nDV8eJzuus/VeelzX2RgCDwnuLghxV74CbedQ3Uy5MvBQkUn53P7odreIJUFnzvdueGKdq+b3xLwF2NqE/zRxnweiDNc6VpLD+Uo0AGnjBWg92f6dVur2yNFhA59h4nEfb5+T6fw2MCPxU9ZV8mG3UXKNzn1yjnqIRZtz9RXIpinaIplkiCgd+08D9Bc4ihuUbMQRQkzXrDBAv4UNBcllR+IDK/Ejgb5MZZnVEIJ7V9J4M9EAdEUI7ZqZhVrkzZJawFslTegPvR/gFMiSxEYBW2PX7oPIROWTe+JsIHzoygS/6fDTwjiq/Bv8s8BmJAOfR2x6BxnMW1dDBIyxrTkbnt/VzGqX6PwIgjhxCX0MGXEeO9xh912t4IIAo5nfAj2o0kAaqeDLb341hHNcDf/QEoAvsI8lCA4nW5D/iAE5558ABxR/O/SDCD3a/DCuZ83q/E8HyDZ/mVAF2pCEoKcizdj5DJEIaVfAnlgJXwT/lApxS3wzoM2DLTNSK8mfHE+UvtS/A9apxM6fwlMeW81vJ5WrnsREAA/W2LQHsVMyfGKez/gr8Q1ignEXm8V8PzFXXYIHJUmY2mWbIwPq/EvWEzkzeTJuQNMgg2XEzIJwJb6rjHgp7zjrYI43D3MryX8EBWHZ+VvUtEmGAbseAGUSPWwT/2apvglntOAv0bRwDWRnAXdYmM/BkEvKpgZm8tEeC7nWH6QhgRvVdkColt9rKcT1ioC4gsP0V8LttjUnMwFkBvjXJhu2EFGcBEk3saL8cN5uHmD3PaMpnzzMax9v/GMc4cn5n9N0IANXXBWnmPQCi0Enwb8AO2mbAXwFw1fJXiKQBxLg7FYJAR8aGiyboZfvVwNFxMhN1ZoyZPplzie5hZYzXve3y9RICEBAOZJAEdQnQxpiuG3DWBWA//RnJhu5TdyskFTIDKwBPtU2qfwQGb3/Ut/utEo0TTUxczPSd6ZMF5pVjZ88hanfkHDcCiAC7HSAqFQJthi4icAlU8YMyImPtAcAOmLBtCHzCHikwR6GEvtMnVxQY6ZFD2vMt8TDTjFN5yj5Xgisa29t/BNSV4y5f/6nj04ADABNZfI8kqJor5XcVPwF+D7RybimSgF/PHDNQ5YhAPCC2vkl3EYF6VvlpP7VxZpJW+lTasntbAYLVduYcKse9evzoXJav+9RX6wBkMnUKfgH4U+VFDcTkcmANCAR/SBIF8M+CPOUUCDnijZwB9UyfDlSJmZpo0s3HTPtMm7McRMkNRcgK9s9e18HDDt03AugArx7qMfftQ0XKP+MmvD4U4HguhDi8PpV9mfUGTJFToJdrMGaGNWHO2u46iYCQjgAwC4RsuyxRZoA0c8xo3CvGjI7p3dvla4kD2Dqom06JIOsOEs8A4A9jOZCzwV9yBKpxBtSZNt01JY5h3cwzicA7p84VZGZech1AFhjZdjPneYTIop+iet7ReGed60YAFuBc9T8R/IPiF2N+Rh6RWtM+xEmIw/EmlEckacA6KnsGuL0JaO5LJv2ykztqF+2fBXV23LNApcc5cnyPCM4Yd/kv6ACyoM62q7wSTD+BaDiQlAuYLBNSIBeAGRGBSQbkTlZAf0bb4dySbqQ62TOTNtPGDVkIarJjnkkCR45Z/V1nHMPa5xUBwEQ/TfnhF3DHJC8TYa7gKPhLqg8Hi4Bd3W9ZbDZhzgB3ZYx2bs7szUzsqM3R/Y/pBqJzPZM0HgP4eD0bAaTi/WxeoBDvD6SQIAzG/K1bslJgEUF3o48+XUhi32EiFev8WYKYAjzOPBCDSFkicHj7o75Zlc+MQy4vurS2vzp+9ryvtveZ81i+5lPGMiBT3zRJ7J3Tig9UHvVxHYC6SxmQm22csVwC2q8lcgTbGGRWHQF4tq83KbYxjNkegWAW6NG4mUk84wYyx50Zt3K+FgFUzu2o+9gIIALeVeBHuxmdQxb8VeAP48IAEZCn9zvHsCZQFuDZdvQ4CeWPJudTE0F0fjNOoDLmEQKoHmfmWjRhLF8dOQA1KVygFpKDrwP4B7IwgDkNdOYIDJBlgXt2O7wPenJEE3IG7DN9qhM9Ou8rx5slgMo5zzoT5hY2AjBBfTL48cfZhs6+OhzOvANtArBpR5AA5mEiIHc5GjPrCLLEcIXyW5O3uj07sTNgybTJgjU7Vna8KtEebe/1X/6z5QAmwT+AnL1g9CD4hTzcsMAiDba9mPCLQEv3G2RlTfoMoDNtvEnZ+quBZlR6Buwzx7lCvTMAz7SZIYDsuFlyZCrvnddGAIMDCMDfgbxCFIkKgUcg2q6m1X3/VWj7yTUD7Ec1iSHhLrJEcAT0dLIVKxHRRKwSQQSAq/dH15PdX2030z76LRj4oz7LV2kHQJRqIAgB1GOD31DRChF0bR3lM8GcKO91fYvuwmJr73y8yeQSRlL5zwL1rOJHk/jo/oxyR8e4GtDZ41fPoyeAQhKvVBk4Q/kD8FdIYLvhCTLxQozIAWzDBwCLQB3tj87BnQwTyl8hgkrbzKSNAHD1/gxJZNtkrhfVPLo2rfyV9hsBlMH8RMpfBjn8MpbyZ8asEEEbT/1GFZWOgB/tD13EBcpfBfwVbiCa+FfvrwA7OpfKWLNksZ7D8p8+lFwI9AS2H1U0A1Rp47YlwLTaTwF/7xSB9Oj+I+pfeX15SCYGyWYm5etGAhlQPmabqxwFjrsRgAaO+f0k5ccTcI+dBGuaHJLjReByCSNQ16PAj/qHgIUBKqrN2h7tH6ncFQQRgSoCeLQ/Gj+65gxxasufPSZrt/zHrAN4jcCfBjyG4RPPCZQdgAOuCLgeqUSEFIIeZt0VQD46pjeBryCBCMRX788CNjqPCplYx9wIIHQAB8GfVvwT3gNAgTQBflflme0l7qJCIDMgzwCvtQmcSZpECi82rTiECBTVsWbHi/pl9kdtzgT20bGW/xA5gNcc/K4bOAh8D8DdD3/kPygplhVLoL9Q+TPnESlUFdTV9rPOIgLw0f1HQRv9rjpE8I63EYDpAF5D8LuAP2j5o7GpSkMn/UNXvlfaZtxCa3Oh8lcAWWk7C9yzjpEFmAes2X3ZY2dIKNNm+feWA3hC8FeASNuS9QxZNbeOTfur38i6edkxI2BnVFc7kyPWPnO8yvhntI0m9WOSwBGQRy7g6P4skWwEMDiASfDjzTFdxX5m3f4CYCNyyCzwicZIkQUBv6fiFYWvtDVB9cjKnyWLqrqfBehZsM4CcbZfFrjR+BFRynGWf6cdwCT4GahSJBCAPwJrtx++6GOnQK3icVO5T3p+oAL0qG13fYScvImVAW/p+CoIzYxfPb8qkUSAuIIgZseMzjWzP9NmPb+NABpYXgPwlwAPE02vZjwT8BHJsMn7ZG6AzLoMAM9qU7H5Z6j7GWNkVLd6nCwAFVe2r5HCn7V/+crVAVSeAUALbyjhrPJ7LsIC9NaHKN4lDsBQVtMpOI7CIyg2ebxjzKr/DOgzfSok8NhtI2CeCfQjID3SN7pG3L985cvEOgAE/ZFXfSceCio7AMO1uIShriflFhySqQL2DMKgx0yofwbAnnupALYCpsx5PUaY8H4ILSoAjxzG8hUvi88C7Ee3VB5PjrZJuA02BgVp4EBSwM7E/cn1BBVV90A2tQ86RQCOCCuz/ygRZAF/lETOBLSnypXz9Igssy8igIp7WP7tTgAhcCfVuyOBE8DfLq4A/shVuERhAGsKpBeFBNH/gmRNqogoov2PRQJHj/MYJDBDDkeAPHs8fcxGAJaiVwHMwLZtS4Df7Kst+8HKgQX44fj7hizYz24XKbH8rmjzItAe3R+dU9WmZ53AB5UEZoE8228ggH+TdQAFADMgpQhGAZ0SAlHkSOGj/VZ4MRNCZPvMtuv6JQgqA9gqKWTBmAV3tl32uGcpvgWy6vZZpT8L5CgQlAA85a2qtwZ6RflDB5AEfwT4aL+21Fb7LIhn+kfAzfzHIhVgR22j8zmq/BVQZc61SgKV41fH9n6bWXI4q9/y5SoJiAMfBb9Xm7ccwXB8cQVE7QayIW8groI0s5KwOmYEHm9Cm/suUP+MEp/V5oiaV8B6VdsZEphR9Jk+FXLYCMAE0oTtb2OpCZoBq+kAjLFMsgDP4x33TOsfugohMnJuEUEM56lmRaSIV+/PnP8RwGfHrxzjyrZnksPlBPBlRhlwxrpnwW8CnWXJC0RymBCS5b4zwV5Wf+hwBNhH+lqW9rHdwVF1P9r/dQZ6ljiWlQC0SjIbPLRRilYFv0cC7Yc9WOrLAFWf94y9n+ljnZurdie8YnzquMS9PAUJHAVshqCs63oMsFeuzzvPaB8eZ/lS7QCU4jJVNckgUGurH1XuiVJfilSYFTdUtUIgR0nA67/tU7OjouBll2GEKVnQZ4EWXUPFps8es3KM15EEskoPt3T7KP02AojUO0UCk+CnoCWAzII7Au2w3yG8o6COzoUBioKCnKPrFBjJqRlQcQLVY2WJIjNuBaCvIwlUVX0G0NVjdATwMXEAAYBdEnhC8Ecgc/efGPNH5xFNdhOQRdt/ptpHCh3tj675CFE8JTFUjv2UriFz7GUlgOp/DNKRwUHwdxPfUeMjDoCCq5BfOOoEZvpr2x+BLavolXEyAM6obnTMzHEqoMuc09HxKv2rbTPAVYZO/ydUbXfkKP4/BnecprBuissAAAAASUVORK5CYII=", e }(), Ta.TextureTools = Ea, xa = $a || ($a = {}), Pa = function () { function e() { this._mode = e.FitFrustumSidesMode, this._radiusScale = 1, this._positionScale = .5, this._defaultElevation = .3, this._elevationReturnTime = 1500, this._elevationReturnWaitTime = 1e3, this._zoomStopsAnimation = !1, this._framingTime = 1500, this.autoCorrectCameraLimitsAndSensibility = !0, this._isPointerDown = !1, this._lastInteractionTime = -1 / 0, this._animatables = new Array, this._betaIsAnimating = !1 } return Object.defineProperty(e.prototype, "name", { get: function () { return "Framing" }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "mode", { get: function () { return this._mode }, set: function (e) { this._mode = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "radiusScale", { get: function () { return this._radiusScale }, set: function (e) { this._radiusScale = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "positionScale", { get: function () { return this._positionScale }, set: function (e) { this._positionScale = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "defaultElevation", { get: function () { return this._defaultElevation }, set: function (e) { this._defaultElevation = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "elevationReturnTime", { get: function () { return this._elevationReturnTime }, set: function (e) { this._elevationReturnTime = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "elevationReturnWaitTime", { get: function () { return this._elevationReturnWaitTime }, set: function (e) { this._elevationReturnWaitTime = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "zoomStopsAnimation", { get: function () { return this._zoomStopsAnimation }, set: function (e) { this._zoomStopsAnimation = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "framingTime", { get: function () { return this._framingTime }, set: function (e) { this._framingTime = e }, enumerable: !0, configurable: !0 }), e.prototype.init = function () { }, e.prototype.attach = function (t) { var i = this; this._attachedCamera = t; var r = this._attachedCamera.getScene(); e.EasingFunction.setEasingMode(e.EasingMode), this._onPrePointerObservableObserver = r.onPrePointerObservable.add(function (e) { e.type !== xa.PointerEventTypes.POINTERDOWN ? e.type === xa.PointerEventTypes.POINTERUP && (i._isPointerDown = !1) : i._isPointerDown = !0 }), this._onMeshTargetChangedObserver = t.onMeshTargetChangedObservable.add(function (e) { e && i.zoomOnMesh(e) }), this._onAfterCheckInputsObserver = t.onAfterCheckInputsObservable.add(function () { i._applyUserInteraction(), i._maintainCameraAboveGround() }) }, e.prototype.detach = function () { if (this._attachedCamera) { var e = this._attachedCamera.getScene(); this._onPrePointerObservableObserver && e.onPrePointerObservable.remove(this._onPrePointerObservableObserver), this._onAfterCheckInputsObserver && this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver), this._onMeshTargetChangedObserver && this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver), this._attachedCamera = null } }, e.prototype.zoomOnMesh = function (e, t, i) { void 0 === t && (t = !1), void 0 === i && (i = null), e.computeWorldMatrix(!0); var r = e.getBoundingInfo().boundingBox; this.zoomOnBoundingInfo(r.minimumWorld, r.maximumWorld, t, i) }, e.prototype.zoomOnMeshHierarchy = function (e, t, i) { void 0 === t && (t = !1), void 0 === i && (i = null), e.computeWorldMatrix(!0); var r = e.getHierarchyBoundingVectors(!0); this.zoomOnBoundingInfo(r.min, r.max, t, i) }, e.prototype.zoomOnMeshesHierarchy = function (e, t, i) { void 0 === t && (t = !1), void 0 === i && (i = null); for (var r = new xa.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), n = new xa.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), o = 0; o < e.length; o++) { var s = e[o].getHierarchyBoundingVectors(!0); xa.Tools.CheckExtends(s.min, r, n), xa.Tools.CheckExtends(s.max, r, n) } this.zoomOnBoundingInfo(r, n, t, i) }, e.prototype.zoomOnBoundingInfo = function (t, i, r, n) { var o, s = this; if (void 0 === r && (r = !1), void 0 === n && (n = null), this._attachedCamera) { var a = t.y, l = a + (i.y - a) * this._positionScale, c = i.subtract(t).scale(.5); if (r) o = new xa.Vector3(0, l, 0); else { var h = t.add(c); o = new xa.Vector3(h.x, l, h.z) } this._vectorTransition || (this._vectorTransition = xa.Animation.CreateAnimation("target", xa.Animation.ANIMATIONTYPE_VECTOR3, 60, e.EasingFunction)), this._betaIsAnimating = !0; var u = xa.Animation.TransitionTo("target", o, this._attachedCamera, this._attachedCamera.getScene(), 60, this._vectorTransition, this._framingTime); u && this._animatables.push(u); var d = 0; if (this._mode === e.FitFrustumSidesMode) { var f = this._calculateLowerRadiusFromModelBoundingSphere(t, i); this.autoCorrectCameraLimitsAndSensibility && (this._attachedCamera.lowerRadiusLimit = c.length() + this._attachedCamera.minZ), d = f } else this._mode === e.IgnoreBoundsSizeMode && (d = this._calculateLowerRadiusFromModelBoundingSphere(t, i), this.autoCorrectCameraLimitsAndSensibility && null === this._attachedCamera.lowerRadiusLimit && (this._attachedCamera.lowerRadiusLimit = this._attachedCamera.minZ)); if (this.autoCorrectCameraLimitsAndSensibility) { var p = i.subtract(t).length(); this._attachedCamera.panningSensibility = 5e3 / p, this._attachedCamera.wheelPrecision = 100 / d } this._radiusTransition || (this._radiusTransition = xa.Animation.CreateAnimation("radius", xa.Animation.ANIMATIONTYPE_FLOAT, 60, e.EasingFunction)), (u = xa.Animation.TransitionTo("radius", d, this._attachedCamera, this._attachedCamera.getScene(), 60, this._radiusTransition, this._framingTime, function () { s.stopAllAnimations(), n && n(), s._attachedCamera && s._attachedCamera.useInputToRestoreState && s._attachedCamera.storeState() })) && this._animatables.push(u) } }, e.prototype._calculateLowerRadiusFromModelBoundingSphere = function (t, i) { var r = i.subtract(t).length(), n = this._getFrustumSlope(), o = .5 * r * this._radiusScale, s = o * Math.sqrt(1 + 1 / (n.x * n.x)), a = o * Math.sqrt(1 + 1 / (n.y * n.y)), l = Math.max(s, a), c = this._attachedCamera; return c ? (c.lowerRadiusLimit && this._mode === e.IgnoreBoundsSizeMode && (l = l < c.lowerRadiusLimit ? c.lowerRadiusLimit : l), c.upperRadiusLimit && (l = l > c.upperRadiusLimit ? c.upperRadiusLimit : l), l) : 0 }, e.prototype._maintainCameraAboveGround = function () { var t = this; if (!(this._elevationReturnTime < 0)) { var i = xa.Tools.Now - this._lastInteractionTime, r = .5 * Math.PI - this._defaultElevation, n = .5 * Math.PI; if (this._attachedCamera && !this._betaIsAnimating && this._attachedCamera.beta > n && i >= this._elevationReturnWaitTime) { this._betaIsAnimating = !0, this.stopAllAnimations(), this._betaTransition || (this._betaTransition = xa.Animation.CreateAnimation("beta", xa.Animation.ANIMATIONTYPE_FLOAT, 60, e.EasingFunction)); var o = xa.Animation.TransitionTo("beta", r, this._attachedCamera, this._attachedCamera.getScene(), 60, this._betaTransition, this._elevationReturnTime, function () { t._clearAnimationLocks(), t.stopAllAnimations() }); o && this._animatables.push(o) } } }, e.prototype._getFrustumSlope = function () { var e = this._attachedCamera; if (!e) return xa.Vector2.Zero(); var t = e.getScene().getEngine().getAspectRatio(e), i = Math.tan(e.fov / 2), r = i * t; return new xa.Vector2(r, i) }, e.prototype._clearAnimationLocks = function () { this._betaIsAnimating = !1 }, e.prototype._applyUserInteraction = function () { this.isUserIsMoving && (this._lastInteractionTime = xa.Tools.Now, this.stopAllAnimations(), this._clearAnimationLocks()) }, e.prototype.stopAllAnimations = function () { for (this._attachedCamera && (this._attachedCamera.animations = []); this._animatables.length;)this._animatables[0] && (this._animatables[0].onAnimationEnd = null, this._animatables[0].stop()), this._animatables.shift() }, Object.defineProperty(e.prototype, "isUserIsMoving", { get: function () { return !!this._attachedCamera && (0 !== this._attachedCamera.inertialAlphaOffset || 0 !== this._attachedCamera.inertialBetaOffset || 0 !== this._attachedCamera.inertialRadiusOffset || 0 !== this._attachedCamera.inertialPanningX || 0 !== this._attachedCamera.inertialPanningY || this._isPointerDown) }, enumerable: !0, configurable: !0 }), e.EasingFunction = new xa.ExponentialEase, e.EasingMode = xa.EasingFunction.EASINGMODE_EASEINOUT, e.IgnoreBoundsSizeMode = 0, e.FitFrustumSidesMode = 1, e }(), xa.FramingBehavior = Pa, Aa = $a || ($a = {}), Sa = function () { function e() { this.transitionDuration = 450, this.lowerRadiusTransitionRange = 2, this.upperRadiusTransitionRange = -2, this._autoTransitionRange = !1, this._radiusIsAnimating = !1, this._radiusBounceTransition = null, this._animatables = new Array } return Object.defineProperty(e.prototype, "name", { get: function () { return "Bouncing" }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "autoTransitionRange", { get: function () { return this._autoTransitionRange }, set: function (e) { var t = this; if (this._autoTransitionRange !== e) { this._autoTransitionRange = e; var i = this._attachedCamera; i && (e ? this._onMeshTargetChangedObserver = i.onMeshTargetChangedObservable.add(function (e) { if (e) { e.computeWorldMatrix(!0); var i = e.getBoundingInfo().diagonalLength; t.lowerRadiusTransitionRange = .05 * i, t.upperRadiusTransitionRange = .05 * i } }) : this._onMeshTargetChangedObserver && i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver)) } }, enumerable: !0, configurable: !0 }), e.prototype.init = function () { }, e.prototype.attach = function (e) { var t = this; this._attachedCamera = e, this._onAfterCheckInputsObserver = e.onAfterCheckInputsObservable.add(function () { t._attachedCamera && (t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit) && t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange), t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit) && t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange)) }) }, e.prototype.detach = function () { this._attachedCamera && (this._onAfterCheckInputsObserver && this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver), this._onMeshTargetChangedObserver && this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver), this._attachedCamera = null) }, e.prototype._isRadiusAtLimit = function (e) { return !!this._attachedCamera && this._attachedCamera.radius === e && !this._radiusIsAnimating }, e.prototype._applyBoundRadiusAnimation = function (t) { var i = this; if (this._attachedCamera) { this._radiusBounceTransition || (e.EasingFunction.setEasingMode(e.EasingMode), this._radiusBounceTransition = Aa.Animation.CreateAnimation("radius", Aa.Animation.ANIMATIONTYPE_FLOAT, 60, e.EasingFunction)), this._cachedWheelPrecision = this._attachedCamera.wheelPrecision, this._attachedCamera.wheelPrecision = 1 / 0, this._attachedCamera.inertialRadiusOffset = 0, this.stopAllAnimations(), this._radiusIsAnimating = !0; var r = Aa.Animation.TransitionTo("radius", this._attachedCamera.radius + t, this._attachedCamera, this._attachedCamera.getScene(), 60, this._radiusBounceTransition, this.transitionDuration, function () { return i._clearAnimationLocks() }); r && this._animatables.push(r) } }, e.prototype._clearAnimationLocks = function () { this._radiusIsAnimating = !1, this._attachedCamera && (this._attachedCamera.wheelPrecision = this._cachedWheelPrecision) }, e.prototype.stopAllAnimations = function () { for (this._attachedCamera && (this._attachedCamera.animations = []); this._animatables.length;)this._animatables[0].onAnimationEnd = null, this._animatables[0].stop(), this._animatables.shift() }, e.EasingFunction = new Aa.BackEase(.3), e.EasingMode = Aa.EasingFunction.EASINGMODE_EASEOUT, e }(), Aa.BouncingBehavior = Sa, Ma = $a || ($a = {}), Ra = function () { function e() { this._zoomStopsAnimation = !1, this._idleRotationSpeed = .05, this._idleRotationWaitTime = 2e3, this._idleRotationSpinupTime = 2e3, this._isPointerDown = !1, this._lastFrameTime = null, this._lastInteractionTime = -1 / 0, this._cameraRotationSpeed = 0, this._lastFrameRadius = 0 } return Object.defineProperty(e.prototype, "name", { get: function () { return "AutoRotation" }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "zoomStopsAnimation", { get: function () { return this._zoomStopsAnimation }, set: function (e) { this._zoomStopsAnimation = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "idleRotationSpeed", { get: function () { return this._idleRotationSpeed }, set: function (e) { this._idleRotationSpeed = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "idleRotationWaitTime", { get: function () { return this._idleRotationWaitTime }, set: function (e) { this._idleRotationWaitTime = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "idleRotationSpinupTime", { get: function () { return this._idleRotationSpinupTime }, set: function (e) { this._idleRotationSpinupTime = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "rotationInProgress", { get: function () { return 0 < Math.abs(this._cameraRotationSpeed) }, enumerable: !0, configurable: !0 }), e.prototype.init = function () { }, e.prototype.attach = function (e) { var t = this; this._attachedCamera = e; var i = this._attachedCamera.getScene(); this._onPrePointerObservableObserver = i.onPrePointerObservable.add(function (e) { e.type !== Ma.PointerEventTypes.POINTERDOWN ? e.type === Ma.PointerEventTypes.POINTERUP && (t._isPointerDown = !1) : t._isPointerDown = !0 }), this._onAfterCheckInputsObserver = e.onAfterCheckInputsObservable.add(function () { var e = Ma.Tools.Now, i = 0; null != t._lastFrameTime && (i = e - t._lastFrameTime), t._lastFrameTime = e, t._applyUserInteraction(); var r = e - t._lastInteractionTime - t._idleRotationWaitTime, n = Math.max(Math.min(r / t._idleRotationSpinupTime, 1), 0); t._cameraRotationSpeed = t._idleRotationSpeed * n, t._attachedCamera && (t._attachedCamera.alpha -= t._cameraRotationSpeed * (i / 1e3)) }) }, e.prototype.detach = function () { if (this._attachedCamera) { var e = this._attachedCamera.getScene(); this._onPrePointerObservableObserver && e.onPrePointerObservable.remove(this._onPrePointerObservableObserver), this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver), this._attachedCamera = null } }, e.prototype._userIsZooming = function () { return !!this._attachedCamera && 0 !== this._attachedCamera.inertialRadiusOffset }, e.prototype._shouldAnimationStopForInteraction = function () { if (!this._attachedCamera) return !1; var e = !1; return this._lastFrameRadius === this._attachedCamera.radius && 0 !== this._attachedCamera.inertialRadiusOffset && (e = !0), this._lastFrameRadius = this._attachedCamera.radius, this._zoomStopsAnimation ? e : this._userIsZooming() }, e.prototype._applyUserInteraction = function () { this._userIsMoving() && !this._shouldAnimationStopForInteraction() && (this._lastInteractionTime = Ma.Tools.Now) }, e.prototype._userIsMoving = function () { return !!this._attachedCamera && (0 !== this._attachedCamera.inertialAlphaOffset || 0 !== this._attachedCamera.inertialBetaOffset || 0 !== this._attachedCamera.inertialRadiusOffset || 0 !== this._attachedCamera.inertialPanningX || 0 !== this._attachedCamera.inertialPanningY || this._isPointerDown) }, e }(), Ma.AutoRotationBehavior = Ra, function (e) { var t = function () { this.renderWidth = 512, this.renderHeight = 256, this.textureSize = 512, this.deterministicLockstep = !1, this.lockstepMaxSteps = 4 }; e.NullEngineOptions = t; var i = function (i) { function r(r) { void 0 === r && (r = new t); var n = i.call(this, null) || this; return void 0 === r.deterministicLockstep && (r.deterministicLockstep = !1), void 0 === r.lockstepMaxSteps && (r.lockstepMaxSteps = 4), n._options = r, n._caps = new e.EngineCapabilities, n._caps.maxTexturesImageUnits = 16, n._caps.maxVertexTextureImageUnits = 16, n._caps.maxTextureSize = 512, n._caps.maxCubemapTextureSize = 512, n._caps.maxRenderTextureSize = 512, n._caps.maxVertexAttribs = 16, n._caps.maxVaryingVectors = 16, n._caps.maxFragmentUniformVectors = 16, n._caps.maxVertexUniformVectors = 16, n._caps.standardDerivatives = !1, n._caps.astc = null, n._caps.s3tc = null, n._caps.pvrtc = null, n._caps.etc1 = null, n._caps.etc2 = null, n._caps.textureAnisotropicFilterExtension = null, n._caps.maxAnisotropy = 0, n._caps.uintIndices = !1, n._caps.fragmentDepthSupported = !1, n._caps.highPrecisionShaderSupported = !0, n._caps.colorBufferFloat = !1, n._caps.textureFloat = !1, n._caps.textureFloatLinearFiltering = !1, n._caps.textureFloatRender = !1, n._caps.textureHalfFloat = !1, n._caps.textureHalfFloatLinearFiltering = !1, n._caps.textureHalfFloatRender = !1, n._caps.textureLOD = !1, n._caps.drawBuffersExtension = !1, n._caps.depthTextureExtension = !1, n._caps.vertexArrayObject = !1, n._caps.instancedArrays = !1, e.Tools.Log("Babylon.js null engine (v" + e.Engine.Version + ") launched"), "undefined" == typeof URL && (URL = { createObjectURL: function () { }, revokeObjectURL: function () { } }), "undefined" == typeof Blob && (Blob = function () { }), n } return T(r, i), r.prototype.isDeterministicLockStep = function () { return this._options.deterministicLockstep }, r.prototype.getLockstepMaxSteps = function () { return this._options.lockstepMaxSteps }, r.prototype.getHardwareScalingLevel = function () { return 1 }, r.prototype.createVertexBuffer = function (e) { return { capacity: 0, references: 1, is32Bits: !1 } }, r.prototype.createIndexBuffer = function (e) { return { capacity: 0, references: 1, is32Bits: !1 } }, r.prototype.clear = function (e, t, i, r) { void 0 === r && (r = !1) }, r.prototype.getRenderWidth = function (e) { return void 0 === e && (e = !1), !e && this._currentRenderTarget ? this._currentRenderTarget.width : this._options.renderWidth }, r.prototype.getRenderHeight = function (e) { return void 0 === e && (e = !1), !e && this._currentRenderTarget ? this._currentRenderTarget.height : this._options.renderHeight }, r.prototype.setViewport = function (e, t, i) { this._cachedViewport = e }, r.prototype.createShaderProgram = function (e, t, i, r) { return { transformFeedback: null, __SPECTOR_rebuildProgram: null } }, r.prototype.getUniforms = function (e, t) { return [] }, r.prototype.getAttributes = function (e, t) { return [] }, r.prototype.bindSamplers = function (e) { this._currentEffect = null }, r.prototype.enableEffect = function (e) { (this._currentEffect = e).onBind && e.onBind(e), e._onBindObservable && e._onBindObservable.notifyObservers(e) }, r.prototype.setState = function (e, t, i, r) { void 0 === t && (t = 0), void 0 === r && (r = !1) }, r.prototype.setIntArray = function (e, t) { }, r.prototype.setIntArray2 = function (e, t) { }, r.prototype.setIntArray3 = function (e, t) { }, r.prototype.setIntArray4 = function (e, t) { }, r.prototype.setFloatArray = function (e, t) { }, r.prototype.setFloatArray2 = function (e, t) { }, r.prototype.setFloatArray3 = function (e, t) { }, r.prototype.setFloatArray4 = function (e, t) { }, r.prototype.setArray = function (e, t) { }, r.prototype.setArray2 = function (e, t) { }, r.prototype.setArray3 = function (e, t) { }, r.prototype.setArray4 = function (e, t) { }, r.prototype.setMatrices = function (e, t) { }, r.prototype.setMatrix = function (e, t) { }, r.prototype.setMatrix3x3 = function (e, t) { }, r.prototype.setMatrix2x2 = function (e, t) { }, r.prototype.setFloat = function (e, t) { }, r.prototype.setFloat2 = function (e, t, i) { }, r.prototype.setFloat3 = function (e, t, i, r) { }, r.prototype.setBool = function (e, t) { }, r.prototype.setFloat4 = function (e, t, i, r, n) { }, r.prototype.setColor3 = function (e, t) { }, r.prototype.setColor4 = function (e, t, i) { }, r.prototype.setAlphaMode = function (t, i) { void 0 === i && (i = !1), this._alphaMode !== t && (this._alphaState.alphaBlend = t !== e.Engine.ALPHA_DISABLE, i || this.setDepthWrite(t === e.Engine.ALPHA_DISABLE), this._alphaMode = t) }, r.prototype.bindBuffers = function (e, t, i) { }, r.prototype.wipeCaches = function (e) { this.preventCacheWipeBetweenFrames || (this.resetTextureCache(), this._currentEffect = null, e && (this._currentProgram = null, this._stencilState.reset(), this._depthCullingState.reset(), this._alphaState.reset()), this._cachedVertexBuffers = null, this._cachedIndexBuffer = null, this._cachedEffectForVertexBuffers = null) }, r.prototype.draw = function (e, t, i, r) { }, r.prototype.drawElementsType = function (e, t, i, r) { }, r.prototype.drawArraysType = function (e, t, i, r) { }, r.prototype._createTexture = function () { return {} }, r.prototype._releaseTexture = function (e) { }, r.prototype.createTexture = function (t, i, r, n, o, s, a, l, c, h) { void 0 === o && (o = e.Texture.TRILINEAR_SAMPLINGMODE), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === l && (l = null); var u = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_URL), d = String(t); return u.url = d, u.generateMipMaps = !i, u.samplingMode = o, u.invertY = r, u.baseWidth = this._options.textureSize, u.baseHeight = this._options.textureSize, u.width = this._options.textureSize, u.height = this._options.textureSize, h && (u.format = h), u.isReady = !0, s && s(), this._internalTexturesCache.push(u), u }, r.prototype.createRenderTargetTexture = function (t, i) { var r = new e.RenderTargetCreationOptions; void 0 !== i && "object" == typeof i ? (r.generateMipMaps = i.generateMipMaps, r.generateDepthBuffer = void 0 === i.generateDepthBuffer || i.generateDepthBuffer, r.generateStencilBuffer = r.generateDepthBuffer && i.generateStencilBuffer, r.type = void 0 === i.type ? e.Engine.TEXTURETYPE_UNSIGNED_INT : i.type, r.samplingMode = void 0 === i.samplingMode ? e.Texture.TRILINEAR_SAMPLINGMODE : i.samplingMode) : (r.generateMipMaps = i, r.generateDepthBuffer = !0, r.generateStencilBuffer = !1, r.type = e.Engine.TEXTURETYPE_UNSIGNED_INT, r.samplingMode = e.Texture.TRILINEAR_SAMPLINGMODE); var n = new e.InternalTexture(this, e.InternalTexture.DATASOURCE_RENDERTARGET), o = t.width || t, s = t.height || t; return n._depthStencilBuffer = {}, n._framebuffer = {}, n.baseWidth = o, n.baseHeight = s, n.width = o, n.height = s, n.isReady = !0, n.samples = 1, n.generateMipMaps = !!r.generateMipMaps, n.samplingMode = r.samplingMode, n.type = r.type, n._generateDepthBuffer = r.generateDepthBuffer, n._generateStencilBuffer = !!r.generateStencilBuffer, this._internalTexturesCache.push(n), n }, r.prototype.updateTextureSamplingMode = function (e, t) { t.samplingMode = e }, r.prototype.bindFramebuffer = function (e, t, i, r, n) { this._currentRenderTarget && this.unBindFramebuffer(this._currentRenderTarget), this._currentRenderTarget = e, this._currentFramebuffer = e._MSAAFramebuffer ? e._MSAAFramebuffer : e._framebuffer, this._cachedViewport && !n && this.setViewport(this._cachedViewport, i, r) }, r.prototype.unBindFramebuffer = function (e, t, i) { void 0 === t && (t = !1), this._currentRenderTarget = null, i && (e._MSAAFramebuffer && (this._currentFramebuffer = e._framebuffer), i()), this._currentFramebuffer = null }, r.prototype.createDynamicVertexBuffer = function (e) { return { capacity: 1, references: 1, is32Bits: !1 } }, r.prototype.updateDynamicTexture = function (e, t, i, r, n) { void 0 === r && (r = !1) }, r.prototype.getError = function () { return 0 }, r.prototype._getUnpackAlignement = function () { return 1 }, r.prototype._unpackFlipY = function (e) { }, r.prototype.updateDynamicIndexBuffer = function (e, t, i) { void 0 === i && (i = 0) }, r.prototype.updateDynamicVertexBuffer = function (e, t, i, r) { }, r.prototype._bindTextureDirectly = function (e, t) { return this._boundTexturesCache[this._activeChannel] !== t && (this._boundTexturesCache[this._activeChannel] = t, !0) }, r.prototype._bindTexture = function (e, t) { e < 0 || this._bindTextureDirectly(0, t) }, r.prototype._releaseBuffer = function (e) { return e.references-- , 0 === e.references }, r.prototype.releaseEffects = function () { }, r.prototype.displayLoadingUI = function () { }, r.prototype.hideLoadingUI = function () { }, r.prototype._uploadCompressedDataToTextureDirectly = function (e, t, i, r, n, o, s) { void 0 === o && (o = 0), void 0 === s && (s = 0) }, r.prototype._uploadDataToTextureDirectly = function (e, t, i, r) { void 0 === i && (i = 0), void 0 === r && (r = 0) }, r.prototype._uploadArrayBufferViewToTexture = function (e, t, i, r) { void 0 === i && (i = 0), void 0 === r && (r = 0) }, r.prototype._uploadImageToTexture = function (e, t, i, r) { void 0 === i && (i = 0), void 0 === r && (r = 0) }, r }(e.Engine); e.NullEngine = i }($a || ($a = {})), Ca = $a || ($a = {}), Oa = function () { function e(e) { this.engine = e, this._captureGPUFrameTime = !1, this._gpuFrameTime = new Ca.PerfCounter, this._captureShaderCompilationTime = !1, this._shaderCompilationTime = new Ca.PerfCounter, this._onBeginFrameObserver = null, this._onEndFrameObserver = null, this._onBeforeShaderCompilationObserver = null, this._onAfterShaderCompilationObserver = null } return Object.defineProperty(e.prototype, "gpuFrameTimeCounter", { get: function () { return this._gpuFrameTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureGPUFrameTime", { get: function () { return this._captureGPUFrameTime }, set: function (e) { var t = this; e !== this._captureGPUFrameTime && ((this._captureGPUFrameTime = e) ? (this._onBeginFrameObserver = this.engine.onBeginFrameObservable.add(function () { t._gpuFrameTimeToken || (t._gpuFrameTimeToken = t.engine.startTimeQuery()) }), this._onEndFrameObserver = this.engine.onEndFrameObservable.add(function () { if (t._gpuFrameTimeToken) { var e = t.engine.endTimeQuery(t._gpuFrameTimeToken); -1 < e && (t._gpuFrameTimeToken = null, t._gpuFrameTime.fetchNewFrame(), t._gpuFrameTime.addCount(e, !0)) } })) : (this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver), this._onBeginFrameObserver = null, this.engine.onEndFrameObservable.remove(this._onEndFrameObserver), this._onEndFrameObserver = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "shaderCompilationTimeCounter", { get: function () { return this._shaderCompilationTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureShaderCompilationTime", { get: function () { return this._captureShaderCompilationTime }, set: function (e) { var t = this; e !== this._captureShaderCompilationTime && ((this._captureShaderCompilationTime = e) ? (this._onBeforeShaderCompilationObserver = this.engine.onBeforeShaderCompilationObservable.add(function () { t._shaderCompilationTime.fetchNewFrame(), t._shaderCompilationTime.beginMonitoring() }), this._onAfterShaderCompilationObserver = this.engine.onAfterShaderCompilationObservable.add(function () { t._shaderCompilationTime.endMonitoring() })) : (this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver), this._onBeforeShaderCompilationObserver = null, this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver), this._onAfterShaderCompilationObserver = null)) }, enumerable: !0, configurable: !0 }), e.prototype.dispose = function () { this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver), this._onBeginFrameObserver = null, this.engine.onEndFrameObservable.remove(this._onEndFrameObserver), this._onEndFrameObserver = null, this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver), this._onBeforeShaderCompilationObserver = null, this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver), this._onAfterShaderCompilationObserver = null, this.engine = null }, e }(), Ca.EngineInstrumentation = Oa, Da = $a || ($a = {}), Ia = function () { function e(e) { var t = this; this.scene = e, this._captureActiveMeshesEvaluationTime = !1, this._activeMeshesEvaluationTime = new Da.PerfCounter, this._captureRenderTargetsRenderTime = !1, this._renderTargetsRenderTime = new Da.PerfCounter, this._captureFrameTime = !1, this._frameTime = new Da.PerfCounter, this._captureRenderTime = !1, this._renderTime = new Da.PerfCounter, this._captureInterFrameTime = !1, this._interFrameTime = new Da.PerfCounter, this._captureParticlesRenderTime = !1, this._particlesRenderTime = new Da.PerfCounter, this._captureSpritesRenderTime = !1, this._spritesRenderTime = new Da.PerfCounter, this._capturePhysicsTime = !1, this._physicsTime = new Da.PerfCounter, this._captureAnimationsTime = !1, this._animationsTime = new Da.PerfCounter, this._captureCameraRenderTime = !1, this._cameraRenderTime = new Da.PerfCounter, this._onBeforeActiveMeshesEvaluationObserver = null, this._onAfterActiveMeshesEvaluationObserver = null, this._onBeforeRenderTargetsRenderObserver = null, this._onAfterRenderTargetsRenderObserver = null, this._onAfterRenderObserver = null, this._onBeforeDrawPhaseObserver = null, this._onAfterDrawPhaseObserver = null, this._onBeforeAnimationsObserver = null, this._onBeforeParticlesRenderingObserver = null, this._onAfterParticlesRenderingObserver = null, this._onBeforeSpritesRenderingObserver = null, this._onAfterSpritesRenderingObserver = null, this._onBeforePhysicsObserver = null, this._onAfterPhysicsObserver = null, this._onAfterAnimationsObserver = null, this._onBeforeCameraRenderObserver = null, this._onAfterCameraRenderObserver = null, this._onBeforeAnimationsObserver = e.onBeforeAnimationsObservable.add(function () { t._captureActiveMeshesEvaluationTime && t._activeMeshesEvaluationTime.fetchNewFrame(), t._captureRenderTargetsRenderTime && t._renderTargetsRenderTime.fetchNewFrame(), t._captureFrameTime && (Da.Tools.StartPerformanceCounter("Scene rendering"), t._frameTime.beginMonitoring()), t._captureInterFrameTime && t._interFrameTime.endMonitoring(), t._captureParticlesRenderTime && t._particlesRenderTime.fetchNewFrame(), t._captureSpritesRenderTime && t._spritesRenderTime.fetchNewFrame(), t._captureAnimationsTime && t._animationsTime.beginMonitoring(), t.scene.getEngine()._drawCalls.fetchNewFrame(), t.scene.getEngine()._textureCollisions.fetchNewFrame() }), this._onAfterRenderObserver = e.onAfterRenderObservable.add(function () { t._captureFrameTime && (Da.Tools.EndPerformanceCounter("Scene rendering"), t._frameTime.endMonitoring()), t._captureRenderTime && t._renderTime.endMonitoring(!1), t._captureInterFrameTime && t._interFrameTime.beginMonitoring() }) } return Object.defineProperty(e.prototype, "activeMeshesEvaluationTimeCounter", { get: function () { return this._activeMeshesEvaluationTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureActiveMeshesEvaluationTime", { get: function () { return this._captureActiveMeshesEvaluationTime }, set: function (e) { var t = this; e !== this._captureActiveMeshesEvaluationTime && ((this._captureActiveMeshesEvaluationTime = e) ? (this._onBeforeActiveMeshesEvaluationObserver = this.scene.onBeforeActiveMeshesEvaluationObservable.add(function () { Da.Tools.StartPerformanceCounter("Active meshes evaluation"), t._activeMeshesEvaluationTime.beginMonitoring() }), this._onAfterActiveMeshesEvaluationObserver = this.scene.onAfterActiveMeshesEvaluationObservable.add(function () { Da.Tools.EndPerformanceCounter("Active meshes evaluation"), t._activeMeshesEvaluationTime.endMonitoring() })) : (this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver), this._onBeforeActiveMeshesEvaluationObserver = null, this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver), this._onAfterActiveMeshesEvaluationObserver = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "renderTargetsRenderTimeCounter", { get: function () { return this._renderTargetsRenderTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureRenderTargetsRenderTime", { get: function () { return this._captureRenderTargetsRenderTime }, set: function (e) { var t = this; e !== this._captureRenderTargetsRenderTime && ((this._captureRenderTargetsRenderTime = e) ? (this._onBeforeRenderTargetsRenderObserver = this.scene.onBeforeRenderTargetsRenderObservable.add(function () { Da.Tools.StartPerformanceCounter("Render targets rendering"), t._renderTargetsRenderTime.beginMonitoring() }), this._onAfterRenderTargetsRenderObserver = this.scene.onAfterRenderTargetsRenderObservable.add(function () { Da.Tools.EndPerformanceCounter("Render targets rendering"), t._renderTargetsRenderTime.endMonitoring(!1) })) : (this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver), this._onBeforeRenderTargetsRenderObserver = null, this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver), this._onAfterRenderTargetsRenderObserver = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "particlesRenderTimeCounter", { get: function () { return this._particlesRenderTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureParticlesRenderTime", { get: function () { return this._captureParticlesRenderTime }, set: function (e) { var t = this; e !== this._captureParticlesRenderTime && ((this._captureParticlesRenderTime = e) ? (this._onBeforeParticlesRenderingObserver = this.scene.onBeforeParticlesRenderingObservable.add(function () { Da.Tools.StartPerformanceCounter("Particles"), t._particlesRenderTime.beginMonitoring() }), this._onAfterParticlesRenderingObserver = this.scene.onAfterParticlesRenderingObservable.add(function () { Da.Tools.EndPerformanceCounter("Particles"), t._particlesRenderTime.endMonitoring(!1) })) : (this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver), this._onBeforeParticlesRenderingObserver = null, this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver), this._onAfterParticlesRenderingObserver = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "spritesRenderTimeCounter", { get: function () { return this._spritesRenderTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureSpritesRenderTime", { get: function () { return this._captureSpritesRenderTime }, set: function (e) { var t = this; e !== this._captureSpritesRenderTime && (this._captureSpritesRenderTime = e, this.scene.spriteManagers && (e ? (this._onBeforeSpritesRenderingObserver = this.scene.onBeforeSpritesRenderingObservable.add(function () { Da.Tools.StartPerformanceCounter("Sprites"), t._spritesRenderTime.beginMonitoring() }), this._onAfterSpritesRenderingObserver = this.scene.onAfterSpritesRenderingObservable.add(function () { Da.Tools.EndPerformanceCounter("Sprites"), t._spritesRenderTime.endMonitoring(!1) })) : (this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver), this._onBeforeSpritesRenderingObserver = null, this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver), this._onAfterSpritesRenderingObserver = null))) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "physicsTimeCounter", { get: function () { return this._physicsTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "capturePhysicsTime", { get: function () { return this._capturePhysicsTime }, set: function (e) { var t = this; e !== this._capturePhysicsTime && this.scene.onBeforePhysicsObservable && ((this._capturePhysicsTime = e) ? (this._onBeforePhysicsObserver = this.scene.onBeforePhysicsObservable.add(function () { Da.Tools.StartPerformanceCounter("Physics"), t._physicsTime.beginMonitoring() }), this._onAfterPhysicsObserver = this.scene.onAfterPhysicsObservable.add(function () { Da.Tools.EndPerformanceCounter("Physics"), t._physicsTime.endMonitoring() })) : (this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver), this._onBeforePhysicsObserver = null, this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver), this._onAfterPhysicsObserver = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "animationsTimeCounter", { get: function () { return this._animationsTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureAnimationsTime", { get: function () { return this._captureAnimationsTime }, set: function (e) { var t = this; e !== this._captureAnimationsTime && ((this._captureAnimationsTime = e) ? this._onAfterAnimationsObserver = this.scene.onAfterAnimationsObservable.add(function () { t._animationsTime.endMonitoring() }) : (this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver), this._onAfterAnimationsObserver = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "frameTimeCounter", { get: function () { return this._frameTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureFrameTime", { get: function () { return this._captureFrameTime }, set: function (e) { this._captureFrameTime = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "interFrameTimeCounter", { get: function () { return this._interFrameTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureInterFrameTime", { get: function () { return this._captureInterFrameTime }, set: function (e) { this._captureInterFrameTime = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "renderTimeCounter", { get: function () { return this._renderTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureRenderTime", { get: function () { return this._captureRenderTime }, set: function (e) { var t = this; e !== this._captureRenderTime && ((this._captureRenderTime = e) ? (this._onBeforeDrawPhaseObserver = this.scene.onBeforeDrawPhaseObservable.add(function () { t._renderTime.beginMonitoring(), Da.Tools.StartPerformanceCounter("Main render") }), this._onAfterDrawPhaseObserver = this.scene.onAfterDrawPhaseObservable.add(function () { t._renderTime.endMonitoring(!1), Da.Tools.EndPerformanceCounter("Main render") })) : (this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver), this._onBeforeDrawPhaseObserver = null, this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver), this._onAfterDrawPhaseObserver = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "cameraRenderTimeCounter", { get: function () { return this._cameraRenderTime }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "captureCameraRenderTime", { get: function () { return this._captureCameraRenderTime }, set: function (e) { var t = this; e !== this._captureCameraRenderTime && ((this._captureCameraRenderTime = e) ? (this._onBeforeCameraRenderObserver = this.scene.onBeforeCameraRenderObservable.add(function (e) { t._cameraRenderTime.beginMonitoring(), Da.Tools.StartPerformanceCounter("Rendering camera " + e.name) }), this._onAfterCameraRenderObserver = this.scene.onAfterCameraRenderObservable.add(function (e) { t._cameraRenderTime.endMonitoring(!1), Da.Tools.EndPerformanceCounter("Rendering camera " + e.name) })) : (this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver), this._onBeforeCameraRenderObserver = null, this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver), this._onAfterCameraRenderObserver = null)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "drawCallsCounter", { get: function () { return this.scene.getEngine()._drawCalls }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "textureCollisionsCounter", { get: function () { return this.scene.getEngine()._textureCollisions }, enumerable: !0, configurable: !0 }), e.prototype.dispose = function () { this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver), this._onAfterRenderObserver = null, this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver), this._onBeforeActiveMeshesEvaluationObserver = null, this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver), this._onAfterActiveMeshesEvaluationObserver = null, this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver), this._onBeforeRenderTargetsRenderObserver = null, this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver), this._onAfterRenderTargetsRenderObserver = null, this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver), this._onBeforeAnimationsObserver = null, this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver), this._onBeforeParticlesRenderingObserver = null, this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver), this._onAfterParticlesRenderingObserver = null, this._onBeforeSpritesRenderingObserver && (this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver), this._onBeforeSpritesRenderingObserver = null), this._onAfterSpritesRenderingObserver && (this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver), this._onAfterSpritesRenderingObserver = null), this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver), this._onBeforeDrawPhaseObserver = null, this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver), this._onAfterDrawPhaseObserver = null, this._onBeforePhysicsObserver && (this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver), this._onBeforePhysicsObserver = null), this._onAfterPhysicsObserver && (this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver), this._onAfterPhysicsObserver = null), this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver), this._onAfterAnimationsObserver = null, this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver), this._onBeforeCameraRenderObserver = null, this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver), this._onAfterCameraRenderObserver = null, this.scene = null }, e }(), Da.SceneInstrumentation = Ia, wa = function () { this._timeElapsedQueryEnded = !1 }, ($a || ($a = {}))._TimeToken = wa, La = $a || ($a = {}), Fa = function (e) { function t() { var t = e.call(this) || this; return t.DIFFUSE = !1, t.DIFFUSEDIRECTUV = 0, t.GAMMADIFFUSE = !1, t.DIFFUSEHASALPHA = !1, t.OPACITYFRESNEL = !1, t.REFLECTIONBLUR = !1, t.REFLECTIONFRESNEL = !1, t.REFLECTIONFALLOFF = !1, t.TEXTURELODSUPPORT = !1, t.PREMULTIPLYALPHA = !1, t.USERGBCOLOR = !1, t.USEHIGHLIGHTANDSHADOWCOLORS = !1, t.NOISE = !1, t.REFLECTIONBGR = !1, t.IMAGEPROCESSING = !1, t.VIGNETTE = !1, t.VIGNETTEBLENDMODEMULTIPLY = !1, t.VIGNETTEBLENDMODEOPAQUE = !1, t.TONEMAPPING = !1, t.TONEMAPPING_ACES = !1, t.CONTRAST = !1, t.COLORCURVES = !1, t.COLORGRADING = !1, t.COLORGRADING3D = !1, t.SAMPLER3DGREENDEPTH = !1, t.SAMPLER3DBGRMAP = !1, t.IMAGEPROCESSINGPOSTPROCESS = !1, t.EXPOSURE = !1, t.REFLECTION = !1, t.REFLECTIONMAP_3D = !1, t.REFLECTIONMAP_SPHERICAL = !1, t.REFLECTIONMAP_PLANAR = !1, t.REFLECTIONMAP_CUBIC = !1, t.REFLECTIONMAP_PROJECTION = !1, t.REFLECTIONMAP_SKYBOX = !1, t.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1, t.REFLECTIONMAP_EXPLICIT = !1, t.REFLECTIONMAP_EQUIRECTANGULAR = !1, t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1, t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1, t.INVERTCUBICMAP = !1, t.REFLECTIONMAP_OPPOSITEZ = !1, t.LODINREFLECTIONALPHA = !1, t.GAMMAREFLECTION = !1, t.RGBDREFLECTION = !1, t.EQUIRECTANGULAR_RELFECTION_FOV = !1, t.MAINUV1 = !1, t.MAINUV2 = !1, t.UV1 = !1, t.UV2 = !1, t.CLIPPLANE = !1, t.CLIPPLANE2 = !1, t.CLIPPLANE3 = !1, t.CLIPPLANE4 = !1, t.POINTSIZE = !1, t.FOG = !1, t.NORMAL = !1, t.NUM_BONE_INFLUENCERS = 0, t.BonesPerMesh = 0, t.INSTANCES = !1, t.SHADOWFLOAT = !1, t.rebuild(), t } return T(t, e), t }(La.MaterialDefines), Ba = function (e) { function t(t, i) { var r = e.call(this, t, i) || this; return r.primaryColor = La.Color3.White(), r._primaryColorShadowLevel = 0, r._primaryColorHighlightLevel = 0, r.reflectionTexture = null, r.reflectionBlur = 0, r.diffuseTexture = null, r._shadowLights = null, r.shadowLights = null, r.shadowLevel = 0, r.sceneCenter = La.Vector3.Zero(), r.opacityFresnel = !0, r.reflectionFresnel = !1, r.reflectionFalloffDistance = 0, r.reflectionAmount = 1, r.reflectionReflectance0 = .05, r.reflectionReflectance90 = .5, r.useRGBColor = !0, r.enableNoise = !1, r._fovMultiplier = 1, r.useEquirectangularFOV = !1, r._maxSimultaneousLights = 4, r.maxSimultaneousLights = 4, r._imageProcessingObserver = null, r.switchToBGR = !1, r._renderTargets = new La.SmartArray(16), r._reflectionControls = La.Vector4.Zero(), r._white = La.Color3.White(), r._primaryShadowColor = La.Color3.Black(), r._primaryHighlightColor = La.Color3.Black(), r._attachImageProcessingConfiguration(null), r.getRenderTargetTextures = function () { return r._renderTargets.reset(), r._diffuseTexture && r._diffuseTexture.isRenderTarget && r._renderTargets.push(r._diffuseTexture), r._reflectionTexture && r._reflectionTexture.isRenderTarget && r._renderTargets.push(r._reflectionTexture), r._renderTargets }, r } return T(t, e), Object.defineProperty(t.prototype, "_perceptualColor", { get: function () { return this.__perceptualColor }, set: function (e) { this.__perceptualColor = e, this._computePrimaryColorFromPerceptualColor(), this._markAllSubMeshesAsLightsDirty() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "primaryColorShadowLevel", { get: function () { return this._primaryColorShadowLevel }, set: function (e) { this._primaryColorShadowLevel = e, this._computePrimaryColors(), this._markAllSubMeshesAsLightsDirty() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "primaryColorHighlightLevel", { get: function () { return this._primaryColorHighlightLevel }, set: function (e) { this._primaryColorHighlightLevel = e, this._computePrimaryColors(), this._markAllSubMeshesAsLightsDirty() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "reflectionStandardFresnelWeight", { set: function (e) { var i = e; i < .5 ? (i *= 2, this.reflectionReflectance0 = t.StandardReflectance0 * i, this.reflectionReflectance90 = t.StandardReflectance90 * i) : (i = 2 * i - 1, this.reflectionReflectance0 = t.StandardReflectance0 + (1 - t.StandardReflectance0) * i, this.reflectionReflectance90 = t.StandardReflectance90 + (1 - t.StandardReflectance90) * i) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "fovMultiplier", { get: function () { return this._fovMultiplier }, set: function (e) { isNaN(e) && (e = 1), this._fovMultiplier = Math.max(0, Math.min(2, e)) }, enumerable: !0, configurable: !0 }), t.prototype._attachImageProcessingConfiguration = function (e) { var t = this; e !== this._imageProcessingConfiguration && (this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), this._imageProcessingConfiguration = e || this.getScene().imageProcessingConfiguration, this._imageProcessingConfiguration && (this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add(function (e) { t._computePrimaryColorFromPerceptualColor(), t._markAllSubMeshesAsImageProcessingDirty() }))) }, Object.defineProperty(t.prototype, "imageProcessingConfiguration", { get: function () { return this._imageProcessingConfiguration }, set: function (e) { this._attachImageProcessingConfiguration(e), this._markAllSubMeshesAsTexturesDirty() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraColorCurvesEnabled", { get: function () { return this.imageProcessingConfiguration.colorCurvesEnabled }, set: function (e) { this.imageProcessingConfiguration.colorCurvesEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraColorGradingEnabled", { get: function () { return this.imageProcessingConfiguration.colorGradingEnabled }, set: function (e) { this.imageProcessingConfiguration.colorGradingEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraToneMappingEnabled", { get: function () { return this._imageProcessingConfiguration.toneMappingEnabled }, set: function (e) { this._imageProcessingConfiguration.toneMappingEnabled = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraExposure", { get: function () { return this._imageProcessingConfiguration.exposure }, set: function (e) { this._imageProcessingConfiguration.exposure = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraContrast", { get: function () { return this._imageProcessingConfiguration.contrast }, set: function (e) { this._imageProcessingConfiguration.contrast = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraColorGradingTexture", { get: function () { return this._imageProcessingConfiguration.colorGradingTexture }, set: function (e) { this.imageProcessingConfiguration.colorGradingTexture = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "cameraColorCurves", { get: function () { return this.imageProcessingConfiguration.colorCurves }, set: function (e) { this.imageProcessingConfiguration.colorCurves = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "hasRenderTargetTextures", { get: function () { return !(!this._diffuseTexture || !this._diffuseTexture.isRenderTarget) || !(!this._reflectionTexture || !this._reflectionTexture.isRenderTarget) }, enumerable: !0, configurable: !0 }), t.prototype.needAlphaTesting = function () { return !0 }, t.prototype.needAlphaBlending = function () { return this.alpha < 0 || null != this._diffuseTexture && this._diffuseTexture.hasAlpha }, t.prototype.isReadyForSubMesh = function (e, t, i) { var r = this; if (void 0 === i && (i = !1), t.effect && this.isFrozen && this._wasPreviouslyReady) return !0; t._materialDefines || (t._materialDefines = new Fa); var n = this.getScene(), o = t._materialDefines; if (!this.checkReadyOnEveryCall && t.effect && o._renderId === n.getRenderId()) return !0; var s = n.getEngine(); if (La.MaterialHelper.PrepareDefinesForLights(n, e, o, !1, this._maxSimultaneousLights), o._needNormals = !0, o._areTexturesDirty) { if (o._needUVs = !1, n.texturesEnabled) { if (n.getEngine().getCaps().textureLOD && (o.TEXTURELODSUPPORT = !0), this._diffuseTexture && La.StandardMaterial.DiffuseTextureEnabled) { if (!this._diffuseTexture.isReadyOrNotBlocking()) return !1; La.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture, o, "DIFFUSE"), o.DIFFUSEHASALPHA = this._diffuseTexture.hasAlpha, o.GAMMADIFFUSE = this._diffuseTexture.gammaSpace, o.OPACITYFRESNEL = this._opacityFresnel } else o.DIFFUSE = !1, o.DIFFUSEHASALPHA = !1, o.GAMMADIFFUSE = !1, o.OPACITYFRESNEL = !1; var a = this._reflectionTexture; if (a && La.StandardMaterial.ReflectionTextureEnabled) { if (!a.isReadyOrNotBlocking()) return !1; switch (o.REFLECTION = !0, o.GAMMAREFLECTION = a.gammaSpace, o.RGBDREFLECTION = a.isRGBD, o.REFLECTIONBLUR = 0 < this._reflectionBlur, o.REFLECTIONMAP_OPPOSITEZ = this.getScene().useRightHandedSystem ? !a.invertZ : a.invertZ, o.LODINREFLECTIONALPHA = a.lodLevelInAlpha, o.EQUIRECTANGULAR_RELFECTION_FOV = this.useEquirectangularFOV, o.REFLECTIONBGR = this.switchToBGR, a.coordinatesMode === La.Texture.INVCUBIC_MODE && (o.INVERTCUBICMAP = !0), o.REFLECTIONMAP_3D = a.isCube, a.coordinatesMode) { case La.Texture.EXPLICIT_MODE: o.REFLECTIONMAP_EXPLICIT = !0; break; case La.Texture.PLANAR_MODE: o.REFLECTIONMAP_PLANAR = !0; break; case La.Texture.PROJECTION_MODE: o.REFLECTIONMAP_PROJECTION = !0; break; case La.Texture.SKYBOX_MODE: o.REFLECTIONMAP_SKYBOX = !0, o.REFLECTIONMAP_SKYBOX_TRANSFORMED = !a.getReflectionTextureMatrix().isIdentity(); break; case La.Texture.SPHERICAL_MODE: o.REFLECTIONMAP_SPHERICAL = !0; break; case La.Texture.EQUIRECTANGULAR_MODE: o.REFLECTIONMAP_EQUIRECTANGULAR = !0; break; case La.Texture.FIXED_EQUIRECTANGULAR_MODE: o.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !0; break; case La.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE: o.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !0; break; case La.Texture.CUBIC_MODE: case La.Texture.INVCUBIC_MODE: default: o.REFLECTIONMAP_CUBIC = !0 }this.reflectionFresnel ? (o.REFLECTIONFRESNEL = !0, o.REFLECTIONFALLOFF = 0 < this.reflectionFalloffDistance, this._reflectionControls.x = this.reflectionAmount, this._reflectionControls.y = this.reflectionReflectance0, this._reflectionControls.z = this.reflectionReflectance90, this._reflectionControls.w = 1 / this.reflectionFalloffDistance) : (o.REFLECTIONFRESNEL = !1, o.REFLECTIONFALLOFF = !1) } else o.REFLECTION = !1, o.REFLECTIONFRESNEL = !1, o.REFLECTIONFALLOFF = !1, o.REFLECTIONBLUR = !1, o.REFLECTIONMAP_3D = !1, o.REFLECTIONMAP_SPHERICAL = !1, o.REFLECTIONMAP_PLANAR = !1, o.REFLECTIONMAP_CUBIC = !1, o.REFLECTIONMAP_PROJECTION = !1, o.REFLECTIONMAP_SKYBOX = !1, o.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1, o.REFLECTIONMAP_EXPLICIT = !1, o.REFLECTIONMAP_EQUIRECTANGULAR = !1, o.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1, o.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1, o.INVERTCUBICMAP = !1, o.REFLECTIONMAP_OPPOSITEZ = !1, o.LODINREFLECTIONALPHA = !1, o.GAMMAREFLECTION = !1, o.RGBDREFLECTION = !1 } o.PREMULTIPLYALPHA = this.alphaMode === La.Engine.ALPHA_PREMULTIPLIED || this.alphaMode === La.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF, o.USERGBCOLOR = this._useRGBColor, o.NOISE = this._enableNoise } if (o._areLightsDirty && (o.USEHIGHLIGHTANDSHADOWCOLORS = !this._useRGBColor && (0 !== this._primaryColorShadowLevel || 0 !== this._primaryColorHighlightLevel)), o._areImageProcessingDirty && this._imageProcessingConfiguration) { if (!this._imageProcessingConfiguration.isReady()) return !1; this._imageProcessingConfiguration.prepareDefines(o) } if (La.MaterialHelper.PrepareDefinesForMisc(e, n, !1, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e), o), La.MaterialHelper.PrepareDefinesForFrameBoundValues(n, s, o, i), La.MaterialHelper.PrepareDefinesForAttributes(e, o, !1, !0, !1) && e && (n.getEngine().getCaps().standardDerivatives || e.isVerticesDataPresent(La.VertexBuffer.NormalKind) || (e.createNormals(!0), La.Tools.Warn("BackgroundMaterial: Normals have been created for the mesh: " + e.name))), o.isDirty) { o.markAsProcessed(), n.resetCachedMaterial(); var l = new La.EffectFallbacks; o.FOG && l.addFallback(0, "FOG"), o.POINTSIZE && l.addFallback(1, "POINTSIZE"), La.MaterialHelper.HandleFallbacksForShadows(o, l, this._maxSimultaneousLights), 0 < o.NUM_BONE_INFLUENCERS && l.addCPUSkinningFallback(0, e); var c = [La.VertexBuffer.PositionKind]; o.NORMAL && c.push(La.VertexBuffer.NormalKind), o.UV1 && c.push(La.VertexBuffer.UVKind), o.UV2 && c.push(La.VertexBuffer.UV2Kind), La.MaterialHelper.PrepareAttributesForBones(c, e, o, l), La.MaterialHelper.PrepareAttributesForInstances(c, o); var h = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vFogInfos", "vFogColor", "pointSize", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "mBones", "vPrimaryColor", "vPrimaryColorShadow", "vReflectionInfos", "reflectionMatrix", "vReflectionMicrosurfaceInfos", "fFovMultiplier", "shadowLevel", "alpha", "vBackgroundCenter", "vReflectionControl", "vDiffuseInfos", "diffuseMatrix"], u = ["diffuseSampler", "reflectionSampler", "reflectionSamplerLow", "reflectionSamplerHigh"], d = ["Material", "Scene"]; La.ImageProcessingConfiguration && (La.ImageProcessingConfiguration.PrepareUniforms(h, o), La.ImageProcessingConfiguration.PrepareSamplers(u, o)), La.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: h, uniformBuffersNames: d, samplers: u, defines: o, maxSimultaneousLights: this._maxSimultaneousLights }); var f = o.toString(); t.setEffect(n.getEngine().createEffect("background", { attributes: c, uniformsNames: h, uniformBuffersNames: d, samplers: u, defines: f, fallbacks: l, onCompiled: function (e) { r.onCompiled && r.onCompiled(e), r.bindSceneUniformBuffer(e, n.getSceneUniformBuffer()) }, onError: this.onError, indexParameters: { maxSimultaneousLights: this._maxSimultaneousLights } }, s), o), this.buildUniformLayout() } return !(!t.effect || !t.effect.isReady()) && (o._renderId = n.getRenderId(), this._wasPreviouslyReady = !0) }, t.prototype._computePrimaryColorFromPerceptualColor = function () { this.__perceptualColor && (this._primaryColor.copyFrom(this.__perceptualColor), this._primaryColor.toLinearSpaceToRef(this._primaryColor), this._imageProcessingConfiguration && this._primaryColor.scaleToRef(1 / this._imageProcessingConfiguration.exposure, this._primaryColor), this._computePrimaryColors()) }, t.prototype._computePrimaryColors = function () { 0 === this._primaryColorShadowLevel && 0 === this._primaryColorHighlightLevel || (this._primaryColor.scaleToRef(this._primaryColorShadowLevel, this._primaryShadowColor), this._primaryColor.subtractToRef(this._primaryShadowColor, this._primaryShadowColor), this._white.subtractToRef(this._primaryColor, this._primaryHighlightColor), this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel, this._primaryHighlightColor), this._primaryColor.addToRef(this._primaryHighlightColor, this._primaryHighlightColor)) }, t.prototype.buildUniformLayout = function () { this._uniformBuffer.addUniform("vPrimaryColor", 4), this._uniformBuffer.addUniform("vPrimaryColorShadow", 4), this._uniformBuffer.addUniform("vDiffuseInfos", 2), this._uniformBuffer.addUniform("vReflectionInfos", 2), this._uniformBuffer.addUniform("diffuseMatrix", 16), this._uniformBuffer.addUniform("reflectionMatrix", 16), this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos", 3), this._uniformBuffer.addUniform("fFovMultiplier", 1), this._uniformBuffer.addUniform("pointSize", 1), this._uniformBuffer.addUniform("shadowLevel", 1), this._uniformBuffer.addUniform("alpha", 1), this._uniformBuffer.addUniform("vBackgroundCenter", 3), this._uniformBuffer.addUniform("vReflectionControl", 4), this._uniformBuffer.create() }, t.prototype.unbind = function () { this._diffuseTexture && this._diffuseTexture.isRenderTarget && this._uniformBuffer.setTexture("diffuseSampler", null), this._reflectionTexture && this._reflectionTexture.isRenderTarget && this._uniformBuffer.setTexture("reflectionSampler", null), e.prototype.unbind.call(this) }, t.prototype.bindOnlyWorldMatrix = function (e) { this._activeEffect.setMatrix("world", e) }, t.prototype.bindForSubMesh = function (e, t, i) { var r = this.getScene(), n = i._materialDefines; if (n) { var o = i.effect; if (o) { this._activeEffect = o, this.bindOnlyWorldMatrix(e), La.MaterialHelper.BindBonesParameters(t, this._activeEffect); var s = this._mustRebind(r, o, t.visibility); if (s) { this._uniformBuffer.bindToEffect(o, "Material"), this.bindViewProjection(o); var a = this._reflectionTexture; this._uniformBuffer.useUbo && this.isFrozen && this._uniformBuffer.isSync || (r.texturesEnabled && (this._diffuseTexture && La.StandardMaterial.DiffuseTextureEnabled && (this._uniformBuffer.updateFloat2("vDiffuseInfos", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level), La.MaterialHelper.BindTextureMatrix(this._diffuseTexture, this._uniformBuffer, "diffuse")), a && La.StandardMaterial.ReflectionTextureEnabled && (this._uniformBuffer.updateMatrix("reflectionMatrix", a.getReflectionTextureMatrix()), this._uniformBuffer.updateFloat2("vReflectionInfos", a.level, this._reflectionBlur), this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos", a.getSize().width, a.lodGenerationScale, a.lodGenerationOffset))), 0 < this.shadowLevel && this._uniformBuffer.updateFloat("shadowLevel", this.shadowLevel), this._uniformBuffer.updateFloat("alpha", this.alpha), this.pointsCloud && this._uniformBuffer.updateFloat("pointSize", this.pointSize), n.USEHIGHLIGHTANDSHADOWCOLORS ? (this._uniformBuffer.updateColor4("vPrimaryColor", this._primaryHighlightColor, 1), this._uniformBuffer.updateColor4("vPrimaryColorShadow", this._primaryShadowColor, 1)) : this._uniformBuffer.updateColor4("vPrimaryColor", this._primaryColor, 1)), this._uniformBuffer.updateFloat("fFovMultiplier", this._fovMultiplier), r.texturesEnabled && (this._diffuseTexture && La.StandardMaterial.DiffuseTextureEnabled && this._uniformBuffer.setTexture("diffuseSampler", this._diffuseTexture), a && La.StandardMaterial.ReflectionTextureEnabled && (n.REFLECTIONBLUR && n.TEXTURELODSUPPORT ? this._uniformBuffer.setTexture("reflectionSampler", a) : n.REFLECTIONBLUR ? (this._uniformBuffer.setTexture("reflectionSampler", a._lodTextureMid || a), this._uniformBuffer.setTexture("reflectionSamplerLow", a._lodTextureLow || a), this._uniformBuffer.setTexture("reflectionSamplerHigh", a._lodTextureHigh || a)) : this._uniformBuffer.setTexture("reflectionSampler", a), n.REFLECTIONFRESNEL && (this._uniformBuffer.updateFloat3("vBackgroundCenter", this.sceneCenter.x, this.sceneCenter.y, this.sceneCenter.z), this._uniformBuffer.updateFloat4("vReflectionControl", this._reflectionControls.x, this._reflectionControls.y, this._reflectionControls.z, this._reflectionControls.w)))), La.MaterialHelper.BindClipPlane(this._activeEffect, r), La.MaterialHelper.BindEyePosition(o, r) } !s && this.isFrozen || (r.lightsEnabled && La.MaterialHelper.BindLights(r, t, this._activeEffect, n, this._maxSimultaneousLights, !1), this.bindView(o), La.MaterialHelper.BindFogParameters(r, t, this._activeEffect, !0), this._imageProcessingConfiguration && this._imageProcessingConfiguration.bind(this._activeEffect)), this._uniformBuffer.update(), this._afterBind(t, this._activeEffect) } } }, t.prototype.dispose = function (t, i) { void 0 === t && (t = !1), void 0 === i && (i = !1), i && (this.diffuseTexture && this.diffuseTexture.dispose(), this.reflectionTexture && this.reflectionTexture.dispose()), this._renderTargets.dispose(), this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), e.prototype.dispose.call(this, t) }, t.prototype.clone = function (e) { var i = this; return La.SerializationHelper.Clone(function () { return new t(e, i.getScene()) }, this) }, t.prototype.serialize = function () { var e = La.SerializationHelper.Serialize(this); return e.customType = "BABYLON.BackgroundMaterial", e }, t.prototype.getClassName = function () { return "BackgroundMaterial" }, t.Parse = function (e, i, r) { return La.SerializationHelper.Parse(function () { return new t(e.name, i) }, e, i, r) }, t.StandardReflectance0 = .05, t.StandardReflectance90 = .5, b([La.serializeAsColor3()], t.prototype, "_primaryColor", void 0), b([La.expandToProperty("_markAllSubMeshesAsLightsDirty")], t.prototype, "primaryColor", void 0), b([La.serializeAsColor3()], t.prototype, "__perceptualColor", void 0), b([La.serialize()], t.prototype, "_primaryColorShadowLevel", void 0), b([La.serialize()], t.prototype, "_primaryColorHighlightLevel", void 0), b([La.expandToProperty("_markAllSubMeshesAsLightsDirty")], t.prototype, "primaryColorHighlightLevel", null), b([La.serializeAsTexture()], t.prototype, "_reflectionTexture", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionTexture", void 0), b([La.serialize()], t.prototype, "_reflectionBlur", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionBlur", void 0), b([La.serializeAsTexture()], t.prototype, "_diffuseTexture", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "diffuseTexture", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "shadowLights", void 0), b([La.serialize()], t.prototype, "_shadowLevel", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "shadowLevel", void 0), b([La.serializeAsVector3()], t.prototype, "_sceneCenter", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "sceneCenter", void 0), b([La.serialize()], t.prototype, "_opacityFresnel", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "opacityFresnel", void 0), b([La.serialize()], t.prototype, "_reflectionFresnel", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionFresnel", void 0), b([La.serialize()], t.prototype, "_reflectionFalloffDistance", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionFalloffDistance", void 0), b([La.serialize()], t.prototype, "_reflectionAmount", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionAmount", void 0), b([La.serialize()], t.prototype, "_reflectionReflectance0", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionReflectance0", void 0), b([La.serialize()], t.prototype, "_reflectionReflectance90", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionReflectance90", void 0), b([La.serialize()], t.prototype, "_useRGBColor", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useRGBColor", void 0), b([La.serialize()], t.prototype, "_enableNoise", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "enableNoise", void 0), b([La.serialize()], t.prototype, "_maxSimultaneousLights", void 0), b([La.expandToProperty("_markAllSubMeshesAsTexturesDirty")], t.prototype, "maxSimultaneousLights", void 0), b([La.serializeAsImageProcessingConfiguration()], t.prototype, "_imageProcessingConfiguration", void 0), t }(La.PushMaterial), La.BackgroundMaterial = Ba, tl = this && this.__assign || function () { return (tl = Object.assign || function (e) { for (var t, i = 1, r = arguments.length; i < r; i++)for (var n in t = arguments[i]) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]); return e }).apply(this, arguments) }, Na = $a || ($a = {}), Va = function () { function e(t, i) { var r = this; this._errorHandler = function (e, t) { r.onErrorObservable.notifyObservers({ message: e, exception: t }) }, this._options = tl({}, e._getDefaultOptions(), t), this._scene = i, this.onErrorObservable = new Na.Observable, this._setupBackground(), this._setupImageProcessing() } return e._getDefaultOptions = function () { return { createGround: !0, groundSize: 15, groundTexture: this._groundTextureCDNUrl, groundColor: new Na.Color3(.2, .2, .3).toLinearSpace().scale(3), groundOpacity: .9, enableGroundShadow: !0, groundShadowLevel: .5, enableGroundMirror: !1, groundMirrorSizeRatio: .3, groundMirrorBlurKernel: 64, groundMirrorAmount: 1, groundMirrorFresnelWeight: 1, groundMirrorFallOffDistance: 0, groundMirrorTextureType: Na.Engine.TEXTURETYPE_UNSIGNED_INT, groundYBias: 1e-5, createSkybox: !0, skyboxSize: 20, skyboxTexture: this._skyboxTextureCDNUrl, skyboxColor: new Na.Color3(.2, .2, .3).toLinearSpace().scale(3), backgroundYRotation: 0, sizeAuto: !0, rootPosition: Na.Vector3.Zero(), setupImageProcessing: !0, environmentTexture: this._environmentTextureCDNUrl, cameraExposure: .8, cameraContrast: 1.2, toneMappingEnabled: !0 } }, Object.defineProperty(e.prototype, "rootMesh", { get: function () { return this._rootMesh }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "skybox", { get: function () { return this._skybox }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "skyboxTexture", { get: function () { return this._skyboxTexture }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "skyboxMaterial", { get: function () { return this._skyboxMaterial }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "ground", { get: function () { return this._ground }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "groundTexture", { get: function () { return this._groundTexture }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "groundMirror", { get: function () { return this._groundMirror }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "groundMirrorRenderList", { get: function () { return this._groundMirror ? this._groundMirror.renderList : null }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "groundMaterial", { get: function () { return this._groundMaterial }, enumerable: !0, configurable: !0 }), e.prototype.updateOptions = function (e) { var t = tl({}, this._options, e); this._ground && !t.createGround && (this._ground.dispose(), this._ground = null), this._groundMaterial && !t.createGround && (this._groundMaterial.dispose(), this._groundMaterial = null), this._groundTexture && this._options.groundTexture != t.groundTexture && (this._groundTexture.dispose(), this._groundTexture = null), this._skybox && !t.createSkybox && (this._skybox.dispose(), this._skybox = null), this._skyboxMaterial && !t.createSkybox && (this._skyboxMaterial.dispose(), this._skyboxMaterial = null), this._skyboxTexture && this._options.skyboxTexture != t.skyboxTexture && (this._skyboxTexture.dispose(), this._skyboxTexture = null), this._groundMirror && !t.enableGroundMirror && (this._groundMirror.dispose(), this._groundMirror = null), this._scene.environmentTexture && this._options.environmentTexture != t.environmentTexture && this._scene.environmentTexture.dispose(), this._options = t, this._setupBackground(), this._setupImageProcessing() }, e.prototype.setMainColor = function (e) { this.groundMaterial && (this.groundMaterial.primaryColor = e), this.skyboxMaterial && (this.skyboxMaterial.primaryColor = e), this.groundMirror && (this.groundMirror.clearColor = new Na.Color4(e.r, e.g, e.b, 1)) }, e.prototype._setupImageProcessing = function () { this._options.setupImageProcessing && (this._scene.imageProcessingConfiguration.contrast = this._options.cameraContrast, this._scene.imageProcessingConfiguration.exposure = this._options.cameraExposure, this._scene.imageProcessingConfiguration.toneMappingEnabled = this._options.toneMappingEnabled, this._setupEnvironmentTexture()) }, e.prototype._setupEnvironmentTexture = function () { if (!this._scene.environmentTexture) if (this._options.environmentTexture instanceof Na.BaseTexture) this._scene.environmentTexture = this._options.environmentTexture; else { var e = Na.CubeTexture.CreateFromPrefilteredData(this._options.environmentTexture, this._scene); this._scene.environmentTexture = e } }, e.prototype._setupBackground = function () { this._rootMesh || (this._rootMesh = new Na.Mesh("BackgroundHelper", this._scene)), this._rootMesh.rotation.y = this._options.backgroundYRotation; var e = this._getSceneSize(); this._options.createGround && (this._setupGround(e), this._setupGroundMaterial(), this._setupGroundDiffuseTexture(), this._options.enableGroundMirror && this._setupGroundMirrorTexture(e), this._setupMirrorInGroundMaterial()), this._options.createSkybox && (this._setupSkybox(e), this._setupSkyboxMaterial(), this._setupSkyboxReflectionTexture()), this._rootMesh.position.x = e.rootPosition.x, this._rootMesh.position.z = e.rootPosition.z, this._rootMesh.position.y = e.rootPosition.y }, e.prototype._getSceneSize = function () { var e = this, t = this._options.groundSize, i = this._options.skyboxSize, r = this._options.rootPosition; if (!this._scene.meshes || 1 === this._scene.meshes.length) return { groundSize: t, skyboxSize: i, rootPosition: r }; var n = this._scene.getWorldExtends(function (t) { return t !== e._ground && t !== e._rootMesh && t !== e._skybox }), o = n.max.subtract(n.min); if (this._options.sizeAuto) { this._scene.activeCamera instanceof Na.ArcRotateCamera && this._scene.activeCamera.upperRadiusLimit && (i = t = 2 * this._scene.activeCamera.upperRadiusLimit); var s = o.length(); t < s && (i = t = 2 * s), t *= 1.1, i *= 1.5, (r = n.min.add(o.scale(.5))).y = n.min.y - this._options.groundYBias } return { groundSize: t, skyboxSize: i, rootPosition: r } }, e.prototype._setupGround = function (e) { var t = this; this._ground && !this._ground.isDisposed() || (this._ground = Na.Mesh.CreatePlane("BackgroundPlane", e.groundSize, this._scene), this._ground.rotation.x = Math.PI / 2, this._ground.parent = this._rootMesh, this._ground.onDisposeObservable.add(function () { t._ground = null })), this._ground.receiveShadows = this._options.enableGroundShadow }, e.prototype._setupGroundMaterial = function () { this._groundMaterial || (this._groundMaterial = new Na.BackgroundMaterial("BackgroundPlaneMaterial", this._scene)), this._groundMaterial.alpha = this._options.groundOpacity, this._groundMaterial.alphaMode = Na.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF, this._groundMaterial.shadowLevel = this._options.groundShadowLevel, this._groundMaterial.primaryColor = this._options.groundColor, this._groundMaterial.useRGBColor = !1, this._groundMaterial.enableNoise = !0, this._ground && (this._ground.material = this._groundMaterial) }, e.prototype._setupGroundDiffuseTexture = function () { if (this._groundMaterial && !this._groundTexture) if (this._options.groundTexture instanceof Na.BaseTexture) this._groundMaterial.diffuseTexture = this._options.groundTexture; else { var e = new Na.Texture(this._options.groundTexture, this._scene, void 0, void 0, void 0, void 0, this._errorHandler); e.gammaSpace = !1, e.hasAlpha = !0, this._groundMaterial.diffuseTexture = e } }, e.prototype._setupGroundMirrorTexture = function (e) { var t = Na.Texture.CLAMP_ADDRESSMODE; if (!this._groundMirror && (this._groundMirror = new Na.MirrorTexture("BackgroundPlaneMirrorTexture", { ratio: this._options.groundMirrorSizeRatio }, this._scene, !1, this._options.groundMirrorTextureType, Na.Texture.BILINEAR_SAMPLINGMODE, !0), this._groundMirror.mirrorPlane = new Na.Plane(0, -1, 0, e.rootPosition.y), this._groundMirror.anisotropicFilteringLevel = 1, this._groundMirror.wrapU = t, this._groundMirror.wrapV = t, this._groundMirror.gammaSpace = !1, this._groundMirror.renderList)) for (var i = 0; i < this._scene.meshes.length; i++) { var r = this._scene.meshes[i]; r !== this._ground && r !== this._skybox && r !== this._rootMesh && this._groundMirror.renderList.push(r) } this._groundMirror.clearColor = new Na.Color4(this._options.groundColor.r, this._options.groundColor.g, this._options.groundColor.b, 1), this._groundMirror.adaptiveBlurKernel = this._options.groundMirrorBlurKernel }, e.prototype._setupMirrorInGroundMaterial = function () { this._groundMaterial && (this._groundMaterial.reflectionTexture = this._groundMirror, this._groundMaterial.reflectionFresnel = !0, this._groundMaterial.reflectionAmount = this._options.groundMirrorAmount, this._groundMaterial.reflectionStandardFresnelWeight = this._options.groundMirrorFresnelWeight, this._groundMaterial.reflectionFalloffDistance = this._options.groundMirrorFallOffDistance) }, e.prototype._setupSkybox = function (e) { var t = this; this._skybox && !this._skybox.isDisposed() || (this._skybox = Na.Mesh.CreateBox("BackgroundSkybox", e.skyboxSize, this._scene, void 0, Na.Mesh.BACKSIDE), this._skybox.onDisposeObservable.add(function () { t._skybox = null })), this._skybox.parent = this._rootMesh }, e.prototype._setupSkyboxMaterial = function () { this._skybox && (this._skyboxMaterial || (this._skyboxMaterial = new Na.BackgroundMaterial("BackgroundSkyboxMaterial", this._scene)), this._skyboxMaterial.useRGBColor = !1, this._skyboxMaterial.primaryColor = this._options.skyboxColor, this._skyboxMaterial.enableNoise = !0, this._skybox.material = this._skyboxMaterial) }, e.prototype._setupSkyboxReflectionTexture = function () { this._skyboxMaterial && (this._skyboxTexture || (this._options.skyboxTexture instanceof Na.BaseTexture ? this._skyboxMaterial.reflectionTexture = this._options.skyboxTexture : (this._skyboxTexture = new Na.CubeTexture(this._options.skyboxTexture, this._scene, void 0, void 0, void 0, void 0, this._errorHandler), this._skyboxTexture.coordinatesMode = Na.Texture.SKYBOX_MODE, this._skyboxTexture.gammaSpace = !1, this._skyboxMaterial.reflectionTexture = this._skyboxTexture))) }, e.prototype.dispose = function () { this._groundMaterial && this._groundMaterial.dispose(!0, !0), this._skyboxMaterial && this._skyboxMaterial.dispose(!0, !0), this._rootMesh.dispose(!1) }, e._groundTextureCDNUrl = "https://assets.babylonjs.com/environments/backgroundGround.png", e._skyboxTextureCDNUrl = "https://assets.babylonjs.com/environments/backgroundSkybox.dds", e._environmentTextureCDNUrl = "https://assets.babylonjs.com/environments/environmentSpecular.env", e }(), Na.EnvironmentHelper = Va, Ua = $a || ($a = {}), za = function () { function e() { this.systems = new Array } return Object.defineProperty(e.prototype, "emitterNode", { get: function () { return this._emitterNode }, enumerable: !0, configurable: !0 }), e.prototype.setEmitterAsSphere = function (e, t, i) { this._emitterNode && this._emitterNode.dispose(), this._emitterCreationOptions = { kind: "Sphere", options: e, renderingGroupId: t }; var r = Ua.MeshBuilder.CreateSphere("emitterSphere", { diameter: e.diameter, segments: e.segments }, i); r.renderingGroupId = t; var n = new Ua.StandardMaterial("emitterSphereMaterial", i); n.emissiveColor = e.color, r.material = n; for (var o = 0, s = this.systems; o < s.length; o++)s[o].emitter = r; this._emitterNode = r }, e.prototype.start = function (e) { for (var t = 0, i = this.systems; t < i.length; t++) { var r = i[t]; e && (r.emitter = e), r.start() } }, e.prototype.dispose = function () { for (var e = 0, t = this.systems; e < t.length; e++)t[e].dispose(); this.systems = [], this._emitterNode && (this._emitterNode.dispose(), this._emitterNode = null) }, e.prototype.serialize = function () { for (var e = { systems: [] }, t = 0, i = this.systems; t < i.length; t++) { var r = i[t]; e.systems.push(r.serialize()) } return this._emitterNode && (e.emitter = this._emitterCreationOptions), e }, e.Parse = function (t, i, r) { void 0 === r && (r = !1); var n = new e, o = Ua.ParticleHelper.BaseAssetsUrl + "/textures/"; i = i || Ua.Engine.LastCreatedScene; for (var s = 0, a = t.systems; s < a.length; s++) { var l = a[s]; n.systems.push(r ? Ua.GPUParticleSystem.Parse(l, i, o, !0) : Ua.ParticleSystem.Parse(l, i, o, !0)) } if (t.emitter) { var c = t.emitter.options; switch (t.emitter.kind) { case "Sphere": n.setEmitterAsSphere({ diameter: c.diameter, segments: c.segments, color: Ua.Color3.FromArray(c.color) }, t.emitter.renderingGroupId, i) } } return n }, e }(), Ua.ParticleSystemSet = za, Ga = $a || ($a = {}), ka = function () { function e() { } return e.CreateDefault = function (e, t, i, r) { var n; return void 0 === t && (t = 500), void 0 === r && (r = !1), (n = r ? new Ga.GPUParticleSystem("default system", { capacity: t }, i) : new Ga.ParticleSystem("default system", t, i)).emitter = e, n.particleTexture = new Ga.Texture("https://www.babylonjs.com/assets/Flare.png", n.getScene()), n.createConeEmitter(.1, Math.PI / 4), n.color1 = new Ga.Color4(1, 1, 1, 1), n.color2 = new Ga.Color4(1, 1, 1, 1), n.colorDead = new Ga.Color4(1, 1, 1, 0), n.minSize = .1, n.maxSize = .1, n.minEmitPower = 2, n.maxEmitPower = 2, n.updateSpeed = 1 / 60, n.emitRate = 30, n }, e.CreateAsync = function (t, i, r) { void 0 === r && (r = !1), i || (i = Ga.Engine.LastCreatedScene); var n = {}; return i._addPendingData(n), new Promise(function (o, s) { if (r && !Ga.GPUParticleSystem.IsSupported) return i._removePendingData(n), s("Particle system with GPU is not supported."); Ga.Tools.LoadFile(e.BaseAssetsUrl + "/systems/" + t + ".json", function (e, t) { i._removePendingData(n); var s = JSON.parse(e.toString()); return o(Ga.ParticleSystemSet.Parse(s, i, r)) }, void 0, void 0, void 0, function (e, r) { return i._removePendingData(n), s("An error occured while the creation of your particle system. Check if your type '" + t + "' exists.") }) }) }, e.ExportSet = function (e) { for (var t = new Ga.ParticleSystemSet, i = 0, r = e; i < r.length; i++) { var n = r[i]; t.systems.push(n) } return t }, e.BaseAssetsUrl = "https://assets.babylonjs.com/particles", e }(), Ga.ParticleHelper = ka, Ha = function (e) { function t(t, i, r, n) { var o = e.call(this, t, n) || this; o._useDirectMapping = !1, t = t || "videoDome", r.resolution = 0 | Math.abs(r.resolution) || 32, r.clickToPlay = Boolean(r.clickToPlay), r.autoPlay = void 0 === r.autoPlay || Boolean(r.autoPlay), r.loop = void 0 === r.loop || Boolean(r.loop), r.size = Math.abs(r.size) || (n.activeCamera ? .48 * n.activeCamera.maxZ : 1e3), void 0 === r.useDirectMapping ? o._useDirectMapping = !0 : o._useDirectMapping = r.useDirectMapping, o._setReady(!1); var s = { loop: r.loop, autoPlay: r.autoPlay, autoUpdateTexture: !0, poster: r.poster }, a = o._material = new Wa.BackgroundMaterial(t + "_material", n), l = o._videoTexture = new Wa.VideoTexture(t + "_texture", i, n, !1, o._useDirectMapping, Wa.Texture.TRILINEAR_SAMPLINGMODE, s); return o._mesh = Wa.Mesh.CreateSphere(t + "_mesh", r.resolution, r.size, n, !1, Wa.Mesh.BACKSIDE), l.onLoadObservable.addOnce(function () { o._setReady(!0) }), a.useEquirectangularFOV = !0, a.fovMultiplier = 1, a.opacityFresnel = !1, o._useDirectMapping ? (l.wrapU = Wa.Texture.CLAMP_ADDRESSMODE, l.wrapV = Wa.Texture.CLAMP_ADDRESSMODE, a.diffuseTexture = l) : (l.coordinatesMode = Wa.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE, l.wrapV = Wa.Texture.CLAMP_ADDRESSMODE, a.reflectionTexture = l), o._mesh.material = a, o._mesh.parent = o, r.clickToPlay && (n.onPointerUp = function () { o._videoTexture.video.play() }), o } return T(t, e), Object.defineProperty(t.prototype, "videoTexture", { get: function () { return this._videoTexture }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "fovMultiplier", { get: function () { return this._material.fovMultiplier }, set: function (e) { this._material.fovMultiplier = e }, enumerable: !0, configurable: !0 }), t.prototype.dispose = function (t, i) { void 0 === i && (i = !1), this._videoTexture.dispose(), this._mesh.dispose(), this._material.dispose(), e.prototype.dispose.call(this, t, i) }, t }((Wa = $a || ($a = {})).TransformNode), Wa.VideoDome = Ha, ja = function (e) { function t(t, i, r, n, o) { void 0 === o && (o = null); var s = e.call(this, t, n) || this; s._useDirectMapping = !1, s.onLoadErrorObservable = new Xa.Observable, t = t || "photoDome", r.resolution = 0 | Math.abs(r.resolution) || 32, r.size = Math.abs(r.size) || (n.activeCamera ? .48 * n.activeCamera.maxZ : 1e3), void 0 === r.useDirectMapping ? s._useDirectMapping = !0 : s._useDirectMapping = r.useDirectMapping, s._setReady(!1); var a = s._material = new Xa.BackgroundMaterial(t + "_material", n); return s._mesh = Xa.Mesh.CreateSphere(t + "_mesh", r.resolution, r.size, n, !1, Xa.Mesh.BACKSIDE), a.opacityFresnel = !1, a.useEquirectangularFOV = !0, a.fovMultiplier = 1, s.photoTexture = new Xa.Texture(i, n, !0, !s._useDirectMapping, void 0, void 0, function (e, t) { s.onLoadErrorObservable.notifyObservers(e || "Unknown error occured"), o && o(e, t) }), s.photoTexture.onLoadObservable.addOnce(function () { s._setReady(!0) }), s._mesh.material = a, s._mesh.parent = s } return T(t, e), Object.defineProperty(t.prototype, "photoTexture", { get: function () { return this._photoTexture }, set: function (e) { this._photoTexture !== e && (this._photoTexture = e, this._useDirectMapping ? (this._photoTexture.wrapU = Xa.Texture.CLAMP_ADDRESSMODE, this._photoTexture.wrapV = Xa.Texture.CLAMP_ADDRESSMODE, this._material.diffuseTexture = this._photoTexture) : (this._photoTexture.coordinatesMode = Xa.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE, this._photoTexture.wrapV = Xa.Texture.CLAMP_ADDRESSMODE, this._material.reflectionTexture = this._photoTexture)) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, "fovMultiplier", { get: function () { return this._material.fovMultiplier }, set: function (e) { this._material.fovMultiplier = e }, enumerable: !0, configurable: !0 }), t.prototype.dispose = function (t, i) { void 0 === i && (i = !1), this._photoTexture.dispose(), this._mesh.dispose(), this._material.dispose(), this.onLoadErrorObservable.clear(), e.prototype.dispose.call(this, t, i) }, t }((Xa = $a || ($a = {})).TransformNode), Xa.PhotoDome = ja, Ya = $a || ($a = {}), Ka = function () { this.occlusionInternalRetryCounter = 0, this.isOcclusionQueryInProgress = !1, this.isOccluded = !1, this.occlusionRetryCount = -1, this.occlusionType = Ya.AbstractMesh.OCCLUSION_TYPE_NONE, this.occlusionQueryAlgorithmType = Ya.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE }, Ya.Engine.prototype.createQuery = function () { return this._gl.createQuery() }, Ya.Engine.prototype.deleteQuery = function (e) { return this._gl.deleteQuery(e), this }, Ya.Engine.prototype.isQueryResultAvailable = function (e) { return this._gl.getQueryParameter(e, this._gl.QUERY_RESULT_AVAILABLE) }, Ya.Engine.prototype.getQueryResult = function (e) { return this._gl.getQueryParameter(e, this._gl.QUERY_RESULT) }, Ya.Engine.prototype.beginOcclusionQuery = function (e, t) { var i = this._getGlAlgorithmType(e); return this._gl.beginQuery(i, t), this }, Ya.Engine.prototype.endOcclusionQuery = function (e) { var t = this._getGlAlgorithmType(e); return this._gl.endQuery(t), this }, Ya.Engine.prototype._createTimeQuery = function () { var e = this.getCaps().timerQuery; return e.createQueryEXT ? e.createQueryEXT() : this.createQuery() }, Ya.Engine.prototype._deleteTimeQuery = function (e) { var t = this.getCaps().timerQuery; t.deleteQueryEXT ? t.deleteQueryEXT(e) : this.deleteQuery(e) }, Ya.Engine.prototype._getTimeQueryResult = function (e) { var t = this.getCaps().timerQuery; return t.getQueryObjectEXT ? t.getQueryObjectEXT(e, t.QUERY_RESULT_EXT) : this.getQueryResult(e) }, Ya.Engine.prototype._getTimeQueryAvailability = function (e) { var t = this.getCaps().timerQuery; return t.getQueryObjectEXT ? t.getQueryObjectEXT(e, t.QUERY_RESULT_AVAILABLE_EXT) : this.isQueryResultAvailable(e) }, Ya.Engine.prototype.startTimeQuery = function () { var e = this.getCaps(), t = e.timerQuery; if (!t) return null; var i = new Ya._TimeToken; if (this._gl.getParameter(t.GPU_DISJOINT_EXT), e.canUseTimestampForTimerQuery) i._startTimeQuery = this._createTimeQuery(), t.queryCounterEXT(i._startTimeQuery, t.TIMESTAMP_EXT); else { if (this._currentNonTimestampToken) return this._currentNonTimestampToken; i._timeElapsedQuery = this._createTimeQuery(), t.beginQueryEXT ? t.beginQueryEXT(t.TIME_ELAPSED_EXT, i._timeElapsedQuery) : this._gl.beginQuery(t.TIME_ELAPSED_EXT, i._timeElapsedQuery), this._currentNonTimestampToken = i } return i }, Ya.Engine.prototype.endTimeQuery = function (e) { var t = this.getCaps(), i = t.timerQuery; if (!i || !e) return -1; if (t.canUseTimestampForTimerQuery) { if (!e._startTimeQuery) return -1; e._endTimeQuery || (e._endTimeQuery = this._createTimeQuery(), i.queryCounterEXT(e._endTimeQuery, i.TIMESTAMP_EXT)) } else if (!e._timeElapsedQueryEnded) { if (!e._timeElapsedQuery) return -1; i.endQueryEXT ? i.endQueryEXT(i.TIME_ELAPSED_EXT) : this._gl.endQuery(i.TIME_ELAPSED_EXT), e._timeElapsedQueryEnded = !0 } var r = this._gl.getParameter(i.GPU_DISJOINT_EXT), n = !1; if (e._endTimeQuery ? n = this._getTimeQueryAvailability(e._endTimeQuery) : e._timeElapsedQuery && (n = this._getTimeQueryAvailability(e._timeElapsedQuery)), n && !r) { var o = 0; if (t.canUseTimestampForTimerQuery) { if (!e._startTimeQuery || !e._endTimeQuery) return -1; var s = this._getTimeQueryResult(e._startTimeQuery); o = this._getTimeQueryResult(e._endTimeQuery) - s, this._deleteTimeQuery(e._startTimeQuery), this._deleteTimeQuery(e._endTimeQuery), e._startTimeQuery = null, e._endTimeQuery = null } else { if (!e._timeElapsedQuery) return -1; o = this._getTimeQueryResult(e._timeElapsedQuery), this._deleteTimeQuery(e._timeElapsedQuery), e._timeElapsedQuery = null, e._timeElapsedQueryEnded = !1, this._currentNonTimestampToken = null } return o } return -1 }, Ya.Engine.prototype._getGlAlgorithmType = function (e) { return e === Ya.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE ? this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE : this._gl.ANY_SAMPLES_PASSED }, Object.defineProperty(Ya.AbstractMesh.prototype, "isOcclusionQueryInProgress", { get: function () { return this._occlusionDataStorage.isOcclusionQueryInProgress }, enumerable: !1, configurable: !0 }), Object.defineProperty(Ya.AbstractMesh.prototype, "_occlusionDataStorage", { get: function () { return this.__occlusionDataStorage || (this.__occlusionDataStorage = new Ka), this.__occlusionDataStorage }, enumerable: !1, configurable: !0 }), Object.defineProperty(Ya.AbstractMesh.prototype, "isOccluded", { get: function () { return this._occlusionDataStorage.isOccluded }, set: function (e) { this._occlusionDataStorage.isOccluded = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(Ya.AbstractMesh.prototype, "occlusionQueryAlgorithmType", { get: function () { return this._occlusionDataStorage.occlusionQueryAlgorithmType }, set: function (e) { this._occlusionDataStorage.occlusionQueryAlgorithmType = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(Ya.AbstractMesh.prototype, "occlusionType", { get: function () { return this._occlusionDataStorage.occlusionType }, set: function (e) { this._occlusionDataStorage.occlusionType = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(Ya.AbstractMesh.prototype, "occlusionRetryCount", { get: function () { return this._occlusionDataStorage.occlusionRetryCount }, set: function (e) { this._occlusionDataStorage.occlusionRetryCount = e }, enumerable: !0, configurable: !0 }), Ya.AbstractMesh.prototype._checkOcclusionQuery = function () { var e = this._occlusionDataStorage; if (e.occlusionType === Ya.AbstractMesh.OCCLUSION_TYPE_NONE) return e.isOccluded = !1; var t = this.getEngine(); if (t.webGLVersion < 2) return e.isOccluded = !1; if (!t.isQueryResultAvailable) return e.isOccluded = !1; if (this.isOcclusionQueryInProgress && this._occlusionQuery) if (t.isQueryResultAvailable(this._occlusionQuery)) { var i = t.getQueryResult(this._occlusionQuery); e.isOcclusionQueryInProgress = !1, e.occlusionInternalRetryCounter = 0, e.isOccluded = 1 !== i } else { if (e.occlusionInternalRetryCounter++ , !(-1 !== e.occlusionRetryCount && e.occlusionInternalRetryCounter > e.occlusionRetryCount)) return !1; e.isOcclusionQueryInProgress = !1, e.occlusionInternalRetryCounter = 0, e.isOccluded = e.occlusionType !== Ya.AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC && e.isOccluded } var r = this.getScene(); if (r.getBoundingBoxRenderer) { var n = r.getBoundingBoxRenderer(); this._occlusionQuery || (this._occlusionQuery = t.createQuery()), t.beginOcclusionQuery(e.occlusionQueryAlgorithmType, this._occlusionQuery), n.renderOcclusionBoundingBox(this), t.endOcclusionQuery(e.occlusionQueryAlgorithmType), this._occlusionDataStorage.isOcclusionQueryInProgress = !0 } return e.isOccluded }, Za = function (e) { function t(t, i, r, n, o) { void 0 === i && (i = 256), void 0 === r && (r = Qa.Engine.LastCreatedScene); var s = e.call(this, t, i, "noise", r, n, o) || this; return s._time = 0, s.brightness = .2, s.octaves = 3, s.persistence = .8, s.animationSpeedFactor = 1, s.autoClear = !1, s._updateShaderUniforms(), s } return T(t, e), t.prototype._updateShaderUniforms = function () { var e = this.getScene(); e && (this._time += e.getAnimationRatio() * this.animationSpeedFactor * .01, this.setFloat("brightness", this.brightness), this.setFloat("persistence", this.persistence), this.setFloat("timeScale", this._time)) }, t.prototype._getDefines = function () { return "#define OCTAVES " + (0 | this.octaves) }, t.prototype.render = function (t) { this._updateShaderUniforms(), e.prototype.render.call(this, t) }, t.prototype.serialize = function () { var e = { customType: "BABYLON.NoiseProceduralTexture" }; return e.brightness = this.brightness, e.octaves = this.octaves, e.persistence = this.persistence, e.animationSpeedFactor = this.animationSpeedFactor, e.size = this.getSize().width, e.generateMipMaps = this._generateMipMaps, e }, t.Parse = function (e, i, r) { var n = new t(e.name, e.size, i, void 0, e.generateMipMaps); return n.brightness = e.brightness, n.octaves = e.octaves, n.persistence = e.persistence, n.animationSpeedFactor = e.animationSpeedFactor, n }, t }((Qa = $a || ($a = {})).ProceduralTexture), Qa.NoiseProceduralTexture = Za, tl = this && this.__assign || function () { return (tl = Object.assign || function (e) { for (var t, i = 1, r = arguments.length; i < r; i++)for (var n in t = arguments[i]) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]); return e }).apply(this, arguments) }, qa = $a || ($a = {}), Ja = function () { function e(t, i) { if (void 0 === i && (i = null), !e.IsSupported(t)) throw "Your browser does not support recording so far."; var r = t.getRenderingCanvas(); if (!r) throw "The babylon engine must have a canvas to be recorded"; this._canvas = r, this._canvas.isRecording = !1, this._options = tl({}, e._defaultOptions, i); var n = this._canvas.captureStream(this._options.fps); this._mediaRecorder = new MediaRecorder(n, { mimeType: this._options.mimeType }), this._mediaRecorder.ondataavailable = this._handleDataAvailable.bind(this), this._mediaRecorder.onerror = this._handleError.bind(this), this._mediaRecorder.onstop = this._handleStop.bind(this) } return e.IsSupported = function (e) { var t = e.getRenderingCanvas(); return !!t && "function" == typeof t.captureStream }, Object.defineProperty(e.prototype, "isRecording", { get: function () { return !!this._canvas && this._canvas.isRecording }, enumerable: !0, configurable: !0 }), e.prototype.stopRecording = function () { this._canvas && this._mediaRecorder && this.isRecording && (this._canvas.isRecording = !1, this._mediaRecorder.stop()) }, e.prototype.startRecording = function (e, t) { var i = this; if (void 0 === e && (e = "babylonjs.webm"), void 0 === t && (t = 7), !this._canvas || !this._mediaRecorder) throw "Recorder has already been disposed"; if (this.isRecording) throw "Recording already in progress"; return 0 < t && setTimeout(function () { i.stopRecording() }, 1e3 * t), this._fileName = e, this._recordedChunks = [], this._resolve = null, this._reject = null, this._canvas.isRecording = !0, this._mediaRecorder.start(this._options.recordChunckSize), new Promise(function (e, t) { i._resolve = e, i._reject = t }) }, e.prototype.dispose = function () { this._canvas = null, this._mediaRecorder = null, this._recordedChunks = [], this._fileName = null, this._resolve = null, this._reject = null }, e.prototype._handleDataAvailable = function (e) { 0 < e.data.size && this._recordedChunks.push(e.data) }, e.prototype._handleError = function (e) { if (this.stopRecording(), !this._reject) throw new e.error; this._reject(e.error) }, e.prototype._handleStop = function () { this.stopRecording(); var e = new Blob(this._recordedChunks); this._resolve && this._resolve(e), window.URL.createObjectURL(e), this._fileName && qa.Tools.Download(e, this._fileName) }, e._defaultOptions = { mimeType: "video/webm", fps: 25, recordChunckSize: 3e3 }, e }(), qa.VideoRecorder = Ja, (el = $a || ($a = {})).Scene.prototype.createDefaultLight = function (e) { if (void 0 === e && (e = !1), e && this.lights) for (var t = 0; t < this.lights.length; t++)this.lights[t].dispose(); 0 === this.lights.length && new el.HemisphericLight("default light", el.Vector3.Up(), this) }, el.Scene.prototype.createDefaultCamera = function (e, t, i) { if (void 0 === e && (e = !1), void 0 === t && (t = !1), void 0 === i && (i = !1), t && this.activeCamera && (this.activeCamera.dispose(), this.activeCamera = null), !this.activeCamera) { var r, n = this.getWorldExtends(), o = n.max.subtract(n.min), s = n.min.add(o.scale(.5)), a = 1.5 * o.length(); if (isFinite(a) || (a = 1, s.copyFromFloats(0, 0, 0)), e) { var l = new el.ArcRotateCamera("default camera", -Math.PI / 2, Math.PI / 2, a, s, this); l.lowerRadiusLimit = .01 * a, l.wheelPrecision = 100 / a, r = l } else { var c = new el.FreeCamera("default camera", new el.Vector3(s.x, s.y, -a), this); c.setTarget(s), r = c } r.minZ = .01 * a, r.maxZ = 1e3 * a, r.speed = .2 * a, this.activeCamera = r; var h = this.getEngine().getRenderingCanvas(); i && h && r.attachControl(h) } }, el.Scene.prototype.createDefaultCameraOrLight = function (e, t, i) { void 0 === e && (e = !1), void 0 === t && (t = !1), void 0 === i && (i = !1), this.createDefaultLight(t), this.createDefaultCamera(e, t, i) }, el.Scene.prototype.createDefaultSkybox = function (e, t, i, r, n) { if (void 0 === t && (t = !1), void 0 === i && (i = 1e3), void 0 === r && (r = 0), void 0 === n && (n = !0), !e) return el.Tools.Warn("Can not create default skybox without environment texture."), null; n && e && (this.environmentTexture = e); var o = el.Mesh.CreateBox("hdrSkyBox", i, this); if (t) { var s = new el.PBRMaterial("skyBox", this); s.backFaceCulling = !1, s.reflectionTexture = e.clone(), s.reflectionTexture && (s.reflectionTexture.coordinatesMode = el.Texture.SKYBOX_MODE), s.microSurface = 1 - r, s.disableLighting = !0, s.twoSidedLighting = !0, o.infiniteDistance = !0, o.material = s } else { var a = new el.StandardMaterial("skyBox", this); a.backFaceCulling = !1, a.reflectionTexture = e.clone(), a.reflectionTexture && (a.reflectionTexture.coordinatesMode = el.Texture.SKYBOX_MODE), a.disableLighting = !0, o.infiniteDistance = !0, o.material = a } return o }, el.Scene.prototype.createDefaultEnvironment = function (e) { return el.EnvironmentHelper ? new el.EnvironmentHelper(e, this) : null }, el.Scene.prototype.createDefaultVRExperience = function (e) { return void 0 === e && (e = {}), new el.VRExperienceHelper(this, e) }, $a.Effect.ShadersStore = { defaultVertexShader: "#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL \nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif \n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n", defaultPixelShader: "#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY \n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n", pbrVertexShader: "precision highp float;\n#include<__decl__pbrVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2; \n#endif \n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(positionUpdated,1.0)).xyz;\n#else\nvPositionUVW=positionUpdated;\n#endif\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=environmentIrradianceJones(reflectionVector);\n#endif\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif \n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif \n#if defined(ALBEDO) && ALBEDODIRECTUV == 0 \nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0 \nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0 \nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0 \nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0 \nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0 \nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0 \nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0 \nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}", pbrPixelShader: "#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n#include<__decl__pbrFragment>\nuniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif \n#ifdef MAINUV2 \nvarying vec2 vMainUV2;\n#endif \n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n\n#include<shadowsFragmentFunctions>\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n\n\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\n#include<bumpFragment>\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalW.xyz);\nvec3 nDfdy=dFdy(normalW.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\n\nfloat geometricRoughnessFactor=pow(clamp(slopeSquare ,0.,1.),0.333);\n\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\n#else\nfloat geometricRoughnessFactor=0.;\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\nsurfaceAlbedo*=vAlbedoInfos.y;\n#endif\n\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);\nambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);\nsurfaceReflectivityColor*=vReflectivityInfos.y;\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceReflectivityColorMap.a;\nmicroSurface*=vReflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#endif\n#endif\n#endif\n\nmicroSurface=clamp(microSurface,0.,1.);\n\nfloat roughness=1.-microSurface;\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\nalpha=fresnelSchlickEnvironmentGGX(clamp(dot(viewDirectionW,normalForward),0.0,1.0),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#endif\n\n\nfloat NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=clamp(NdotVUnclamped,0.,1.)+0.00001;\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#ifdef SPECULARAA\n\n\nalphaG+=(0.75*geometricAlphaGFactor);\n#endif\n\n#ifdef REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,1.0);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#else\nfloat lodRefractionNormalized=clamp(refractionLOD/log2(vRefractionMicrosurfaceInfos.x),0.,1.);\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif(lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n}else{\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef GAMMAREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef RGBDREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n\n#ifdef REFLECTION\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,1.);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x),0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSpecularMid,\nlodReflectionNormalizedDoubled\n);\n}else{\nenvironmentRadiance=mix(\nenvironmentSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\n\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\nenvironmentIrradiance=environmentIrradianceJones(irradianceVector);\n#endif\n#endif\n\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\nenvironmentIrradiance*=vReflectionColor.rgb;\n#endif\n\n\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n\nvec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb;\n#ifdef GAMMALIGHTMAP\nlightmapColor=toLinearSpace(lightmapColor);\n#endif\nlightmapColor*=vLightmapInfos.y;\n#endif\nlightingInfo info;\npointLightingInfo pointInfo;\nspotLightingInfo spotInfo;\nfloat shadow=1.; \nfloat NdotL=-1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec2 brdfSamplerUV=vec2(NdotV,roughness);\n\nvec4 environmentBrdf=texture2D(environmentBrdfSampler,brdfSamplerUV);\nvec3 specularEnvironmentReflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW);\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=fresnelSchlickEnvironmentGGX(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n\n#ifdef REFRACTION\nvec3 refractance=vec3(0.0,0.0,0.0);\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedo;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedo*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nenvironmentRefraction.rgb*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=transmission;\n#endif\n\n\n\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n\n#ifdef REFLECTION\nvec3 finalIrradiance=environmentIrradiance;\nfinalIrradiance*=surfaceAlbedo.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\n\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=environmentRadiance.rgb;\nfinalRadiance*=specularEnvironmentReflectance;\n\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#endif\n\n#ifdef REFRACTION\nvec3 finalRefraction=environmentRefraction.rgb;\nfinalRefraction*=refractance;\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)\nalpha=clamp(alpha+luminanceOverAlpha*luminanceOverAlpha,0.,1.);\n#endif\n#endif\n#endif\n\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse.rgb+=vAmbientColor;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\n\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;\n#endif\n\n\n\nvec4 finalColor=vec4(\nfinalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance*ambientOcclusionColor*vLightingIntensity.z +\n#endif\n#ifdef SPECULARTERM\n\n\nfinalSpecularScaled +\n#endif\n#ifdef REFLECTION\n\n\nfinalRadianceScaled +\n#endif\n#ifdef REFRACTION\nfinalRefraction*vLightingIntensity.z +\n#endif\n#endif\nfinalEmissive*vLightingIntensity.y,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n\nfinalColor=max(finalColor,0.0);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\ngl_FragColor=finalColor;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n}", rgbdEncodePixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void) \n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}", rgbdDecodePixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void) \n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}", spritesVertexShader: "\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n}", spritesPixelShader: "uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}", particlesVertexShader: "\nattribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET \nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD \nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction; \n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET \nuniform vec3 particlesInfos; \n#endif\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition; \n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner; \n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner; \n}\n#endif\nvoid main(void) { \nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD \n\nvec3 rotatedCorner;\n#ifdef BILLBOARDY \nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz; \n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition; \nvec3 worldPos=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz; \n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner; \n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\n\ngl_Position=projection*vec4(viewPos,1.0); \n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(worldPos,1.0); \n#endif \nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset*particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nvec4 worldPos=invView*vec4(viewPos,1.0);\n#endif\n#include<clipPlaneVertex>\n}", particlesPixelShader: "\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\n\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n}", colorVertexShader: "\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}", colorPixelShader: "#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\nvoid main(void) {\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}", gpuRenderParticlesVertexShader: "#version 300 es\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 size;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nin vec3 direction;\n#endif\nin float angle;\n#ifdef ANIMATESHEET\nin float cellIndex;\n#endif\nin vec2 offset;\nin vec2 uv;\nout vec2 vUV;\nout vec4 vColor;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;\nin vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition; \n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner; \n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);\nfloat columnOffset=cellIndex-rowOffset*sheetInfos.z;\nvec2 uvScale=sheetInfos.xy;\nvec2 uvOffset=vec2(uv.x ,1.0-uv.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else \nvUV=uv;\n#endif\nfloat ratio=age/life;\n#ifdef COLORGRADIENTS\nvColor=texture(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;\n#ifdef BILLBOARD\nvec4 rotatedCorner;\nrotatedCorner.w=0.;\n#ifdef BILLBOARDY \nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0)); \n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition; \nvec3 worldPos=rotateAlign(toCamera,rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0)); \n#else\n\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nvec4 viewPosition=view*vec4(position,1.0)+rotatedCorner;\n#endif\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=0.;\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nvec3 yaxis=normalize(initialDirection);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\n\nvec4 viewPosition=view*vec4(worldPos,1.0); \n#endif\ngl_Position=projection*viewPosition;\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nvec4 worldPos=invView*viewPosition;\n#endif \n#include<clipPlaneVertex>\n}", gpuRenderParticlesPixelShader: "#version 300 es\nuniform sampler2D textureSampler;\nin vec2 vUV;\nin vec4 vColor;\nout vec4 outFragColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture(textureSampler,vUV);\noutFragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;\noutFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha); \n#endif \n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\noutFragColor=applyImageProcessing(outFragColor);\n#endif\n#endif\n}\n", gpuUpdateParticlesVertexShader: "#version 300 es\n#define PI 3.14159\nuniform float currentCount;\nuniform float timeDelta;\nuniform float stopFactor;\nuniform mat4 emitterWM;\nuniform vec2 lifeTime;\nuniform vec2 emitPower;\nuniform vec2 sizeRange;\nuniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;\nuniform vec4 color2;\n#endif\nuniform vec3 gravity;\nuniform sampler2D randomSampler;\nuniform sampler2D randomSampler2;\nuniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\nuniform vec3 minEmitBox;\nuniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;\nuniform float radiusRange;\nuniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;\nuniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;\nuniform float height;\nuniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;\nuniform float coneAngle;\nuniform vec2 height;\nuniform float directionRandomizer;\n#endif\n\nin vec3 position;\nin float age;\nin float life;\nin vec4 seed;\nin vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;\nin vec3 noiseCoordinates2;\n#endif\n\nout vec3 outPosition;\nout float outAge;\nout float outLife;\nout vec4 outSeed;\nout vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;\nout vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;\nuniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;\nuniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {\nreturn texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;\n}\nvec4 getRandomVec4(float offset) {\nreturn texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));\n}\nvoid main() {\nfloat newAge=age+timeDelta; \n\nif (newAge>=life && stopFactor != 0.) {\nvec3 position;\nvec3 direction;\n\nvec4 randoms=getRandomVec4(seed.x);\n\noutLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;\noutAge=mod(newAge,outLife);\n\noutSeed=seed;\n\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;\noutSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\n\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;\noutAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n\n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nposition=vec3(0,0,0);\ndirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nposition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;\ndirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nposition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);\ndirection=position+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nposition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\ndirection=direction1+(direction2-direction1)*randoms3;\n#else\n\ndirection=position+directionRandomizer*randoms3;\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat yPos=(randoms2.x-0.5)*height;\nfloat angle=randoms2.y*PI*2.;\nfloat inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));\nfloat positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));\nfloat xPos=positionRadius*cos(angle);\nfloat zPos=positionRadius*sin(angle);\nposition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection=direction1+(direction2-direction1)*randoms3;\n#else\n\nangle=angle+((randoms3.x-0.5)*PI);\ndirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));\ndirection=normalize(direction);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nfloat s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.00001;\n#else\nfloat h=randoms2.y*height.y;\n\nh=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;\nlRadius=lRadius*h;\nfloat randX=lRadius*sin(s);\nfloat randZ=lRadius*cos(s);\nfloat randY=h*height.x;\nposition=vec3(randX,randY,randZ); \n\nif (abs(cos(coneAngle)) == 1.0) {\ndirection=vec3(0.,1.0,0.);\n} else {\nvec3 randoms3=getRandomVec3(seed.z);\ndirection=position+directionRandomizer*randoms3;\n}\n#else \n\nposition=vec3(0.,0.,0.);\n\ndirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\noutPosition=(emitterWM*vec4(position,1.)).xyz;\nvec3 initial=(emitterWM*vec4(direction,0.)).xyz;\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {\nfloat directionScale=timeDelta;\noutAge=newAge;\nfloat ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\noutPosition=position+direction*directionScale;\noutLife=life;\noutSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;\noutSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;\nfloat currentVelocity=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*limitVelocityDamping;\n}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nvec3 localPosition=outPosition-emitterWM[3].xyz;\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;\nvec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;\noutDirection=outDirection+force*timeDelta;\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;\noutAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;\nfloat dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;\noffsetAge+=cellStartOffset;\n#endif \nfloat ratio=clamp(mod(offsetAge*cellInfos.z,life)/life,0.,1.0);\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}\n}", gpuUpdateParticlesPixelShader: "#version 300 es\nvoid main() {\ndiscard;\n}\n", postprocessVertexShader: "\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}", passPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}", shadowMapVertexShader: "\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\nuniform vec3 lightData;\n#endif\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\n#include<helperFunctions>\nuniform mat4 viewProjection;\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvec3 worldNor=normalize(normalWorld*normal);\n#ifdef DIRECTIONINLIGHTDATA\nvec3 worldLightDir=normalize(-lightData.xyz);\n#else\nvec3 directionToLight=lightData.xyz-worldPos.xyz;\nvec3 worldLightDir=normalize(directionToLight);\n#endif\nfloat ndl=dot(worldNor,worldLightDir);\nfloat sinNL=sqrt(1.0-ndl*ndl);\nfloat normalBias=biasAndScale.y*sinNL;\nworldPos.xyz-=worldNor*normalBias;\n#endif\n\ngl_Position=viewProjection*worldPos;\n#ifdef DEPTHTEXTURE\n\ngl_Position.z+=biasAndScale.x*gl_Position.w;\n#endif\n\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}", shadowMapPixelShader: "#ifndef FLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=vDepthMetric;\n#ifdef ESM\ndepth=clamp(exp(-min(87.,biasAndScale.z*depth)),0.,1.);\n#endif\n#ifdef FLOAT\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depth);\n#endif\n}", depthBoxBlurPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}", proceduralVertexShader: "\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}", depthVertexShader: "\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}", depthPixelShader: "#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(vDepthMetric,vDepthMetric*vDepthMetric,0.0,1.0);\n}", geometryVertexShader: "precision highp float;\nprecision highp int;\n#include<bonesDeclaration>\n#include<instancesDeclaration>\nattribute vec3 position;\nattribute vec3 normal;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nvarying vec2 uv;\n#endif\n#ifdef UV2\nvarying vec2 uv2;\n#endif\n#endif\n\nuniform mat4 viewProjection;\nuniform mat4 view;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 pos=vec4(finalWorld*vec4(position,1.0));\nvNormalV=normalize(vec3((view*finalWorld)*vec4(normal,0.0)));\nvViewPos=view*pos;\n#ifdef POSITION\nvPosition=pos.xyz/pos.w;\n#endif\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}", geometryPixelShader: "#extension GL_EXT_draw_buffers : require\nprecision highp float;\nprecision highp int;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef POSITION\n#include<mrtFragmentDeclaration>[3]\n#else\n#include<mrtFragmentDeclaration>[2]\n#endif\nvoid main() {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);\n\ngl_FragData[1]=vec4(normalize(vNormalV),1.0);\n\n#ifdef POSITION\ngl_FragData[2]=vec4(vPosition,1.0);\n#endif\n}", ssaoPixelShader: "\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n", ssao2PixelShader: "\nprecision highp float;\nuniform sampler2D textureSampler;\nuniform float near;\nuniform float far;\nuniform float radius;\nfloat scales[16]=float[16](\n0.1,\n0.11406250000000001,\n0.131640625,\n0.15625,\n0.187890625,\n0.2265625,\n0.272265625,\n0.325,\n0.384765625,\n0.4515625,\n0.525390625,\n0.60625,\n0.694140625,\n0.7890625,\n0.891015625,\n1.0\n);\nvarying vec2 vUV;\nfloat perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {\nreturn ( near*far )/( ( far-near )*invClipZ-far );\n}\nfloat viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( near*far/viewZ+far)/( far-near );\n}\nfloat viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( viewZ+near )/( near-far );\n}\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform sampler2D normalSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float base;\nuniform float xViewport;\nuniform float yViewport;\nuniform float maxZ;\nuniform float minZAspect;\nuniform vec2 texelSize;\nuniform mat4 projection;\nvoid main()\n{\nvec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;\nfloat depth=texture2D(textureSampler,vUV).r;\nfloat depthSign=depth/abs(depth);\ndepth=depth*depthSign;\nvec3 normal=texture2D(normalSampler,vUV).rgb; \nfloat occlusion=0.0;\nfloat correctedRadius=min(radius,minZAspect*depth/near);\nvec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);\nvec3 origin=vViewRay*depth;\nvec3 rvec=random*2.0-1.0;\nrvec.z=0.0;\n\nfloat dotProduct=dot(rvec,normal);\nrvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);\nvec3 tangent=normalize(rvec-normal*dot(rvec,normal));\nvec3 bitangent=cross(normal,tangent);\nmat3 tbn=mat3(tangent,bitangent,normal);\nfloat difference;\nfor (int i=0; i<SAMPLES; ++i) {\n\nvec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];\nsamplePosition=samplePosition*correctedRadius+origin;\n\nvec4 offset=vec4(samplePosition,1.0);\noffset=projection*offset;\noffset.xyz/=offset.w;\noffset.xy=offset.xy*0.5+0.5;\nif (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {\ncontinue;\n}\n\nfloat sampleDepth=abs(texture2D(textureSampler,offset.xy).r);\n\ndifference=depthSign*samplePosition.z-sampleDepth;\nfloat rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);\nocclusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;\n}\nocclusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor=vec4(vec3(result),1.0);\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.3846153846)*direction;\nvec2 off2=vec2(3.2307692308)*direction;\ncolor+=texture2D(image,uv)*0.2270270270;\ncolor+=texture2D(image,uv+(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv-(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv+(off2/resolution))*0.0702702703;\ncolor+=texture2D(image,uv-(off2/resolution))*0.0702702703;\nreturn color;\n}\nvec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\ncolor+=texture2D(image,uv)*0.1964825501511404;\ncolor+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;\ncolor+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;\nreturn color;\n}\nvec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\nfloat compareDepth=abs(texture2D(depthSampler,uv).r);\nfloat sampleDepth;\nfloat weight;\nfloat weightSum=30.0;\ncolor+=texture2D(image,uv)*30.0;\nsampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off3/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off3/resolution))*weight;\nreturn color/weightSum;\n}\nvoid main()\n{\n#if EXPENSIVE\nfloat compareDepth=abs(texture2D(depthSampler,vUV).r);\nfloat texelsize=1.0/outSize;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 direction=vec2(0.0,1.0);\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=abs(texture2D(depthSampler,samplePos).r);\nfloat weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n#else\nvec4 color;\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#else\nvec2 direction=vec2(0.0,1.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#endif\ngl_FragColor.rgb=vec3(color.r);\ngl_FragColor.a=1.0;\n#endif\n}\n#endif\n", ssaoCombinePixelShader: "uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nuniform vec4 viewport;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n", lensHighlightsPixelShader: "\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}", depthOfFieldPixelShader: "\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n", standardPixelShader: "uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(VLS)\n#define PI 3.1415926535897932384626433832795\nuniform mat4 shadowViewProjection;\nuniform mat4 lightWorld;\nuniform vec3 cameraPosition;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform vec2 depthValues;\nuniform float scatteringCoefficient;\nuniform float scatteringPower;\nuniform sampler2D shadowMapSampler;\nuniform sampler2D positionSampler;\nfloat computeScattering(float lightDotView)\n{\nfloat result=1.0-scatteringCoefficient*scatteringCoefficient;\nresult/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));\nreturn result;\n}\nvoid main(void)\n{\n\nvec3 worldPos=texture2D(positionSampler,vUV).rgb;\nvec3 startPosition=cameraPosition;\nvec3 rayVector=worldPos-startPosition;\nfloat rayLength=length(rayVector);\nvec3 rayDirection=rayVector/rayLength;\nfloat stepLength=rayLength/NB_STEPS;\nvec3 stepL=rayDirection*stepLength;\nvec3 currentPosition=startPosition;\nvec3 accumFog=vec3(0.0);\nfor (int i=0; i<int(NB_STEPS); i++)\n{\nvec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);\nfloat depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nworldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;\nworldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);\nfloat shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;\nif (shadowMapValue>shadowPixelDepth)\naccumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));\ncurrentPosition+=stepL;\n}\naccumFog/=NB_STEPS;\nvec3 color=accumFog*scatteringPower;\ngl_FragColor=vec4(color*exp(color) ,1.0);\n}\n#endif\n#if defined(VLSMERGE)\nuniform sampler2D originalSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);\n}\n#endif\n#if defined(LUMINANCE)\nuniform vec2 lumOffsets[4];\nvoid main()\n{\nfloat average=0.0;\nvec4 color=vec4(0.0);\nfloat maximum=-1e20;\nvec3 weight=vec3(0.299,0.587,0.114);\nfor (int i=0; i<4; i++)\n{\ncolor=texture2D(textureSampler,vUV+ lumOffsets[i]);\n\nfloat GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));\n\n#ifdef WEIGHTED_AVERAGE\nfloat GreyValue=dot(color.rgb,weight);\n#endif\n#ifdef BRIGHTNESS\nfloat GreyValue=max(color.r,max(color.g,color.b));\n#endif\n#ifdef HSL_COMPONENT\nfloat GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));\n#endif\n#ifdef MAGNITUDE\nfloat GreyValue=length(color.rgb);\n#endif\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(LUMINANCE_DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLER\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main()\n{\nvec4 color=vec4(0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++)\n{\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifdef FINAL_DOWN_SAMPLER\ngl_FragColor=pack(average);\n#else\ngl_FragColor=vec4(average,average,0.0,1.0);\n#endif\n}\n#endif\n#if defined(HDR)\nuniform sampler2D textureAdderSampler;\nuniform float averageLuminance;\nvoid main()\n{\nvec4 color=texture2D(textureAdderSampler,vUV);\nvec4 adjustedColor=color/averageLuminance;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n#if defined(MOTION_BLUR)\nuniform mat4 inverseViewProjection;\nuniform mat4 prevViewProjection;\nuniform vec2 screenSize;\nuniform float motionScale;\nuniform float motionStrength;\nuniform sampler2D depthSampler;\nvoid main(void)\n{\nvec2 texelSize=1.0/screenSize;\nfloat depth=texture2D(depthSampler,vUV).r;\nvec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);\ncpos=cpos*inverseViewProjection;\nvec4 ppos=cpos*prevViewProjection;\nppos.xyz/=ppos.w;\nppos.xy=ppos.xy*0.5+0.5;\nvec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {\nif (i>=nSamples)\nbreak;\nvec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);\nresult+=texture2D(textureSampler,offset1);\n}\ngl_FragColor=result/float(nSamples);\n}\n#endif\n", fxaaVertexShader: "\nattribute vec2 position;\nuniform vec2 texelSize;\n\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd);\nsampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;\nsampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;\nsampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;\nsampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;\nsampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;\nsampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;\nsampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;\nsampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;\ngl_Position=vec4(position,0.0,1.0);\n}", fxaaPixelShader: "uniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst float fxaaQualitySubpix=1.0;\nconst float fxaaQualityEdgeThreshold=0.166;\nconst float fxaaQualityEdgeThresholdMin=0.0833;\nconst vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);\n#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)\nvoid main(){\nvec2 posM;\nposM.x=vUV.x;\nposM.y=vUV.y;\nvec4 rgbyM=texture2D(textureSampler,vUV,0.0);\nfloat lumaM=FxaaLuma(rgbyM);\nfloat lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));\nfloat lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));\nfloat lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));\nfloat lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));\nfloat maxSM=max(lumaS,lumaM);\nfloat minSM=min(lumaS,lumaM);\nfloat maxESM=max(lumaE,maxSM);\nfloat minESM=min(lumaE,minSM);\nfloat maxWN=max(lumaN,lumaW);\nfloat minWN=min(lumaN,lumaW);\nfloat rangeMax=max(maxWN,maxESM);\nfloat rangeMin=min(minWN,minESM);\nfloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;\nfloat range=rangeMax-rangeMin;\nfloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);\n#ifndef MALI\nif(range<rangeMaxClamped) \n{\ngl_FragColor=rgbyM;\nreturn;\n}\n#endif\nfloat lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));\nfloat lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));\nfloat lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));\nfloat lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));\nfloat lumaNS=lumaN+lumaS;\nfloat lumaWE=lumaW+lumaE;\nfloat subpixRcpRange=1.0/range;\nfloat subpixNSWE=lumaNS+lumaWE;\nfloat edgeHorz1=(-2.0*lumaM)+lumaNS;\nfloat edgeVert1=(-2.0*lumaM)+lumaWE;\nfloat lumaNESE=lumaNE+lumaSE;\nfloat lumaNWNE=lumaNW+lumaNE;\nfloat edgeHorz2=(-2.0*lumaE)+lumaNESE;\nfloat edgeVert2=(-2.0*lumaN)+lumaNWNE;\nfloat lumaNWSW=lumaNW+lumaSW;\nfloat lumaSWSE=lumaSW+lumaSE;\nfloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);\nfloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);\nfloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;\nfloat edgeVert3=(-2.0*lumaS)+lumaSWSE;\nfloat edgeHorz=abs(edgeHorz3)+edgeHorz4;\nfloat edgeVert=abs(edgeVert3)+edgeVert4;\nfloat subpixNWSWNESE=lumaNWSW+lumaNESE;\nfloat lengthSign=texelSize.x;\nbool horzSpan=edgeHorz>=edgeVert;\nfloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;\nif (!horzSpan)\n{\nlumaN=lumaW;\n}\nif (!horzSpan) \n{\nlumaS=lumaE;\n}\nif (horzSpan) \n{\nlengthSign=texelSize.y;\n}\nfloat subpixB=(subpixA*(1.0/12.0))-lumaM;\nfloat gradientN=lumaN-lumaM;\nfloat gradientS=lumaS-lumaM;\nfloat lumaNN=lumaN+lumaM;\nfloat lumaSS=lumaS+lumaM;\nbool pairN=abs(gradientN)>=abs(gradientS);\nfloat gradient=max(abs(gradientN),abs(gradientS));\nif (pairN)\n{\nlengthSign=-lengthSign;\n}\nfloat subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);\nvec2 posB;\nposB.x=posM.x;\nposB.y=posM.y;\nvec2 offNP;\noffNP.x=(!horzSpan) ? 0.0 : texelSize.x;\noffNP.y=(horzSpan) ? 0.0 : texelSize.y;\nif (!horzSpan) \n{\nposB.x+=lengthSign*0.5;\n}\nif (horzSpan)\n{\nposB.y+=lengthSign*0.5;\n}\nvec2 posN;\nposN.x=posB.x-offNP.x*1.5;\nposN.y=posB.y-offNP.y*1.5;\nvec2 posP;\nposP.x=posB.x+offNP.x*1.5;\nposP.y=posB.y+offNP.y*1.5;\nfloat subpixD=((-2.0)*subpixC)+3.0;\nfloat lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));\nfloat subpixE=subpixC*subpixC;\nfloat lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));\nif (!pairN) \n{\nlumaNN=lumaSS;\n}\nfloat gradientScaled=gradient*1.0/4.0;\nfloat lumaMM=lumaM-lumaNN*0.5;\nfloat subpixF=subpixD*subpixE;\nbool lumaMLTZero=lumaMM<0.0;\nlumaEndN-=lumaNN*0.5;\nlumaEndP-=lumaNN*0.5;\nbool doneN=abs(lumaEndN)>=gradientScaled;\nbool doneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) \n{\nposN.x-=offNP.x*3.0;\n}\nif (!doneN) \n{\nposN.y-=offNP.y*3.0;\n}\nbool doneNP=(!doneN) || (!doneP);\nif (!doneP) \n{\nposP.x+=offNP.x*3.0;\n}\nif (!doneP)\n{\nposP.y+=offNP.y*3.0;\n}\nif (doneNP)\n{\nif (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));\nif (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));\nif (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;\nif (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;\ndoneN=abs(lumaEndN)>=gradientScaled;\ndoneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) posN.x-=offNP.x*12.0;\nif (!doneN) posN.y-=offNP.y*12.0;\ndoneNP=(!doneN) || (!doneP);\nif (!doneP) posP.x+=offNP.x*12.0;\nif (!doneP) posP.y+=offNP.y*12.0;\n}\nfloat dstN=posM.x-posN.x;\nfloat dstP=posP.x-posM.x;\nif (!horzSpan)\n{\ndstN=posM.y-posN.y;\n}\nif (!horzSpan) \n{\ndstP=posP.y-posM.y;\n}\nbool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;\nfloat spanLength=(dstP+dstN);\nbool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;\nfloat spanLengthRcp=1.0/spanLength;\nbool directionN=dstN<dstP;\nfloat dst=min(dstN,dstP);\nbool goodSpan=directionN ? goodSpanN : goodSpanP;\nfloat subpixG=subpixF*subpixF;\nfloat pixelOffset=(dst*(-spanLengthRcp))+0.5;\nfloat subpixH=subpixG*fxaaQualitySubpix;\nfloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;\nfloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);\nif (!horzSpan)\n{\nposM.x+=pixelOffsetSubpix*lengthSign;\n}\nif (horzSpan)\n{\nposM.y+=pixelOffsetSubpix*lengthSign;\n}\n#ifdef MALI\nif(range<rangeMaxClamped) \n{\ngl_FragColor=rgbyM;\n}\nelse\n{\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n}\n#else\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n#endif\n}", chromaticAberrationPixelShader: "\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float radialIntensity;\nuniform vec2 direction;\nuniform vec2 centerPosition;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);\nvec2 directionOfEffect=direction;\nif(directionOfEffect.x == 0. && directionOfEffect.y == 0.){\ndirectionOfEffect=normalize(centered_screen_pos);\n}\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;\nfloat ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\noriginal.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);\ngl_FragColor=original;\n}", grainPixelShader: "#include<helperFunctions>\n\nuniform sampler2D textureSampler; \n\nuniform float intensity;\nuniform float animatedSeed;\n\nvarying vec2 vUV;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec2 seed=vUV*(animatedSeed);\nfloat grain=dither(seed,intensity);\n\nfloat lum=getLuminance(gl_FragColor.rgb);\nfloat grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;\ngl_FragColor.rgb+=grain*grainAmount;\ngl_FragColor.rgb=max(gl_FragColor.rgb,0.0);\n}", sharpenPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform vec2 sharpnessAmounts;\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 color=texture2D(textureSampler,vUV);\nvec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1)) -\ncolor*4.0;\ngl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);\n}", kernelBlurVertexShader: "\nattribute vec2 position;\n\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n}", kernelBlurPixelShader: "\nuniform sampler2D textureSampler;\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#ifdef DOF\nuniform sampler2D circleOfConfusionSampler;\nuniform vec2 cameraMinMaxZ;\nfloat sampleDistance(const in vec2 offset) {\nfloat depth=texture2D(circleOfConfusionSampler,offset).g; \nreturn cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth; \n}\nfloat sampleCoC(const in vec2 offset) {\nfloat coc=texture2D(circleOfConfusionSampler,offset).r; \nreturn coc; \n}\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nvoid main(void)\n{\nfloat computedWeight=0.0;\n#ifdef PACKEDFLOAT \nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#ifdef DOF\nfloat sumOfWeights=CENTER_WEIGHT; \nfloat factor=0.0;\n\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n#ifdef DOF\ngl_FragColor/=sumOfWeights;\n#endif\n}", depthOfFieldMergePixelShader: "uniform sampler2D textureSampler;\nvarying vec2 vUV;\nuniform sampler2D circleOfConfusionSampler;\nuniform sampler2D blurStep0;\n#if BLUR_LEVEL>0\nuniform sampler2D blurStep1;\n#endif\n#if BLUR_LEVEL>1\nuniform sampler2D blurStep2;\n#endif\nvoid main(void)\n{\nfloat coc=texture2D(circleOfConfusionSampler,vUV).r;\n#if BLUR_LEVEL == 0\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred0=texture2D(blurStep0,vUV);\ngl_FragColor=mix(original,blurred0,coc);\n#endif\n#if BLUR_LEVEL == 1\nif(coc<0.5){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(original,blurred1,coc/0.5);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV); \nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);\n}\n#endif\n#if BLUR_LEVEL == 2\nif(coc<0.33){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(original,blurred2,coc/0.33);\n}else if(coc<0.66){\nvec4 blurred1=texture2D(blurStep1,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);\n}\n#endif\n}\n", circleOfConfusionPixelShader: "\nuniform sampler2D depthSampler;\n\nvarying vec2 vUV;\n\nuniform vec2 cameraMinMaxZ;\n\nuniform float focusDistance;\nuniform float cocPrecalculation;\nvoid main(void)\n{\nfloat depth=texture2D(depthSampler,vUV).r;\nfloat pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0; \nfloat coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));\ncoc=clamp(coc,0.0,1.0);\ngl_FragColor=vec4(coc,depth,coc,1.0);\n}\n", bloomMergePixelShader: "uniform sampler2D textureSampler;\nuniform sampler2D bloomBlur;\nvarying vec2 vUV;\nuniform float bloomWeight;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec3 blurred=texture2D(bloomBlur,vUV).rgb;\ngl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight); \n}\n", extractHighlightsPixelShader: "#include<helperFunctions>\n\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float threshold;\nuniform float exposure;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\nfloat luma=getLuminance(gl_FragColor.rgb*exposure);\ngl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;\n}", refractionPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}", blackAndWhitePixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float degree;\nvoid main(void) \n{\nvec3 color=texture2D(textureSampler,vUV).rgb;\nfloat luminance=dot(color,vec3(0.3,0.59,0.11)); \nvec3 blackAndWhite=vec3(luminance,luminance,luminance);\ngl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);\n}", convolutionPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}", filterPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}", volumetricLightScatteringPixelShader: "uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;\ndataSample*=illuminationDecay*weight;\ncolor+=dataSample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n", volumetricLightScatteringPassPixelShader: "#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n", colorCorrectionPixelShader: "\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}", tonemapPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}", displayPassPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}", highlightsPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nconst vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvoid main(void) \n{\nvec4 tex=texture2D(textureSampler,vUV);\nvec3 c=tex.rgb;\nfloat luma=dot(c.rgb,RGBLuminanceCoefficients);\n\n\ngl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a); \n}", imageProcessingPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main(void)\n{\nvec4 result=texture2D(textureSampler,vUV);\n#ifdef IMAGEPROCESSING\n#ifndef FROMLINEARSPACE\n\nresult.rgb=toLinearSpace(result.rgb);\n#endif\nresult=applyImageProcessing(result);\n#else\n\n#ifdef FROMLINEARSPACE\nresult=applyImageProcessing(result);\n#endif\n#endif\ngl_FragColor=result;\n}", lensFlareVertexShader: "\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}", lensFlarePixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}", anaglyphPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}", stereoscopicInterlacePixelShader: "const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}", vrDistortionCorrectionPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,0.0);\nelse{\ngl_FragColor=texture2D(textureSampler,tc);\n}\n}", glowBlurPostProcessPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nfloat getLuminance(vec3 color)\n{\nreturn dot(color,vec3(0.2126,0.7152,0.0722));\n}\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\n\nvec4 texel=texture2D(textureSampler,start+texelOffset);\nbaseColor.a+=texel.a*weights[i];\n\nfloat luminance=getLuminance(baseColor.rgb);\nfloat luminanceTexel=getLuminance(texel.rgb);\nfloat choice=step(luminanceTexel,luminance);\nbaseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}", glowMapGenerationPixelShader: "#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform sampler2D emissiveSampler;\n#endif\nuniform vec4 color;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUVDiffuse).a<0.4)\ndiscard;\n#endif\n#ifdef EMISSIVE\ngl_FragColor=texture2D(emissiveSampler,vUVEmissive)*color;\n#else\ngl_FragColor=color;\n#endif\n}", glowMapGenerationVertexShader: "\nattribute vec3 position;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform mat4 emissiveMatrix;\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(positionUpdated,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef DIFFUSEUV1\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef DIFFUSEUV2\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef EMISSIVE\n#ifdef EMISSIVEUV1\nvUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef EMISSIVEUV2\nvUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}", glowMapMergePixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#ifdef EMISSIVE\nuniform sampler2D textureSampler2;\n#endif\n\nuniform float offset;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef EMISSIVE\nbaseColor+=texture2D(textureSampler2,vUV);\nbaseColor*=offset;\n#else\nbaseColor.a=abs(offset-baseColor.a);\n#ifdef STROKE\nfloat alpha=smoothstep(.0,.1,baseColor.a);\nbaseColor.a=alpha;\nbaseColor.rgb=baseColor.rgb*alpha;\n#endif\n#endif\ngl_FragColor=baseColor;\n}", glowMapMergeVertexShader: "\nattribute vec2 position;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}", lineVertexShader: "\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}", linePixelShader: "uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}", outlineVertexShader: "\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<logDepthVertex>\n}\n", outlinePixelShader: "#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n}", layerVertexShader: "\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}", layerPixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}", backgroundVertexShader: "precision highp float;\n#include<__decl__backgroundVertex>\n#include<helperFunctions>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2; \n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normal);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#ifdef EQUIRECTANGULAR_RELFECTION_FOV\nmat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));\nvec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));\nif (fFovMultiplier<=1.0) {\nvDirectionW=normalize(segment);\n} else {\nvDirectionW=normalize(vDirectionW+(vDirectionW-segment));\n}\n#endif\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif \n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0 \nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n", backgroundPixelShader: "#ifdef TEXTURELODSUPPORT\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__backgroundFragment>\n#define RECIPROCAL_PI2 0.15915494\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif \n#ifdef MAINUV2 \nvarying vec2 vMainUV2; \n#endif \n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n\n#ifndef SHADOWONLY\n#define SHADOWONLY;\n#endif\n#include<imageProcessingDeclaration>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<helperFunctions>\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<imageProcessingFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n#ifdef REFLECTIONFRESNEL\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(0.0,1.0,0.0);\n#endif\n\nfloat shadow=1.;\nfloat globalShadow=0.;\nfloat shadowLightCount=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef SHADOWINUSE\nglobalShadow/=shadowLightCount;\n#else\nglobalShadow=1.0;\n#endif\n\nvec4 reflectionColor=vec4(1.,1.,1.,1.);\n#ifdef REFLECTION\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#ifdef REFLECTIONBLUR\nfloat reflectionLOD=vReflectionInfos.y;\n#ifdef TEXTURELODSUPPORT\n\nreflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nreflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD,0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nreflectionColor=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nreflectionSpecularMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nreflectionColor=mix(\nreflectionSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#else\nvec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);\nreflectionColor=reflectionSample;\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef GAMMAREFLECTION\nreflectionColor.rgb=toLinearSpace(reflectionColor.rgb);\n#endif\n#ifdef REFLECTIONBGR\nreflectionColor.rgb=reflectionColor.bgr;\n#endif\n\nreflectionColor.rgb*=vReflectionInfos.x;\n#endif\n\nvec3 diffuseColor=vec3(1.,1.,1.);\nfloat finalAlpha=alpha;\n#ifdef DIFFUSE\nvec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef GAMMADIFFUSE\ndiffuseMap.rgb=toLinearSpace(diffuseMap.rgb);\n#endif\n\ndiffuseMap.rgb*=vDiffuseInfos.y;\n#ifdef DIFFUSEHASALPHA\nfinalAlpha*=diffuseMap.a;\n#endif\ndiffuseColor=diffuseMap.rgb;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 colorBase=diffuseColor;\n#else\nvec3 colorBase=reflectionColor.rgb*diffuseColor;\n#endif\ncolorBase=max(colorBase,0.0);\n\n#ifdef USERGBCOLOR\nvec3 finalColor=colorBase;\n#else\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nvec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);\n#else\nvec3 mainColor=vPrimaryColor.rgb;\n#endif\nvec3 finalColor=colorBase*mainColor;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 reflectionAmount=vReflectionControl.xxx;\nvec3 reflectionReflectance0=vReflectionControl.yyy;\nvec3 reflectionReflectance90=vReflectionControl.zzz;\nfloat VdotN=dot(normalize(vEyePosition),normalW);\nvec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(clamp(VdotN,0.0,1.0),reflectionReflectance0,reflectionReflectance90,1.0);\nreflectionAmount*=planarReflectionFresnel;\n#ifdef REFLECTIONFALLOFF\nfloat reflectionDistanceFalloff=1.0-clamp(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w,0.0,1.0);\nreflectionDistanceFalloff*=reflectionDistanceFalloff;\nreflectionAmount*=reflectionDistanceFalloff;\n#endif\nfinalColor=mix(finalColor,reflectionColor.rgb,clamp(reflectionAmount,0.,1.));\n#endif\n#ifdef OPACITYFRESNEL\nfloat viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));\n\nconst float startAngle=0.1;\nfloat fadeFactor=clamp(viewAngleToFloor/startAngle,0.0,1.0);\nfinalAlpha*=fadeFactor*fadeFactor;\n#endif\n\n#ifdef SHADOWINUSE\nfinalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);\n#endif\n\nvec4 color=vec4(finalColor,finalAlpha);\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\ncolor.rgb=clamp(color.rgb,0.,30.0);\n#else\n\ncolor=applyImageProcessing(color);\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#ifdef NOISE\ncolor.rgb+=dither(vPositionW.xy,0.5);\ncolor=max(color,0.0);\n#endif\ngl_FragColor=color;\n}\n", noisePixelShader: "\n\nuniform float brightness;\nuniform float persistence;\nuniform float timeScale;\n\nvarying vec2 vUV;\n\nvec2 hash22(vec2 p)\n{\np=p*mat2(127.1,311.7,269.5,183.3);\np=-1.0+2.0*fract(sin(p)*43758.5453123);\nreturn sin(p*6.283+timeScale);\n}\nfloat interpolationNoise(vec2 p)\n{\nvec2 pi=floor(p);\nvec2 pf=p-pi;\nvec2 w=pf*pf*(3.-2.*pf);\nfloat f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));\nfloat f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));\nfloat f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));\nfloat f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));\nfloat xm1=mix(f00,f10,w.x);\nfloat xm2=mix(f01,f11,w.x);\nfloat ym=mix(xm1,xm2,w.y); \nreturn ym;\n}\nfloat perlinNoise2D(float x,float y)\n{\nfloat sum=0.0;\nfloat frequency=0.0;\nfloat amplitude=0.0;\nfor(int i=0; i<OCTAVES; i++)\n{\nfrequency=pow(2.0,float(i));\namplitude=pow(persistence,float(i));\nsum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;\n}\nreturn sum;\n}\n\nvoid main(void)\n{\nfloat x=abs(vUV.x);\nfloat y=abs(vUV.y);\nfloat noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);\ngl_FragColor=vec4(noise,noise,noise,1.0);\n}\n" }, $a.Effect.IncludesShadersStore = { depthPrePass: "#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif", bonesDeclaration: "#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif", instancesDeclaration: "#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif", pointCloudVertexDeclaration: "#ifdef POINTSIZE\nuniform float pointSize;\n#endif", bumpVertexDeclaration: "#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n", clipPlaneVertexDeclaration: "#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif", fogVertexDeclaration: "#ifdef FOG\nvarying vec3 vFogDistance;\n#endif", morphTargetsVertexGlobalDeclaration: "#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif", morphTargetsVertexDeclaration: "#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#endif", logDepthDeclaration: "#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif", morphTargetsVertex: "#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#endif", instancesVertex: "#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif", bonesVertex: "#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif", bumpVertex: "#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif", clipPlaneVertex: "#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif", fogVertex: "#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif", shadowsVertex: "#ifdef SHADOWS\n#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif", pointCloudVertex: "#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif", logDepthVertex: "#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif", helperFunctions: "const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nvec3 applyEaseInOut(vec3 x){\nreturn x*x*(3.0-2.0*x);\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=max(0.0000001,max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D); \n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}", lightFragmentDeclaration: "#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#else\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif", lightsFragmentFunctions: "\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}", lightUboDeclaration: "#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec3 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X}; \n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif", defaultVertexDeclaration: "\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n", defaultFragmentDeclaration: "uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_SKYBOX\n#else\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif", defaultUboDeclaration: "layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor; \nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix; \nvec4 vTangentSpaceParams;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nfloat pointSize; \n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};", shadowsFragmentFunctions: "#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); \nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#endif\n#endif\n", fresnelFunction: "#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif", reflectionFunction: "#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\n#endif\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvec3 direction=normalize(vDirectionW);\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y; \n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nreturn vec3(1.0-s,t,0);\n#else\nreturn vec3(s,t,0);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y; \nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=normalize(worldPos.xyz-vEyePosition.xyz);\n\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,vReflectionSize,vReflectionPosition);\n#endif\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}", imageProcessingDeclaration: "#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif", imageProcessingFunctions: "#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=clamp(color,0.0,1.0);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=clamp(result.rgb,0.0,1.0);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=applyEaseInOut(result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}", bumpFragmentFunctions: "#ifdef BUMP\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=vTangentSpaceParams.x;\nbitangent*=vTangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\nmap=map*2.0-1.0;\n#ifdef NORMALXYSCALE\nmap=normalize(map*vec3(vBumpInfos.y,vBumpInfos.y,1.0));\n#endif\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif", clipPlaneFragmentDeclaration: "#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif", fogFragmentDeclaration: "#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif", clipPlaneFragment: "#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif", bumpFragment: "vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else \nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW); \n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif", lightFragment: "#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))\n\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\nspotInfo=computeSpotLightingInfo(light{X}.vLightData);\n#ifdef LIGHT_FALLOFF_GLTF{X}\nspotInfo.attenuation=computeDistanceLightFalloff_GLTF(spotInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\nspotInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\nspotInfo.attenuation=computeDistanceLightFalloff_Physical(spotInfo.lightDistanceSquared);\nspotInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\nspotInfo.attenuation=computeDistanceLightFalloff_Standard(spotInfo.lightOffset,light{X}.vLightFalloff.x);\nspotInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\nspotInfo.attenuation=computeDistanceLightFalloff(spotInfo.lightOffset,spotInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\nspotInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\ninfo=computeSpotLighting(spotInfo,viewDirectionW,normalW,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#elif defined(POINTLIGHT{X})\npointInfo=computePointLightingInfo(light{X}.vLightData);\n#ifdef LIGHT_FALLOFF_GLTF{X}\npointInfo.attenuation=computeDistanceLightFalloff_GLTF(pointInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npointInfo.attenuation=computeDistanceLightFalloff_Physical(pointInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npointInfo.attenuation=computeDistanceLightFalloff_Standard(pointInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npointInfo.attenuation=computeDistanceLightFalloff(pointInfo.lightOffset,pointInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\ninfo=computePointLighting(pointInfo,viewDirectionW,normalW,light{X}.vLightDiffuse.rgb,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#elif defined(DIRLIGHT{X})\ninfo=computeDirectionalLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCLOSEESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif\n#endif\n#endif", logDepthFragment: "#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif", fogFragment: "#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif", pbrVertexDeclaration: "uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n", pbrFragmentDeclaration: "uniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif", pbrUboDeclaration: "layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec2 vAlbedoInfos;\nuniform vec4 vAmbientInfos;\nuniform vec2 vOpacityInfos;\nuniform vec2 vEmissiveInfos;\nuniform vec2 vLightmapInfos;\nuniform vec3 vReflectivityInfos;\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform vec4 vRefractionInfos;\nuniform vec2 vReflectionInfos;\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \nuniform vec3 vBumpInfos;\nuniform mat4 albedoMatrix;\nuniform mat4 ambientMatrix;\nuniform mat4 opacityMatrix;\nuniform mat4 emissiveMatrix;\nuniform mat4 lightmapMatrix;\nuniform mat4 reflectivityMatrix;\nuniform mat4 microSurfaceSamplerMatrix;\nuniform mat4 bumpMatrix;\nuniform vec2 vTangentSpaceParams;\nuniform mat4 refractionMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float pointSize;\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};", pbrFunctions: "\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor)\n{\nroughness=max(roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nvec3 fresnel=fresnelSchlickGGX(VdotH,reflectance0,reflectance90);\nreturn fresnel*specTerm;\n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel*NdotL/PI;\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n\n\nfloat fresnelGrazingReflectance(float reflectance0) {\nfloat reflectance90=clamp(reflectance0*25.0,0.0,1.0);\nreturn reflectance90;\n}\n\n\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\n\n\n\n\n\n\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nfloat microsurfaceAverageSlopeTexels=microsurfaceAverageSlope*cubeMapDimensionPixels;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\n\n\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn clamp(square(temp)-1.0+ambientOcclusion,0.0,1.0);\n}\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal) {\n\nvec3 reflection=reflect(view,normal);\nfloat temp=clamp( 1.0+1.1*dot(reflection,normal),0.0,1.0);\nreturn square(temp);\n}", harmonicsFunctions: "#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 quaternionVectorRotation_ScaledSqrtTwo(vec4 Q,vec3 V){\nvec3 T=cross(Q.xyz,V);\nT+=Q.www*V;\nreturn cross(Q.xyz,T)+V;\n}\nvec3 environmentIrradianceJones(vec3 normal)\n{\n\n\n\n\n\n\n\n\n\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz*Nz+C1;\nvec3 t2=a2*Ny+t1;\nvec3 t3=b3*Nx+t2;\nreturn t3;\n}\n#endif", pbrLightFunctions: "\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nstruct pointLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat attenuation;\n};\nstruct spotLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nvec3 directionToLightCenterW;\nfloat attenuation;\n};\nfloat computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/((lightDistanceSquared+0.001));\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nconst float minDistanceSquared=0.01*0.01;\nfloat lightDistanceFalloff=1.0/(max(lightDistanceSquared,minDistanceSquared));\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=clamp(1.0-factor*factor,0.,1.);\nattenuation*=attenuation;\n\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\n\n\n\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=clamp(cd*lightAngleScale+lightAngleOffset,0.,1.);\n\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}\npointLightingInfo computePointLightingInfo(vec4 lightData) {\npointLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nreturn result;\n}\nspotLightingInfo computeSpotLightingInfo(vec4 lightData) {\nspotLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.directionToLightCenterW=normalize(result.lightOffset);\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nreturn result;\n}\nlightingInfo computePointLighting(pointLightingInfo info,vec3 viewDirectionW,vec3 vNormal,vec3 diffuseColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\nfloat lightDistance=sqrt(info.lightDistanceSquared);\nvec3 lightDirection=normalize(info.lightOffset);\n\nroughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*info.attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor*info.attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(spotLightingInfo info,vec3 viewDirectionW,vec3 vNormal,vec4 lightDirection,vec3 diffuseColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\n\nfloat lightDistance=sqrt(info.lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+info.directionToLightCenterW);\nNdotL=clamp(dot(vNormal,info.directionToLightCenterW),0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*info.attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor*info.attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeDirectionalLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\nfloat lightDistance=length(-lightData.xyz);\nvec3 lightDirection=normalize(-lightData.xyz);\n\nroughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nNdotL=clamp(NdotL,0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}", clipPlaneVertexDeclaration2: "#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nout float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nout float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nout float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nout float fClipDistance4;\n#endif", clipPlaneFragmentDeclaration2: "#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif", mrtFragmentDeclaration: "#if __VERSION__>=200\nlayout(location=0) out vec4 glFragData[{X}];\n#endif\n", bones300Declaration: "#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nin vec4 matricesIndices;\nin vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nin vec4 matricesIndicesExtra;\nin vec4 matricesWeightsExtra;\n#endif\n#endif", instances300Declaration: "#ifdef INSTANCES\nin vec4 world0;\nin vec4 world1;\nin vec4 world2;\nin vec4 world3;\n#else\nuniform mat4 world;\n#endif", kernelBlurFragment: "#ifdef DOF\nfactor=sampleCoC(sampleCoord{X}); \ncomputedWeight=KERNEL_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif", kernelBlurFragment2: "#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});\ncomputedWeight=KERNEL_DEP_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif", kernelBlurVaryingDeclaration: "varying vec2 sampleCoord{X};", kernelBlurVertex: "sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};", backgroundVertexDeclaration: "uniform mat4 view;\nuniform mat4 viewProjection;\nuniform float shadowLevel;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif", backgroundFragmentDeclaration: " uniform vec4 vPrimaryColor;\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nuniform vec4 vPrimaryColorShadow;\n#endif\nuniform float shadowLevel;\nuniform float alpha;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif", backgroundUboDeclaration: "layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec4 vPrimaryColor;\nuniform vec4 vPrimaryColorShadow;\nuniform vec2 vDiffuseInfos;\nuniform vec2 vReflectionInfos;\nuniform mat4 diffuseMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\nuniform float pointSize;\nuniform float shadowLevel;\nuniform float alpha;\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};" }; var il = void 0 !== t ? t : "undefined" != typeof window ? window : this; return il.BABYLON = $a, void 0 !== r && (il.Earcut = { earcut: r }), $a });
    }, { "earcut": "vwhv" }], "UTeA": [function (require, module, exports) {
        module.exports = function (r, e) { for (var n = r[0], t = r[1], o = !1, l = 0, u = e.length - 1; l < e.length; u = l++) { var a = e[l][0], f = e[l][1], g = e[u][0], h = e[u][1]; f > t != h > t && n < (g - a) * (t - f) / (h - f) + a && (o = !o) } return o };
    }, {}], "Slkt": [function (require, module, exports) {
        var define;
        var global = arguments[3];
        var t, e = arguments[3]; !function (e, r) { "object" == typeof exports && "undefined" != typeof module ? r(exports) : "function" == typeof t && t.amd ? t(["exports"], r) : r(e.martinez = {}) }(this, function (t) { "use strict"; function e(t, e) { return t > e ? 1 : t < e ? -1 : 0 } var r = function (t, r) { void 0 === t && (t = e), void 0 === r && (r = !1), this._compare = t, this._root = null, this._size = 0, this._noDuplicates = !!r }, n = { size: { configurable: !0 } }; r.prototype.rotateLeft = function (t) { var e = t.right; e && (t.right = e.left, e.left && (e.left.parent = t), e.parent = t.parent), t.parent ? t === t.parent.left ? t.parent.left = e : t.parent.right = e : this._root = e, e && (e.left = t), t.parent = e }, r.prototype.rotateRight = function (t) { var e = t.left; e && (t.left = e.right, e.right && (e.right.parent = t), e.parent = t.parent), t.parent ? t === t.parent.left ? t.parent.left = e : t.parent.right = e : this._root = e, e && (e.right = t), t.parent = e }, r.prototype._splay = function (t) { for (; t.parent;) { var e = t.parent; e.parent ? e.left === t && e.parent.left === e ? (this.rotateRight(e.parent), this.rotateRight(e)) : e.right === t && e.parent.right === e ? (this.rotateLeft(e.parent), this.rotateLeft(e)) : e.left === t && e.parent.right === e ? (this.rotateRight(e), this.rotateLeft(e)) : (this.rotateLeft(e), this.rotateRight(e)) : e.left === t ? this.rotateRight(e) : this.rotateLeft(e) } }, r.prototype.splay = function (t) { for (var e, r, n, i, o; t.parent;)(r = (e = t.parent).parent) && r.parent ? ((n = r.parent).left === r ? n.left = t : n.right = t, t.parent = n) : (t.parent = null, this._root = t), i = t.left, o = t.right, t === e.left ? (r && (r.left === e ? (e.right ? (r.left = e.right, r.left.parent = r) : r.left = null, e.right = r, r.parent = e) : (i ? (r.right = i, i.parent = r) : r.right = null, t.left = r, r.parent = t)), o ? (e.left = o, o.parent = e) : e.left = null, t.right = e, e.parent = t) : (r && (r.right === e ? (e.left ? (r.right = e.left, r.right.parent = r) : r.right = null, e.left = r, r.parent = e) : (o ? (r.left = o, o.parent = r) : r.left = null, t.right = r, r.parent = t)), i ? (e.right = i, i.parent = e) : e.right = null, t.left = e, e.parent = t) }, r.prototype.replace = function (t, e) { t.parent ? t === t.parent.left ? t.parent.left = e : t.parent.right = e : this._root = e, e && (e.parent = t.parent) }, r.prototype.minNode = function (t) { if (void 0 === t && (t = this._root), t) for (; t.left;)t = t.left; return t }, r.prototype.maxNode = function (t) { if (void 0 === t && (t = this._root), t) for (; t.right;)t = t.right; return t }, r.prototype.insert = function (t, e) { var r = this._root, n = null, i = this._compare; if (this._noDuplicates) for (; r;) { if (n = r, 0 === i(r.key, t)) return; r = i(r.key, t) < 0 ? r.right : r.left } else for (; r;)n = r, r = i(r.key, t) < 0 ? r.right : r.left; return r = { key: t, data: e, left: null, right: null, parent: n }, n ? i(n.key, r.key) < 0 ? n.right = r : n.left = r : this._root = r, this.splay(r), this._size++ , r }, r.prototype.find = function (t) { for (var e = this._root, r = this._compare; e;) { var n = r(e.key, t); if (n < 0) e = e.right; else { if (!(n > 0)) return e; e = e.left } } return null }, r.prototype.contains = function (t) { for (var e = this._root, r = this._compare; e;) { var n = r(t, e.key); if (0 === n) return !0; e = n < 0 ? e.left : e.right } return !1 }, r.prototype.remove = function (t) { var e = this.find(t); if (!e) return !1; if (this.splay(e), e.left) if (e.right) { var r = this.minNode(e.right); r.parent !== e && (this.replace(r, r.right), r.right = e.right, r.right.parent = r), this.replace(e, r), r.left = e.left, r.left.parent = r } else this.replace(e, e.left); else this.replace(e, e.right); return this._size-- , !0 }, r.prototype.removeNode = function (t) { if (!t) return !1; if (this.splay(t), t.left) if (t.right) { var e = this.minNode(t.right); e.parent !== t && (this.replace(e, e.right), e.right = t.right, e.right.parent = e), this.replace(t, e), e.left = t.left, e.left.parent = e } else this.replace(t, t.left); else this.replace(t, t.right); return this._size-- , !0 }, r.prototype.erase = function (t) { var e = this.find(t); if (e) { this.splay(e); var r = e.left, n = e.right, i = null; r && (r.parent = null, i = this.maxNode(r), this.splay(i), this._root = i), n && (r ? i.right = n : this._root = n, n.parent = i), this._size-- } }, r.prototype.pop = function () { var t = this._root, e = null; if (t) { for (; t.left;)t = t.left; e = { key: t.key, data: t.data }, this.remove(t.key) } return e }, r.prototype.next = function (t) { var e = t; if (e) if (e.right) for (e = e.right; e && e.left;)e = e.left; else for (e = t.parent; e && e.right === t;)t = e, e = e.parent; return e }, r.prototype.prev = function (t) { var e = t; if (e) if (e.left) for (e = e.left; e && e.right;)e = e.right; else for (e = t.parent; e && e.left === t;)t = e, e = e.parent; return e }, r.prototype.forEach = function (t) { for (var e = this._root, r = [], n = !1, i = 0; !n;)e ? (r.push(e), e = e.left) : r.length > 0 ? (t(e = r.pop(), i++), e = e.right) : n = !0; return this }, r.prototype.range = function (t, e, r, n) { for (var i = [], o = this._compare, h = this._root; 0 !== i.length || h;)if (h) i.push(h), h = h.left; else { if (o((h = i.pop()).key, e) > 0) break; if (o(h.key, t) >= 0 && r.call(n, h)) return this; h = h.right } return this }, r.prototype.keys = function () { for (var t = this._root, e = [], r = [], n = !1; !n;)t ? (e.push(t), t = t.left) : e.length > 0 ? (t = e.pop(), r.push(t.key), t = t.right) : n = !0; return r }, r.prototype.values = function () { for (var t = this._root, e = [], r = [], n = !1; !n;)t ? (e.push(t), t = t.left) : e.length > 0 ? (t = e.pop(), r.push(t.data), t = t.right) : n = !0; return r }, r.prototype.at = function (t) { for (var e = this._root, r = [], n = !1, i = 0; !n;)if (e) r.push(e), e = e.left; else if (r.length > 0) { if (e = r.pop(), i === t) return e; i++ , e = e.right } else n = !0; return null }, r.prototype.load = function (t, e, r) { if (void 0 === t && (t = []), void 0 === e && (e = []), void 0 === r && (r = !1), 0 !== this._size) throw new Error("bulk-load: tree is not empty"); var n = t.length; return r && function t(e, r, n, i, o) { if (n >= i) return; var h = e[n + i >> 1]; var u = n - 1; var p = i + 1; for (; ;) { do { u++ } while (o(e[u], h) < 0); do { p-- } while (o(e[p], h) > 0); if (u >= p) break; var l = e[u]; e[u] = e[p], e[p] = l, l = r[u], r[u] = r[p], r[p] = l } t(e, r, n, p, o); t(e, r, p + 1, i, o) }(t, e, 0, n - 1, this._compare), this._root = function t(e, r, n, i, o) { var h = o - i; if (h > 0) { var u = i + Math.floor(h / 2), p = r[u], l = n[u], s = { key: p, data: l, parent: e }; return s.left = t(s, r, n, i, u), s.right = t(s, r, n, u + 1, o), s } return null }(null, t, e, 0, n), this._size = n, this }, r.prototype.min = function () { var t = this.minNode(this._root); return t ? t.key : null }, r.prototype.max = function () { var t = this.maxNode(this._root); return t ? t.key : null }, r.prototype.isEmpty = function () { return null === this._root }, n.size.get = function () { return this._size }, r.createTree = function (t, e, n, i, o) { return new r(n, o).load(t, e, i) }, Object.defineProperties(r.prototype, n); var i = 0, o = 1, h = 2, u = 3, p = 0, l = 1, s = 2, f = 3; function a(t, e, r) { null === e ? (t.inOut = !1, t.otherInOut = !0) : (t.isSubject === e.isSubject ? (t.inOut = !e.inOut, t.otherInOut = e.otherInOut) : (t.inOut = !e.otherInOut, t.otherInOut = e.isVertical() ? !e.inOut : e.inOut), e && (t.prevInResult = !c(e, r) || e.isVertical() ? e.prevInResult : e)), t.inResult = c(t, r) } function c(t, e) { switch (t.type) { case i: switch (e) { case p: return !t.otherInOut; case l: return t.otherInOut; case s: return t.isSubject && t.otherInOut || !t.isSubject && !t.otherInOut; case f: return !0 }break; case h: return e === p || e === l; case u: return e === s; case o: return !1 }return !1 } var v = function (t, e, r, n, o) { this.left = e, this.point = t, this.otherEvent = r, this.isSubject = n, this.type = o || i, this.inOut = !1, this.otherInOut = !1, this.prevInResult = null, this.inResult = !1, this.resultInOut = !1, this.isExteriorRing = !0 }; function g(t, e) { return t[0] === e[0] && t[1] === e[1] } function y(t, e, r) { return (t[0] - r[0]) * (e[1] - r[1]) - (e[0] - r[0]) * (t[1] - r[1]) } function d(t, e) { var r = t.point, n = e.point; return r[0] > n[0] ? 1 : r[0] < n[0] ? -1 : r[1] !== n[1] ? r[1] > n[1] ? 1 : -1 : function (t, e, r, n) { if (t.left !== e.left) return t.left ? 1 : -1; if (0 !== y(r, t.otherEvent.point, e.otherEvent.point)) return t.isBelow(e.otherEvent.point) ? -1 : 1; return !t.isSubject && e.isSubject ? 1 : -1 }(t, e, r) } function E(t, e, r) { var n = new v(e, !1, t, t.isSubject), i = new v(e, !0, t.otherEvent, t.isSubject); return g(t.point, t.otherEvent.point) && console.warn("what is that, a collapsed segment?", t), n.contourId = i.contourId = t.contourId, d(i, t.otherEvent) > 0 && (t.otherEvent.left = !0, i.left = !1), t.otherEvent.otherEvent = i, t.otherEvent = n, r.push(i), r.push(n), r } function _(t, e) { return t[0] * e[1] - t[1] * e[0] } function m(t, e) { return t[0] * e[0] + t[1] * e[1] } function I(t, e, r) { var n = function (t, e, r, n, i) { var o = [e[0] - t[0], e[1] - t[1]], h = [n[0] - r[0], n[1] - r[1]]; function u(t, e, r) { return [t[0] + e * r[0], t[1] + e * r[1]] } var p = [r[0] - t[0], r[1] - t[1]], l = _(o, h), s = l * l, f = m(o, o); if (s > 0) { var a = _(p, h) / l; if (a < 0 || a > 1) return null; var c = _(p, o) / l; return c < 0 || c > 1 ? null : 0 === a || 1 === a ? i ? null : [u(t, a, o)] : 0 === c || 1 === c ? i ? null : [u(r, c, h)] : [u(t, a, o)] } if ((s = (l = _(p, o)) * l) > 0) return null; var v = m(o, p) / f, g = v + m(o, h) / f, y = Math.min(v, g), d = Math.max(v, g); return y <= 1 && d >= 0 ? 1 === y ? i ? null : [u(t, y > 0 ? y : 0, o)] : 0 === d ? i ? null : [u(t, d < 1 ? d : 1, o)] : i && 0 === y && 1 === d ? null : [u(t, y > 0 ? y : 0, o), u(t, d < 1 ? d : 1, o)] : null }(t.point, t.otherEvent.point, e.point, e.otherEvent.point), i = n ? n.length : 0; if (0 === i) return 0; if (1 === i && (g(t.point, e.point) || g(t.otherEvent.point, e.otherEvent.point))) return 0; if (2 === i && t.isSubject === e.isSubject) return 0; if (1 === i) return g(t.point, n[0]) || g(t.otherEvent.point, n[0]) || E(t, n[0], r), g(e.point, n[0]) || g(e.otherEvent.point, n[0]) || E(e, n[0], r), 1; var p = [], l = !1, s = !1; return g(t.point, e.point) ? l = !0 : 1 === d(t, e) ? p.push(e, t) : p.push(t, e), g(t.otherEvent.point, e.otherEvent.point) ? s = !0 : 1 === d(t.otherEvent, e.otherEvent) ? p.push(e.otherEvent, t.otherEvent) : p.push(t.otherEvent, e.otherEvent), l && s || l ? (e.type = o, t.type = e.inOut === t.inOut ? h : u, l && !s && E(p[1].otherEvent, p[0].point, r), 2) : s ? (E(p[0], p[1].point, r), 3) : p[0] !== p[3].otherEvent ? (E(p[0], p[1].point, r), E(p[1], p[2].point, r), 3) : (E(p[0], p[1].point, r), E(p[3].otherEvent, p[2].point, r), 3) } function k(t, e) { if (t === e) return 0; if (0 !== y(t.point, t.otherEvent.point, e.point) || 0 !== y(t.point, t.otherEvent.point, e.otherEvent.point)) return g(t.point, e.point) ? t.isBelow(e.otherEvent.point) ? -1 : 1 : t.point[0] === e.point[0] ? t.point[1] < e.point[1] ? -1 : 1 : 1 === d(t, e) ? e.isAbove(t.point) ? -1 : 1 : t.isBelow(e.point) ? -1 : 1; if (t.isSubject !== e.isSubject) return t.isSubject ? -1 : 1; var r = t.point, n = e.point; return r[0] === n[0] && r[1] === n[1] ? (r = t.otherEvent.point, n = e.otherEvent.point, r[0] === n[0] && r[1] === n[1] ? 0 : t.contourId > e.contourId ? 1 : -1) : 1 === d(t, e) ? 1 : -1 } function b(t, e, r, n) { var i, o, h = t + 1, u = e.length; for (i = e[t].point, h < u && (o = e[h].point); h < u && o[0] === i[0] && o[1] === i[1];) { if (!r[h]) return h; o = e[++h].point } for (h = t - 1; r[h] && h >= n;)h--; return h } function O(t, e) { var r, n, i, o = function (t) { var e, r, n, i, o = []; for (r = 0, n = t.length; r < n; r++)((e = t[r]).left && e.inResult || !e.left && e.otherEvent.inResult) && o.push(e); for (var h = !1; !h;)for (h = !0, r = 0, n = o.length; r < n; r++)r + 1 < n && 1 === d(o[r], o[r + 1]) && (i = o[r], o[r] = o[r + 1], o[r + 1] = i, h = !1); for (r = 0, n = o.length; r < n; r++)(e = o[r]).pos = r; for (r = 0, n = o.length; r < n; r++)(e = o[r]).left || (i = e.pos, e.pos = e.otherEvent.pos, e.otherEvent.pos = i); return o }(t), h = {}, u = []; for (r = 0, n = o.length; r < n; r++)if (!h[r]) { var p = [[]]; o[r].isExteriorRing ? e === s && !o[r].isSubject && u.length > 1 ? u[u.length - 1].push(p[0]) : u.push(p) : e !== s || o[r].isSubject || 0 !== u.length ? 0 === u.length ? u.push([[p]]) : u[u.length - 1].push(p[0]) : u.push(p); var l = u.length - 1, f = r, a = o[r].point; for (p[0].push(a); f >= r;)i = o[f], h[f] = !0, i.left ? (i.resultInOut = !1, i.contourId = l) : (i.otherEvent.resultInOut = !0, i.otherEvent.contourId = l), h[f = i.pos] = !0, p[0].push(o[f].point), f = b(f, o, h, r); i = o[f = -1 === f ? r : f], h[f] = h[i.pos] = !0, i.otherEvent.resultInOut = !0, i.otherEvent.contourId = l } return u } v.prototype.isBelow = function (t) { var e = this.point, r = this.otherEvent.point; return this.left ? (e[0] - t[0]) * (r[1] - t[1]) - (r[0] - t[0]) * (e[1] - t[1]) > 0 : (r[0] - t[0]) * (e[1] - t[1]) - (e[0] - t[0]) * (r[1] - t[1]) > 0 }, v.prototype.isAbove = function (t) { return !this.isBelow(t) }, v.prototype.isVertical = function () { return this.point[0] === this.otherEvent.point[0] }, v.prototype.clone = function () { var t = new v(this.point, this.left, this.otherEvent, this.isSubject, this.type); return t.inResult = this.inResult, t.prevInResult = this.prevInResult, t.isExteriorRing = this.isExteriorRing, t.inOut = this.inOut, t.otherInOut = this.otherInOut, t }; var R = j, w = j; function j(t, e) { if (!(this instanceof j)) return new j(t, e); if (this.data = t || [], this.length = this.data.length, this.compare = e || x, this.length > 0) for (var r = (this.length >> 1) - 1; r >= 0; r--)this._down(r) } function x(t, e) { return t < e ? -1 : t > e ? 1 : 0 } j.prototype = { push: function (t) { this.data.push(t), this.length++ , this._up(this.length - 1) }, pop: function () { if (0 !== this.length) { var t = this.data[0]; return this.length-- , this.length > 0 && (this.data[0] = this.data[this.length], this._down(0)), this.data.pop(), t } }, peek: function () { return this.data[0] }, _up: function (t) { for (var e = this.data, r = this.compare, n = e[t]; t > 0;) { var i = t - 1 >> 1, o = e[i]; if (r(n, o) >= 0) break; e[t] = o, t = i } e[t] = n }, _down: function (t) { for (var e = this.data, r = this.compare, n = this.length >> 1, i = e[t]; t < n;) { var o = 1 + (t << 1), h = o + 1, u = e[o]; if (h < this.length && r(e[h], u) < 0 && (o = h, u = e[h]), r(u, i) >= 0) break; e[t] = u, t = o } e[t] = i } }, R.default = w; var S = Math.max, N = Math.min, z = 0; function M(t, e, r, n, i, o) { var h, u, p, l, s, f; for (h = 0, u = t.length - 1; h < u; h++)if (p = t[h], l = t[h + 1], s = new v(p, !1, void 0, e), f = new v(l, !1, s, e), s.otherEvent = f, p[0] !== l[0] || p[1] !== l[1]) { s.contourId = f.contourId = r, o || (s.isExteriorRing = !1, f.isExteriorRing = !1), d(s, f) > 0 ? f.left = !0 : s.left = !0; var a = p[0], c = p[1]; i[0] = N(i[0], a), i[1] = N(i[1], c), i[2] = S(i[2], a), i[3] = S(i[3], c), n.push(s), n.push(f) } } var L = []; function B(t, e, n) { "number" == typeof t[0][0][0] && (t = [t]), "number" == typeof e[0][0][0] && (e = [e]); var i = function (t, e, r) { var n = null; return t.length * e.length == 0 && (r === p ? n = L : r === s ? n = t : r !== l && r !== f || (n = 0 === t.length ? e : t)), n }(t, e, n); if (i) return i === L ? null : i; var o = [1 / 0, 1 / 0, -1 / 0, -1 / 0], h = [1 / 0, 1 / 0, -1 / 0, -1 / 0], u = function (t, e, r, n, i) { var o, h, u, p, l, f, a = new R(null, d); for (u = 0, p = t.length; u < p; u++)for (l = 0, f = (o = t[u]).length; l < f; l++)(h = 0 === l) && z++ , M(o[l], !0, z, a, r, h); for (u = 0, p = e.length; u < p; u++)for (l = 0, f = (o = e[u]).length; l < f; l++)h = 0 === l, i === s && (h = !1), h && z++ , M(o[l], !1, z, a, n, h); return a }(t, e, o, h, n); return (i = function (t, e, r, n, i) { var o = null; return (r[0] > n[2] || n[0] > r[2] || r[1] > n[3] || n[1] > r[3]) && (i === p ? o = L : i === s ? o = t : i !== l && i !== f || (o = t.concat(e))), o }(t, e, o, h, n)) ? i === L ? null : i : O(function (t, e, n, i, o, h) { for (var u, l, f, c = new r(k), v = [], g = Math.min(i[2], o[2]); 0 !== t.length;) { var y = t.pop(); if (v.push(y), h === p && y.point[0] > g || h === s && y.point[0] > i[2]) break; if (y.left) { l = u = c.insert(y), u = u !== (f = c.minNode()) ? c.prev(u) : null, l = c.next(l); var d = u ? u.key : null; if (a(y, d, h), l && 2 === I(y, l.key, t) && (a(y, d, h), a(y, l.key, h)), u && 2 === I(u.key, y, t)) { var E = u; a(d, (E = E !== f ? c.prev(E) : null) ? E.key : null, h), a(y, d, h) } } else y = y.otherEvent, l = u = c.find(y), u && l && (u = u !== f ? c.prev(u) : null, l = c.next(l), c.remove(y), l && u && I(u.key, l.key, t)) } return v }(u, 0, 0, o, h, n), n) } var D = { UNION: l, DIFFERENCE: s, INTERSECTION: p, XOR: f }; t.union = function (t, e) { return B(t, e, l) }, t.diff = function (t, e) { return B(t, e, s) }, t.xor = function (t, e) { return B(t, e, f) }, t.intersection = function (t, e) { return B(t, e, p) }, t.operations = D, Object.defineProperty(t, "__esModule", { value: !0 }) });
    }, {}], "SyBU": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.TextPosition = void 0; var e, t, n = a(require("babylonjs")), r = a(require("point-in-polygon")), o = a(require("../../../../node_modules/martinez-polygon-clipping/dist/martinez.umd.js")); function a(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; r.get || r.set ? Object.defineProperty(t, n, r) : t[n] = e[n] } return t.default = e, t } function i(e) { return s(e) || c(e) || l() } function l() { throw new TypeError("Invalid attempt to spread non-iterable instance") } function c(e) { if (Symbol.iterator in Object(e) || "[object Arguments]" === Object.prototype.toString.call(e)) return Array.from(e) } function s(e) { if (Array.isArray(e)) { for (var t = 0, n = new Array(e.length); t < e.length; t++)n[t] = e[t]; return n } } function u(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function h(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function f(e, t, n) { return t && h(e.prototype, t), n && h(e, n), e } exports.TextPosition = e, function (e) { e[e.Right = 0] = "Right", e[e.Left = 1] = "Left" }(e || (exports.TextPosition = e = {})); var g = function () { function e() { u(this, e) } return f(e, null, [{ key: "createRectangle", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1], r = e.x, o = e.y, a = r + e.length, i = o + e.height, l = [new n.Vector3(r, 0, o), new n.Vector3(a, 0, o), new n.Vector3(a, 0, i), new n.Vector3(r, 0, i)]; return t && l.push(new n.Vector3(r, 0, o)), l } }, { key: "degreesToRadians", value: function (e) { return e * (Math.PI / 180) } }, { key: "radiansToDegrees", value: function (e) { return e * (180 / Math.PI) } }, { key: "getDistance", value: function (e, t) { return Math.sqrt(Math.pow(e, 2) + Math.pow(t, 2)) } }, { key: "getOppositeAdjacentAngle", value: function (e, t) { return Math.atan(e / t) * (180 / Math.PI) } }, { key: "getOpposite", value: function (e, t) { return Math.tan(this.degreesToRadians(e)) * t } }, { key: "getAdjacent", value: function (e, t) { return Math.cos(this.degreesToRadians(e)) * t } }, { key: "createGable", value: function (t) { var r = t.main, o = t.awningRight, a = t.awningLeft, i = t.frontColour, l = t.backColour, c = t.scene, s = r.rectangle, u = r.roofOffset || 0, h = s.length / 2, f = this.getOpposite(r.roofPitch, h + Math.abs(u)), g = s.height + f, p = h - Math.abs(u) < .01, v = u > 0, d = s.length, y = !(!o || !o.visible), w = !(!a || !a.visible), V = s.length / 2, m = -V, T = V; y && o && (d += o.length, T += o.length), w && a && (d += a.length, m -= a.length); var b = function (e, t) { return new n.Vector3(e, 0, t) }, x = [b(m, 0), b(T, 0)]; if (y && o) { var O = o.length, M = o.roofPitch, P = o.heightOffset, k = s.height; p && v && (k = g); var R = this.getOpposite(M, O), A = k - R - P; x = x.concat([b(T, A), b(T - O, A + R)]) } var S = [b(h, s.height), b(u, g), b(-h, s.height)]; if ("boolean" != typeof r.visible || r.visible || S.forEach(function (e) { e.z = 0 }), x = x.concat(S), w && a) { var C = a.length, D = a.roofPitch, E = a.heightOffset, L = s.height; p && (v || (L = g)); var j = this.getOpposite(D, C), B = L - j - E; x = x.concat([b(m + C, B + j), b(m, B)]) } var I = []; i && l && (I = [i, i, l, l]); var F = []; t.holes && t.holes.length > 0 && (F = e.holesUnion(t.holes)); var U = new n.Vector4(0, 0, d / 10, g / 10), z = { faceColors: I, shape: x, holes: F.map(function (e) { var t = e.concat([]); return t.splice(e.length - 1, 1), t }), sideOrientation: n.Mesh.DOUBLESIDE, frontUVs: U, backUVs: U }, _ = n.MeshBuilder.CreatePolygon("polygon", z, c); return _.material = t.material, _ } }, { key: "vectorPolygonsToArray", value: function (e) { var t = this; return e.map(function (e) { return e.map(function (e) { return t.vecToPoly(e) }) }) } }, { key: "vecToPoly", value: function (e) { return [e.x, e.z] } }, { key: "polyToVector", value: function (e) { return new n.Vector3(e[0], 0, e[1]) } }, { key: "inside", value: function (e, t) { return r(e, t) } }, { key: "diff", value: function (e, t) { for (var n = e.map(this.vecToPoly), r = [], a = 0; a < t.length; a++) { for (var i = t[a], l = !0, c = 0; c < i.length; c++) { var s = this.vecToPoly(i[c]); if (!this.inside(s, n)) { l = !1; break } } if (l) r.push(i); else { var u = i.map(this.vecToPoly); n = o.diff([n], [u])[0] } } return { shape: n.map(this.polyToVector), holes: r } } }, { key: "holesUnion", value: function (t) { var n = this, r = t.map(function (t) { return e.createRectangle(t, !0).map(function (t) { var n = e.vecToPoly(t); return n.push(n[0]), n }) }), o = this.union.apply(this, i(r)), a = []; return o.forEach(function (e) { var t = e.map(function (e) { return n.polyToVector(e) }); return a.push(t), t }), a } }, { key: "union", value: function () { for (var e = arguments.length, t = new Array(e), n = 0; n < e; n++)t[n] = arguments[n]; for (var r = t.concat([]), a = 0; a < r.length; a++)for (var i = a + 1; i < r.length; i++) { var l = r[i], c = r[a]; if (c.length > 0 && l.length > 0) { var s = o.union([c], [l]); 1 === s.length && (r[a] = s[0][0], r[i] = [], i = a) } } return r.filter(function (e) { return !!(e && e.length > 0) }) } }, { key: "createFlashing", value: function (t) { var r = t.scene, o = t.a || { angle: 90, length: 1, lip: !1, lipLength: 0 }, a = t.b || { angle: 0, length: 1, lip: !1, lipLength: 0 }, i = function (t) { var r = n.Matrix.RotationAxis(n.Axis.Z, e.degreesToRadians(t.angle)); return n.Vector3.TransformCoordinates(new n.Vector3(-1, 0, 0), r).normalize().multiplyByFloats(t.length, t.length, t.length) }, l = n.Matrix.RotationAxis(n.Axis.Z, e.degreesToRadians(o.angle)), c = (n.Vector3.TransformCoordinates(new n.Vector3(-1, 0, 0), l).normalize(), n.Matrix.RotationAxis(n.Axis.Z, e.degreesToRadians(a.angle))), s = (n.Vector3.TransformCoordinates(new n.Vector3(1, 0, 0), c).normalize(), { shape: [i(o), new n.Vector3(0, 0, 0), i(a)], path: [new n.Vector3(0, 0, 0), new n.Vector3(0, 0, 1)], sideOrientation: n.Mesh.DOUBLESIDE }), u = n.MeshBuilder.ExtrudeShape("flashing", s, r); return u.convertToFlatShadedMesh(), u } }, { key: "createRidgeCap", value: function (e) { var t = e.scene, n = e.roofPitch, r = e.isSkillionRight, o = e.isSkillionLeft, a = e.leftRoofPitch, i = n, l = -n - 180; r && (i = 180 - a, l--), o && (l = 91); return this.createFlashing({ scene: t, a: { angle: i, length: .15, lip: !1, lipLength: 0 }, b: { angle: l, length: .15, lip: !1, lipLength: 0 } }) } }, { key: "createC", value: function (t) { var r = t.width, o = t.length, a = t.renderOptions, i = a.scene, l = new n.TransformNode("cSection", i), c = r / 2, s = o / 2, u = s - .015, h = { shape: [new n.Vector3(c, u, 0), new n.Vector3(c, s, 0), new n.Vector3(-c, s, 0), new n.Vector3(-c, -s, 0), new n.Vector3(c, -s, 0), new n.Vector3(c, -u, 0)], path: [new n.Vector3(0, 0, 0), new n.Vector3(0, 0, 1)], sideOrientation: n.Mesh.DOUBLESIDE }, f = n.MeshBuilder.ExtrudeShape("CSection", h, i); return f.rotate(n.Axis.X, e.degreesToRadians(-90), n.Space.WORLD), f.rotate(n.Axis.Y, e.degreesToRadians(90), n.Space.WORLD), f.convertToFlatShadedMesh(), f.material = a.materials.galvanised, f.parent = l, f } }, { key: "createGutter", value: function (e) { var t = e.scene, r = { shape: [new n.Vector3(-.01, 0, 0), new n.Vector3(0, 0, 0), new n.Vector3(0, -.06, 0), new n.Vector3(.12, -.06, 0), new n.Vector3(.12, .065, 0), new n.Vector3(.11, .065, 0)], path: [new n.Vector3(0, 0, 0), new n.Vector3(0, 0, 1)], sideOrientation: n.Mesh.DOUBLESIDE }, o = n.MeshBuilder.ExtrudeShape("gutter", r, t); return o.convertToFlatShadedMesh(), o } }, { key: "getTextWidth", value: function (e, n) { var r = t; if (r || (t = document.createElement("canvas"), document.body.appendChild(t), r = t), r.getContext) { var o = r.getContext("2d"); if (o) return o.font = n, o.measureText(e).width } return 0 } }, { key: "showNormals", value: function (e, t, r, o) { var a = t.getVerticesData(n.VertexBuffer.NormalKind), i = t.getVerticesData(n.VertexBuffer.PositionKind), l = []; if (a && i) for (var c = 0; c < a.length; c += 3) { var s = n.Vector3.FromArray(i, c), u = s.add(n.Vector3.FromArray(a, c).scaleInPlace(r || 1)); l.push([s.add(t.position), u.add(t.position)]) } var h = n.MeshBuilder.CreateLineSystem("normalLines", { lines: l }, e); return h.color = o || n.Color3.White(), h } }]), e }(); exports.default = g;
    }, { "babylonjs": "S+Ze", "point-in-polygon": "UTeA", "../../../../node_modules/martinez-polygon-clipping/dist/martinez.umd.js": "Slkt" }], "TglT": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = require("mobx"); function e(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } function o(t, e) { for (var o = 0; o < e.length; o++) { var n = e[o]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n) } } function n(t, e, n) { return e && o(t.prototype, e), n && o(t, n), t } function r(t) { return (r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(t) } var i = function (t, e, o, n) { var i, u = arguments.length, a = u < 3 ? e : null === n ? n = Object.getOwnPropertyDescriptor(e, o) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : r(Reflect)) && "function" == typeof Reflect.decorate) a = Reflect.decorate(t, e, o, n); else for (var l = t.length - 1; l >= 0; l--)(i = t[l]) && (a = (u < 3 ? i(a) : u > 3 ? i(e, o, a) : i(e, o)) || a); return u > 3 && a && Object.defineProperty(e, o, a), a }, u = function () { function t(o, n) { e(this, t), this.x = o, this.y = n } return n(t, [{ key: "magnitude", get: function () { return Math.sqrt(this.x * this.x + this.y * this.y) } }, { key: "normalize", get: function () { var e = this.magnitude; return new t(this.x / e, this.y / e) } }, { key: "angle", get: function () { var t = 180 * Math.atan2(this.y, this.x) / Math.PI; return (360 + Math.round(t)) % 360 } }]), t }(); exports.default = u, i([t.computed], u.prototype, "magnitude", null), i([t.computed], u.prototype, "normalize", null), i([t.computed], u.prototype, "angle", null), i([t.observable], u.prototype, "x", void 0), i([t.observable], u.prototype, "y", void 0);
    }, { "mobx": "6uYi" }], "uODF": [function (require, module, exports) {
        "use strict"; var e; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0, function (e) { e.Trimdek = "Trimdek", e.Corrugated = "Corrugated" }(e || (e = {})); var r = e; exports.default = r;
    }, {}], "+ae8": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"); function n(e, n) { if (!(e instanceof n)) throw new TypeError("Cannot call a class as a function") } function t(e, n) { for (var t = 0; t < n.length; t++) { var o = n[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function o(e, n, o) { return n && t(e.prototype, n), o && t(e, o), e } function r(e) { return (r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var a = function (e, n, t, o) { var a, i = arguments.length, u = i < 3 ? n : null === o ? o = Object.getOwnPropertyDescriptor(n, t) : o; if ("object" === ("undefined" == typeof Reflect ? "undefined" : r(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, n, t, o); else for (var l = e.length - 1; l >= 0; l--)(a = e[l]) && (u = (i < 3 ? a(u) : i > 3 ? a(n, t, u) : a(n, t)) || u); return i > 3 && u && Object.defineProperty(n, t, u), u }, i = function () { function e() { var t = this; n(this, e), this.lookupMap = {}; this.colours = [{ hex: "#ABB3B2", name: "Zinc" }, { hex: "#68120c", name: "Heritage Red" }, { hex: "#6a3d29", name: "Territory" }, { hex: "#685d51", name: "Jasmin Brown" }, { hex: "#e8d5af", name: "Smooth Cream" }, { hex: "#dddacc", name: "Off White" }, { hex: "#bfbaa0", name: "Dusk" }, { hex: "#c7b79a", name: "Merino" }, { hex: "#7b8282", name: "Armour Grey" }, { hex: "#a9a59c", name: "Birch" }, { hex: "#b1b6b1", name: "Gull Grey" }, { hex: "#424541", name: "Slate Grey" }, { hex: "#656669", name: "Basal" }, { hex: "#777572", name: "Wallaroo" }, { hex: "#7f776e", name: "Gulf" }, { hex: "#9e9784", name: "Coventry" }, { hex: "#6a6e5e", name: "Manteal" }, { hex: "#2d2e32", name: "Monolith" }, { hex: "#7c846a", name: "Mist Green" }, { hex: "#084a39", name: "Caulfield Green" }, { hex: "#273b50", name: "Mountain Blue" }, { hex: "#343e4c", name: "Iron Grey" }, { hex: "#000000", name: "Ebony" }].sort(function (e, n) { var t = e.name.toUpperCase(), o = n.name.toUpperCase(); return t < o ? -1 : t > o ? 1 : 0 }).map(function (e) { return e.id = e.name.split(" ").join("-").toLowerCase(), t.lookupMap[e.id] = e, e }) } return o(e, [{ key: "getById", value: function (e) { return this.lookupMap[e] } }]), e }(); a([e.observable], i.prototype, "colours", void 0); var u = new i; exports.default = u;
    }, { "mobx": "6uYi" }], "wK5u": [function (require, module, exports) {
        "use strict"; var e; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0, function (e) { e.Size = "Size", e.Awnings = "Awnings", e.Walls = "Walls", e.Extras = "Extras", e.Colours = "Colours", e.Quote = "Quote" }(e || (e = {})); var s = e; exports.default = s;
    }, {}], "Za+H": [function (require, module, exports) {
        "use strict"; function e(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function t(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function n(e, n, i) { return n && t(e.prototype, n), i && t(e, i), e } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var i = function () { function t() { e(this, t), this.map = {} } return n(t, [{ key: "add", value: function (e, t) { var n = this.map; this.disposeById(e), n[e] = t } }, { key: "get", value: function (e) { return this.map[e] } }, { key: "remove", value: function (e) { var t = this.get(e); return t && delete this.map[e], t } }, { key: "disposeById", value: function (e) { var t = this.get(e); t && t.dispose() } }, { key: "dispose", value: function () { var e = this.map; Object.keys(e).forEach(function (t) { e[t].dispose() }), this.map = {} } }]), t }(); exports.default = i;
    }, {}], "EZis": [function (require, module, exports) {
        "use strict"; var e; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0, function (e) { e.Edit = "Edit", e.Plan = "Plan" }(e || (e = {})); var t = e; exports.default = t;
    }, {}], "M1ol": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = "undefined" != typeof navigator && navigator.userAgent.toLowerCase().indexOf("firefox") > 0; function t(e, t, n) { e.addEventListener ? e.addEventListener(t, n, !1) : e.attachEvent && e.attachEvent("on" + t, function () { n(window.event) }) } function n(e, t) { for (var n = t.slice(0, t.length - 1), o = 0; o < n.length; o++)n[o] = e[n[o].toLowerCase()]; return n } function o(e) { e || (e = ""); for (var t = (e = e.replace(/\s/g, "")).split(","), n = t.lastIndexOf(""); n >= 0;)t[n - 1] += ",", t.splice(n, 1), n = t.lastIndexOf(""); return t } function r(e, t) { for (var n = e.length >= t.length ? e : t, o = e.length >= t.length ? t : e, r = !0, i = 0; i < n.length; i++)-1 === o.indexOf(n[i]) && (r = !1); return r } for (var i = { backspace: 8, tab: 9, clear: 12, enter: 13, return: 13, esc: 27, escape: 27, space: 32, left: 37, up: 38, right: 39, down: 40, del: 46, delete: 46, ins: 45, insert: 45, home: 36, end: 35, pageup: 33, pagedown: 34, capslock: 20, "⇪": 20, ",": 188, ".": 190, "/": 191, "`": 192, "-": e ? 173 : 189, "=": e ? 61 : 187, ";": e ? 59 : 186, "'": 222, "[": 219, "]": 221, "\\": 220 }, a = { "⇧": 16, shift: 16, "⌥": 18, alt: 18, option: 18, "⌃": 17, ctrl: 17, control: 17, "⌘": e ? 224 : 91, cmd: e ? 224 : 91, command: e ? 224 : 91 }, l = [], c = { 16: "shiftKey", 18: "altKey", 17: "ctrlKey" }, f = { 16: !1, 18: !1, 17: !1 }, s = {}, d = 1; d < 20; d++)i["f" + d] = 111 + d; c[e ? 224 : 91] = "metaKey", f[e ? 224 : 91] = !1; var p = "all", u = !1, h = function (e) { return i[e.toLowerCase()] || a[e.toLowerCase()] || e.toUpperCase().charCodeAt(0) }; function v(e) { p = e || "all" } function g() { return p || "all" } function y() { return l.slice(0) } function w(e) { var t = e.target || e.srcElement, n = t.tagName; return !("INPUT" === n || "SELECT" === n || "TEXTAREA" === n || t.isContentEditable) } function O(e) { return "string" == typeof e && (e = h(e)), -1 !== l.indexOf(e) } function m(e, t) { var n = void 0, o = void 0; for (var r in e || (e = g()), s) if (Object.prototype.hasOwnProperty.call(s, r)) for (n = s[r], o = 0; o < n.length;)n[o].scope === e ? n.splice(o, 1) : o++; g() === e && v(t || "all") } function b(e) { var t = e.keyCode || e.which || e.charCode, n = l.indexOf(t); if (n >= 0 && l.splice(n, 1), 93 !== t && 224 !== t || (t = 91), t in f) for (var o in f[t] = !1, a) a[o] === t && (E[o] = !1) } function C(e, t) { for (var i = o(e), l = void 0, c = [], f = void 0, d = 0; d < i.length; d++) { if ((l = i[d].split("+")).length > 1 && (c = n(a, l)), e = "*" === (e = l[l.length - 1]) ? "*" : h(e), t || (t = g()), !s[e]) return; for (var p = 0; p < s[e].length; p++)(f = s[e][p]).scope === t && r(f.mods, c) && (s[e][p] = {}) } } function x(e, t, n) { var o = void 0; if (t.scope === n || "all" === t.scope) { for (var r in o = t.mods.length > 0, f) Object.prototype.hasOwnProperty.call(f, r) && (!f[r] && t.mods.indexOf(+r) > -1 || f[r] && -1 === t.mods.indexOf(+r)) && (o = !1); (0 !== t.mods.length || f[16] || f[18] || f[17] || f[91]) && !o && "*" !== t.shortcut || !1 === t.method(e, t) && (e.preventDefault ? e.preventDefault() : e.returnValue = !1, e.stopPropagation && e.stopPropagation(), e.cancelBubble && (e.cancelBubble = !0)) } } function k(e) { var t = s["*"], n = e.keyCode || e.which || e.charCode; if (-1 === l.indexOf(n) && l.push(n), 93 !== n && 224 !== n || (n = 91), n in f) { for (var o in f[n] = !0, a) a[o] === n && (E[o] = !0); if (!t) return } for (var r in f) Object.prototype.hasOwnProperty.call(f, r) && (f[r] = e[c[r]]); if (E.filter.call(this, e)) { var i = g(); if (t) for (var d = 0; d < t.length; d++)t[d].scope === i && x(e, t[d], i); if (n in s) for (var p = 0; p < s[n].length; p++)x(e, s[n][p], i) } } function E(e, r, i) { var l = o(e), c = [], f = "all", d = document, p = 0; for (void 0 === i && "function" == typeof r && (i = r), "[object Object]" === Object.prototype.toString.call(r) && (r.scope && (f = r.scope), r.element && (d = r.element)), "string" == typeof r && (f = r); p < l.length; p++)c = [], (e = l[p].split("+")).length > 1 && (c = n(a, e)), (e = "*" === (e = e[e.length - 1]) ? "*" : h(e)) in s || (s[e] = []), s[e].push({ scope: f, mods: c, shortcut: l[p], method: i, key: l[p] }); void 0 === d || u || (u = !0, t(d, "keydown", function (e) { k(e) }), t(d, "keyup", function (e) { b(e) })) } var P = { setScope: v, getScope: g, deleteScope: m, getPressedKeyCodes: y, isPressed: O, filter: w, unbind: C }; for (var j in P) Object.prototype.hasOwnProperty.call(P, j) && (E[j] = P[j]); if ("undefined" != typeof window) { var L = window.hotkeys; E.noConflict = function (e) { return e && window.hotkeys === E && (window.hotkeys = L), E }, window.hotkeys = E } var K = E; exports.default = K;
    }, {}], "j/0p": [function (require, module, exports) {
        "use strict"; var t = i(require("babylonjs")); function i(t) { if (t && t.__esModule) return t; var i = {}; if (null != t) for (var r in t) if (Object.prototype.hasOwnProperty.call(t, r)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(t, r) : {}; o.get || o.set ? Object.defineProperty(i, r, o) : i[r] = t[r] } return i.default = t, i } var r = t.Matrix, o = t.Vector3, e = t.Tmp, a = t.Quaternion, s = t.TransformNode, n = t.Node.prototype.addToSceneRootNodes; t.Node.prototype.addToSceneRootNodes = function () { this._isDisposed || n.apply(this, arguments) }; var h = t.Node.prototype.dispose; t.Node.prototype.dispose = function () { this._isDisposed = !0, h.apply(this, arguments) }; for (var l = [], d = 0; d < 256; d++)l[d] = (d < 16 ? "0" : "") + d.toString(16); t.Tools.RandomId = function () { var t = 4294967295 * Math.random() | 0, i = 4294967295 * Math.random() | 0, r = 4294967295 * Math.random() | 0, o = 4294967295 * Math.random() | 0; return l[255 & t] + l[t >> 8 & 255] + l[t >> 16 & 255] + l[t >> 24 & 255] + "-" + l[255 & i] + l[i >> 8 & 255] + "-" + l[i >> 16 & 15 | 64] + l[i >> 24 & 255] + "-" + l[63 & r | 128] + l[r >> 8 & 255] + "-" + l[r >> 16 & 255] + l[r >> 24 & 255] + l[255 & o] + l[o >> 8 & 255] + l[o >> 16 & 255] + l[o >> 24 & 255] }, t.Bone.prototype.markAsDirty = function () { this._currentRenderId++ , this._childUpdateId++ , this._skeleton._markAsDirty() }, t.Camera.prototype.getViewMatrix = function (t) { return !t && this._isSynchronizedViewMatrix() ? this._computedViewMatrix : (this.updateCache(), this._computedViewMatrix = this._getViewMatrix(), this._currentRenderId = this.getScene().getRenderId(), this._childUpdateId++ , this._refreshFrustumPlanes = !0, this._cameraRigParams && this._cameraRigParams.vrPreViewMatrix && this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix, this._computedViewMatrix), this.onViewMatrixChangedObservable.notifyObservers(this), this._computedViewMatrix.invertToRef(this._worldMatrix), this._computedViewMatrix) }, t.TransformNode.prototype.computeWorldMatrix = function (t) { if (this._isWorldMatrixFrozen) return this._worldMatrix; if (!t && this.isSynchronized()) return this._currentRenderId = this.getScene().getRenderId(), this._worldMatrix; (this._updateCache(), this._cache.position.copyFrom(this.position), this._cache.scaling.copyFrom(this.scaling), this._cache.pivotMatrixUpdated = !1, this._cache.billboardMode = this.billboardMode, this._currentRenderId = this.getScene().getRenderId(), this._childUpdateId++ , this._isDirty = !1, r.ScalingToRef(this.scaling.x * this.scalingDeterminant, this.scaling.y * this.scalingDeterminant, this.scaling.z * this.scalingDeterminant, e.Matrix[1]), this.rotationQuaternion) && (this.rotation.length() && (this.rotationQuaternion.multiplyInPlace(a.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z)), this.rotation.copyFromFloats(0, 0, 0))); this.rotationQuaternion ? (this.rotationQuaternion.toRotationMatrix(e.Matrix[0]), this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)) : (r.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, e.Matrix[0]), this._cache.rotation.copyFrom(this.rotation)); var i = this.getScene().activeCamera; if (this.infiniteDistance && !this.parent && i) { var n = i.getWorldMatrix(), h = new o(n.m[12], n.m[13], n.m[14]); r.TranslationToRef(this.position.x + h.x, this.position.y + h.y, this.position.z + h.z, e.Matrix[2]) } else r.TranslationToRef(this.position.x, this.position.y, this.position.z, e.Matrix[2]); if (this._pivotMatrix.multiplyToRef(e.Matrix[1], e.Matrix[4]), e.Matrix[4].multiplyToRef(e.Matrix[0], e.Matrix[5]), this.billboardMode !== s.BILLBOARDMODE_NONE && i) { if ((this.billboardMode & s.BILLBOARDMODE_ALL) !== s.BILLBOARDMODE_ALL) { var l = e.Vector3[3]; this.parent && this.parent.getWorldMatrix ? this._transformToBoneReferal ? (this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), e.Matrix[6]), o.TransformCoordinatesToRef(this.position, e.Matrix[6], l)) : o.TransformCoordinatesToRef(this.position, this.parent.getWorldMatrix(), l) : l.copyFrom(this.position), l.subtractInPlace(i.globalPosition); var d = e.Vector3[4].copyFromFloats(0, 0, 0); (this.billboardMode & s.BILLBOARDMODE_X) === s.BILLBOARDMODE_X && (d.x = Math.atan2(-l.y, l.z)), (this.billboardMode & s.BILLBOARDMODE_Y) === s.BILLBOARDMODE_Y && (d.y = Math.atan2(l.x, l.z)), (this.billboardMode & s.BILLBOARDMODE_Z) === s.BILLBOARDMODE_Z && (d.z = Math.atan2(l.y, l.x)), r.RotationYawPitchRollToRef(d.y, d.x, d.z, e.Matrix[0]) } else e.Matrix[1].copyFrom(i.getViewMatrix()), e.Matrix[1].setTranslationFromFloats(0, 0, 0), e.Matrix[1].invertToRef(e.Matrix[0]); e.Matrix[1].copyFrom(e.Matrix[5]), e.Matrix[1].multiplyToRef(e.Matrix[0], e.Matrix[5]) } return this._postMultiplyPivotMatrix && e.Matrix[5].multiplyToRef(this._pivotMatrixInverse, e.Matrix[5]), e.Matrix[5].multiplyToRef(e.Matrix[2], this._localWorld), this.parent && this.parent.getWorldMatrix ? (this.billboardMode !== s.BILLBOARDMODE_NONE ? (this._transformToBoneReferal ? (this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), e.Matrix[6]), e.Matrix[5].copyFrom(e.Matrix[6])) : e.Matrix[5].copyFrom(this.parent.getWorldMatrix()), this._localWorld.getTranslationToRef(e.Vector3[5]), o.TransformCoordinatesToRef(e.Vector3[5], e.Matrix[5], e.Vector3[5]), this._worldMatrix.copyFrom(this._localWorld), this._worldMatrix.setTranslation(e.Vector3[5])) : this._transformToBoneReferal ? (this._localWorld.multiplyToRef(this.parent.getWorldMatrix(), e.Matrix[6]), e.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), this._worldMatrix)) : this._localWorld.multiplyToRef(this.parent.getWorldMatrix(), this._worldMatrix), this._markSyncedWithParent()) : this._worldMatrix.copyFrom(this._localWorld), this.ignoreNonUniformScaling ? this._updateNonUniformScalingState(!1) : this.scaling.isNonUniform ? this._updateNonUniformScalingState(!0) : this.parent && this.parent._nonUniformScaling ? this._updateNonUniformScalingState(this.parent._nonUniformScaling) : this._updateNonUniformScalingState(!1), this._afterComputeWorldMatrix(), this._absolutePosition.copyFromFloats(this._worldMatrix.m[12], this._worldMatrix.m[13], this._worldMatrix.m[14]), this.onAfterWorldMatrixUpdateObservable.notifyObservers(this), this._poseMatrix || (this._poseMatrix = r.Invert(this._worldMatrix)), this._worldMatrixDeterminant = this._worldMatrix.determinant(), this._worldMatrix }, t.Node.prototype._parentUpdateId = -1, t.Node.prototype._childUpdateId = -1, t.Node.prototype._markSyncedWithParent = function () { this._parentNode && (this._parentUpdateId = this._parentNode._childUpdateId) }, t.Node.prototype.isSynchronizedWithParent = function () { return !this._parentNode || this._parentUpdateId === this._parentNode._childUpdateId && this._parentNode.isSynchronized() };
    }, { "babylonjs": "S+Ze" }], "94gV": [function (require, module, exports) {
        "use strict"; function e(e) { return { factory: function () { return {} }, props: e } } function r(e) { if (e) throw new Error(e) } function t(e) { var r = !1; return function () { if (!r) return r = !0, e.apply(null, arguments); n(!1, "callback was invoked twice") } } function n(e, r) { if (!e) throw new Error("[serializr] " + (r || "Illegal State")) } function i(e, r, t) { if (0 !== e.length) { var n = e.length, i = [], o = !1; e.forEach(function (e, s) { r(e, function (e, r, s) { r ? o || (o = !0, t(r)) : (i[e] = s, 0 == --n && t(null, i)) }.bind(null, s)) }) } else t(null, []) } function o(e) { return null === e || "object" != typeof e && "function" != typeof e } function s(e) { return e && e.factory && e.props } function a(e) { return e && e.serializer && e.deserializer } function u(e) { return "object" == typeof e && !!e.jsonname } function c(e) { return "object" == typeof e && !0 === e.identifier } function l(e, r) { for (; e;) { if (e === r) return !0; e = e.extends } return !1 } function f(e) { return e && "function" == typeof e.keys && "function" == typeof e.clear } function p(e) { for (n(s(e)); e;) { for (var r in e.props) if ("object" == typeof e.props[r] && !0 === e.props[r].identifier) return r; e = e.extends } return null } function d(e) { return e ? s(e) ? e : s(e.serializeInfo) ? e.serializeInfo : e.constructor && e.constructor.serializeInfo ? e.constructor.serializeInfo : void 0 : null } function h(e, r) { return n(s(r)), e.serializeInfo = r } function m(e, r, t) { n(e !== Object, "one cannot simply put define a model schema for Object"), n("function" == typeof e, "expected constructor function"); var i = { targetClass: e, factory: t || function () { return new e }, props: r }; if (e.prototype.constructor !== Object) { var o = d(e.prototype.constructor); o && o.targetClass !== e && (i.extends = o) } return h(e, i), i } function g() { return { serializer: function (e) { return n(o(e), "this value is not primitive: " + e), e }, deserializer: function (e, r) { o(e) ? r(null, e) : r("[serializr] this value is not primitive: " + e) } } } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.createSimpleSchema = e, exports.createModelSchema = m, exports.getDefaultModelSchema = d, exports.setDefaultModelSchema = h, exports.serializable = R, exports.serialize = C, exports.serializeAll = k, exports.deserialize = I, exports.deserializeObjectWithSchema = P, exports.update = D, exports.primitive = g, exports.identifier = K, exports.date = F, exports.alias = J, exports.custom = _, exports.child = exports.object = q, exports.ref = exports.reference = U, exports.list = W, exports.map = $, exports.mapAsArray = B, exports.raw = G, exports.SKIP = void 0; var y = "undefined" != typeof Symbol ? Symbol("SKIP") : { SKIP: !0 }; exports.SKIP = y; var v = g(), b = /((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm, x = /([^\s,]+)/g; function z(e) { var r = e.toString().replace(b, ""), t = r.slice(r.indexOf("(") + 1, r.indexOf(")")).match(x); return null === t && (t = []), t } function j(e, r, t, i) { var o; if (n(arguments.length >= 2, "too few arguments. Please use @serializable as property decorator"), void 0 === t && "function" == typeof r && r.prototype && void 0 !== i && "number" == typeof i) { n(a(e), "Constructor params must use alias(name)"), n(e.jsonname, "Constructor params must use alias(name)"); var s = z(r); s.length >= i && (t = s[i], e.paramNumber = i, i = void 0, r = r.prototype, o = function (e) { for (var t = [], n = 0; n < r.constructor.length; n++)Object.keys(e.modelSchema.props).forEach(function (r) { var i = e.modelSchema.props[r]; i.paramNumber === n && (t[n] = e.json[i.jsonname]) }); return new (Function.prototype.bind.apply(r.constructor, [null].concat(t))) }) } n("string" == typeof t, "incorrect usage of @serializable decorator"); var u = d(r); return u && r.constructor.hasOwnProperty("serializeInfo") || (u = m(r.constructor, {}, o)), u && u.targetClass !== r.constructor && (u = m(r.constructor, {}, o)), u.props[t] = e, !i || i.get || i.set || (i.writable = !0), i } function R(e, r, t) { if (1 === arguments.length) { var i = !0 === e ? v : e; return n(a(i), "@serializable expects prop schema"), j.bind(null, i) } return j(g(), e, r, t) } function C(e, r) { n(1 === arguments.length || 2 === arguments.length, "serialize expects one or 2 arguments"); var t = 1 === arguments.length ? e : r, i = 1 === arguments.length ? null : e; if (Array.isArray(t)) { if (0 === t.length) return []; i || (i = d(t[0])) } else i || (i = d(t)); return n(!!i, "Failed to find default schema for " + e), Array.isArray(t) ? t.map(function (e) { return S(i, e) }) : S(i, t) } function S(e, r) { var t; return n(e && "object" == typeof e, "Expected schema"), n(r && "object" == typeof r, "Expected object"), t = e.extends ? S(e.extends, r) : {}, Object.keys(e.props).forEach(function (i) { var o = e.props[i]; if ("*" === i) return n(!0 === o, "prop schema '*' can onle be used with 'true'"), void w(e, r, t); if (!0 === o && (o = v), !1 !== o) { var s = o.serializer(r[i], i, r); s !== y && (t[o.jsonname || i] = s) } }), t } function w(e, r, t) { for (var n in r) if (r.hasOwnProperty(n) && !(n in e.props)) { var i = r[n]; o(i) && (t[n] = i) } } function k(e) { n(1 === arguments.length && "function" == typeof e, "@serializeAll can only be used as class decorator"); var r = d(e); return r && e.hasOwnProperty("serializeInfo") || h(e, r = m(e, {})), d(e).props["*"] = !0, e } function O(e, t, n, i, o) { this.parentContext = e, this.isRoot = !e, this.pendingCallbacks = 0, this.pendingRefsCount = 0, this.onReadyCb = i || r, this.json = n, this.target = null, this.hasError = !1, this.modelSchema = t, this.isRoot ? (this.rootContext = this, this.args = o, this.pendingRefs = {}, this.resolvedRefs = {}) : (this.rootContext = e.rootContext, this.args = e.args) } function E(e, r) { for (var t in e.props) if ("object" == typeof e.props[t] && e.props[t].jsonname === r) return !0; return !1 } function A(e, r, t) { for (var i in t) if (!(i in e.props || E(e, i))) { var s = t[i]; n(o(s), "encountered non primitive value while deserializing '*' properties in property '" + i + "': " + s), r[i] = s } } function I(e, t, o, a) { if (n(arguments.length >= 2, "deserialize expects at least 2 arguments"), n(s(e = d(e)), "first argument should be model schema"), Array.isArray(t)) { var u = []; return i(t, function (r, t) { var n = P(null, e, r, t, a); u.push(n) }, o || r), u } return P(null, e, t, o, a) } function P(e, t, i, o, s) { if (null != i) { var a = new O(e, t, i, o, s), u = t.factory(a); n(!!u, "No object returned from factory"), a.target = u; var c = a.createCallback(r); return N(a, t, i, u), c(), u } o(null, null) } function N(e, r, t, i) { r.extends && N(e, r.extends, t, i), Object.keys(r.props).forEach(function (o) { var s = r.props[o]; if ("*" === o) return n(!0 === s, "prop schema '*' can onle be used with 'true'"), void A(r, i, t); if (!0 === s && (s = v), !1 !== s) { var a = s.jsonname || o; a in t && s.deserializer(t[a], e.rootContext.createCallback(function (e) { e !== y && (i[o] = e) }), e, i[o]) } }) } function D(e, t, i, o, a) { 2 === arguments.length || "function" == typeof arguments[2] ? (e = d(t = arguments[0]), i = arguments[1], o = arguments[2], a = arguments[3]) : e = d(e), n(s(e), "update failed to determine schema"), n("object" == typeof t && t && !Array.isArray(t), "update needs an object"); var u = new O(null, e, i, o, a); u.target = t; var c = u.createCallback(r); N(u, e, i, t), c() } function M(e, r, t) { t.rootContext.resolve(t.modelSchema, e, t.target) } function K(e) { return n(!e || "function" == typeof e, "First argument should be omitted or function"), { identifier: !0, serializer: v.serializer, deserializer: function (r, t, n) { v.deserializer(r, function (r, i) { M(i, n.target, n), e && e(i, n.target, n), t(r, i) }) } } } function F() { return { serializer: function (e) { return null == e ? e : (n(e instanceof Date, "Expected Date object"), e.getTime()) }, deserializer: function (e, r) { r(null, null != e ? new Date(e) : e) } } } function J(e, r) { return n(e && "string" == typeof e, "expected prop name as first argument"), n(a(r = r && !0 !== r ? r : v), "expected prop schema as second argument"), n(!u(r), "provided prop is already aliased"), { jsonname: e, serializer: r.serializer, deserializer: r.deserializer, identifier: c(r) } } function _(e, r) { return n("function" == typeof e, "first argument should be function"), n("function" == typeof r, "second argument should be a function or promise"), { serializer: e, deserializer: function (e, t, n, i) { 4 === r.length ? r(e, n, i, t) : t(null, r(e, n, i)) } } } function q(e) { return n("object" == typeof e || "function" == typeof e, "No modelschema provided. If you are importing it from another file be aware of circular dependencies."), { serializer: function (r) { return n(s(e = d(e)), "expected modelSchema, got " + e), null == r ? r : C(e, r) }, deserializer: function (r, t, i) { n(s(e = d(e)), "expected modelSchema, got " + e), null != r ? P(i, e, r, t) : t(null, r) } } } function T(e) { return function (r, t, n) { n.rootContext.await(e, r, t) } } function U(e, r) { n(!!e, "No modelschema provided. If you are importing it from another file be aware of circular dependencies."); var t, i = !1; function o() { if (i = !0, n("string" != typeof e || r, "if the reference target is specified by attribute name, a lookup function is required"), n(!r || "function" == typeof r, "second argument should be a lookup function"), "string" == typeof e) t = e; else { var o = d(e); n(s(o), "expected model schema or string as first argument for 'ref', got " + o), r = r || T(o), n(!!(t = p(o)), "provided model schema doesn't define an identifier() property and cannot be used by 'ref'.") } } return { serializer: function (e) { return i || o(), e ? e[t] : null }, deserializer: function (e, t, n) { i || o(), null == e ? t(null, e) : r(e, t, n) } } } function W(e) { return n(a(e = e || v), "expected prop schema as first argument"), n(!u(e), "provided prop is aliased, please put aliases first"), { serializer: function (r) { return n(r && "length" in r && "map" in r, "expected array (like) object"), r.map(e.serializer) }, deserializer: function (r, t, n) { Array.isArray(r) ? i(r, function (r, t) { return e.deserializer(r, t, n) }, t) : t("[serializr] expected JSON array") } } } function $(e) { return n(a(e = e || v), "expected prop schema as first argument"), n(!u(e), "provided prop is aliased, please put aliases first"), { serializer: function (r) { n(r && "object" == typeof r, "expected object or Map"); var t = f(r), i = {}; if (t) r.forEach(function (r, t) { i[t] = e.serializer(r) }); else for (var o in r) i[o] = e.serializer(r[o]); return i }, deserializer: function (r, t, n, i) { if (r && "object" == typeof r) { var o = Object.keys(r); W(e).deserializer(o.map(function (e) { return r[e] }), function (e, r) { if (e) t(e); else { var n, s = f(i); s ? (i.clear(), n = i) : n = {}; for (var a = 0, u = o.length; a < u; a++)s ? n.set(o[a], r[a]) : n[o[a]] = r[a]; t(null, n) } }, n) } else t("[serializr] expected JSON object") } } } function B(e, r) { return n(a(e = e || v), "expected prop schema as first argument"), n(!!r, "expected key property name as second argument"), { serializer: function (r) { var t = []; return r.forEach(function (r, n) { t.push(e.serializer(r)) }), t }, deserializer: function (t, n, i, o) { W(e).deserializer(t, function (e, i) { if (e) n(e); else { var s, a = f(o); a ? (o.clear(), s = o) : s = {}; for (var u = 0, c = t.length; u < c; u++)a ? s.set(i[u][r], i[u]) : s[i[u][r].toString()] = i[u]; n(null, s) } }, i) } } } function G() { return { serializer: function (e) { return e }, deserializer: function (e, r) { r(null, e) } } } O.prototype.createCallback = function (e) { return this.pendingCallbacks++ , t(function (r, t) { r ? this.hasError || (this.hasError = !0, this.onReadyCb(r)) : this.hasError || (e(t), --this.pendingCallbacks === this.pendingRefsCount && (this.pendingRefsCount > 0 ? this.onReadyCb(new Error('Unresolvable references in json: "' + Object.keys(this.pendingRefs).filter(function (e) { return this.pendingRefs[e].length > 0 }, this).join('", "') + '"')) : this.onReadyCb(null, this.target))) }.bind(this)) }, O.prototype.await = function (e, r, t) { if (n(this.isRoot), r in this.resolvedRefs) { var i = this.resolvedRefs[r].filter(function (r) { return l(r.modelSchema, e) })[0]; if (i) return void t(null, i.value) } this.pendingRefsCount++ , this.pendingRefs[r] || (this.pendingRefs[r] = []), this.pendingRefs[r].push({ modelSchema: e, uuid: r, callback: t }) }, O.prototype.resolve = function (e, r, t) { if (n(this.isRoot), this.resolvedRefs[r] || (this.resolvedRefs[r] = []), this.resolvedRefs[r].push({ modelSchema: e, value: t }), r in this.pendingRefs) for (var i = this.pendingRefs[r].length - 1; i >= 0; i--) { var o = this.pendingRefs[r][i]; l(e, o.modelSchema) && (this.pendingRefs[r].splice(i, 1), this.pendingRefsCount-- , o.callback(null, t)) } };
    }, {}], "wZmN": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.Padding = exports.Layout = exports.Align = exports.ModelType = void 0; var e = require("mobx"), t = require("serializr"); function o(e, t) { for (var o = 0; o < t.length; o++) { var i = t[o]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function i(e, t, i) { return t && o(e.prototype, t), i && o(e, i), e } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function n(e) { return (n = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var l, a, p, s = function (e, t, o, i) { var r, l = arguments.length, a = l < 3 ? t : null === i ? i = Object.getOwnPropertyDescriptor(t, o) : i; if ("object" === ("undefined" == typeof Reflect ? "undefined" : n(Reflect)) && "function" == typeof Reflect.decorate) a = Reflect.decorate(e, t, o, i); else for (var p = e.length - 1; p >= 0; p--)(r = e[p]) && (a = (l < 3 ? r(a) : l > 3 ? r(t, o, a) : r(t, o)) || a); return l > 3 && a && Object.defineProperty(t, o, a), a }; exports.ModelType = l, function (e) { e.PADoor = "PADoor", e.Window = "Window", e.RollerDoor = "Roller Door", e.MetalSlidingDoor = "Metal Sliding Door", e.GlassSlidingDoor = "Glass Sliding Door", e.Opening = "Opening", e.Skylight = "Skylight", e.Whirlybird = "Whirlybird" }(l || (exports.ModelType = l = {})), exports.Align = a, function (e) { e[e.Auto = 0] = "Auto", e[e.Right = 1] = "Right", e[e.Left = 2] = "Left" }(a || (exports.Align = a = {})), exports.Layout = p, function (e) { e.Auto = "Auto", e.Fixed = "Fixed" }(p || (exports.Layout = p = {})); var u = function e(t) { r(this, e), this.right = 0, this.left = 0, this.top = 0, this.bottom = 0, "number" == typeof t && (this.right = this.left = this.top = this.bottom = t) }; exports.Padding = u, s([t.serializable], u.prototype, "right", void 0), s([t.serializable], u.prototype, "left", void 0), s([t.serializable], u.prototype, "top", void 0), s([t.serializable], u.prototype, "bottom", void 0); var f = function () { function e() { r(this, e), this.layout = p.Fixed, this.align = a.Auto, this.type = l.PADoor, this.padding = new u } return i(e, [{ key: "toJson", value: function () { return (0, t.serialize)(this) } }]), e }(); s([t.serializable, e.observable], f.prototype, "layout", void 0), s([t.serializable, e.observable], f.prototype, "align", void 0), s([t.serializable, e.observable], f.prototype, "type", void 0), s([e.observable], f.prototype, "padding", void 0); var y = f; exports.default = y;
    }, { "mobx": "6uYi", "serializr": "94gV" }], "6a89": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.WindowTypes = void 0; var e = n(require("./Model")), t = require("serializr"), r = require("mobx"); function n(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function o(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function u(e, t, r) { return t && i(e.prototype, t), r && i(e, r), e } function f(e, t) { return !t || "object" !== s(t) && "function" != typeof t ? c(e) : t } function c(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function p(e) { return (p = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function l(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) } function a(e, t) { return (a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function s(e) { return (s = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var y, d = function (e, t, r, n) { var o, i = arguments.length, u = i < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, r) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : s(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, t, r, n); else for (var f = e.length - 1; f >= 0; f--)(o = e[f]) && (u = (i < 3 ? o(u) : i > 3 ? o(t, r, u) : o(t, r)) || u); return i > 3 && u && Object.defineProperty(t, r, u), u }; exports.WindowTypes = y, function (e) { e.W790X589 = "790 x 589mm", e.W790X816 = "790 x 816mm", e.W790X1274 = "790 x 1274mm", e.W790X1505 = "790 x 1505mm", e.W790X1731 = "790 x 1731mm" }(y || (exports.WindowTypes = y = {})); var b = Object.keys(y), h = {}, g = .02; b.forEach(function (e) { var t = y[e], r = t.split("mm").join().split(" x "); h[t] = [{ x: g, y: g, length: parseInt(r[1], 10) / 1e3, height: parseInt(r[0], 10) / 1e3 }] }); var m = function (t) { function r() { var t; return o(this, r), (t = f(this, p(r).call(this))).windowType = y.W790X1274, t.x = 0, t.y = 0, t.type = e.ModelType.Window, t.windowType = y.W790X1274, t.padding = new e.Padding(.02), t.padding.bottom = t.padding.bottom + 1.26, t.padding.top = .2, t } return l(r, e.default), u(r, [{ key: "getCutHoles", value: function () { return h[this.windowType] } }, { key: "width", get: function () { return this.getCutHoles()[0].length + 2 * g } }, { key: "height", get: function () { return this.getCutHoles()[0].height + 2 * g } }, { key: "maxHeight", get: function () { return this.height } }, { key: "minHeight", get: function () { return this.height } }, { key: "maxWidth", get: function () { return this.width } }, { key: "minWidth", get: function () { return this.width } }]), r }(); d([t.serializable], m.prototype, "windowType", void 0), d([t.serializable, r.observable], m.prototype, "x", void 0), d([t.serializable, r.observable], m.prototype, "y", void 0); var w = m; exports.default = w;
    }, { "./Model": "wZmN", "serializr": "94gV", "mobx": "6uYi" }], "y87A": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.OpenDirection = exports.SlidingDoorType = void 0; var e = require("serializr"), t = require("mobx"), r = o(require("./Model")); function o(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; o.get || o.set ? Object.defineProperty(t, r, o) : t[r] = e[r] } return t.default = e, t } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var r = 0; r < t.length; r++) { var o = t[r]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function p(e, t, r) { return t && i(e.prototype, t), r && i(e, r), e } function l(e, t) { return !t || "object" !== y(t) && "function" != typeof t ? u(e) : t } function u(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function c(e) { return (c = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function f(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) } function a(e, t) { return (a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function y(e) { return (y = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var s, d, b = function (e, t, r, o) { var n, i = arguments.length, p = i < 3 ? t : null === o ? o = Object.getOwnPropertyDescriptor(t, r) : o; if ("object" === ("undefined" == typeof Reflect ? "undefined" : y(Reflect)) && "function" == typeof Reflect.decorate) p = Reflect.decorate(e, t, r, o); else for (var l = e.length - 1; l >= 0; l--)(n = e[l]) && (p = (i < 3 ? n(p) : i > 3 ? n(t, r, p) : n(t, r)) || p); return i > 3 && p && Object.defineProperty(t, r, p), p }; exports.SlidingDoorType = s, function (e) { e.Single = "Single", e.Double = "Double", e.Triple = "Triple" }(s || (exports.SlidingDoorType = s = {})), exports.OpenDirection = d, function (e) { e.Right = "Right", e.Left = "Left" }(d || (exports.OpenDirection = d = {})); var g = function (e) { function t() { var e; return n(this, t), (e = l(this, c(t).call(this))).width = 5, e.height = 8, e.x = 0, e.y = 0, e.slidingDoorType = s.Single, e.openDirection = d.Left, e.type = r.ModelType.MetalSlidingDoor, e.padding = new r.Padding(.01), e.padding.top = .4, e.padding.bottom = 0, e } return f(t, r.default), p(t, [{ key: "maxHeight", get: function () { return 10 } }, { key: "minHeight", get: function () { return 0 } }, { key: "maxWidth", get: function () { return 22 } }, { key: "minWidth", get: function () { return 0 } }]), t }(); b([e.serializable], g.prototype, "width", void 0), b([e.serializable], g.prototype, "height", void 0), b([e.serializable, t.observable], g.prototype, "x", void 0), b([e.serializable, t.observable], g.prototype, "y", void 0), b([e.serializable], g.prototype, "slidingDoorType", void 0), b([e.serializable], g.prototype, "openDirection", void 0); var h = g; exports.default = h;
    }, { "serializr": "94gV", "mobx": "6uYi", "./Model": "wZmN" }], "tINm": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"), t = o(require("./States")); function o(e) { return e && e.__esModule ? e : { default: e } } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function r(e, t) { for (var o = 0; o < t.length; o++) { var n = t[o]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function i(e, t, o) { return t && r(e.prototype, t), o && r(e, o), e } function u(e) { return (u = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var f = function (e, t, o, n) { var r, i = arguments.length, f = i < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, o) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : u(Reflect)) && "function" == typeof Reflect.decorate) f = Reflect.decorate(e, t, o, n); else for (var l = e.length - 1; l >= 0; l--)(r = e[l]) && (f = (i < 3 ? r(f) : i > 3 ? r(t, o, f) : r(t, o)) || f); return i > 3 && f && Object.defineProperty(t, o, f), f }, l = function () { function e() { n(this, e), this.id = t.default.Extras, this.editing = [] } return i(e, [{ key: "reset", value: function () { this.editing = [] } }, { key: "onEnter", value: function () { this.reset() } }, { key: "onExit", value: function () { this.reset() } }]), e }(); exports.default = l, f([e.observable], l.prototype, "id", void 0), f([e.observable], l.prototype, "editing", void 0);
    }, { "mobx": "6uYi", "./States": "wK5u" }], "4klJ": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.MaterialType = void 0; var e, n, o = p(require("babylonjs")), t = d(require("../RenderUtils")), r = require("../../../../stores/model/Model"), i = require("../../../../stores/model/Window"), a = require("../Babylon"), s = require("../../../../stores/model/MetalSlidingDoor"), l = d(require("../../../../stores/editorStates/Extras")); function d(e) { return e && e.__esModule ? e : { default: e } } function p(e) { if (e && e.__esModule) return e; var n = {}; if (null != e) for (var o in e) if (Object.prototype.hasOwnProperty.call(e, o)) { var t = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, o) : {}; t.get || t.set ? Object.defineProperty(n, o, t) : n[o] = e[o] } return n.default = e, n } function c(e) { return (c = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function h(e, n, o) { return n in e ? Object.defineProperty(e, n, { value: o, enumerable: !0, configurable: !0, writable: !0 }) : e[n] = o, e } var u = ["glass-sliding-door.babylon", "pa-door.babylon", "whirlybird.babylon"], f = {}; u.forEach(function (e) { f[e] = e }); var g, y = (h(e = {}, i.WindowTypes.W790X589, "window790x589.babylon"), h(e, i.WindowTypes.W790X816, "window790x816.babylon"), h(e, i.WindowTypes.W790X1274, "window790x1274.babylon"), h(e, i.WindowTypes.W790X1505, "window790x1505.babylon"), h(e, i.WindowTypes.W790X1731, "window790x1731.babylon"), e); exports.MaterialType = g, function (e) { e[e.Door = 0] = "Door", e[e.Flashing = 1] = "Flashing" }(g || (exports.MaterialType = g = {})); var m = {}; function w(e, n, t) { var r = n + " " + t; if (!m[r]) { var i = o.MeshBuilder.CreatePlane("plane", { width: n, height: t, sideOrientation: o.Mesh.DOUBLESIDE }, e.scene); i.material = e.materials.glass, i.setEnabled(!1), m[r] = i } var a = m[r].createInstance("glass instance"); return a.position.y = t / 2, a } var b = {}, v = {}; function D(e, n) { var t = !(arguments.length > 2 && void 0 !== arguments[2]) || arguments[2]; return new Promise(function (r, i) { if (b[n]) r(b[n]); else if (v[n]) v[n].then(function () { r(b[n]) }).catch(i); else { var a = o.SceneLoader.ImportMeshAsync(null, "./models/", n.split("/").join(""), e).then(function (e) { var i = e.meshes; i.forEach(function (e) { e.setEnabled(!1), e instanceof o.Mesh && t && e.convertToFlatShadedMesh() }), b[n] = i, delete v[n], r(b[n]) }).catch(i); v[n] = a } }).then(function (e) { return e.map(function (e) { return e.createInstance(e.id) }) }) } function T(e) { var n = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1], t = e.name; return function (r) { var i = r.scene, a = r.bindActions, s = new o.TransformNode("modelNode", i); return D(i, t, n).then(function (n) { var t = e.material; t && (t instanceof o.Material ? n.map(function (e) { e.sourceMesh.material = t }) : "object" === c(t) && n.map(function (e) { e.sourceMesh.material = t[e.id] })), s.isDisposed() ? n.map(function (e) { e.dispose() }) : (n.map(function (e) { e.parent = s }), a(i, s)) }), { node: s, hole: e.hole } } } var O = (h(n = {}, r.ModelType.Window, function (e) { var n = e.model, t = n.getCutHoles()[0], r = { x: 0, y: 1.24, length: t.length, height: t.height }, i = e.scene, a = new o.StandardMaterial("frame", i); a.diffuseColor = new o.Color3(0, 0, 0); var s = y[n.windowType], l = T({ type: g.Flashing, name: s, hole: r, material: { frame: a, flashing: e.renderOptions.materials.window } })(e); return w(e.renderOptions, r.length, r.height).parent = l.node, l.node.onDisposeObservable.addOnce(function () { a.dispose() }), l }), h(n, r.ModelType.PADoor, function (e) { return T({ type: g.Door, name: f["pa-door.babylon"], hole: { y: 0, x: 0, length: .823, height: 2.03 }, material: e.renderOptions.materials.paDoor })(e) }), h(n, r.ModelType.GlassSlidingDoor, function (e) { var n = { y: 0, x: -e.model.padding.left, length: 1.95, height: 2 }, t = new o.StandardMaterial("frame", e.scene); t.diffuseColor = new o.Color3(0, 0, 0); var r = T({ type: g.Door, name: f["glass-sliding-door.babylon"], hole: n, material: { glass: e.renderOptions.materials.glass, door: e.renderOptions.materials.glassSlidingDoor, sticker: t } })(e); return r.node.onDisposeObservable.addOnce(function () { t.dispose() }), r }), h(n, r.ModelType.RollerDoor, function (e) { var n = e.scene, r = e.renderOptions, i = e.layout, a = i.width, s = i.height, l = new o.TransformNode("rollerDoorNode", n), d = new o.Vector4(0, 0, a / 1.5, s / 1.5), p = o.MeshBuilder.CreatePlane("plane", { width: a, height: s, sideOrientation: o.Mesh.DOUBLESIDE, frontUVs: d, backUVs: d }, n); p.position.y = s / 2, p.position.z = .099; var c = t.default.createFlashing({ scene: n }); c.rotate(o.Axis.X, t.default.degreesToRadians(-90)), c.locallyTranslate(new o.Vector3(0, .01, 0)), c.scaling = new o.Vector3(.11, .11, .11), c.material = r.materials.rollerDoorFlashing, c.setEnabled(!1), c.receiveShadows = !0; var h = c.createInstance("left"); h.position.x = -a / 2, h.scaling.z = s; var u = c.createInstance("right"); u.position.x = a / 2, u.scaling.z = s, u.rotate(o.Axis.Z, t.default.degreesToRadians(90)); var f = c.createInstance("top"), g = a + .22; f.position.x = -g / 2, f.position.y = s, f.scaling.z = g, f.rotate(o.Axis.Y, t.default.degreesToRadians(90)); var y = o.MeshBuilder.CreatePlane("lock", { width: .25, height: .05, sideOrientation: o.Mesh.DOUBLESIDE }, n), m = y.material = new o.StandardMaterial("lock", n); m.diffuseColor = new o.Color3(0, 0, 0), y.position.z = .098, y.position.y = .8, u.parent = l, h.parent = l, f.parent = l, p.parent = l, y.parent = l, c.parent = l; var w = r.materials.rollerDoor; return w && (p.material = w), p.onDisposeObservable.addOnce(function () { m.dispose() }), { node: l, hole: { y: 0, x: -.2, length: a, height: s } } }), h(n, r.ModelType.MetalSlidingDoor, function (e) { var n, r = e.scene, i = e.renderOptions, l = e.wallType, d = e.layout, p = e.model, c = new o.TransformNode("metalSlidingDoorNode", r), u = d.height, f = d.width, g = new o.Vector4(0, 0, f / 3.5, u / 3.5), y = t.default.createFlashing({ scene: r }); y.rotate(o.Axis.X, t.default.degreesToRadians(-90)), y.locallyTranslate(new o.Vector3(0, .01, 0)), y.scaling = new o.Vector3(.11, .11, .11), y.material = i.materials.metalSlidingDoorFlashing, y.setEnabled(!1); var m = function (e) { var n = new o.TransformNode("door", r), a = e.height, s = e.width, l = y.createInstance("left"); l.position.x = -s / 2, l.scaling.z = a, l.parent = n; var d = y.createInstance("right"); d.position.x = s / 2, d.scaling.z = a, d.rotate(o.Axis.Z, t.default.degreesToRadians(90)), d.parent = n; var p = o.MeshBuilder.CreatePlane("plane", { width: s, height: a, frontUVs: g, backUVs: g, sideOrientation: o.Mesh.DOUBLESIDE }, r); return p.material = i.materials.metalSlidingDoor, p.position.y = e.height / 2, p.position.z = .05, p.parent = n, n }, w = y.createInstance("top"), b = f, v = 2 * b + .22; l === a.PickType.GutterWall ? b *= 2 : v = 2 * b + .22, p.openDirection === s.OpenDirection.Left ? w.position.x = f / 2 - v + .11 : w.position.x = f / 2 * 3 - v + .11, w.position.y = u + .05, w.position.z = -.1, w.scaling.z = v, w.rotate(o.Axis.X, t.default.degreesToRadians(90)), w.rotate(o.Axis.Y, t.default.degreesToRadians(90)), y.parent = c, w.parent = c; var D = (h(n = {}, s.SlidingDoorType.Single, 1), h(n, s.SlidingDoorType.Double, 2), h(n, s.SlidingDoorType.Triple, 3), n)[p.slidingDoorType] || 1, T = f; D > 1 && (T *= 2); for (var O = T / D, x = -T / 2 + O / 2, M = 0, S = 0, E = new o.TransformNode("DoorNode", r), P = 0; P < D; P++) { var V = m({ width: O, height: u }); V.parent = E, V.position.x += M + x, V.position.z = S, M += O, S += .01 } E.parent = c; var I = 0; return D > 1 && (E.position.x = -f / 2, p.openDirection === s.OpenDirection.Right && (E.position.x = -E.position.x, I = -f)), D > 1 && (E.position.z = -.1), { node: c, hole: { x: I - .11, y: 0, length: T + .11, height: u } } }), h(n, r.ModelType.Opening, function (e) { var n = e.scene, t = e.editor, r = e.layout, i = r.width, a = r.height, s = t.getCurrent() instanceof l.default, d = new o.TransformNode("door", n); if (s) { var p = Math.min(Math.min(i, a), 1), c = new o.Vector4(0, 0, 1, 1), h = o.MeshBuilder.CreatePlane("plane", { width: p, height: p, frontUVs: c, backUVs: c, sideOrientation: o.Mesh.DOUBLESIDE }, n); h.position.y = a - p / 2, h.position.x = -i / 2 + p / 2, h.material = e.renderOptions.materials.opening, h.parent = d, h.receiveShadows = !1 } return { node: d, hole: { x: 0, y: 0, length: i, height: a } } }), h(n, r.ModelType.Whirlybird, function (e) { var n = new o.TransformNode("door", e.scene), r = T({ type: g.Flashing, name: f["whirlybird.babylon"], hole: { x: 0, y: 1.24, length: 1.274, height: .79 }, material: e.renderOptions.materials.whirlybird }, !1)(e); return r.node.rotate(o.Axis.X, t.default.degreesToRadians(-90)), r.node.parent = n, { node: n, hole: void 0 } }), h(n, r.ModelType.Skylight, function (e) { var n = e.scene, t = e.layout, r = t.width, i = t.height, a = new o.TransformNode("door", n), s = new o.Vector4(0, 0, r / 10, i / 10), l = o.MeshBuilder.CreatePlane("plane", { width: r, height: i, frontUVs: s, backUVs: s, sideOrientation: o.Mesh.DOUBLESIDE }, n); return l.position.y = i / 2, l.material = e.renderOptions.materials.skylight, l.parent = a, { node: a, hole: { x: 0, y: 0, length: r, height: i } } }), n), x = O; exports.default = x;
    }, { "babylonjs": "S+Ze", "../RenderUtils": "SyBU", "../../../../stores/model/Model": "wZmN", "../../../../stores/model/Window": "6a89", "../Babylon": "Q0ux", "../../../../stores/model/MetalSlidingDoor": "y87A", "../../../../stores/editorStates/Extras": "tINm" }], "2LoT": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var p = { "concrete.jpg": "concrete.jpg", "galvanised.jpg": "galvanised.jpg", "grass2.jpg": "grass2.jpg", "heightmap.jpg": "heightmap.jpg", "MetalSlidingDoor.png": "MetalSlidingDoor.png", "RollerDoor.png": "RollerDoor.png", "skybox_nx.jpg": "skybox_nx.jpg", "skybox_ny.jpg": "skybox_ny.jpg", "skybox_nz.jpg": "skybox_nz.jpg", "skybox_px.jpg": "skybox_px.jpg", "skybox_py.jpg": "skybox_py.jpg", "skybox_pz.jpg": "skybox_pz.jpg", "x2.png": "x2.png", "x3.png": "x3.png", "roys-sheds-logo.png": "roys-sheds-logo.png", "opening.png": "opening.png" }; Object.keys(p).forEach(function (g) { p[g] = "textures/" + p[g] }); var g = p; exports.default = g;
    }, {}], "wfS2": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = t(require("babylonjs")); function t(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; o.get || o.set ? Object.defineProperty(t, r, o) : t[r] = e[r] } return t.default = e, t } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function o(e, t) { for (var r = 0; r < t.length; r++) { var o = t[r]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function n(e, t, r) { return t && o(e.prototype, t), r && o(e, r), e } var a = function () { function t() { r(this, t), this.wheelPrecision = 3, this.zoom = 0, this.wheelDeltaPercentage = 0 } return n(t, [{ key: "attachControl", value: function (t, r) { var o = this; this._wheel = function (t) { if (t.type === e.PointerEventTypes.POINTERWHEEL) { var n = t.event, a = 0; if (n.wheelDelta) if (o.wheelDeltaPercentage) { var l = .01 * n.wheelDelta * o.wheelDeltaPercentage * o.camera.radius; a = n.wheelDelta > 0 ? l / (1 + o.wheelDeltaPercentage) : l * (1 + o.wheelDeltaPercentage) } else a = n.wheelDelta / (40 * o.wheelPrecision); else n.detail && (a = -n.detail / o.wheelPrecision); var i = o.camera; if (a && i && null !== i.orthoTop && null !== i.orthoBottom && null !== i.orthoRight && null !== i.orthoLeft) { var h = o.camera.getEngine(), s = a * (h.getRenderWidth() / h.getRenderHeight()) / 2, u = a / 2, c = i.orthoTop - u, f = i.orthoBottom + u, v = i.orthoRight - s, p = i.orthoLeft + s; c > 5 && f < 5 && v > 5 && p < 5 && (i.orthoTop = c, i.orthoBottom = f, i.orthoRight = v, i.orthoLeft = p) } n.preventDefault && (r || n.preventDefault()) } }, this._observer = this.camera.getScene().onPointerObservable.add(this._wheel, e.PointerEventTypes.POINTERWHEEL) } }, { key: "detachControl", value: function (e) { this._observer && e && (this.camera.getScene().onPointerObservable.remove(this._observer), this._observer = null, this._wheel = null) } }, { key: "getClassName", value: function () { return "OrthographicMouseMouseWheelInput" } }, { key: "getSimpleName", value: function () { return "mousewheel" } }]), t }(); exports.default = a;
    }, { "babylonjs": "S+Ze" }], "KAEt": [function (require, module, exports) {
        var define;
        var global = arguments[3];
        var e, t = arguments[3]; !function (t, o) { "function" == typeof e && e.amd ? e([], o) : "undefined" != typeof exports ? o() : (o(), t.FileSaver = {}) }(this, function () { "use strict"; function e(e, t, o) { var n = new XMLHttpRequest; n.open("GET", e), n.responseType = "blob", n.onload = function () { i(n.response, t, o) }, n.onerror = function () { console.error("could not download file") }, n.send() } function o(e) { var t = new XMLHttpRequest; return t.open("HEAD", e, !1), t.send(), 200 <= t.status && 299 >= t.status } function n(t) { try { t.dispatchEvent(new MouseEvent("click")) } catch (e) { var o = document.createEvent("MouseEvents"); o.initMouseEvent("click", !0, !0, window, 0, 0, 0, 80, 20, !1, !1, !1, !1, 0, null), t.dispatchEvent(o) } } var a = "object" == typeof window && window.window === window ? window : "object" == typeof self && self.self === self ? self : "object" == typeof t && t.global === t ? t : void 0, i = a.saveAs || "object" != typeof window || window !== a ? function () { } : "download" in HTMLAnchorElement.prototype ? function (t, i, r) { var c = a.URL || a.webkitURL, s = document.createElement("a"); i = i || t.name || "download", s.download = i, s.rel = "noopener", "string" == typeof t ? (s.href = t, s.origin === location.origin ? n(s) : o(s.href) ? e(t, i, r) : n(s, s.target = "_blank")) : (s.href = c.createObjectURL(t), setTimeout(function () { c.revokeObjectURL(s.href) }, 4e4), setTimeout(function () { n(s) }, 0)) } : "msSaveOrOpenBlob" in navigator ? function (t, a, i) { if (a = a || t.name || "download", "string" != typeof t) navigator.msSaveOrOpenBlob(function (e, t) { return void 0 === t ? t = { autoBom: !1 } : "object" != typeof t && (console.warn("Depricated: Expected third argument to be a object"), t = { autoBom: !t }), t.autoBom && /^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type) ? new Blob(["\ufeff", e], { type: e.type }) : e }(t, i), a); else if (o(t)) e(t, a, i); else { var r = document.createElement("a"); r.href = t, r.target = "_blank", setTimeout(function () { n(r) }) } } : function (t, o, n, i) { if ((i = i || open("", "_blank")) && (i.document.title = i.document.body.innerText = "downloading..."), "string" == typeof t) return e(t, o, n); var r = "application/octet-stream" === t.type, c = /constructor/i.test(a.HTMLElement) || a.safari, s = /CriOS\/[\d]+/.test(navigator.userAgent); if ((s || r && c) && "object" == typeof FileReader) { var l = new FileReader; l.onloadend = function () { var e = l.result; e = s ? e : e.replace(/^data:[^;]*;/, "data:attachment/file;"), i ? i.location.href = e : location = e, i = null }, l.readAsDataURL(t) } else { var u = a.URL || a.webkitURL, f = u.createObjectURL(t); i ? i.location = f : location.href = f, i = null, setTimeout(function () { u.revokeObjectURL(f) }, 4e4) } }; a.saveAs = i.saveAs = i, "undefined" != typeof module && (module.exports = i) });
    }, {}], "r8Tc": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = e(require("file-saver")); function e(t) { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var r in t) if (Object.prototype.hasOwnProperty.call(t, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(t, r) : {}; n.get || n.set ? Object.defineProperty(e, r, n) : e[r] = t[r] } return e.default = t, e } function r(t) { return (r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(t) } function n(t, e, r, n, a, o, i) { try { var u = t[o](i), l = u.value } catch (c) { return void r(c) } u.done ? e(l) : Promise.resolve(l).then(n, a) } function a(t) { return function () { var e = this, r = arguments; return new Promise(function (a, o) { var i = t.apply(e, r); function u(t) { n(i, a, o, u, l, "next", t) } function l(t) { n(i, a, o, u, l, "throw", t) } u(void 0) }) } } function o(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } function i(t, e) { for (var r = 0; r < e.length; r++) { var n = e[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n) } } function u(t, e, r) { return e && i(t.prototype, e), r && i(t, r), t } var l = function (t, e) { return e = null == e ? t.length - 1 : +e, function () { for (var r = Math.max(arguments.length - e, 0), n = Array(r), a = 0; a < r; a++)n[a] = arguments[a + e]; switch (e) { case 0: return t.call(this, n); case 1: return t.call(this, arguments[0], n); case 2: return t.call(this, arguments[0], arguments[1], n) }var o = Array(e + 1); for (a = 0; a < e; a++)o[a] = arguments[a]; return o[e] = n, t.apply(this, o) } }, c = function () { function e() { o(this, e) } var n; return u(e, null, [{ key: "wait", value: function (t) { return new Promise(function (e) { setTimeout(e, t) }) } }, { key: "saveAs", value: function (e, r) { t.saveAs(this.dataURItoBlob(e), r) } }, { key: "dataURItoBlob", value: function (t) { for (var e = atob(t.split(",")[1]), r = t.split(",")[0].split(":")[1].split(";")[0], n = new ArrayBuffer(e.length), a = new Uint8Array(n), o = 0; o < e.length; o++)a[o] = e.charCodeAt(o); return new Blob([n], { type: r }) } }, { key: "base64ToImage", value: (n = a(regeneratorRuntime.mark(function t(e) { return regeneratorRuntime.wrap(function (t) { for (; ;)switch (t.prev = t.next) { case 0: return t.abrupt("return", new Promise(function (t, r) { var n = new Image; n.onload = function () { t(n) }, n.onerror = r, n.src = e })); case 1: case "end": return t.stop() } }, t, this) })), function (t) { return n.apply(this, arguments) }) }, { key: "imageToBase64", value: function (t, e) { var r = document.createElement("canvas"); r.width = t.width, r.height = t.height; var n = r.getContext("2d"); return n && ("image/jpeg" === e && (n.fillStyle = "#fff", n.fillRect(0, 0, r.width, r.height)), n.drawImage(t, 0, 0)), r.toDataURL(e) } }, { key: "guid", value: function () { function t() { return Math.floor(65536 * (1 + Math.random())).toString(16).substring(1) } return t() + t() + "-" + t() + "-" + t() + "-" + t() + "-" + t() + t() + t() } }, { key: "arraysEqual", value: function (t, e) { if (t.length !== e.length) return !1; for (var r = t.length; r--;)if (t[r] !== e[r]) return !1; return !0 } }, { key: "isEmpty", value: function (t) { return 0 === Object.keys(t).length } }, { key: "clone", value: function (t) { return JSON.parse(JSON.stringify(t)) } }, { key: "getDelta", value: function (t, e) { var n = this, a = Object.keys(t), o = {}; return a.forEach(function (a) { if (void 0 !== t.hasOwnProperty(a)) { var i = t[a]; if ("object" === r(i) && !Array.isArray(i) && e) { var u = n.getDelta(i, e[a]); u && (o[a] = u) } else Array.isArray(i) ? n.arraysEqual(i, e[a]) || (o[a] = i) : e && i === e[a] || (o[a] = i) } }), this.isEmpty(o) ? null : o } }, { key: "setObject", value: function (t, e) { var n = this; Object.keys(e).forEach(function (a) { if (void 0 !== e.hasOwnProperty(a)) { var o = e[a]; "object" !== r(o) || Array.isArray(o) ? t[a] !== o && (t[a] = o) : n.setObject(t[a], o) } }) } }, { key: "setObjectDelta", value: function (t, e) { var r = this.getDelta(e, t); null != r && this.setObject(t, r) } }, { key: "isTouchDevice", value: function () { return "ontouchstart" in window || (navigator.msMaxTouchPoints || navigator.maxTouchPoints) > 2 } }, { key: "getParameterByName", value: function (t, e) { e || (e = window.location.href), t = t.replace(/[\[\]]/g, "\\$&"); var r = new RegExp("[?&]" + t + "(=([^&#]*)|&|#|$)").exec(e); return r ? r[2] ? decodeURIComponent(r[2].replace(/\+/g, " ")) : "" : null } }, { key: "cleanUrl", value: function () { var t = window.location.href.split("?")[0].split("#")[0]; history.replaceState(void 0, void 0, t) } }, { key: "supportsLocalStorage", value: function () { return "undefined" != typeof Storage } }, { key: "setItem", value: function (t, e) { this.supportsLocalStorage() && localStorage.setItem(t, JSON.stringify(e)) } }, { key: "getItem", value: function (t) { try { if (this.supportsLocalStorage()) if (localStorage.getItem(t)) return JSON.parse(localStorage.getItem(t) || "") } catch (e) { console.log("Failed to parse " + t + " ", e) } return null } }, { key: "getUrl", value: function () { var t = window.location, e = t.protocol, r = t.hostname, n = t.port; return "".concat(e, "//").concat(r).concat(n ? ":" + n : "") } }, { key: "flattenObject", value: function (t) { var n = {}; for (var a in t) if (t.hasOwnProperty(a)) if ("object" == r(t[a])) { var o = e.flattenObject(t[a]); for (var i in o) o.hasOwnProperty(i) && (n[a + "." + i] = o[i]) } else n[a] = t[a]; return n } }, { key: "clamp", value: function (t, e, r) { return t > r ? r : t < e ? e : t } }, { key: "mapCircleToSquareX", value: function (t, e) { return .5 * Math.sqrt(2 + Math.pow(t, 2) - Math.pow(e, 2) + 2 * t * Math.sqrt(2)) - .5 * Math.sqrt(2 + Math.pow(t, 2) - Math.pow(e, 2) - 2 * t * Math.sqrt(2)) } }, { key: "mapCircleToSquareY", value: function (t, e) { return .5 * Math.sqrt(2 - Math.pow(t, 2) + Math.pow(e, 2) + 2 * e * Math.sqrt(2)) - .5 * Math.sqrt(2 - Math.pow(t, 2) + Math.pow(e, 2) - 2 * e * Math.sqrt(2)) } }, { key: "debounce", value: function (t, e, r) { var n, a, o = function (e, r) { n = null, r && (a = t.apply(e, r)) }, i = l(function (i) { if (n && clearTimeout(n), r) { var u = !n; n = setTimeout(o, e), u && (a = t.apply(this, i)) } else n = _.delay(o, e, this, i); return a }); return i.cancel = function () { clearTimeout(n), n = null }, i } }]), e }(); exports.default = c;
    }, { "file-saver": "KAEt" }], "3Fhe": [function (require, module, exports) {
        var t = null; function r() { return t || (t = e()), t } function e() { try { throw new Error } catch (r) { var t = ("" + r.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g); if (t) return n(t[0]) } return "/" } function n(t) { return ("" + t).replace(/^((?:https?|file|ftp):\/\/.+)\/[^\/]+$/, "$1") + "/" } exports.getBundleURL = r, exports.getBaseURL = n;
    }, {}], "21/1": [function (require, module, exports) {
        var r = require("./bundle-url").getBundleURL; function e(r) { Array.isArray(r) || (r = [r]); var e = r[r.length - 1]; try { return Promise.resolve(require(e)) } catch (n) { if ("MODULE_NOT_FOUND" === n.code) return new u(function (n, i) { t(r.slice(0, -1)).then(function () { return require(e) }).then(n, i) }); throw n } } function t(r) { return Promise.all(r.map(s)) } var n = {}; function i(r, e) { n[r] = e } module.exports = exports = e, exports.load = t, exports.register = i; var o = {}; function s(e) { var t; if (Array.isArray(e) && (t = e[1], e = e[0]), o[e]) return o[e]; var i = (e.substring(e.lastIndexOf(".") + 1, e.length) || e).toLowerCase(), s = n[i]; return s ? o[e] = s(r() + e).then(function (r) { return r && module.bundle.register(t, r), r }) : void 0 } function u(r) { this.executor = r, this.promise = null } u.prototype.then = function (r, e) { return null === this.promise && (this.promise = new Promise(this.executor)), this.promise.then(r, e) }, u.prototype.catch = function (r) { return null === this.promise && (this.promise = new Promise(this.executor)), this.promise.catch(r) };
    }, { "./bundle-url": "3Fhe" }], "Q0ux": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.VerticalAlign = exports.Side = exports.PickType = void 0; var e = require("mobx"), t = p(require("./RenderUtils")), i = f(require("../../../stores/Vector2")), a = f(require("../../../types/Sheeting")), n = f(require("../../../stores/Colours")), r = f(require("../../../stores/editorStates/States")), o = f(require("../../../stores/Disposable")), s = f(require("../../../types/View")), l = f(require("hotkeys-js")), h = p(require("babylonjs")); require("./BabylonPatches"); var c = f(require("./models")), u = f(require("./textures")), d = f(require("./OrthographicMouseMouseWheelInput")), g = f(require("../../../Utils")); function f(e) { return e && e.__esModule ? e : { default: e } } function p(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var i in e) if (Object.prototype.hasOwnProperty.call(e, i)) { var a = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, i) : {}; a.get || a.set ? Object.defineProperty(t, i, a) : t[i] = e[i] } return t.default = e, t } function v(e, t, i, a, n, r, o) { try { var s = e[r](o), l = s.value } catch (h) { return void i(h) } s.done ? t(l) : Promise.resolve(l).then(a, n) } function w(e) { return function () { var t = this, i = arguments; return new Promise(function (a, n) { var r = e.apply(t, i); function o(e) { v(r, a, n, o, s, "next", e) } function s(e) { v(r, a, n, o, s, "throw", e) } o(void 0) }) } } function x(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function m(e, t) { for (var i = 0; i < t.length; i++) { var a = t[i]; a.enumerable = a.enumerable || !1, a.configurable = !0, "value" in a && (a.writable = !0), Object.defineProperty(e, a.key, a) } } function b(e, t, i) { return t && m(e.prototype, t), i && m(e, i), e } var C, y, S, T, R = function (e, t) { var i = {}; for (var a in e) Object.prototype.hasOwnProperty.call(e, a) && t.indexOf(a) < 0 && (i[a] = e[a]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var n = 0; for (a = Object.getOwnPropertySymbols(e); n < a.length; n++)t.indexOf(a[n]) < 0 && (i[a[n]] = e[a[n]]) } return i }; try { (0, l.default)("*", function () { }) } catch (A) { } exports.PickType = C, function (e) { e[e.GableWall = 0] = "GableWall", e[e.GutterWall = 1] = "GutterWall", e[e.Roof = 2] = "Roof" }(C || (exports.PickType = C = {})), exports.Side = y, function (e) { e[e.Right = 0] = "Right", e[e.Left = 1] = "Left", e[e.Back = 2] = "Back", e[e.Front = 3] = "Front" }(y || (exports.Side = y = {})), exports.VerticalAlign = S, function (e) { e[e.Top = 0] = "Top", e[e.Bottom = 1] = "Bottom", e[e.Center = 2] = "Center" }(S || (exports.VerticalAlign = S = {})), function (e) { e[e.FrontLeft = 90] = "FrontLeft", e[e.FrontRight = 0] = "FrontRight", e[e.BackRight = -90] = "BackRight", e[e.BackLeft = 180] = "BackLeft", e[e.RoofFrontRight = 0] = "RoofFrontRight" }(T || (T = {})); var L = function () { function f(e) { var t = this; x(this, f); var i = e.headless; "boolean" != typeof i && (i = !1), this.sceneState = new o.default, this.bindActions = this.bindActions.bind(this), this.resize = this.resize.bind(this), this.props = e; var a = e.canvas; this.canvas = a, i ? (h.Tools.LogLevels = h.Tools.NoneLogLevel, this.engine = new h.NullEngine) : this.engine = new h.Engine(this.canvas, !0, {}, !1); var n = new h.Scene(this.engine); window.engine = this.engine, window.scene = n, this.textureCache = {}, Object.keys(u.default).forEach(function (e) { var i = u.default[e]; t.textureCache[e] = new h.Texture(i, n) }), this.onSceneMount({ scene: n, engine: this.engine, canvas: this.canvas }), window.addEventListener("resize", this.resize) } var p, v, m; return b(f, [{ key: "dispose", value: function () { this.engine && this.engine.dispose(), this.scene.dispose(), window.removeEventListener("resize", this.resize) } }, { key: "createScreenshot", value: (m = w(regeneratorRuntime.mark(function e(t, i) { var a; return regeneratorRuntime.wrap(function (e) { for (; ;)switch (e.prev = e.next) { case 0: return a = this.engine, e.abrupt("return", new Promise(function (e, n) { a ? h.Tools.CreateScreenshotUsingRenderTarget(a, t, i, function (t) { e(t) }, "image/jpg") : n() })); case 2: case "end": return e.stop() } }, e, this) })), function (e, t) { return m.apply(this, arguments) }) }, { key: "createScreenshotImage", value: (v = w(regeneratorRuntime.mark(function e(t, i) { var a; return regeneratorRuntime.wrap(function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.createScreenshot(t, i); case 2: return a = e.sent, e.abrupt("return", g.default.base64ToImage(a)); case 4: case "end": return e.stop() } }, e, this) })), function (e, t) { return v.apply(this, arguments) }) }, { key: "downloadPdf", value: (p = w(regeneratorRuntime.mark(function e() { var t, i, a, n, r, o, l, h, c, u, d, f, p; return regeneratorRuntime.wrap(function (e) { for (; ;)switch (e.prev = e.next) { case 0: return t = this.cameras, i = this.props.shed, a = this.scene, e.prev = 3, e.next = 6, i.save(); case 6: e.next = 11; break; case 8: e.prev = 8, e.t0 = e.catch(3), console.error("failed to save shed", e.t0); case 11: return n = i.fullLength, r = i.fullWidth, o = i.height, l = { width: 1148, height: 688 }, u = i.view, e.prev = 14, i.view = s.default.Edit, this.updateScene(), a.render(), e.next = 20, g.default.wait(100); case 20: return e.next = 22, this.createScreenshotImage(t.main, l); case 22: return h = e.sent, i.view = s.default.Plan, this.updateScene(), a.render(), e.next = 28, g.default.wait(100); case 28: return this.updatePlanCamera(l.width, l.height), e.next = 31, this.createScreenshotImage(t.orth, l); case 31: c = e.sent; case 32: return e.prev = 32, i.view = u, this.updateScene(), i.view === s.default.Plan && this.updatePlanCamera(), e.finish(32); case 37: return e.next = 39, require("_bundle_loader")(require.resolve("../pdf/Document")); case 39: return d = e.sent.default, f = new d({ shedImage: h, planImage: c, url: i.url }), e.next = 43, f.renderPdf(); case 43: p = e.sent, g.default.saveAs(p, "".concat(n, "-x-").concat(r, "m-x-").concat(o, ".pdf")); case 45: case "end": return e.stop() } }, e, this, [[3, 8], [14, , 32, 37]]) })), function () { return p.apply(this, arguments) }) }, { key: "downloadImage", value: function (e) { var t = this.engine, i = this.props.shed, a = i.fullLength, n = i.fullWidth, r = i.height; if (t) { var o = { width: 1920, height: 1080 }; i.view === s.default.Plan && this.updatePlanCamera(o.width, o.height); var l = this.scene.activeCamera; if (l) { h.Tools.CreateScreenshotUsingRenderTarget(t, l, o, function (t) { g.default.saveAs(t, e || "".concat(a, " x ").concat(n, "m x ").concat(r, ".").concat("jpg")) }, "image/".concat("jpg")) } i.view === s.default.Plan && this.updatePlanCamera() } } }, { key: "resize", value: function () { this.engine && this.engine.resize(), this.scene && this.scene.activeCamera && this.scene.render(), this.props.shed.view === s.default.Plan && this.updatePlanCamera() } }, { key: "pick", value: function (e) { var t = e.pick(e.pointerX, e.pointerY); if (t) { for (var i = this.props.shed, a = t.pickedMesh; a && !a.pickInfo;)a = a.parent; if (a && a.pickInfo) { var n = a.pickInfo, r = n.type, o = n.index; if (n && t.pickedPoint) { var s = new h.Matrix; a.getWorldMatrix().invertToRef(s); var l, c, u = h.Vector3.TransformCoordinates(t.pickedPoint, s), d = -1, g = 0, f = 0, p = 0, v = 0, w = i.baySizes; switch (r) { case C.GableWall: var x = -u.x; l = i.getGableSections(o); var m = i.width / 2, b = 0, y = i.widths; if (x >= -m && x <= m ? (d = 1, i.awningLeft.visible || d-- , p = Math.min(i.leftGutterHeight, i.rightGutterHeight)) : x <= -m && x >= -(m + i.awningRight.length) ? (d = 2, i.awningLeft.visible || d-- , b += m + y[d] / 2, p = i.rightAwningGutterHeight) : x > m && x < m + i.awningLeft.length && (b -= m + y[d = 0] / 2, p = i.leftAwningGutterHeight), -1 !== d) c = l[d].section, g = (f = y[d]) / 2 + b; break; case C.GutterWall: var S = u.x + i.fullLength / 2; l = i.getGutterSections(o); var T = []; i.awningLeft.visible ? (T.push(i.leftAwningGutterHeight), T.push(i.leftAwningApexHeight)) : T.push(i.leftGutterHeight), i.awningRight.visible ? (T.push(i.rightAwningApexHeight), T.push(i.rightAwningGutterHeight)) : T.push(i.rightGutterHeight); for (var R = w.length - 1; R >= 0; R--)if (S < (v += w[R])) { g = v, f = w[R], d = R; break } if (-1 !== d) c = l[d].section; p = T[o], g -= i.fullLength / 2; break; case C.Roof: var L = u.x + i.fullLength / 2; v = 0; for (var A = w.length - 1; A >= 0; A--)if (L < (v += w[A])) { g = v, f = w[A], d = A; break } if (c = i.getRoofSections(o, !1)[d]) p = c.bounds.height, g -= i.fullLength / 2 }return { mesh: a, pickResult: t, section: c, rectangle: { x: g, y: 1, length: f, height: p } } } } } } }, { key: "onEnter", value: function (e) { var t = this.pick(e); if (this.disposeById("decalMesh"), t && t.mesh && t.section) { var i = t.rectangle, a = h.MeshBuilder.CreateBox("box", { depth: i.height, width: i.length - .1, height: .5 }, e); a.position.x = i.x - i.length / 2, a.position.z = i.height / 2 - .1, this.hoverMaterial || (this.hoverMaterial = new h.StandardMaterial("hoverMaterial", e), this.hoverMaterial.diffuseColor = new h.Color3(0, 0, 1), this.hoverMaterial.specularPower = 150, this.hoverMaterial.emissiveColor = new h.Color3(33 / 256, 150 / 256, 243 / 256), this.hoverMaterial.alpha = .1), a.parent = t.mesh, a.material = this.hoverMaterial, a.isPickable = !1, a.enableEdgesRendering(), a.edgesWidth = 4, a.edgesColor = new h.Color4(33 / 256, 150 / 256, 243 / 256, 1), this.add("decalMesh", a) } } }, { key: "onExit", value: function () { var e = this.props.editor.getCurrent(); e && e.editing || this.disposeById("decalMesh") } }, { key: "onSceneClick", value: function (e) { var t = this.pick(e); if (t && t.section) { var i = this.props.editor.getCurrent(); if (i) if (l.default.isPressed("ctrl")) { for (var a = t.section.direction, n = 0; n < i.editing.length; n++) { if (i.editing[n].direction !== a) { i.editing = []; break } } i.editing.push(t.section) } else i.editing = [t.section] } } }, { key: "getTexture", value: function (e) { return this.textureCache[e] } }, { key: "onSceneMount", value: function (t) { var a = this, n = t.canvas, o = t.scene, s = t.engine; o.clearColor = new h.Color4(229 / 256, 229 / 256, 229 / 256), o.ambientColor = new h.Color3(1, 1, 1); var l = new h.PointLight("spot1", new h.Vector3(70, 35, -30), o); l.radius = 100, l.intensity = .8, new h.PointLight("spot2", new h.Vector3(-50, 10, 50), o).radius = 100, new h.PointLight("spot3", new h.Vector3(-40.71590038182496, 19.831049828036296, -89.15666448911131), o).intensity = .6; var c = new h.DirectionalLight("dir01", new h.Vector3(-.5, -1, -1), o); c.position = new h.Vector3(20, 40, 20), c.intensity = .5; var g = new h.ArcRotateCamera("Camera", 0, .8, 100, new h.Vector3(0, 2, 0), o); g.lowerBetaLimit = .01, g.upperBetaLimit = Math.PI / 2 * 1, g.lowerRadiusLimit = .01, g.upperRadiusLimit = 150, g.fov = .9, g.attachControl(n, !0), g.alpha = 2.2495693674362984, g.beta = 1.172729203349484, g.radius = 40.01840744340846, g.viewport = new h.Viewport(0, 0, 1, 1), g.pinchPrecision = 20, g.wheelPrecision = 10, g.panningSensibility = 0, g.angularSensibilityY = g.angularSensibilityX = 2e3, (0, e.autorun)(function () { var e = a.props.shed, t = e.inertialRadiusOffset; 0 != t && (g.inertialRadiusOffset = t, e.inertialRadiusOffset = 0) }, { delay: 16 }), o.addCamera(g); var f = function (e) { var t = new h.ArcRotateCamera(e, 0, 0, 100, h.Vector3.Zero(), o); return t.viewport = new h.Viewport(0, 0, 1, 1), t.mode = h.Camera.ORTHOGRAPHIC_CAMERA, t }("orth"); f.inputs.clear(), f.inputs.add(new d.default), g.onViewMatrixChangedObservable.add(function () { var e = a.props.shed, t = g.position; e.cameraPosition = new i.default(t.x, t.z) }); var p = { main: g, orth: f }; if (window.cameras = this.cameras = p, s.webGLVersion > 1) { var v = new h.StandardRenderingPipeline("standard", o, 1, null, [p.main, p.orth]); v.samples = 4, v.fxaaEnabled = !0 } var w = this.createMaterial("ground", o); w.diffuseTexture = this.getTexture("grass2.jpg"), this.roysShedsLogo = this.getTexture("roys-sheds-logo.png"), this.roysShedsLogo.hasAlpha = !0, w.diffuseTexture.uScale = w.diffuseTexture.vScale = 20, w.specularColor = new h.Color3(0, 0, 0); var x = h.Mesh.CreateGroundFromHeightMap("ground", u.default["heightmap.jpg"], 512, 512, 50, 0, 30, o, !1, function () { }); x.material = w; var m = h.Mesh.CreateBox("skyBox", 800, o), b = this.createMaterial("skyBox", o); b.backFaceCulling = !1; var C = ["px", "py", "pz", "nx", "ny", "nz"].map(function (e) { var t = "skybox_" + e + ".jpg"; return u.default[t] }); b.reflectionTexture = h.CubeTexture.CreateFromImages(C, o), b.reflectionTexture.coordinatesMode = h.Texture.SKYBOX_MODE, b.diffuseColor = new h.Color3(1, 1, 0), b.specularColor = new h.Color3(0, 0, 0), b.disableLighting = !0, m.material = b, this.skybox = m, this.ground = x, this.scene = o, x.receiveShadows = !0, this.shadowGenerator = new h.ShadowGenerator(1024, c), this.shadowGenerator.setTransparencyShadow(!1), this.shadowGenerator.usePoissonSampling = !0, this.shadowGenerator.bias = 6e-6, this.shadowGenerator.normalBias = .05, this.shadowGenerator.useKernelBlur = !0, this.shadowGenerator.blurKernel = 2, this.shadowGenerator.setDarkness(.4); o.executeWhenReady(function () { o.registerBeforeRender(function () { o.blockMaterialDirtyMechanism && (o.blockMaterialDirtyMechanism = !1) }), setTimeout(function () { a.disposer && (a.disposer(), a.disposer = void 0), a.disposer = (0, e.autorun)(function () { o.blockMaterialDirtyMechanism = !0, a.updateScene() }, { delay: 16 }) }, 1), s.runRenderLoop(function () { o && o.render() }) }), window.addEventListener("mousemove", function () { a.props.editor.currentStateId === r.default.Extras && a.onEnter(o) }) } }, { key: "remove", value: function (e) { return this.sceneState.remove(e) } }, { key: "disposeById", value: function (e) { this.sceneState.disposeById(e) } }, { key: "add", value: function (e, t) { this.sceneState.add(e, t) } }, { key: "get", value: function (e) { return this.sceneState.get(e) } }, { key: "deactivateCamera", value: function (e, t, i) { var a = e.activeCameras.indexOf(t); -1 != a && e.activeCameras.splice(a, 1), i && t.detachControl(i) } }, { key: "activateCamera", value: function (e, t, i) { -1 === e.activeCameras.indexOf(t) && e.activeCameras.push(t), i && t.attachControl(i, !0) } }, { key: "updateSection", value: function (e) { var i = this, a = [], n = [], r = e.left, o = e.scene, s = e.section, l = e.width, u = e.height, d = e.renderOptions, g = e.flipDirection, f = e.bindActions, p = e.wallType, v = s.getLayout(); return v.forEach(function (s) { var w = s.model, x = c.default[w.type]; if (x) { var m = x({ sectionIndex: e.index, sectionAmount: v.length, section: { width: l, height: u }, model: w, layout: s, renderOptions: d, scene: o, bindActions: f, wallType: p, editor: i.props.editor }), b = m.node, C = m.hole; C && a.push({ x: r + w.padding.left + s.x + (C.x || 0), y: s.y, length: C.length, height: C.height }); var y = s.width / 2; b && (b.rotate(h.Axis.X, t.default.degreesToRadians(90), h.Space.LOCAL), g && b.rotate(h.Axis.Y, t.default.degreesToRadians(180), h.Space.LOCAL), b.position.x = r + y + s.x, b.position.z = s.y, n.push(b)) } }), { holes: a, modelNodes: n } } }, { key: "updateGutterSections", value: function (e, i) { var a = this, n = this.props.shed, r = new h.TransformNode("gutters", e), o = n.awningRight, s = n.awningLeft, l = n.width, c = n.fullLength, u = n.concreteHeight, d = n.baySizes, g = n.fullWidth, f = 0; s.visible && (f += s.length / 2), o.visible && (f += -o.length / 2); var p, v, w = c, x = i.materials, m = i.colours.wall, b = i.colours.sheetingBack, y = w / 2, S = l / 2, T = g / 2, R = n.height, L = n.height; if (s && s.visible) { var A = n.leftAwningGutterHeight; p = { height: A, position: T + f, flipDirection: !1 }, L = A + s.roofHeight } if (o && o.visible) { var k = n.rightAwningGutterHeight; v = { height: k, position: -T + f, flipDirection: !0 }, R = k + o.roofHeight } var M = { height: s.visible ? L : n.leftGutterHeight, position: S, flipDirection: !1 }, O = { height: o.visible ? R : n.rightGutterHeight, position: -S, flipDirection: !0 }, P = []; p && P.push(p), P.push(M), P.push(O), v && P.push(v); for (var D = function (o) { var s = n.getGutterSections(o), l = P[o], c = [], g = [], f = 0; s.forEach(function (t, n) { var r = t.section, o = .033, h = n + 1; h < s.length && (s[h].section.visible || (o = 0)); var u = d[n], p = y - f - u; if (r.visible) { var v = a.updateSection({ index: n, left: p, scene: e, section: r, width: u, height: l.height, renderOptions: i, flipDirection: l.flipDirection, bindActions: a.bindActions, wallType: C.GutterWall }); c = c.concat(v.holes), g = g.concat(v.modelNodes) } else c.push({ x: p + o, y: 0, length: u - 1e-5 - o, height: l.height }); f += d[n] }); var p = a.createGable({ frontColour: m, backColour: b, scene: e, main: { roofPitch: 0, rectangle: { length: w + 2e-4, height: l.height + 2e-4, x: -1e-4, y: -1e-4 } }, holes: c, material: x.wallSheeting }); p.rotate(h.Axis.X, t.default.degreesToRadians(-90)), p.rotate(h.Axis.Z, t.default.degreesToRadians(-90)), p.translate(new h.Vector3(0, 0, 0), 1, h.Space.LOCAL), p.translate(new h.Vector3(l.position, u, 0), 1, h.Space.WORLD), g.map(function (e) { e.parent = p }), p.pickInfo = { type: C.GutterWall, index: o }, p.parent = r, a.bindActions(e, p) }, G = 0; G < n.gutterWallCount; G++)D(G); return r } }, { key: "updateSections", value: function (e) { var t = this, i = [], a = []; return e.sectionOptions.forEach(function (e, n) { var r = t.updateSection(Object.assign({ index: n }, e)); i = i.concat(r.holes), a = a.concat(r.modelNodes) }), { holes: i, modelNodes: a } } }, { key: "updateGableSections", value: function (e, i) { for (var a = this, n = this.props.shed, r = new h.TransformNode("gableSections", e), o = n.awningRight, s = n.awningLeft, l = n.roofPitch, c = n.width, u = n.fullLength, d = n.height, g = n.concreteHeight, f = n.baySizes, p = n.roofOffset, v = u / 2, w = i.colours.wall, x = i.colours.sheetingBack, m = 0, b = function (u) { var b = n.getGableSections(u), y = 2; s.visible || y--; var S = s.visible ? b[0].section : null, T = Object.assign({}, s, { visible: !!S && S.visible }), R = !!o.visible && b[y].section, L = Object.assign({}, o, { visible: !!R && R.visible }), A = 0; s.visible && (A = 1); var k = []; S && S.visible && k.push({ height: n.leftAwningGutterHeight, section: b[0].section, width: s.length, left: -n.width / 2 - s.length, flipDirection: !1 }); var M = b[A].section; M.visible && k.push({ height: n.height, width: n.width, section: M, left: -n.width / 2 }), R && R.visible && k.push({ height: n.rightAwningGutterHeight, section: b[y].section, width: o.length, left: n.width / 2 }); var O = k.map(function (t, r) { return { index: r, left: t.left, scene: e, section: t.section, width: t.width, height: t.height, renderOptions: i, flipDirection: u > (n.gableWallCount - 1) / 2, bindActions: a.bindActions, wallType: C.GableWall } }), P = a.updateSections({ sectionOptions: O }), D = P.holes, G = P.modelNodes, V = a.createGable({ frontColour: w, backColour: x, scene: e, awningLeft: T, awningRight: L, main: { visible: b[A].section.visible, roofPitch: l, roofOffset: p, rectangle: { length: c, height: d, x: 0, y: 0 } }, holes: D, material: i.materials.wallSheeting }), z = 0; u > 0 && u < n.gableWallCount - 1 && (z = .033), V.rotate(h.Axis.X, t.default.degreesToRadians(-90)), V.rotate(h.Axis.Z, t.default.degreesToRadians(180)), V.translate(new h.Vector3(0, 0, 0), 1, h.Space.LOCAL), V.translate(new h.Vector3(0, g, v - m + z), 1, h.Space.WORLD), V.material = i.materials.wallSheeting, V.pickInfo = { type: C.GableWall, index: u }, V.parent = r, G.map(function (e) { e.parent = V }), u < f.length && (m += f[u]), a.bindActions(e, V) }, y = 0; y < n.gableWallCount; y++)b(y); return r } }, { key: "bindActions", value: function (e, t) { var i = this; t instanceof h.AbstractMesh && (t.actionManager = new h.ActionManager(e), t.actionManager.registerAction(new h.ExecuteCodeAction(h.ActionManager.OnPickTrigger, function () { i.props.editor.currentStateId === r.default.Extras && i.onSceneClick(e) })), t.actionManager.registerAction(new h.ExecuteCodeAction(h.ActionManager.OnPointerOutTrigger, function () { i.onExit() })), this.addShadow(t)), t.getChildren().forEach(function (t) { i.bindActions(e, t) }) } }, { key: "addShadow", value: function (e) { var t = this.shadowGenerator.getShadowMap(); if (null !== t && null !== t.renderList) { t.renderList.push(e); try { e.receiveShadows = !0 } catch (A) { } } } }, { key: "addShadows", value: function (e, t) { var i = this; t instanceof h.AbstractMesh && this.addShadow(t), t.getChildren().forEach(function (t) { i.addShadows(e, t) }) } }, { key: "createGable", value: function (e) { return t.default.createGable(e) } }, { key: "getColour", value: function (e) { var t = n.default.getById(e).hex + "FF"; return h.Color4.FromHexString(t) } }, { key: "getColour3", value: function (e) { var t = n.default.getById(e).hex; return h.Color3.FromHexString(t) } }, { key: "getGlassMaterial", value: function (e) { if (!this.glassMaterial) { var t = ["px", "py", "pz", "nx", "ny", "nz"].map(function (e) { var t = "skybox_" + e + ".jpg"; return u.default[t] }), i = h.CubeTexture.CreateFromImages(t, e); this.glassMaterial = new h.StandardMaterial("glass", e), this.glassMaterial.diffuseColor = new h.Color3(0, 0, 0), this.glassMaterial.reflectionTexture = i, this.glassMaterial.reflectionTexture.level = 1, this.glassMaterial.specularPower = 150, this.glassMaterial.emissiveColor = new h.Color3(.05, .05, .05), this.glassMaterial.alpha = .6 } return this.glassMaterial } }, { key: "createMaterial", value: function (e, t) { var i = new h.StandardMaterial(e, t), a = this.remove(e); return a && a.dispose(!0, !1), this.add(e, i), i } }, { key: "updateScene", value: function () { this.updateShed({ scene: this.scene, cameras: this.cameras, canvas: this.canvas, ground: this.ground, skybox: this.skybox }) } }, { key: "toJson", value: function () { return h.SceneSerializer.Serialize(this.scene) } }, { key: "updateShed", value: function (e) { var t = this, i = e.scene, n = e.cameras, r = e.canvas, o = e.ground, l = e.skybox, c = this.props.shed, u = c.roofSheeting, d = c.wallSheeting, g = c.doorColour, f = c.flashingColour, p = c.roofColour, v = c.wallColour, w = c.showLogo, x = function (e, a) { var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 1, r = t.createMaterial(a, i); return r.diffuseColor = t.getColour3(e).scale(n), r }, m = h.Color4.FromHexString("#b1b6b1FF"), b = d === a.default.Corrugated ? "x3.png" : "x2.png", C = u === a.default.Corrugated ? "x3.png" : "x2.png", y = this.createMaterial("wallSheeting", i); y.specularColor = new h.Color3(.3, .3, .3), y.bumpTexture = this.getTexture(b), y.bumpTexture.uScale = y.bumpTexture.vScale = 60, y.invertNormalMapX = !0; var S = this.createMaterial("roofSheeting", i); S.specularColor = new h.Color3(.3, .3, .3), S.bumpTexture = this.getTexture(C), S.bumpTexture.uScale = y.bumpTexture.vScale = 60, S.specularPower = 128, S.invertNormalMapX = !0; var T = this.createMaterial("skylightMaterial", i); T.specularColor = new h.Color3(.5, .5, .5), T.bumpTexture = this.getTexture(C), T.bumpTexture.uScale = y.bumpTexture.vScale = 60, T.specularPower = 128, T.invertNormalMapX = !0, T.diffuseColor = new h.Color3(.8, .8, .8), T.alpha = .95; var R = this.createMaterial("doorMaterial", i); R.diffuseColor = this.getColour3(g).scale(1.02); var L = this.createMaterial("rollerDoorMaterial", i); L.diffuseColor = R.diffuseColor.scale(1.02), L.bumpTexture = this.getTexture("RollerDoor.png"), L.bumpTexture.uScale = L.bumpTexture.vScale = 15, L.invertNormalMapX = !0, L.specularPower = 128, L.specularColor = new h.Color3(.3, .3, .3); var A = this.createMaterial("metalSlidingDoorMaterial", i); A.diffuseColor = R.diffuseColor.scale(1.02), A.bumpTexture = this.getTexture("MetalSlidingDoor.png"), A.specularPower = 128, A.invertNormalMapX = !0, A.specularColor = new h.Color3(1, 1, 1), A.bumpTexture.uScale = A.bumpTexture.vScale = 30, A.bumpTexture.uScale = L.bumpTexture.vScale = 15; var k = this.createMaterial("galvanisedMaterial", i); k.diffuseColor = new h.Color3(175 / 256, 175 / 256, 175 / 256), k.specularPower = 128; var M = x(f, "corner"), O = this.createMaterial("opening", i); O.diffuseTexture = this.getTexture("opening.png"), O.diffuseTexture.hasAlpha = !0, c.transparent && (S.alpha = y.alpha = .5); var P, D = { scene: i, shed: this.props.shed, materials: { glass: this.getGlassMaterial(i), ridge: x(f, "ridge"), barge: x(f, "barge"), cornerFlashing: M, gutter: x(f, "gutter"), roofSheeting: S, wallSheeting: y, paDoor: x(g, "paDoor", 1.02), rollerDoor: L, rollerDoorFlashing: x(g, "rollerDoorFlashing"), metalSlidingDoor: A, metalSlidingDoorFlashing: x(g, "metalSlidingDoorFlashing"), glassSlidingDoor: x(g, "glassSlidingDoor"), window: x(g, "window"), whirlybird: x(p, "whirlybird", 1.02), skylight: T, galvanised: k, opening: O }, colours: { ridge: this.getColour(f), barge: this.getColour(f), cornerFlashing: this.getColour(f), gutter: this.getColour(f), sheetingBack: m, roof: this.getColour(p), wall: this.getColour(v), paDoor: this.getColour(g), rollerDoor: this.getColour(g), metalSlidingDoor: this.getColour(g), glassSlidingDoor: this.getColour(g) }, cameras: n, canvas: r, ground: o, skybox: l }; switch (Object.keys(n).forEach(function (e) { var a = n[e]; t.deactivateCamera(i, a, r) }), c.view) { case s.default.Edit: if (this.activateCamera(i, n.main, r), o.setEnabled(!0), l.setEnabled(!0), P = this.renderShed(D, !0), this.props.shed.showRotationText && P) this.updateDecals(this.scene, this.ground).parent = P; break; case s.default.Plan: o.setEnabled(!1), l.setEnabled(!1), this.activateCamera(i, n.orth, r), P = this.renderPlan(D) }w && P && (this.updateLogo(i).parent = P); this.add("shed", P) } }, { key: "updatePlanCamera", value: function (e, i) { var a = this.scene, n = this.cameras.orth, r = a.getEngine(), o = (i || r.getRenderHeight()) / (e || r.getRenderWidth()), s = this.getOptions(), l = s.totalWidth, h = s.totalHeight, c = Math.max(l + 2, h), u = 1.1, d = function (e) { return c / 2 * o * e }, g = function (e) { return c / 2 * e }, f = g(u), p = d(u); h > 2 * p && (f = g(u *= h / (2 * p)), p = d(u)), n.orthoTop = p, n.orthoBottom = -p, n.orthoRight = f, n.orthoLeft = -f, n.alpha = t.default.degreesToRadians(90), n.beta = t.default.degreesToRadians(90) } }, { key: "getOptions", value: function () { var e = this.props.shed, t = e.fullLength, i = e.fullWidth, a = e.concreteHeight; return { totalWidth: t + i + 2, totalHeight: 2 * (e.apex + a) + 8, horizontalSpacing: 2, verticalSpacing: 4 } } }, { key: "renderPlan", value: function (e) { var i = e.shed, a = e.cameras, n = e.scene, r = a.orth; this.activateCamera(n, r); var o = new h.TransformNode("plan"), s = i.awningRight, l = i.awningLeft, c = this.getOptions(), u = c.verticalSpacing, d = c.horizontalSpacing, g = c.totalWidth, f = c.totalHeight, p = function (e, i, a) { return new h.Vector3(t.default.degreesToRadians(e), t.default.degreesToRadians(i), t.default.degreesToRadians(a)) }; this.updatePlanCamera(); var v = g / 2, w = f / 2, x = i.apex + i.concreteHeight + u, m = i.fullLength / 2, b = i.width / 2, C = 0; l.visible && (C = l.length); var y = this.renderShed(e, !1); y.translate(new h.Vector3(-i.fullLength - d - C, x, 0), 1, h.Space.LOCAL), y.parent = o, this.renderOrientation({ scene: n, position: new h.Vector3(0, -4.3, 0), text: i.getRotationText(0), rotation: p(180, 0, 180), size: 7, colour: "black" }).parent = y; var S = this.renderShed(e, !1); S.rotate(h.Axis.Y, t.default.degreesToRadians(-90), h.Space.LOCAL), S.translate(new h.Vector3(0, x, m - b), 1, h.Space.LOCAL), S.parent = o; var T = 0; s.visible && (T += s.length); var R = 0; l.visible && (R += l.length); var L = this.renderOrientation({ scene: n, position: new h.Vector3(0, -4.3, 0), text: i.getRotationText(3), rotation: p(180, 90, 180), size: 7, colour: "black" }), A = new h.TransformNode("tmpNode"); A.parent = S, L.parent = A; var k = this.renderShed(e, !1); k.rotate(h.Axis.Y, t.default.degreesToRadians(180), h.Space.LOCAL), k.translate(new h.Vector3(T, 0, 0), 1, h.Space.LOCAL), k.parent = o; var M = this.renderOrientation({ scene: n, position: new h.Vector3(0, -4.3, 0), text: i.getRotationText(2), rotation: p(180, -180, 180), size: 7, colour: "black" }), O = new h.TransformNode("tmpNode2"); O.parent = k, M.parent = O; var P = this.renderShed(e, !1); P.rotate(h.Axis.Y, t.default.degreesToRadians(-270), h.Space.WORLD), P.translate(new h.Vector3(0, 0, -(m + b + d + T + R)), 1, h.Space.LOCAL), P.parent = o; var D = this.renderOrientation({ scene: n, position: new h.Vector3(0, -4.3, 0), text: i.getRotationText(1), rotation: p(180, -90, 180), size: 7, colour: "black" }), G = new h.TransformNode("tmpNode3"); return G.parent = P, D.parent = G, o.translate(new h.Vector3(-b + v, 1.5 * d - w, 0), 1, h.Space.LOCAL), o } }, { key: "renderShed", value: function (e, t) { var i = e.scene, a = e.shed, n = new h.TransformNode("Shed"); this.engine instanceof h.NullEngine || !a.showMeasurements || (this.updateMeasurements(i).parent = n); this.updateGableSections(i, e).parent = n, this.updateGutterSections(i, e).parent = n, this.updateRoof(i, e).parent = n, this.updateFlashings(i, e).parent = n, this.updateStructure(e).parent = n, this.updateGutters(i, e).parent = n; var r = this.shadowGenerator.getShadowMap(); return r && (r.renderList = []), t && this.addShadows(i, n), this.updateConcrete(i).parent = n, n } }, { key: "updateMeasurements", value: function (e) { var i = this.props.shed, a = new h.Color3(1, 1, 1); i.view === s.default.Plan && (a = new h.Color3(0, 0, 0)); var n = i.concreteHeight, r = i.height, o = i.apex, l = i.width, c = i.fullWidth, u = i.fullLength, d = i.awningLeft, g = i.awningRight, f = i.view === s.default.Plan, p = new h.TransformNode("Measurements"); if (p.position.y = .1, f) { var v = o, w = r; i.isSkillion && (v = i.leftGutterHeight, w = i.rightGutterHeight); var x = this.createMeasurement({ scene: e, width: .1, length: w, textPosition: t.TextPosition.Left, textColour: a, lineColour: a }); x.rotation.y = t.default.degreesToRadians(90), f && (x.position.z = 5), x.position.x = -l / 2, x.position.y = n, x.position.z = u / 2 + .5, x.parent = p; var m = this.createMeasurement({ scene: e, width: .1, length: v, textPosition: t.TextPosition.Left, textColour: a, lineColour: a }); if (m.rotation.y = t.default.degreesToRadians(270), f && (m.position.z = 5), m.position.x = -l / 2, m.position.y = n, m.position.z = -(u / 2 + .5), m.parent = p, d.visible) { var b = this.createMeasurement({ scene: e, width: .1, length: i.leftAwningGutterHeight, textPosition: t.TextPosition.Left, textColour: a, lineColour: a }); b.rotation.y = t.default.degreesToRadians(270), f && (b.position.z = 5), b.position.x = -l / 2, b.position.y = n, b.position.z = u / 2 + 1 + .5, b.parent = p } if (g.visible) { var C = this.createMeasurement({ scene: e, width: .1, length: i.rightAwningGutterHeight, textPosition: t.TextPosition.Left, textColour: a, lineColour: a }); C.rotation.y = t.default.degreesToRadians(0), f && (C.position.z = 5); var y = 0; d && (y = g.length), C.position.x = -l / 2 - .5 - y, C.position.y = n, C.parent = p } } var S = this.createMeasurement({ scene: e, width: .1, length: l, textPosition: t.TextPosition.Left, textColour: a, lineColour: a }); S.rotation.y = t.default.degreesToRadians(90), f && (S.rotate(h.Axis.Z, t.default.degreesToRadians(90), h.Space.LOCAL), S.position.y = -.5), S.rotation.x = t.default.degreesToRadians(90), S.position.x = -l / 2, S.position.z = u / 2 + 1, S.parent = p; var T = this.createMeasurement({ scene: e, width: .1, length: c, textPosition: t.TextPosition.Left, textColour: a, lineColour: a }); T.rotation.y = t.default.degreesToRadians(270), f && (T.rotate(h.Axis.Z, t.default.degreesToRadians(90), h.Space.LOCAL), T.position.y = -.5); var R = 0; if (d.visible && (R = d.length), T.rotation.x = t.default.degreesToRadians(90), T.position.x = l / 2 + R, T.position.z = -(u / 2 + 1), T.parent = p, d.visible) { var L = this.createMeasurement({ scene: e, width: .1, length: d.length, textPosition: t.TextPosition.Left, textColour: a, lineColour: a }); L.rotation.y = t.default.degreesToRadians(90), f && (L.rotate(h.Axis.Z, t.default.degreesToRadians(90), h.Space.LOCAL), L.position.y = -.5), L.rotation.x = t.default.degreesToRadians(90), L.position.x = l / 2, L.position.z = u / 2 + 1, L.parent = p } if (g.visible) { var A = this.createMeasurement({ scene: e, width: .1, length: g.length, textPosition: t.TextPosition.Left, textColour: a, lineColour: a }); A.rotation.y = t.default.degreesToRadians(90), f && (A.rotate(h.Axis.Z, t.default.degreesToRadians(90), h.Space.LOCAL), A.position.y = -.5), A.rotation.x = t.default.degreesToRadians(90), A.position.x = -l / 2 - g.length, A.position.z = u / 2 + 1, A.parent = p } var k = l / 2 + 1; d.visible && (k += d.length); var M = this.createLengthMeasurement({ scene: e, textColour: a, lineColour: a }); M.parent = p, M.position.z = u / 2, M.position.x = k, f && (M.rotate(h.Axis.Z, t.default.degreesToRadians(-90), h.Space.LOCAL), M.position.y = -.5); var O = l / 2 + 1; g.visible && (O += g.length); var P = this.createBayMeasurement({ scene: e, textColour: a, lineColour: a }); return P.position.x = -O, P.parent = p, f && (P.position.y = -.5, P.rotate(h.Axis.Z, t.default.degreesToRadians(90), h.Space.LOCAL)), p } }, { key: "createLengthMeasurement", value: function (e) { var i = e.scene, a = e.textColour, n = e.lineColour, r = this.props.shed.fullLength, o = new h.TransformNode("LengthMeasurement"), s = this.createMeasurement({ scene: i, width: .1, length: r, textPosition: t.TextPosition.Left, textColour: a, lineColour: n }); return s.rotation.y = t.default.degreesToRadians(180), s.rotation.x = t.default.degreesToRadians(90), s.parent = o, o } }, { key: "createBayMeasurement", value: function (e) { var i = this, a = this.props.shed, n = new h.TransformNode("BayMeasurement"), r = e.scene, o = e.textColour, s = e.lineColour, l = a.fullLength, c = a.baySizes, u = 0; return c.reverse().forEach(function (e) { var a = i.createMeasurement({ scene: r, width: .1, length: e, textPosition: t.TextPosition.Left, textHeight: .6, textColour: o, lineColour: s }); a.rotation.y = t.default.degreesToRadians(0), a.rotation.x = t.default.degreesToRadians(90), a.position.z = -l / 2 + u, a.parent = n, u += e }), n } }, { key: "updateGutters", value: function (e, i) { var a = i.shed, n = a.width, r = a.height, o = a.fullLength, s = a.concreteHeight, l = a.awningLeft, c = a.awningRight, u = a.rightAwningGutterHeight, d = a.leftAwningGutterHeight, g = new h.TransformNode("gutters", e), f = t.default.createGutter({ scene: e }); f.parent = g, f.material = i.materials.barge, f.scaling.z = o; var p = []; c.visible && p.push({ position: new h.Vector3(-n / 2 - c.length - .01, u + s, -o / 2), scaling: new h.Vector3(-1, 1, o) }); return (this.isGable() || a.isSkillionLeft) && (!c.visible || c.visible && c.heightOffset > .1) && p.push({ position: new h.Vector3(-n / 2 - .01, r + s, -o / 2), scaling: new h.Vector3(-1, 1, o) }), l.visible && p.push({ position: new h.Vector3(n / 2 + l.length + .01, d + s, -o / 2), scaling: new h.Vector3(1, 1, o) }), (this.isGable() || a.isSkillionRight) && (!l.visible || l.visible && l.heightOffset > .1) && p.push({ position: new h.Vector3(n / 2 + .01, r + s, -o / 2), scaling: new h.Vector3(1, 1, o) }), p.forEach(function (e, t) { var i; (i = t === p.length - 1 ? f : f.createInstance("leftGutter")).parent = g, i.scaling = e.scaling, i.translate(e.position, 1, h.Space.WORLD) }), g } }, { key: "isGable", value: function () { var e = this.props.shed; return e.width / 2 - Math.abs(e.roofOffset) > .01 } }, { key: "updateStructure", value: function (e) { var i = e.shed, a = e.scene, n = new h.TransformNode("structure", a); n.translate(new h.Vector3(0, i.concreteHeight, 0), 1, h.Space.WORLD); for (var r, o = i.awningRight, s = i.awningLeft, l = i.width, c = i.fullLength, u = i.baySizes, d = function (i) { var a = i.offsetX, o = i.width, s = i.length, l = i.height, c = i.x, u = i.y, d = i.z, g = s / 2 + .1; a && (g = -g), r || ((r = t.default.createC({ width: o, length: s, renderOptions: e })).setEnabled(!1), r.parent = n); var f = r.createInstance("cSectionInstance"); f.scaling.z = l, f.translate(new h.Vector3(c + g, u, d), 1, h.Space.WORLD), f.parent = n }, g = l / 2, f = !1, p = !1, v = 0, w = 0; w < i.gableWallCount; w++) { var x = 0; 0 === w ? x = .1 : w === i.gableWallCount - 1 && (x = -.1); var m = w; w === i.gableWallCount - 1 && m--; var b = i.getRoofSections(3, !1)[m].visible, C = i.getRoofSections(0, !1)[m].visible, y = -(-c / 2 + v + x); d({ offsetX: !0, width: .064, length: .15, height: i.leftGutterHeight - .1, x: g, y: 0, z: y }), s.visible && (p || C) && d({ offsetX: !0, width: .064, length: .15, height: i.leftAwningGutterHeight - .1, x: g + s.length, y: 0, z: y }), d({ offsetX: !1, width: .064, length: .15, height: i.rightGutterHeight - .1, x: -g, y: 0, z: y }), o.visible && (f || b) && d({ offsetX: !1, width: .064, length: .15, height: i.rightAwningGutterHeight - .1, x: -(g + o.length), y: 0, z: y }), w < u.length && (v += u[w]), p = C, f = b } return n } }, { key: "updateFlashings", value: function (e, i) { var a = this.props.shed, n = a.width, r = a.height, o = a.fullLength, s = a.concreteHeight, l = a.awningLeft, c = a.awningRight, u = a.roofHeight, d = a.rightAwningGutterHeight, g = a.leftAwningGutterHeight, f = a.leftAwningApexHeight, p = a.rightAwningApexHeight, v = a.roofOffset, w = a.leftGutterHeight, x = a.rightGutterHeight, m = i.materials, b = m.cornerFlashing, C = m.ridge, y = new h.TransformNode("flashings", e), S = (n + .01) / 2, R = (o + .01) / 2, L = t.default.createRidgeCap({ roofPitch: a.rightRoofPitch, scene: e, isSkillionLeft: a.isSkillionLeft, isSkillionRight: a.isSkillionRight, rightRoofPitch: a.rightRoofPitch, leftRoofPitch: a.leftRoofPitch }); L.parent = y, L.translate(new h.Vector3(-v, s + r + u + .01, -R), 1, h.Space.LOCAL), L.scaling.z = o, L.material = C; var A = t.default.createFlashing({ scene: e }); A.rotate(h.Axis.X, t.default.degreesToRadians(-90), h.Space.LOCAL), A.rotate(h.Axis.Z, t.default.degreesToRadians(-180), h.Space.LOCAL), A.material = b, A.scaling.x = A.scaling.y = .1, A.setEnabled(!1), A.parent = y; var k = s, M = w, O = x, P = k, D = k; l.visible && (M = l.heightOffset, P += f), c.visible && (O = c.heightOffset, D += p); var G = [{ name: "FrontLeft", position: T.FrontLeft, height: M, heightOffset: P, x: S, y: R }, { name: "BackLeft", position: T.BackLeft, height: M, heightOffset: P, x: S, y: -R }, { name: "FrontRight", position: T.FrontRight, height: O, heightOffset: D, x: -S, y: R }, { name: "BackRight", position: T.BackRight, height: O, heightOffset: D, x: -S, y: -R }]; if (l.visible) { var V = S + l.length; G.push({ name: "AwningFrontLeft", position: T.FrontLeft, height: g, heightOffset: k, x: V, y: R }), G.push({ name: "AwningBackLeft", position: T.BackLeft, height: g, heightOffset: k, x: V, y: -R }) } if (c.visible) { var z = -(S + c.length); G.push({ name: "AwningFrontRight", position: T.FrontRight, height: d, heightOffset: k, x: z, y: R }), G.push({ name: "AwningBackRight", position: T.BackRight, height: d, heightOffset: k, x: z, y: -R }) } return G.forEach(function (e) { if (e) { var i = A.createInstance(e.name); i.parent = y, i.rotate(h.Axis.Y, t.default.degreesToRadians(e.position), h.Space.WORLD), i.translate(new h.Vector3(e.x, e.heightOffset, e.y), 1, h.Space.WORLD), i.scaling.z = e.height } }), y } }, { key: "updateRoof", value: function (e, i) { var a = this, n = this.props.shed, r = new h.TransformNode("roof", e), o = n.width, s = n.height, l = n.fullLength, c = n.concreteHeight, u = n.awningLeft, d = n.awningRight, g = n.fullWidth, f = n.baySizes, p = l, v = p / 2, w = i.materials, x = w.roofSheeting, m = w.wallSheeting, b = w.ridge, y = i.colours.wall, S = i.colours.roof, T = i.colours.sheetingBack, L = 0; u.visible && (L += u.length / 2), d.visible && (L += -d.length / 2); var A = o / 2, k = t.default.createFlashing({ scene: e }); k.rotate(h.Axis.Z, t.default.degreesToRadians(90), h.Space.LOCAL), k.material = b, k.scaling.x = k.scaling.y = .1, k.rotate(h.Axis.Z, t.default.degreesToRadians(-90)), k.setEnabled(!1), k.isPickable = !1, k.parent = r; var M = .01; function O(e, i) { var a = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], n = k.createInstance("rightRoofFlashingRight"); n.scaling.z = i, n.position.x = p / 2 + M, n.position.y = M, n.parent = e; var r = k.createInstance("rightRoofFlashingLeft"); r.scaling.z = i, r.position.x = -(p / 2 + M), r.position.y = M, r.parent = e, r.rotate(h.Axis.Z, t.default.degreesToRadians(90)), a && (n.position.y = -M, n.rotate(h.Axis.Z, t.default.degreesToRadians(-90)), r.rotate(h.Axis.Z, t.default.degreesToRadians(90)), r.position.y = -M) } var P = function (r) { for (var o = r.columnId, s = r.flip, l = R(r, ["columnId", "flip"]), h = n.getRoofSections(o, !1), c = [], u = [], d = 0, g = 0; g < n.bayCount; g++) { var p = h[g], w = p.bounds; if (p.visible) { var x = f[g], m = v - d - x; c.push({ index: g, left: m, scene: e, section: p, width: w.length, height: w.height, renderOptions: i, flipDirection: s, bindActions: a.bindActions, wallType: C.Roof }) } else { var b = w.x + 0; u.push({ x: b, y: 0, length: w.length - 1e-5 - 0, height: w.height }) } d += f[g] } var y = a.updateSections({ sectionOptions: c }), S = y.holes, T = y.modelNodes, L = Object.assign({}, l, { holes: u.concat(S) }), A = t.default.createGable(L); return T.map(function (e) { e.parent = A }), A.pickInfo = { type: C.Roof, index: o, flip: s }, a.bindActions(e, A), A }; if (!n.isSkillionRight) { var D = P({ frontColour: S, backColour: T, scene: e, main: { roofPitch: 0, rectangle: { length: p, x: 0, y: 0, height: n.rightRoofDistance } }, holes: [], material: x, columnId: 2, flip: !0 }); D.translate(new h.Vector3(-A, 0, 0), 1, h.Space.LOCAL), D.rotate(h.Axis.Z, t.default.degreesToRadians(180 + n.rightRoofPitch)), D.rotate(h.Axis.Y, t.default.degreesToRadians(-90)), D.translate(new h.Vector3(0, c + s, 0), 1, h.Space.WORLD), O(D, n.rightRoofDistance, !0), D.parent = r } if (!n.isSkillionLeft) { var G = P({ frontColour: S, backColour: T, scene: e, main: { roofPitch: 0, rectangle: { length: p, x: 0, y: 0, height: n.leftRoofDistance } }, holes: [], material: x, columnId: 1, flip: !1 }); G.translate(new h.Vector3(A, 0, 0), 1, h.Space.LOCAL), G.rotate(h.Axis.Y, t.default.degreesToRadians(90), h.Space.LOCAL), G.rotate(h.Axis.X, t.default.degreesToRadians(n.leftRoofPitch)), G.rotate(h.Axis.Y, t.default.degreesToRadians(180)), G.translate(new h.Vector3(0, c + s, 0), 1, h.Space.WORLD), O(G, n.leftRoofDistance), G.parent = r } if (d && d.visible) { var V = t.default.getOpposite(d.roofPitch, d.length), z = t.default.getDistance(d.length, V), H = P({ frontColour: S, backColour: T, scene: e, main: { roofPitch: 0, rectangle: { length: p, x: 0, y: 0, height: z } }, holes: [], material: x, columnId: 3, flip: !0 }); H.translate(new h.Vector3(-g / 2 + L, c + n.rightAwningGutterHeight, 0), 1, h.Space.LOCAL), H.rotate(h.Axis.Z, t.default.degreesToRadians(180 + d.roofPitch)), H.rotate(h.Axis.Y, t.default.degreesToRadians(-90)), O(H, z, !0); var B = this.createGable({ frontColour: y, backColour: T, scene: e, main: { roofPitch: 0, rectangle: { length: p, height: d.heightOffset, x: 0, y: 0 } }, holes: [], material: m }); B.rotate(h.Axis.X, t.default.degreesToRadians(-90)), B.rotate(h.Axis.Z, t.default.degreesToRadians(-270)), B.translate(new h.Vector3(0, 0, 0), 1, h.Space.LOCAL), B.translate(new h.Vector3(-o / 2, c + n.rightAwningApexHeight, 0), 1, h.Space.WORLD), B.material = m, H.parent = r, B.parent = r } if (u && u.visible) { var W = t.default.getOpposite(u.roofPitch, u.length), F = t.default.getDistance(u.length, W), E = P({ frontColour: S, backColour: T, scene: e, main: { roofPitch: 0, rectangle: { length: p, x: 0, y: 0, height: F } }, holes: [], material: x, columnId: 0, flip: !1 }); E.translate(new h.Vector3(g / 2 + L, c + n.leftAwningGutterHeight, 0), 1, h.Space.LOCAL), E.rotate(h.Axis.Z, t.default.degreesToRadians(-u.roofPitch)), E.rotate(h.Axis.Y, t.default.degreesToRadians(270)), O(E, F); var I = this.createGable({ frontColour: y, backColour: T, scene: e, main: { roofPitch: 0, rectangle: { length: p, height: u.heightOffset, x: 0, y: 0 } }, holes: [], material: m }); I.rotate(h.Axis.X, t.default.degreesToRadians(-90)), I.rotate(h.Axis.Z, t.default.degreesToRadians(-270)), I.translate(new h.Vector3(0, 0, 0), 1, h.Space.LOCAL), I.translate(new h.Vector3(o / 2, c + n.leftAwningApexHeight, 0), 1, h.Space.WORLD), E.parent = r, I.parent = r } return r } }, { key: "updateLogo", value: function (e) { var i = this.props.shed, a = new h.TransformNode("logo", e), n = i.fullLength, r = i.width, o = i.awningLeft, s = i.awningRight, l = r / 2, c = this.createMaterial("roysShedsLogo", e), u = this.roysShedsLogo; c.diffuseTexture = u, c.zOffset = -2; var d = u.getBaseSize(), g = n / 2 + 6, f = new h.Vector3(6, d.height / d.width * 6, 10), p = { position: new h.Vector3(0, 0, g), size: f, angle: t.default.degreesToRadians(90) }, v = this.createDecal("logoDecal1", e, p); v.material = c, v.parent = a; var w = { position: new h.Vector3(0, .1, -g), size: f, angle: t.default.degreesToRadians(270) }, x = this.createDecal("logoDecal2", e, w); x.material = c, x.parent = a; var m = { position: new h.Vector3(-(l + (s.visible ? s.length : 0) + 6), .1, 0), size: f, angle: t.default.degreesToRadians(180) }, b = this.createDecal("logoDecal2", e, m); b.material = c, b.parent = a; var C = { position: new h.Vector3(l + (o.visible ? o.length : 0) + 6, .1, 0), size: f, angle: t.default.degreesToRadians(0) }, y = this.createDecal("logoDecal2", e, C); return y.material = c, y.parent = a, a } }, { key: "createDecal", value: function (e, i, a) { var n = a.position, r = a.size, o = a.angle, s = a.rotation, l = n.clone(); l.y = l.y + .1; var c = h.Mesh.CreatePlane(e, 1, i, !1); return c.position = l, c.scaling = r, void 0 !== o ? (c.rotate(h.Axis.X, t.default.degreesToRadians(90), h.Space.LOCAL), c.rotate(h.Axis.Z, o + t.default.degreesToRadians(90), h.Space.LOCAL)) : s && (c.rotation = s), c } }, { key: "updateDecals", value: function (e, i) { var a = this.props.shed, n = new h.TransformNode("decals", e), r = a.fullLength, o = a.width, s = a.awningLeft, l = a.awningRight; if (!i.isReady()) return n; var c = o / 2, u = r / 2 + .5 + 5, d = c + .5 + 5, g = c + .5 + 5; s.visible && (d += s.length), l.visible && (g += l.length); for (var f = function (e) { return new h.Vector3(t.default.degreesToRadians(90), 0, t.default.degreesToRadians(90 + e)) }, p = [{ position: new h.Vector3(d, 0, 0), text: a.getRotationText(3), rotation: f(0) }, { position: new h.Vector3(-g, 0, 0), text: a.getRotationText(1), rotation: f(-180) }, { position: new h.Vector3(0, 0, -u), text: a.getRotationText(2), rotation: f(-90) }, { position: new h.Vector3(0, 0, u), text: a.getRotationText(0), rotation: f(90) }], v = 0; v < p.length; v++) { var w = p[v], x = w.position, m = w.text, b = w.rotation; this.renderOrientation({ scene: e, position: x, text: m, rotation: b, size: 7 }).parent = n } return n } }, { key: "renderOrientation", value: function (e) { var i = e.position, a = e.text, n = e.scene, r = e.size, o = e.rotation, s = e.colour, l = void 0 === s ? "white" : s, c = new h.TransformNode("decals", n), u = "dyntext_" + a + "_" + l, d = this.get(u); if (!d) { d = new h.DynamicTexture("dynamic texture", 512, n, !0); var g = "bold 80px verdana", f = t.default.getTextWidth(a, g); d.drawText(a, 256 - f / 2, 140, g, l, ""), d.hasAlpha = !0, this.add(u, d) } var p = this.createMaterial("decalMat-" + a, n); p.diffuseTexture = d, p.zOffset = -1; var v = { position: i, size: new h.Vector3(r, r, r), rotation: o }, w = this.createDecal("decal", n, v); return w.material = p, w.parent = c, c } }, { key: "updateConcrete", value: function (e) { var t = this.props.shed, i = t.concreteHeight, a = t.fullWidth, n = t.fullLength, r = t.awningLeft, o = t.awningRight, s = { width: a, height: i, depth: n, faceUV: [new h.Vector4(0, 0, a / 5, i / 5), new h.Vector4(0, 0, a / 5, i / 5), new h.Vector4(0, 0, i / 5, n / 5), new h.Vector4(0, 0, i / 5, n / 5), new h.Vector4(0, 0, n / 5, a / 5), new h.Vector4(0, 0, n / 5, a / 5)], sideOrientation: h.Mesh.DOUBLESIDE }, l = this.getTexture("concrete.jpg"), c = this.createMaterial("concreteMaterial", e); c.diffuseTexture = l, c.specularColor = new h.Color3(0, 0, 0); var u = h.MeshBuilder.CreateBox("Concrete", s, e); return u.position.y = .1, u.material = c, r.visible && (u.position.x += r.length / 2), o.visible && (u.position.x += -o.length / 2), u.receiveShadows = !0, u.convertToFlatShadedMesh(), u } }, { key: "createMeasurement", value: function (e) { var i, a = e.width, n = e.length, r = e.scene, o = e.textPosition, s = e.textHeight, l = void 0 === s ? .8 : s, c = e.textColour, u = void 0 === c ? new h.Color3(0, 0, 0) : c, d = e.lineColour, g = void 0 === d ? new h.Color3(0, 0, 0) : d, f = r.markAllMaterialsAsDirty; try { r.markAllMaterialsAsDirty = function () { }; var p = n / 2, v = new h.TransformNode("Measurement"), w = function (e) { return "bold " + e + "px Arial" }, x = n.toFixed(2) + "m", m = new h.StandardMaterial("MainMaterial", r); m.useColor = g, m.diffuseColor = g, m.specularColor = new h.Color3(0, 0, 0), m.backFaceCulling = !0; var b = { width: a, height: n }, C = h.MeshBuilder.CreatePlane("Main", b, r); C.parent = v, C.material = m; var y = { width: 6 * a, height: a }, S = h.MeshBuilder.CreatePlane("Top", y, r); S.parent = v, S.position.y = p, S.material = m; var T = h.MeshBuilder.CreatePlane("Bottom", y, r); T.parent = v, T.position.y = -p, T.material = m; var R = t.default.getTextWidth(x, w(1)), L = Math.min(l * R, n), k = { width: L, height: L }, M = h.MeshBuilder.CreatePlane("TextPlain", k, r); M.parent = v, M.rotation.z = t.default.degreesToRadians(-90); var O = L / 2 + 2 * a; o === t.TextPosition.Left && (O = -O), M.position.x = O; var P = u.toHexString(), D = "createMeasurement_" + P + "_" + x + "_" + Math.round(100 * R) / 100, G = this.get(D); if (!G) { G = new h.DynamicTexture("TextTexture", { width: 256, height: 256 }, r, !0); var V = 256 / R; G.drawText(x, 0, V, w(256 / R), P, ""), G.hasAlpha = !0, this.add(D, G) } var z = new h.StandardMaterial("TextMaterial", r); M.material = z, z.diffuseTexture = G, z.specularColor = new h.Color3(0, 0, 0), z.emissiveColor = new h.Color3(1, 1, 1), z.backFaceCulling = !0, C.onDisposeObservable.addOnce(function () { m.dispose(), z.dispose() }), v.position.y = n / 2, i = new h.TransformNode("wrapNode"), v.parent = i } catch (A) { throw A } finally { r.markAllMaterialsAsDirty = f, r.markAllMaterialsAsDirty(h.Material.TextureDirtyFlag) } return i } }]), f }(); exports.default = L;
    }, { "mobx": "6uYi", "./RenderUtils": "SyBU", "../../../stores/Vector2": "TglT", "../../../types/Sheeting": "uODF", "../../../stores/Colours": "+ae8", "../../../stores/editorStates/States": "wK5u", "../../../stores/Disposable": "Za+H", "../../../types/View": "EZis", "hotkeys-js": "M1ol", "babylonjs": "S+Ze", "./BabylonPatches": "j/0p", "./models": "4klJ", "./textures": "2LoT", "./OrthographicMouseMouseWheelInput": "wfS2", "../../../Utils": "r8Tc", "_bundle_loader": "21/1", "../pdf/Document": [["Document.8e8d4c2b.js", "FND+"], "FND+"] }], "IMgQ": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = i(require("react")), t = o(require("react-resize-detector")), n = o(require("../render/babylon/Babylon")), r = require("mobx-react"); function o(e) { return e && e.__esModule ? e : { default: e } } function i(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; r.get || r.set ? Object.defineProperty(t, n, r) : t[n] = e[n] } return t.default = e, t } function a(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function c(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function u(e, t, n) { return t && c(e.prototype, t), n && c(e, n), e } function f(e, t) { return !t || "object" !== y(t) && "function" != typeof t ? l(e) : t } function l(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function s(e) { return (s = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function d(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && p(e, t) } function p(e, t) { return (p = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function y(e) { return (y = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var b = function (e, t, n, r) { var o, i = arguments.length, a = i < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, n) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : y(Reflect)) && "function" == typeof Reflect.decorate) a = Reflect.decorate(e, t, n, r); else for (var c = e.length - 1; c >= 0; c--)(o = e[c]) && (a = (i < 3 ? o(a) : i > 3 ? o(t, n, a) : o(t, n)) || a); return i > 3 && a && Object.defineProperty(t, n, a), a }, h = function (r) { function o(e) { var t; return a(this, o), (t = f(this, s(o).call(this, e))).onCanvasLoaded = function (e) { null !== e && (t.canvas = e) }, t } return d(o, e.Component), u(o, [{ key: "componentDidMount", value: function () { this.canvas && (this.babylonRender = new n.default({ editor: this.props.editor, shed: this.props.shed, canvas: this.canvas })) } }, { key: "downloadPdf", value: function () { var e = this.babylonRender; e && e.downloadPdf() } }, { key: "downloadImage", value: function (e) { var t = this.babylonRender; t && t.downloadImage(e) } }, { key: "render", value: function () { var n = this; return e.createElement("div", { style: { width: "100%", height: "100%", touchAction: "none", overflow: "hidden", position: "relative" } }, this.props.children, e.createElement("canvas", Object.assign({ "touch-action": "none", className: "scene" }, {}, { ref: this.onCanvasLoaded })), e.createElement(t.default, { handleWidth: !0, handleHeight: !0, onResize: function () { n.babylonRender && n.babylonRender.resize() } })) } }]), o }(), v = h = b([r.observer], h); exports.default = v;
    }, { "react": "1n8/", "react-resize-detector": "EoGa", "../render/babylon/Babylon": "Q0ux", "mobx-react": "lQiT" }], "i1Q6": [function (require, module, exports) {

        var e = module.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = e);
    }, {}], "zKeE": [function (require, module, exports) {
        var e = module.exports = { version: "2.5.7" }; "number" == typeof __e && (__e = e);
    }, {}], "g31e": [function (require, module, exports) {
        module.exports = function (o) { if ("function" != typeof o) throw TypeError(o + " is not a function!"); return o };
    }, {}], "3zRh": [function (require, module, exports) {
        var r = require("./_a-function"); module.exports = function (n, t, u) { if (r(n), void 0 === t) return n; switch (u) { case 1: return function (r) { return n.call(t, r) }; case 2: return function (r, u) { return n.call(t, r, u) }; case 3: return function (r, u, e) { return n.call(t, r, u, e) } }return function () { return n.apply(t, arguments) } };
    }, { "./_a-function": "g31e" }], "BxvP": [function (require, module, exports) {
        module.exports = function (o) { return "object" == typeof o ? null !== o : "function" == typeof o };
    }, {}], "zotD": [function (require, module, exports) {
        var r = require("./_is-object"); module.exports = function (e) { if (!r(e)) throw TypeError(e + " is not an object!"); return e };
    }, { "./_is-object": "BxvP" }], "wLcK": [function (require, module, exports) {
        module.exports = function (r) { try { return !!r() } catch (t) { return !0 } };
    }, {}], "6MLN": [function (require, module, exports) {
        module.exports = !require("./_fails")(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a });
    }, { "./_fails": "wLcK" }], "9kxq": [function (require, module, exports) {
        var e = require("./_is-object"), r = require("./_global").document, t = e(r) && e(r.createElement); module.exports = function (e) { return t ? r.createElement(e) : {} };
    }, { "./_is-object": "BxvP", "./_global": "i1Q6" }], "R6c1": [function (require, module, exports) {
        module.exports = !require("./_descriptors") && !require("./_fails")(function () { return 7 != Object.defineProperty(require("./_dom-create")("div"), "a", { get: function () { return 7 } }).a });
    }, { "./_descriptors": "6MLN", "./_fails": "wLcK", "./_dom-create": "9kxq" }], "EKwp": [function (require, module, exports) {
        var t = require("./_is-object"); module.exports = function (r, e) { if (!t(r)) return r; var o, n; if (e && "function" == typeof (o = r.toString) && !t(n = o.call(r))) return n; if ("function" == typeof (o = r.valueOf) && !t(n = o.call(r))) return n; if (!e && "function" == typeof (o = r.toString) && !t(n = o.call(r))) return n; throw TypeError("Can't convert object to primitive value") };
    }, { "./_is-object": "BxvP" }], "Gfzd": [function (require, module, exports) {
        var e = require("./_an-object"), r = require("./_ie8-dom-define"), t = require("./_to-primitive"), i = Object.defineProperty; exports.f = require("./_descriptors") ? Object.defineProperty : function (o, n, u) { if (e(o), n = t(n, !0), e(u), r) try { return i(o, n, u) } catch (c) { } if ("get" in u || "set" in u) throw TypeError("Accessors not supported!"); return "value" in u && (o[n] = u.value), o };
    }, { "./_an-object": "zotD", "./_ie8-dom-define": "R6c1", "./_to-primitive": "EKwp", "./_descriptors": "6MLN" }], "0WCH": [function (require, module, exports) {
        module.exports = function (e, r) { return { enumerable: !(1 & e), configurable: !(2 & e), writable: !(4 & e), value: r } };
    }, {}], "akPY": [function (require, module, exports) {
        var r = require("./_object-dp"), e = require("./_property-desc"); module.exports = require("./_descriptors") ? function (t, u, o) { return r.f(t, u, e(1, o)) } : function (r, e, t) { return r[e] = t, r };
    }, { "./_object-dp": "Gfzd", "./_property-desc": "0WCH", "./_descriptors": "6MLN" }], "yS17": [function (require, module, exports) {
        var r = {}.hasOwnProperty; module.exports = function (e, n) { return r.call(e, n) };
    }, {}], "vSO4": [function (require, module, exports) {

        var e = require("./_global"), r = require("./_core"), n = require("./_ctx"), t = require("./_hide"), i = require("./_has"), u = "prototype", o = function (c, a, f) { var l, s, p, h = c & o.F, v = c & o.G, q = c & o.S, w = c & o.P, _ = c & o.B, y = c & o.W, d = v ? r : r[a] || (r[a] = {}), F = d[u], g = v ? e : q ? e[a] : (e[a] || {})[u]; for (l in v && (f = a), f) (s = !h && g && void 0 !== g[l]) && i(d, l) || (p = s ? g[l] : f[l], d[l] = v && "function" != typeof g[l] ? f[l] : _ && s ? n(p, e) : y && g[l] == p ? function (e) { var r = function (r, n, t) { if (this instanceof e) { switch (arguments.length) { case 0: return new e; case 1: return new e(r); case 2: return new e(r, n) }return new e(r, n, t) } return e.apply(this, arguments) }; return r[u] = e[u], r }(p) : w && "function" == typeof p ? n(Function.call, p) : p, w && ((d.virtual || (d.virtual = {}))[l] = p, c & o.R && F && !F[l] && t(F, l, p))) }; o.F = 1, o.G = 2, o.S = 4, o.P = 8, o.B = 16, o.W = 32, o.U = 64, o.R = 128, module.exports = o;
    }, { "./_global": "i1Q6", "./_core": "zKeE", "./_ctx": "3zRh", "./_hide": "akPY", "./_has": "yS17" }], "ShN9": [function (require, module, exports) {
        var r = {}.toString; module.exports = function (t) { return r.call(t).slice(8, -1) };
    }, {}], "E5Ce": [function (require, module, exports) {
        var e = require("./_cof"); module.exports = Object("z").propertyIsEnumerable(0) ? Object : function (r) { return "String" == e(r) ? r.split("") : Object(r) };
    }, { "./_cof": "ShN9" }], "U72i": [function (require, module, exports) {
        module.exports = function (o) { if (null == o) throw TypeError("Can't call method on  " + o); return o };
    }, {}], "Wyka": [function (require, module, exports) {
        var e = require("./_iobject"), r = require("./_defined"); module.exports = function (i) { return e(r(i)) };
    }, { "./_iobject": "E5Ce", "./_defined": "U72i" }], "MpYs": [function (require, module, exports) {
        var o = Math.ceil, r = Math.floor; module.exports = function (t) { return isNaN(t = +t) ? 0 : (t > 0 ? r : o)(t) };
    }, {}], "S7IM": [function (require, module, exports) {
        var e = require("./_to-integer"), r = Math.min; module.exports = function (t) { return t > 0 ? r(e(t), 9007199254740991) : 0 };
    }, { "./_to-integer": "MpYs" }], "Zwq5": [function (require, module, exports) {
        var e = require("./_to-integer"), r = Math.max, t = Math.min; module.exports = function (n, a) { return (n = e(n)) < 0 ? r(n + a, 0) : t(n, a) };
    }, { "./_to-integer": "MpYs" }], "LNnS": [function (require, module, exports) {
        var e = require("./_to-iobject"), r = require("./_to-length"), t = require("./_to-absolute-index"); module.exports = function (n) { return function (i, o, u) { var f, l = e(i), a = r(l.length), c = t(u, a); if (n && o != o) { for (; a > c;)if ((f = l[c++]) != f) return !0 } else for (; a > c; c++)if ((n || c in l) && l[c] === o) return n || c || 0; return !n && -1 } };
    }, { "./_to-iobject": "Wyka", "./_to-length": "S7IM", "./_to-absolute-index": "Zwq5" }], "1kq3": [function (require, module, exports) {
        module.exports = !0;
    }, {}], "NB7d": [function (require, module, exports) {

        var r = require("./_core"), e = require("./_global"), o = "__core-js_shared__", i = e[o] || (e[o] = {}); (module.exports = function (r, e) { return i[r] || (i[r] = void 0 !== e ? e : {}) })("versions", []).push({ version: r.version, mode: require("./_library") ? "pure" : "global", copyright: "© 2018 Denis Pushkarev (zloirock.ru)" });
    }, { "./_core": "zKeE", "./_global": "i1Q6", "./_library": "1kq3" }], "X6va": [function (require, module, exports) {
        var o = 0, t = Math.random(); module.exports = function (n) { return "Symbol(".concat(void 0 === n ? "" : n, ")_", (++o + t).toString(36)) };
    }, {}], "/wuY": [function (require, module, exports) {
        var e = require("./_shared")("keys"), r = require("./_uid"); module.exports = function (u) { return e[u] || (e[u] = r(u)) };
    }, { "./_shared": "NB7d", "./_uid": "X6va" }], "B9Lq": [function (require, module, exports) {
        var r = require("./_has"), e = require("./_to-iobject"), u = require("./_array-includes")(!1), i = require("./_shared-key")("IE_PROTO"); module.exports = function (o, a) { var n, s = e(o), t = 0, h = []; for (n in s) n != i && r(s, n) && h.push(n); for (; a.length > t;)r(s, n = a[t++]) && (~u(h, n) || h.push(n)); return h };
    }, { "./_has": "yS17", "./_to-iobject": "Wyka", "./_array-includes": "LNnS", "./_shared-key": "/wuY" }], "KxjL": [function (require, module, exports) {
        module.exports = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",");
    }, {}], "knrM": [function (require, module, exports) {
        var e = require("./_object-keys-internal"), r = require("./_enum-bug-keys"); module.exports = Object.keys || function (u) { return e(u, r) };
    }, { "./_object-keys-internal": "B9Lq", "./_enum-bug-keys": "KxjL" }], "z7R8": [function (require, module, exports) {
        exports.f = {}.propertyIsEnumerable;
    }, {}], "d/AR": [function (require, module, exports) {
        var e = require("./_object-keys"), r = require("./_to-iobject"), t = require("./_object-pie").f; module.exports = function (o) { return function (u) { for (var i, n = r(u), c = e(n), f = c.length, l = 0, a = []; f > l;)t.call(n, i = c[l++]) && a.push(o ? [i, n[i]] : n[i]); return a } };
    }, { "./_object-keys": "knrM", "./_to-iobject": "Wyka", "./_object-pie": "z7R8" }], "wbaH": [function (require, module, exports) {
        var r = require("./_export"), e = require("./_object-to-array")(!1); r(r.S, "Object", { values: function (r) { return e(r) } });
    }, { "./_export": "vSO4", "./_object-to-array": "d/AR" }], "P+rg": [function (require, module, exports) {
        require("../../modules/es7.object.values"), module.exports = require("../../modules/_core").Object.values;
    }, { "../../modules/es7.object.values": "wbaH", "../../modules/_core": "zKeE" }], "Qujq": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/object/values"), __esModule: !0 };
    }, { "core-js/library/fn/object/values": "P+rg" }], "zCAL": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.default = function (e, r) { var t = {}; for (var o in e) r.indexOf(o) >= 0 || Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]); return t };
    }, {}], "Ocr3": [function (require, module, exports) {
        exports.f = Object.getOwnPropertySymbols;
    }, {}], "mbLO": [function (require, module, exports) {
        var e = require("./_defined"); module.exports = function (r) { return Object(e(r)) };
    }, { "./_defined": "U72i" }], "uj5A": [function (require, module, exports) {
        "use strict"; var e = require("./_object-keys"), r = require("./_object-gops"), t = require("./_object-pie"), o = require("./_to-object"), i = require("./_iobject"), c = Object.assign; module.exports = !c || require("./_fails")(function () { var e = {}, r = {}, t = Symbol(), o = "abcdefghijklmnopqrst"; return e[t] = 7, o.split("").forEach(function (e) { r[e] = e }), 7 != c({}, e)[t] || Object.keys(c({}, r)).join("") != o }) ? function (c, n) { for (var u = o(c), s = arguments.length, a = 1, f = r.f, b = t.f; s > a;)for (var j, l = i(arguments[a++]), q = f ? e(l).concat(f(l)) : e(l), _ = q.length, g = 0; _ > g;)b.call(l, j = q[g++]) && (u[j] = l[j]); return u } : c;
    }, { "./_object-keys": "knrM", "./_object-gops": "Ocr3", "./_object-pie": "z7R8", "./_to-object": "mbLO", "./_iobject": "E5Ce", "./_fails": "wLcK" }], "YD0x": [function (require, module, exports) {
        var e = require("./_export"); e(e.S + e.F, "Object", { assign: require("./_object-assign") });
    }, { "./_export": "vSO4", "./_object-assign": "uj5A" }], "vcHl": [function (require, module, exports) {
        require("../../modules/es6.object.assign"), module.exports = require("../../modules/_core").Object.assign;
    }, { "../../modules/es6.object.assign": "YD0x", "../../modules/_core": "zKeE" }], "gc0D": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/object/assign"), __esModule: !0 };
    }, { "core-js/library/fn/object/assign": "vcHl" }], "T4f3": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("../core-js/object/assign"), r = t(e); function t(e) { return e && e.__esModule ? e : { default: e } } exports.default = r.default || function (e) { for (var r = 1; r < arguments.length; r++) { var t = arguments[r]; for (var o in t) Object.prototype.hasOwnProperty.call(t, o) && (e[o] = t[o]) } return e };
    }, { "../core-js/object/assign": "gc0D" }], "dACh": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.default = function (t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") };
    }, {}], "lytE": [function (require, module, exports) {
        var e = require("./_to-integer"), r = require("./_defined"); module.exports = function (t) { return function (n, i) { var o, u, c = String(r(n)), d = e(i), a = c.length; return d < 0 || d >= a ? t ? "" : void 0 : (o = c.charCodeAt(d)) < 55296 || o > 56319 || d + 1 === a || (u = c.charCodeAt(d + 1)) < 56320 || u > 57343 ? t ? c.charAt(d) : o : t ? c.slice(d, d + 2) : u - 56320 + (o - 55296 << 10) + 65536 } };
    }, { "./_to-integer": "MpYs", "./_defined": "U72i" }], "gojl": [function (require, module, exports) {
        module.exports = require("./_hide");
    }, { "./_hide": "akPY" }], "dhak": [function (require, module, exports) {
        module.exports = {};
    }, {}], "gjjs": [function (require, module, exports) {
        var e = require("./_object-dp"), r = require("./_an-object"), t = require("./_object-keys"); module.exports = require("./_descriptors") ? Object.defineProperties : function (o, i) { r(o); for (var u, c = t(i), n = c.length, s = 0; n > s;)e.f(o, u = c[s++], i[u]); return o };
    }, { "./_object-dp": "Gfzd", "./_an-object": "zotD", "./_object-keys": "knrM", "./_descriptors": "6MLN" }], "ebIA": [function (require, module, exports) {
        var e = require("./_global").document; module.exports = e && e.documentElement;
    }, { "./_global": "i1Q6" }], "TNJq": [function (require, module, exports) {
        var e = require("./_an-object"), r = require("./_object-dps"), t = require("./_enum-bug-keys"), n = require("./_shared-key")("IE_PROTO"), o = function () { }, i = "prototype", u = function () { var e, r = require("./_dom-create")("iframe"), n = t.length; for (r.style.display = "none", require("./_html").appendChild(r), r.src = "javascript:", (e = r.contentWindow.document).open(), e.write("<script>document.F=Object<\/script>"), e.close(), u = e.F; n--;)delete u[i][t[n]]; return u() }; module.exports = Object.create || function (t, c) { var a; return null !== t ? (o[i] = e(t), a = new o, o[i] = null, a[n] = t) : a = u(), void 0 === c ? a : r(a, c) };
    }, { "./_an-object": "zotD", "./_object-dps": "gjjs", "./_enum-bug-keys": "KxjL", "./_shared-key": "/wuY", "./_dom-create": "9kxq", "./_html": "ebIA" }], "Ug9I": [function (require, module, exports) {
        var e = require("./_shared")("wks"), r = require("./_uid"), o = require("./_global").Symbol, u = "function" == typeof o, i = module.exports = function (i) { return e[i] || (e[i] = u && o[i] || (u ? o : r)("Symbol." + i)) }; i.store = e;
    }, { "./_shared": "NB7d", "./_uid": "X6va", "./_global": "i1Q6" }], "11Ut": [function (require, module, exports) {
        var e = require("./_object-dp").f, r = require("./_has"), o = require("./_wks")("toStringTag"); module.exports = function (t, u, i) { t && !r(t = i ? t : t.prototype, o) && e(t, o, { configurable: !0, value: u }) };
    }, { "./_object-dp": "Gfzd", "./_has": "yS17", "./_wks": "Ug9I" }], "b7Q2": [function (require, module, exports) {
        "use strict"; var e = require("./_object-create"), r = require("./_property-desc"), t = require("./_set-to-string-tag"), i = {}; require("./_hide")(i, require("./_wks")("iterator"), function () { return this }), module.exports = function (o, u, s) { o.prototype = e(i, { next: r(1, s) }), t(o, u + " Iterator") };
    }, { "./_object-create": "TNJq", "./_property-desc": "0WCH", "./_set-to-string-tag": "11Ut", "./_hide": "akPY", "./_wks": "Ug9I" }], "HHE0": [function (require, module, exports) {
        var t = require("./_has"), e = require("./_to-object"), o = require("./_shared-key")("IE_PROTO"), r = Object.prototype; module.exports = Object.getPrototypeOf || function (c) { return c = e(c), t(c, o) ? c[o] : "function" == typeof c.constructor && c instanceof c.constructor ? c.constructor.prototype : c instanceof Object ? r : null };
    }, { "./_has": "yS17", "./_to-object": "mbLO", "./_shared-key": "/wuY" }], "uRfg": [function (require, module, exports) {
        "use strict"; var e = require("./_library"), r = require("./_export"), t = require("./_redefine"), i = require("./_hide"), n = require("./_iterators"), u = require("./_iter-create"), o = require("./_set-to-string-tag"), s = require("./_object-gpo"), a = require("./_wks")("iterator"), c = !([].keys && "next" in [].keys()), f = "@@iterator", l = "keys", q = "values", y = function () { return this }; module.exports = function (_, p, h, k, v, w, d) { u(h, p, k); var x, b, g, j = function (e) { if (!c && e in I) return I[e]; switch (e) { case l: case q: return function () { return new h(this, e) } }return function () { return new h(this, e) } }, m = p + " Iterator", A = v == q, F = !1, I = _.prototype, O = I[a] || I[f] || v && I[v], P = O || j(v), z = v ? A ? j("entries") : P : void 0, B = "Array" == p && I.entries || O; if (B && (g = s(B.call(new _))) !== Object.prototype && g.next && (o(g, m, !0), e || "function" == typeof g[a] || i(g, a, y)), A && O && O.name !== q && (F = !0, P = function () { return O.call(this) }), e && !d || !c && !F && I[a] || i(I, a, P), n[p] = P, n[m] = y, v) if (x = { values: A ? P : j(q), keys: w ? P : j(l), entries: z }, d) for (b in x) b in I || t(I, b, x[b]); else r(r.P + r.F * (c || F), p, x); return x };
    }, { "./_library": "1kq3", "./_export": "vSO4", "./_redefine": "gojl", "./_hide": "akPY", "./_iterators": "dhak", "./_iter-create": "b7Q2", "./_set-to-string-tag": "11Ut", "./_object-gpo": "HHE0", "./_wks": "Ug9I" }], "i+u+": [function (require, module, exports) {
        "use strict"; var i = require("./_string-at")(!0); require("./_iter-define")(String, "String", function (i) { this._t = String(i), this._i = 0 }, function () { var t, e = this._t, n = this._i; return n >= e.length ? { value: void 0, done: !0 } : (t = i(e, n), this._i += t.length, { value: t, done: !1 }) });
    }, { "./_string-at": "lytE", "./_iter-define": "uRfg" }], "ID6i": [function (require, module, exports) {
        module.exports = function () { };
    }, {}], "xwD+": [function (require, module, exports) {
        module.exports = function (e, n) { return { value: n, done: !!e } };
    }, {}], "OYXR": [function (require, module, exports) {
        "use strict"; var e = require("./_add-to-unscopables"), r = require("./_iter-step"), t = require("./_iterators"), i = require("./_to-iobject"); module.exports = require("./_iter-define")(Array, "Array", function (e, r) { this._t = i(e), this._i = 0, this._k = r }, function () { var e = this._t, t = this._k, i = this._i++; return !e || i >= e.length ? (this._t = void 0, r(1)) : r(0, "keys" == t ? i : "values" == t ? e[i] : [i, e[i]]) }, "values"), t.Arguments = t.Array, e("keys"), e("values"), e("entries");
    }, { "./_add-to-unscopables": "ID6i", "./_iter-step": "xwD+", "./_iterators": "dhak", "./_to-iobject": "Wyka", "./_iter-define": "uRfg" }], "COf8": [function (require, module, exports) {

        require("./es6.array.iterator"); for (var t = require("./_global"), e = require("./_hide"), i = require("./_iterators"), r = require("./_wks")("toStringTag"), s = "CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","), L = 0; L < s.length; L++) { var a = s[L], l = t[a], S = l && l.prototype; S && !S[r] && e(S, r, a), i[a] = i.Array }
    }, { "./es6.array.iterator": "OYXR", "./_global": "i1Q6", "./_hide": "akPY", "./_iterators": "dhak", "./_wks": "Ug9I" }], "ZxII": [function (require, module, exports) {
        exports.f = require("./_wks");
    }, { "./_wks": "Ug9I" }], "nFDa": [function (require, module, exports) {
        require("../../modules/es6.string.iterator"), require("../../modules/web.dom.iterable"), module.exports = require("../../modules/_wks-ext").f("iterator");
    }, { "../../modules/es6.string.iterator": "i+u+", "../../modules/web.dom.iterable": "COf8", "../../modules/_wks-ext": "ZxII" }], "6t7t": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/symbol/iterator"), __esModule: !0 };
    }, { "core-js/library/fn/symbol/iterator": "nFDa" }], "e8vu": [function (require, module, exports) {
        var e = require("./_uid")("meta"), r = require("./_is-object"), t = require("./_has"), n = require("./_object-dp").f, i = 0, u = Object.isExtensible || function () { return !0 }, f = !require("./_fails")(function () { return u(Object.preventExtensions({})) }), o = function (r) { n(r, e, { value: { i: "O" + ++i, w: {} } }) }, s = function (n, i) { if (!r(n)) return "symbol" == typeof n ? n : ("string" == typeof n ? "S" : "P") + n; if (!t(n, e)) { if (!u(n)) return "F"; if (!i) return "E"; o(n) } return n[e].i }, c = function (r, n) { if (!t(r, e)) { if (!u(r)) return !0; if (!n) return !1; o(r) } return r[e].w }, E = function (r) { return f && a.NEED && u(r) && !t(r, e) && o(r), r }, a = module.exports = { KEY: e, NEED: !1, fastKey: s, getWeak: c, onFreeze: E };
    }, { "./_uid": "X6va", "./_is-object": "BxvP", "./_has": "yS17", "./_object-dp": "Gfzd", "./_fails": "wLcK" }], "c2zY": [function (require, module, exports) {

        var r = require("./_global"), e = require("./_core"), o = require("./_library"), i = require("./_wks-ext"), l = require("./_object-dp").f; module.exports = function (u) { var a = e.Symbol || (e.Symbol = o ? {} : r.Symbol || {}); "_" == u.charAt(0) || u in a || l(a, u, { value: i.f(u) }) };
    }, { "./_global": "i1Q6", "./_core": "zKeE", "./_library": "1kq3", "./_wks-ext": "ZxII", "./_object-dp": "Gfzd" }], "ycyv": [function (require, module, exports) {
        var e = require("./_object-keys"), r = require("./_object-gops"), o = require("./_object-pie"); module.exports = function (t) { var u = e(t), i = r.f; if (i) for (var c, f = i(t), a = o.f, l = 0; f.length > l;)a.call(t, c = f[l++]) && u.push(c); return u };
    }, { "./_object-keys": "knrM", "./_object-gops": "Ocr3", "./_object-pie": "z7R8" }], "ayXv": [function (require, module, exports) {
        var r = require("./_cof"); module.exports = Array.isArray || function (e) { return "Array" == r(e) };
    }, { "./_cof": "ShN9" }], "Ni5N": [function (require, module, exports) {
        var e = require("./_object-keys-internal"), r = require("./_enum-bug-keys").concat("length", "prototype"); exports.f = Object.getOwnPropertyNames || function (t) { return e(t, r) };
    }, { "./_object-keys-internal": "B9Lq", "./_enum-bug-keys": "KxjL" }], "rMkZ": [function (require, module, exports) {
        var e = require("./_to-iobject"), t = require("./_object-gopn").f, o = {}.toString, r = "object" == typeof window && window && Object.getOwnPropertyNames ? Object.getOwnPropertyNames(window) : [], n = function (e) { try { return t(e) } catch (o) { return r.slice() } }; module.exports.f = function (c) { return r && "[object Window]" == o.call(c) ? n(c) : t(e(c)) };
    }, { "./_to-iobject": "Wyka", "./_object-gopn": "Ni5N" }], "sxPs": [function (require, module, exports) {
        var e = require("./_object-pie"), r = require("./_property-desc"), i = require("./_to-iobject"), t = require("./_to-primitive"), o = require("./_has"), c = require("./_ie8-dom-define"), u = Object.getOwnPropertyDescriptor; exports.f = require("./_descriptors") ? u : function (p, q) { if (p = i(p), q = t(q, !0), c) try { return u(p, q) } catch (_) { } if (o(p, q)) return r(!e.f.call(p, q), p[q]) };
    }, { "./_object-pie": "z7R8", "./_property-desc": "0WCH", "./_to-iobject": "Wyka", "./_to-primitive": "EKwp", "./_has": "yS17", "./_ie8-dom-define": "R6c1", "./_descriptors": "6MLN" }], "Aa2f": [function (require, module, exports) {

        "use strict"; var e = require("./_global"), r = require("./_has"), t = require("./_descriptors"), i = require("./_export"), n = require("./_redefine"), o = require("./_meta").KEY, u = require("./_fails"), s = require("./_shared"), f = require("./_set-to-string-tag"), a = require("./_uid"), c = require("./_wks"), l = require("./_wks-ext"), p = require("./_wks-define"), b = require("./_enum-keys"), h = require("./_is-array"), y = require("./_an-object"), _ = require("./_is-object"), q = require("./_to-iobject"), g = require("./_to-primitive"), m = require("./_property-desc"), v = require("./_object-create"), d = require("./_object-gopn-ext"), S = require("./_object-gopd"), j = require("./_object-dp"), O = require("./_object-keys"), k = S.f, w = j.f, P = d.f, E = e.Symbol, F = e.JSON, N = F && F.stringify, J = "prototype", x = c("_hidden"), I = c("toPrimitive"), T = {}.propertyIsEnumerable, C = s("symbol-registry"), M = s("symbols"), D = s("op-symbols"), G = Object[J], K = "function" == typeof E, Q = e.QObject, W = !Q || !Q[J] || !Q[J].findChild, Y = t && u(function () { return 7 != v(w({}, "a", { get: function () { return w(this, "a", { value: 7 }).a } })).a }) ? function (e, r, t) { var i = k(G, r); i && delete G[r], w(e, r, t), i && e !== G && w(G, r, i) } : w, z = function (e) { var r = M[e] = v(E[J]); return r._k = e, r }, A = K && "symbol" == typeof E.iterator ? function (e) { return "symbol" == typeof e } : function (e) { return e instanceof E }, B = function (e, t, i) { return e === G && B(D, t, i), y(e), t = g(t, !0), y(i), r(M, t) ? (i.enumerable ? (r(e, x) && e[x][t] && (e[x][t] = !1), i = v(i, { enumerable: m(0, !1) })) : (r(e, x) || w(e, x, m(1, {})), e[x][t] = !0), Y(e, t, i)) : w(e, t, i) }, H = function (e, r) { y(e); for (var t, i = b(r = q(r)), n = 0, o = i.length; o > n;)B(e, t = i[n++], r[t]); return e }, L = function (e, r) { return void 0 === r ? v(e) : H(v(e), r) }, R = function (e) { var t = T.call(this, e = g(e, !0)); return !(this === G && r(M, e) && !r(D, e)) && (!(t || !r(this, e) || !r(M, e) || r(this, x) && this[x][e]) || t) }, U = function (e, t) { if (e = q(e), t = g(t, !0), e !== G || !r(M, t) || r(D, t)) { var i = k(e, t); return !i || !r(M, t) || r(e, x) && e[x][t] || (i.enumerable = !0), i } }, V = function (e) { for (var t, i = P(q(e)), n = [], u = 0; i.length > u;)r(M, t = i[u++]) || t == x || t == o || n.push(t); return n }, X = function (e) { for (var t, i = e === G, n = P(i ? D : q(e)), o = [], u = 0; n.length > u;)!r(M, t = n[u++]) || i && !r(G, t) || o.push(M[t]); return o }; K || (n((E = function () { if (this instanceof E) throw TypeError("Symbol is not a constructor!"); var e = a(arguments.length > 0 ? arguments[0] : void 0), i = function (t) { this === G && i.call(D, t), r(this, x) && r(this[x], e) && (this[x][e] = !1), Y(this, e, m(1, t)) }; return t && W && Y(G, e, { configurable: !0, set: i }), z(e) })[J], "toString", function () { return this._k }), S.f = U, j.f = B, require("./_object-gopn").f = d.f = V, require("./_object-pie").f = R, require("./_object-gops").f = X, t && !require("./_library") && n(G, "propertyIsEnumerable", R, !0), l.f = function (e) { return z(c(e)) }), i(i.G + i.W + i.F * !K, { Symbol: E }); for (var Z = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), $ = 0; Z.length > $;)c(Z[$++]); for (var ee = O(c.store), re = 0; ee.length > re;)p(ee[re++]); i(i.S + i.F * !K, "Symbol", { for: function (e) { return r(C, e += "") ? C[e] : C[e] = E(e) }, keyFor: function (e) { if (!A(e)) throw TypeError(e + " is not a symbol!"); for (var r in C) if (C[r] === e) return r }, useSetter: function () { W = !0 }, useSimple: function () { W = !1 } }), i(i.S + i.F * !K, "Object", { create: L, defineProperty: B, defineProperties: H, getOwnPropertyDescriptor: U, getOwnPropertyNames: V, getOwnPropertySymbols: X }), F && i(i.S + i.F * (!K || u(function () { var e = E(); return "[null]" != N([e]) || "{}" != N({ a: e }) || "{}" != N(Object(e)) })), "JSON", { stringify: function (e) { for (var r, t, i = [e], n = 1; arguments.length > n;)i.push(arguments[n++]); if (t = r = i[1], (_(r) || void 0 !== e) && !A(e)) return h(r) || (r = function (e, r) { if ("function" == typeof t && (r = t.call(this, e, r)), !A(r)) return r }), i[1] = r, N.apply(F, i) } }), E[J][I] || require("./_hide")(E[J], I, E[J].valueOf), f(E, "Symbol"), f(Math, "Math", !0), f(e.JSON, "JSON", !0);
    }, { "./_global": "i1Q6", "./_has": "yS17", "./_descriptors": "6MLN", "./_export": "vSO4", "./_redefine": "gojl", "./_meta": "e8vu", "./_fails": "wLcK", "./_shared": "NB7d", "./_set-to-string-tag": "11Ut", "./_uid": "X6va", "./_wks": "Ug9I", "./_wks-ext": "ZxII", "./_wks-define": "c2zY", "./_enum-keys": "ycyv", "./_is-array": "ayXv", "./_an-object": "zotD", "./_is-object": "BxvP", "./_to-iobject": "Wyka", "./_to-primitive": "EKwp", "./_property-desc": "0WCH", "./_object-create": "TNJq", "./_object-gopn-ext": "rMkZ", "./_object-gopd": "sxPs", "./_object-dp": "Gfzd", "./_object-keys": "knrM", "./_object-gopn": "Ni5N", "./_object-pie": "z7R8", "./_object-gops": "Ocr3", "./_library": "1kq3", "./_hide": "akPY" }], "c6mp": [function (require, module, exports) {
        require("./_wks-define")("asyncIterator");
    }, { "./_wks-define": "c2zY" }], "2mwf": [function (require, module, exports) {
        require("./_wks-define")("observable");
    }, { "./_wks-define": "c2zY" }], "Ky5l": [function (require, module, exports) {
        require("../../modules/es6.symbol"), require("../../modules/es6.object.to-string"), require("../../modules/es7.symbol.async-iterator"), require("../../modules/es7.symbol.observable"), module.exports = require("../../modules/_core").Symbol;
    }, { "../../modules/es6.symbol": "Aa2f", "../../modules/es6.object.to-string": "70rD", "../../modules/es7.symbol.async-iterator": "c6mp", "../../modules/es7.symbol.observable": "2mwf", "../../modules/_core": "zKeE" }], "ibPW": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/symbol"), __esModule: !0 };
    }, { "core-js/library/fn/symbol": "Ky5l" }], "GyB/": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var t = require("../core-js/symbol/iterator"), e = n(t), o = require("../core-js/symbol"), u = n(o), f = "function" == typeof u.default && "symbol" == typeof e.default ? function (t) { return typeof t } : function (t) { return t && "function" == typeof u.default && t.constructor === u.default && t !== u.default.prototype ? "symbol" : typeof t }; function n(t) { return t && t.__esModule ? t : { default: t } } exports.default = "function" == typeof u.default && "symbol" === f(e.default) ? function (t) { return void 0 === t ? "undefined" : f(t) } : function (t) { return t && "function" == typeof u.default && t.constructor === u.default && t !== u.default.prototype ? "symbol" : void 0 === t ? "undefined" : f(t) };
    }, { "../core-js/symbol/iterator": "6t7t", "../core-js/symbol": "ibPW" }], "VOrx": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("../helpers/typeof"), t = n(e); function n(e) { return e && e.__esModule ? e : { default: e } } exports.default = function (e, n) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !n || "object" !== (void 0 === n ? "undefined" : (0, t.default)(n)) && "function" != typeof n ? e : n };
    }, { "../helpers/typeof": "GyB/" }], "ZaKr": [function (require, module, exports) {
        var t = require("./_is-object"), e = require("./_an-object"), r = function (r, o) { if (e(r), !t(o) && null !== o) throw TypeError(o + ": can't set as prototype!") }; module.exports = { set: Object.setPrototypeOf || ("__proto__" in {} ? function (t, e, o) { try { (o = require("./_ctx")(Function.call, require("./_object-gopd").f(Object.prototype, "__proto__").set, 2))(t, []), e = !(t instanceof Array) } catch (c) { e = !0 } return function (t, c) { return r(t, c), e ? t.__proto__ = c : o(t, c), t } }({}, !1) : void 0), check: r };
    }, { "./_is-object": "BxvP", "./_an-object": "zotD", "./_ctx": "3zRh", "./_object-gopd": "sxPs" }], "b1tA": [function (require, module, exports) {
        var e = require("./_export"); e(e.S, "Object", { setPrototypeOf: require("./_set-proto").set });
    }, { "./_export": "vSO4", "./_set-proto": "ZaKr" }], "dXs8": [function (require, module, exports) {
        require("../../modules/es6.object.set-prototype-of"), module.exports = require("../../modules/_core").Object.setPrototypeOf;
    }, { "../../modules/es6.object.set-prototype-of": "b1tA", "../../modules/_core": "zKeE" }], "Aq8W": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/object/set-prototype-of"), __esModule: !0 };
    }, { "core-js/library/fn/object/set-prototype-of": "dXs8" }], "yOG5": [function (require, module, exports) {
        var e = require("./_export"); e(e.S, "Object", { create: require("./_object-create") });
    }, { "./_export": "vSO4", "./_object-create": "TNJq" }], "cjsw": [function (require, module, exports) {
        require("../../modules/es6.object.create"); var e = require("../../modules/_core").Object; module.exports = function (r, o) { return e.create(r, o) };
    }, { "../../modules/es6.object.create": "yOG5", "../../modules/_core": "zKeE" }], "yeEC": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/object/create"), __esModule: !0 };
    }, { "core-js/library/fn/object/create": "cjsw" }], "ZKjc": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("../core-js/object/set-prototype-of"), t = l(e), r = require("../core-js/object/create"), o = l(r), u = require("../helpers/typeof"), n = l(u); function l(e) { return e && e.__esModule ? e : { default: e } } exports.default = function (e, r) { if ("function" != typeof r && null !== r) throw new TypeError("Super expression must either be null or a function, not " + (void 0 === r ? "undefined" : (0, n.default)(r))); e.prototype = (0, o.default)(r && r.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), r && (t.default ? (0, t.default)(e, r) : e.__proto__ = r) };
    }, { "../core-js/object/set-prototype-of": "Aq8W", "../core-js/object/create": "yeEC", "../helpers/typeof": "GyB/" }], "9qb7": [function (require, module, exports) {
        var define;
        var e; !function () { "use strict"; var r = {}.hasOwnProperty; function n() { for (var e = [], t = 0; t < arguments.length; t++) { var o = arguments[t]; if (o) { var a = typeof o; if ("string" === a || "number" === a) e.push(o); else if (Array.isArray(o) && o.length) { var s = n.apply(null, o); s && e.push(s) } else if ("object" === a) for (var u in o) r.call(o, u) && o[u] && e.push(u) } } return e.join(" ") } "undefined" != typeof module && module.exports ? (n.default = n, module.exports = n) : "function" == typeof e && "object" == typeof e.amd && e.amd ? e("classnames", [], function () { return n }) : window.classNames = n }();
    }, {}], "RsE0": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = "function" == typeof Symbol && Symbol.for, t = e ? Symbol.for("react.element") : 60103, r = e ? Symbol.for("react.portal") : 60106, o = e ? Symbol.for("react.fragment") : 60107, n = e ? Symbol.for("react.strict_mode") : 60108, s = e ? Symbol.for("react.provider") : 60109, c = e ? Symbol.for("react.context") : 60110, f = e ? Symbol.for("react.async_mode") : 60111, p = e ? Symbol.for("react.forward_ref") : 60112; function i(e) { if ("object" == typeof e && null !== e) { var i = e.$$typeof; switch (i) { case t: switch (e = e.type) { case f: case o: case n: return e; default: switch (e = e && e.$$typeof) { case c: case p: case s: return e; default: return i } }case r: return i } } } exports.typeOf = i, exports.AsyncMode = f, exports.ContextConsumer = c, exports.ContextProvider = s, exports.Element = t, exports.ForwardRef = p, exports.Fragment = o, exports.Portal = r, exports.StrictMode = n, exports.isValidElementType = function (e) { return "string" == typeof e || "function" == typeof e || e === o || e === f || e === n || "object" == typeof e && null !== e && (e.$$typeof === s || e.$$typeof === c || e.$$typeof === p) }, exports.isAsyncMode = function (e) { return i(e) === f }, exports.isContextConsumer = function (e) { return i(e) === c }, exports.isContextProvider = function (e) { return i(e) === s }, exports.isElement = function (e) { return "object" == typeof e && null !== e && e.$$typeof === t }, exports.isForwardRef = function (e) { return i(e) === p }, exports.isFragment = function (e) { return i(e) === o }, exports.isPortal = function (e) { return i(e) === r }, exports.isStrictMode = function (e) { return i(e) === n };
    }, {}], "H1RQ": [function (require, module, exports) {
        "use strict"; module.exports = require("./cjs/react-is.production.min.js");
    }, { "./cjs/react-is.production.min.js": "RsE0" }], "njtJ": [function (require, module, exports) {
        "use strict"; function e(e) { function r(r, n, t, u, o, l) { var i = u || "<<anonymous>>", a = l || t; if (null == n[t]) return r ? new Error("Required " + o + " `" + a + "` was not specified in `" + i + "`.") : null; for (var d = arguments.length, s = Array(d > 6 ? d - 6 : 0), f = 6; f < d; f++)s[f - 6] = arguments[f]; return e.apply(void 0, [n, t, i, o, a].concat(s)) } var n = r.bind(null, !1); return n.isRequired = r.bind(null, !0), n } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = e, module.exports = exports.default;
    }, {}], "aemN": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("react"), t = l(e), n = require("react-is"), r = require("./utils/createChainableTypeChecker"), o = l(r); function l(e) { return e && e.__esModule ? e : { default: e } } function a(e, r, o, l, a) { var u = e[r]; return t.default.isValidElement(u) ? new Error("Invalid " + l + " `" + a + "` of type ReactElement supplied to `" + o + "`,expected an element type (a string , component class, or function component).") : (0, n.isValidElementType)(u) ? null : new Error("Invalid " + l + " `" + a + "` of value `" + u + "` supplied to `" + o + "`, expected an element type (a string , component class, or function component).") } exports.default = (0, o.default)(a), module.exports = exports.default;
    }, { "react": "1n8/", "react-is": "H1RQ", "./utils/createChainableTypeChecker": "njtJ" }], "Omhj": [function (require, module, exports) {
        var r = require("./_export"), e = require("./_object-to-array")(!0); r(r.S, "Object", { entries: function (r) { return e(r) } });
    }, { "./_export": "vSO4", "./_object-to-array": "d/AR" }], "lQ0T": [function (require, module, exports) {
        require("../../modules/es7.object.entries"), module.exports = require("../../modules/_core").Object.entries;
    }, { "../../modules/es7.object.entries": "Omhj", "../../modules/_core": "zKeE" }], "FgrW": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/object/entries"), __esModule: !0 };
    }, { "core-js/library/fn/object/entries": "lQ0T" }], "2gTp": [function (require, module, exports) {
        "use strict"; var e = function (e, r, n, i, o, a, t, f) { if (!e) { var s; if (void 0 === r) s = new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings."); else { var d = [n, i, o, a, t, f], l = 0; (s = new Error(r.replace(/%s/g, function () { return d[l++] }))).name = "Invariant Violation" } throw s.framesToPop = 1, s } }; module.exports = e;
    }, {}], "uE08": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var s = exports.Size = { LARGE: "large", SMALL: "small", XSMALL: "xsmall" }, e = exports.SIZE_MAP = { large: "lg", medium: "md", small: "sm", xsmall: "xs", lg: "lg", md: "md", sm: "sm", xs: "xs" }, l = exports.DEVICE_SIZES = ["lg", "md", "sm", "xs"], m = exports.State = { SUCCESS: "success", WARNING: "warning", DANGER: "danger", INFO: "info" }, r = exports.Style = { DEFAULT: "default", PRIMARY: "primary", LINK: "link", INVERSE: "inverse" };
    }, {}], "t+qF": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports._curry = exports.bsSizes = exports.bsStyles = exports.bsClass = void 0; var e = require("babel-runtime/core-js/object/entries"), r = p(e), s = require("babel-runtime/helpers/extends"), t = p(s); exports.prefix = f, exports.getClassSet = d, exports.splitBsProps = x, exports.splitBsPropsAndOmit = h, exports.addStyle = E; var o = require("invariant"), n = p(o), u = require("prop-types"), a = p(u), i = require("./StyleConfig"); function p(e) { return e && e.__esModule ? e : { default: e } } function l(e) { return function () { for (var r = arguments.length, s = Array(r), t = 0; t < r; t++)s[t] = arguments[t]; return "function" == typeof s[s.length - 1] ? e.apply(void 0, s) : function (r) { return e.apply(void 0, s.concat([r])) } } } function f(e, r) { var s = (e.bsClass || "").trim(); return null == s && (0, n.default)(!1), s + (r ? "-" + r : "") } var b = exports.bsClass = l(function (e, r) { var s = r.propTypes || (r.propTypes = {}), t = r.defaultProps || (r.defaultProps = {}); return s.bsClass = a.default.string, t.bsClass = e, r }), c = exports.bsStyles = l(function (e, r, s) { "string" != typeof r && (s = r, r = void 0); var o = s.STYLES || [], n = s.propTypes || {}; e.forEach(function (e) { -1 === o.indexOf(e) && o.push(e) }); var u = a.default.oneOf(o); (s.STYLES = o, u._values = o, s.propTypes = (0, t.default)({}, n, { bsStyle: u }), void 0 !== r) && ((s.defaultProps || (s.defaultProps = {})).bsStyle = r); return s }), S = exports.bsSizes = l(function (e, r, s) { "string" != typeof r && (s = r, r = void 0); var o = s.SIZES || [], n = s.propTypes || {}; e.forEach(function (e) { -1 === o.indexOf(e) && o.push(e) }); var u = []; o.forEach(function (e) { var r = i.SIZE_MAP[e]; r && r !== e && u.push(r), u.push(e) }); var p = a.default.oneOf(u); return p._values = u, s.SIZES = o, s.propTypes = (0, t.default)({}, n, { bsSize: p }), void 0 !== r && (s.defaultProps || (s.defaultProps = {}), s.defaultProps.bsSize = r), s }); function d(e) { var r, s = ((r = {})[f(e)] = !0, r); e.bsSize && (s[f(e, i.SIZE_MAP[e.bsSize] || e.bsSize)] = !0); return e.bsStyle && (s[f(e, e.bsStyle)] = !0), s } function v(e) { return { bsClass: e.bsClass, bsSize: e.bsSize, bsStyle: e.bsStyle, bsRole: e.bsRole } } function y(e) { return "bsClass" === e || "bsSize" === e || "bsStyle" === e || "bsRole" === e } function x(e) { var s = {}; return (0, r.default)(e).forEach(function (e) { var r = e[0], t = e[1]; y(r) || (s[r] = t) }), [v(e), s] } function h(e, s) { var t = {}; s.forEach(function (e) { t[e] = !0 }); var o = {}; return (0, r.default)(e).forEach(function (e) { var r = e[0], s = e[1]; y(r) || t[r] || (o[r] = s) }), [v(e), o] } function E(e) { for (var r = arguments.length, s = Array(r > 1 ? r - 1 : 0), t = 1; t < r; t++)s[t - 1] = arguments[t]; c(s, e) } var P = exports._curry = l;
    }, { "babel-runtime/core-js/object/entries": "FgrW", "babel-runtime/helpers/extends": "T4f3", "invariant": "2gTp", "prop-types": "5D9O", "./StyleConfig": "uE08" }], "GYue": [function (require, module, exports) {
        "use strict"; function r() { for (var r = arguments.length, n = Array(r), t = 0; t < r; t++)n[t] = arguments[t]; return n.filter(function (r) { return null != r }).reduce(function (r, n) { if ("function" != typeof n) throw new Error("Invalid Argument Type, must only provide functions, undefined, or null."); return null === r ? n : function () { for (var t = arguments.length, e = Array(t), u = 0; u < t; u++)e[u] = arguments[u]; r.apply(this, e), n.apply(this, e) } }, null) } exports.__esModule = !0, exports.default = r, module.exports = exports.default;
    }, {}], "dvX0": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = m(e), n = require("babel-runtime/helpers/objectWithoutProperties"), r = m(n), l = require("babel-runtime/helpers/classCallCheck"), o = m(l), a = require("babel-runtime/helpers/possibleConstructorReturn"), u = m(a), i = require("babel-runtime/helpers/inherits"), s = m(i), d = require("react"), p = m(d), f = require("prop-types"), c = m(f), h = require("prop-types-extra/lib/elementType"), b = m(h), y = require("./utils/createChainedFunction"), C = m(y); function m(e) { return e && e.__esModule ? e : { default: e } } var k = { href: c.default.string, onClick: c.default.func, onKeyDown: c.default.func, disabled: c.default.bool, role: c.default.string, tabIndex: c.default.oneOfType([c.default.number, c.default.string]), componentClass: b.default }, D = { componentClass: "a" }; function q(e) { return !e || "#" === e.trim() } var v = function (e) { function n(t, r) { (0, o.default)(this, n); var l = (0, u.default)(this, e.call(this, t, r)); return l.handleClick = l.handleClick.bind(l), l.handleKeyDown = l.handleKeyDown.bind(l), l } return (0, s.default)(n, e), n.prototype.handleClick = function (e) { var t = this.props, n = t.disabled, r = t.href, l = t.onClick; (n || q(r)) && e.preventDefault(), n ? e.stopPropagation() : l && l(e) }, n.prototype.handleKeyDown = function (e) { " " === e.key && (e.preventDefault(), this.handleClick(e)) }, n.prototype.render = function () { var e = this.props, n = e.componentClass, l = e.disabled, o = e.onKeyDown, a = (0, r.default)(e, ["componentClass", "disabled", "onKeyDown"]); return q(a.href) && (a.role = a.role || "button", a.href = a.href || "#"), l && (a.tabIndex = -1, a.style = (0, t.default)({ pointerEvents: "none" }, a.style)), p.default.createElement(n, (0, t.default)({}, a, { onClick: this.handleClick, onKeyDown: (0, C.default)(this.handleKeyDown, o) })) }, n }(p.default.Component); v.propTypes = k, v.defaultProps = D, exports.default = v, module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "prop-types-extra/lib/elementType": "aemN", "./utils/createChainedFunction": "GYue" }], "2PkR": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/core-js/object/values"), t = k(e), r = require("babel-runtime/helpers/objectWithoutProperties"), l = k(r), s = require("babel-runtime/helpers/extends"), u = k(s), a = require("babel-runtime/helpers/classCallCheck"), o = k(a), i = require("babel-runtime/helpers/possibleConstructorReturn"), n = k(i), d = require("babel-runtime/helpers/inherits"), p = k(d), c = require("classnames"), f = k(c), b = require("react"), m = k(b), h = require("prop-types"), y = k(h), S = require("prop-types-extra/lib/elementType"), q = k(S), C = require("./utils/bootstrapUtils"), v = require("./utils/StyleConfig"), A = require("./SafeAnchor"), L = k(A); function k(e) { return e && e.__esModule ? e : { default: e } } var x = { active: y.default.bool, disabled: y.default.bool, block: y.default.bool, onClick: y.default.func, componentClass: q.default, href: y.default.string, type: y.default.oneOf(["button", "reset", "submit"]) }, E = { active: !1, block: !1, disabled: !1 }, M = function (e) { function t() { return (0, o.default)(this, t), (0, n.default)(this, e.apply(this, arguments)) } return (0, p.default)(t, e), t.prototype.renderAnchor = function (e, t) { return m.default.createElement(L.default, (0, u.default)({}, e, { className: (0, f.default)(t, e.disabled && "disabled") })) }, t.prototype.renderButton = function (e, t) { var r = e.componentClass, s = (0, l.default)(e, ["componentClass"]), a = r || "button"; return m.default.createElement(a, (0, u.default)({}, s, { type: s.type || "button", className: t })) }, t.prototype.render = function () { var e, t = this.props, r = t.active, s = t.block, a = t.className, o = (0, l.default)(t, ["active", "block", "className"]), i = (0, C.splitBsProps)(o), n = i[0], d = i[1], p = (0, u.default)({}, (0, C.getClassSet)(n), ((e = { active: r })[(0, C.prefix)(n, "block")] = s, e)), c = (0, f.default)(a, p); return d.href ? this.renderAnchor(d, c) : this.renderButton(d, c) }, t }(m.default.Component); M.propTypes = x, M.defaultProps = E, exports.default = (0, C.bsClass)("btn", (0, C.bsSizes)([v.Size.LARGE, v.Size.SMALL, v.Size.XSMALL], (0, C.bsStyles)([].concat((0, t.default)(v.State), [v.Style.DEFAULT, v.Style.PRIMARY, v.Style.LINK]), v.Style.DEFAULT, M))), module.exports = exports.default;
    }, { "babel-runtime/core-js/object/values": "Qujq", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "prop-types-extra/lib/elementType": "aemN", "./utils/bootstrapUtils": "t+qF", "./utils/StyleConfig": "uE08", "./SafeAnchor": "dvX0" }], "/sXU": [function (require, module, exports) {
        "use strict"; var t = function () { }; module.exports = t;
    }, {}], "3Ob3": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = y(e), l = require("babel-runtime/helpers/objectWithoutProperties"), r = y(l), a = require("babel-runtime/helpers/classCallCheck"), i = y(a), s = require("babel-runtime/helpers/possibleConstructorReturn"), u = y(s), n = require("babel-runtime/helpers/inherits"), d = y(n), o = require("classnames"), f = y(o), p = require("react"), c = y(p), b = require("prop-types"), h = y(b), m = require("warning"), q = y(m), v = require("./utils/bootstrapUtils"); function y(e) { return e && e.__esModule ? e : { default: e } } var x = { inline: h.default.bool, disabled: h.default.bool, title: h.default.string, validationState: h.default.oneOf(["success", "warning", "error", null]), inputRef: h.default.func }, C = { inline: !1, disabled: !1, title: "" }, g = function (e) { function l() { return (0, i.default)(this, l), (0, u.default)(this, e.apply(this, arguments)) } return (0, d.default)(l, e), l.prototype.render = function () { var e = this.props, l = e.inline, a = e.disabled, i = e.validationState, s = e.inputRef, u = e.className, n = e.style, d = e.title, o = e.children, p = (0, r.default)(e, ["inline", "disabled", "validationState", "inputRef", "className", "style", "title", "children"]), b = (0, v.splitBsProps)(p), h = b[0], m = b[1], q = c.default.createElement("input", (0, t.default)({}, m, { ref: s, type: "checkbox", disabled: a })); if (l) { var y, x = ((y = {})[(0, v.prefix)(h, "inline")] = !0, y.disabled = a, y); return c.default.createElement("label", { className: (0, f.default)(u, x), style: n, title: d }, q, o) } var C = (0, t.default)({}, (0, v.getClassSet)(h), { disabled: a }); return i && (C["has-" + i] = !0), c.default.createElement("div", { className: (0, f.default)(u, C), style: n }, c.default.createElement("label", { title: d }, q, o)) }, l }(c.default.Component); g.propTypes = x, g.defaultProps = C, exports.default = (0, v.bsClass)("checkbox", g), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "warning": "/sXU", "./utils/bootstrapUtils": "t+qF" }], "s/zO": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.getCheckboxKey = exports.getKey = exports.Direction = void 0; var e = t(require("react")); function t(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function r(e) { return (r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function o(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function c(e, t, r) { return t && o(e.prototype, t), r && o(e, r), e } function i(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? a(e) : t } function a(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function l(e) { return (l = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function u(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && s(e, t) } function s(e, t) { return (s = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } var p, f = require("react-bootstrap/lib/Button"), h = require("react-bootstrap/lib/Checkbox"); exports.Direction = p, function (e) { e[e.Horizontal = 0] = "Horizontal", e[e.Vertical = 1] = "Vertical" }(p || (exports.Direction = p = {})); var y = function (e, t, r) { var n = e === p.Horizontal ? 0 : 1; return "".concat(n, "-").concat(t, "-").concat(r) }; exports.getKey = y; var d = function (e, t) { return "".concat(e, "-").concat(t) }; exports.getCheckboxKey = d; var b = function (t) { function r(e) { return n(this, r), i(this, l(r).call(this, e)) } return u(r, e.Component), c(r, [{ key: "createLine", value: function (t, r, n) { var o = "default"; n && (o = "primary"); var c = { onClick: r, bsStyle: o, className: "grid-button" }; return e.createElement("div", { key: t, className: "grid-line" }, e.createElement(f, Object.assign({}, c))) } }, { key: "createCheckbox", value: function (t, r) { return "boolean" == typeof t ? e.createElement(h, { checked: t, onChange: r }) : null } }, { key: "isSelected", value: function (e, t, r) { return (this.props.selected || {})[y(e, t, r)] } }, { key: "isChecked", value: function (e, t) { return (this.props.checkboxSelected || {})[d(e, t)] } }, { key: "create", value: function (t) { for (var r = this, n = t.width, o = t.height, c = [], i = [], a = function (e, t, n) { return function () { r.props.onClick(e, t, n) } }, l = 0; l < o + 1; l++) { for (var u = [], s = 0; s < n; s++) { var f = p.Horizontal, h = this.isSelected(f, s, l); u.push(this.createLine("line-".concat(s, "-").concat(l), a(f, s, l), h)) } i.push(e.createElement("div", { key: "row-".concat(l), className: "grid-row" }, u)) } for (var y = function (e, t) { return function () { r.props.onCheckboxClick(e, t) } }, d = 0; d < o; d++) { for (var b = [], m = 0; m < n + 1; m++) { var v = p.Vertical, g = this.isSelected(v, m, d); b.push(this.createLine("line-".concat(m, "-").concat(d), a(v, m, d), g)), m < n && b.push(e.createElement("div", { key: "spacer-".concat(m, "-").concat(d), className: "grid-column-spacer" }, this.createCheckbox(this.isChecked(m, d), y(m, d)))) } c.push(e.createElement("div", { key: "column-".concat(d), className: "grid-column" }, b)) } for (var k = [], O = 0; O < i.length; O++)k.push(i[O], c[O]); return k } }, { key: "render", value: function () { var t = this.props.orientations; return e.createElement("div", { className: "grid" }, e.createElement("legend", { className: "grid-right" }, t[1].charAt(0)), e.createElement("legend", { className: "grid-left" }, t[3].charAt(0)), e.createElement("legend", { className: "grid-front" }, t[0]), e.createElement("div", { className: "grid-wrap" }, this.create(this.props)), e.createElement("legend", { className: "grid-back" }, t[2]), this.props.children) } }]), r }(); exports.default = b;
    }, { "react": "1n8/", "react-bootstrap/lib/Button": "2PkR", "react-bootstrap/lib/Checkbox": "3Ob3" }], "Qudz": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = i(require("react")), t = require("mobx-react"), r = n(require("react-resize-detector")), o = n(require("../../../Utils")); function n(e) { return e && e.__esModule ? e : { default: e } } function i(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; o.get || o.set ? Object.defineProperty(t, r, o) : t[r] = e[r] } return t.default = e, t } function c(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function u(e, t) { for (var r = 0; r < t.length; r++) { var o = t[r]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function a(e, t, r) { return t && u(e.prototype, t), r && u(e, r), e } function f(e, t) { return !t || "object" !== d(t) && "function" != typeof t ? l(e) : t } function l(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function s(e) { return (s = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function p(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && y(e, t) } function y(e, t) { return (y = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function d(e) { return (d = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var b = function (e, t, r, o) { var n, i = arguments.length, c = i < 3 ? t : null === o ? o = Object.getOwnPropertyDescriptor(t, r) : o; if ("object" === ("undefined" == typeof Reflect ? "undefined" : d(Reflect)) && "function" == typeof Reflect.decorate) c = Reflect.decorate(e, t, r, o); else for (var u = e.length - 1; u >= 0; u--)(n = e[u]) && (c = (i < 3 ? n(c) : i > 3 ? n(t, r, c) : n(t, r)) || c); return i > 3 && c && Object.defineProperty(t, r, c), c }, h = function (t) { function n(e) { var t; return c(this, n), (t = f(this, s(n).call(this, e))).state = { width: 0, height: 0 }, t } return p(n, e.Component), a(n, [{ key: "render", value: function () { var t = this, n = this.props.shed, i = this.state.width / 2, c = this.state.height / 2, u = n.cameraPosition.normalize, a = u.angle, f = i + o.default.mapCircleToSquareX(u.x, u.y) * (i + 13), l = c + o.default.mapCircleToSquareY(u.x, u.y) * (c + 37), s = { right: "".concat(f, "px"), top: "".concat(l, "px"), transform: "rotate(".concat(360 - a, "deg)") }; return [e.createElement("div", { className: "camera-location", key: "camera", style: s }), e.createElement(r.default, { key: "resize-detector", handleWidth: !0, handleHeight: !0, onResize: function (e, r) { t.setState({ width: e, height: r }) } })] } }]), n }(), m = h = b([t.observer], h); exports.default = m;
    }, { "react": "1n8/", "mobx-react": "lQiT", "react-resize-detector": "EoGa", "../../../Utils": "r8Tc" }], "jy/S": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = i(require("react")), t = require("mobx-react"), n = i(require("../../../components/grid/Grid")), r = o(require("./CameraPosition")); function o(e) { return e && e.__esModule ? e : { default: e } } function i(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; r.get || r.set ? Object.defineProperty(t, n, r) : t[n] = e[n] } return t.default = e, t } function c(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function a(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function l(e, t, n) { return t && a(e.prototype, t), n && a(e, n), e } function u(e, t) { return !t || "object" !== g(t) && "function" != typeof t ? f(e) : t } function f(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function s(e) { return (s = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function b(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && p(e, t) } function p(e, t) { return (p = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function g(e) { return (g = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var v = function (e, t, n, r) { var o, i = arguments.length, c = i < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, n) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : g(Reflect)) && "function" == typeof Reflect.decorate) c = Reflect.decorate(e, t, n, r); else for (var a = e.length - 1; a >= 0; a--)(o = e[a]) && (c = (i < 3 ? o(c) : i > 3 ? o(t, n, c) : o(t, n)) || c); return i > 3 && c && Object.defineProperty(t, n, c), c }, y = require("react-bootstrap/lib/Button"), h = function (t) { function o(e) { var t; return c(this, o), (t = u(this, s(o).call(this, e))).state = { width: 0, height: 0 }, t } return b(o, e.Component), l(o, [{ key: "select", value: function (e, t, r) { var o, i = this.props.shed; switch (e) { case n.Direction.Vertical: var c = i.getGutterSections(t); o = c[c.length - 1 - r]; break; case n.Direction.Horizontal: var a = i.gableWallCount - 1 - r; o = i.getGableSections(a)[t] }o && (o.section.visible = !o.section.visible) } }, { key: "render", value: function () { var t = this, o = this.props.shed, i = o.awningRight, c = o.awningLeft, a = 1; i.visible && a++ , c.visible && a++; var l = {}, u = {}, f = {}, s = []; if (o.awningLeft.visible && s.push([0, 0]), o.awningRight.visible) { var b = 2; o.awningLeft.visible || b-- , s.push([3, b]) } s.forEach(function (e) { for (var t = 0; t < o.gridHeight; t++) { var r = o.getRoofSections(e[0], !1)[o.gridHeight - 1 - t], i = (0, n.getCheckboxKey)(e[1], t); u[i] = r.visible, f[i] = r } }); for (var p = function (e) { o.getGableSections(e).forEach(function (t, r) { var i = o.gableWallCount - 1 - e; l[(0, n.getKey)(n.Direction.Horizontal, r, i)] = t.section.visible }) }, g = 0; g < o.gableWallCount; g++)p(g); var v = function (e) { var t = o.getGutterSections(e); t.forEach(function (r, o) { var i = t.length - 1 - o; l[(0, n.getKey)(n.Direction.Vertical, e, i)] = r.section.visible }) }; for (g = 0; g < o.gutterWallCount; g++)v(g); var h = { selected: l, width: a, height: o.bayCount, onClick: function (e, n, r) { t.select(e, n, r) }, onCheckboxClick: function (e, t) { var r = f[(0, n.getCheckboxKey)(e, t)]; r && (r.visible = !r.visible) }, orientations: [o.getRotationText(0), o.getRotationText(1), o.getRotationText(2), o.getRotationText(3)] }; return e.createElement("div", null, e.createElement("span", null, "Tap a wall section to add or remove it."), e.createElement("br", null), e.createElement("br", null), e.createElement(n.default, Object.assign({}, h), e.createElement(r.default, { shed: o })), e.createElement("br", null), e.createElement(y, { className: "change-front-btn", onClick: function () { o.rotation = o.rotation + 1 } }, "Change Front")) } }]), o }(), d = h = v([t.observer], h); exports.default = d;
    }, { "react": "1n8/", "mobx-react": "lQiT", "../../../components/grid/Grid": "s/zO", "react-bootstrap/lib/Button": "2PkR", "./CameraPosition": "Qudz" }], "cOHw": [function (require, module, exports) {
        var e = require("./_export"), r = require("./_core"), t = require("./_fails"); module.exports = function (c, i) { var o = (r.Object || {})[c] || Object[c], u = {}; u[c] = i(o), e(e.S + e.F * t(function () { o(1) }), "Object", u) };
    }, { "./_export": "vSO4", "./_core": "zKeE", "./_fails": "wLcK" }], "PDcB": [function (require, module, exports) {
        var e = require("./_to-object"), r = require("./_object-keys"); require("./_object-sap")("keys", function () { return function (t) { return r(e(t)) } });
    }, { "./_to-object": "mbLO", "./_object-keys": "knrM", "./_object-sap": "cOHw" }], "eOjq": [function (require, module, exports) {
        require("../../modules/es6.object.keys"), module.exports = require("../../modules/_core").Object.keys;
    }, { "../../modules/es6.object.keys": "PDcB", "../../modules/_core": "zKeE" }], "8FtN": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/object/keys"), __esModule: !0 };
    }, { "core-js/library/fn/object/keys": "eOjq" }], "BtHH": [function (require, module, exports) {
        var e = require("./_to-object"), r = require("./_object-gpo"); require("./_object-sap")("getPrototypeOf", function () { return function (t) { return r(e(t)) } });
    }, { "./_to-object": "mbLO", "./_object-gpo": "HHE0", "./_object-sap": "cOHw" }], "ky2m": [function (require, module, exports) {
        require("../../modules/es6.object.get-prototype-of"), module.exports = require("../../modules/_core").Object.getPrototypeOf;
    }, { "../../modules/es6.object.get-prototype-of": "BtHH", "../../modules/_core": "zKeE" }], "BX4+": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/object/get-prototype-of"), __esModule: !0 };
    }, { "core-js/library/fn/object/get-prototype-of": "ky2m" }], "htFH": [function (require, module, exports) {
        var e = require("./_export"); e(e.S + e.F * !require("./_descriptors"), "Object", { defineProperty: require("./_object-dp").f });
    }, { "./_export": "vSO4", "./_descriptors": "6MLN", "./_object-dp": "Gfzd" }], "3v7p": [function (require, module, exports) {
        require("../../modules/es6.object.define-property"); var e = require("../../modules/_core").Object; module.exports = function (r, o, t) { return e.defineProperty(r, o, t) };
    }, { "../../modules/es6.object.define-property": "htFH", "../../modules/_core": "zKeE" }], "FFZn": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/object/define-property"), __esModule: !0 };
    }, { "core-js/library/fn/object/define-property": "3v7p" }], "jx4H": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("../core-js/object/define-property"), r = t(e); function t(e) { return e && e.__esModule ? e : { default: e } } exports.default = function () { function e(e, t) { for (var u = 0; u < t.length; u++) { var n = t[u]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), (0, r.default)(e, n.key, n) } } return function (r, t, u) { return t && e(r.prototype, t), u && e(r, u), r } }();
    }, { "../core-js/object/define-property": "FFZn" }], "Snk9": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = r; var e = require("react"), t = a(e); function a(e) { return e && e.__esModule ? e : { default: e } } function r(e) { var a = e.errors; return t.default.createElement("div", { className: "panel panel-danger errors" }, t.default.createElement("div", { className: "panel-heading" }, t.default.createElement("h3", { className: "panel-title" }, "Errors")), t.default.createElement("ul", { className: "list-group" }, a.map(function (e, a) { return t.default.createElement("li", { key: a, className: "list-group-item text-danger" }, e.stack) }))) }
    }, { "react": "1n8/" }], "o4G5": [function (require, module, exports) {
        module.exports = function (e, r, l) { var a = void 0 === l; switch (r.length) { case 0: return a ? e() : e.call(l); case 1: return a ? e(r[0]) : e.call(l, r[0]); case 2: return a ? e(r[0], r[1]) : e.call(l, r[0], r[1]); case 3: return a ? e(r[0], r[1], r[2]) : e.call(l, r[0], r[1], r[2]); case 4: return a ? e(r[0], r[1], r[2], r[3]) : e.call(l, r[0], r[1], r[2], r[3]) }return e.apply(l, r) };
    }, {}], "uzcO": [function (require, module, exports) {


        var e, t, n, i = require("./_ctx"), o = require("./_invoke"), r = require("./_html"), s = require("./_dom-create"), a = require("./_global"), c = a.process, u = a.setImmediate, p = a.clearImmediate, f = a.MessageChannel, l = a.Dispatch, d = 0, m = {}, h = "onreadystatechange", g = function () { var e = +this; if (m.hasOwnProperty(e)) { var t = m[e]; delete m[e], t() } }, v = function (e) { g.call(e.data) }; u && p || (u = function (t) { for (var n = [], i = 1; arguments.length > i;)n.push(arguments[i++]); return m[++d] = function () { o("function" == typeof t ? t : Function(t), n) }, e(d), d }, p = function (e) { delete m[e] }, "process" == require("./_cof")(c) ? e = function (e) { c.nextTick(i(g, e, 1)) } : l && l.now ? e = function (e) { l.now(i(g, e, 1)) } : f ? (n = (t = new f).port2, t.port1.onmessage = v, e = i(n.postMessage, n, 1)) : a.addEventListener && "function" == typeof postMessage && !a.importScripts ? (e = function (e) { a.postMessage(e + "", "*") }, a.addEventListener("message", v, !1)) : e = h in s("script") ? function (e) { r.appendChild(s("script"))[h] = function () { r.removeChild(this), g.call(e) } } : function (e) { setTimeout(i(g, e, 1), 0) }), module.exports = { set: u, clear: p };
    }, { "./_ctx": "3zRh", "./_invoke": "o4G5", "./_html": "ebIA", "./_dom-create": "9kxq", "./_global": "i1Q6", "./_cof": "ShN9" }], "hmSa": [function (require, module, exports) {
        var e = require("./_export"), r = require("./_task"); e(e.G + e.B, { setImmediate: r.set, clearImmediate: r.clear });
    }, { "./_export": "vSO4", "./_task": "uzcO" }], "g3Re": [function (require, module, exports) {
        require("../modules/web.immediate"), module.exports = require("../modules/_core").setImmediate;
    }, { "../modules/web.immediate": "hmSa", "../modules/_core": "zKeE" }], "mMre": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/set-immediate"), __esModule: !0 };
    }, { "core-js/library/fn/set-immediate": "g3Re" }], "O6kh": [function (require, module, exports) {
        var r = require("./_hide"); module.exports = function (e, i, n) { for (var o in i) n && e[o] ? e[o] = i[o] : r(e, o, i[o]); return e };
    }, { "./_hide": "akPY" }], "KUik": [function (require, module, exports) {
        module.exports = function (o, n, r, i) { if (!(o instanceof n) || void 0 !== i && i in o) throw TypeError(r + ": incorrect invocation!"); return o };
    }, {}], "hEIm": [function (require, module, exports) {
        var r = require("./_an-object"); module.exports = function (t, e, o, a) { try { return a ? e(r(o)[0], o[1]) : e(o) } catch (n) { var c = t.return; throw void 0 !== c && r(c.call(t)), n } };
    }, { "./_an-object": "zotD" }], "af0K": [function (require, module, exports) {
        var r = require("./_iterators"), e = require("./_wks")("iterator"), t = Array.prototype; module.exports = function (o) { return void 0 !== o && (r.Array === o || t[e] === o) };
    }, { "./_iterators": "dhak", "./_wks": "Ug9I" }], "ZHvQ": [function (require, module, exports) {
        var e = require("./_cof"), t = require("./_wks")("toStringTag"), n = "Arguments" == e(function () { return arguments }()), r = function (e, t) { try { return e[t] } catch (n) { } }; module.exports = function (u) { var o, c, i; return void 0 === u ? "Undefined" : null === u ? "Null" : "string" == typeof (c = r(o = Object(u), t)) ? c : n ? e(o) : "Object" == (i = e(o)) && "function" == typeof o.callee ? "Arguments" : i };
    }, { "./_cof": "ShN9", "./_wks": "Ug9I" }], "7AqT": [function (require, module, exports) {
        var r = require("./_classof"), e = require("./_wks")("iterator"), t = require("./_iterators"); module.exports = require("./_core").getIteratorMethod = function (o) { if (null != o) return o[e] || o["@@iterator"] || t[r(o)] };
    }, { "./_classof": "ZHvQ", "./_wks": "Ug9I", "./_iterators": "dhak", "./_core": "zKeE" }], "ozpD": [function (require, module, exports) {
        var e = require("./_ctx"), r = require("./_iter-call"), t = require("./_is-array-iter"), i = require("./_an-object"), o = require("./_to-length"), n = require("./core.get-iterator-method"), u = {}, a = {}, f = module.exports = function (f, l, c, q, _) { var h, s, d, g, p = _ ? function () { return f } : n(f), v = e(c, q, l ? 2 : 1), x = 0; if ("function" != typeof p) throw TypeError(f + " is not iterable!"); if (t(p)) { for (h = o(f.length); h > x; x++)if ((g = l ? v(i(s = f[x])[0], s[1]) : v(f[x])) === u || g === a) return g } else for (d = p.call(f); !(s = d.next()).done;)if ((g = r(d, v, s.value, l)) === u || g === a) return g }; f.BREAK = u, f.RETURN = a;
    }, { "./_ctx": "3zRh", "./_iter-call": "hEIm", "./_is-array-iter": "af0K", "./_an-object": "zotD", "./_to-length": "S7IM", "./core.get-iterator-method": "7AqT" }], "FGzK": [function (require, module, exports) {

        "use strict"; var e = require("./_global"), r = require("./_core"), i = require("./_object-dp"), t = require("./_descriptors"), u = require("./_wks")("species"); module.exports = function (o) { var c = "function" == typeof r[o] ? r[o] : e[o]; t && c && !c[u] && i.f(c, u, { configurable: !0, get: function () { return this } }) };
    }, { "./_global": "i1Q6", "./_core": "zKeE", "./_object-dp": "Gfzd", "./_descriptors": "6MLN", "./_wks": "Ug9I" }], "7Liz": [function (require, module, exports) {
        var r = require("./_is-object"); module.exports = function (e, i) { if (!r(e) || e._t !== i) throw TypeError("Incompatible receiver, " + i + " required!"); return e };
    }, { "./_is-object": "BxvP" }], "AePr": [function (require, module, exports) {
        "use strict"; var e = require("./_object-dp").f, r = require("./_object-create"), t = require("./_redefine-all"), i = require("./_ctx"), n = require("./_an-instance"), _ = require("./_for-of"), o = require("./_iter-define"), u = require("./_iter-step"), f = require("./_set-species"), s = require("./_descriptors"), l = require("./_meta").fastKey, c = require("./_validate-collection"), v = s ? "_s" : "size", a = function (e, r) { var t, i = l(r); if ("F" !== i) return e._i[i]; for (t = e._f; t; t = t.n)if (t.k == r) return t }; module.exports = { getConstructor: function (o, u, f, l) { var h = o(function (e, t) { n(e, h, u, "_i"), e._t = u, e._i = r(null), e._f = void 0, e._l = void 0, e[v] = 0, null != t && _(t, f, e[l], e) }); return t(h.prototype, { clear: function () { for (var e = c(this, u), r = e._i, t = e._f; t; t = t.n)t.r = !0, t.p && (t.p = t.p.n = void 0), delete r[t.i]; e._f = e._l = void 0, e[v] = 0 }, delete: function (e) { var r = c(this, u), t = a(r, e); if (t) { var i = t.n, n = t.p; delete r._i[t.i], t.r = !0, n && (n.n = i), i && (i.p = n), r._f == t && (r._f = i), r._l == t && (r._l = n), r[v]-- } return !!t }, forEach: function (e) { c(this, u); for (var r, t = i(e, arguments.length > 1 ? arguments[1] : void 0, 3); r = r ? r.n : this._f;)for (t(r.v, r.k, this); r && r.r;)r = r.p }, has: function (e) { return !!a(c(this, u), e) } }), s && e(h.prototype, "size", { get: function () { return c(this, u)[v] } }), h }, def: function (e, r, t) { var i, n, _ = a(e, r); return _ ? _.v = t : (e._l = _ = { i: n = l(r, !0), k: r, v: t, p: i = e._l, n: void 0, r: !1 }, e._f || (e._f = _), i && (i.n = _), e[v]++ , "F" !== n && (e._i[n] = _)), e }, getEntry: a, setStrong: function (e, r, t) { o(e, r, function (e, t) { this._t = c(e, r), this._k = t, this._l = void 0 }, function () { for (var e = this._k, r = this._l; r && r.r;)r = r.p; return this._t && (this._l = r = r ? r.n : this._t._f) ? u(0, "keys" == e ? r.k : "values" == e ? r.v : [r.k, r.v]) : (this._t = void 0, u(1)) }, t ? "entries" : "values", !t, !0), f(r) } };
    }, { "./_object-dp": "Gfzd", "./_object-create": "TNJq", "./_redefine-all": "O6kh", "./_ctx": "3zRh", "./_an-instance": "KUik", "./_for-of": "ozpD", "./_iter-define": "uRfg", "./_iter-step": "xwD+", "./_set-species": "FGzK", "./_descriptors": "6MLN", "./_meta": "e8vu", "./_validate-collection": "7Liz" }], "7tZR": [function (require, module, exports) {
        var r = require("./_is-object"), e = require("./_is-array"), o = require("./_wks")("species"); module.exports = function (i) { var t; return e(i) && ("function" != typeof (t = i.constructor) || t !== Array && !e(t.prototype) || (t = void 0), r(t) && null === (t = t[o]) && (t = void 0)), void 0 === t ? Array : t };
    }, { "./_is-object": "BxvP", "./_is-array": "ayXv", "./_wks": "Ug9I" }], "TD/Z": [function (require, module, exports) {
        var r = require("./_array-species-constructor"); module.exports = function (e, n) { return new (r(e))(n) };
    }, { "./_array-species-constructor": "7tZR" }], "tMiz": [function (require, module, exports) {
        var e = require("./_ctx"), r = require("./_iobject"), t = require("./_to-object"), i = require("./_to-length"), u = require("./_array-species-create"); module.exports = function (n, c) { var s = 1 == n, a = 2 == n, o = 3 == n, f = 4 == n, l = 6 == n, q = 5 == n || l, _ = c || u; return function (u, c, h) { for (var v, p, b = t(u), d = r(b), g = e(c, h, 3), j = i(d.length), x = 0, m = s ? _(u, j) : a ? _(u, 0) : void 0; j > x; x++)if ((q || x in d) && (p = g(v = d[x], x, b), n)) if (s) m[x] = p; else if (p) switch (n) { case 3: return !0; case 5: return v; case 6: return x; case 2: m.push(v) } else if (f) return !1; return l ? -1 : o || f ? f : m } };
    }, { "./_ctx": "3zRh", "./_iobject": "E5Ce", "./_to-object": "mbLO", "./_to-length": "S7IM", "./_array-species-create": "TD/Z" }], "cYD/": [function (require, module, exports) {

        "use strict"; var e = require("./_global"), r = require("./_export"), t = require("./_meta"), i = require("./_fails"), o = require("./_hide"), n = require("./_redefine-all"), u = require("./_for-of"), s = require("./_an-instance"), a = require("./_is-object"), c = require("./_set-to-string-tag"), _ = require("./_object-dp").f, f = require("./_array-methods")(0), d = require("./_descriptors"); module.exports = function (p, l, q, h, g, y) { var v = e[p], E = v, b = g ? "set" : "add", m = E && E.prototype, x = {}; return d && "function" == typeof E && (y || m.forEach && !i(function () { (new E).entries().next() })) ? (E = l(function (e, r) { s(e, E, p, "_c"), e._c = new v, null != r && u(r, g, e[b], e) }), f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","), function (e) { var r = "add" == e || "set" == e; e in m && (!y || "clear" != e) && o(E.prototype, e, function (t, i) { if (s(this, E, e), !r && y && !a(t)) return "get" == e && void 0; var o = this._c[e](0 === t ? 0 : t, i); return r ? this : o }) }), y || _(E.prototype, "size", { get: function () { return this._c.size } })) : (E = h.getConstructor(l, p, g, b), n(E.prototype, q), t.NEED = !0), c(E, p), x[p] = E, r(r.G + r.W + r.F, x), y || h.setStrong(E, p, g), E };
    }, { "./_global": "i1Q6", "./_export": "vSO4", "./_meta": "e8vu", "./_fails": "wLcK", "./_hide": "akPY", "./_redefine-all": "O6kh", "./_for-of": "ozpD", "./_an-instance": "KUik", "./_is-object": "BxvP", "./_set-to-string-tag": "11Ut", "./_object-dp": "Gfzd", "./_array-methods": "tMiz", "./_descriptors": "6MLN" }], "+o4f": [function (require, module, exports) {
        "use strict"; var e = require("./_collection-strong"), t = require("./_validate-collection"), r = "Set"; module.exports = require("./_collection")(r, function (e) { return function () { return e(this, arguments.length > 0 ? arguments[0] : void 0) } }, { add: function (i) { return e.def(t(this, r), i = 0 === i ? 0 : i, i) } }, e);
    }, { "./_collection-strong": "AePr", "./_validate-collection": "7Liz", "./_collection": "cYD/" }], "YLmZ": [function (require, module, exports) {
        var r = require("./_for-of"); module.exports = function (e, o) { var u = []; return r(e, !1, u.push, u, o), u };
    }, { "./_for-of": "ozpD" }], "x6MZ": [function (require, module, exports) {
        var r = require("./_classof"), e = require("./_array-from-iterable"); module.exports = function (t) { return function () { if (r(this) != t) throw TypeError(t + "#toJSON isn't generic"); return e(this) } };
    }, { "./_classof": "ZHvQ", "./_array-from-iterable": "YLmZ" }], "XMdB": [function (require, module, exports) {
        var e = require("./_export"); e(e.P + e.R, "Set", { toJSON: require("./_collection-to-json")("Set") });
    }, { "./_export": "vSO4", "./_collection-to-json": "x6MZ" }], "32ty": [function (require, module, exports) {
        "use strict"; var r = require("./_export"); module.exports = function (e) { r(r.S, e, { of: function () { for (var r = arguments.length, e = new Array(r); r--;)e[r] = arguments[r]; return new this(e) } }) };
    }, { "./_export": "vSO4" }], "OhiW": [function (require, module, exports) {
        require("./_set-collection-of")("Set");
    }, { "./_set-collection-of": "32ty" }], "IC7E": [function (require, module, exports) {
        "use strict"; var r = require("./_export"), e = require("./_a-function"), u = require("./_ctx"), i = require("./_for-of"); module.exports = function (t) { r(r.S, t, { from: function (r) { var t, n, o, s, f = arguments[1]; return e(this), (t = void 0 !== f) && e(f), null == r ? new this : (n = [], t ? (o = 0, s = u(f, arguments[2], 2), i(r, !1, function (r) { n.push(s(r, o++)) })) : i(r, !1, n.push, n), new this(n)) } }) };
    }, { "./_export": "vSO4", "./_a-function": "g31e", "./_ctx": "3zRh", "./_for-of": "ozpD" }], "dMXp": [function (require, module, exports) {
        require("./_set-collection-from")("Set");
    }, { "./_set-collection-from": "IC7E" }], "vvo2": [function (require, module, exports) {
        require("../modules/es6.object.to-string"), require("../modules/es6.string.iterator"), require("../modules/web.dom.iterable"), require("../modules/es6.set"), require("../modules/es7.set.to-json"), require("../modules/es7.set.of"), require("../modules/es7.set.from"), module.exports = require("../modules/_core").Set;
    }, { "../modules/es6.object.to-string": "70rD", "../modules/es6.string.iterator": "i+u+", "../modules/web.dom.iterable": "COf8", "../modules/es6.set": "+o4f", "../modules/es7.set.to-json": "XMdB", "../modules/es7.set.of": "OhiW", "../modules/es7.set.from": "dMXp", "../modules/_core": "zKeE" }], "7Zlx": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/set"), __esModule: !0 };
    }, { "core-js/library/fn/set": "vvo2" }], "vUQk": [function (require, module, exports) {
        "use strict"; var e = require("./_object-dp"), r = require("./_property-desc"); module.exports = function (t, i, o) { i in t ? e.f(t, i, r(0, o)) : t[i] = o };
    }, { "./_object-dp": "Gfzd", "./_property-desc": "0WCH" }], "Lli7": [function (require, module, exports) {
        var r = require("./_wks")("iterator"), t = !1; try { var n = [7][r](); n.return = function () { t = !0 }, Array.from(n, function () { throw 2 }) } catch (e) { } module.exports = function (n, u) { if (!u && !t) return !1; var o = !1; try { var c = [7], a = c[r](); a.next = function () { return { done: o = !0 } }, c[r] = function () { return a }, n(c) } catch (e) { } return o };
    }, { "./_wks": "Ug9I" }], "N484": [function (require, module, exports) {
        "use strict"; var e = require("./_ctx"), r = require("./_export"), t = require("./_to-object"), i = require("./_iter-call"), o = require("./_is-array-iter"), u = require("./_to-length"), n = require("./_create-property"), a = require("./core.get-iterator-method"); r(r.S + r.F * !require("./_iter-detect")(function (e) { Array.from(e) }), "Array", { from: function (r) { var l, c, f, q, _ = t(r), h = "function" == typeof this ? this : Array, v = arguments.length, y = v > 1 ? arguments[1] : void 0, d = void 0 !== y, s = 0, g = a(_); if (d && (y = e(y, v > 2 ? arguments[2] : void 0, 2)), null == g || h == Array && o(g)) for (c = new h(l = u(_.length)); l > s; s++)n(c, s, d ? y(_[s], s) : _[s]); else for (q = g.call(_), c = new h; !(f = q.next()).done; s++)n(c, s, d ? i(q, y, [f.value, s], !0) : f.value); return c.length = s, c } });
    }, { "./_ctx": "3zRh", "./_export": "vSO4", "./_to-object": "mbLO", "./_iter-call": "hEIm", "./_is-array-iter": "af0K", "./_to-length": "S7IM", "./_create-property": "vUQk", "./core.get-iterator-method": "7AqT", "./_iter-detect": "Lli7" }], "O35A": [function (require, module, exports) {
        require("../../modules/es6.string.iterator"), require("../../modules/es6.array.from"), module.exports = require("../../modules/_core").Array.from;
    }, { "../../modules/es6.string.iterator": "i+u+", "../../modules/es6.array.from": "N484", "../../modules/_core": "zKeE" }], "VuZO": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/array/from"), __esModule: !0 };
    }, { "core-js/library/fn/array/from": "O35A" }], "ugM7": [function (require, module, exports) {
        var r = require("./_an-object"), e = require("./core.get-iterator-method"); module.exports = require("./_core").getIterator = function (t) { var o = e(t); if ("function" != typeof o) throw TypeError(t + " is not iterable!"); return r(o.call(t)) };
    }, { "./_an-object": "zotD", "./core.get-iterator-method": "7AqT", "./_core": "zKeE" }], "Lvd3": [function (require, module, exports) {
        require("../modules/web.dom.iterable"), require("../modules/es6.string.iterator"), module.exports = require("../modules/core.get-iterator");
    }, { "../modules/web.dom.iterable": "COf8", "../modules/es6.string.iterator": "i+u+", "../modules/core.get-iterator": "ugM7" }], "X9RM": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/get-iterator"), __esModule: !0 };
    }, { "core-js/library/fn/get-iterator": "Lvd3" }], "mYpx": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var r = require("../core-js/array/from"), e = t(r); function t(r) { return r && r.__esModule ? r : { default: r } } exports.default = function (r) { if (Array.isArray(r)) { for (var t = 0, u = Array(r.length); t < r.length; t++)u[t] = r[t]; return u } return (0, e.default)(r) };
    }, { "../core-js/array/from": "VuZO" }], "jHxp": [function (require, module, exports) {
        var r = require("./_export"); r(r.S, "Number", { isNaN: function (r) { return r != r } });
    }, { "./_export": "vSO4" }], "IAJx": [function (require, module, exports) {
        require("../../modules/es6.number.is-nan"), module.exports = require("../../modules/_core").Number.isNaN;
    }, { "../../modules/es6.number.is-nan": "jHxp", "../../modules/_core": "zKeE" }], "qwoA": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/number/is-nan"), __esModule: !0 };
    }, { "core-js/library/fn/number/is-nan": "IAJx" }], "Xos8": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("../core-js/object/define-property"), r = t(e); function t(e) { return e && e.__esModule ? e : { default: e } } exports.default = function (e, t, u) { return t in e ? (0, r.default)(e, t, { value: u, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = u, e };
    }, { "../core-js/object/define-property": "FFZn" }], "Oiy/": [function (require, module, exports) {
        var global = arguments[3];
        var t = arguments[3], r = "Expected a function", n = "__lodash_hash_undefined__", e = 1 / 0, o = "[object Function]", i = "[object GeneratorFunction]", u = "[object Symbol]", a = /^\./, c = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g, f = /[\\^$.*+?()[\]{}|]/g, s = /\\(\\)?/g, p = /^\[object .+?Constructor\]$/, l = "object" == typeof t && t && t.Object === Object && t, _ = "object" == typeof self && self && self.Object === Object && self, h = l || _ || Function("return this")(); function y(t, r) { for (var n = -1, e = t ? t.length : 0, o = Array(e); ++n < e;)o[n] = r(t[n], n, t); return o } function v(t, r) { return null == t ? void 0 : t[r] } function d(t) { var r = !1; if (null != t && "function" != typeof t.toString) try { r = !!(t + "") } catch (n) { } return r } var g = Array.prototype, b = Function.prototype, j = Object.prototype, m = h["__core-js_shared__"], O = function () { var t = /[^.]+$/.exec(m && m.keys && m.keys.IE_PROTO || ""); return t ? "Symbol(src)_1." + t : "" }(), w = b.toString, $ = j.hasOwnProperty, S = j.toString, A = RegExp("^" + w.call($).replace(f, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"), x = h.Symbol, E = g.splice, F = nt(h, "Map"), C = nt(Object, "create"), P = x ? x.prototype : void 0, k = P ? P.toString : void 0; function R(t) { var r = -1, n = t ? t.length : 0; for (this.clear(); ++r < n;) { var e = t[r]; this.set(e[0], e[1]) } } function T() { this.__data__ = C ? C(null) : {} } function G(t) { return this.has(t) && delete this.__data__[t] } function I(t) { var r = this.__data__; if (C) { var e = r[t]; return e === n ? void 0 : e } return $.call(r, t) ? r[t] : void 0 } function M(t) { var r = this.__data__; return C ? void 0 !== r[t] : $.call(r, t) } function q(t, r) { return this.__data__[t] = C && void 0 === r ? n : r, this } function z(t) { var r = -1, n = t ? t.length : 0; for (this.clear(); ++r < n;) { var e = t[r]; this.set(e[0], e[1]) } } function B() { this.__data__ = [] } function D(t) { var r = this.__data__, n = X(r, t); return !(n < 0) && (n == r.length - 1 ? r.pop() : E.call(r, n, 1), !0) } function H(t) { var r = this.__data__, n = X(r, t); return n < 0 ? void 0 : r[n][1] } function J(t) { return X(this.__data__, t) > -1 } function K(t, r) { var n = this.__data__, e = X(n, t); return e < 0 ? n.push([t, r]) : n[e][1] = r, this } function L(t) { var r = -1, n = t ? t.length : 0; for (this.clear(); ++r < n;) { var e = t[r]; this.set(e[0], e[1]) } } function N() { this.__data__ = { hash: new R, map: new (F || z), string: new R } } function Q(t) { return rt(this, t).delete(t) } function U(t) { return rt(this, t).get(t) } function V(t) { return rt(this, t).has(t) } function W(t, r) { return rt(this, t).set(t, r), this } function X(t, r) { for (var n = t.length; n--;)if (ft(t[n][0], r)) return n; return -1 } function Y(t) { return !(!lt(t) || ot(t)) && (pt(t) || d(t) ? A : p).test(at(t)) } function Z(t) { if ("string" == typeof t) return t; if (ht(t)) return k ? k.call(t) : ""; var r = t + ""; return "0" == r && 1 / t == -e ? "-0" : r } function tt(t, r) { var n = -1, e = t.length; for (r || (r = Array(e)); ++n < e;)r[n] = t[n]; return r } function rt(t, r) { var n = t.__data__; return et(r) ? n["string" == typeof r ? "string" : "hash"] : n.map } function nt(t, r) { var n = v(t, r); return Y(n) ? n : void 0 } function et(t) { var r = typeof t; return "string" == r || "number" == r || "symbol" == r || "boolean" == r ? "__proto__" !== t : null === t } function ot(t) { return !!O && O in t } R.prototype.clear = T, R.prototype.delete = G, R.prototype.get = I, R.prototype.has = M, R.prototype.set = q, z.prototype.clear = B, z.prototype.delete = D, z.prototype.get = H, z.prototype.has = J, z.prototype.set = K, L.prototype.clear = N, L.prototype.delete = Q, L.prototype.get = U, L.prototype.has = V, L.prototype.set = W; var it = ct(function (t) { t = yt(t); var r = []; return a.test(t) && r.push(""), t.replace(c, function (t, n, e, o) { r.push(e ? o.replace(s, "$1") : n || t) }), r }); function ut(t) { if ("string" == typeof t || ht(t)) return t; var r = t + ""; return "0" == r && 1 / t == -e ? "-0" : r } function at(t) { if (null != t) { try { return w.call(t) } catch (r) { } try { return t + "" } catch (r) { } } return "" } function ct(t, n) { if ("function" != typeof t || n && "function" != typeof n) throw new TypeError(r); var e = function () { var r = arguments, o = n ? n.apply(this, r) : r[0], i = e.cache; if (i.has(o)) return i.get(o); var u = t.apply(this, r); return e.cache = i.set(o, u), u }; return e.cache = new (ct.Cache || L), e } function ft(t, r) { return t === r || t != t && r != r } ct.Cache = L; var st = Array.isArray; function pt(t) { var r = lt(t) ? S.call(t) : ""; return r == o || r == i } function lt(t) { var r = typeof t; return !!t && ("object" == r || "function" == r) } function _t(t) { return !!t && "object" == typeof t } function ht(t) { return "symbol" == typeof t || _t(t) && S.call(t) == u } function yt(t) { return null == t ? "" : Z(t) } function vt(t) { return st(t) ? y(t, ut) : ht(t) ? [t] : tt(it(t)) } module.exports = vt;
    }, {}], "jIGR": [function (require, module, exports) {
        "use strict"; var r = Array.isArray, t = Object.keys, e = Object.prototype.hasOwnProperty; module.exports = function n(i, f) { if (i === f) return !0; var a, o, u, c = r(i), s = r(f); if (c && s) { if ((o = i.length) != f.length) return !1; for (a = 0; a < o; a++)if (!n(i[a], f[a])) return !1; return !0 } if (c != s) return !1; var g = i instanceof Date, l = f instanceof Date; if (g != l) return !1; if (g && l) return i.getTime() == f.getTime(); var p = i instanceof RegExp, h = f instanceof RegExp; if (p != h) return !1; if (p && h) return i.toString() == f.toString(); if (i instanceof Object && f instanceof Object) { var v = t(i); if ((o = v.length) !== t(f).length) return !1; for (a = 0; a < o; a++)if (!e.call(f, v[a])) return !1; for (a = 0; a < o; a++)if (!n(i[u = v[a]], f[u])) return !1; return !0 } return !1 };
    }, {}], "9n4O": [function (require, module, exports) {
        "use strict"; module.exports = function (r) { for (var t, e = 0, o = r.length, c = 0; c < o;)e++ , (t = r.charCodeAt(c++)) >= 55296 && t <= 56319 && c < o && 56320 == (64512 & (t = r.charCodeAt(c))) && c++; return e };
    }, {}], "S6qf": [function (require, module, exports) {
        "use strict"; function r(r, e) { for (var t in e = e || {}, r) e[t] = r[t]; return e } function e(r, e, t) { var n = t ? " !== " : " === ", a = t ? " || " : " && ", o = t ? "!" : "", u = t ? "" : "!"; switch (r) { case "null": return e + n + "null"; case "array": return o + "Array.isArray(" + e + ")"; case "object": return "(" + o + e + a + "typeof " + e + n + '"object"' + a + u + "Array.isArray(" + e + "))"; case "integer": return "(typeof " + e + n + '"number"' + a + u + "(" + e + " % 1)" + a + e + n + e + ")"; default: return "typeof " + e + n + '"' + r + '"' } } function t(r, t) { switch (r.length) { case 1: return e(r[0], t, !0); default: var n = "", a = o(r); for (var u in a.array && a.object && (n = a.null ? "(" : "(!" + t + " || ", n += "typeof " + t + ' !== "object")', delete a.null, delete a.array, delete a.object), a.number && delete a.integer, a) n += (n ? " && " : "") + e(u, t, !0); return n } } module.exports = { copy: r, checkDataType: e, checkDataTypes: t, coerceToTypes: a, toHash: o, getProperty: l, escapeQuotes: i, equal: require("fast-deep-equal"), ucs2length: require("./ucs2length"), varOccurences: s, varReplace: f, cleanUpCode: h, finalCleanUpCode: C, schemaHasRules: R, schemaHasRulesExcept: x, toQuotedString: j, getPathExpr: P, getPath: q, getData: J, unescapeFragment: U, unescapeJsonPointer: O, escapeFragment: _, escapeJsonPointer: H }; var n = o(["string", "number", "integer", "boolean", "null"]); function a(r, e) { if (Array.isArray(e)) { for (var t = [], a = 0; a < e.length; a++) { var o = e[a]; n[o] ? t[t.length] = o : "array" === r && "array" === o && (t[t.length] = o) } if (t.length) return t } else { if (n[e]) return [e]; if ("array" === r && "array" === e) return ["array"] } } function o(r) { for (var e = {}, t = 0; t < r.length; t++)e[r[t]] = !0; return e } var u = /^[a-z$_][a-z$_0-9]*$/i, c = /'|\\/g; function l(r) { return "number" == typeof r ? "[" + r + "]" : u.test(r) ? "." + r : "['" + i(r) + "']" } function i(r) { return r.replace(c, "\\$&").replace(/\n/g, "\\n").replace(/\r/g, "\\r").replace(/\f/g, "\\f").replace(/\t/g, "\\t") } function s(r, e) { e += "[^0-9]"; var t = r.match(new RegExp(e, "g")); return t ? t.length : 0 } function f(r, e, t) { return e += "([^0-9])", t = t.replace(/\$/g, "$$$$"), r.replace(new RegExp(e, "g"), t + "$1") } var p = /else\s*{\s*}/g, g = /if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g, v = /if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g; function h(r) { return r.replace(p, "").replace(g, "").replace(v, "if (!($1))") } var d = /[^v.]errors/g, y = /var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g, m = /var errors = 0;|var vErrors = null;/g, $ = "return errors === 0;", w = "validate.errors = null; return true;", E = /if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/, b = "return data;", A = /[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g, D = /if \(rootData === undefined\) rootData = data;/; function C(r, e) { var t = r.match(d); return t && 2 == t.length && (r = e ? r.replace(m, "").replace(E, b) : r.replace(y, "").replace($, w)), (t = r.match(A)) && 3 === t.length ? r.replace(D, "") : r } function R(r, e) { if ("boolean" == typeof r) return !r; for (var t in r) if (e[t]) return !0 } function x(r, e, t) { if ("boolean" == typeof r) return !r && "not" != t; for (var n in r) if (n != t && e[n]) return !0 } function j(r) { return "'" + i(r) + "'" } function P(r, e, t, n) { return T(r, t ? "'/' + " + e + (n ? "" : ".replace(/~/g, '~0').replace(/\\//g, '~1')") : n ? "'[' + " + e + " + ']'" : "'[\\'' + " + e + " + '\\']'") } function q(r, e, t) { return T(r, j(t ? "/" + H(e) : l(e))) } var z = /^\/(?:[^~]|~0|~1)*$/, I = /^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/; function J(r, e, t) { var n, a, o, u; if ("" === r) return "rootData"; if ("/" == r[0]) { if (!z.test(r)) throw new Error("Invalid JSON-pointer: " + r); a = r, o = "rootData" } else { if (!(u = r.match(I))) throw new Error("Invalid JSON-pointer: " + r); if (n = +u[1], "#" == (a = u[2])) { if (n >= e) throw new Error("Cannot access property/index " + n + " levels up, current level is " + e); return t[e - n] } if (n > e) throw new Error("Cannot access data " + n + " levels up, current level is " + e); if (o = "data" + (e - n || ""), !a) return o } for (var c = o, i = a.split("/"), s = 0; s < i.length; s++) { var f = i[s]; f && (c += " && " + (o += l(O(f)))) } return c } function T(r, e) { return '""' == r ? e : (r + " + " + e).replace(/' \+ '/g, "") } function U(r) { return O(decodeURIComponent(r)) } function _(r) { return encodeURIComponent(H(r)) } function H(r) { return r.replace(/~/g, "~0").replace(/\//g, "~1") } function O(r) { return r.replace(/~1/g, "/").replace(/~0/g, "~") }
    }, { "fast-deep-equal": "jIGR", "./ucs2length": "9n4O" }], "h0OD": [function (require, module, exports) {
        "use strict"; var t = require("./util"); function e(e) { t.copy(e, this) } module.exports = e;
    }, { "./util": "S6qf" }], "uMRE": [function (require, module, exports) {
        "use strict"; var e = module.exports = function (e, i, t) { "function" == typeof i && (t = i, i = {}), r(i, t, e, "", e) }; function r(t, n, o, s, a, m, p, f, y) { if (o && "object" == typeof o && !Array.isArray(o)) for (var u in n(o, s, a, m, p, f, y), o) { var d = o[u]; if (Array.isArray(d)) { if (u in e.arrayKeywords) for (var l = 0; l < d.length; l++)r(t, n, d[l], s + "/" + u + "/" + l, a, s, u, o, l) } else if (u in e.propsKeywords) { if (d && "object" == typeof d) for (var c in d) r(t, n, d[c], s + "/" + u + "/" + i(c), a, s, u, o, c) } else (u in e.keywords || t.allKeys && !(u in e.skipKeywords)) && r(t, n, d, s + "/" + u, a, s, u, o) } } function i(e) { return e.replace(/~/g, "~0").replace(/\//g, "~1") } e.keywords = { additionalItems: !0, items: !0, contains: !0, additionalProperties: !0, propertyNames: !0, not: !0 }, e.arrayKeywords = { items: !0, allOf: !0, anyOf: !0, oneOf: !0 }, e.propsKeywords = { definitions: !0, properties: !0, patternProperties: !0, dependencies: !0 }, e.skipKeywords = { enum: !0, const: !0, required: !0, maximum: !0, minimum: !0, exclusiveMaximum: !0, exclusiveMinimum: !0, multipleOf: !0, maxLength: !0, minLength: !0, pattern: !0, format: !0, maxItems: !0, minItems: !0, uniqueItems: !0, maxProperties: !0, minProperties: !0 };
    }, {}], "FmMj": [function (require, module, exports) {
        "use strict"; var e = require("url"), r = require("fast-deep-equal"), t = require("./util"), i = require("./schema_obj"), s = require("json-schema-traverse"); function a(e, r, t) { var s = this._refs[t]; if ("string" == typeof s) { if (!this._refs[s]) return a.call(this, e, r, s); s = this._refs[s] } if ((s = s || this._schemas[t]) instanceof i) return l(s.schema, this._opts.inlineRefs) ? s.schema : s.validate || this._compile(s); var o, f, h, c = n.call(this, r, t); return c && (o = c.schema, r = c.root, h = c.baseId), o instanceof i ? f = o.validate || e.call(this, o.schema, r, void 0, h) : void 0 !== o && (f = l(o, this._opts.inlineRefs) ? o : e.call(this, o, r, void 0, h)), f } function n(r, t) { var s = e.parse(t, !1, !0), a = p(s), n = v(this._getId(r.schema)); if (a !== n) { var f = _(a), c = this._refs[f]; if ("string" == typeof c) return o.call(this, r, c, s); if (c instanceof i) c.validate || this._compile(c), r = c; else { if (!((c = this._schemas[f]) instanceof i)) return; if (c.validate || this._compile(c), f == _(t)) return { schema: c, root: r, baseId: n }; r = c } if (!r.schema) return; n = v(this._getId(r.schema)) } return h.call(this, s, n, r.schema, r) } function o(e, r, t) { var i = n.call(this, e, r); if (i) { var s = i.schema, a = i.baseId; e = i.root; var o = this._getId(s); return o && (a = g(a, o)), h.call(this, t, a, s, e) } } module.exports = a, a.normalizeId = _, a.fullPath = v, a.url = g, a.ids = y, a.inlineRef = l, a.schema = n; var f = t.toHash(["properties", "patternProperties", "enum", "dependencies", "definitions"]); function h(e, r, i, s) { if (e.hash = e.hash || "", "#/" == e.hash.slice(0, 2)) { for (var a = e.hash.split("/"), o = 1; o < a.length; o++) { var h = a[o]; if (h) { if (void 0 === (i = i[h = t.unescapeFragment(h)])) break; var c; if (!f[h] && ((c = this._getId(i)) && (r = g(r, c)), i.$ref)) { var l = g(r, i.$ref), u = n.call(this, s, l); u && (i = u.schema, s = u.root, r = u.baseId) } } } return void 0 !== i && i !== s.schema ? { schema: i, root: s, baseId: r } : void 0 } } var c = t.toHash(["type", "format", "pattern", "maxLength", "minLength", "maxProperties", "minProperties", "maxItems", "minItems", "maximum", "minimum", "uniqueItems", "multipleOf", "required", "enum"]); function l(e, r) { return !1 !== r && (void 0 === r || !0 === r ? u(e) : r ? m(e) <= r : void 0) } function u(e) { var r; if (Array.isArray(e)) { for (var t = 0; t < e.length; t++)if ("object" == typeof (r = e[t]) && !u(r)) return !1 } else for (var i in e) { if ("$ref" == i) return !1; if ("object" == typeof (r = e[i]) && !u(r)) return !1 } return !0 } function m(e) { var r, t = 0; if (Array.isArray(e)) { for (var i = 0; i < e.length; i++)if ("object" == typeof (r = e[i]) && (t += m(r)), t == 1 / 0) return 1 / 0 } else for (var s in e) { if ("$ref" == s) return 1 / 0; if (c[s]) t++; else if ("object" == typeof (r = e[s]) && (t += m(r) + 1), t == 1 / 0) return 1 / 0 } return t } function v(r, t) { return !1 !== t && (r = _(r)), p(e.parse(r, !1, !0)) } function p(e) { var r = e.protocol || "//" == e.href.slice(0, 2) ? "//" : ""; return (e.protocol || "") + r + (e.host || "") + (e.path || "") + "#" } var d = /#\/?$/; function _(e) { return e ? e.replace(d, "") : "" } function g(r, t) { return t = _(t), e.resolve(r, t) } function y(i) { var a = _(this._getId(i)), n = { "": a }, o = { "": v(a, !1) }, f = {}, h = this; return s(i, { allKeys: !0 }, function (i, s, a, c, l, u, m) { if ("" !== s) { var v = h._getId(i), p = n[c], d = o[c] + "/" + l; if (void 0 !== m && (d += "/" + ("number" == typeof m ? m : t.escapeFragment(m))), "string" == typeof v) { v = p = _(p ? e.resolve(p, v) : v); var g = h._refs[v]; if ("string" == typeof g && (g = h._refs[g]), g && g.schema) { if (!r(i, g.schema)) throw new Error('id "' + v + '" resolves to more than one schema') } else if (v != _(d)) if ("#" == v[0]) { if (f[v] && !r(i, f[v])) throw new Error('id "' + v + '" resolves to more than one schema'); f[v] = i } else h._refs[v] = d } n[s] = p, o[s] = d } }), f }
    }, { "url": "Mej7", "fast-deep-equal": "jIGR", "./util": "S6qf", "./schema_obj": "h0OD", "json-schema-traverse": "uMRE" }], "yAtQ": [function (require, module, exports) {
        "use strict"; var e = require("./resolve"); function t(e) { this.message = "validation failed", this.errors = e, this.ajv = this.validation = !0 } function i(t, s, r) { this.message = r || i.message(t, s), this.missingRef = e.url(t, s), this.missingSchema = e.normalizeId(e.fullPath(this.missingRef)) } function s(e) { return e.prototype = Object.create(Error.prototype), e.prototype.constructor = e, e } module.exports = { Validation: s(t), MissingRef: s(i) }, i.message = function (e, t) { return "can't resolve reference " + t + " from id " + e };
    }, { "./resolve": "FmMj" }], "3Xb3": [function (require, module, exports) {
        "use strict"; module.exports = function (r, t) { t || (t = {}), "function" == typeof t && (t = { cmp: t }); var e, n = "boolean" == typeof t.cycles && t.cycles, i = t.cmp && (e = t.cmp, function (r) { return function (t, n) { var i = { key: t, value: r[t] }, u = { key: n, value: r[n] }; return e(i, u) } }), u = []; return function r(t) { if (t && t.toJSON && "function" == typeof t.toJSON && (t = t.toJSON()), void 0 !== t) { if ("number" == typeof t) return isFinite(t) ? "" + t : "null"; if ("object" != typeof t) return JSON.stringify(t); var e, o; if (Array.isArray(t)) { for (o = "[", e = 0; e < t.length; e++)e && (o += ","), o += r(t[e]) || "null"; return o + "]" } if (null === t) return "null"; if (-1 !== u.indexOf(t)) { if (n) return JSON.stringify("__cycle__"); throw new TypeError("Converting circular structure to JSON") } var f = u.push(t) - 1, c = Object.keys(t).sort(i && i(t)); for (o = "", e = 0; e < c.length; e++) { var l = c[e], y = r(t[l]); y && (o && (o += ","), o += JSON.stringify(l) + ":" + y) } return u.splice(f, 1), "{" + o + "}" } }(r) };
    }, {}], "XNwE": [function (require, module, exports) {
        "use strict"; module.exports = function (e, r, a) { var t = "", s = !0 === e.schema.$async, o = e.util.schemaHasRulesExcept(e.schema, e.RULES.all, "$ref"), i = e.self._getId(e.schema); if (e.isTop) { if (s) { e.async = !0; var l = "es7" == e.opts.async; e.yieldAwait = l ? "await" : "yield" } t += " var validate = ", s ? l ? t += " (async function " : ("*" != e.opts.async && (t += "co.wrap"), t += "(function* ") : t += " (function ", t += " (data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ", i && (e.opts.sourceCode || e.opts.processCode) && (t += " /*# sourceURL=" + i + " */ ") } if ("boolean" == typeof e.schema || !o && !e.schema.$ref) { var n = e.level, h = e.dataLevel, p = e.schema["false schema"], c = e.schemaPath + e.util.getProperty("false schema"), d = e.errSchemaPath + "/false schema", f = !e.opts.allErrors, u = "data" + (h || ""), v = "valid" + n; if (!1 === e.schema) { e.isTop ? f = !0 : t += " var " + v + " = false; ", (M = M || []).push(t), t = "", !1 !== e.createErrors ? (t += " { keyword: 'false schema' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(d) + " , params: {} ", !1 !== e.opts.messages && (t += " , message: 'boolean schema is false' "), e.opts.verbose && (t += " , schema: false , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), t += " } ") : t += " {} "; var m = t; t = M.pop(), !e.compositeRule && f ? e.async ? t += " throw new ValidationError([" + m + "]); " : t += " validate.errors = [" + m + "]; return false; " : t += " var err = " + m + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; " } else e.isTop ? t += s ? " return data; " : " validate.errors = null; return true; " : t += " var " + v + " = true; "; return e.isTop && (t += " }); return validate; "), t } if (e.isTop) { var y = e.isTop; n = e.level = 0, h = e.dataLevel = 0, u = "data"; e.rootId = e.resolve.fullPath(e.self._getId(e.root.schema)), e.baseId = e.baseId || e.rootId, delete e.isTop, e.dataPathArr = [void 0], t += " var vErrors = null; ", t += " var errors = 0;     ", t += " if (rootData === undefined) rootData = data; " } else { n = e.level, u = "data" + ((h = e.dataLevel) || ""); if (i && (e.baseId = e.resolve.url(e.baseId, i)), s && !e.async) throw new Error("async schema in sync schema"); t += " var errs_" + n + " = errors;" } v = "valid" + n, f = !e.opts.allErrors; var P = "", g = "", E = e.schema.type, w = Array.isArray(E); if (w && 1 == E.length && (E = E[0], w = !1), e.schema.$ref && o) { if ("fail" == e.opts.extendRefs) throw new Error('$ref: validation keywords used in schema at path "' + e.errSchemaPath + '" (see option extendRefs)'); !0 !== e.opts.extendRefs && (o = !1, e.logger.warn('$ref: keywords ignored in schema at path "' + e.errSchemaPath + '"')) } if (E) { if (e.opts.coerceTypes) var b = e.util.coerceToTypes(e.opts.coerceTypes, E); var S = e.RULES.types[E]; if (b || w || !0 === S || S && !W(S)) { c = e.schemaPath + ".type", d = e.errSchemaPath + "/type", c = e.schemaPath + ".type", d = e.errSchemaPath + "/type"; var T = w ? "checkDataTypes" : "checkDataType"; if (t += " if (" + e.util[T](E, u, !0) + ") { ", b) { var D = "dataType" + n, R = "coerced" + n; t += " var " + D + " = typeof " + u + "; ", "array" == e.opts.coerceTypes && (t += " if (" + D + " == 'object' && Array.isArray(" + u + ")) " + D + " = 'array'; "), t += " var " + R + " = undefined; "; var k = "", j = b; if (j) for (var A, $ = -1, I = j.length - 1; $ < I;)A = j[$ += 1], $ && (t += " if (" + R + " === undefined) { ", k += "}"), "array" == e.opts.coerceTypes && "array" != A && (t += " if (" + D + " == 'array' && " + u + ".length == 1) { " + R + " = " + u + " = " + u + "[0]; " + D + " = typeof " + u + ";  } "), "string" == A ? t += " if (" + D + " == 'number' || " + D + " == 'boolean') " + R + " = '' + " + u + "; else if (" + u + " === null) " + R + " = ''; " : "number" == A || "integer" == A ? (t += " if (" + D + " == 'boolean' || " + u + " === null || (" + D + " == 'string' && " + u + " && " + u + " == +" + u + " ", "integer" == A && (t += " && !(" + u + " % 1)"), t += ")) " + R + " = +" + u + "; ") : "boolean" == A ? t += " if (" + u + " === 'false' || " + u + " === 0 || " + u + " === null) " + R + " = false; else if (" + u + " === 'true' || " + u + " === 1) " + R + " = true; " : "null" == A ? t += " if (" + u + " === '' || " + u + " === 0 || " + u + " === false) " + R + " = null; " : "array" == e.opts.coerceTypes && "array" == A && (t += " if (" + D + " == 'string' || " + D + " == 'number' || " + D + " == 'boolean' || " + u + " == null) " + R + " = [" + u + "]; "); t += " " + k + " if (" + R + " === undefined) {   ", (M = M || []).push(t), t = "", !1 !== e.createErrors ? (t += " { keyword: 'type' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(d) + " , params: { type: '", t += w ? "" + E.join(",") : "" + E, t += "' } ", !1 !== e.opts.messages && (t += " , message: 'should be ", t += w ? "" + E.join(",") : "" + E, t += "' "), e.opts.verbose && (t += " , schema: validate.schema" + c + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), t += " } ") : t += " {} "; m = t; t = M.pop(), !e.compositeRule && f ? e.async ? t += " throw new ValidationError([" + m + "]); " : t += " validate.errors = [" + m + "]; return false; " : t += " var err = " + m + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " } else {  "; var L = h ? "data" + (h - 1 || "") : "parentData"; t += " " + u + " = " + R + "; ", h || (t += "if (" + L + " !== undefined)"), t += " " + L + "[" + (h ? e.dataPathArr[h] : "parentDataProperty") + "] = " + R + "; } " } else { (M = M || []).push(t), t = "", !1 !== e.createErrors ? (t += " { keyword: 'type' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(d) + " , params: { type: '", t += w ? "" + E.join(",") : "" + E, t += "' } ", !1 !== e.opts.messages && (t += " , message: 'should be ", t += w ? "" + E.join(",") : "" + E, t += "' "), e.opts.verbose && (t += " , schema: validate.schema" + c + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), t += " } ") : t += " {} "; m = t; t = M.pop(), !e.compositeRule && f ? e.async ? t += " throw new ValidationError([" + m + "]); " : t += " validate.errors = [" + m + "]; return false; " : t += " var err = " + m + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; " } t += " } " } } if (e.schema.$ref && !o) t += " " + e.RULES.all.$ref.code(e, "$ref") + " ", f && (t += " } if (errors === ", t += y ? "0" : "errs_" + n, t += ") { ", g += "}"); else { e.opts.v5 && e.schema.patternGroups && e.logger.warn('keyword "patternGroups" is deprecated and disabled. Use option patternGroups: true to enable.'); var U = e.RULES; if (U) for (var _ = -1, x = U.length - 1; _ < x;)if (W(S = U[_ += 1])) { if (S.type && (t += " if (" + e.util.checkDataType(S.type, u) + ") { "), e.opts.useDefaults && !e.compositeRule) if ("object" == S.type && e.schema.properties) { p = e.schema.properties; var C = Object.keys(p); if (C) for (var V, Q = -1, G = C.length - 1; Q < G;) { if (void 0 !== (J = p[V = C[Q += 1]]).default) t += "  if (" + (H = u + e.util.getProperty(V)) + " === undefined) " + H + " = ", "shared" == e.opts.useDefaults ? t += " " + e.useDefault(J.default) + " " : t += " " + JSON.stringify(J.default) + " ", t += "; " } } else if ("array" == S.type && Array.isArray(e.schema.items)) { var O = e.schema.items; if (O) { $ = -1; for (var J, N = O.length - 1; $ < N;) { var H; if (void 0 !== (J = O[$ += 1]).default) t += "  if (" + (H = u + "[" + $ + "]") + " === undefined) " + H + " = ", "shared" == e.opts.useDefaults ? t += " " + e.useDefault(J.default) + " " : t += " " + JSON.stringify(J.default) + " ", t += "; " } } } var q = S.rules; if (q) for (var z, B = -1, F = q.length - 1; B < F;)if (X(z = q[B += 1])) { var K = z.code(e, z.keyword, S.type); K && (t += " " + K + " ", f && (P += "}")) } if (f && (t += " " + P + " ", P = ""), S.type && (t += " } ", E && E === S.type && !b)) { t += " else { "; var M; c = e.schemaPath + ".type", d = e.errSchemaPath + "/type"; (M = M || []).push(t), t = "", !1 !== e.createErrors ? (t += " { keyword: 'type' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(d) + " , params: { type: '", t += w ? "" + E.join(",") : "" + E, t += "' } ", !1 !== e.opts.messages && (t += " , message: 'should be ", t += w ? "" + E.join(",") : "" + E, t += "' "), e.opts.verbose && (t += " , schema: validate.schema" + c + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), t += " } ") : t += " {} "; m = t; t = M.pop(), !e.compositeRule && f ? e.async ? t += " throw new ValidationError([" + m + "]); " : t += " validate.errors = [" + m + "]; return false; " : t += " var err = " + m + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " } " } f && (t += " if (errors === ", t += y ? "0" : "errs_" + n, t += ") { ", g += "}") } } function W(e) { for (var r = e.rules, a = 0; a < r.length; a++)if (X(r[a])) return !0 } function X(r) { return void 0 !== e.schema[r.keyword] || r.implements && function (r) { for (var a = r.implements, t = 0; t < a.length; t++)if (void 0 !== e.schema[a[t]]) return !0 }(r) } return f && (t += " " + g + " "), y ? (s ? (t += " if (errors === 0) return data;           ", t += " else throw new ValidationError(vErrors); ") : (t += " validate.errors = vErrors; ", t += " return errors === 0;       "), t += " }); return validate;") : t += " var " + v + " = errors === errs_" + n + ";", t = e.util.cleanUpCode(t), y && (t = e.util.finalCleanUpCode(t, s)), t };
    }, {}], "z7cn": [function (require, module, exports) {
        var n = Array.prototype.slice; function t(t) { var e = this, o = n.call(arguments, 1); return new Promise(function (n, u) { if ("function" == typeof t && (t = t.apply(e, o)), !t || "function" != typeof t.next) return n(t); function i(n) { var r; try { r = t.next(n) } catch (e) { return u(e) } f(r) } function a(n) { var r; try { r = t.throw(n) } catch (e) { return u(e) } f(r) } function f(t) { if (t.done) return n(t.value); var o = r.call(e, t.value); return o && c(o) ? o.then(i, a) : a(new TypeError('You may only yield a function, promise, generator, array, or object, but the following object was passed: "' + String(t.value) + '"')) } i() }) } function r(n) { return n ? c(n) ? n : a(n) || i(n) ? t.call(this, n) : "function" == typeof n ? e.call(this, n) : Array.isArray(n) ? o.call(this, n) : f(n) ? u.call(this, n) : n : n } function e(t) { var r = this; return new Promise(function (e, o) { t.call(r, function (t, r) { if (t) return o(t); arguments.length > 2 && (r = n.call(arguments, 1)), e(r) }) }) } function o(n) { return Promise.all(n.map(r, this)) } function u(n) { for (var t = new n.constructor, e = Object.keys(n), o = [], u = 0; u < e.length; u++) { var i = e[u], a = r.call(this, n[i]); a && c(a) ? f(a, i) : t[i] = n[i] } return Promise.all(o).then(function () { return t }); function f(n, r) { t[r] = void 0, o.push(n.then(function (n) { t[r] = n })) } } function c(n) { return "function" == typeof n.then } function i(n) { return "function" == typeof n.next && "function" == typeof n.throw } function a(n) { var t = n.constructor; return !!t && ("GeneratorFunction" === t.name || "GeneratorFunction" === t.displayName || i(t.prototype)) } function f(n) { return Object == n.constructor } module.exports = t.default = t.co = t, t.wrap = function (n) { return r.__generatorFunction__ = n, r; function r() { return t.call(this, n.apply(this, arguments)) } };
    }, {}], "IFqB": [function (require, module, exports) {
        "use strict"; var e = require("./resolve"), r = require("./util"), t = require("./error_classes"), i = require("fast-json-stable-stringify"), o = require("../dotjs/validate"), a = require("co"), n = r.ucs2length, l = require("fast-deep-equal"), s = t.Validation; function c(d, y, R, V) { var w = this, S = this._opts, _ = [void 0], b = {}, q = [], E = {}, x = [], $ = {}, C = []; y = y || { schema: d, refVal: _, refs: b }; var j = u.call(this, d, y, V), k = this._compilations[j.index]; if (j.compiling) return k.callValidate = function e() { var r = k.validate; var t = r.apply(null, arguments); e.errors = r.errors; return t }; var P = this._formats, I = this.RULES; try { var L = M(d, y, R, V); k.validate = L; var U = k.callValidate; return U && (U.schema = L.schema, U.errors = null, U.refs = L.refs, U.refVal = L.refVal, U.root = L.root, U.$async = L.$async, S.sourceCode && (U.source = L.source)), L } finally { f.call(this, d, y, V) } function M(i, u, f, d) { var R = !u || u && u.schema == i; if (u.schema != y.schema) return c.call(w, i, u, f, d); var V, E = !0 === i.$async, $ = o({ isTop: !0, schema: i, isRoot: R, baseId: d, root: u, schemaPath: "", errSchemaPath: "#", errorPath: '""', MissingRefError: t.MissingRef, RULES: I, validate: o, util: r, resolve: e, resolveRef: Q, usePattern: F, useDefault: z, useCustomRule: A, opts: S, formats: P, logger: w.logger, self: w }); $ = g(_, m) + g(q, v) + g(x, h) + g(C, p) + $, S.processCode && ($ = S.processCode($)); try { V = new Function("self", "RULES", "formats", "root", "refVal", "defaults", "customRules", "co", "equal", "ucs2length", "ValidationError", $)(w, I, P, y, _, x, C, a, l, n, s), _[0] = V } catch (j) { throw w.logger.error("Error compiling schema, function code:", $), j } return V.schema = i, V.errors = null, V.refs = b, V.refVal = _, V.root = R ? V : u, E && (V.$async = !0), !0 === S.sourceCode && (V.source = { code: $, patterns: q, defaults: x }), V } function Q(r, t, i) { t = e.url(r, t); var o, a, n = b[t]; if (void 0 !== n) return D(o = _[n], a = "refVal[" + n + "]"); if (!i && y.refs) { var l = y.refs[t]; if (void 0 !== l) return D(o = y.refVal[l], a = T(t, o)) } a = T(t); var s = e.call(w, M, y, t); if (void 0 === s) { var u = R && R[t]; u && (s = e.inlineRef(u, S.inlineRefs) ? u : c.call(w, u, y, R, r)) } if (void 0 !== s) return function (e, r) { var t = b[e]; _[t] = r }(t, s), D(s, a); !function (e) { delete b[e] }(t) } function T(e, r) { var t = _.length; return _[t] = r, b[e] = t, "refVal" + t } function D(e, r) { return "object" == typeof e || "boolean" == typeof e ? { code: r, schema: e, inline: !0 } : { code: r, $async: e && e.$async } } function F(e) { var r = E[e]; return void 0 === r && (r = E[e] = q.length, q[r] = e), "pattern" + r } function z(e) { switch (typeof e) { case "boolean": case "number": return "" + e; case "string": return r.toQuotedString(e); case "object": if (null === e) return "null"; var t = i(e), o = $[t]; return void 0 === o && (o = $[t] = x.length, x[o] = e), "default" + o } } function A(e, r, t, i) { var o = e.definition.validateSchema; if (o && !1 !== w._opts.validateSchema && !o(r)) { var a = "keyword schema is invalid: " + w.errorsText(o.errors); if ("log" != w._opts.validateSchema) throw new Error(a); w.logger.error(a) } var n, l = e.definition.compile, s = e.definition.inline, c = e.definition.macro; if (l) n = l.call(w, r, t, i); else if (c) n = c.call(w, r, t, i), !1 !== S.validateSchema && w.validateSchema(n, !0); else if (s) n = s.call(w, i, e.keyword, r, t); else if (!(n = e.definition.validate)) return; if (void 0 === n) throw new Error('custom keyword "' + e.keyword + '"failed to compile'); var u = C.length; return C[u] = n, { code: "customRule" + u, validate: n } } } function u(e, r, t) { var i = d.call(this, e, r, t); return i >= 0 ? { index: i, compiling: !0 } : (i = this._compilations.length, this._compilations[i] = { schema: e, root: r, baseId: t }, { index: i, compiling: !1 }) } function f(e, r, t) { var i = d.call(this, e, r, t); i >= 0 && this._compilations.splice(i, 1) } function d(e, r, t) { for (var i = 0; i < this._compilations.length; i++) { var o = this._compilations[i]; if (o.schema == e && o.root == r && o.baseId == t) return i } return -1 } function v(e, t) { return "var pattern" + e + " = new RegExp(" + r.toQuotedString(t[e]) + ");" } function h(e) { return "var default" + e + " = defaults[" + e + "];" } function m(e, r) { return void 0 === r[e] ? "" : "var refVal" + e + " = refVal[" + e + "];" } function p(e) { return "var customRule" + e + " = customRules[" + e + "];" } function g(e, r) { if (!e.length) return ""; for (var t = "", i = 0; i < e.length; i++)t += r(i, e); return t } module.exports = c;
    }, { "./resolve": "FmMj", "./util": "S6qf", "./error_classes": "yAtQ", "fast-json-stable-stringify": "3Xb3", "../dotjs/validate": "XNwE", "co": "z7cn", "fast-deep-equal": "jIGR" }], "wSe+": [function (require, module, exports) {
        "use strict"; var t = module.exports = function () { this._cache = {} }; t.prototype.put = function (t, e) { this._cache[t] = e }, t.prototype.get = function (t) { return this._cache[t] }, t.prototype.del = function (t) { delete this._cache[t] }, t.prototype.clear = function () { this._cache = {} };
    }, {}], "SmGS": [function (require, module, exports) {
        "use strict"; var d = require("./util"), a = /^\d\d\d\d-(\d\d)-(\d\d)$/, u = [0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31], F = /^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i, f = /^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i, D = /^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i, t = /^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i, e = /^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#.\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i, z = /^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i, r = /^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i, i = /^(?:\/(?:[^~\/]|~0|~1)*)*$|^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i, $ = /^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~\/]|~0|~1)*)*)$/; function n(a) { return a = "full" == a ? "full" : "fast", d.copy(n[a]) } function x(d) { var F = d.match(a); if (!F) return !1; var f = +F[1], D = +F[2]; return f >= 1 && f <= 12 && D >= 1 && D <= u[f] } function _(d, a) { var u = d.match(F); if (!u) return !1; var f = u[1], D = u[2], t = u[3], e = u[5]; return f <= 23 && D <= 59 && t <= 59 && (!a || e) } module.exports = n, n.fast = { date: /^\d\d\d\d-[0-1]\d-[0-3]\d$/, time: /^[0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i, "date-time": /^\d\d\d\d-[0-1]\d-[0-3]\d[t\s][0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i, uri: /^(?:[a-z][a-z0-9+-.]*)(?::|\/)\/?[^\s]*$/i, "uri-reference": /^(?:(?:[a-z][a-z0-9+-.]*:)?\/\/)?[^\s]*$/i, "uri-template": e, url: z, email: /^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i, hostname: f, ipv4: /^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/, ipv6: /^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i, regex: v, uuid: r, "json-pointer": i, "relative-json-pointer": $ }, n.full = { date: x, time: _, "date-time": E, uri: l, "uri-reference": t, "uri-template": e, url: z, email: /^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&''*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i, hostname: B, ipv4: /^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/, ipv6: /^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i, regex: v, uuid: r, "json-pointer": i, "relative-json-pointer": $ }; var s = /t|\s/i; function E(d) { var a = d.split(s); return 2 == a.length && x(a[0]) && _(a[1], !0) } function B(d) { return d.length <= 255 && f.test(d) } var o = /\/|:/; function l(d) { return o.test(d) && D.test(d) } var C = /[^\\]\\Z/; function v(d) { if (C.test(d)) return !1; try { return new RegExp(d), !0 } catch (a) { return !1 } }
    }, { "./util": "S6qf" }], "xcTN": [function (require, module, exports) {
        "use strict"; module.exports = function (r, e, a) { var s, t, o = " ", i = r.level, l = r.dataLevel, c = r.schema[e], n = r.errSchemaPath + "/" + e, h = !r.opts.allErrors, v = "data" + (l || ""), f = "valid" + i; if ("#" == c || "#/" == c) r.isRoot ? (s = r.async, t = "validate") : (s = !0 === r.root.schema.$async, t = "root.refVal[0]"); else { var d = r.resolveRef(r.baseId, c, r.isRoot); if (void 0 === d) { var p = r.MissingRefError.message(r.baseId, c); if ("fail" == r.opts.missingRefs) { r.logger.error(p), (g = g || []).push(o), o = "", !1 !== r.createErrors ? (o += " { keyword: '$ref' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(n) + " , params: { ref: '" + r.util.escapeQuotes(c) + "' } ", !1 !== r.opts.messages && (o += " , message: 'can\\'t resolve reference " + r.util.escapeQuotes(c) + "' "), r.opts.verbose && (o += " , schema: " + r.util.toQuotedString(c) + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + v + " "), o += " } ") : o += " {} "; var m = o; o = g.pop(), !r.compositeRule && h ? r.async ? o += " throw new ValidationError([" + m + "]); " : o += " validate.errors = [" + m + "]; return false; " : o += " var err = " + m + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", h && (o += " if (false) { ") } else { if ("ignore" != r.opts.missingRefs) throw new r.MissingRefError(r.baseId, c, p); r.logger.warn(p), h && (o += " if (true) { ") } } else if (d.inline) { var u = r.util.copy(r); u.level++; var E = "valid" + u.level; u.schema = d.schema, u.schemaPath = "", u.errSchemaPath = c, o += " " + r.validate(u).replace(/validate\.schema/g, d.code) + " ", h && (o += " if (" + E + ") { ") } else s = !0 === d.$async, t = d.code } if (t) { var g; (g = g || []).push(o), o = "", r.opts.passContext ? o += " " + t + ".call(this, " : o += " " + t + "( ", o += " " + v + ", (dataPath || '')", '""' != r.errorPath && (o += " + " + r.errorPath); var y = o += " , " + (l ? "data" + (l - 1 || "") : "parentData") + " , " + (l ? r.dataPathArr[l] : "parentDataProperty") + ", rootData)  "; if (o = g.pop(), s) { if (!r.async) throw new Error("async schema referenced by sync schema"); h && (o += " var " + f + "; "), o += " try { " + r.yieldAwait + " " + y + "; ", h && (o += " " + f + " = true; "), o += " } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ", h && (o += " " + f + " = false; "), o += " } ", h && (o += " if (" + f + ") { ") } else o += " if (!" + y + ") { if (vErrors === null) vErrors = " + t + ".errors; else vErrors = vErrors.concat(" + t + ".errors); errors = vErrors.length; } ", h && (o += " else { ") } return o };
    }, {}], "jiJK": [function (require, module, exports) {
        "use strict"; module.exports = function (e, a, l) { var t = " ", r = e.schema[a], s = e.schemaPath + e.util.getProperty(a), c = e.errSchemaPath + "/" + a, h = !e.opts.allErrors, i = e.util.copy(e), u = ""; i.level++; var o = "valid" + i.level, m = i.baseId, v = !0, d = r; if (d) for (var f, n = -1, p = d.length - 1; n < p;)f = d[n += 1], e.util.schemaHasRules(f, e.RULES.all) && (v = !1, i.schema = f, i.schemaPath = s + "[" + n + "]", i.errSchemaPath = c + "/" + n, t += "  " + e.validate(i) + " ", i.baseId = m, h && (t += " if (" + o + ") { ", u += "}")); return h && (t += v ? " if (true) { " : " " + u.slice(0, -1) + " "), t = e.util.cleanUpCode(t) };
    }, {}], "Pnof": [function (require, module, exports) {
        "use strict"; module.exports = function (r, e, a) { var s = " ", t = r.level, l = r.dataLevel, o = r.schema[e], i = r.schemaPath + r.util.getProperty(e), h = r.errSchemaPath + "/" + e, v = !r.opts.allErrors, c = "data" + (l || ""), m = "valid" + t, u = "errs__" + t, n = r.util.copy(r), d = ""; n.level++; var p = "valid" + n.level; if (o.every(function (e) { return r.util.schemaHasRules(e, r.RULES.all) })) { var f = n.baseId; s += " var " + u + " = errors; var " + m + " = false;  "; var E = r.compositeRule; r.compositeRule = n.compositeRule = !0; var P = o; if (P) for (var R, y = -1, g = P.length - 1; y < g;)R = P[y += 1], n.schema = R, n.schemaPath = i + "[" + y + "]", n.errSchemaPath = h + "/" + y, s += "  " + r.validate(n) + " ", n.baseId = f, s += " " + m + " = " + m + " || " + p + "; if (!" + m + ") { ", d += "}"; r.compositeRule = n.compositeRule = E, s += " " + d + " if (!" + m + ") {   var err =   ", !1 !== r.createErrors ? (s += " { keyword: 'anyOf' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(h) + " , params: {} ", !1 !== r.opts.messages && (s += " , message: 'should match some schema in anyOf' "), r.opts.verbose && (s += " , schema: validate.schema" + i + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + c + " "), s += " } ") : s += " {} ", s += ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", !r.compositeRule && v && (r.async ? s += " throw new ValidationError(vErrors); " : s += " validate.errors = vErrors; return false; "), s += " } else {  errors = " + u + "; if (vErrors !== null) { if (" + u + ") vErrors.length = " + u + "; else vErrors = null; } ", r.opts.allErrors && (s += " } "), s = r.util.cleanUpCode(s) } else v && (s += " if (true) { "); return s };
    }, {}], "z0a6": [function (require, module, exports) {
        "use strict"; module.exports = function (a, r, e) { var t = " ", s = a.level, o = a.dataLevel, h = a.schema[r], l = a.schemaPath + a.util.getProperty(r), c = a.errSchemaPath + "/" + r, d = !a.opts.allErrors, m = "data" + (o || ""), v = "valid" + s, i = a.opts.$data && h && h.$data; i && (t += " var schema" + s + " = " + a.util.getData(h.$data, o, a.dataPathArr) + "; "), i || (t += " var schema" + s + " = validate.schema" + l + ";"), t += "var " + v + " = equal(" + m + ", schema" + s + "); if (!" + v + ") {   "; var u = u || []; u.push(t), t = "", !1 !== a.createErrors ? (t += " { keyword: 'const' , dataPath: (dataPath || '') + " + a.errorPath + " , schemaPath: " + a.util.toQuotedString(c) + " , params: {} ", !1 !== a.opts.messages && (t += " , message: 'should be equal to constant' "), a.opts.verbose && (t += " , schema: validate.schema" + l + " , parentSchema: validate.schema" + a.schemaPath + " , data: " + m + " "), t += " } ") : t += " {} "; var n = t; return t = u.pop(), !a.compositeRule && d ? a.async ? t += " throw new ValidationError([" + n + "]); " : t += " validate.errors = [" + n + "]; return false; " : t += " var err = " + n + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " }", d && (t += " else { "), t };
    }, {}], "0IaH": [function (require, module, exports) {
        "use strict"; module.exports = function (r, e, a) { var t = " ", s = r.level, l = r.dataLevel, o = r.schema[e], i = r.schemaPath + r.util.getProperty(e), v = r.errSchemaPath + "/" + e, h = !r.opts.allErrors, c = "data" + (l || ""), u = "valid" + s, d = "errs__" + s, m = r.util.copy(r); m.level++; var n = "valid" + m.level, p = "i" + s, P = m.dataLevel = r.dataLevel + 1, E = "data" + P, f = r.baseId, R = r.util.schemaHasRules(o, r.RULES.all); if (t += "var " + d + " = errors;var " + u + ";", R) { var g = r.compositeRule; r.compositeRule = m.compositeRule = !0, m.schema = o, m.schemaPath = i, m.errSchemaPath = v, t += " var " + n + " = false; for (var " + p + " = 0; " + p + " < " + c + ".length; " + p + "++) { ", m.errorPath = r.util.getPathExpr(r.errorPath, p, r.opts.jsonPointers, !0); var S = c + "[" + p + "]"; m.dataPathArr[P] = p; var b = r.validate(m); m.baseId = f, r.util.varOccurences(b, E) < 2 ? t += " " + r.util.varReplace(b, E, S) + " " : t += " var " + E + " = " + S + "; " + b + " ", t += " if (" + n + ") break; }  ", r.compositeRule = m.compositeRule = g, t += "  if (!" + n + ") {" } else t += " if (" + c + ".length == 0) {"; var y = y || []; y.push(t), t = "", !1 !== r.createErrors ? (t += " { keyword: 'contains' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(v) + " , params: {} ", !1 !== r.opts.messages && (t += " , message: 'should contain a valid item' "), r.opts.verbose && (t += " , schema: validate.schema" + i + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + c + " "), t += " } ") : t += " {} "; var L = t; return t = y.pop(), !r.compositeRule && h ? r.async ? t += " throw new ValidationError([" + L + "]); " : t += " validate.errors = [" + L + "]; return false; " : t += " var err = " + L + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " } else { ", R && (t += "  errors = " + d + "; if (vErrors !== null) { if (" + d + ") vErrors.length = " + d + "; else vErrors = null; } "), r.opts.allErrors && (t += " } "), t = r.util.cleanUpCode(t) };
    }, {}], "BMaw": [function (require, module, exports) {
        "use strict"; module.exports = function (e, r, t) { var a = " ", s = e.level, o = e.dataLevel, i = e.schema[r], p = e.schemaPath + e.util.getProperty(r), l = e.errSchemaPath + "/" + r, u = !e.opts.allErrors, n = "data" + (o || ""), h = "errs__" + s, c = e.util.copy(e), d = ""; c.level++; var v = "valid" + c.level, P = {}, m = {}, g = e.opts.ownProperties; for (E in i) { var y = i[E], f = Array.isArray(y) ? m : P; f[E] = y } a += "var " + h + " = errors;"; var Q = e.errorPath; for (var E in a += "var missing" + s + ";", m) if ((f = m[E]).length) { if (a += " if ( " + n + e.util.getProperty(E) + " !== undefined ", g && (a += " && Object.prototype.hasOwnProperty.call(" + n + ", '" + e.util.escapeQuotes(E) + "') "), u) { a += " && ( "; var j = f; if (j) for (var w = -1, b = j.length - 1; w < b;) { k = j[w += 1], w && (a += " || "), a += " ( ( " + (I = n + (D = e.util.getProperty(k))) + " === undefined ", g && (a += " || ! Object.prototype.hasOwnProperty.call(" + n + ", '" + e.util.escapeQuotes(k) + "') "), a += ") && (missing" + s + " = " + e.util.toQuotedString(e.opts.jsonPointers ? k : D) + ") ) " } a += ")) {  "; var O = "missing" + s, S = "' + " + O + " + '"; e.opts._errorDataPathProperty && (e.errorPath = e.opts.jsonPointers ? e.util.getPathExpr(Q, O, !0) : Q + " + " + O); var _ = _ || []; _.push(a), a = "", !1 !== e.createErrors ? (a += " { keyword: 'dependencies' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(l) + " , params: { property: '" + e.util.escapeQuotes(E) + "', missingProperty: '" + S + "', depsCount: " + f.length + ", deps: '" + e.util.escapeQuotes(1 == f.length ? f[0] : f.join(", ")) + "' } ", !1 !== e.opts.messages && (a += " , message: 'should have ", 1 == f.length ? a += "property " + e.util.escapeQuotes(f[0]) : a += "properties " + e.util.escapeQuotes(f.join(", ")), a += " when property " + e.util.escapeQuotes(E) + " is present' "), e.opts.verbose && (a += " , schema: validate.schema" + p + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + n + " "), a += " } ") : a += " {} "; var C = a; a = _.pop(), !e.compositeRule && u ? e.async ? a += " throw new ValidationError([" + C + "]); " : a += " validate.errors = [" + C + "]; return false; " : a += " var err = " + C + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; " } else { a += " ) { "; var R = f; if (R) for (var k, x = -1, A = R.length - 1; x < A;) { k = R[x += 1]; var D = e.util.getProperty(k), I = (S = e.util.escapeQuotes(k), n + D); e.opts._errorDataPathProperty && (e.errorPath = e.util.getPath(Q, k, e.opts.jsonPointers)), a += " if ( " + I + " === undefined ", g && (a += " || ! Object.prototype.hasOwnProperty.call(" + n + ", '" + e.util.escapeQuotes(k) + "') "), a += ") {  var err =   ", !1 !== e.createErrors ? (a += " { keyword: 'dependencies' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(l) + " , params: { property: '" + e.util.escapeQuotes(E) + "', missingProperty: '" + S + "', depsCount: " + f.length + ", deps: '" + e.util.escapeQuotes(1 == f.length ? f[0] : f.join(", ")) + "' } ", !1 !== e.opts.messages && (a += " , message: 'should have ", 1 == f.length ? a += "property " + e.util.escapeQuotes(f[0]) : a += "properties " + e.util.escapeQuotes(f.join(", ")), a += " when property " + e.util.escapeQuotes(E) + " is present' "), e.opts.verbose && (a += " , schema: validate.schema" + p + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + n + " "), a += " } ") : a += " {} ", a += ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } " } } a += " }   ", u && (d += "}", a += " else { ") } e.errorPath = Q; var L = c.baseId; for (var E in P) { y = P[E]; e.util.schemaHasRules(y, e.RULES.all) && (a += " " + v + " = true; if ( " + n + e.util.getProperty(E) + " !== undefined ", g && (a += " && Object.prototype.hasOwnProperty.call(" + n + ", '" + e.util.escapeQuotes(E) + "') "), a += ") { ", c.schema = y, c.schemaPath = p + e.util.getProperty(E), c.errSchemaPath = l + "/" + e.util.escapeFragment(E), a += "  " + e.validate(c) + " ", c.baseId = L, a += " }  ", u && (a += " if (" + v + ") { ", d += "}")) } return u && (a += "   " + d + " if (" + h + " == errors) {"), a = e.util.cleanUpCode(a) };
    }, {}], "mbmc": [function (require, module, exports) {
        "use strict"; module.exports = function (a, e, r) { var t = " ", s = a.level, l = a.dataLevel, o = a.schema[e], h = a.schemaPath + a.util.getProperty(e), d = a.errSchemaPath + "/" + e, i = !a.opts.allErrors, u = "data" + (l || ""), m = "valid" + s, v = a.opts.$data && o && o.$data; v && (t += " var schema" + s + " = " + a.util.getData(o.$data, l, a.dataPathArr) + "; "); var c = "i" + s, n = "schema" + s; v || (t += " var " + n + " = validate.schema" + h + ";"), t += "var " + m + ";", v && (t += " if (schema" + s + " === undefined) " + m + " = true; else if (!Array.isArray(schema" + s + ")) " + m + " = false; else {"), t += m + " = false;for (var " + c + "=0; " + c + "<" + n + ".length; " + c + "++) if (equal(" + u + ", " + n + "[" + c + "])) { " + m + " = true; break; }", v && (t += "  }  "), t += " if (!" + m + ") {   "; var p = p || []; p.push(t), t = "", !1 !== a.createErrors ? (t += " { keyword: 'enum' , dataPath: (dataPath || '') + " + a.errorPath + " , schemaPath: " + a.util.toQuotedString(d) + " , params: { allowedValues: schema" + s + " } ", !1 !== a.opts.messages && (t += " , message: 'should be equal to one of the allowed values' "), a.opts.verbose && (t += " , schema: validate.schema" + h + " , parentSchema: validate.schema" + a.schemaPath + " , data: " + u + " "), t += " } ") : t += " {} "; var f = t; return t = p.pop(), !a.compositeRule && i ? a.async ? t += " throw new ValidationError([" + f + "]); " : t += " validate.errors = [" + f + "]; return false; " : t += " var err = " + f + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " }", i && (t += " else { "), t };
    }, {}], "Bkge": [function (require, module, exports) {
        "use strict"; module.exports = function (a, t, r) { var e = " ", o = a.level, s = a.dataLevel, i = a.schema[t], n = a.schemaPath + a.util.getProperty(t), f = a.errSchemaPath + "/" + t, c = !a.opts.allErrors, u = "data" + (s || ""); if (!1 === a.opts.format) return c && (e += " if (true) { "), e; var l, m = a.opts.$data && i && i.$data; m ? (e += " var schema" + o + " = " + a.util.getData(i.$data, s, a.dataPathArr) + "; ", l = "schema" + o) : l = i; var h = a.opts.unknownFormats, d = Array.isArray(h); if (m) { e += " var " + (p = "format" + o) + " = formats[" + l + "]; var " + (v = "isObject" + o) + " = typeof " + p + " == 'object' && !(" + p + " instanceof RegExp) && " + p + ".validate; var " + (y = "formatType" + o) + " = " + v + " && " + p + ".type || 'string'; if (" + v + ") { ", a.async && (e += " var async" + o + " = " + p + ".async; "), e += " " + p + " = " + p + ".validate; } if (  ", m && (e += " (" + l + " !== undefined && typeof " + l + " != 'string') || "), e += " (", "ignore" != h && (e += " (" + l + " && !" + p + " ", d && (e += " && self._opts.unknownFormats.indexOf(" + l + ") == -1 "), e += ") || "), e += " (" + p + " && " + y + " == '" + r + "' && !(typeof " + p + " == 'function' ? ", a.async ? e += " (async" + o + " ? " + a.yieldAwait + " " + p + "(" + u + ") : " + p + "(" + u + ")) " : e += " " + p + "(" + u + ") ", e += " : " + p + ".test(" + u + "))))) {" } else { var p; if (!(p = a.formats[i])) { if ("ignore" == h) return a.logger.warn('unknown format "' + i + '" ignored in schema at path "' + a.errSchemaPath + '"'), c && (e += " if (true) { "), e; if (d && h.indexOf(i) >= 0) return c && (e += " if (true) { "), e; throw new Error('unknown format "' + i + '" is used in schema at path "' + a.errSchemaPath + '"') } var v, y = (v = "object" == typeof p && !(p instanceof RegExp) && p.validate) && p.type || "string"; if (v) { var g = !0 === p.async; p = p.validate } if (y != r) return c && (e += " if (true) { "), e; if (g) { if (!a.async) throw new Error("async format in sync schema"); var w = "formats" + a.util.getProperty(i) + ".validate"; e += " if (!(" + a.yieldAwait + " " + w + "(" + u + "))) { " } else { e += " if (! "; w = "formats" + a.util.getProperty(i); v && (w += ".validate"), e += "function" == typeof p ? " " + w + "(" + u + ") " : " " + w + ".test(" + u + ") ", e += ") { " } } var P = P || []; P.push(e), e = "", !1 !== a.createErrors ? (e += " { keyword: 'format' , dataPath: (dataPath || '') + " + a.errorPath + " , schemaPath: " + a.util.toQuotedString(f) + " , params: { format:  ", e += m ? "" + l : "" + a.util.toQuotedString(i), e += "  } ", !1 !== a.opts.messages && (e += " , message: 'should match format \"", e += m ? "' + " + l + " + '" : "" + a.util.escapeQuotes(i), e += "\"' "), a.opts.verbose && (e += " , schema:  ", e += m ? "validate.schema" + n : "" + a.util.toQuotedString(i), e += "         , parentSchema: validate.schema" + a.schemaPath + " , data: " + u + " "), e += " } ") : e += " {} "; var E = e; return e = P.pop(), !a.compositeRule && c ? a.async ? e += " throw new ValidationError([" + E + "]); " : e += " validate.errors = [" + E + "]; return false; " : e += " var err = " + E + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", e += " } ", c && (e += " else { "), e };
    }, {}], "veNu": [function (require, module, exports) {
        "use strict"; module.exports = function (a, e, r) { var t = " ", s = a.level, l = a.dataLevel, h = a.schema[e], i = a.schemaPath + a.util.getProperty(e), o = a.errSchemaPath + "/" + e, c = !a.opts.allErrors, v = "data" + (l || ""), d = "valid" + s, m = "errs__" + s, n = a.util.copy(a), u = ""; n.level++; var P = "valid" + n.level, p = "i" + s, f = n.dataLevel = a.dataLevel + 1, g = "data" + f, E = a.baseId; if (t += "var " + m + " = errors;var " + d + ";", Array.isArray(h)) { var S = a.schema.additionalItems; if (!1 === S) { t += " " + d + " = " + v + ".length <= " + h.length + "; "; var R = o; o = a.errSchemaPath + "/additionalItems", t += "  if (!" + d + ") {   "; var I = I || []; I.push(t), t = "", !1 !== a.createErrors ? (t += " { keyword: 'additionalItems' , dataPath: (dataPath || '') + " + a.errorPath + " , schemaPath: " + a.util.toQuotedString(o) + " , params: { limit: " + h.length + " } ", !1 !== a.opts.messages && (t += " , message: 'should NOT have more than " + h.length + " items' "), a.opts.verbose && (t += " , schema: false , parentSchema: validate.schema" + a.schemaPath + " , data: " + v + " "), t += " } ") : t += " {} "; var b = t; t = I.pop(), !a.compositeRule && c ? a.async ? t += " throw new ValidationError([" + b + "]); " : t += " validate.errors = [" + b + "]; return false; " : t += " var err = " + b + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " } ", o = R, c && (u += "}", t += " else { ") } var y = h; if (y) for (var L, A = -1, j = y.length - 1; A < j;)if (L = y[A += 1], a.util.schemaHasRules(L, a.RULES.all)) { t += " " + P + " = true; if (" + v + ".length > " + A + ") { "; var x = v + "[" + A + "]"; n.schema = L, n.schemaPath = i + "[" + A + "]", n.errSchemaPath = o + "/" + A, n.errorPath = a.util.getPathExpr(a.errorPath, A, a.opts.jsonPointers, !0), n.dataPathArr[f] = A; var O = a.validate(n); n.baseId = E, a.util.varOccurences(O, g) < 2 ? t += " " + a.util.varReplace(O, g, x) + " " : t += " var " + g + " = " + x + "; " + O + " ", t += " }  ", c && (t += " if (" + P + ") { ", u += "}") } if ("object" == typeof S && a.util.schemaHasRules(S, a.RULES.all)) { n.schema = S, n.schemaPath = a.schemaPath + ".additionalItems", n.errSchemaPath = a.errSchemaPath + "/additionalItems", t += " " + P + " = true; if (" + v + ".length > " + h.length + ") {  for (var " + p + " = " + h.length + "; " + p + " < " + v + ".length; " + p + "++) { ", n.errorPath = a.util.getPathExpr(a.errorPath, p, a.opts.jsonPointers, !0); x = v + "[" + p + "]"; n.dataPathArr[f] = p; O = a.validate(n); n.baseId = E, a.util.varOccurences(O, g) < 2 ? t += " " + a.util.varReplace(O, g, x) + " " : t += " var " + g + " = " + x + "; " + O + " ", c && (t += " if (!" + P + ") break; "), t += " } }  ", c && (t += " if (" + P + ") { ", u += "}") } } else if (a.util.schemaHasRules(h, a.RULES.all)) { n.schema = h, n.schemaPath = i, n.errSchemaPath = o, t += "  for (var " + p + " = 0; " + p + " < " + v + ".length; " + p + "++) { ", n.errorPath = a.util.getPathExpr(a.errorPath, p, a.opts.jsonPointers, !0); x = v + "[" + p + "]"; n.dataPathArr[f] = p; O = a.validate(n); n.baseId = E, a.util.varOccurences(O, g) < 2 ? t += " " + a.util.varReplace(O, g, x) + " " : t += " var " + g + " = " + x + "; " + O + " ", c && (t += " if (!" + P + ") break; "), t += " }" } return c && (t += " " + u + " if (" + m + " == errors) {"), t = a.util.cleanUpCode(t) };
    }, {}], "QYf9": [function (require, module, exports) {
        "use strict"; module.exports = function (e, a, r) { var t, s = " ", o = e.level, i = e.dataLevel, m = e.schema[a], l = e.schemaPath + e.util.getProperty(a), h = e.errSchemaPath + "/" + a, d = !e.opts.allErrors, u = "data" + (i || ""), c = e.opts.$data && m && m.$data; c ? (s += " var schema" + o + " = " + e.util.getData(m.$data, i, e.dataPathArr) + "; ", t = "schema" + o) : t = m; var n = "maximum" == a, v = n ? "exclusiveMaximum" : "exclusiveMinimum", p = e.schema[v], f = n ? "<" : ">", P = n ? ">" : "<", b = void 0; if (e.opts.$data && p && p.$data) { var x = e.util.getData(p.$data, i, e.dataPathArr), E = "exclusive" + o, y = "exclType" + o, g = "exclIsNumber" + o, S = "' + " + (M = "op" + o) + " + '"; s += " var schemaExcl" + o + " = " + x + "; ", s += " var " + E + "; var " + y + " = typeof " + (x = "schemaExcl" + o) + "; if (" + y + " != 'boolean' && " + y + " != 'undefined' && " + y + " != 'number') { "; var w; b = v; (w = w || []).push(s), s = "", !1 !== e.createErrors ? (s += " { keyword: '" + (b || "_exclusiveLimit") + "' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(h) + " , params: {} ", !1 !== e.opts.messages && (s += " , message: '" + v + " should be boolean' "), e.opts.verbose && (s += " , schema: validate.schema" + l + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), s += " } ") : s += " {} "; var $ = s; s = w.pop(), !e.compositeRule && d ? e.async ? s += " throw new ValidationError([" + $ + "]); " : s += " validate.errors = [" + $ + "]; return false; " : s += " var err = " + $ + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", s += " } else if ( ", c && (s += " (" + t + " !== undefined && typeof " + t + " != 'number') || "), s += " " + y + " == 'number' ? ( (" + E + " = " + t + " === undefined || " + x + " " + f + "= " + t + ") ? " + u + " " + P + "= " + x + " : " + u + " " + P + " " + t + " ) : ( (" + E + " = " + x + " === true) ? " + u + " " + P + "= " + t + " : " + u + " " + P + " " + t + " ) || " + u + " !== " + u + ") { var op" + o + " = " + E + " ? '" + f + "' : '" + f + "=';" } else { S = f; if ((g = "number" == typeof p) && c) { var M = "'" + S + "'"; s += " if ( ", c && (s += " (" + t + " !== undefined && typeof " + t + " != 'number') || "), s += " ( " + t + " === undefined || " + p + " " + f + "= " + t + " ? " + u + " " + P + "= " + p + " : " + u + " " + P + " " + t + " ) || " + u + " !== " + u + ") { " } else { g && void 0 === m ? (E = !0, b = v, h = e.errSchemaPath + "/" + v, t = p, P += "=") : (g && (t = Math[n ? "min" : "max"](p, m)), p === (!g || t) ? (E = !0, b = v, h = e.errSchemaPath + "/" + v, P += "=") : (E = !1, S += "=")); M = "'" + S + "'"; s += " if ( ", c && (s += " (" + t + " !== undefined && typeof " + t + " != 'number') || "), s += " " + u + " " + P + " " + t + " || " + u + " !== " + u + ") { " } } b = b || a, (w = w || []).push(s), s = "", !1 !== e.createErrors ? (s += " { keyword: '" + (b || "_limit") + "' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(h) + " , params: { comparison: " + M + ", limit: " + t + ", exclusive: " + E + " } ", !1 !== e.opts.messages && (s += " , message: 'should be " + S + " ", s += c ? "' + " + t : t + "'"), e.opts.verbose && (s += " , schema:  ", s += c ? "validate.schema" + l : "" + m, s += "         , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), s += " } ") : s += " {} "; $ = s; return s = w.pop(), !e.compositeRule && d ? e.async ? s += " throw new ValidationError([" + $ + "]); " : s += " validate.errors = [" + $ + "]; return false; " : s += " var err = " + $ + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", s += " } ", d && (s += " else { "), s };
    }, {}], "YoMQ": [function (require, module, exports) {
        "use strict"; module.exports = function (a, e, r) { var t, s = " ", o = a.level, h = a.dataLevel, m = a.schema[e], l = a.schemaPath + a.util.getProperty(e), i = a.errSchemaPath + "/" + e, d = !a.opts.allErrors, c = "data" + (h || ""), u = a.opts.$data && m && m.$data; u ? (s += " var schema" + o + " = " + a.util.getData(m.$data, h, a.dataPathArr) + "; ", t = "schema" + o) : t = m, s += "if ( ", u && (s += " (" + t + " !== undefined && typeof " + t + " != 'number') || "), s += " " + c + ".length " + ("maxItems" == e ? ">" : "<") + " " + t + ") { "; var n = e, v = v || []; v.push(s), s = "", !1 !== a.createErrors ? (s += " { keyword: '" + (n || "_limitItems") + "' , dataPath: (dataPath || '') + " + a.errorPath + " , schemaPath: " + a.util.toQuotedString(i) + " , params: { limit: " + t + " } ", !1 !== a.opts.messages && (s += " , message: 'should NOT have ", s += "maxItems" == e ? "more" : "less", s += " than ", s += u ? "' + " + t + " + '" : "" + m, s += " items' "), a.opts.verbose && (s += " , schema:  ", s += u ? "validate.schema" + l : "" + m, s += "         , parentSchema: validate.schema" + a.schemaPath + " , data: " + c + " "), s += " } ") : s += " {} "; var p = s; return s = v.pop(), !a.compositeRule && d ? a.async ? s += " throw new ValidationError([" + p + "]); " : s += " validate.errors = [" + p + "]; return false; " : s += " var err = " + p + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", s += "} ", d && (s += " else { "), s };
    }, {}], "9jIs": [function (require, module, exports) {
        "use strict"; module.exports = function (a, e, r) { var t, s = " ", o = a.level, h = a.dataLevel, l = a.schema[e], m = a.schemaPath + a.util.getProperty(e), n = a.errSchemaPath + "/" + e, c = !a.opts.allErrors, d = "data" + (h || ""), i = a.opts.$data && l && l.$data; i ? (s += " var schema" + o + " = " + a.util.getData(l.$data, h, a.dataPathArr) + "; ", t = "schema" + o) : t = l; var u = "maxLength" == e ? ">" : "<"; s += "if ( ", i && (s += " (" + t + " !== undefined && typeof " + t + " != 'number') || "), !1 === a.opts.unicode ? s += " " + d + ".length " : s += " ucs2length(" + d + ") ", s += " " + u + " " + t + ") { "; var p = e, v = v || []; v.push(s), s = "", !1 !== a.createErrors ? (s += " { keyword: '" + (p || "_limitLength") + "' , dataPath: (dataPath || '') + " + a.errorPath + " , schemaPath: " + a.util.toQuotedString(n) + " , params: { limit: " + t + " } ", !1 !== a.opts.messages && (s += " , message: 'should NOT be ", s += "maxLength" == e ? "longer" : "shorter", s += " than ", s += i ? "' + " + t + " + '" : "" + l, s += " characters' "), a.opts.verbose && (s += " , schema:  ", s += i ? "validate.schema" + m : "" + l, s += "         , parentSchema: validate.schema" + a.schemaPath + " , data: " + d + " "), s += " } ") : s += " {} "; var g = s; return s = v.pop(), !a.compositeRule && c ? a.async ? s += " throw new ValidationError([" + g + "]); " : s += " validate.errors = [" + g + "]; return false; " : s += " var err = " + g + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", s += "} ", c && (s += " else { "), s };
    }, {}], "GAVZ": [function (require, module, exports) {
        "use strict"; module.exports = function (e, r, a) { var t, s = " ", o = e.level, h = e.dataLevel, l = e.schema[r], i = e.schemaPath + e.util.getProperty(r), m = e.errSchemaPath + "/" + r, d = !e.opts.allErrors, p = "data" + (h || ""), c = e.opts.$data && l && l.$data; c ? (s += " var schema" + o + " = " + e.util.getData(l.$data, h, e.dataPathArr) + "; ", t = "schema" + o) : t = l, s += "if ( ", c && (s += " (" + t + " !== undefined && typeof " + t + " != 'number') || "), s += " Object.keys(" + p + ").length " + ("maxProperties" == r ? ">" : "<") + " " + t + ") { "; var u = r, n = n || []; n.push(s), s = "", !1 !== e.createErrors ? (s += " { keyword: '" + (u || "_limitProperties") + "' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(m) + " , params: { limit: " + t + " } ", !1 !== e.opts.messages && (s += " , message: 'should NOT have ", s += "maxProperties" == r ? "more" : "less", s += " than ", s += c ? "' + " + t + " + '" : "" + l, s += " properties' "), e.opts.verbose && (s += " , schema:  ", s += c ? "validate.schema" + i : "" + l, s += "         , parentSchema: validate.schema" + e.schemaPath + " , data: " + p + " "), s += " } ") : s += " {} "; var v = s; return s = n.pop(), !e.compositeRule && d ? e.async ? s += " throw new ValidationError([" + v + "]); " : s += " validate.errors = [" + v + "]; return false; " : s += " var err = " + v + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", s += "} ", d && (s += " else { "), s };
    }, {}], "X86S": [function (require, module, exports) {
        "use strict"; module.exports = function (a, e, r) { var t, s = " ", i = a.level, o = a.dataLevel, l = a.schema[e], d = a.schemaPath + a.util.getProperty(e), h = a.errSchemaPath + "/" + e, n = !a.opts.allErrors, m = "data" + (o || ""), p = a.opts.$data && l && l.$data; p ? (s += " var schema" + i + " = " + a.util.getData(l.$data, o, a.dataPathArr) + "; ", t = "schema" + i) : t = l, s += "var division" + i + ";if (", p && (s += " " + t + " !== undefined && ( typeof " + t + " != 'number' || "), s += " (division" + i + " = " + m + " / " + t + ", ", a.opts.multipleOfPrecision ? s += " Math.abs(Math.round(division" + i + ") - division" + i + ") > 1e-" + a.opts.multipleOfPrecision + " " : s += " division" + i + " !== parseInt(division" + i + ") ", s += " ) ", p && (s += "  )  "), s += " ) {   "; var u = u || []; u.push(s), s = "", !1 !== a.createErrors ? (s += " { keyword: 'multipleOf' , dataPath: (dataPath || '') + " + a.errorPath + " , schemaPath: " + a.util.toQuotedString(h) + " , params: { multipleOf: " + t + " } ", !1 !== a.opts.messages && (s += " , message: 'should be multiple of ", s += p ? "' + " + t : t + "'"), a.opts.verbose && (s += " , schema:  ", s += p ? "validate.schema" + d : "" + l, s += "         , parentSchema: validate.schema" + a.schemaPath + " , data: " + m + " "), s += " } ") : s += " {} "; var v = s; return s = u.pop(), !a.compositeRule && n ? a.async ? s += " throw new ValidationError([" + v + "]); " : s += " validate.errors = [" + v + "]; return false; " : s += " var err = " + v + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", s += "} ", n && (s += " else { "), s };
    }, {}], "WoJe": [function (require, module, exports) {
        "use strict"; module.exports = function (r, e, a) { var s = " ", t = r.level, o = r.dataLevel, l = r.schema[e], h = r.schemaPath + r.util.getProperty(e), c = r.errSchemaPath + "/" + e, i = !r.opts.allErrors, m = "data" + (o || ""), v = "errs__" + t, p = r.util.copy(r); p.level++; var u = "valid" + p.level; if (r.util.schemaHasRules(l, r.RULES.all)) { p.schema = l, p.schemaPath = h, p.errSchemaPath = c, s += " var " + v + " = errors;  "; var d, E = r.compositeRule; r.compositeRule = p.compositeRule = !0, p.createErrors = !1, p.opts.allErrors && (d = p.opts.allErrors, p.opts.allErrors = !1), s += " " + r.validate(p) + " ", p.createErrors = !0, d && (p.opts.allErrors = d), r.compositeRule = p.compositeRule = E, s += " if (" + u + ") {   "; var n = n || []; n.push(s), s = "", !1 !== r.createErrors ? (s += " { keyword: 'not' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(c) + " , params: {} ", !1 !== r.opts.messages && (s += " , message: 'should NOT be valid' "), r.opts.verbose && (s += " , schema: validate.schema" + h + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + m + " "), s += " } ") : s += " {} "; var P = s; s = n.pop(), !r.compositeRule && i ? r.async ? s += " throw new ValidationError([" + P + "]); " : s += " validate.errors = [" + P + "]; return false; " : s += " var err = " + P + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", s += " } else {  errors = " + v + "; if (vErrors !== null) { if (" + v + ") vErrors.length = " + v + "; else vErrors = null; } ", r.opts.allErrors && (s += " } ") } else s += "  var err =   ", !1 !== r.createErrors ? (s += " { keyword: 'not' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(c) + " , params: {} ", !1 !== r.opts.messages && (s += " , message: 'should NOT be valid' "), r.opts.verbose && (s += " , schema: validate.schema" + h + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + m + " "), s += " } ") : s += " {} ", s += ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", i && (s += " if (false) { "); return s };
    }, {}], "Pd/8": [function (require, module, exports) {
        "use strict"; module.exports = function (e, r, a) { var s = " ", l = e.level, t = e.dataLevel, o = e.schema[r], i = e.schemaPath + e.util.getProperty(r), v = e.errSchemaPath + "/" + r, h = !e.opts.allErrors, c = "data" + (t || ""), m = "valid" + l, u = "errs__" + l, d = e.util.copy(e), p = ""; d.level++; var n = "valid" + d.level; s += "var " + u + " = errors;var prevValid" + l + " = false;var " + m + " = false;"; var f = d.baseId, E = e.compositeRule; e.compositeRule = d.compositeRule = !0; var P = o; if (P) for (var R, g = -1, y = P.length - 1; g < y;)R = P[g += 1], e.util.schemaHasRules(R, e.RULES.all) ? (d.schema = R, d.schemaPath = i + "[" + g + "]", d.errSchemaPath = v + "/" + g, s += "  " + e.validate(d) + " ", d.baseId = f) : s += " var " + n + " = true; ", g && (s += " if (" + n + " && prevValid" + l + ") " + m + " = false; else { ", p += "}"), s += " if (" + n + ") " + m + " = prevValid" + l + " = true;"; return e.compositeRule = d.compositeRule = E, s += p + "if (!" + m + ") {   var err =   ", !1 !== e.createErrors ? (s += " { keyword: 'oneOf' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(v) + " , params: {} ", !1 !== e.opts.messages && (s += " , message: 'should match exactly one schema in oneOf' "), e.opts.verbose && (s += " , schema: validate.schema" + i + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + c + " "), s += " } ") : s += " {} ", s += ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", !e.compositeRule && h && (e.async ? s += " throw new ValidationError(vErrors); " : s += " validate.errors = vErrors; return false; "), s += "} else {  errors = " + u + "; if (vErrors !== null) { if (" + u + ") vErrors.length = " + u + "; else vErrors = null; }", e.opts.allErrors && (s += " } "), s };
    }, {}], "hgZn": [function (require, module, exports) {
        "use strict"; module.exports = function (e, t, a) { var r, s = " ", o = e.level, h = e.dataLevel, l = e.schema[t], u = e.schemaPath + e.util.getProperty(t), d = e.errSchemaPath + "/" + t, i = !e.opts.allErrors, n = "data" + (h || ""), p = e.opts.$data && l && l.$data; p ? (s += " var schema" + o + " = " + e.util.getData(l.$data, h, e.dataPathArr) + "; ", r = "schema" + o) : r = l, s += "if ( ", p && (s += " (" + r + " !== undefined && typeof " + r + " != 'string') || "), s += " !" + (p ? "(new RegExp(" + r + "))" : e.usePattern(l)) + ".test(" + n + ") ) {   "; var c = c || []; c.push(s), s = "", !1 !== e.createErrors ? (s += " { keyword: 'pattern' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(d) + " , params: { pattern:  ", s += p ? "" + r : "" + e.util.toQuotedString(l), s += "  } ", !1 !== e.opts.messages && (s += " , message: 'should match pattern \"", s += p ? "' + " + r + " + '" : "" + e.util.escapeQuotes(l), s += "\"' "), e.opts.verbose && (s += " , schema:  ", s += p ? "validate.schema" + u : "" + e.util.toQuotedString(l), s += "         , parentSchema: validate.schema" + e.schemaPath + " , data: " + n + " "), s += " } ") : s += " {} "; var m = s; return s = c.pop(), !e.compositeRule && i ? e.async ? s += " throw new ValidationError([" + m + "]); " : s += " validate.errors = [" + m + "]; return false; " : s += " var err = " + m + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", s += "} ", i && (s += " else { "), s };
    }, {}], "PyFz": [function (require, module, exports) {
        "use strict"; module.exports = function (e, r, a) { var t = " ", s = e.level, o = e.dataLevel, i = e.schema[r], l = e.schemaPath + e.util.getProperty(r), h = e.errSchemaPath + "/" + r, p = !e.opts.allErrors, u = "data" + (o || ""), n = "valid" + s, c = "errs__" + s, v = e.util.copy(e), d = ""; v.level++; var P = "valid" + v.level, m = "key" + s, f = "idx" + s, g = v.dataLevel = e.dataLevel + 1, y = "data" + g, E = "dataProperties" + s, S = Object.keys(i || {}), b = e.schema.patternProperties || {}, R = Object.keys(b), O = e.schema.additionalProperties, j = S.length || R.length, k = !1 === O, w = "object" == typeof O && Object.keys(O).length, Q = e.opts.removeAdditional, x = k || w || Q, G = e.opts.ownProperties, A = e.baseId, _ = e.schema.required; if (_ && (!e.opts.v5 || !_.$data) && _.length < e.opts.loopRequired) var q = e.util.toHash(_); if (e.opts.patternGroups) var D = e.schema.patternGroups || {}, I = Object.keys(D); if (t += "var " + c + " = errors;var " + P + " = true;", G && (t += " var " + E + " = undefined;"), x) { if (t += G ? " " + E + " = " + E + " || Object.keys(" + u + "); for (var " + f + "=0; " + f + "<" + E + ".length; " + f + "++) { var " + m + " = " + E + "[" + f + "]; " : " for (var " + m + " in " + u + ") { ", j) { if (t += " var isAdditional" + s + " = !(false ", S.length) if (S.length > 5) t += " || validate.schema" + l + "[" + m + "] "; else { var L = S; if (L) for (var C = -1, H = L.length - 1; C < H;)Z = L[C += 1], t += " || " + m + " == " + e.util.toQuotedString(Z) + " " } if (R.length) { var U = R; if (U) for (var V = -1, F = U.length - 1; V < F;)he = U[V += 1], t += " || " + e.usePattern(he) + ".test(" + m + ") " } if (e.opts.patternGroups && I.length) { var N = I; if (N) { V = -1; for (var T = N.length - 1; V < T;)ce = N[V += 1], t += " || " + e.usePattern(ce) + ".test(" + m + ") " } } t += " ); if (isAdditional" + s + ") { " } if ("all" == Q) t += " delete " + u + "[" + m + "]; "; else { var $ = e.errorPath, z = "' + " + m + " + '"; if (e.opts._errorDataPathProperty && (e.errorPath = e.util.getPathExpr(e.errorPath, m, e.opts.jsonPointers)), k) if (Q) t += " delete " + u + "[" + m + "]; "; else { t += " " + P + " = false; "; var B = h; h = e.errSchemaPath + "/additionalProperties", (Se = Se || []).push(t), t = "", !1 !== e.createErrors ? (t += " { keyword: 'additionalProperties' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(h) + " , params: { additionalProperty: '" + z + "' } ", !1 !== e.opts.messages && (t += " , message: 'should NOT have additional properties' "), e.opts.verbose && (t += " , schema: false , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), t += " } ") : t += " {} "; var J = t; t = Se.pop(), !e.compositeRule && p ? e.async ? t += " throw new ValidationError([" + J + "]); " : t += " validate.errors = [" + J + "]; return false; " : t += " var err = " + J + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", h = B, p && (t += " break; ") } else if (w) if ("failing" == Q) { t += " var " + c + " = errors;  "; var K = e.compositeRule; e.compositeRule = v.compositeRule = !0, v.schema = O, v.schemaPath = e.schemaPath + ".additionalProperties", v.errSchemaPath = e.errSchemaPath + "/additionalProperties", v.errorPath = e.opts._errorDataPathProperty ? e.errorPath : e.util.getPathExpr(e.errorPath, m, e.opts.jsonPointers); var M = u + "[" + m + "]"; v.dataPathArr[g] = m; var W = e.validate(v); v.baseId = A, e.util.varOccurences(W, y) < 2 ? t += " " + e.util.varReplace(W, y, M) + " " : t += " var " + y + " = " + M + "; " + W + " ", t += " if (!" + P + ") { errors = " + c + "; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete " + u + "[" + m + "]; }  ", e.compositeRule = v.compositeRule = K } else { v.schema = O, v.schemaPath = e.schemaPath + ".additionalProperties", v.errSchemaPath = e.errSchemaPath + "/additionalProperties", v.errorPath = e.opts._errorDataPathProperty ? e.errorPath : e.util.getPathExpr(e.errorPath, m, e.opts.jsonPointers); M = u + "[" + m + "]"; v.dataPathArr[g] = m; W = e.validate(v); v.baseId = A, e.util.varOccurences(W, y) < 2 ? t += " " + e.util.varReplace(W, y, M) + " " : t += " var " + y + " = " + M + "; " + W + " ", p && (t += " if (!" + P + ") break; ") } e.errorPath = $ } j && (t += " } "), t += " }  ", p && (t += " if (" + P + ") { ", d += "}") } var X = e.opts.useDefaults && !e.compositeRule; if (S.length) { var Y = S; if (Y) for (var Z, ee = -1, re = Y.length - 1; ee < re;) { var ae = i[Z = Y[ee += 1]]; if (e.util.schemaHasRules(ae, e.RULES.all)) { var te = e.util.getProperty(Z), se = (M = u + te, X && void 0 !== ae.default); v.schema = ae, v.schemaPath = l + te, v.errSchemaPath = h + "/" + e.util.escapeFragment(Z), v.errorPath = e.util.getPath(e.errorPath, Z, e.opts.jsonPointers), v.dataPathArr[g] = e.util.toQuotedString(Z); W = e.validate(v); if (v.baseId = A, e.util.varOccurences(W, y) < 2) { W = e.util.varReplace(W, y, M); var oe = M } else { oe = y; t += " var " + y + " = " + M + "; " } if (se) t += " " + W + " "; else { if (q && q[Z]) { t += " if ( " + oe + " === undefined ", G && (t += " || ! Object.prototype.hasOwnProperty.call(" + u + ", '" + e.util.escapeQuotes(Z) + "') "), t += ") { " + P + " = false; "; $ = e.errorPath, B = h; var ie = e.util.escapeQuotes(Z); e.opts._errorDataPathProperty && (e.errorPath = e.util.getPath($, Z, e.opts.jsonPointers)), h = e.errSchemaPath + "/required", (Se = Se || []).push(t), t = "", !1 !== e.createErrors ? (t += " { keyword: 'required' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(h) + " , params: { missingProperty: '" + ie + "' } ", !1 !== e.opts.messages && (t += " , message: '", e.opts._errorDataPathProperty ? t += "is a required property" : t += "should have required property \\'" + ie + "\\'", t += "' "), e.opts.verbose && (t += " , schema: validate.schema" + l + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), t += " } ") : t += " {} "; J = t; t = Se.pop(), !e.compositeRule && p ? e.async ? t += " throw new ValidationError([" + J + "]); " : t += " validate.errors = [" + J + "]; return false; " : t += " var err = " + J + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", h = B, e.errorPath = $, t += " } else { " } else p ? (t += " if ( " + oe + " === undefined ", G && (t += " || ! Object.prototype.hasOwnProperty.call(" + u + ", '" + e.util.escapeQuotes(Z) + "') "), t += ") { " + P + " = true; } else { ") : (t += " if (" + oe + " !== undefined ", G && (t += " &&   Object.prototype.hasOwnProperty.call(" + u + ", '" + e.util.escapeQuotes(Z) + "') "), t += " ) { "); t += " " + W + " } " } } p && (t += " if (" + P + ") { ", d += "}") } } if (R.length) { var le = R; if (le) for (var he, pe = -1, ue = le.length - 1; pe < ue;) { ae = b[he = le[pe += 1]]; if (e.util.schemaHasRules(ae, e.RULES.all)) { v.schema = ae, v.schemaPath = e.schemaPath + ".patternProperties" + e.util.getProperty(he), v.errSchemaPath = e.errSchemaPath + "/patternProperties/" + e.util.escapeFragment(he), t += G ? " " + E + " = " + E + " || Object.keys(" + u + "); for (var " + f + "=0; " + f + "<" + E + ".length; " + f + "++) { var " + m + " = " + E + "[" + f + "]; " : " for (var " + m + " in " + u + ") { ", t += " if (" + e.usePattern(he) + ".test(" + m + ")) { ", v.errorPath = e.util.getPathExpr(e.errorPath, m, e.opts.jsonPointers); M = u + "[" + m + "]"; v.dataPathArr[g] = m; W = e.validate(v); v.baseId = A, e.util.varOccurences(W, y) < 2 ? t += " " + e.util.varReplace(W, y, M) + " " : t += " var " + y + " = " + M + "; " + W + " ", p && (t += " if (!" + P + ") break; "), t += " } ", p && (t += " else " + P + " = true; "), t += " }  ", p && (t += " if (" + P + ") { ", d += "}") } } } if (e.opts.patternGroups && I.length) { var ne = I; if (ne) for (var ce, ve = -1, de = ne.length - 1; ve < de;) { var Pe = D[ce = ne[ve += 1]]; ae = Pe.schema; if (e.util.schemaHasRules(ae, e.RULES.all)) { v.schema = ae, v.schemaPath = e.schemaPath + ".patternGroups" + e.util.getProperty(ce) + ".schema", v.errSchemaPath = e.errSchemaPath + "/patternGroups/" + e.util.escapeFragment(ce) + "/schema", t += " var pgPropCount" + s + " = 0;  ", t += G ? " " + E + " = " + E + " || Object.keys(" + u + "); for (var " + f + "=0; " + f + "<" + E + ".length; " + f + "++) { var " + m + " = " + E + "[" + f + "]; " : " for (var " + m + " in " + u + ") { ", t += " if (" + e.usePattern(ce) + ".test(" + m + ")) { pgPropCount" + s + "++; ", v.errorPath = e.util.getPathExpr(e.errorPath, m, e.opts.jsonPointers); M = u + "[" + m + "]"; v.dataPathArr[g] = m; W = e.validate(v); v.baseId = A, e.util.varOccurences(W, y) < 2 ? t += " " + e.util.varReplace(W, y, M) + " " : t += " var " + y + " = " + M + "; " + W + " ", p && (t += " if (!" + P + ") break; "), t += " } ", p && (t += " else " + P + " = true; "), t += " }  ", p && (t += " if (" + P + ") { ", d += "}"); var me = Pe.minimum, fe = Pe.maximum; if (void 0 !== me || void 0 !== fe) { t += " var " + n + " = true; "; B = h; if (void 0 !== me) { var ge = me, ye = "minimum", Ee = "less"; t += " " + n + " = pgPropCount" + s + " >= " + me + "; ", h = e.errSchemaPath + "/patternGroups/minimum", t += "  if (!" + n + ") {   ", (Se = Se || []).push(t), t = "", !1 !== e.createErrors ? (t += " { keyword: 'patternGroups' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(h) + " , params: { reason: '" + ye + "', limit: " + ge + ", pattern: '" + e.util.escapeQuotes(ce) + "' } ", !1 !== e.opts.messages && (t += " , message: 'should NOT have " + Ee + " than " + ge + ' properties matching pattern "' + e.util.escapeQuotes(ce) + "\"' "), e.opts.verbose && (t += " , schema: validate.schema" + l + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), t += " } ") : t += " {} "; J = t; t = Se.pop(), !e.compositeRule && p ? e.async ? t += " throw new ValidationError([" + J + "]); " : t += " validate.errors = [" + J + "]; return false; " : t += " var err = " + J + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " } ", void 0 !== fe && (t += " else ") } if (void 0 !== fe) { var Se; ge = fe, ye = "maximum", Ee = "more"; t += " " + n + " = pgPropCount" + s + " <= " + fe + "; ", h = e.errSchemaPath + "/patternGroups/maximum", t += "  if (!" + n + ") {   ", (Se = Se || []).push(t), t = "", !1 !== e.createErrors ? (t += " { keyword: 'patternGroups' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(h) + " , params: { reason: '" + ye + "', limit: " + ge + ", pattern: '" + e.util.escapeQuotes(ce) + "' } ", !1 !== e.opts.messages && (t += " , message: 'should NOT have " + Ee + " than " + ge + ' properties matching pattern "' + e.util.escapeQuotes(ce) + "\"' "), e.opts.verbose && (t += " , schema: validate.schema" + l + " , parentSchema: validate.schema" + e.schemaPath + " , data: " + u + " "), t += " } ") : t += " {} "; J = t; t = Se.pop(), !e.compositeRule && p ? e.async ? t += " throw new ValidationError([" + J + "]); " : t += " validate.errors = [" + J + "]; return false; " : t += " var err = " + J + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " } " } h = B, p && (t += " if (" + n + ") { ", d += "}") } } } } return p && (t += " " + d + " if (" + c + " == errors) {"), t = e.util.cleanUpCode(t) };
    }, {}], "B9D0": [function (require, module, exports) {
        "use strict"; module.exports = function (r, e, a) { var t = " ", s = r.level, o = r.dataLevel, l = r.schema[e], i = r.schemaPath + r.util.getProperty(e), v = r.errSchemaPath + "/" + e, c = !r.opts.allErrors, p = "data" + (o || ""), m = "errs__" + s, d = r.util.copy(r); d.level++; var h = "valid" + d.level; if (r.util.schemaHasRules(l, r.RULES.all)) { d.schema = l, d.schemaPath = i, d.errSchemaPath = v; var u = "key" + s, n = "idx" + s, E = "i" + s, P = "' + " + u + " + '", f = "data" + (d.dataLevel = r.dataLevel + 1), y = "dataProperties" + s, R = r.opts.ownProperties, b = r.baseId; t += " var " + m + " = errors; ", R && (t += " var " + y + " = undefined; "), t += R ? " " + y + " = " + y + " || Object.keys(" + p + "); for (var " + n + "=0; " + n + "<" + y + ".length; " + n + "++) { var " + u + " = " + y + "[" + n + "]; " : " for (var " + u + " in " + p + ") { ", t += " var startErrs" + s + " = errors; "; var g = u, S = r.compositeRule; r.compositeRule = d.compositeRule = !0; var k = r.validate(d); d.baseId = b, r.util.varOccurences(k, f) < 2 ? t += " " + r.util.varReplace(k, f, g) + " " : t += " var " + f + " = " + g + "; " + k + " ", r.compositeRule = d.compositeRule = S, t += " if (!" + h + ") { for (var " + E + "=startErrs" + s + "; " + E + "<errors; " + E + "++) { vErrors[" + E + "].propertyName = " + u + "; }   var err =   ", !1 !== r.createErrors ? (t += " { keyword: 'propertyNames' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(v) + " , params: { propertyName: '" + P + "' } ", !1 !== r.opts.messages && (t += " , message: 'property name \\'" + P + "\\' is invalid' "), r.opts.verbose && (t += " , schema: validate.schema" + i + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + p + " "), t += " } ") : t += " {} ", t += ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", !r.compositeRule && c && (r.async ? t += " throw new ValidationError(vErrors); " : t += " validate.errors = vErrors; return false; "), c && (t += " break; "), t += " } }" } return c && (t += "  if (" + m + " == errors) {"), t = r.util.cleanUpCode(t) };
    }, {}], "oRre": [function (require, module, exports) {
        "use strict"; module.exports = function (r, e, a) { var t = " ", s = r.level, o = r.dataLevel, i = r.schema[e], h = r.schemaPath + r.util.getProperty(e), p = r.errSchemaPath + "/" + e, l = !r.opts.allErrors, d = "data" + (o || ""), u = "valid" + s, P = r.opts.$data && i && i.$data; P && (t += " var schema" + s + " = " + r.util.getData(i.$data, o, r.dataPathArr) + "; "); var n = "schema" + s; if (!P) if (i.length < r.opts.loopRequired && r.schema.properties && Object.keys(r.schema.properties).length) { var m = [], v = i; if (v) for (var c, y = -1, g = v.length - 1; y < g;) { c = v[y += 1]; var f = r.schema.properties[c]; f && r.util.schemaHasRules(f, r.RULES.all) || (m[m.length] = c) } } else m = i; if (P || m.length) { var E = r.errorPath, q = P || m.length >= r.opts.loopRequired, w = r.opts.ownProperties; if (l) if (t += " var missing" + s + "; ", q) { P || (t += " var " + n + " = validate.schema" + h + "; "); var S = "' + " + (_ = "schema" + s + "[" + (D = "i" + s) + "]") + " + '"; r.opts._errorDataPathProperty && (r.errorPath = r.util.getPathExpr(E, _, r.opts.jsonPointers)), t += " var " + u + " = true; ", P && (t += " if (schema" + s + " === undefined) " + u + " = true; else if (!Array.isArray(schema" + s + ")) " + u + " = false; else {"), t += " for (var " + D + " = 0; " + D + " < " + n + ".length; " + D + "++) { " + u + " = " + d + "[" + n + "[" + D + "]] !== undefined ", w && (t += " &&   Object.prototype.hasOwnProperty.call(" + d + ", " + n + "[" + D + "]) "), t += "; if (!" + u + ") break; } ", P && (t += "  }  "), t += "  if (!" + u + ") {   ", (Q = Q || []).push(t), t = "", !1 !== r.createErrors ? (t += " { keyword: 'required' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(p) + " , params: { missingProperty: '" + S + "' } ", !1 !== r.opts.messages && (t += " , message: '", r.opts._errorDataPathProperty ? t += "is a required property" : t += "should have required property \\'" + S + "\\'", t += "' "), r.opts.verbose && (t += " , schema: validate.schema" + h + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + d + " "), t += " } ") : t += " {} "; var b = t; t = Q.pop(), !r.compositeRule && l ? r.async ? t += " throw new ValidationError([" + b + "]); " : t += " validate.errors = [" + b + "]; return false; " : t += " var err = " + b + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " } else { " } else { t += " if ( "; var j = m; if (j) for (var D = -1, O = j.length - 1; D < O;) { R = j[D += 1], D && (t += " || "), t += " ( ( " + (L = d + ($ = r.util.getProperty(R))) + " === undefined ", w && (t += " || ! Object.prototype.hasOwnProperty.call(" + d + ", '" + r.util.escapeQuotes(R) + "') "), t += ") && (missing" + s + " = " + r.util.toQuotedString(r.opts.jsonPointers ? R : $) + ") ) " } t += ") {  "; var Q; S = "' + " + (_ = "missing" + s) + " + '"; r.opts._errorDataPathProperty && (r.errorPath = r.opts.jsonPointers ? r.util.getPathExpr(E, _, !0) : E + " + " + _), (Q = Q || []).push(t), t = "", !1 !== r.createErrors ? (t += " { keyword: 'required' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(p) + " , params: { missingProperty: '" + S + "' } ", !1 !== r.opts.messages && (t += " , message: '", r.opts._errorDataPathProperty ? t += "is a required property" : t += "should have required property \\'" + S + "\\'", t += "' "), r.opts.verbose && (t += " , schema: validate.schema" + h + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + d + " "), t += " } ") : t += " {} "; b = t; t = Q.pop(), !r.compositeRule && l ? r.async ? t += " throw new ValidationError([" + b + "]); " : t += " validate.errors = [" + b + "]; return false; " : t += " var err = " + b + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", t += " } else { " } else if (q) { P || (t += " var " + n + " = validate.schema" + h + "; "); var _; S = "' + " + (_ = "schema" + s + "[" + (D = "i" + s) + "]") + " + '"; r.opts._errorDataPathProperty && (r.errorPath = r.util.getPathExpr(E, _, r.opts.jsonPointers)), P && (t += " if (" + n + " && !Array.isArray(" + n + ")) {  var err =   ", !1 !== r.createErrors ? (t += " { keyword: 'required' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(p) + " , params: { missingProperty: '" + S + "' } ", !1 !== r.opts.messages && (t += " , message: '", r.opts._errorDataPathProperty ? t += "is a required property" : t += "should have required property \\'" + S + "\\'", t += "' "), r.opts.verbose && (t += " , schema: validate.schema" + h + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + d + " "), t += " } ") : t += " {} ", t += ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if (" + n + " !== undefined) { "), t += " for (var " + D + " = 0; " + D + " < " + n + ".length; " + D + "++) { if (" + d + "[" + n + "[" + D + "]] === undefined ", w && (t += " || ! Object.prototype.hasOwnProperty.call(" + d + ", " + n + "[" + D + "]) "), t += ") {  var err =   ", !1 !== r.createErrors ? (t += " { keyword: 'required' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(p) + " , params: { missingProperty: '" + S + "' } ", !1 !== r.opts.messages && (t += " , message: '", r.opts._errorDataPathProperty ? t += "is a required property" : t += "should have required property \\'" + S + "\\'", t += "' "), r.opts.verbose && (t += " , schema: validate.schema" + h + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + d + " "), t += " } ") : t += " {} ", t += ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ", P && (t += "  }  ") } else { var k = m; if (k) for (var R, A = -1, x = k.length - 1; A < x;) { R = k[A += 1]; var $ = r.util.getProperty(R), L = (S = r.util.escapeQuotes(R), d + $); r.opts._errorDataPathProperty && (r.errorPath = r.util.getPath(E, R, r.opts.jsonPointers)), t += " if ( " + L + " === undefined ", w && (t += " || ! Object.prototype.hasOwnProperty.call(" + d + ", '" + r.util.escapeQuotes(R) + "') "), t += ") {  var err =   ", !1 !== r.createErrors ? (t += " { keyword: 'required' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(p) + " , params: { missingProperty: '" + S + "' } ", !1 !== r.opts.messages && (t += " , message: '", r.opts._errorDataPathProperty ? t += "is a required property" : t += "should have required property \\'" + S + "\\'", t += "' "), r.opts.verbose && (t += " , schema: validate.schema" + h + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + d + " "), t += " } ") : t += " {} ", t += ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } " } } r.errorPath = E } else l && (t += " if (true) {"); return t };
    }, {}], "Ylu6": [function (require, module, exports) {
        "use strict"; module.exports = function (e, a, r) { var t, s = " ", i = e.level, o = e.dataLevel, l = e.schema[a], h = e.schemaPath + e.util.getProperty(a), u = e.errSchemaPath + "/" + a, d = !e.opts.allErrors, m = "data" + (o || ""), n = "valid" + i, v = e.opts.$data && l && l.$data; if (v ? (s += " var schema" + i + " = " + e.util.getData(l.$data, o, e.dataPathArr) + "; ", t = "schema" + i) : t = l, (l || v) && !1 !== e.opts.uniqueItems) { v && (s += " var " + n + "; if (" + t + " === false || " + t + " === undefined) " + n + " = true; else if (typeof " + t + " != 'boolean') " + n + " = false; else { "), s += " var " + n + " = true; if (" + m + ".length > 1) { var i = " + m + ".length, j; outer: for (;i--;) { for (j = i; j--;) { if (equal(" + m + "[i], " + m + "[j])) { " + n + " = false; break outer; } } } } ", v && (s += "  }  "), s += " if (!" + n + ") {   "; var c = c || []; c.push(s), s = "", !1 !== e.createErrors ? (s += " { keyword: 'uniqueItems' , dataPath: (dataPath || '') + " + e.errorPath + " , schemaPath: " + e.util.toQuotedString(u) + " , params: { i: i, j: j } ", !1 !== e.opts.messages && (s += " , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "), e.opts.verbose && (s += " , schema:  ", s += v ? "validate.schema" + h : "" + l, s += "         , parentSchema: validate.schema" + e.schemaPath + " , data: " + m + " "), s += " } ") : s += " {} "; var f = s; s = c.pop(), !e.compositeRule && d ? e.async ? s += " throw new ValidationError([" + f + "]); " : s += " validate.errors = [" + f + "]; return false; " : s += " var err = " + f + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", s += " } ", d && (s += " else { ") } else d && (s += " if (true) { "); return s };
    }, {}], "1J0a": [function (require, module, exports) {
        "use strict"; module.exports = { $ref: require("../dotjs/ref"), allOf: require("../dotjs/allOf"), anyOf: require("../dotjs/anyOf"), const: require("../dotjs/const"), contains: require("../dotjs/contains"), dependencies: require("../dotjs/dependencies"), enum: require("../dotjs/enum"), format: require("../dotjs/format"), items: require("../dotjs/items"), maximum: require("../dotjs/_limit"), minimum: require("../dotjs/_limit"), maxItems: require("../dotjs/_limitItems"), minItems: require("../dotjs/_limitItems"), maxLength: require("../dotjs/_limitLength"), minLength: require("../dotjs/_limitLength"), maxProperties: require("../dotjs/_limitProperties"), minProperties: require("../dotjs/_limitProperties"), multipleOf: require("../dotjs/multipleOf"), not: require("../dotjs/not"), oneOf: require("../dotjs/oneOf"), pattern: require("../dotjs/pattern"), properties: require("../dotjs/properties"), propertyNames: require("../dotjs/propertyNames"), required: require("../dotjs/required"), uniqueItems: require("../dotjs/uniqueItems"), validate: require("../dotjs/validate") };
    }, { "../dotjs/ref": "xcTN", "../dotjs/allOf": "jiJK", "../dotjs/anyOf": "Pnof", "../dotjs/const": "z0a6", "../dotjs/contains": "0IaH", "../dotjs/dependencies": "BMaw", "../dotjs/enum": "mbmc", "../dotjs/format": "Bkge", "../dotjs/items": "veNu", "../dotjs/_limit": "QYf9", "../dotjs/_limitItems": "YoMQ", "../dotjs/_limitLength": "9jIs", "../dotjs/_limitProperties": "GAVZ", "../dotjs/multipleOf": "X86S", "../dotjs/not": "WoJe", "../dotjs/oneOf": "Pd/8", "../dotjs/pattern": "hgZn", "../dotjs/properties": "PyFz", "../dotjs/propertyNames": "B9D0", "../dotjs/required": "oRre", "../dotjs/uniqueItems": "Ylu6", "../dotjs/validate": "XNwE" }], "e07p": [function (require, module, exports) {
        "use strict"; var e = require("./_rules"), t = require("./util").toHash; module.exports = function () { var r = [{ type: "number", rules: [{ maximum: ["exclusiveMaximum"] }, { minimum: ["exclusiveMinimum"] }, "multipleOf", "format"] }, { type: "string", rules: ["maxLength", "minLength", "pattern", "format"] }, { type: "array", rules: ["maxItems", "minItems", "uniqueItems", "contains", "items"] }, { type: "object", rules: ["maxProperties", "minProperties", "required", "dependencies", "propertyNames", { properties: ["additionalProperties", "patternProperties"] }] }, { rules: ["$ref", "const", "enum", "not", "anyOf", "oneOf", "allOf"] }], i = ["type"]; return r.all = t(i), r.types = t(["number", "integer", "string", "array", "object", "boolean", "null"]), r.forEach(function (t) { t.rules = t.rules.map(function (t) { var n; if ("object" == typeof t) { var s = Object.keys(t)[0]; n = t[s], t = s, n.forEach(function (e) { i.push(e), r.all[e] = !0 }) } return i.push(t), r.all[t] = { keyword: t, code: e[t], implements: n } }), t.type && (r.types[t.type] = t) }), r.keywords = t(i.concat(["additionalItems", "$schema", "$id", "id", "title", "description", "default", "definitions"])), r.custom = {}, r };
    }, { "./_rules": "1J0a", "./util": "S6qf" }], "6IZx": [function (require, module, exports) {
        "use strict"; var e = ["multipleOf", "maximum", "exclusiveMaximum", "minimum", "exclusiveMinimum", "maxLength", "minLength", "pattern", "additionalItems", "maxItems", "minItems", "uniqueItems", "maxProperties", "minProperties", "required", "additionalProperties", "enum", "format", "const"]; module.exports = function (t, i) { for (var r = 0; r < i.length; r++) { t = JSON.parse(JSON.stringify(t)); var m, n = i[r].split("/"), a = t; for (m = 1; m < n.length; m++)a = a[n[m]]; for (m = 0; m < e.length; m++) { var s = e[m], o = a[s]; o && (a[s] = { anyOf: [o, { $ref: "https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#" }] }) } } return t };
    }, {}], "zz8k": [function (require, module, exports) {
        "use strict"; var e = "http://json-schema.org/draft-06/schema"; module.exports = function (t) { var r = t._opts.defaultMeta, i = "string" == typeof r ? { $ref: r } : t.getSchema(e) ? { $ref: e } : {}; t.addKeyword("patternGroups", { metaSchema: { type: "object", additionalProperties: { type: "object", required: ["schema"], properties: { maximum: { type: "integer", minimum: 0 }, minimum: { type: "integer", minimum: 0 }, schema: i }, additionalProperties: !1 } } }), t.RULES.all.properties.implements.push("patternGroups") };
    }, {}], "edJK": [function (require, module, exports) {
        "use strict"; var n = require("./error_classes").MissingRef; function e(t, r, o) { var i = this; if ("function" != typeof this._opts.loadSchema) throw new Error("options.loadSchema should be a function"); "function" == typeof r && (o = r, r = void 0); var a = c(t).then(function () { var e = i._addSchema(t, void 0, r); return e.validate || function e(t) { try { return i._compile(t) } catch (a) { if (a instanceof n) return function o(e) { var o = e.missingSchema; if (h(o)) throw new Error("Schema " + o + " is loaded but " + e.missingRef + " cannot be resolved"); var a = i._loadingSchemas[o]; a || (a = i._loadingSchemas[o] = i._opts.loadSchema(o)).then(s, s); return a.then(function (n) { if (!h(o)) return c(n).then(function () { h(o) || i.addSchema(n, o, void 0, r) }) }).then(function () { return function t(o) { try { return i._compile(o) } catch (e) { if (e instanceof n) return a(e); throw e } function a(n) { var e = n.missingSchema; if (h(e)) throw new Error("Schema " + e + " is loaded but " + n.missingRef + " cannot be resolved"); var a = i._loadingSchemas[e]; return a || (a = i._loadingSchemas[e] = i._opts.loadSchema(e)).then(s, s), a.then(function (n) { if (!h(e)) return c(n).then(function () { h(e) || i.addSchema(n, e, void 0, r) }) }).then(function () { return t(o) }); function s() { delete i._loadingSchemas[e] } function h(n) { return i._refs[n] || i._schemas[n] } } }(t) }); function s() { delete i._loadingSchemas[o] } function h(n) { return i._refs[n] || i._schemas[n] } }(a); throw a } function o(n) { var o = n.missingSchema; if (h(o)) throw new Error("Schema " + o + " is loaded but " + n.missingRef + " cannot be resolved"); var a = i._loadingSchemas[o]; return a || (a = i._loadingSchemas[o] = i._opts.loadSchema(o)).then(s, s), a.then(function (n) { if (!h(o)) return c(n).then(function () { h(o) || i.addSchema(n, o, void 0, r) }) }).then(function () { return e(t) }); function s() { delete i._loadingSchemas[o] } function h(n) { return i._refs[n] || i._schemas[n] } } }(e) }); return o && a.then(function (n) { o(null, n) }, o), a; function c(n) { var t = n.$schema; return t && !i.getSchema(t) ? e.call(i, { $ref: t }, !0) : Promise.resolve() } } module.exports = e;
    }, { "./error_classes": "yAtQ" }], "JvpR": [function (require, module, exports) {
        "use strict"; module.exports = function (r, a, e) { var t, s, o = " ", i = r.level, d = r.dataLevel, h = r.schema[a], l = r.schemaPath + r.util.getProperty(a), v = r.errSchemaPath + "/" + a, c = !r.opts.allErrors, n = "data" + (d || ""), m = "valid" + i, u = "errs__" + i, p = r.opts.$data && h && h.$data; p ? (o += " var schema" + i + " = " + r.util.getData(h.$data, d, r.dataPathArr) + "; ", s = "schema" + i) : s = h; var f, P, y, E, w, k = "definition" + i, g = this.definition, R = ""; if (p && g.$data) { w = "keywordValidate" + i; var S = g.validateSchema; o += " var " + k + " = RULES.custom['" + a + "'].definition; var " + w + " = " + k + ".validate;" } else { if (!(E = r.useCustomRule(this, h, r.schema, r))) return; s = "validate.schema" + l, w = E.code, f = g.compile, P = g.inline, y = g.macro } var A = w + ".errors", b = "i" + i, $ = "ruleErr" + i, D = g.async; if (D && !r.async) throw new Error("async keyword in sync schema"); if (P || y || (o += A + " = null;"), o += "var " + u + " = errors;var " + m + ";", p && g.$data && (R += "}", o += " if (" + s + " === undefined) { " + m + " = true; } else { ", S && (R += "}", o += " " + m + " = " + k + ".validateSchema(" + s + "); if (" + m + ") { ")), P) g.statements ? o += " " + E.validate + " " : o += " " + m + " = " + E.validate + "; "; else if (y) { var V = r.util.copy(r); R = ""; V.level++; var x = "valid" + V.level; V.schema = E.validate, V.schemaPath = ""; var C = r.compositeRule; r.compositeRule = V.compositeRule = !0; var L = r.validate(V).replace(/validate\.schema/g, w); r.compositeRule = V.compositeRule = C, o += " " + L } else { (j = j || []).push(o), o = "", o += "  " + w + ".call( ", r.opts.passContext ? o += "this" : o += "self", f || !1 === g.schema ? o += " , " + n + " " : o += " , " + s + " , " + n + " , validate.schema" + r.schemaPath + " ", o += " , (dataPath || '')", '""' != r.errorPath && (o += " + " + r.errorPath); var Q = d ? "data" + (d - 1 || "") : "parentData", _ = d ? r.dataPathArr[d] : "parentDataProperty", U = o += " , " + Q + " , " + _ + " , rootData )  "; o = j.pop(), !1 === g.errors ? (o += " " + m + " = ", D && (o += "" + r.yieldAwait), o += U + "; ") : o += D ? " var " + (A = "customErrors" + i) + " = null; try { " + m + " = " + r.yieldAwait + U + "; } catch (e) { " + m + " = false; if (e instanceof ValidationError) " + A + " = e.errors; else throw e; } " : " " + A + " = null; " + m + " = " + U + "; " } if (g.modifying && (o += " if (" + Q + ") " + n + " = " + Q + "[" + _ + "];"), o += "" + R, g.valid) c && (o += " if (true) { "); else { var j; o += " if ( ", void 0 === g.valid ? (o += " !", o += y ? "" + x : "" + m) : o += " " + !g.valid + " ", o += ") { ", t = this.keyword, (j = j || []).push(o), o = "", (j = j || []).push(o), o = "", !1 !== r.createErrors ? (o += " { keyword: '" + (t || "custom") + "' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(v) + " , params: { keyword: '" + this.keyword + "' } ", !1 !== r.opts.messages && (o += " , message: 'should pass \"" + this.keyword + "\" keyword validation' "), r.opts.verbose && (o += " , schema: validate.schema" + l + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + n + " "), o += " } ") : o += " {} "; var q = o; o = j.pop(), !r.compositeRule && c ? r.async ? o += " throw new ValidationError([" + q + "]); " : o += " validate.errors = [" + q + "]; return false; " : o += " var err = " + q + ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "; var z = o; o = j.pop(), P ? g.errors ? "full" != g.errors && (o += "  for (var " + b + "=" + u + "; " + b + "<errors; " + b + "++) { var " + $ + " = vErrors[" + b + "]; if (" + $ + ".dataPath === undefined) " + $ + ".dataPath = (dataPath || '') + " + r.errorPath + "; if (" + $ + ".schemaPath === undefined) { " + $ + '.schemaPath = "' + v + '"; } ', r.opts.verbose && (o += " " + $ + ".schema = " + s + "; " + $ + ".data = " + n + "; "), o += " } ") : !1 === g.errors ? o += " " + z + " " : (o += " if (" + u + " == errors) { " + z + " } else {  for (var " + b + "=" + u + "; " + b + "<errors; " + b + "++) { var " + $ + " = vErrors[" + b + "]; if (" + $ + ".dataPath === undefined) " + $ + ".dataPath = (dataPath || '') + " + r.errorPath + "; if (" + $ + ".schemaPath === undefined) { " + $ + '.schemaPath = "' + v + '"; } ', r.opts.verbose && (o += " " + $ + ".schema = " + s + "; " + $ + ".data = " + n + "; "), o += " } } ") : y ? (o += "   var err =   ", !1 !== r.createErrors ? (o += " { keyword: '" + (t || "custom") + "' , dataPath: (dataPath || '') + " + r.errorPath + " , schemaPath: " + r.util.toQuotedString(v) + " , params: { keyword: '" + this.keyword + "' } ", !1 !== r.opts.messages && (o += " , message: 'should pass \"" + this.keyword + "\" keyword validation' "), r.opts.verbose && (o += " , schema: validate.schema" + l + " , parentSchema: validate.schema" + r.schemaPath + " , data: " + n + " "), o += " } ") : o += " {} ", o += ";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ", !r.compositeRule && c && (r.async ? o += " throw new ValidationError(vErrors); " : o += " validate.errors = vErrors; return false; ")) : !1 === g.errors ? o += " " + z + " " : (o += " if (Array.isArray(" + A + ")) { if (vErrors === null) vErrors = " + A + "; else vErrors = vErrors.concat(" + A + "); errors = vErrors.length;  for (var " + b + "=" + u + "; " + b + "<errors; " + b + "++) { var " + $ + " = vErrors[" + b + "]; if (" + $ + ".dataPath === undefined) " + $ + ".dataPath = (dataPath || '') + " + r.errorPath + ";  " + $ + '.schemaPath = "' + v + '";  ', r.opts.verbose && (o += " " + $ + ".schema = " + s + "; " + $ + ".data = " + n + "; "), o += " } } else { " + z + " } "), o += " } ", c && (o += " else { ") } return o };
    }, {}], "f+FQ": [function (require, module, exports) {
        "use strict"; var e = /^[a-z_$][a-z0-9_$-]*$/i, r = require("./dotjs/custom"); function t(t, o) { var i = this.RULES; if (i.keywords[t]) throw new Error("Keyword " + t + " is already defined"); if (!e.test(t)) throw new Error("Keyword " + t + " is not a valid identifier"); if (o) { if (o.macro && void 0 !== o.valid) throw new Error('"valid" option cannot be used with macro keywords'); var a = o.type; if (Array.isArray(a)) { var n, s = a.length; for (n = 0; n < s; n++)u(a[n]); for (n = 0; n < s; n++)l(t, a[n], o) } else a && u(a), l(t, a, o); var d = !0 === o.$data && this._opts.$data; if (d && !o.validate) throw new Error('$data support: "validate" function is not defined'); var f = o.metaSchema; f && (d && (f = { anyOf: [f, { $ref: "https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#" }] }), o.validateSchema = this.compile(f, !0)) } function l(e, t, o) { for (var a, n = 0; n < i.length; n++) { var s = i[n]; if (s.type == t) { a = s; break } } a || (a = { type: t, rules: [] }, i.push(a)); var d = { keyword: e, definition: o, custom: !0, code: r, implements: o.implements }; a.rules.push(d), i.custom[e] = d } function u(e) { if (!i.types[e]) throw new Error("Unknown type " + e) } return i.keywords[t] = i.all[t] = !0, this } function o(e) { var r = this.RULES.custom[e]; return r ? r.definition : this.RULES.keywords[e] || !1 } function i(e) { var r = this.RULES; delete r.keywords[e], delete r.all[e], delete r.custom[e]; for (var t = 0; t < r.length; t++)for (var o = r[t].rules, i = 0; i < o.length; i++)if (o[i].keyword == e) { o.splice(i, 1); break } return this } module.exports = { add: t, get: o, remove: i };
    }, { "./dotjs/custom": "JvpR" }], "PiVh": [function (require, module, exports) {
        module.exports = { $schema: "http://json-schema.org/draft-06/schema#", $id: "https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#", description: "Meta-schema for $data reference (JSON-schema extension proposal)", type: "object", required: ["$data"], properties: { $data: { type: "string", anyOf: [{ format: "relative-json-pointer" }, { format: "json-pointer" }] } }, additionalProperties: !1 };
    }, {}], "VXTn": [function (require, module, exports) {
        module.exports = { $schema: "http://json-schema.org/draft-06/schema#", $id: "http://json-schema.org/draft-06/schema#", title: "Core schema meta-schema", definitions: { schemaArray: { type: "array", minItems: 1, items: { $ref: "#" } }, nonNegativeInteger: { type: "integer", minimum: 0 }, nonNegativeIntegerDefault0: { allOf: [{ $ref: "#/definitions/nonNegativeInteger" }, { default: 0 }] }, simpleTypes: { enum: ["array", "boolean", "integer", "null", "number", "object", "string"] }, stringArray: { type: "array", items: { type: "string" }, uniqueItems: !0, default: [] } }, type: ["object", "boolean"], properties: { $id: { type: "string", format: "uri-reference" }, $schema: { type: "string", format: "uri" }, $ref: { type: "string", format: "uri-reference" }, title: { type: "string" }, description: { type: "string" }, default: {}, examples: { type: "array", items: {} }, multipleOf: { type: "number", exclusiveMinimum: 0 }, maximum: { type: "number" }, exclusiveMaximum: { type: "number" }, minimum: { type: "number" }, exclusiveMinimum: { type: "number" }, maxLength: { $ref: "#/definitions/nonNegativeInteger" }, minLength: { $ref: "#/definitions/nonNegativeIntegerDefault0" }, pattern: { type: "string", format: "regex" }, additionalItems: { $ref: "#" }, items: { anyOf: [{ $ref: "#" }, { $ref: "#/definitions/schemaArray" }], default: {} }, maxItems: { $ref: "#/definitions/nonNegativeInteger" }, minItems: { $ref: "#/definitions/nonNegativeIntegerDefault0" }, uniqueItems: { type: "boolean", default: !1 }, contains: { $ref: "#" }, maxProperties: { $ref: "#/definitions/nonNegativeInteger" }, minProperties: { $ref: "#/definitions/nonNegativeIntegerDefault0" }, required: { $ref: "#/definitions/stringArray" }, additionalProperties: { $ref: "#" }, definitions: { type: "object", additionalProperties: { $ref: "#" }, default: {} }, properties: { type: "object", additionalProperties: { $ref: "#" }, default: {} }, patternProperties: { type: "object", additionalProperties: { $ref: "#" }, default: {} }, dependencies: { type: "object", additionalProperties: { anyOf: [{ $ref: "#" }, { $ref: "#/definitions/stringArray" }] } }, propertyNames: { $ref: "#" }, const: {}, enum: { type: "array", minItems: 1, uniqueItems: !0 }, type: { anyOf: [{ $ref: "#/definitions/simpleTypes" }, { type: "array", items: { $ref: "#/definitions/simpleTypes" }, minItems: 1, uniqueItems: !0 }] }, format: { type: "string" }, allOf: { $ref: "#/definitions/schemaArray" }, anyOf: { $ref: "#/definitions/schemaArray" }, oneOf: { $ref: "#/definitions/schemaArray" }, not: { $ref: "#" } }, default: {} };
    }, {}], "7PQk": [function (require, module, exports) {
        "use strict"; var e = require("./compile"), t = require("./compile/resolve"), r = require("./cache"), a = require("./compile/schema_obj"), i = require("fast-json-stable-stringify"), s = require("./compile/formats"), o = require("./compile/rules"), h = require("./$data"), n = require("./patternGroups"), c = require("./compile/util"), d = require("co"); module.exports = _, _.prototype.validate = v, _.prototype.compile = g, _.prototype.addSchema = y, _.prototype.addMetaSchema = w, _.prototype.validateSchema = S, _.prototype.getSchema = q, _.prototype.removeSchema = E, _.prototype.addFormat = U, _.prototype.errorsText = K, _.prototype._addSchema = M, _.prototype._compile = z, _.prototype.compileAsync = require("./compile/async"); var m = require("./keyword"); _.prototype.addKeyword = m.add, _.prototype.getKeyword = m.get, _.prototype.removeKeyword = m.remove; var f = require("./compile/error_classes"); _.ValidationError = f.Validation, _.MissingRefError = f.MissingRef, _.$dataMetaSchema = h; var l = "http://json-schema.org/draft-06/schema", u = ["removeAdditional", "useDefaults", "coerceTypes"], p = ["/properties"]; function _(e) { if (!(this instanceof _)) return new _(e); e = this._opts = c.copy(e) || {}, G(this), this._schemas = {}, this._refs = {}, this._fragments = {}, this._formats = s(e.format); var t = this._schemaUriFormat = this._formats["uri-reference"]; this._schemaUriFormatFunc = function (e) { return t.test(e) }, this._cache = e.cache || new r, this._loadingSchemas = {}, this._compilations = [], this.RULES = o(), this._getId = R(e), e.loopRequired = e.loopRequired || 1 / 0, "property" == e.errorDataPath && (e._errorDataPathProperty = !0), void 0 === e.serialize && (e.serialize = i), this._metaOpts = T(this), e.formats && k(this), V(this), "object" == typeof e.meta && this.addMetaSchema(e.meta), P(this), e.patternGroups && n(this) } function v(e, t) { var r; if ("string" == typeof e) { if (!(r = this.getSchema(e))) throw new Error('no schema with key or ref "' + e + '"') } else { var a = this._addSchema(e); r = a.validate || this._compile(a) } var i = r(t); return !0 === r.$async ? "*" == this._opts.async ? d(i) : i : (this.errors = r.errors, i) } function g(e, t) { var r = this._addSchema(e, void 0, t); return r.validate || this._compile(r) } function y(e, r, a, i) { if (Array.isArray(e)) { for (var s = 0; s < e.length; s++)this.addSchema(e[s], void 0, a, i); return this } var o = this._getId(e); if (void 0 !== o && "string" != typeof o) throw new Error("schema id must be string"); return D(this, r = t.normalizeId(r || o)), this._schemas[r] = this._addSchema(e, a, i, !0), this } function w(e, t, r) { return this.addSchema(e, t, r, !0), this } function S(e, t) { var r = e.$schema; if (void 0 !== r && "string" != typeof r) throw new Error("$schema must be a string"); if (!(r = r || this._opts.defaultMeta || $(this))) return this.logger.warn("meta-schema not available"), this.errors = null, !0; var a, i = this._formats.uri; this._formats.uri = "function" == typeof i ? this._schemaUriFormatFunc : this._schemaUriFormat; try { a = this.validate(r, e) } finally { this._formats.uri = i } if (!a && t) { var s = "schema is invalid: " + this.errorsText(); if ("log" != this._opts.validateSchema) throw new Error(s); this.logger.error(s) } return a } function $(e) { var t = e._opts.meta; return e._opts.defaultMeta = "object" == typeof t ? e._getId(t) || t : e.getSchema(l) ? l : void 0, e._opts.defaultMeta } function q(e) { var t = j(this, e); switch (typeof t) { case "object": return t.validate || this._compile(t); case "string": return this.getSchema(t); case "undefined": return b(this, e) } } function b(r, i) { var s = t.schema.call(r, { schema: {} }, i); if (s) { var o = s.schema, h = s.root, n = s.baseId, c = e.call(r, o, h, void 0, n); return r._fragments[i] = new a({ ref: i, fragment: !0, schema: o, root: h, baseId: n, validate: c }), c } } function j(e, r) { return r = t.normalizeId(r), e._schemas[r] || e._refs[r] || e._fragments[r] } function E(e) { if (e instanceof RegExp) return I(this, this._schemas, e), I(this, this._refs, e), this; switch (typeof e) { case "undefined": return I(this, this._schemas), I(this, this._refs), this._cache.clear(), this; case "string": var r = j(this, e); return r && this._cache.del(r.cacheKey), delete this._schemas[e], delete this._refs[e], this; case "object": var a = this._opts.serialize, i = a ? a(e) : e; this._cache.del(i); var s = this._getId(e); s && (s = t.normalizeId(s), delete this._schemas[s], delete this._refs[s]) }return this } function I(e, t, r) { for (var a in t) { var i = t[a]; i.meta || r && !r.test(a) || (e._cache.del(i.cacheKey), delete t[a]) } } function M(e, r, i, s) { if ("object" != typeof e && "boolean" != typeof e) throw new Error("schema should be object or boolean"); var o = this._opts.serialize, h = o ? o(e) : e, n = this._cache.get(h); if (n) return n; s = s || !1 !== this._opts.addUsedSchema; var c = t.normalizeId(this._getId(e)); c && s && D(this, c); var d, m = !1 !== this._opts.validateSchema && !r; m && !(d = c && c == t.normalizeId(e.$schema)) && this.validateSchema(e, !0); var f = t.ids.call(this, e), l = new a({ id: c, schema: e, localRefs: f, cacheKey: h, meta: i }); return "#" != c[0] && s && (this._refs[c] = l), this._cache.put(h, l), m && d && this.validateSchema(e, !0), l } function z(t, r) { if (t.compiling) return t.validate = s, s.schema = t.schema, s.errors = null, s.root = r || s, !0 === t.schema.$async && (s.$async = !0), s; var a, i; t.compiling = !0, t.meta && (a = this._opts, this._opts = this._metaOpts); try { i = e.call(this, t.schema, r, t.localRefs) } finally { t.compiling = !1, t.meta && (this._opts = a) } return t.validate = i, t.refs = i.refs, t.refVal = i.refVal, t.root = i.root, i; function s() { var e = t.validate, r = e.apply(null, arguments); return s.errors = e.errors, r } } function R(e) { switch (e.schemaId) { case "$id": return x; case "id": return F; default: return A } } function F(e) { return e.$id && this.logger.warn("schema $id ignored", e.$id), e.id } function x(e) { return e.id && this.logger.warn("schema id ignored", e.id), e.$id } function A(e) { if (e.$id && e.id && e.$id != e.id) throw new Error("schema $id is different from id"); return e.$id || e.id } function K(e, t) { if (!(e = e || this.errors)) return "No errors"; for (var r = void 0 === (t = t || {}).separator ? ", " : t.separator, a = void 0 === t.dataVar ? "data" : t.dataVar, i = "", s = 0; s < e.length; s++) { var o = e[s]; o && (i += a + o.dataPath + " " + o.message + r) } return i.slice(0, -r.length) } function U(e, t) { return "string" == typeof t && (t = new RegExp(t)), this._formats[e] = t, this } function V(e) { var t; if (e._opts.$data && (t = require("./refs/$data.json"), e.addMetaSchema(t, t.$id, !0)), !1 !== e._opts.meta) { var r = require("./refs/json-schema-draft-06.json"); e._opts.$data && (r = h(r, p)), e.addMetaSchema(r, l, !0), e._refs["http://json-schema.org/schema"] = l } } function P(e) { var t = e._opts.schemas; if (t) if (Array.isArray(t)) e.addSchema(t); else for (var r in t) e.addSchema(t[r], r) } function k(e) { for (var t in e._opts.formats) { var r = e._opts.formats[t]; e.addFormat(t, r) } } function D(e, t) { if (e._schemas[t] || e._refs[t]) throw new Error('schema with key or id "' + t + '" already exists') } function T(e) { for (var t = c.copy(e._opts), r = 0; r < u.length; r++)delete t[u[r]]; return t } function G(e) { var t = e._opts.logger; if (!1 === t) e.logger = { log: O, warn: O, error: O }; else { if (void 0 === t && (t = console), !("object" == typeof t && t.log && t.warn && t.error)) throw new Error("logger must implement log, warn and error methods"); e.logger = t } } function O() { }
    }, { "./compile": "IFqB", "./compile/resolve": "FmMj", "./cache": "wSe+", "./compile/schema_obj": "h0OD", "fast-json-stable-stringify": "3Xb3", "./compile/formats": "SmGS", "./compile/rules": "e07p", "./$data": "6IZx", "./patternGroups": "zz8k", "./compile/util": "S6qf", "co": "z7cn", "./compile/async": "edJK", "./keyword": "f+FQ", "./compile/error_classes": "yAtQ", "./refs/$data.json": "PiVh", "./refs/json-schema-draft-06.json": "VXTn" }], "egcz": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var r = require("babel-runtime/helpers/defineProperty"), e = p(r), t = require("babel-runtime/helpers/extends"), a = p(t), n = require("babel-runtime/core-js/object/keys"), u = p(n), o = require("babel-runtime/core-js/get-iterator"), s = p(o); exports.toErrorList = _, exports.default = g; var i = require("lodash.topath"), l = p(i), d = require("ajv"), c = p(d), f = require("./utils"); function p(r) { return r && r.__esModule ? r : { default: r } } var b = new c.default({ errorDataPath: "property", allErrors: !0, multipleOfPrecision: 8 }); function v(r) { return r.length ? r.reduce(function (r, e) { var t = e.property, a = e.message, n = (0, l.default)(t), u = r; n.length > 0 && "" === n[0] && n.splice(0, 1); var o = !0, i = !1, d = void 0; try { for (var c, f = (0, s.default)(n.slice(0)); !(o = (c = f.next()).done); o = !0) { var p = c.value; p in u || (u[p] = {}), u = u[p] } } catch (b) { i = !0, d = b } finally { try { !o && f.return && f.return() } finally { if (i) throw d } } return Array.isArray(u.__errors) ? u.__errors = u.__errors.concat(a) : u.__errors = [a], r }, {}) : {} } function _(r) { var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "root", t = []; return "__errors" in r && (t = t.concat(r.__errors.map(function (r) { return { stack: e + ": " + r } }))), (0, u.default)(r).reduce(function (e, t) { return "__errors" !== t && (e = e.concat(_(r[t], t))), e }, t) } function m(r) { var t = { __errors: [], addError: function (r) { this.__errors.push(r) } }; return (0, f.isObject)(r) ? (0, u.default)(r).reduce(function (t, n) { return (0, a.default)({}, t, (0, e.default)({}, n, m(r[n]))) }, t) : Array.isArray(r) ? r.reduce(function (r, t, n) { return (0, a.default)({}, r, (0, e.default)({}, n, m(t))) }, t) : t } function y(r) { return (0, u.default)(r).reduce(function (t, n) { return "addError" === n ? t : "__errors" === n ? (0, a.default)({}, t, (0, e.default)({}, n, r[n])) : (0, a.default)({}, t, (0, e.default)({}, n, y(r[n]))) }, {}) } function h() { var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : []; return null === r ? [] : r.map(function (r) { var e = r.dataPath, t = r.keyword, a = r.message, n = "" + e; return { name: t, property: n, message: a, params: r.params, stack: (n + " " + a).trim() } }) } function g(r, e, t, a) { try { b.validate(e, r) } catch (i) { } var n = h(b.errors); "function" == typeof a && (n = a(n)); var u = v(n); if ("function" != typeof t) return { errors: n, errorSchema: u }; var o = y(t(r, m(r))), s = (0, f.mergeObjects)(u, o, !0); return { errors: _(s), errorSchema: s } } b.addFormat("data-url", /^data:([a-z]+\/[a-z0-9-+.]+)?;name=(.*);base64,(.*)$/), b.addFormat("color", /^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/);
    }, { "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/core-js/object/keys": "8FtN", "babel-runtime/core-js/get-iterator": "X9RM", "lodash.topath": "Oiy/", "ajv": "7PQk", "./utils": "X9H5" }], "25Eu": [function (require, module, exports) {
        "use strict"; var e = require("./_to-object"), t = require("./_to-absolute-index"), r = require("./_to-length"); module.exports = function (o) { for (var i = e(this), u = r(i.length), n = arguments.length, d = t(n > 1 ? arguments[1] : void 0, u), l = n > 2 ? arguments[2] : void 0, s = void 0 === l ? u : t(l, u); s > d;)i[d++] = o; return i };
    }, { "./_to-object": "mbLO", "./_to-absolute-index": "Zwq5", "./_to-length": "S7IM" }], "DgdK": [function (require, module, exports) {
        var r = require("./_export"); r(r.P, "Array", { fill: require("./_array-fill") }), require("./_add-to-unscopables")("fill");
    }, { "./_export": "vSO4", "./_array-fill": "25Eu", "./_add-to-unscopables": "ID6i" }], "3bsB": [function (require, module, exports) {
        require("../../modules/es6.array.fill"), module.exports = require("../../modules/_core").Array.fill;
    }, { "../../modules/es6.array.fill": "DgdK", "../../modules/_core": "zKeE" }], "GnPB": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), t = n(e), r = require("babel-runtime/helpers/objectWithoutProperties"), a = n(r); exports.default = s; var u = require("react"), l = n(u); function n(e) { return e && e.__esModule ? e : { default: e } } function s(e) { var r = e.type, u = void 0 === r ? "default" : r, n = e.icon, s = e.className, i = (0, a.default)(e, ["type", "icon", "className"]); return l.default.createElement("button", (0, t.default)({ type: "button", className: "btn btn-" + u + " " + s }, i), l.default.createElement("i", { className: "glyphicon glyphicon-" + n })) }
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "react": "1n8/" }], "Bmte": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = s; var e = require("react"), t = r(e), a = require("./IconButton"), l = r(a); function r(e) { return e && e.__esModule ? e : { default: e } } function s(e) { var a = e.className, r = e.onClick, s = e.disabled; return t.default.createElement("div", { className: "row" }, t.default.createElement("p", { className: "col-xs-3 col-xs-offset-9 text-right " + a }, t.default.createElement(l.default, { type: "info", icon: "plus", className: "btn-add col-xs-12", tabIndex: "0", onClick: r, disabled: s }))) }
    }, { "react": "1n8/", "./IconButton": "GnPB" }], "kiG+": [function (require, module, exports) {
        "use strict"; var r = require("./_export"), e = require("./_array-includes")(!0); r(r.P, "Array", { includes: function (r) { return e(this, r, arguments.length > 1 ? arguments[1] : void 0) } }), require("./_add-to-unscopables")("includes");
    }, { "./_export": "vSO4", "./_array-includes": "LNnS", "./_add-to-unscopables": "ID6i" }], "GRz4": [function (require, module, exports) {
        require("../../modules/es7.array.includes"), module.exports = require("../../modules/_core").Array.includes;
    }, { "../../modules/es7.array.includes": "kiG+", "../../modules/_core": "zKeE" }], "Q17y": [function (require, module, exports) {
        var r = require("../../modules/_core"), i = r.JSON || (r.JSON = { stringify: JSON.stringify }); module.exports = function (r) { return i.stringify.apply(i, arguments) };
    }, { "../../modules/_core": "zKeE" }], "HxWs": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/json/stringify"), __esModule: !0 };
    }, { "core-js/library/fn/json/stringify": "Q17y" }], "HtJA": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/core-js/json/stringify"), t = n(e), l = require("react"), r = n(l), u = require("prop-types"), a = n(u); function n(e) { return e && e.__esModule ? e : { default: e } } function d(e) { var l = e.schema, u = e.idSchema, a = e.reason; return r.default.createElement("div", { className: "unsupported-field" }, r.default.createElement("p", null, "Unsupported field schema", u && u.$id && r.default.createElement("span", null, " for", " field ", r.default.createElement("code", null, u.$id)), a && r.default.createElement("em", null, ": ", a), "."), l && r.default.createElement("pre", null, (0, t.default)(l, null, 2))) } exports.default = d;
    }, { "babel-runtime/core-js/json/stringify": "HxWs", "react": "1n8/", "prop-types": "5D9O" }], "FXn0": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/core-js/object/keys"), r = R(e), t = require("babel-runtime/helpers/objectWithoutProperties"), i = R(t), a = require("babel-runtime/helpers/defineProperty"), o = R(a), n = require("babel-runtime/helpers/extends"), d = R(n), l = require("babel-runtime/helpers/toConsumableArray"), s = R(l), c = require("babel-runtime/core-js/object/get-prototype-of"), m = R(c), u = require("babel-runtime/helpers/classCallCheck"), h = R(u), f = require("babel-runtime/helpers/createClass"), p = R(f), v = require("babel-runtime/helpers/possibleConstructorReturn"), y = R(v), S = require("babel-runtime/helpers/inherits"), g = R(S), b = require("../AddButton"), C = R(b), D = require("../IconButton"), x = R(D), F = require("react"), E = R(F), k = require("prop-types"), w = R(k), I = require("core-js/library/fn/array/includes"), A = R(I), q = require("./UnsupportedField"), N = R(q), M = require("../../utils"); function R(e) { return e && e.__esModule ? e : { default: e } } function U(e) { var r = e.TitleField, t = e.idSchema, i = e.title, a = e.required; if (!i) return E.default.createElement("div", null); var o = t.$id + "__title"; return E.default.createElement(r, { id: o, title: i, required: a }) } function T(e) { var r = e.DescriptionField, t = e.idSchema, i = e.description; if (!i) return E.default.createElement("div", null); var a = t.$id + "__description"; return E.default.createElement(r, { id: a, description: i }) } function _(e) { var r = { flex: 1, paddingLeft: 6, paddingRight: 6, fontWeight: "bold" }; return E.default.createElement("div", { key: e.index, className: e.className }, E.default.createElement("div", { className: e.hasToolbar ? "col-xs-9" : "col-xs-12" }, e.children), e.hasToolbar && E.default.createElement("div", { className: "col-xs-3 array-item-toolbox" }, E.default.createElement("div", { className: "btn-group", style: { display: "flex", justifyContent: "space-around" } }, (e.hasMoveUp || e.hasMoveDown) && E.default.createElement(x.default, { icon: "arrow-up", className: "array-item-move-up", tabIndex: "-1", style: r, disabled: e.disabled || e.readonly || !e.hasMoveUp, onClick: e.onReorderClick(e.index, e.index - 1) }), (e.hasMoveUp || e.hasMoveDown) && E.default.createElement(x.default, { icon: "arrow-down", className: "array-item-move-down", tabIndex: "-1", style: r, disabled: e.disabled || e.readonly || !e.hasMoveDown, onClick: e.onReorderClick(e.index, e.index + 1) }), e.hasRemove && E.default.createElement(x.default, { type: "danger", icon: "remove", className: "array-item-remove", tabIndex: "-1", style: r, disabled: e.disabled || e.readonly, onClick: e.onDropIndexClick(e.index) })))) } function B(e) { return E.default.createElement("fieldset", { className: e.className }, E.default.createElement(U, { key: "array-field-title-" + e.idSchema.$id, TitleField: e.TitleField, idSchema: e.idSchema, title: e.uiSchema["ui:title"] || e.title, required: e.required }), (e.uiSchema["ui:description"] || e.schema.description) && E.default.createElement("div", { className: "field-description", key: "field-description-" + e.idSchema.$id }, e.uiSchema["ui:description"] || e.schema.description), E.default.createElement("div", { className: "row array-item-list", key: "array-item-list-" + e.idSchema.$id }, e.items && e.items.map(_)), e.canAdd && E.default.createElement(C.default, { className: "array-item-add", onClick: e.onAddClick, disabled: e.disabled || e.readonly })) } function $(e) { return E.default.createElement("fieldset", { className: e.className }, E.default.createElement(U, { key: "array-field-title-" + e.idSchema.$id, TitleField: e.TitleField, idSchema: e.idSchema, title: e.uiSchema["ui:title"] || e.title, required: e.required }), (e.uiSchema["ui:description"] || e.schema.description) && E.default.createElement(T, { key: "array-field-description-" + e.idSchema.$id, DescriptionField: e.DescriptionField, idSchema: e.idSchema, description: e.uiSchema["ui:description"] || e.schema.description }), E.default.createElement("div", { className: "row array-item-list", key: "array-item-list-" + e.idSchema.$id }, e.items && e.items.map(function (e) { return _(e) })), e.canAdd && E.default.createElement(C.default, { className: "array-item-add", onClick: e.onAddClick, disabled: e.disabled || e.readonly })) } var j = function (e) { function t() { var e, r, i, a; (0, h.default)(this, t); for (var n = arguments.length, l = Array(n), c = 0; c < n; c++)l[c] = arguments[c]; return r = i = (0, y.default)(this, (e = t.__proto__ || (0, m.default)(t)).call.apply(e, [this].concat(l))), i.onAddClick = function (e) { e.preventDefault(); var r = i.props, t = r.schema, a = r.formData, o = r.registry, n = (void 0 === o ? (0, M.getDefaultRegistry)() : o).definitions, d = t.items; (0, M.isFixedItems)(t) && (0, M.allowAdditionalItems)(t) && (d = t.additionalItems), i.props.onChange([].concat((0, s.default)(a), [(0, M.getDefaultFormState)(d, void 0, n)])) }, i.onDropIndexClick = function (e) { return function (r) { r && r.preventDefault(); var t = i.props, a = t.formData, o = t.onChange, n = void 0; if (i.props.errorSchema) { n = {}; var d = i.props.errorSchema; for (var l in d) (l = parseInt(l)) < e ? n[l] = d[l] : l > e && (n[l - 1] = d[l]) } o(a.filter(function (r, t) { return t !== e }), n) } }, i.onReorderClick = function (e, r) { return function (t) { t && (t.preventDefault(), t.target.blur()); var a = i.props, o = a.formData, n = a.onChange, d = void 0; if (i.props.errorSchema) { d = {}; var l = i.props.errorSchema; for (var s in l) s == e ? d[r] = l[e] : s == r ? d[e] = l[r] : d[s] = l[s] } n(o.map(function (t, i) { return i == r ? o[e] : i == e ? o[r] : t }), d) } }, i.onChangeForIndex = function (e) { return function (r, t) { var a = i.props, n = a.formData; (0, a.onChange)(n.map(function (t, i) { return e === i ? void 0 === r ? null : r : t }), t && i.props.errorSchema && (0, d.default)({}, i.props.errorSchema, (0, o.default)({}, e, t))) } }, i.onSelectChange = function (e) { i.props.onChange(e) }, a = r, (0, y.default)(i, a) } return (0, g.default)(t, e), (0, p.default)(t, [{ key: "isItemRequired", value: function (e) { return Array.isArray(e.type) ? !(0, A.default)(e.type, "null") : "null" !== e.type } }, { key: "canAddItem", value: function (e) { var r = this.props, t = r.schema, i = r.uiSchema, a = (0, M.getUiOptions)(i).addable; return !1 !== a && (a = void 0 === t.maxItems || e.length < t.maxItems), a } }, { key: "render", value: function () { var e = this.props, r = e.schema, t = e.uiSchema, i = e.idSchema, a = e.registry, o = (void 0 === a ? (0, M.getDefaultRegistry)() : a).definitions; return r.hasOwnProperty("items") ? (0, M.isFixedItems)(r) ? this.renderFixedArray() : (0, M.isFilesArray)(r, t, o) ? this.renderFiles() : (0, M.isMultiSelect)(r, o) ? this.renderMultiSelect() : this.renderNormalArray() : E.default.createElement(N.default, { schema: r, idSchema: i, reason: "Missing items definition" }) } }, { key: "renderNormalArray", value: function () { var e = this, r = this.props, t = r.schema, i = r.uiSchema, a = r.formData, o = r.errorSchema, n = r.idSchema, d = r.name, l = r.required, s = r.disabled, c = r.readonly, m = r.autofocus, u = r.registry, h = void 0 === u ? (0, M.getDefaultRegistry)() : u, f = r.onBlur, p = r.onFocus, v = r.idPrefix, y = r.rawErrors, S = void 0 === t.title ? d : t.title, g = h.ArrayFieldTemplate, b = h.definitions, C = h.fields, D = h.formContext, x = C.TitleField, F = C.DescriptionField, k = (0, M.retrieveSchema)(t.items, b), w = { canAdd: this.canAddItem(a), items: a.map(function (r, d) { var l = (0, M.retrieveSchema)(t.items, b, r), s = o ? o[d] : void 0, c = n.$id + "_" + d, u = (0, M.toIdSchema)(l, c, b, r, v); return e.renderArrayFieldItem({ index: d, canMoveUp: d > 0, canMoveDown: d < a.length - 1, itemSchema: l, itemIdSchema: u, itemErrorSchema: s, itemData: r, itemUiSchema: i.items, autofocus: m && 0 === d, onBlur: f, onFocus: p }) }), className: "field field-array field-array-of-" + k.type, DescriptionField: F, disabled: s, idSchema: n, uiSchema: i, onAddClick: this.onAddClick, readonly: c, required: l, schema: t, title: S, TitleField: x, formContext: D, formData: a, rawErrors: y }, I = g || $; return E.default.createElement(I, w) } }, { key: "renderMultiSelect", value: function () { var e = this.props, r = e.schema, t = e.idSchema, a = e.uiSchema, o = e.formData, n = e.disabled, l = e.readonly, s = e.autofocus, c = e.onBlur, m = e.onFocus, u = e.registry, h = void 0 === u ? (0, M.getDefaultRegistry)() : u, f = e.rawErrors, p = this.props.formData, v = h.widgets, y = h.definitions, S = h.formContext, g = (0, M.retrieveSchema)(r.items, y, o), b = (0, M.optionsList)(g), C = (0, d.default)({}, (0, M.getUiOptions)(a), { enumOptions: b }), D = C.widget, x = void 0 === D ? "select" : D, F = (0, i.default)(C, ["widget"]), k = (0, M.getWidget)(r, x, v); return E.default.createElement(k, { id: t && t.$id, multiple: !0, onChange: this.onSelectChange, onBlur: c, onFocus: m, options: F, schema: r, value: p, disabled: n, readonly: l, formContext: S, autofocus: s, rawErrors: f }) } }, { key: "renderFiles", value: function () { var e = this.props, r = e.schema, t = e.uiSchema, a = e.idSchema, o = e.name, n = e.disabled, d = e.readonly, l = e.autofocus, s = e.onBlur, c = e.onFocus, m = e.registry, u = void 0 === m ? (0, M.getDefaultRegistry)() : m, h = e.rawErrors, f = r.title || o, p = this.props.formData, v = u.widgets, y = u.formContext, S = (0, M.getUiOptions)(t), g = S.widget, b = void 0 === g ? "files" : g, C = (0, i.default)(S, ["widget"]), D = (0, M.getWidget)(r, b, v); return E.default.createElement(D, { options: C, id: a && a.$id, multiple: !0, onChange: this.onSelectChange, onBlur: s, onFocus: c, schema: r, title: f, value: p, disabled: n, readonly: d, formContext: y, autofocus: l, rawErrors: h }) } }, { key: "renderFixedArray", value: function () { var e = this, r = this.props, t = r.schema, i = r.uiSchema, a = r.formData, o = r.errorSchema, n = r.idPrefix, d = r.idSchema, l = r.name, s = r.required, c = r.disabled, m = r.readonly, u = r.autofocus, h = r.registry, f = void 0 === h ? (0, M.getDefaultRegistry)() : h, p = r.onBlur, v = r.onFocus, y = r.rawErrors, S = t.title || l, g = this.props.formData, b = f.ArrayFieldTemplate, C = f.definitions, D = f.fields, x = f.formContext, F = D.TitleField, k = t.items.map(function (e, r) { return (0, M.retrieveSchema)(e, C, a[r]) }), w = (0, M.allowAdditionalItems)(t) ? (0, M.retrieveSchema)(t.additionalItems, C, a) : null; (!g || g.length < k.length) && (g = (g = g || []).concat(new Array(k.length - g.length))); var I = { canAdd: this.canAddItem(g) && w, className: "field field-array field-array-fixed-items", disabled: c, idSchema: d, formData: a, items: g.map(function (r, a) { var l = a >= k.length, s = l ? (0, M.retrieveSchema)(t.additionalItems, C, r) : k[a], c = d.$id + "_" + a, m = (0, M.toIdSchema)(s, c, C, r, n), h = l ? i.additionalItems || {} : Array.isArray(i.items) ? i.items[a] : i.items || {}, f = o ? o[a] : void 0; return e.renderArrayFieldItem({ index: a, canRemove: l, canMoveUp: a >= k.length + 1, canMoveDown: l && a < g.length - 1, itemSchema: s, itemData: r, itemUiSchema: h, itemIdSchema: m, itemErrorSchema: f, autofocus: u && 0 === a, onBlur: p, onFocus: v }) }), onAddClick: this.onAddClick, readonly: m, required: s, schema: t, uiSchema: i, title: S, TitleField: F, formContext: x, rawErrors: y }, A = b || B; return E.default.createElement(A, I) } }, { key: "renderArrayFieldItem", value: function (e) { var t = e.index, i = e.canRemove, a = void 0 === i || i, o = e.canMoveUp, n = void 0 === o || o, l = e.canMoveDown, s = void 0 === l || l, c = e.itemSchema, m = e.itemData, u = e.itemUiSchema, h = e.itemIdSchema, f = e.itemErrorSchema, p = e.autofocus, v = e.onBlur, y = e.onFocus, S = e.rawErrors, g = this.props, b = g.disabled, C = g.readonly, D = g.uiSchema, x = g.registry, F = (void 0 === x ? (0, M.getDefaultRegistry)() : x).fields.SchemaField, k = (0, d.default)({ orderable: !0, removable: !0 }, D["ui:options"]), w = k.orderable, I = { moveUp: w && n, moveDown: w && s, remove: k.removable && a }; return I.toolbar = (0, r.default)(I).some(function (e) { return I[e] }), { children: E.default.createElement(F, { schema: c, uiSchema: u, formData: m, errorSchema: f, idSchema: h, required: this.isItemRequired(c), onChange: this.onChangeForIndex(t), onBlur: v, onFocus: y, registry: this.props.registry, disabled: this.props.disabled, readonly: this.props.readonly, autofocus: p, rawErrors: S }), className: "array-item", disabled: b, hasToolbar: I.toolbar, hasMoveUp: I.moveUp, hasMoveDown: I.moveDown, hasRemove: I.remove, index: t, onDropIndexClick: this.onDropIndexClick, onReorderClick: this.onReorderClick, readonly: C } } }, { key: "itemTitle", get: function () { var e = this.props.schema; return e.items.title || e.items.description || "Item" } }]), t }(F.Component); j.defaultProps = { uiSchema: {}, formData: [], idSchema: {}, required: !1, disabled: !1, readonly: !1, autofocus: !1 }, exports.default = j;
    }, { "babel-runtime/core-js/object/keys": "8FtN", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/toConsumableArray": "mYpx", "babel-runtime/core-js/object/get-prototype-of": "BX4+", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "../AddButton": "Bmte", "../IconButton": "GnPB", "react": "1n8/", "prop-types": "5D9O", "core-js/library/fn/array/includes": "GRz4", "./UnsupportedField": "HtJA", "../../utils": "X9H5" }], "LI3H": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = d(e), t = require("babel-runtime/helpers/objectWithoutProperties"), o = d(t), u = require("react"), i = d(u), a = require("prop-types"), s = d(a), n = require("../../utils"); function d(e) { return e && e.__esModule ? e : { default: e } } function l(e) { var t = e.schema, u = e.name, a = e.uiSchema, s = e.idSchema, d = e.formData, l = e.registry, c = void 0 === l ? (0, n.getDefaultRegistry)() : l, m = e.required, f = e.disabled, p = e.readonly, g = e.autofocus, b = e.onChange, h = e.onFocus, y = e.onBlur, q = e.rawErrors, v = t.title, x = c.widgets, w = c.formContext, C = (0, n.getUiOptions)(a), _ = C.widget, E = void 0 === _ ? "checkbox" : _, O = (0, o.default)(C, ["widget"]), P = (0, n.getWidget)(t, E, x), S = (0, n.optionsList)({ enum: [!0, !1], enumNames: t.enumNames || ["yes", "no"] }); return i.default.createElement(P, { options: (0, r.default)({}, O, { enumOptions: S }), schema: t, id: s && s.$id, onChange: b, onFocus: h, onBlur: y, label: void 0 === v ? u : v, value: d, required: m, disabled: f, readonly: p, registry: c, formContext: w, autofocus: g, rawErrors: q }) } l.defaultProps = { uiSchema: {}, disabled: !1, readonly: !1, autofocus: !1 }, exports.default = l;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "wEOU": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("react"), t = d(e), r = require("prop-types"), i = d(r); function d(e) { return e && e.__esModule ? e : { default: e } } function l(e) { var r = e.id, i = e.description; return i ? "string" == typeof i ? t.default.createElement("p", { id: r, className: "field-description" }, i) : t.default.createElement("div", { id: r, className: "field-description" }, i) : t.default.createElement("div", null) } exports.default = l;
    }, { "react": "1n8/", "prop-types": "5D9O" }], "o5cW": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = l(e), t = require("react"), u = l(t), n = require("prop-types"), i = l(n), a = require("../../utils"); function l(e) { return e && e.__esModule ? e : { default: e } } function s(e) { var t = e.registry.fields.StringField; return u.default.createElement(t, (0, r.default)({}, e, { onChange: function (r) { return e.onChange((0, a.asNumber)(r)) } })) } s.defaultProps = { uiSchema: {} }, exports.default = s;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "r4Xl": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/core-js/json/stringify"), r = P(e), t = require("babel-runtime/helpers/defineProperty"), a = P(t), i = require("babel-runtime/helpers/extends"), n = P(i), o = require("babel-runtime/core-js/object/get-prototype-of"), l = P(o), u = require("babel-runtime/helpers/classCallCheck"), d = P(u), s = require("babel-runtime/helpers/createClass"), c = P(s), p = require("babel-runtime/helpers/possibleConstructorReturn"), f = P(p), m = require("babel-runtime/helpers/inherits"), h = P(m), b = require("babel-runtime/core-js/object/keys"), y = P(b), v = require("../AddButton"), g = P(v), C = require("react"), q = P(C), S = require("prop-types"), x = P(S), D = require("../../utils"); function P(e) { return e && e.__esModule ? e : { default: e } } function _(e) { var r = e.TitleField, t = e.DescriptionField; return q.default.createElement("fieldset", null, (e.uiSchema["ui:title"] || e.title) && q.default.createElement(r, { id: e.idSchema.$id + "__title", title: e.title || e.uiSchema["ui:title"], required: e.required, formContext: e.formContext }), e.description && q.default.createElement(t, { id: e.idSchema.$id + "__description", description: e.description, formContext: e.formContext }), e.properties.map(function (e) { return e.content }), function () { var r = e.formData, t = e.schema, a = e.uiSchema; if (!t.additionalProperties) return !1; var i = (0, D.getUiOptions)(a).expandable; return !1 === i ? i : void 0 === t.maxProperties || (0, y.default)(r).length < t.maxProperties }() && q.default.createElement(g.default, { className: "object-property-expand", onClick: e.onAddClick(e.schema), disabled: e.disabled || e.readonly })) } var j = function (e) { function t() { var e, r, i, o; (0, d.default)(this, t); for (var u = arguments.length, s = Array(u), c = 0; c < u; c++)s[c] = arguments[c]; return r = i = (0, f.default)(this, (e = t.__proto__ || (0, l.default)(t)).call.apply(e, [this].concat(s))), i.state = { additionalProperties: {} }, i.onPropertyChange = function (e) { return function (r, t) { var o = (0, n.default)({}, i.props.formData, (0, a.default)({}, e, r)); i.props.onChange(o, t && i.props.errorSchema && (0, n.default)({}, i.props.errorSchema, (0, a.default)({}, e, t))) } }, i.getAvailableKey = function (e, r) { for (var t = 0, a = e; i.props.formData.hasOwnProperty(a);)a = e + "-" + ++t; return a }, i.onKeyChange = function (e) { return function (r, t) { r = i.getAvailableKey(r, i.props.formData); var o = (0, n.default)({}, i.props.formData), l = o[e]; delete o[e], o[r] = l, i.props.onChange(o, t && i.props.errorSchema && (0, n.default)({}, i.props.errorSchema, (0, a.default)({}, r, t))) } }, i.handleAddClick = function (e) { return function () { var r = e.additionalProperties.type, t = (0, n.default)({}, i.props.formData); t[i.getAvailableKey("newKey", t)] = i.getDefaultValue(r), i.props.onChange(t) } }, o = r, (0, f.default)(i, o) } return (0, h.default)(t, e), (0, c.default)(t, [{ key: "isRequired", value: function (e) { var r = this.props.schema; return Array.isArray(r.required) && -1 !== r.required.indexOf(e) } }, { key: "getDefaultValue", value: function (e) { switch (e) { case "string": return "New Value"; case "array": return []; case "boolean": return !1; case "null": return null; case "number": return 0; case "object": return {}; default: return "New Value" } } }, { key: "render", value: function () { var e = this, t = this.props, a = t.uiSchema, i = t.formData, o = t.errorSchema, l = t.idSchema, u = t.name, d = t.required, s = t.disabled, c = t.readonly, p = t.idPrefix, f = t.onBlur, m = t.onFocus, h = t.registry, b = void 0 === h ? (0, D.getDefaultRegistry)() : h, v = b.definitions, g = b.fields, C = b.formContext, S = g.SchemaField, x = g.TitleField, P = g.DescriptionField, j = (0, D.retrieveSchema)(this.props.schema, v, i), k = void 0 === j.title ? u : j.title, A = a["ui:description"] || j.description, E = void 0; try { var F = (0, y.default)(j.properties); E = (0, D.orderProperties)(F, a["ui:order"]) } catch (O) { return q.default.createElement("div", null, q.default.createElement("p", { className: "config-error", style: { color: "red" } }, "Invalid ", u || "root", " object field configuration:", q.default.createElement("em", null, O.message), "."), q.default.createElement("pre", null, (0, r.default)(j))) } var K = b.ObjectFieldTemplate || _, w = { title: a["ui:title"] || k, description: A, TitleField: x, DescriptionField: P, properties: E.map(function (r) { return { content: q.default.createElement(S, { key: r, name: r, required: e.isRequired(r), schema: j.properties[r], uiSchema: a[r], errorSchema: o[r], idSchema: l[r], idPrefix: p, formData: i[r], onKeyChange: e.onKeyChange(r), onChange: e.onPropertyChange(r), onBlur: f, onFocus: m, registry: b, disabled: s, readonly: c }), name: r, readonly: c, disabled: s, required: d } }), required: d, idSchema: l, uiSchema: a, schema: j, formData: i, formContext: C }; return q.default.createElement(K, (0, n.default)({}, w, { onAddClick: this.handleAddClick })) } }]), t }(C.Component); j.defaultProps = { uiSchema: {}, formData: {}, errorSchema: {}, idSchema: {}, required: !1, disabled: !1, readonly: !1 }, exports.default = j;
    }, { "babel-runtime/core-js/json/stringify": "HxWs", "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/core-js/object/get-prototype-of": "BX4+", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "babel-runtime/core-js/object/keys": "8FtN", "../AddButton": "Bmte", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "i3Qf": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/core-js/object/get-prototype-of"), r = N(e), t = require("babel-runtime/helpers/classCallCheck"), a = N(t), l = require("babel-runtime/helpers/createClass"), i = N(l), n = require("babel-runtime/helpers/possibleConstructorReturn"), u = N(n), d = require("babel-runtime/helpers/inherits"), o = N(d), s = require("babel-runtime/helpers/extends"), c = N(s), f = require("babel-runtime/helpers/objectWithoutProperties"), m = N(f), p = require("babel-runtime/core-js/object/keys"), h = N(p), b = require("../../utils"), y = require("react"), v = N(y), g = require("prop-types"), E = N(g), q = require("./UnsupportedField"), S = N(q); function N(e) { return e && e.__esModule ? e : { default: e } } var _ = "*", C = { array: "ArrayField", boolean: "BooleanField", integer: "NumberField", number: "NumberField", object: "ObjectField", string: "StringField" }; function F(e, r, t, a) { var l = r["ui:field"]; if ("function" == typeof l) return l; if ("string" == typeof l && l in a) return a[l]; var i = C[(0, b.getSchemaType)(e)]; return i in a ? a[i] : function () { return v.default.createElement(S.default, { schema: e, idSchema: t, reason: "Unknown field type " + e.type }) } } function j(e) { var r = e.label, t = e.required, a = e.id; return r ? v.default.createElement("label", { className: "control-label", htmlFor: a }, r, t && v.default.createElement("span", { className: "required" }, _)) : v.default.createElement("div", null) } function k(e) { var r = e.id, t = e.label, a = e.onChange; return v.default.createElement("input", { className: "form-control", type: "text", id: r, onBlur: function (e) { return a(e.target.value) }, defaultValue: t }) } function x(e) { var r = e.help; return r ? "string" == typeof r ? v.default.createElement("p", { className: "help-block" }, r) : v.default.createElement("div", { className: "help-block" }, r) : v.default.createElement("div", null) } function w(e) { var r = e.errors, t = void 0 === r ? [] : r; return 0 === t.length ? v.default.createElement("div", null) : v.default.createElement("div", null, v.default.createElement("p", null), v.default.createElement("ul", { className: "error-detail bs-callout bs-callout-info" }, t.map(function (e, r) { return v.default.createElement("li", { className: "text-danger", key: r }, e) }))) } function P(e) { var r = e.id, t = e.classNames, a = e.label, l = e.children, i = e.errors, n = e.help, u = e.description, d = e.hidden, o = e.required, s = e.displayLabel, c = e.onKeyChange; if (d) return l; var f = e.schema.hasOwnProperty(b.ADDITIONAL_PROPERTY_FLAG), m = a + " Key"; return v.default.createElement("div", { className: t }, f && v.default.createElement("div", { className: "form-group" }, v.default.createElement(j, { label: m, required: o, id: r + "-key" }), v.default.createElement(k, { label: a, required: o, id: r + "-key", onChange: c })), s && v.default.createElement(j, { label: a, required: o, id: r }), s && u ? u : null, l, i, n) } function O(e) { var r = e.uiSchema, t = e.formData, a = e.errorSchema, l = e.idPrefix, i = e.name, n = e.onKeyChange, u = e.required, d = e.registry, o = void 0 === d ? (0, b.getDefaultRegistry)() : d, s = o.definitions, f = o.fields, p = o.formContext, y = o.FieldTemplate, g = void 0 === y ? P : y, E = e.idSchema, q = (0, b.retrieveSchema)(e.schema, s, t), S = F(q, r, E = (0, b.mergeObjects)((0, b.toIdSchema)(q, null, s, t, l), E), f), N = f.DescriptionField, _ = Boolean(e.disabled || r["ui:disabled"]), C = Boolean(e.readonly || r["ui:readonly"]), j = Boolean(e.autofocus || r["ui:autofocus"]); if (0 === (0, h.default)(q).length) return v.default.createElement("div", null); var k = (0, b.getUiOptions)(r).label, O = void 0 === k || k; "array" === q.type && (O = (0, b.isMultiSelect)(q, s) || (0, b.isFilesArray)(q, r, s)), "object" === q.type && (O = !1), "boolean" !== q.type || r["ui:widget"] || (O = !1), r["ui:field"] && (O = !1); var D = a.__errors, A = (0, m.default)(a, ["__errors"]), B = v.default.createElement(S, (0, c.default)({}, e, { idSchema: E, schema: q, uiSchema: (0, c.default)({}, r, { classNames: void 0 }), disabled: _, readonly: C, autofocus: j, errorSchema: A, formContext: p, rawErrors: D })), L = q.type, K = E.$id, R = r["ui:title"] || e.schema.title || q.title || i, T = r["ui:description"] || e.schema.description || q.description, U = D, I = r["ui:help"], M = "hidden" === r["ui:widget"], G = ["form-group", "field", "field-" + L, U && U.length > 0 ? "field-error has-error has-danger" : "", r.classNames].join(" ").trim(), H = { description: v.default.createElement(N, { id: K + "__description", description: T, formContext: p }), rawDescription: T, help: v.default.createElement(x, { help: I }), rawHelp: "string" == typeof I ? I : void 0, errors: v.default.createElement(w, { errors: U }), rawErrors: U, id: K, label: R, hidden: M, onKeyChange: n, required: u, disabled: _, readonly: C, displayLabel: O, classNames: G, formContext: p, fields: f, schema: q, uiSchema: r }; return v.default.createElement(g, H, B) } P.defaultProps = { hidden: !1, readonly: !1, required: !1, displayLabel: !0 }; var D = function (e) { function t() { return (0, a.default)(this, t), (0, u.default)(this, (t.__proto__ || (0, r.default)(t)).apply(this, arguments)) } return (0, o.default)(t, e), (0, i.default)(t, [{ key: "shouldComponentUpdate", value: function (e, r) { return !(0, b.deepEquals)((0, c.default)({}, this.props, { idSchema: void 0 }), (0, c.default)({}, e, { idSchema: void 0 })) } }, { key: "render", value: function () { return O(this.props) } }]), t }(v.default.Component); D.defaultProps = { uiSchema: {}, errorSchema: {}, idSchema: {}, disabled: !1, readonly: !1, autofocus: !1 }, exports.default = D;
    }, { "babel-runtime/core-js/object/get-prototype-of": "BX4+", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/core-js/object/keys": "8FtN", "../../utils": "X9H5", "react": "1n8/", "prop-types": "5D9O", "./UnsupportedField": "HtJA" }], "sd2H": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = d(e), t = require("babel-runtime/helpers/objectWithoutProperties"), o = d(t), i = require("react"), a = d(i), u = require("prop-types"), l = d(u), s = require("../../utils"); function d(e) { return e && e.__esModule ? e : { default: e } } function n(e) { var t = e.schema, i = e.name, u = e.uiSchema, l = e.idSchema, d = e.formData, n = e.required, c = e.disabled, f = e.readonly, p = e.autofocus, m = e.onChange, h = e.onBlur, g = e.onFocus, b = e.registry, v = void 0 === b ? (0, s.getDefaultRegistry)() : b, y = e.rawErrors, q = t.title, x = t.format, w = v.widgets, C = v.formContext, S = (0, s.isSelect)(t) && (0, s.optionsList)(t), _ = x || (S ? "select" : "text"), E = (0, s.getUiOptions)(u), O = E.widget, P = void 0 === O ? _ : O, j = E.placeholder, B = void 0 === j ? "" : j, D = (0, o.default)(E, ["widget", "placeholder"]), F = (0, s.getWidget)(t, P, w); return a.default.createElement(F, { options: (0, r.default)({}, D, { enumOptions: S }), schema: t, id: l && l.$id, label: void 0 === q ? i : q, value: d, onChange: m, onBlur: h, onFocus: g, required: n, disabled: c, readonly: f, formContext: C, autofocus: p, registry: v, placeholder: B, rawErrors: y }) } n.defaultProps = { uiSchema: {}, disabled: !1, readonly: !1, autofocus: !1 }, exports.default = n;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "2lWX": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("react"), r = a(e), t = require("prop-types"), u = a(t); function a(e) { return e && e.__esModule ? e : { default: e } } var d = "*"; function l(e) { var t = e.id, u = e.title, a = e.required; return r.default.createElement("legend", { id: t }, u, a && r.default.createElement("span", { className: "required" }, d)) } exports.default = l;
    }, { "react": "1n8/", "prop-types": "5D9O" }], "pHVB": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("./ArrayField"), i = S(e), r = require("./BooleanField"), l = S(r), d = require("./DescriptionField"), u = S(d), t = require("./NumberField"), a = S(t), F = require("./ObjectField"), o = S(F), f = require("./SchemaField"), n = S(f), s = require("./StringField"), c = S(s), p = require("./TitleField"), q = S(p), b = require("./UnsupportedField"), m = S(b); function S(e) { return e && e.__esModule ? e : { default: e } } exports.default = { ArrayField: i.default, BooleanField: l.default, DescriptionField: u.default, NumberField: a.default, ObjectField: o.default, SchemaField: n.default, StringField: c.default, TitleField: q.default, UnsupportedField: m.default };
    }, { "./ArrayField": "FXn0", "./BooleanField": "LI3H", "./DescriptionField": "wEOU", "./NumberField": "o5cW", "./ObjectField": "r4Xl", "./SchemaField": "i3Qf", "./StringField": "sd2H", "./TitleField": "2lWX", "./UnsupportedField": "HtJA" }], "Vx1N": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), t = S(e), r = require("babel-runtime/helpers/defineProperty"), n = S(r), a = require("babel-runtime/core-js/object/get-prototype-of"), l = S(a), u = require("babel-runtime/helpers/classCallCheck"), o = S(u), i = require("babel-runtime/helpers/createClass"), s = S(i), d = require("babel-runtime/helpers/possibleConstructorReturn"), c = S(d), p = require("babel-runtime/helpers/inherits"), f = S(p), m = require("babel-runtime/core-js/object/keys"), h = S(m), y = require("react"), b = S(y), g = require("prop-types"), v = S(g), C = require("../../utils"); function S(e) { return e && e.__esModule ? e : { default: e } } function q(e, t) { for (var r = [], n = e; n <= t; n++)r.push({ value: n, label: (0, C.pad)(n, 2) }); return r } function D(e) { return (0, h.default)(e).every(function (t) { return -1 !== e[t] }) } function E(e) { var t = e.type, r = e.range, n = e.value, a = e.select, l = e.rootId, u = e.disabled, o = e.readonly, i = e.autofocus, s = e.registry, d = e.onBlur, c = l + "_" + t, p = s.widgets.SelectWidget; return b.default.createElement(p, { schema: { type: "integer" }, id: c, className: "form-control", options: { enumOptions: q(r[0], r[1]) }, placeholder: t, value: n, disabled: u, readonly: o, autofocus: i, onChange: function (e) { return a(t, e) }, onBlur: d }) } var k = function (e) { function r(e) { (0, o.default)(this, r); var t = (0, c.default)(this, (r.__proto__ || (0, l.default)(r)).call(this, e)); return t.onChange = function (e, r) { t.setState((0, n.default)({}, e, void 0 === r ? -1 : r), function () { D(t.state) && t.props.onChange((0, C.toDateString)(t.state, t.props.time)) }) }, t.setNow = function (e) { e.preventDefault(); var r = t.props, n = r.time, a = r.disabled, l = r.readonly, u = r.onChange; if (!a && !l) { var o = (0, C.parseDateString)((new Date).toJSON(), n); t.setState(o, function () { return u((0, C.toDateString)(t.state, n)) }) } }, t.clear = function (e) { e.preventDefault(); var r = t.props, n = r.time, a = r.disabled, l = r.readonly, u = r.onChange; a || l || t.setState((0, C.parseDateString)("", n), function () { return u(void 0) }) }, t.state = (0, C.parseDateString)(e.value, e.time), t } return (0, f.default)(r, e), (0, s.default)(r, [{ key: "componentWillReceiveProps", value: function (e) { this.setState((0, C.parseDateString)(e.value, e.time)) } }, { key: "shouldComponentUpdate", value: function (e, t) { return (0, C.shouldRender)(this, e, t) } }, { key: "render", value: function () { var e = this, r = this.props, n = r.id, a = r.disabled, l = r.readonly, u = r.autofocus, o = r.registry, i = r.onBlur; return b.default.createElement("ul", { className: "list-inline" }, this.dateElementProps.map(function (r, s) { return b.default.createElement("li", { key: s }, b.default.createElement(E, (0, t.default)({ rootId: n, select: e.onChange }, r, { disabled: a, readonly: l, registry: o, onBlur: i, autofocus: u && 0 === s }))) }), b.default.createElement("li", null, b.default.createElement("a", { href: "#", className: "btn btn-info btn-now", onClick: this.setNow }, "Now")), b.default.createElement("li", null, b.default.createElement("a", { href: "#", className: "btn btn-warning btn-clear", onClick: this.clear }, "Clear"))) } }, { key: "dateElementProps", get: function () { var e = this.props, t = e.time, r = e.options, n = this.state, a = n.year, l = n.month, u = n.day, o = n.hour, i = n.minute, s = n.second, d = [{ type: "year", range: r.yearsRange, value: a }, { type: "month", range: [1, 12], value: l }, { type: "day", range: [1, 31], value: u }]; return t && d.push({ type: "hour", range: [0, 23], value: o }, { type: "minute", range: [0, 59], value: i }, { type: "second", range: [0, 59], value: s }), d } }]), r }(y.Component); k.defaultProps = { time: !1, disabled: !1, readonly: !1, autofocus: !1, options: { yearsRange: [1900, (new Date).getFullYear() + 2] } }, exports.default = k;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/core-js/object/get-prototype-of": "BX4+", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "babel-runtime/core-js/object/keys": "8FtN", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "MBWI": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), t = s(e), r = require("react"), u = s(r), a = require("prop-types"), l = s(a), d = require("./AltDateWidget"), i = s(d); function s(e) { return e && e.__esModule ? e : { default: e } } function f(e) { var r = e.registry.widgets.AltDateWidget; return u.default.createElement(r, (0, t.default)({ time: !0 }, e)) } f.defaultProps = (0, t.default)({}, i.default.defaultProps, { time: !0 }), exports.default = f;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O", "./AltDateWidget": "Vx1N" }], "MO49": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = d(e), t = require("babel-runtime/helpers/objectWithoutProperties"), o = d(t), u = require("babel-runtime/core-js/json/stringify"), n = d(u), a = require("react"), l = d(a), s = require("prop-types"), i = d(s); function d(e) { return e && e.__esModule ? e : { default: e } } function c(e) { if (!e.id) throw console.log("No id for", e), new Error("no id for props " + (0, n.default)(e)); var t = e.value, u = e.readonly, a = e.disabled, s = e.autofocus, i = e.onBlur, d = e.onFocus, c = e.options, f = (e.schema, e.formContext, e.registry, e.rawErrors, (0, o.default)(e, ["value", "readonly", "disabled", "autofocus", "onBlur", "onFocus", "options", "schema", "formContext", "registry", "rawErrors"])); f.type = c.inputType || f.type || "text"; return l.default.createElement("input", (0, r.default)({ className: "form-control", readOnly: u, disabled: a, autoFocus: s, value: null == t ? "" : t }, f, { onChange: function (r) { var t = r.target.value; return e.onChange("" === t ? c.emptyValue : t) }, onBlur: i && function (e) { return i(f.id, e.target.value) }, onFocus: d && function (e) { return d(f.id, e.target.value) } })) } c.defaultProps = { type: "text", required: !1, disabled: !1, readonly: !1, autofocus: !1 }, exports.default = c;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/core-js/json/stringify": "HxWs", "react": "1n8/", "prop-types": "5D9O" }], "j08C": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("react"), t = d(e), r = require("prop-types"), a = d(r), u = require("../fields/DescriptionField.js"), l = d(u); function d(e) { return e && e.__esModule ? e : { default: e } } function c(e) { var r = e.schema, a = e.id, u = e.value, d = e.required, c = e.disabled, i = e.readonly, n = e.label, o = e.autofocus, s = e.onChange; return t.default.createElement("div", { className: "checkbox " + (c || i ? "disabled" : "") }, r.description && t.default.createElement(l.default, { description: r.description }), t.default.createElement("label", null, t.default.createElement("input", { type: "checkbox", id: a, checked: void 0 !== u && u, required: d, disabled: c || i, autoFocus: o, onChange: function (e) { return s(e.target.checked) } }), t.default.createElement("span", null, n))) } c.defaultProps = { autofocus: !1 }, exports.default = c;
    }, { "react": "1n8/", "prop-types": "5D9O", "../fields/DescriptionField.js": "wEOU" }], "MpsV": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("react"), t = l(e), n = require("prop-types"), a = l(n); function l(e) { return e && e.__esModule ? e : { default: e } } function u(e, t, n) { var a = n.indexOf(e); return t.slice(0, a).concat(e, t.slice(a)).sort(function (e, t) { return n.indexOf(e) > n.indexOf(t) }) } function r(e, t) { return t.filter(function (t) { return t !== e }) } function c(e) { var n = e.id, a = e.disabled, l = e.options, c = e.value, i = e.autofocus, o = e.readonly, d = e.onChange, s = l.enumOptions, f = l.inline; return t.default.createElement("div", { className: "checkboxes", id: n }, s.map(function (e, l) { var p = -1 !== c.indexOf(e.value), m = a || o ? "disabled" : "", v = t.default.createElement("span", null, t.default.createElement("input", { type: "checkbox", id: n + "_" + l, checked: p, disabled: a || o, autoFocus: i && 0 === l, onChange: function (t) { var n = s.map(function (e) { return e.value }); t.target.checked ? d(u(e.value, c, n)) : d(r(e.value, c)) } }), t.default.createElement("span", null, e.label)); return f ? t.default.createElement("label", { key: l, className: "checkbox-inline " + m }, v) : t.default.createElement("div", { key: l, className: "checkbox " + m }, t.default.createElement("label", null, v)) })) } c.defaultProps = { autofocus: !1, options: { inline: !1 } }, exports.default = c;
    }, { "react": "1n8/", "prop-types": "5D9O" }], "g248": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = l(e), t = require("react"), u = l(t), a = require("prop-types"), d = l(a); function l(e) { return e && e.__esModule ? e : { default: e } } function s(e) { var t = e.disabled, a = e.readonly, d = e.registry.widgets.BaseInput; return u.default.createElement(d, (0, r.default)({ type: "color" }, e, { disabled: t || a })) } exports.default = s;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O" }], "uDDR": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), t = i(e), r = require("react"), u = i(r), n = require("prop-types"), a = i(n); function i(e) { return e && e.__esModule ? e : { default: e } } function o(e) { var r = e.onChange, n = e.registry.widgets.BaseInput; return u.default.createElement(n, (0, t.default)({ type: "date" }, e, { onChange: function (e) { return r(e || void 0) } })) } exports.default = o;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O" }], "1Xbs": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), t = l(e); exports.utcToLocal = i, exports.localToUTC = s; var r = require("react"), a = l(r), u = require("prop-types"), n = l(u), o = require("../../utils"); function l(e) { return e && e.__esModule ? e : { default: e } } function i(e) { if (!e) return ""; var t = new Date(e); return (0, o.pad)(t.getFullYear(), 4) + "-" + (0, o.pad)(t.getMonth() + 1, 2) + "-" + (0, o.pad)(t.getDate(), 2) + "T" + (0, o.pad)(t.getHours(), 2) + ":" + (0, o.pad)(t.getMinutes(), 2) + ":" + (0, o.pad)(t.getSeconds(), 2) + "." + (0, o.pad)(t.getMilliseconds(), 3) } function s(e) { if (e) return new Date(e).toJSON() } function d(e) { var r = e.value, u = e.onChange, n = e.registry.widgets.BaseInput; return a.default.createElement(n, (0, t.default)({ type: "datetime-local" }, e, { value: i(r), onChange: function (e) { return u(s(e)) } })) } exports.default = d;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "1fAS": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = i(e), t = require("react"), u = i(t), a = require("prop-types"), s = i(a); function i(e) { return e && e.__esModule ? e : { default: e } } function l(e) { var t = e.registry.widgets.BaseInput; return u.default.createElement(t, (0, r.default)({ type: "email" }, e)) } exports.default = l;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O" }], "B1ls": [function (require, module, exports) {
        var r = require("./_an-object"), e = require("./_a-function"), u = require("./_wks")("species"); module.exports = function (n, o) { var i, t = r(n).constructor; return void 0 === t || null == (i = r(t)[u]) ? o : e(i) };
    }, { "./_an-object": "zotD", "./_a-function": "g31e", "./_wks": "Ug9I" }], "H109": [function (require, module, exports) {


        var e = require("./_global"), t = require("./_task").set, r = e.MutationObserver || e.WebKitMutationObserver, n = e.process, o = e.Promise, a = "process" == require("./_cof")(n); module.exports = function () { var i, c, s, v = function () { var e, t; for (a && (e = n.domain) && e.exit(); i;) { t = i.fn, i = i.next; try { t() } catch (r) { throw i ? s() : c = void 0, r } } c = void 0, e && e.enter() }; if (a) s = function () { n.nextTick(v) }; else if (!r || e.navigator && e.navigator.standalone) if (o && o.resolve) { var u = o.resolve(void 0); s = function () { u.then(v) } } else s = function () { t.call(e, v) }; else { var f = !0, l = document.createTextNode(""); new r(v).observe(l, { characterData: !0 }), s = function () { l.data = f = !f } } return function (e) { var t = { fn: e, next: void 0 }; c && (c.next = t), i || (i = t, s()), c = t } };
    }, { "./_global": "i1Q6", "./_task": "uzcO", "./_cof": "ShN9" }], "AIlg": [function (require, module, exports) {
        "use strict"; var r = require("./_a-function"); function e(e) { var o, t; this.promise = new e(function (r, e) { if (void 0 !== o || void 0 !== t) throw TypeError("Bad Promise constructor"); o = r, t = e }), this.resolve = r(o), this.reject = r(t) } module.exports.f = function (r) { return new e(r) };
    }, { "./_a-function": "g31e" }], "kX4D": [function (require, module, exports) {
        module.exports = function (e) { try { return { e: !1, v: e() } } catch (r) { return { e: !0, v: r } } };
    }, {}], "/cCi": [function (require, module, exports) {

        var e = require("./_global"), r = e.navigator; module.exports = r && r.userAgent || "";
    }, { "./_global": "i1Q6" }], "5Czc": [function (require, module, exports) {
        var r = require("./_an-object"), e = require("./_is-object"), i = require("./_new-promise-capability"); module.exports = function (o, t) { if (r(o), e(t) && t.constructor === o) return t; var u = i.f(o); return (0, u.resolve)(t), u.promise };
    }, { "./_an-object": "zotD", "./_is-object": "BxvP", "./_new-promise-capability": "AIlg" }], "9kJF": [function (require, module, exports) {


        "use strict"; var e, r, t, i, n = require("./_library"), o = require("./_global"), c = require("./_ctx"), s = require("./_classof"), u = require("./_export"), a = require("./_is-object"), _ = require("./_a-function"), h = require("./_an-instance"), f = require("./_for-of"), l = require("./_species-constructor"), v = require("./_task").set, d = require("./_microtask")(), p = require("./_new-promise-capability"), m = require("./_perform"), q = require("./_user-agent"), y = require("./_promise-resolve"), j = "Promise", w = o.TypeError, g = o.process, x = g && g.versions, b = x && x.v8 || "", k = o[j], P = "process" == s(g), F = function () { }, S = r = p.f, E = !!function () { try { var e = k.resolve(1), r = (e.constructor = {})[require("./_wks")("species")] = function (e) { e(F, F) }; return (P || "function" == typeof PromiseRejectionEvent) && e.then(F) instanceof r && 0 !== b.indexOf("6.6") && -1 === q.indexOf("Chrome/66") } catch (t) { } }(), O = function (e) { var r; return !(!a(e) || "function" != typeof (r = e.then)) && r }, R = function (e, r) { if (!e._n) { e._n = !0; var t = e._c; d(function () { for (var i = e._v, n = 1 == e._s, o = 0, c = function (r) { var t, o, c, s = n ? r.ok : r.fail, u = r.resolve, a = r.reject, _ = r.domain; try { s ? (n || (2 == e._h && H(e), e._h = 1), !0 === s ? t = i : (_ && _.enter(), t = s(i), _ && (_.exit(), c = !0)), t === r.promise ? a(w("Promise-chain cycle")) : (o = O(t)) ? o.call(t, u, a) : u(t)) : a(i) } catch (h) { _ && !c && _.exit(), a(h) } }; t.length > o;)c(t[o++]); e._c = [], e._n = !1, r && !e._h && C(e) }) } }, C = function (e) { v.call(o, function () { var r, t, i, n = e._v, c = G(e); if (c && (r = m(function () { P ? g.emit("unhandledRejection", n, e) : (t = o.onunhandledrejection) ? t({ promise: e, reason: n }) : (i = o.console) && i.error && i.error("Unhandled promise rejection", n) }), e._h = P || G(e) ? 2 : 1), e._a = void 0, c && r.e) throw r.v }) }, G = function (e) { return 1 !== e._h && 0 === (e._a || e._c).length }, H = function (e) { v.call(o, function () { var r; P ? g.emit("rejectionHandled", e) : (r = o.onrejectionhandled) && r({ promise: e, reason: e._v }) }) }, T = function (e) { var r = this; r._d || (r._d = !0, (r = r._w || r)._v = e, r._s = 2, r._a || (r._a = r._c.slice()), R(r, !0)) }, U = function (e) { var r, t = this; if (!t._d) { t._d = !0, t = t._w || t; try { if (t === e) throw w("Promise can't be resolved itself"); (r = O(e)) ? d(function () { var i = { _w: t, _d: !1 }; try { r.call(e, c(U, i, 1), c(T, i, 1)) } catch (n) { T.call(i, n) } }) : (t._v = e, t._s = 1, R(t, !1)) } catch (i) { T.call({ _w: t, _d: !1 }, i) } } }; E || (k = function (r) { h(this, k, j, "_h"), _(r), e.call(this); try { r(c(U, this, 1), c(T, this, 1)) } catch (t) { T.call(this, t) } }, (e = function (e) { this._c = [], this._a = void 0, this._s = 0, this._d = !1, this._v = void 0, this._h = 0, this._n = !1 }).prototype = require("./_redefine-all")(k.prototype, { then: function (e, r) { var t = S(l(this, k)); return t.ok = "function" != typeof e || e, t.fail = "function" == typeof r && r, t.domain = P ? g.domain : void 0, this._c.push(t), this._a && this._a.push(t), this._s && R(this, !1), t.promise }, catch: function (e) { return this.then(void 0, e) } }), t = function () { var r = new e; this.promise = r, this.resolve = c(U, r, 1), this.reject = c(T, r, 1) }, p.f = S = function (e) { return e === k || e === i ? new t(e) : r(e) }), u(u.G + u.W + u.F * !E, { Promise: k }), require("./_set-to-string-tag")(k, j), require("./_set-species")(j), i = require("./_core")[j], u(u.S + u.F * !E, j, { reject: function (e) { var r = S(this); return (0, r.reject)(e), r.promise } }), u(u.S + u.F * (n || !E), j, { resolve: function (e) { return y(n && this === i ? k : this, e) } }), u(u.S + u.F * !(E && require("./_iter-detect")(function (e) { k.all(e).catch(F) })), j, { all: function (e) { var r = this, t = S(r), i = t.resolve, n = t.reject, o = m(function () { var t = [], o = 0, c = 1; f(e, !1, function (e) { var s = o++, u = !1; t.push(void 0), c++ , r.resolve(e).then(function (e) { u || (u = !0, t[s] = e, --c || i(t)) }, n) }), --c || i(t) }); return o.e && n(o.v), t.promise }, race: function (e) { var r = this, t = S(r), i = t.reject, n = m(function () { f(e, !1, function (e) { r.resolve(e).then(t.resolve, i) }) }); return n.e && i(n.v), t.promise } });
    }, { "./_library": "1kq3", "./_global": "i1Q6", "./_ctx": "3zRh", "./_classof": "ZHvQ", "./_export": "vSO4", "./_is-object": "BxvP", "./_a-function": "g31e", "./_an-instance": "KUik", "./_for-of": "ozpD", "./_species-constructor": "B1ls", "./_task": "uzcO", "./_microtask": "H109", "./_new-promise-capability": "AIlg", "./_perform": "kX4D", "./_user-agent": "/cCi", "./_promise-resolve": "5Czc", "./_wks": "Ug9I", "./_redefine-all": "O6kh", "./_set-to-string-tag": "11Ut", "./_set-species": "FGzK", "./_core": "zKeE", "./_iter-detect": "Lli7" }], "zaru": [function (require, module, exports) {

        "use strict"; var r = require("./_export"), e = require("./_core"), t = require("./_global"), n = require("./_species-constructor"), i = require("./_promise-resolve"); r(r.P + r.R, "Promise", { finally: function (r) { var o = n(this, e.Promise || t.Promise), u = "function" == typeof r; return this.then(u ? function (e) { return i(o, r()).then(function () { return e }) } : r, u ? function (e) { return i(o, r()).then(function () { throw e }) } : r) } });
    }, { "./_export": "vSO4", "./_core": "zKeE", "./_global": "i1Q6", "./_species-constructor": "B1ls", "./_promise-resolve": "5Czc" }], "+CEt": [function (require, module, exports) {
        "use strict"; var r = require("./_export"), e = require("./_new-promise-capability"), i = require("./_perform"); r(r.S, "Promise", { try: function (r) { var t = e.f(this), o = i(r); return (o.e ? t.reject : t.resolve)(o.v), t.promise } });
    }, { "./_export": "vSO4", "./_new-promise-capability": "AIlg", "./_perform": "kX4D" }], "9u1Q": [function (require, module, exports) {
        require("../modules/es6.object.to-string"), require("../modules/es6.string.iterator"), require("../modules/web.dom.iterable"), require("../modules/es6.promise"), require("../modules/es7.promise.finally"), require("../modules/es7.promise.try"), module.exports = require("../modules/_core").Promise;
    }, { "../modules/es6.object.to-string": "70rD", "../modules/es6.string.iterator": "i+u+", "../modules/web.dom.iterable": "COf8", "../modules/es6.promise": "9kJF", "../modules/es7.promise.finally": "zaru", "../modules/es7.promise.try": "+CEt", "../modules/_core": "zKeE" }], "L3Vt": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/promise"), __esModule: !0 };
    }, { "core-js/library/fn/promise": "9u1Q" }], "7nQX": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/core-js/object/get-prototype-of"), t = v(e), r = require("babel-runtime/helpers/classCallCheck"), n = v(r), a = require("babel-runtime/helpers/createClass"), u = v(a), l = require("babel-runtime/helpers/possibleConstructorReturn"), i = v(l), o = require("babel-runtime/helpers/inherits"), s = v(o), f = require("babel-runtime/core-js/promise"), c = v(f), d = require("react"), p = v(d), m = require("prop-types"), b = v(m), h = require("../../utils"); function v(e) { return e && e.__esModule ? e : { default: e } } function y(e, t) { return e.replace(";base64", ";name=" + t + ";base64") } function C(e) { var t = e.name, r = e.size, n = e.type; return new c.default(function (a, u) { var l = new window.FileReader; l.onerror = u, l.onload = function (e) { a({ dataURL: y(e.target.result, t), name: t, size: r, type: n }) }, l.readAsDataURL(e) }) } function g(e) { return c.default.all([].map.call(e, C)) } function q(e) { var t = e.filesInfo; return 0 === t.length ? null : p.default.createElement("ul", { className: "file-info" }, t.map(function (e, t) { var r = e.name, n = e.size, a = e.type; return p.default.createElement("li", { key: t }, p.default.createElement("strong", null, r), " (", a, ", ", n, " bytes)") })) } function R(e) { return e.filter(function (e) { return void 0 !== e }).map(function (e) { var t = (0, h.dataURItoBlob)(e), r = t.blob; return { name: t.name, size: r.size, type: r.type } }) } var _ = function (e) { function r(e) { (0, n.default)(this, r); var a = (0, i.default)(this, (r.__proto__ || (0, t.default)(r)).call(this, e)); a.onChange = function (e) { var t = a.props, r = t.multiple, n = t.onChange; g(e.target.files).then(function (e) { var t = { values: e.map(function (e) { return e.dataURL }), filesInfo: e }; (0, h.setState)(a, t, function () { n(r ? t.values : t.values[0]) }) }) }; var u = e.value, l = Array.isArray(u) ? u : [u]; return a.state = { values: l, filesInfo: R(l) }, a } return (0, s.default)(r, e), (0, u.default)(r, [{ key: "shouldComponentUpdate", value: function (e, t) { return (0, h.shouldRender)(this, e, t) } }, { key: "render", value: function () { var e = this, t = this.props, r = t.multiple, n = t.id, a = t.readonly, u = t.disabled, l = t.autofocus, i = this.state.filesInfo; return p.default.createElement("div", null, p.default.createElement("p", null, p.default.createElement("input", { ref: function (t) { return e.inputRef = t }, id: n, type: "file", disabled: a || u, onChange: this.onChange, defaultValue: "", autoFocus: l, multiple: r })), p.default.createElement(q, { filesInfo: i })) } }]), r }(d.Component); _.defaultProps = { autofocus: !1 }, exports.default = _;
    }, { "babel-runtime/core-js/object/get-prototype-of": "BX4+", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "babel-runtime/core-js/promise": "L3Vt", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "s++k": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("react"), t = d(e), r = require("prop-types"), u = d(r); function d(e) { return e && e.__esModule ? e : { default: e } } function i(e) { var r = e.id, u = e.value; return t.default.createElement("input", { type: "hidden", id: r, value: void 0 === u ? "" : u }) } exports.default = i;
    }, { "react": "1n8/", "prop-types": "5D9O" }], "lyfp": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = n(e), t = require("react"), u = n(t), s = require("prop-types"), a = n(s); function n(e) { return e && e.__esModule ? e : { default: e } } function d(e) { var t = e.registry.widgets.BaseInput; return u.default.createElement(t, (0, r.default)({ type: "password" }, e)) } exports.default = d;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O" }], "E+6x": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("react"), a = u(e), t = require("prop-types"), l = u(t); function u(e) { return e && e.__esModule ? e : { default: e } } function n(e) { var t = e.options, l = e.value, u = e.required, n = e.disabled, r = e.readonly, d = e.autofocus, i = e.onChange, o = Math.random().toString(), s = t.enumOptions, c = t.enumDisabled, f = t.inline; return a.default.createElement("div", { className: "field-radio-group" }, s.map(function (e, t) { var s = e.value === l, m = c && -1 != c.indexOf(e.value), p = n || m || r ? "disabled" : "", v = a.default.createElement("span", null, a.default.createElement("input", { type: "radio", checked: s, name: o, required: u, value: e.value, disabled: n || m || r, autoFocus: d && 0 === t, onChange: function (a) { return i(e.value) } }), a.default.createElement("span", null, e.label)); return f ? a.default.createElement("label", { key: t, className: "radio-inline " + p }, v) : a.default.createElement("div", { key: t, className: "radio " + p }, a.default.createElement("label", null, v)) })) } n.defaultProps = { autofocus: !1 }, exports.default = n;
    }, { "react": "1n8/", "prop-types": "5D9O" }], "O0WS": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = n(e), t = require("react"), a = n(t), u = require("prop-types"), l = n(u), s = require("../../utils"); function n(e) { return e && e.__esModule ? e : { default: e } } function i(e) { var t = e.schema, u = e.value, l = e.registry.widgets.BaseInput; return a.default.createElement("div", { className: "field-range-wrapper" }, a.default.createElement(l, (0, r.default)({ type: "range" }, e, (0, s.rangeSpec)(t))), a.default.createElement("span", { className: "range-view" }, u)) } exports.default = i;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "S9EN": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/core-js/set"), t = l(e), r = require("react"), u = l(r), a = require("prop-types"), n = l(a), o = require("../../utils"); function l(e) { return e && e.__esModule ? e : { default: e } } var i = new t.default(["number", "integer"]); function s(e, t) { var r = e.type, u = e.items; if ("" !== t) return "array" === r && u && i.has(u.type) ? t.map(o.asNumber) : "boolean" === r ? "true" === t : "number" === r ? (0, o.asNumber)(t) : t } function c(e, t) { return t ? [].slice.call(e.target.options).filter(function (e) { return e.selected }).map(function (e) { return e.value }) : e.target.value } function d(e) { var t = e.schema, r = e.id, a = e.options, n = e.value, o = e.required, l = e.disabled, i = e.readonly, d = e.multiple, f = e.autofocus, p = e.onChange, m = e.onBlur, v = e.onFocus, b = e.placeholder, y = a.enumOptions, q = a.enumDisabled, g = d ? [] : ""; return u.default.createElement("select", { id: r, multiple: d, className: "form-control", value: void 0 === n ? g : n, required: o, disabled: l || i, autoFocus: f, onBlur: m && function (e) { var u = c(e, d); m(r, s(t, u)) }, onFocus: v && function (e) { var u = c(e, d); v(r, s(t, u)) }, onChange: function (e) { var r = c(e, d); p(s(t, r)) } }, !d && !t.default && u.default.createElement("option", { value: "" }, b), y.map(function (e, t) { var r = e.value, a = e.label, n = q && -1 != q.indexOf(r); return u.default.createElement("option", { key: t, value: r, disabled: n }, a) })) } d.defaultProps = { autofocus: !1 }, exports.default = d;
    }, { "babel-runtime/core-js/set": "7Zlx", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "01uk": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("react"), r = u(e), o = require("prop-types"), t = u(o); function u(e) { return e && e.__esModule ? e : { default: e } } function a(e) { var o = e.id, t = e.options, u = e.placeholder, a = e.value, n = e.required, l = e.disabled, s = e.readonly, d = e.autofocus, c = e.onChange, i = e.onBlur, f = e.onFocus; return r.default.createElement("textarea", { id: o, className: "form-control", value: void 0 === a ? "" : a, placeholder: u, required: n, disabled: l, readOnly: s, autoFocus: d, rows: t.rows, onBlur: i && function (e) { return i(o, e.target.value) }, onFocus: f && function (e) { return f(o, e.target.value) }, onChange: function (e) { var r = e.target.value; return c("" === r ? t.emptyValue : r) } }) } a.defaultProps = { autofocus: !1, options: {} }, exports.default = a;
    }, { "react": "1n8/", "prop-types": "5D9O" }], "jQe1": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("react"), r = s(e), t = require("prop-types"), u = s(t); function s(e) { return e && e.__esModule ? e : { default: e } } function a(e) { var t = e.registry.widgets.BaseInput; return r.default.createElement(t, e) } exports.default = a;
    }, { "react": "1n8/", "prop-types": "5D9O" }], "K3R9": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = l(e), t = require("react"), u = l(t), s = require("prop-types"), a = l(s); function l(e) { return e && e.__esModule ? e : { default: e } } function n(e) { var t = e.registry.widgets.BaseInput; return u.default.createElement(t, (0, r.default)({ type: "url" }, e)) } exports.default = n;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O" }], "rXq+": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/helpers/extends"), r = i(e), t = require("react"), u = i(t), s = require("prop-types"), a = i(s), n = require("../../utils"); function i(e) { return e && e.__esModule ? e : { default: e } } function l(e) { var t = e.registry.widgets.BaseInput; return u.default.createElement(t, (0, r.default)({ type: "number" }, e, (0, n.rangeSpec)(e.schema))) } exports.default = l;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O", "../../utils": "X9H5" }], "R6MN": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("./AltDateWidget"), t = M(e), i = require("./AltDateTimeWidget"), d = M(i), r = require("./BaseInput"), u = M(r), a = require("./CheckboxWidget"), g = M(a), l = require("./CheckboxesWidget"), W = M(l), f = require("./ColorWidget"), o = M(f), q = require("./DateWidget"), s = M(q), n = require("./DateTimeWidget"), x = M(n), D = require("./EmailWidget"), c = M(D), T = require("./FileWidget"), p = M(T), m = require("./HiddenWidget"), C = M(m), R = require("./PasswordWidget"), b = M(R), h = require("./RadioWidget"), k = M(h), w = require("./RangeWidget"), A = M(w), U = require("./SelectWidget"), _ = M(U), P = require("./TextareaWidget"), v = M(P), B = require("./TextWidget"), E = M(B), F = require("./URLWidget"), H = M(F), I = require("./UpDownWidget"), L = M(I); function M(e) { return e && e.__esModule ? e : { default: e } } exports.default = { BaseInput: u.default, PasswordWidget: b.default, RadioWidget: k.default, UpDownWidget: L.default, RangeWidget: A.default, SelectWidget: _.default, TextWidget: E.default, DateWidget: s.default, DateTimeWidget: x.default, AltDateWidget: t.default, AltDateTimeWidget: d.default, EmailWidget: c.default, URLWidget: H.default, TextareaWidget: v.default, HiddenWidget: C.default, ColorWidget: o.default, FileWidget: p.default, CheckboxWidget: g.default, CheckboxesWidget: W.default };
    }, { "./AltDateWidget": "Vx1N", "./AltDateTimeWidget": "MBWI", "./BaseInput": "MO49", "./CheckboxWidget": "j08C", "./CheckboxesWidget": "MpsV", "./ColorWidget": "g248", "./DateWidget": "uDDR", "./DateTimeWidget": "1Xbs", "./EmailWidget": "1fAS", "./FileWidget": "7nQX", "./HiddenWidget": "s++k", "./PasswordWidget": "lyfp", "./RadioWidget": "E+6x", "./RangeWidget": "O0WS", "./SelectWidget": "S9EN", "./TextareaWidget": "01uk", "./TextWidget": "jQe1", "./URLWidget": "K3R9", "./UpDownWidget": "rXq+" }], "X9H5": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.ADDITIONAL_PROPERTY_FLAG = void 0; var e = require("babel-runtime/core-js/set-immediate"), t = D(e), r = require("babel-runtime/core-js/set"), n = D(r), i = require("babel-runtime/core-js/array/from"), o = D(i), a = require("babel-runtime/core-js/get-iterator"), u = D(a), d = require("babel-runtime/helpers/toConsumableArray"), s = D(d), f = require("babel-runtime/core-js/number/is-nan"), l = D(f), c = require("babel-runtime/core-js/object/assign"), p = D(c), g = require("babel-runtime/helpers/defineProperty"), m = D(g), v = require("babel-runtime/core-js/object/keys"), h = D(v), y = require("babel-runtime/helpers/typeof"), b = D(y), w = require("babel-runtime/helpers/extends"), x = D(w), A = require("babel-runtime/helpers/objectWithoutProperties"), W = D(A); exports.getDefaultRegistry = I, exports.getSchemaType = R, exports.getWidget = U, exports.getDefaultFormState = _, exports.getUiOptions = N, exports.isObject = F, exports.mergeObjects = M, exports.asNumber = k, exports.orderProperties = L, exports.isConstant = H, exports.toConstant = Y, exports.isSelect = B, exports.isMultiSelect = G, exports.isFilesArray = J, exports.isFixedItems = z, exports.allowAdditionalItems = K, exports.optionsList = Q, exports.stubExistingAdditionalProperties = Z, exports.resolveSchema = ee, exports.retrieveSchema = re, exports.deepEquals = se, exports.shouldRender = fe, exports.toIdSchema = le, exports.parseDateString = ce, exports.toDateString = pe, exports.pad = ge, exports.setState = me, exports.dataURItoBlob = ve, exports.rangeSpec = he; var O = require("react"), P = D(O), S = require("./validate"), j = D(S), T = require("core-js/library/fn/array/fill"), q = D(T); function D(e) { return e && e.__esModule ? e : { default: e } } var E = exports.ADDITIONAL_PROPERTY_FLAG = "__additional_property", C = { boolean: { checkbox: "CheckboxWidget", radio: "RadioWidget", select: "SelectWidget", hidden: "HiddenWidget" }, string: { text: "TextWidget", password: "PasswordWidget", email: "EmailWidget", hostname: "TextWidget", ipv4: "TextWidget", ipv6: "TextWidget", uri: "URLWidget", "data-url": "FileWidget", radio: "RadioWidget", select: "SelectWidget", textarea: "TextareaWidget", hidden: "HiddenWidget", date: "DateWidget", datetime: "DateTimeWidget", "date-time": "DateTimeWidget", "alt-date": "AltDateWidget", "alt-datetime": "AltDateTimeWidget", color: "ColorWidget", file: "FileWidget" }, number: { text: "TextWidget", select: "SelectWidget", updown: "UpDownWidget", range: "RangeWidget", radio: "RadioWidget", hidden: "HiddenWidget" }, integer: { text: "TextWidget", select: "SelectWidget", updown: "UpDownWidget", range: "RangeWidget", radio: "RadioWidget", hidden: "HiddenWidget" }, array: { select: "SelectWidget", checkboxes: "CheckboxesWidget", files: "FileWidget" } }; function I() { return { fields: require("./components/fields").default, widgets: require("./components/widgets").default, definitions: {}, formContext: {} } } function R(e) { var t = e.type; return !t && e.enum && (t = "string"), t } function U(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = R(e); if ("function" == typeof t) return function (e) { if (!e.MergedWidget) { var t = e.defaultProps && e.defaultProps.options || {}; e.MergedWidget = function (r) { var n = r.options, i = void 0 === n ? {} : n, o = (0, W.default)(r, ["options"]); return P.default.createElement(e, (0, x.default)({ options: (0, x.default)({}, t, i) }, o)) } } return e.MergedWidget }(t); if ("string" != typeof t) throw new Error("Unsupported widget definition: " + (void 0 === t ? "undefined" : (0, b.default)(t))); if (r.hasOwnProperty(t)) return U(e, r[t], r); if (!C.hasOwnProperty(n)) throw new Error('No widget for type "' + n + '"'); if (C[n].hasOwnProperty(t)) return U(e, r[C[n][t]], r); throw new Error('No widget "' + t + '" for type "' + n + '"') } function $(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = t; if (F(n) && F(e.default)) n = M(n, e.default); else if ("default" in e) n = e.default; else { if ("$ref" in e) return $(V(e.$ref, r), n, r); z(e) && (n = e.items.map(function (e) { return $(e, void 0, r) })) } switch (void 0 === n && (n = e.default), e.type) { case "object": return (0, h.default)(e.properties || {}).reduce(function (t, i) { return t[i] = $(e.properties[i], (n || {})[i], r), t }, {}); case "array": if (e.minItems) { if (G(e, r)) return []; var i = n ? n.length : 0; if (e.minItems > i) { var o = n || [], a = (0, q.default)(new Array(e.minItems - i), $(e.items, e.items.defaults, r)); return o.concat(a) } } }return n } function _(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; if (!F(e)) throw new Error("Invalid schema: " + e); var n = $(re(e, r, t), e.default, r); return void 0 === t ? n : F(t) ? M(n, t) : t || n } function N(e) { return (0, h.default)(e).filter(function (e) { return 0 === e.indexOf("ui:") }).reduce(function (t, r) { var n = e[r]; return "ui:widget" === r && F(n) ? (console.warn("Setting options via ui:widget object is deprecated, use ui:options instead"), (0, x.default)({}, t, n.options || {}, { widget: n.component })) : "ui:options" === r && F(n) ? (0, x.default)({}, t, n) : (0, x.default)({}, t, (0, m.default)({}, r.substring(3), n)) }, {}) } function F(e) { return "object" === (void 0 === e ? "undefined" : (0, b.default)(e)) && null !== e && !Array.isArray(e) } function M(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], n = (0, p.default)({}, e); return (0, h.default)(t).reduce(function (n, i) { var o = e[i], a = t[i]; return e.hasOwnProperty(i) && F(a) ? n[i] = M(o, a, r) : r && Array.isArray(o) && Array.isArray(a) ? n[i] = o.concat(a) : n[i] = a, n }, n) } function k(e) { if ("" !== e) { if (/\.$/.test(e)) return e; if (/\.0$/.test(e)) return e; var t = Number(e), r = "number" == typeof t && !(0, l.default)(t); return /\.\d*0$/.test(e) ? e : r ? t : e } } function L(e, t) { if (!Array.isArray(t)) return e; var r = function (e) { return e.reduce(function (e, t) { return e[t] = !0, e }, {}) }, n = function (e) { return e.length > 1 ? "properties '" + e.join("', '") + "'" : "property '" + e[0] + "'" }, i = r(e), o = r(t), a = t.filter(function (e) { return "*" !== e && !i[e] }); if (a.length) throw new Error("uiSchema order list contains extraneous " + n(a)); var u = e.filter(function (e) { return !o[e] }), d = t.indexOf("*"); if (-1 === d) { if (u.length) throw new Error("uiSchema order list does not contain " + n(u)); return t } if (d !== t.lastIndexOf("*")) throw new Error("uiSchema order list contains more than one wildcard item"); var f = [].concat((0, s.default)(t)); return f.splice.apply(f, [d, 1].concat((0, s.default)(u))), f } function H(e) { return Array.isArray(e.enum) && 1 === e.enum.length || e.hasOwnProperty("const") } function Y(e) { if (Array.isArray(e.enum) && 1 === e.enum.length) return e.enum[0]; if (e.hasOwnProperty("const")) return e.const; throw new Error("schema cannot be inferred as a constant") } function B(e) { var t = re(e, arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}), r = t.oneOf || t.anyOf; return !!Array.isArray(t.enum) || !!Array.isArray(r) && r.every(function (e) { return H(e) }) } function G(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; return !(!e.uniqueItems || !e.items) && B(e.items, t) } function J(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; if ("files" === t["ui:widget"]) return !0; if (e.items) { var n = re(e.items, r); return "string" === n.type && "data-url" === n.format } return !1 } function z(e) { return Array.isArray(e.items) && e.items.length > 0 && e.items.every(function (e) { return F(e) }) } function K(e) { return !0 === e.additionalItems && console.warn("additionalItems=true is currently not supported"), F(e.additionalItems) } function Q(e) { return e.enum ? e.enum.map(function (t, r) { return { label: e.enumNames && e.enumNames[r] || String(t), value: t } }) : (e.oneOf || e.anyOf).map(function (e, t) { var r = Y(e); return { label: e.title || String(r), value: r } }) } function V(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, r = /^#\/definitions\/(.*)$/.exec(e); if (r && r[1]) { var n = r[1].split("/"), i = t, o = !0, a = !1, d = void 0; try { for (var s, f = (0, u.default)(n); !(o = (s = f.next()).done); o = !0) { var l = s.value; if (l = l.replace(/~1/g, "/").replace(/~0/g, "~"), !i.hasOwnProperty(l)) throw new Error("Could not find a definition for " + e + "."); i = i[l] } } catch (c) { a = !0, d = c } finally { try { !o && f.return && f.return() } finally { if (a) throw d } } return i } throw new Error("Could not find a definition for " + e + ".") } var X = function (e) { return Array.isArray(e) ? "array" : "string" == typeof e ? "string" : null == e ? "null" : "boolean" == typeof e ? "boolean" : isNaN(e) ? "object" === (void 0 === e ? "undefined" : (0, b.default)(e)) ? "object" : "string" : "number" }; function Z(e) { arguments.length > 1 && void 0 !== arguments[1] && arguments[1]; var t = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; return e = (0, x.default)({}, e, { properties: (0, x.default)({}, e.properties) }), (0, h.default)(t).forEach(function (r) { if (!e.properties.hasOwnProperty(r)) { var n = e.additionalProperties.hasOwnProperty("type") ? (0, x.default)({}, e.additionalProperties) : { type: X(t[r]) }; e.properties[r] = n, e.properties[r][E] = !0 } }), e } function ee(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; return e.hasOwnProperty("$ref") ? te(e, t, r) : e.hasOwnProperty("dependencies") ? re(ne(e, t, r), t, r) : e } function te(e, t, r) { var n = V(e.$ref, t), i = (e.$ref, (0, W.default)(e, ["$ref"])); return re((0, x.default)({}, n, i), t, r) } function re(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, n = ee(e, t, r); return n.hasOwnProperty("additionalProperties") && !1 !== n.additionalProperties ? Z(n, t, r) : n } function ne(e, t, r) { var n = e.dependencies, i = void 0 === n ? {} : n, o = (0, W.default)(e, ["dependencies"]); for (var a in i) if (void 0 !== r[a]) { var u = i[a]; Array.isArray(u) ? o = ie(o, u) : F(u) && (o = oe(o, t, r, a, u)) } return o } function ie(e, t) { if (!t) return e; var r = Array.isArray(e.required) ? (0, o.default)(new n.default([].concat((0, s.default)(e.required), (0, s.default)(t)))) : t; return (0, x.default)({}, e, { required: r }) } function oe(e, t, r, n, i) { var o = re(i, t, r), a = o.oneOf; if (e = ue(e, (0, W.default)(o, ["oneOf"])), void 0 === a) return e; if (!Array.isArray(a)) throw new Error("invalid: it is some " + (void 0 === a ? "undefined" : (0, b.default)(a)) + " instead of an array"); var u = a.map(function (e) { return e.hasOwnProperty("$ref") ? te(e, t, r) : e }); return ae(e, t, r, n, u) } function ae(e, t, r, n, i) { var o = i.filter(function (e) { if (!e.properties) return !1; var t = e.properties[n]; if (t) { var i = { type: "object", properties: (0, m.default)({}, n, t) }; return 0 === (0, j.default)(r, i).errors.length } }); if (1 !== o.length) return console.warn("ignoring oneOf in dependencies because there isn't exactly one subschema that is valid"), e; var a = o[0], u = a.properties, d = (u[n], (0, W.default)(u, [n])); return ue(e, re((0, x.default)({}, a, { properties: d }), t, r)) } function ue(e, t) { return M(e, t, !0) } function de(e) { return "[object Arguments]" === Object.prototype.toString.call(e) } function se(e, t) { var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : [], n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : []; if (e === t) return !0; if ("function" == typeof e || "function" == typeof t) return !0; if ("object" !== (void 0 === e ? "undefined" : (0, b.default)(e)) || "object" !== (void 0 === t ? "undefined" : (0, b.default)(t))) return !1; if (null === e || null === t) return !1; if (e instanceof Date && t instanceof Date) return e.getTime() === t.getTime(); if (e instanceof RegExp && t instanceof RegExp) return e.source === t.source && e.global === t.global && e.multiline === t.multiline && e.lastIndex === t.lastIndex && e.ignoreCase === t.ignoreCase; if (de(e) || de(t)) { if (!de(e) || !de(t)) return !1; var i = Array.prototype.slice; return se(i.call(e), i.call(t), r, n) } if (e.constructor !== t.constructor) return !1; var o = (0, h.default)(e), a = (0, h.default)(t); if (0 === o.length && 0 === a.length) return !0; if (o.length !== a.length) return !1; for (var u = r.length; u--;)if (r[u] === e) return n[u] === t; r.push(e), n.push(t), o.sort(), a.sort(); for (var d = o.length - 1; d >= 0; d--)if (o[d] !== a[d]) return !1; for (var s = void 0, f = o.length - 1; f >= 0; f--)if (!se(e[s = o[f]], t[s], r, n)) return !1; return r.pop(), n.pop(), !0 } function fe(e, t, r) { var n = e.props, i = e.state; return !se(n, t) || !se(i, r) } function le(e, t, r) { var n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : {}, i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : "root", o = { $id: t || i }; if ("$ref" in e || "dependencies" in e) return le(re(e, r, n), t, r, n, i); if ("items" in e && !e.items.$ref) return le(e.items, t, r, n, i); if ("object" !== e.type) return o; for (var a in e.properties || {}) { var u = e.properties[a], d = o.$id + "_" + a; o[a] = le(u, d, r, n[a], i) } return o } function ce(e) { var t = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1]; if (!e) return { year: -1, month: -1, day: -1, hour: t ? -1 : 0, minute: t ? -1 : 0, second: t ? -1 : 0 }; var r = new Date(e); if ((0, l.default)(r.getTime())) throw new Error("Unable to parse date " + e); return { year: r.getUTCFullYear(), month: r.getUTCMonth() + 1, day: r.getUTCDate(), hour: t ? r.getUTCHours() : 0, minute: t ? r.getUTCMinutes() : 0, second: t ? r.getUTCSeconds() : 0 } } function pe(e) { var t = e.year, r = e.month, n = e.day, i = e.hour, o = void 0 === i ? 0 : i, a = e.minute, u = void 0 === a ? 0 : a, d = e.second, s = void 0 === d ? 0 : d, f = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1], l = Date.UTC(t, r - 1, n, o, u, s), c = new Date(l).toJSON(); return f ? c : c.slice(0, 10) } function ge(e, t) { for (var r = String(e); r.length < t;)r = "0" + r; return r } function me(e, r, n) { e.props.safeRenderCompletion ? e.setState(r, n) : (e.setState(r), (0, t.default)(n)) } function ve(e) { var t = e.split(","), r = t[0].split(";"), n = r[0].replace("data:", ""), i = r.filter(function (e) { return "name" === e.split("=")[0] }), o = void 0; o = 1 !== i.length ? "unknown" : i[0].split("=")[1]; for (var a = atob(t[1]), u = [], d = 0; d < a.length; d++)u.push(a.charCodeAt(d)); return { blob: new window.Blob([new Uint8Array(u)], { type: n }), name: o } } function he(e) { var t = {}; return e.multipleOf && (t.step = e.multipleOf), (e.minimum || 0 === e.minimum) && (t.min = e.minimum), (e.maximum || 0 === e.maximum) && (t.max = e.maximum), t }
    }, { "babel-runtime/core-js/set-immediate": "mMre", "babel-runtime/core-js/set": "7Zlx", "babel-runtime/core-js/array/from": "VuZO", "babel-runtime/core-js/get-iterator": "X9RM", "babel-runtime/helpers/toConsumableArray": "mYpx", "babel-runtime/core-js/number/is-nan": "qwoA", "babel-runtime/core-js/object/assign": "gc0D", "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/core-js/object/keys": "8FtN", "babel-runtime/helpers/typeof": "GyB/", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "react": "1n8/", "./validate": "egcz", "core-js/library/fn/array/fill": "3bsB", "./components/fields": "pHVB", "./components/widgets": "R6MN" }], "+gsj": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("babel-runtime/core-js/object/keys"), r = F(e), t = require("babel-runtime/helpers/extends"), a = F(t), o = require("babel-runtime/core-js/object/get-prototype-of"), i = F(o), s = require("babel-runtime/helpers/classCallCheck"), n = F(s), l = require("babel-runtime/helpers/createClass"), u = F(l), m = require("babel-runtime/helpers/possibleConstructorReturn"), p = F(m), h = require("babel-runtime/helpers/inherits"), c = F(h), d = require("react"), f = F(d), S = require("prop-types"), v = F(S), b = require("./ErrorList"), g = F(b), y = require("../utils"), C = require("../validate"), E = F(C); function F(e) { return e && e.__esModule ? e : { default: e } } var q = function (e) { function t(e) { (0, n.default)(this, t); var o = (0, p.default)(this, (t.__proto__ || (0, i.default)(t)).call(this, e)); return o.onChange = function (e, r) { var t = { formData: e }; if (!o.props.noValidate && o.props.liveValidate) { var i = o.validate(e), s = i.errors, n = i.errorSchema; t = (0, a.default)({}, t, { errors: s, errorSchema: n }) } else !o.props.noValidate && r && (t = (0, a.default)({}, t, { errorSchema: r, errors: (0, C.toErrorList)(r) })); (0, y.setState)(o, t, function () { o.props.onChange && o.props.onChange(o.state) }) }, o.onBlur = function () { var e; o.props.onBlur && (e = o.props).onBlur.apply(e, arguments) }, o.onFocus = function () { var e; o.props.onFocus && (e = o.props).onFocus.apply(e, arguments) }, o.onSubmit = function (e) { if (e.preventDefault(), !o.props.noValidate) { var t = o.validate(o.state.formData), i = t.errors, s = t.errorSchema; if ((0, r.default)(i).length > 0) return void (0, y.setState)(o, { errors: i, errorSchema: s }, function () { o.props.onError ? o.props.onError(i) : console.error("Form validation failed", i) }) } o.setState({ errors: [], errorSchema: {} }, function () { o.props.onSubmit && o.props.onSubmit((0, a.default)({}, o.state, { status: "submitted" })) }) }, o.state = o.getStateFromProps(e), o.props.onChange && !(0, y.deepEquals)(o.state.formData, o.props.formData) && o.props.onChange(o.state), o.formElement = null, o } return (0, c.default)(t, e), (0, u.default)(t, [{ key: "componentWillReceiveProps", value: function (e) { var r = this.getStateFromProps(e); this.setState(r), !(0, y.deepEquals)(r.formData, e.formData) && this.props.onChange && this.props.onChange(r) } }, { key: "getStateFromProps", value: function (e) { var r = this.state || {}, t = "schema" in e ? e.schema : this.props.schema, a = "uiSchema" in e ? e.uiSchema : this.props.uiSchema, o = void 0 !== e.formData, i = e.liveValidate || this.props.liveValidate, s = o && !e.noValidate && i, n = t.definitions, l = (0, y.getDefaultFormState)(t, e.formData, n), u = (0, y.retrieveSchema)(t, n, l), m = s ? this.validate(l, t) : { errors: r.errors || [], errorSchema: r.errorSchema || {} }, p = m.errors, h = m.errorSchema; return { schema: t, uiSchema: a, idSchema: (0, y.toIdSchema)(u, a["ui:rootFieldId"], n, l, e.idPrefix), formData: l, edit: o, errors: p, errorSchema: h } } }, { key: "shouldComponentUpdate", value: function (e, r) { return (0, y.shouldRender)(this, e, r) } }, { key: "validate", value: function (e) { var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : this.props.schema, t = this.props, a = t.validate, o = t.transformErrors, i = this.getRegistry().definitions, s = (0, y.retrieveSchema)(r, i, e); return (0, E.default)(e, s, a, o) } }, { key: "renderErrors", value: function () { var e = this.state, r = e.errors, t = e.errorSchema, a = e.schema, o = e.uiSchema, i = this.props, s = i.ErrorList, n = i.showErrorList, l = i.formContext; return r.length && 0 != n ? f.default.createElement(s, { errors: r, errorSchema: t, schema: a, uiSchema: o, formContext: l }) : null } }, { key: "getRegistry", value: function () { var e = (0, y.getDefaultRegistry)(), r = e.fields, t = e.widgets; return { fields: (0, a.default)({}, r, this.props.fields), widgets: (0, a.default)({}, t, this.props.widgets), ArrayFieldTemplate: this.props.ArrayFieldTemplate, ObjectFieldTemplate: this.props.ObjectFieldTemplate, FieldTemplate: this.props.FieldTemplate, definitions: this.props.schema.definitions || {}, formContext: this.props.formContext || {} } } }, { key: "submit", value: function () { this.formElement && this.formElement.dispatchEvent(new Event("submit", { cancelable: !0 })) } }, { key: "render", value: function () { var e = this, r = this.props, t = r.children, a = r.safeRenderCompletion, o = r.id, i = r.idPrefix, s = r.className, n = r.name, l = r.method, u = r.target, m = r.action, p = r.autocomplete, h = r.enctype, c = r.acceptcharset, d = r.noHtml5Validate, S = r.disabled, v = this.state, b = v.schema, g = v.uiSchema, y = v.formData, C = v.errorSchema, E = v.idSchema, F = this.getRegistry(), q = F.fields.SchemaField; return f.default.createElement("form", { className: s || "rjsf", id: o, name: n, method: l, target: u, action: m, autoComplete: p, encType: h, acceptCharset: c, noValidate: d, onSubmit: this.onSubmit, ref: function (r) { e.formElement = r } }, this.renderErrors(), f.default.createElement(q, { schema: b, uiSchema: g, errorSchema: C, idSchema: E, idPrefix: i, formData: y, onChange: this.onChange, onBlur: this.onBlur, onFocus: this.onFocus, registry: F, safeRenderCompletion: a, disabled: S }), t || f.default.createElement("p", null, f.default.createElement("button", { type: "submit", className: "btn btn-info" }, "Submit"))) } }]), t }(d.Component); q.defaultProps = { uiSchema: {}, noValidate: !1, liveValidate: !1, disabled: !1, safeRenderCompletion: !1, noHtml5Validate: !1, ErrorList: g.default }, exports.default = q;
    }, { "babel-runtime/core-js/object/keys": "8FtN", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/core-js/object/get-prototype-of": "BX4+", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "./ErrorList": "Snk9", "../utils": "X9H5", "../validate": "egcz" }], "AY2U": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("./components/Form"), t = r(e); function r(e) { return e && e.__esModule ? e : { default: e } } exports.default = t.default;
    }, { "./components/Form": "+gsj" }], "xjsR": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var t = Object.assign || function (t) { for (var e = 1; e < arguments.length; e++) { var i = arguments[e]; for (var n in i) Object.prototype.hasOwnProperty.call(i, n) && (t[n] = i[n]) } return t }, e = function () { function t(t, e) { for (var i = 0; i < e.length; i++) { var n = e[i]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n) } } return function (e, i, n) { return i && t(e.prototype, i), n && t(e, n), e } }(), i = require("react"), n = s(i), r = require("prop-types"), o = s(r); function s(t) { return t && t.__esModule ? t : { default: t } } function u(t, e) { var i = {}; for (var n in t) e.indexOf(n) >= 0 || Object.prototype.hasOwnProperty.call(t, n) && (i[n] = t[n]); return i } function l(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } function a(t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e } function p(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e) } var d = { position: "absolute", top: 0, left: 0, visibility: "hidden", height: 0, overflow: "scroll", whiteSpace: "pre" }, f = ["extraWidth", "injectStyles", "inputClassName", "inputRef", "inputStyle", "minWidth", "onAutosize", "placeholderIsMinWidth"], c = function (t) { return f.forEach(function (e) { return delete t[e] }), t }, h = function (t, e) { e.style.fontSize = t.fontSize, e.style.fontFamily = t.fontFamily, e.style.fontWeight = t.fontWeight, e.style.fontStyle = t.fontStyle, e.style.letterSpacing = t.letterSpacing, e.style.textTransform = t.textTransform }, y = !("undefined" == typeof window || !window.navigator) && /MSIE |Trident\/|Edge\//.test(window.navigator.userAgent), v = function () { return y ? "_" + Math.random().toString(36).substr(2, 12) : void 0 }, m = function (r) { function o(t) { l(this, o); var e = a(this, (o.__proto__ || Object.getPrototypeOf(o)).call(this, t)); return e.inputRef = function (t) { e.input = t, "function" == typeof e.props.inputRef && e.props.inputRef(t) }, e.placeHolderSizerRef = function (t) { e.placeHolderSizer = t }, e.sizerRef = function (t) { e.sizer = t }, e.state = { inputWidth: t.minWidth, inputId: t.id || v() }, e } return p(o, i.Component), e(o, [{ key: "componentDidMount", value: function () { this.mounted = !0, this.copyInputStyles(), this.updateInputWidth() } }, { key: "componentWillReceiveProps", value: function (t) { var e = t.id; e !== this.props.id && this.setState({ inputId: e || v() }) } }, { key: "componentDidUpdate", value: function (t, e) { e.inputWidth !== this.state.inputWidth && "function" == typeof this.props.onAutosize && this.props.onAutosize(this.state.inputWidth), this.updateInputWidth() } }, { key: "componentWillUnmount", value: function () { this.mounted = !1 } }, { key: "copyInputStyles", value: function () { if (this.mounted && window.getComputedStyle) { var t = this.input && window.getComputedStyle(this.input); t && (h(t, this.sizer), this.placeHolderSizer && h(t, this.placeHolderSizer)) } } }, { key: "updateInputWidth", value: function () { if (this.mounted && this.sizer && void 0 !== this.sizer.scrollWidth) { var t = void 0; t = this.props.placeholder && (!this.props.value || this.props.value && this.props.placeholderIsMinWidth) ? Math.max(this.sizer.scrollWidth, this.placeHolderSizer.scrollWidth) + 2 : this.sizer.scrollWidth + 2, (t += "number" === this.props.type && void 0 === this.props.extraWidth ? 16 : parseInt(this.props.extraWidth) || 0) < this.props.minWidth && (t = this.props.minWidth), t !== this.state.inputWidth && this.setState({ inputWidth: t }) } } }, { key: "getInput", value: function () { return this.input } }, { key: "focus", value: function () { this.input.focus() } }, { key: "blur", value: function () { this.input.blur() } }, { key: "select", value: function () { this.input.select() } }, { key: "renderStyles", value: function () { var t = this.props.injectStyles; return y && t ? n.default.createElement("style", { dangerouslySetInnerHTML: { __html: "input#" + this.state.inputId + "::-ms-clear {display: none;}" } }) : null } }, { key: "render", value: function () { var e = [this.props.defaultValue, this.props.value, ""].reduce(function (t, e) { return null != t ? t : e }), i = t({}, this.props.style); i.display || (i.display = "inline-block"); var r = t({ boxSizing: "content-box", width: this.state.inputWidth + "px" }, this.props.inputStyle), o = u(this.props, []); return c(o), o.className = this.props.inputClassName, o.id = this.state.inputId, o.style = r, n.default.createElement("div", { className: this.props.className, style: i }, this.renderStyles(), n.default.createElement("input", t({}, o, { ref: this.inputRef })), n.default.createElement("div", { ref: this.sizerRef, style: d }, e), this.props.placeholder ? n.default.createElement("div", { ref: this.placeHolderSizerRef, style: d }, this.props.placeholder) : null) } }]), o }(); m.propTypes = { className: o.default.string, defaultValue: o.default.any, extraWidth: o.default.oneOfType([o.default.number, o.default.string]), id: o.default.string, injectStyles: o.default.bool, inputClassName: o.default.string, inputRef: o.default.func, inputStyle: o.default.object, minWidth: o.default.oneOfType([o.default.number, o.default.string]), onAutosize: o.default.func, onChange: o.default.func, placeholder: o.default.string, placeholderIsMinWidth: o.default.bool, style: o.default.object, value: o.default.any }, m.defaultProps = { minWidth: 1, injectStyles: !0 }, exports.default = m;
    }, { "react": "1n8/", "prop-types": "5D9O" }], "2Db4": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.defaultFilterOptions = exports.defaultClearRenderer = exports.defaultArrowRenderer = exports.defaultMenuRenderer = exports.Option = exports.Value = exports.Creatable = exports.AsyncCreatable = exports.Async = void 0; var e = a(require("react-input-autosize")), t = a(require("classnames")), u = a(require("prop-types")), n = o(require("react")), s = require("react-dom"); function o(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var u in e) if (Object.prototype.hasOwnProperty.call(e, u)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, u) : {}; n.get || n.set ? Object.defineProperty(t, u, n) : t[u] = e[u] } return t.default = e, t } function a(e) { return e && e.__esModule ? e : { default: e } } var i = function (e) { var t = e.onMouseDown; return n.default.createElement("span", { className: "Select-arrow", onMouseDown: t }) }; exports.defaultArrowRenderer = i, i.propTypes = { onMouseDown: u.default.func }; var l = function () { return n.default.createElement("span", { className: "Select-clear", dangerouslySetInnerHTML: { __html: "&times;" } }) }; exports.defaultClearRenderer = l; var r = [{ base: "A", letters: /[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g }, { base: "AA", letters: /[\uA732]/g }, { base: "AE", letters: /[\u00C6\u01FC\u01E2]/g }, { base: "AO", letters: /[\uA734]/g }, { base: "AU", letters: /[\uA736]/g }, { base: "AV", letters: /[\uA738\uA73A]/g }, { base: "AY", letters: /[\uA73C]/g }, { base: "B", letters: /[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g }, { base: "C", letters: /[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g }, { base: "D", letters: /[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g }, { base: "DZ", letters: /[\u01F1\u01C4]/g }, { base: "Dz", letters: /[\u01F2\u01C5]/g }, { base: "E", letters: /[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g }, { base: "F", letters: /[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g }, { base: "G", letters: /[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g }, { base: "H", letters: /[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g }, { base: "I", letters: /[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g }, { base: "J", letters: /[\u004A\u24BF\uFF2A\u0134\u0248]/g }, { base: "K", letters: /[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g }, { base: "L", letters: /[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g }, { base: "LJ", letters: /[\u01C7]/g }, { base: "Lj", letters: /[\u01C8]/g }, { base: "M", letters: /[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g }, { base: "N", letters: /[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g }, { base: "NJ", letters: /[\u01CA]/g }, { base: "Nj", letters: /[\u01CB]/g }, { base: "O", letters: /[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g }, { base: "OI", letters: /[\u01A2]/g }, { base: "OO", letters: /[\uA74E]/g }, { base: "OU", letters: /[\u0222]/g }, { base: "P", letters: /[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g }, { base: "Q", letters: /[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g }, { base: "R", letters: /[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g }, { base: "S", letters: /[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g }, { base: "T", letters: /[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g }, { base: "TZ", letters: /[\uA728]/g }, { base: "U", letters: /[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g }, { base: "V", letters: /[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g }, { base: "VY", letters: /[\uA760]/g }, { base: "W", letters: /[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g }, { base: "X", letters: /[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g }, { base: "Y", letters: /[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g }, { base: "Z", letters: /[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g }, { base: "a", letters: /[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g }, { base: "aa", letters: /[\uA733]/g }, { base: "ae", letters: /[\u00E6\u01FD\u01E3]/g }, { base: "ao", letters: /[\uA735]/g }, { base: "au", letters: /[\uA737]/g }, { base: "av", letters: /[\uA739\uA73B]/g }, { base: "ay", letters: /[\uA73D]/g }, { base: "b", letters: /[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g }, { base: "c", letters: /[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g }, { base: "d", letters: /[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g }, { base: "dz", letters: /[\u01F3\u01C6]/g }, { base: "e", letters: /[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g }, { base: "f", letters: /[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g }, { base: "g", letters: /[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g }, { base: "h", letters: /[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g }, { base: "hv", letters: /[\u0195]/g }, { base: "i", letters: /[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g }, { base: "j", letters: /[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g }, { base: "k", letters: /[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g }, { base: "l", letters: /[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g }, { base: "lj", letters: /[\u01C9]/g }, { base: "m", letters: /[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g }, { base: "n", letters: /[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g }, { base: "nj", letters: /[\u01CC]/g }, { base: "o", letters: /[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g }, { base: "oi", letters: /[\u01A3]/g }, { base: "ou", letters: /[\u0223]/g }, { base: "oo", letters: /[\uA74F]/g }, { base: "p", letters: /[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g }, { base: "q", letters: /[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g }, { base: "r", letters: /[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g }, { base: "s", letters: /[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g }, { base: "t", letters: /[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g }, { base: "tz", letters: /[\uA729]/g }, { base: "u", letters: /[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g }, { base: "v", letters: /[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g }, { base: "vy", letters: /[\uA761]/g }, { base: "w", letters: /[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g }, { base: "x", letters: /[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g }, { base: "y", letters: /[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g }, { base: "z", letters: /[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g }], p = function (e) { for (var t = 0; t < r.length; t++)e = e.replace(r[t].letters, r[t].base); return e }, c = function (e) { return e.replace(/^\s+|\s+$/g, "") }, h = function (e) { return null != e && "" !== e }, d = function (e, t, u, n) { return n.ignoreAccents && (t = p(t)), n.ignoreCase && (t = t.toLowerCase()), n.trimFilter && (t = c(t)), u && (u = u.map(function (e) { return e[n.valueKey] })), e.filter(function (e) { if (u && u.indexOf(e[n.valueKey]) > -1) return !1; if (n.filterOption) return n.filterOption.call(void 0, e, t); if (!t) return !0; var s = e[n.valueKey], o = e[n.labelKey], a = h(s), i = h(o); if (!a && !i) return !1; var l = a ? String(s) : null, r = i ? String(o) : null; return n.ignoreAccents && (l && "label" !== n.matchProp && (l = p(l)), r && "value" !== n.matchProp && (r = p(r))), n.ignoreCase && (l && "label" !== n.matchProp && (l = l.toLowerCase()), r && "value" !== n.matchProp && (r = r.toLowerCase())), "start" === n.matchPos ? l && "label" !== n.matchProp && l.substr(0, t.length) === t || r && "value" !== n.matchProp && r.substr(0, t.length) === t : l && "label" !== n.matchProp && l.indexOf(t) >= 0 || r && "value" !== n.matchProp && r.indexOf(t) >= 0 }) }; exports.defaultFilterOptions = d; var f = function (e) { var u = e.focusedOption, s = e.focusOption, o = e.inputValue, a = e.instancePrefix, i = e.onFocus, l = e.onOptionRef, r = e.onSelect, p = e.optionClassName, c = e.optionComponent, h = e.optionRenderer, d = e.options, f = e.removeValue, v = e.selectValue, E = e.valueArray, b = e.valueKey, g = c; return d.map(function (e, c) { var d = E && E.some(function (t) { return t[b] === e[b] }), y = e === u, m = (0, t.default)(p, { "Select-option": !0, "is-selected": d, "is-focused": y, "is-disabled": e.disabled }); return n.default.createElement(g, { className: m, focusOption: s, inputValue: o, instancePrefix: a, isDisabled: e.disabled, isFocused: y, isSelected: d, key: "option-" + c + "-" + e[b], onFocus: i, onSelect: r, option: e, optionIndex: c, ref: function (e) { l(e, y) }, removeValue: f, selectValue: v }, h(e, c, o)) }) }; exports.defaultMenuRenderer = f, f.propTypes = { focusOption: u.default.func, focusedOption: u.default.object, inputValue: u.default.string, instancePrefix: u.default.string, onFocus: u.default.func, onOptionRef: u.default.func, onSelect: u.default.func, optionClassName: u.default.string, optionComponent: u.default.func, optionRenderer: u.default.func, options: u.default.array, removeValue: u.default.func, selectValue: u.default.func, valueArray: u.default.array, valueKey: u.default.string }; var v = function (e) { e.preventDefault(), e.stopPropagation(), "A" === e.target.tagName && "href" in e.target && (e.target.target ? window.open(e.target.href, e.target.target) : window.location.href = e.target.href) }, E = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, b = function () { function e(e) { this.value = e } function t(t) { var u, n; function s(u, n) { try { var a = t[u](n), i = a.value; i instanceof e ? Promise.resolve(i.value).then(function (e) { s("next", e) }, function (e) { s("throw", e) }) : o(a.done ? "return" : "normal", a.value) } catch (l) { o("throw", l) } } function o(e, t) { switch (e) { case "return": u.resolve({ value: t, done: !0 }); break; case "throw": u.reject(t); break; default: u.resolve({ value: t, done: !1 }) }(u = u.next) ? s(u.key, u.arg) : n = null } this._invoke = function (e, t) { return new Promise(function (o, a) { var i = { key: e, arg: t, resolve: o, reject: a, next: null }; n ? n = n.next = i : (u = n = i, s(e, t)) }) }, "function" != typeof t.return && (this.return = void 0) } return "function" == typeof Symbol && Symbol.asyncIterator && (t.prototype[Symbol.asyncIterator] = function () { return this }), t.prototype.next = function (e) { return this._invoke("next", e) }, t.prototype.throw = function (e) { return this._invoke("throw", e) }, t.prototype.return = function (e) { return this._invoke("return", e) }, { wrap: function (e) { return function () { return new t(e.apply(this, arguments)) } }, await: function (t) { return new e(t) } } }(), g = function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }, y = function () { function e(e, t) { for (var u = 0; u < t.length; u++) { var n = t[u]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, u, n) { return u && e(t.prototype, u), n && e(t, n), t } }(), m = function (e, t, u) { return t in e ? Object.defineProperty(e, t, { value: u, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = u, e }, C = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) { var u = arguments[t]; for (var n in u) Object.prototype.hasOwnProperty.call(u, n) && (e[n] = u[n]) } return e }, F = function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) }, O = function (e, t) { var u = {}; for (var n in e) t.indexOf(n) >= 0 || Object.prototype.hasOwnProperty.call(e, n) && (u[n] = e[n]); return u }, A = function (e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t }, D = function (e) { function u(e) { g(this, u); var t = A(this, (u.__proto__ || Object.getPrototypeOf(u)).call(this, e)); return t.handleMouseDown = t.handleMouseDown.bind(t), t.handleMouseEnter = t.handleMouseEnter.bind(t), t.handleMouseMove = t.handleMouseMove.bind(t), t.handleTouchStart = t.handleTouchStart.bind(t), t.handleTouchEnd = t.handleTouchEnd.bind(t), t.handleTouchMove = t.handleTouchMove.bind(t), t.onFocus = t.onFocus.bind(t), t } return F(u, e), y(u, [{ key: "handleMouseDown", value: function (e) { e.preventDefault(), e.stopPropagation(), this.props.onSelect(this.props.option, e) } }, { key: "handleMouseEnter", value: function (e) { this.onFocus(e) } }, { key: "handleMouseMove", value: function (e) { this.onFocus(e) } }, { key: "handleTouchEnd", value: function (e) { this.dragging || this.handleMouseDown(e) } }, { key: "handleTouchMove", value: function () { this.dragging = !0 } }, { key: "handleTouchStart", value: function () { this.dragging = !1 } }, { key: "onFocus", value: function (e) { this.props.isFocused || this.props.onFocus(this.props.option, e) } }, { key: "render", value: function () { var e = this.props, u = e.option, s = e.instancePrefix, o = e.optionIndex, a = (0, t.default)(this.props.className, u.className); return u.disabled ? n.default.createElement("div", { className: a, onMouseDown: v, onClick: v }, this.props.children) : n.default.createElement("div", { className: a, style: u.style, role: "option", "aria-label": u.label, onMouseDown: this.handleMouseDown, onMouseEnter: this.handleMouseEnter, onMouseMove: this.handleMouseMove, onTouchStart: this.handleTouchStart, onTouchMove: this.handleTouchMove, onTouchEnd: this.handleTouchEnd, id: s + "-option-" + o, title: u.title }, this.props.children) } }]), u }(n.default.Component); exports.Option = D, D.propTypes = { children: u.default.node, className: u.default.string, instancePrefix: u.default.string.isRequired, isDisabled: u.default.bool, isFocused: u.default.bool, isSelected: u.default.bool, onFocus: u.default.func, onSelect: u.default.func, onUnfocus: u.default.func, option: u.default.object.isRequired, optionIndex: u.default.number }; var k = function (e) { function u(e) { g(this, u); var t = A(this, (u.__proto__ || Object.getPrototypeOf(u)).call(this, e)); return t.handleMouseDown = t.handleMouseDown.bind(t), t.onRemove = t.onRemove.bind(t), t.handleTouchEndRemove = t.handleTouchEndRemove.bind(t), t.handleTouchMove = t.handleTouchMove.bind(t), t.handleTouchStart = t.handleTouchStart.bind(t), t } return F(u, e), y(u, [{ key: "handleMouseDown", value: function (e) { if ("mousedown" !== e.type || 0 === e.button) return this.props.onClick ? (e.stopPropagation(), void this.props.onClick(this.props.value, e)) : void (this.props.value.href && e.stopPropagation()) } }, { key: "onRemove", value: function (e) { e.preventDefault(), e.stopPropagation(), this.props.onRemove(this.props.value) } }, { key: "handleTouchEndRemove", value: function (e) { this.dragging || this.onRemove(e) } }, { key: "handleTouchMove", value: function () { this.dragging = !0 } }, { key: "handleTouchStart", value: function () { this.dragging = !1 } }, { key: "renderRemoveIcon", value: function () { if (!this.props.disabled && this.props.onRemove) return n.default.createElement("span", { className: "Select-value-icon", "aria-hidden": "true", onMouseDown: this.onRemove, onTouchEnd: this.handleTouchEndRemove, onTouchStart: this.handleTouchStart, onTouchMove: this.handleTouchMove }, "×") } }, { key: "renderLabel", value: function () { return this.props.onClick || this.props.value.href ? n.default.createElement("a", { className: "Select-value-label", href: this.props.value.href, target: this.props.value.target, onMouseDown: this.handleMouseDown, onTouchEnd: this.handleMouseDown }, this.props.children) : n.default.createElement("span", { className: "Select-value-label", role: "option", "aria-selected": "true", id: this.props.id }, this.props.children) } }, { key: "render", value: function () { return n.default.createElement("div", { className: (0, t.default)("Select-value", this.props.value.disabled ? "Select-value-disabled" : "", this.props.value.className), style: this.props.value.style, title: this.props.value.title }, this.renderRemoveIcon(), this.renderLabel()) } }]), u }(n.default.Component); exports.Value = k, k.propTypes = { children: u.default.node, disabled: u.default.bool, id: u.default.string, onClick: u.default.func, onRemove: u.default.func, value: u.default.object.isRequired }; var w = function (e) { return "string" == typeof e ? e : null !== e && JSON.stringify(e) || "" }, S = u.default.oneOfType([u.default.string, u.default.node]), V = u.default.oneOfType([u.default.string, u.default.number]), T = 1, P = function (e, t) { var u = e.inputValue, n = e.isPseudoFocused, s = e.isFocused, o = t.onSelectResetsInput; return !u || !o && !(!s && n || s && !n) }, B = function (e, t, u) { var n = e.inputValue, s = e.isPseudoFocused, o = e.isFocused, a = t.onSelectResetsInput; return !n || !a && !u && !s && !o }, x = function (e, t) { var u = void 0 === e ? "undefined" : E(e); if ("string" !== u && "number" !== u && "boolean" !== u) return e; var n = t.options, s = t.valueKey; if (n) for (var o = 0; o < n.length; o++)if (String(n[o][s]) === String(e)) return n[o] }, R = function (e, t) { return !e || (t ? 0 === e.length : 0 === Object.keys(e).length) }, M = function (u) { function o(e) { g(this, o); var t = A(this, (o.__proto__ || Object.getPrototypeOf(o)).call(this, e)); return ["clearValue", "focusOption", "getOptionLabel", "handleInputBlur", "handleInputChange", "handleInputFocus", "handleInputValueChange", "handleKeyDown", "handleMenuScroll", "handleMouseDown", "handleMouseDownOnArrow", "handleMouseDownOnMenu", "handleTouchEnd", "handleTouchEndClearValue", "handleTouchMove", "handleTouchOutside", "handleTouchStart", "handleValueClick", "onOptionRef", "removeValue", "selectValue"].forEach(function (e) { return t[e] = t[e].bind(t) }), t.state = { inputValue: "", isFocused: !1, isOpen: !1, isPseudoFocused: !1, required: !1 }, t } return F(o, u), y(o, [{ key: "componentWillMount", value: function () { this._instancePrefix = "react-select-" + (this.props.instanceId || ++T) + "-"; var e = this.getValueArray(this.props.value); this.props.required && this.setState({ required: R(e[0], this.props.multi) }) } }, { key: "componentDidMount", value: function () { void 0 !== this.props.autofocus && "undefined" != typeof console && console.warn("Warning: The autofocus prop has changed to autoFocus, support will be removed after react-select@1.0"), (this.props.autoFocus || this.props.autofocus) && this.focus() } }, { key: "componentWillReceiveProps", value: function (e) { var t = this.getValueArray(e.value, e); e.required ? this.setState({ required: R(t[0], e.multi) }) : this.props.required && this.setState({ required: !1 }), this.state.inputValue && this.props.value !== e.value && e.onSelectResetsInput && this.setState({ inputValue: this.handleInputValueChange("") }) } }, { key: "componentDidUpdate", value: function (e, t) { if (this.menu && this.focused && this.state.isOpen && !this.hasScrolledToOption) { var u = (0, s.findDOMNode)(this.focused), n = (0, s.findDOMNode)(this.menu), o = n.scrollTop, a = o + n.offsetHeight, i = u.offsetTop, l = i + u.offsetHeight; (o > i || a < l) && (n.scrollTop = u.offsetTop), this.hasScrolledToOption = !0 } else this.state.isOpen || (this.hasScrolledToOption = !1); if (this._scrollToFocusedOptionOnUpdate && this.focused && this.menu) { this._scrollToFocusedOptionOnUpdate = !1; var r = (0, s.findDOMNode)(this.focused), p = (0, s.findDOMNode)(this.menu), c = r.getBoundingClientRect(), h = p.getBoundingClientRect(); c.bottom > h.bottom ? p.scrollTop = r.offsetTop + r.clientHeight - p.offsetHeight : c.top < h.top && (p.scrollTop = r.offsetTop) } if (this.props.scrollMenuIntoView && this.menuContainer) { var d = this.menuContainer.getBoundingClientRect(); window.innerHeight < d.bottom + this.props.menuBuffer && window.scrollBy(0, d.bottom + this.props.menuBuffer - window.innerHeight) } if (e.disabled !== this.props.disabled && (this.setState({ isFocused: !1 }), this.closeMenu()), t.isOpen !== this.state.isOpen) { this.toggleTouchOutsideEvent(this.state.isOpen); var f = this.state.isOpen ? this.props.onOpen : this.props.onClose; f && f() } } }, { key: "componentWillUnmount", value: function () { this.toggleTouchOutsideEvent(!1) } }, { key: "toggleTouchOutsideEvent", value: function (e) { var t = e ? document.addEventListener ? "addEventListener" : "attachEvent" : document.removeEventListener ? "removeEventListener" : "detachEvent", u = document.addEventListener ? "" : "on"; document[t](u + "touchstart", this.handleTouchOutside), document[t](u + "mousedown", this.handleTouchOutside) } }, { key: "handleTouchOutside", value: function (e) { this.wrapper && !this.wrapper.contains(e.target) && this.closeMenu() } }, { key: "focus", value: function () { this.input && this.input.focus() } }, { key: "blurInput", value: function () { this.input && this.input.blur() } }, { key: "handleTouchMove", value: function () { this.dragging = !0 } }, { key: "handleTouchStart", value: function () { this.dragging = !1 } }, { key: "handleTouchEnd", value: function (e) { this.dragging || this.handleMouseDown(e) } }, { key: "handleTouchEndClearValue", value: function (e) { this.dragging || this.clearValue(e) } }, { key: "handleMouseDown", value: function (e) { if (!(this.props.disabled || "mousedown" === e.type && 0 !== e.button)) if ("INPUT" !== e.target.tagName) { if (e.preventDefault(), !this.props.searchable) return this.focus(), this.setState({ isOpen: !this.state.isOpen, focusedOption: null }); if (this.state.isFocused) { this.focus(); var t = this.input, u = !0; "function" == typeof t.getInput && (t = t.getInput()), t.value = "", this._focusAfterClear && (u = !1, this._focusAfterClear = !1), this.setState({ isOpen: u, isPseudoFocused: !1, focusedOption: null }) } else this._openAfterFocus = this.props.openOnClick, this.focus(), this.setState({ focusedOption: null }) } else this.state.isFocused ? this.state.isOpen || this.setState({ isOpen: !0, isPseudoFocused: !1, focusedOption: null }) : (this._openAfterFocus = this.props.openOnClick, this.focus()) } }, { key: "handleMouseDownOnArrow", value: function (e) { this.props.disabled || "mousedown" === e.type && 0 !== e.button || (this.state.isOpen ? (e.stopPropagation(), e.preventDefault(), this.closeMenu()) : this.setState({ isOpen: !0 })) } }, { key: "handleMouseDownOnMenu", value: function (e) { this.props.disabled || "mousedown" === e.type && 0 !== e.button || (e.stopPropagation(), e.preventDefault(), this._openAfterFocus = !0, this.focus()) } }, { key: "closeMenu", value: function () { this.props.onCloseResetsInput ? this.setState({ inputValue: this.handleInputValueChange(""), isOpen: !1, isPseudoFocused: this.state.isFocused && !this.props.multi }) : this.setState({ isOpen: !1, isPseudoFocused: this.state.isFocused && !this.props.multi }), this.hasScrolledToOption = !1 } }, { key: "handleInputFocus", value: function (e) { if (!this.props.disabled) { var t = this.state.isOpen || this._openAfterFocus || this.props.openOnFocus; t = !this._focusAfterClear && t, this.props.onFocus && this.props.onFocus(e), this.setState({ isFocused: !0, isOpen: !!t }), this._focusAfterClear = !1, this._openAfterFocus = !1 } } }, { key: "handleInputBlur", value: function (e) { if (!this.menu || this.menu !== document.activeElement && !this.menu.contains(document.activeElement)) { this.props.onBlur && this.props.onBlur(e); var t = { isFocused: !1, isOpen: !1, isPseudoFocused: !1 }; this.props.onBlurResetsInput && (t.inputValue = this.handleInputValueChange("")), this.setState(t) } else this.focus() } }, { key: "handleInputChange", value: function (e) { var t = e.target.value; this.state.inputValue !== e.target.value && (t = this.handleInputValueChange(t)), this.setState({ inputValue: t, isOpen: !0, isPseudoFocused: !1 }) } }, { key: "setInputValue", value: function (e) { if (this.props.onInputChange) { var t = this.props.onInputChange(e); null != t && "object" !== (void 0 === t ? "undefined" : E(t)) && (e = "" + t) } this.setState({ inputValue: e }) } }, { key: "handleInputValueChange", value: function (e) { if (this.props.onInputChange) { var t = this.props.onInputChange(e); null != t && "object" !== (void 0 === t ? "undefined" : E(t)) && (e = "" + t) } return e } }, { key: "handleKeyDown", value: function (e) { if (!(this.props.disabled || "function" == typeof this.props.onInputKeyDown && (this.props.onInputKeyDown(e), e.defaultPrevented))) switch (e.keyCode) { case 8: !this.state.inputValue && this.props.backspaceRemoves && (e.preventDefault(), this.popValue()); break; case 9: if (e.shiftKey || !this.state.isOpen || !this.props.tabSelectsValue) break; e.preventDefault(), this.selectFocusedOption(); break; case 13: e.preventDefault(), e.stopPropagation(), this.state.isOpen ? this.selectFocusedOption() : this.focusNextOption(); break; case 27: e.preventDefault(), this.state.isOpen ? (this.closeMenu(), e.stopPropagation()) : this.props.clearable && this.props.escapeClearsValue && (this.clearValue(e), e.stopPropagation()); break; case 32: if (this.props.searchable) break; if (e.preventDefault(), !this.state.isOpen) { this.focusNextOption(); break } e.stopPropagation(), this.selectFocusedOption(); break; case 38: e.preventDefault(), this.focusPreviousOption(); break; case 40: e.preventDefault(), this.focusNextOption(); break; case 33: e.preventDefault(), this.focusPageUpOption(); break; case 34: e.preventDefault(), this.focusPageDownOption(); break; case 35: if (e.shiftKey) break; e.preventDefault(), this.focusEndOption(); break; case 36: if (e.shiftKey) break; e.preventDefault(), this.focusStartOption(); break; case 46: !this.state.inputValue && this.props.deleteRemoves && (e.preventDefault(), this.popValue()) } } }, { key: "handleValueClick", value: function (e, t) { this.props.onValueClick && this.props.onValueClick(e, t) } }, { key: "handleMenuScroll", value: function (e) { if (this.props.onMenuScrollToBottom) { var t = e.target; t.scrollHeight > t.offsetHeight && t.scrollHeight - t.offsetHeight - t.scrollTop <= 0 && this.props.onMenuScrollToBottom() } } }, { key: "getOptionLabel", value: function (e) { return e[this.props.labelKey] } }, { key: "getValueArray", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : void 0, u = "object" === (void 0 === t ? "undefined" : E(t)) ? t : this.props; if (u.multi) { if ("string" == typeof e && (e = e.split(u.delimiter)), !Array.isArray(e)) { if (null == e) return []; e = [e] } return e.map(function (e) { return x(e, u) }).filter(function (e) { return e }) } var n = x(e, u); return n ? [n] : [] } }, { key: "setValue", value: function (e) { var t = this; if (this.props.autoBlur && this.blurInput(), this.props.required) { var u = R(e, this.props.multi); this.setState({ required: u }) } this.props.simpleValue && e && (e = this.props.multi ? e.map(function (e) { return e[t.props.valueKey] }).join(this.props.delimiter) : e[this.props.valueKey]), this.props.onChange && this.props.onChange(e) } }, { key: "selectValue", value: function (e) { var t = this; this.props.closeOnSelect && (this.hasScrolledToOption = !1); var u = this.props.onSelectResetsInput ? "" : this.state.inputValue; this.props.multi ? this.setState({ focusedIndex: null, inputValue: this.handleInputValueChange(u), isOpen: !this.props.closeOnSelect }, function () { t.getValueArray(t.props.value).some(function (u) { return u[t.props.valueKey] === e[t.props.valueKey] }) ? t.removeValue(e) : t.addValue(e) }) : this.setState({ inputValue: this.handleInputValueChange(u), isOpen: !this.props.closeOnSelect, isPseudoFocused: this.state.isFocused }, function () { t.setValue(e) }) } }, { key: "addValue", value: function (e) { var t = this.getValueArray(this.props.value), u = this._visibleOptions.filter(function (e) { return !e.disabled }), n = u.indexOf(e); this.setValue(t.concat(e)), this.props.closeOnSelect && (u.length - 1 === n ? this.focusOption(u[n - 1]) : u.length > n && this.focusOption(u[n + 1])) } }, { key: "popValue", value: function () { var e = this.getValueArray(this.props.value); e.length && !1 !== e[e.length - 1].clearableValue && this.setValue(this.props.multi ? e.slice(0, e.length - 1) : null) } }, { key: "removeValue", value: function (e) { var t = this, u = this.getValueArray(this.props.value); this.setValue(u.filter(function (u) { return u[t.props.valueKey] !== e[t.props.valueKey] })), this.focus() } }, { key: "clearValue", value: function (e) { e && "mousedown" === e.type && 0 !== e.button || (e.preventDefault(), this.setValue(this.getResetValue()), this.setState({ inputValue: this.handleInputValueChange(""), isOpen: !1 }, this.focus), this._focusAfterClear = !0) } }, { key: "getResetValue", value: function () { return void 0 !== this.props.resetValue ? this.props.resetValue : this.props.multi ? [] : null } }, { key: "focusOption", value: function (e) { this.setState({ focusedOption: e }) } }, { key: "focusNextOption", value: function () { this.focusAdjacentOption("next") } }, { key: "focusPreviousOption", value: function () { this.focusAdjacentOption("previous") } }, { key: "focusPageUpOption", value: function () { this.focusAdjacentOption("page_up") } }, { key: "focusPageDownOption", value: function () { this.focusAdjacentOption("page_down") } }, { key: "focusStartOption", value: function () { this.focusAdjacentOption("start") } }, { key: "focusEndOption", value: function () { this.focusAdjacentOption("end") } }, { key: "focusAdjacentOption", value: function (e) { var t = this._visibleOptions.map(function (e, t) { return { option: e, index: t } }).filter(function (e) { return !e.option.disabled }); if (this._scrollToFocusedOptionOnUpdate = !0, !this.state.isOpen) { var u = { focusedOption: this._focusedOption || (t.length ? t["next" === e ? 0 : t.length - 1].option : null), isOpen: !0 }; return this.props.onSelectResetsInput && (u.inputValue = ""), void this.setState(u) } if (t.length) { for (var n = -1, s = 0; s < t.length; s++)if (this._focusedOption === t[s].option) { n = s; break } if ("next" === e && -1 !== n) n = (n + 1) % t.length; else if ("previous" === e) n > 0 ? n -= 1 : n = t.length - 1; else if ("start" === e) n = 0; else if ("end" === e) n = t.length - 1; else if ("page_up" === e) { var o = n - this.props.pageSize; n = o < 0 ? 0 : o } else if ("page_down" === e) { var a = n + this.props.pageSize; n = a > t.length - 1 ? t.length - 1 : a } -1 === n && (n = 0), this.setState({ focusedIndex: t[n].index, focusedOption: t[n].option }) } } }, { key: "getFocusedOption", value: function () { return this._focusedOption } }, { key: "selectFocusedOption", value: function () { if (this._focusedOption) return this.selectValue(this._focusedOption) } }, { key: "renderLoading", value: function () { if (this.props.isLoading) return n.default.createElement("span", { className: "Select-loading-zone", "aria-hidden": "true" }, n.default.createElement("span", { className: "Select-loading" })) } }, { key: "renderValue", value: function (e, t) { var u = this, s = this.props.valueRenderer || this.getOptionLabel, o = this.props.valueComponent; if (!e.length) return B(this.state, this.props, t) ? n.default.createElement("div", { className: "Select-placeholder" }, this.props.placeholder) : null; var a = this.props.onValueClick ? this.handleValueClick : null; return this.props.multi ? e.map(function (t, i) { return n.default.createElement(o, { disabled: u.props.disabled || !1 === t.clearableValue, id: u._instancePrefix + "-value-" + i, instancePrefix: u._instancePrefix, key: "value-" + i + "-" + t[u.props.valueKey], onClick: a, onRemove: u.removeValue, placeholder: u.props.placeholder, value: t, values: e }, s(t, i), n.default.createElement("span", { className: "Select-aria-only" }, " ")) }) : P(this.state, this.props) ? (t && (a = null), n.default.createElement(o, { disabled: this.props.disabled, id: this._instancePrefix + "-value-item", instancePrefix: this._instancePrefix, onClick: a, placeholder: this.props.placeholder, value: e[0] }, s(e[0]))) : void 0 } }, { key: "renderInput", value: function (u, s) { var o, a = this, i = (0, t.default)("Select-input", this.props.inputProps.className), l = this.state.isOpen, r = (0, t.default)((m(o = {}, this._instancePrefix + "-list", l), m(o, this._instancePrefix + "-backspace-remove-message", this.props.multi && !this.props.disabled && this.state.isFocused && !this.state.inputValue), o)), p = this.state.inputValue; !p || this.props.onSelectResetsInput || this.state.isFocused || (p = ""); var c = C({}, this.props.inputProps, { "aria-activedescendant": l ? this._instancePrefix + "-option-" + s : this._instancePrefix + "-value", "aria-describedby": this.props["aria-describedby"], "aria-expanded": "" + l, "aria-haspopup": "" + l, "aria-label": this.props["aria-label"], "aria-labelledby": this.props["aria-labelledby"], "aria-owns": r, onBlur: this.handleInputBlur, onChange: this.handleInputChange, onFocus: this.handleInputFocus, ref: function (e) { return a.input = e }, role: "combobox", required: this.state.required, tabIndex: this.props.tabIndex, value: p }); if (this.props.inputRenderer) return this.props.inputRenderer(c); if (this.props.disabled || !this.props.searchable) { var h = O(this.props.inputProps, []), d = (0, t.default)(m({}, this._instancePrefix + "-list", l)); return n.default.createElement("div", C({}, h, { "aria-expanded": l, "aria-owns": d, "aria-activedescendant": l ? this._instancePrefix + "-option-" + s : this._instancePrefix + "-value", "aria-disabled": "" + this.props.disabled, "aria-label": this.props["aria-label"], "aria-labelledby": this.props["aria-labelledby"], className: i, onBlur: this.handleInputBlur, onFocus: this.handleInputFocus, ref: function (e) { return a.input = e }, role: "combobox", style: { border: 0, width: 1, display: "inline-block" }, tabIndex: this.props.tabIndex || 0 })) } return this.props.autosize ? n.default.createElement(e.default, C({ id: this.props.id }, c, { className: i, minWidth: "5" })) : n.default.createElement("div", { className: i, key: "input-wrap", style: { display: "inline-block" } }, n.default.createElement("input", C({ id: this.props.id }, c))) } }, { key: "renderClear", value: function () { var e = this.getValueArray(this.props.value); if (this.props.clearable && e.length && !this.props.disabled && !this.props.isLoading) { var t = this.props.multi ? this.props.clearAllText : this.props.clearValueText, u = this.props.clearRenderer(); return n.default.createElement("span", { "aria-label": t, className: "Select-clear-zone", onMouseDown: this.clearValue, onTouchEnd: this.handleTouchEndClearValue, onTouchMove: this.handleTouchMove, onTouchStart: this.handleTouchStart, title: t }, u) } } }, { key: "renderArrow", value: function () { if (this.props.arrowRenderer) { var e = this.handleMouseDownOnArrow, t = this.state.isOpen, u = this.props.arrowRenderer({ onMouseDown: e, isOpen: t }); return u ? n.default.createElement("span", { className: "Select-arrow-zone", onMouseDown: e }, u) : null } } }, { key: "filterOptions", value: function (e) { var t = this.state.inputValue, u = this.props.options || []; if (this.props.filterOptions) { var n = "function" == typeof this.props.filterOptions ? this.props.filterOptions : d; return n(u, t, e, { filterOption: this.props.filterOption, ignoreAccents: this.props.ignoreAccents, ignoreCase: this.props.ignoreCase, labelKey: this.props.labelKey, matchPos: this.props.matchPos, matchProp: this.props.matchProp, trimFilter: this.props.trimFilter, valueKey: this.props.valueKey }) } return u } }, { key: "onOptionRef", value: function (e, t) { t && (this.focused = e) } }, { key: "renderMenu", value: function (e, t, u) { return e && e.length ? this.props.menuRenderer({ focusedOption: u, focusOption: this.focusOption, inputValue: this.state.inputValue, instancePrefix: this._instancePrefix, labelKey: this.props.labelKey, onFocus: this.focusOption, onOptionRef: this.onOptionRef, onSelect: this.selectValue, optionClassName: this.props.optionClassName, optionComponent: this.props.optionComponent, optionRenderer: this.props.optionRenderer || this.getOptionLabel, options: e, removeValue: this.removeValue, selectValue: this.selectValue, valueArray: t, valueKey: this.props.valueKey }) : this.props.noResultsText ? n.default.createElement("div", { className: "Select-noresults" }, this.props.noResultsText) : null } }, { key: "renderHiddenField", value: function (e) { var t = this; if (this.props.name) { if (this.props.joinValues) { var u = e.map(function (e) { return w(e[t.props.valueKey]) }).join(this.props.delimiter); return n.default.createElement("input", { disabled: this.props.disabled, name: this.props.name, ref: function (e) { return t.value = e }, type: "hidden", value: u }) } return e.map(function (e, u) { return n.default.createElement("input", { disabled: t.props.disabled, key: "hidden." + u, name: t.props.name, ref: "value" + u, type: "hidden", value: w(e[t.props.valueKey]) }) }) } } }, { key: "getFocusableOptionIndex", value: function (e) { var t = this._visibleOptions; if (!t.length) return null; var u = this.props.valueKey, n = this.state.focusedOption || e; if (n && !n.disabled) { var s = -1; if (t.some(function (e, t) { var o = e[u] === n[u]; return o && (s = t), o }), -1 !== s) return s } for (var o = 0; o < t.length; o++)if (!t[o].disabled) return o; return null } }, { key: "renderOuter", value: function (e, t, u) { var s = this, o = this.renderMenu(e, t, u); return o ? n.default.createElement("div", { ref: function (e) { return s.menuContainer = e }, className: "Select-menu-outer", style: this.props.menuContainerStyle }, n.default.createElement("div", { className: "Select-menu", id: this._instancePrefix + "-list", onMouseDown: this.handleMouseDownOnMenu, onScroll: this.handleMenuScroll, ref: function (e) { return s.menu = e }, role: "listbox", style: this.props.menuStyle, tabIndex: -1 }, o)) : null } }, { key: "render", value: function () { var e = this, u = this.getValueArray(this.props.value), s = this._visibleOptions = this.filterOptions(this.props.multi && this.props.removeSelected ? u : null), o = this.state.isOpen; this.props.multi && !s.length && u.length && !this.state.inputValue && (o = !1); var a = this.getFocusableOptionIndex(u[0]), i = null; i = this._focusedOption = null !== a ? s[a] : null; var l = (0, t.default)("Select", this.props.className, { "has-value": u.length, "is-clearable": this.props.clearable, "is-disabled": this.props.disabled, "is-focused": this.state.isFocused, "is-loading": this.props.isLoading, "is-open": o, "is-pseudo-focused": this.state.isPseudoFocused, "is-searchable": this.props.searchable, "Select--multi": this.props.multi, "Select--rtl": this.props.rtl, "Select--single": !this.props.multi }), r = null; return this.props.multi && !this.props.disabled && u.length && !this.state.inputValue && this.state.isFocused && this.props.backspaceRemoves && (r = n.default.createElement("span", { id: this._instancePrefix + "-backspace-remove-message", className: "Select-aria-only", "aria-live": "assertive" }, this.props.backspaceToRemoveMessage.replace("{label}", u[u.length - 1][this.props.labelKey]))), n.default.createElement("div", { ref: function (t) { return e.wrapper = t }, className: l, style: this.props.wrapperStyle }, this.renderHiddenField(u), n.default.createElement("div", { ref: function (t) { return e.control = t }, className: "Select-control", onKeyDown: this.handleKeyDown, onMouseDown: this.handleMouseDown, onTouchEnd: this.handleTouchEnd, onTouchMove: this.handleTouchMove, onTouchStart: this.handleTouchStart, style: this.props.style }, n.default.createElement("div", { className: "Select-multi-value-wrapper", id: this._instancePrefix + "-value" }, this.renderValue(u, o), this.renderInput(u, a)), r, this.renderLoading(), this.renderClear(), this.renderArrow()), o ? this.renderOuter(s, u, i) : null) } }]), o }(n.default.Component); M.propTypes = { "aria-describedby": u.default.string, "aria-label": u.default.string, "aria-labelledby": u.default.string, arrowRenderer: u.default.func, autoBlur: u.default.bool, autoFocus: u.default.bool, autofocus: u.default.bool, autosize: u.default.bool, backspaceRemoves: u.default.bool, backspaceToRemoveMessage: u.default.string, className: u.default.string, clearAllText: S, clearRenderer: u.default.func, clearValueText: S, clearable: u.default.bool, closeOnSelect: u.default.bool, deleteRemoves: u.default.bool, delimiter: u.default.string, disabled: u.default.bool, escapeClearsValue: u.default.bool, filterOption: u.default.func, filterOptions: u.default.any, id: u.default.string, ignoreAccents: u.default.bool, ignoreCase: u.default.bool, inputProps: u.default.object, inputRenderer: u.default.func, instanceId: u.default.string, isLoading: u.default.bool, joinValues: u.default.bool, labelKey: u.default.string, matchPos: u.default.string, matchProp: u.default.string, menuBuffer: u.default.number, menuContainerStyle: u.default.object, menuRenderer: u.default.func, menuStyle: u.default.object, multi: u.default.bool, name: u.default.string, noResultsText: S, onBlur: u.default.func, onBlurResetsInput: u.default.bool, onChange: u.default.func, onClose: u.default.func, onCloseResetsInput: u.default.bool, onFocus: u.default.func, onInputChange: u.default.func, onInputKeyDown: u.default.func, onMenuScrollToBottom: u.default.func, onOpen: u.default.func, onSelectResetsInput: u.default.bool, onValueClick: u.default.func, openOnClick: u.default.bool, openOnFocus: u.default.bool, optionClassName: u.default.string, optionComponent: u.default.func, optionRenderer: u.default.func, options: u.default.array, pageSize: u.default.number, placeholder: S, removeSelected: u.default.bool, required: u.default.bool, resetValue: u.default.any, rtl: u.default.bool, scrollMenuIntoView: u.default.bool, searchable: u.default.bool, simpleValue: u.default.bool, style: u.default.object, tabIndex: V, tabSelectsValue: u.default.bool, trimFilter: u.default.bool, value: u.default.any, valueComponent: u.default.func, valueKey: u.default.string, valueRenderer: u.default.func, wrapperStyle: u.default.object }, M.defaultProps = { arrowRenderer: i, autosize: !0, backspaceRemoves: !0, backspaceToRemoveMessage: "Press backspace to remove {label}", clearable: !0, clearAllText: "Clear all", clearRenderer: l, clearValueText: "Clear value", closeOnSelect: !0, deleteRemoves: !0, delimiter: ",", disabled: !1, escapeClearsValue: !0, filterOptions: d, ignoreAccents: !0, ignoreCase: !0, inputProps: {}, isLoading: !1, joinValues: !1, labelKey: "label", matchPos: "any", matchProp: "any", menuBuffer: 0, menuRenderer: f, multi: !1, noResultsText: "No results found", onBlurResetsInput: !0, onCloseResetsInput: !0, onSelectResetsInput: !0, openOnClick: !0, optionComponent: D, pageSize: 5, placeholder: "Select...", removeSelected: !0, required: !1, rtl: !1, scrollMenuIntoView: !0, searchable: !0, simpleValue: !1, tabSelectsValue: !0, trimFilter: !0, valueComponent: k, valueKey: "value" }; var I = { autoload: u.default.bool.isRequired, cache: u.default.any, children: u.default.func.isRequired, ignoreAccents: u.default.bool, ignoreCase: u.default.bool, loadOptions: u.default.func.isRequired, loadingPlaceholder: u.default.oneOfType([u.default.string, u.default.node]), multi: u.default.bool, noResultsText: u.default.oneOfType([u.default.string, u.default.node]), onChange: u.default.func, onInputChange: u.default.func, options: u.default.array.isRequired, placeholder: u.default.oneOfType([u.default.string, u.default.node]), searchPromptText: u.default.oneOfType([u.default.string, u.default.node]), value: u.default.any }, _ = {}, K = function (e) { return n.default.createElement(M, e) }, N = { autoload: !0, cache: _, children: K, ignoreAccents: !0, ignoreCase: !0, loadingPlaceholder: "Loading...", options: [], searchPromptText: "Type to search" }, j = function (e) { function t(e, u) { g(this, t); var n = A(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, u)); return n._cache = e.cache === _ ? {} : e.cache, n.state = { inputValue: "", isLoading: !1, options: e.options }, n.onInputChange = n.onInputChange.bind(n), n } return F(t, e), y(t, [{ key: "componentDidMount", value: function () { this.props.autoload && this.loadOptions("") } }, { key: "componentWillReceiveProps", value: function (e) { e.options !== this.props.options && this.setState({ options: e.options }) } }, { key: "componentWillUnmount", value: function () { this._callback = null } }, { key: "loadOptions", value: function (e) { var t = this, u = this.props.loadOptions, n = this._cache; if (n && Object.prototype.hasOwnProperty.call(n, e)) return this._callback = null, void this.setState({ isLoading: !1, options: n[e] }); var s = function u(s, o) { var a = o && o.options || []; n && (n[e] = a), u === t._callback && (t._callback = null, t.setState({ isLoading: !1, options: a })) }; this._callback = s; var o = u(e, s); o && o.then(function (e) { return s(0, e) }, function (e) { return s() }), this._callback && !this.state.isLoading && this.setState({ isLoading: !0 }) } }, { key: "onInputChange", value: function (e) { var t = this.props, u = t.ignoreAccents, n = t.ignoreCase, s = t.onInputChange, o = e; if (s) { var a = s(o); null != a && "object" !== (void 0 === a ? "undefined" : E(a)) && (o = "" + a) } var i = o; return u && (i = p(i)), n && (i = i.toLowerCase()), this.setState({ inputValue: o }), this.loadOptions(i), o } }, { key: "noResultsText", value: function () { var e = this.props, t = e.loadingPlaceholder, u = e.noResultsText, n = e.searchPromptText, s = this.state, o = s.inputValue; return s.isLoading ? t : o && u ? u : n } }, { key: "focus", value: function () { this.select.focus() } }, { key: "render", value: function () { var e = this, t = this.props, u = t.children, n = t.loadingPlaceholder, s = t.placeholder, o = this.state, a = o.isLoading, i = o.options, l = { noResultsText: this.noResultsText(), placeholder: a ? n : s, options: a && n ? [] : i, ref: function (t) { return e.select = t } }; return u(C({}, this.props, l, { isLoading: a, onInputChange: this.onInputChange })) } }]), t }(n.Component); exports.Async = j, j.propTypes = I, j.defaultProps = N; var L = function (e) { function t(e, u) { g(this, t); var n = A(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, u)); return n.filterOptions = n.filterOptions.bind(n), n.menuRenderer = n.menuRenderer.bind(n), n.onInputKeyDown = n.onInputKeyDown.bind(n), n.onInputChange = n.onInputChange.bind(n), n.onOptionSelect = n.onOptionSelect.bind(n), n } return F(t, e), y(t, [{ key: "createNewOption", value: function () { var e = this.props, t = e.isValidNewOption, u = e.newOptionCreator, n = e.onNewOptionClick, s = e.options, o = void 0 === s ? [] : s; if (t({ label: this.inputValue })) { var a = u({ label: this.inputValue, labelKey: this.labelKey, valueKey: this.valueKey }); this.isOptionUnique({ option: a, options: o }) && (n ? n(a) : (o.unshift(a), this.select.selectValue(a))) } } }, { key: "filterOptions", value: function () { var e = this.props, t = e.filterOptions, u = e.isValidNewOption, n = e.promptTextCreator, s = e.showNewOptionAtTop, o = (arguments.length <= 2 ? void 0 : arguments[2]) || [], a = t.apply(void 0, arguments) || []; if (u({ label: this.inputValue })) { var i = this.props.newOptionCreator, l = i({ label: this.inputValue, labelKey: this.labelKey, valueKey: this.valueKey }); if (this.isOptionUnique({ option: l, options: o.concat(a) })) { var r = n(this.inputValue); this._createPlaceholderOption = i({ label: r, labelKey: this.labelKey, valueKey: this.valueKey }), s ? a.unshift(this._createPlaceholderOption) : a.push(this._createPlaceholderOption) } } return a } }, { key: "isOptionUnique", value: function (e) { var t = e.option, u = e.options, n = this.props.isOptionUnique; return u = u || this.props.options, n({ labelKey: this.labelKey, option: t, options: u, valueKey: this.valueKey }) } }, { key: "menuRenderer", value: function (e) { var t = this.props.menuRenderer; return t(C({}, e, { onSelect: this.onOptionSelect, selectValue: this.onOptionSelect })) } }, { key: "onInputChange", value: function (e) { var t = this.props.onInputChange; return this.inputValue = e, t && (this.inputValue = t(e)), this.inputValue } }, { key: "onInputKeyDown", value: function (e) { var t = this.props, u = t.shouldKeyDownEventCreateNewOption, n = t.onInputKeyDown, s = this.select.getFocusedOption(); s && s === this._createPlaceholderOption && u(e) ? (this.createNewOption(), e.preventDefault()) : n && n(e) } }, { key: "onOptionSelect", value: function (e) { e === this._createPlaceholderOption ? this.createNewOption() : this.select.selectValue(e) } }, { key: "focus", value: function () { this.select.focus() } }, { key: "render", value: function () { var e = this, t = this.props, u = t.ref, n = O(t, ["ref"]), s = this.props.children; return s || (s = q), s(C({}, n, { allowCreate: !0, filterOptions: this.filterOptions, menuRenderer: this.menuRenderer, onInputChange: this.onInputChange, onInputKeyDown: this.onInputKeyDown, ref: function (t) { e.select = t, t && (e.labelKey = t.props.labelKey, e.valueKey = t.props.valueKey), u && u(t) } })) } }]), t }(n.default.Component); exports.Creatable = L; var q = function (e) { return n.default.createElement(M, e) }, U = function (e) { var t = e.option, u = e.options, n = e.labelKey, s = e.valueKey; return !u || !u.length || 0 === u.filter(function (e) { return e[n] === t[n] || e[s] === t[s] }).length }, z = function (e) { return !!e.label }, H = function (e) { var t = e.label, u = e.labelKey, n = {}; return n[e.valueKey] = t, n[u] = t, n.className = "Select-create-option-placeholder", n }, W = function (e) { return 'Create option "' + e + '"' }, J = function (e) { switch (e.keyCode) { case 9: case 13: case 188: return !0; default: return !1 } }; L.isOptionUnique = U, L.isValidNewOption = z, L.newOptionCreator = H, L.promptTextCreator = W, L.shouldKeyDownEventCreateNewOption = J, L.defaultProps = { filterOptions: d, isOptionUnique: U, isValidNewOption: z, menuRenderer: f, newOptionCreator: H, promptTextCreator: W, shouldKeyDownEventCreateNewOption: J, showNewOptionAtTop: !0 }, L.propTypes = { children: u.default.func, filterOptions: u.default.any, isOptionUnique: u.default.func, isValidNewOption: u.default.func, menuRenderer: u.default.any, newOptionCreator: u.default.func, onInputChange: u.default.func, onInputKeyDown: u.default.func, onNewOptionClick: u.default.func, options: u.default.array, promptTextCreator: u.default.func, ref: u.default.func, shouldKeyDownEventCreateNewOption: u.default.func, showNewOptionAtTop: u.default.bool }; var Y = function (e) { function t() { return g(this, t), A(this, (t.__proto__ || Object.getPrototypeOf(t)).apply(this, arguments)) } return F(t, e), y(t, [{ key: "focus", value: function () { this.select.focus() } }, { key: "render", value: function () { var e = this; return n.default.createElement(j, this.props, function (t) { var u = t.ref, s = O(t, ["ref"]), o = u; return n.default.createElement(L, s, function (t) { var u = t.ref, n = O(t, ["ref"]), s = u; return e.props.children(C({}, n, { ref: function (t) { s(t), o(t), e.select = t } })) }) }) } }]), t }(n.default.Component); exports.AsyncCreatable = Y; var Z = function (e) { return n.default.createElement(M, e) }; Y.propTypes = { children: u.default.func.isRequired }, Y.defaultProps = { children: Z }, M.Async = j, M.AsyncCreatable = Y, M.Creatable = L, M.Value = k, M.Option = D; var G = M; exports.default = G;
    }, { "react-input-autosize": "xjsR", "classnames": "9qb7", "prop-types": "5D9O", "react": "1n8/", "react-dom": "NKHc" }], "Wdpo": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = b; var e = r(require("react")), t = o(require("react-select")), n = o(require("../../../Utils")); function o(e) { return e && e.__esModule ? e : { default: e } } function r(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; o.get || o.set ? Object.defineProperty(t, n, o) : t[n] = e[n] } return t.default = e, t } function u(e) { return (u = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function l(e, t) { for (var n = 0; n < t.length; n++) { var o = t[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function a(e, t, n) { return t && l(e.prototype, t), n && l(e, n), e } function s(e, t) { return !t || "object" !== u(t) && "function" != typeof t ? c(e) : t } function c(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function p(e) { return (p = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function f(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && h(e, t) } function h(e, t) { return (h = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } var y = function (t) { function n() { return i(this, n), s(this, p(n).apply(this, arguments)) } return f(n, e.Component), a(n, [{ key: "handleMouseDown", value: function (e) { e.preventDefault(), e.stopPropagation(), this.props.onSelect(this.props.option, e) } }, { key: "handleMouseEnter", value: function (e) { this.props.onFocus(this.props.option, e) } }, { key: "handleMouseMove", value: function (e) { this.props.isFocused || this.props.onFocus(this.props.option, e) } }, { key: "render", value: function () { var t = this; return e.createElement("div", { className: this.props.className, onMouseDown: function (e) { t.handleMouseDown(e) }, onMouseEnter: function (e) { t.handleMouseEnter(e) }, onMouseMove: function (e) { t.handleMouseMove(e) }, title: this.props.option.title }, e.createElement(v, { value: this.props.option }, this.props.children)) } }]), n }(), v = function (t) { function n() { return i(this, n), s(this, p(n).apply(this, arguments)) } return f(n, e.Component), a(n, [{ key: "render", value: function () { var t = this.props, n = t.children, o = t.value, r = null; if (o) { var u = o.colour; if (u) { var i = { backgroundColor: u, width: "20px", height: "20px", borderRadius: "50%", marginLeft: "3px", marginRight: "7px", right: "0px" }; r = e.createElement("div", { style: i }) } } return e.createElement("div", { style: { display: "flex", alignItems: "center" }, className: "Select-value" }, r, e.createElement("span", { style: { flexGrow: 1 }, className: "Select-value-label" }, n)) } }]), n }(); function b(o) { var r = o.value, u = o.schema, i = u.enumNames || [], l = u.colours || [], a = u.enum.map(function (e, t) { return { value: e, label: i[t] || e, colour: l[t] } }); return e.createElement(t.default, { options: a, optionComponent: y, valueComponent: v, value: r, searchable: a.length > 6 && !n.default.isTouchDevice(), onChange: function (e) { return e && o.onChange(e.value) } }) }
    }, { "react": "1n8/", "react-select": "2Db4", "../../../Utils": "r8Tc" }], "PwXI": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = r(require("babel-runtime/helpers/extends")), t = r(require("react")); function r(e) { return e && e.__esModule ? e : { default: e } } var l = function (r) { var l = r.className, u = r.included, a = r.vertical, s = r.offset, d = r.length, i = r.style, n = a ? { bottom: s + "%", height: d + "%" } : { left: s + "%", width: d + "%" }, o = (0, e.default)({}, i, n); return u ? t.default.createElement("div", { className: l, style: o }) : null }, u = l; exports.default = u;
    }, { "babel-runtime/helpers/extends": "T4f3", "react": "1n8/" }], "hHLa": [function (require, module, exports) {
        var r = require("./_to-iobject"), e = require("./_object-gopd").f; require("./_object-sap")("getOwnPropertyDescriptor", function () { return function (t, o) { return e(r(t), o) } });
    }, { "./_to-iobject": "Wyka", "./_object-gopd": "sxPs", "./_object-sap": "cOHw" }], "49SQ": [function (require, module, exports) {
        require("../../modules/es6.object.get-own-property-descriptor"); var e = require("../../modules/_core").Object; module.exports = function (r, o) { return e.getOwnPropertyDescriptor(r, o) };
    }, { "../../modules/es6.object.get-own-property-descriptor": "hHLa", "../../modules/_core": "zKeE" }], "DNhI": [function (require, module, exports) {
        module.exports = { default: require("core-js/library/fn/object/get-own-property-descriptor"), __esModule: !0 };
    }, { "core-js/library/fn/object/get-own-property-descriptor": "49SQ" }], "aBNY": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("../core-js/object/get-prototype-of"), r = u(e), t = require("../core-js/object/get-own-property-descriptor"), o = u(t); function u(e) { return e && e.__esModule ? e : { default: e } } exports.default = function e(t, u, i) { null === t && (t = Function.prototype); var l = (0, o.default)(t, u); if (void 0 === l) { var n = (0, r.default)(t); return null === n ? void 0 : e(n, u, i) } if ("value" in l) return l.value; var a = l.get; return void 0 !== a ? a.call(i) : void 0 };
    }, { "../core-js/object/get-prototype-of": "BX4+", "../core-js/object/get-own-property-descriptor": "DNhI" }], "M4O7": [function (require, module, exports) {
        "use strict"; function t() { return !1 } function e() { return !0 } function o() { this.timeStamp = Date.now(), this.target = void 0, this.currentTarget = void 0 } Object.defineProperty(exports, "__esModule", { value: !0 }), o.prototype = { isEventObject: 1, constructor: o, isDefaultPrevented: t, isPropagationStopped: t, isImmediatePropagationStopped: t, preventDefault: function () { this.isDefaultPrevented = e }, stopPropagation: function () { this.isPropagationStopped = e }, stopImmediatePropagation: function () { this.isImmediatePropagationStopped = e, this.stopPropagation() }, halt: function (t) { t ? this.stopImmediatePropagation() : this.stopPropagation(), this.preventDefault() } }, exports.default = o, module.exports = exports.default;
    }, {}], "/z8I": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("./EventBaseObject"), t = n(e), o = require("object-assign"), r = n(o); function n(e) { return e && e.__esModule ? e : { default: e } } var a = !0, i = !1, l = ["altKey", "bubbles", "cancelable", "ctrlKey", "currentTarget", "eventPhase", "metaKey", "shiftKey", "target", "timeStamp", "view", "type"]; function c(e) { return null == e } var u = [{ reg: /^key/, props: ["char", "charCode", "key", "keyCode", "which"], fix: function (e, t) { c(e.which) && (e.which = c(t.charCode) ? t.keyCode : t.charCode), void 0 === e.metaKey && (e.metaKey = e.ctrlKey) } }, { reg: /^touch/, props: ["touches", "changedTouches", "targetTouches"] }, { reg: /^hashchange$/, props: ["newURL", "oldURL"] }, { reg: /^gesturechange$/i, props: ["rotation", "scale"] }, { reg: /^(mousewheel|DOMMouseScroll)$/, props: [], fix: function (e, t) { var o = void 0, r = void 0, n = void 0, a = t.wheelDelta, i = t.axis, l = t.wheelDeltaY, c = t.wheelDeltaX, u = t.detail; a && (n = a / 120), u && (n = 0 - (u % 3 == 0 ? u / 3 : u)), void 0 !== i && (i === e.HORIZONTAL_AXIS ? (r = 0, o = 0 - n) : i === e.VERTICAL_AXIS && (o = 0, r = n)), void 0 !== l && (r = l / 120), void 0 !== c && (o = -1 * c / 120), o || r || (r = n), void 0 !== o && (e.deltaX = o), void 0 !== r && (e.deltaY = r), void 0 !== n && (e.delta = n) } }, { reg: /^mouse|contextmenu|click|mspointer|(^DOMMouseScroll$)/i, props: ["buttons", "clientX", "clientY", "button", "offsetX", "relatedTarget", "which", "fromElement", "toElement", "offsetY", "pageX", "pageY", "screenX", "screenY"], fix: function (e, t) { var o = void 0, r = void 0, n = void 0, a = e.target, i = t.button; return a && c(e.pageX) && !c(t.clientX) && (r = (o = a.ownerDocument || document).documentElement, n = o.body, e.pageX = t.clientX + (r && r.scrollLeft || n && n.scrollLeft || 0) - (r && r.clientLeft || n && n.clientLeft || 0), e.pageY = t.clientY + (r && r.scrollTop || n && n.scrollTop || 0) - (r && r.clientTop || n && n.clientTop || 0)), e.which || void 0 === i || (e.which = 1 & i ? 1 : 2 & i ? 3 : 4 & i ? 2 : 0), !e.relatedTarget && e.fromElement && (e.relatedTarget = e.fromElement === a ? e.toElement : e.fromElement), e } }]; function s() { return a } function p() { return i } function h(e) { var o = e.type, r = "function" == typeof e.stopPropagation || "boolean" == typeof e.cancelBubble; t.default.call(this), this.nativeEvent = e; var n = p; "defaultPrevented" in e ? n = e.defaultPrevented ? s : p : "getPreventDefault" in e ? n = e.getPreventDefault() ? s : p : "returnValue" in e && (n = e.returnValue === i ? s : p), this.isDefaultPrevented = n; var a = [], c = void 0, h = void 0, d = l.concat(); for (u.forEach(function (e) { o.match(e.reg) && (d = d.concat(e.props), e.fix && a.push(e.fix)) }), c = d.length; c;)this[h = d[--c]] = e[h]; for (!this.target && r && (this.target = e.srcElement || document), this.target && 3 === this.target.nodeType && (this.target = this.target.parentNode), c = a.length; c;)(0, a[--c])(this, e); this.timeStamp = e.timeStamp || Date.now() } var d = t.default.prototype; (0, r.default)(h.prototype, d, { constructor: h, preventDefault: function () { var e = this.nativeEvent; e.preventDefault ? e.preventDefault() : e.returnValue = i, d.preventDefault.call(this) }, stopPropagation: function () { var e = this.nativeEvent; e.stopPropagation ? e.stopPropagation() : e.cancelBubble = a, d.stopPropagation.call(this) } }), exports.default = h, module.exports = exports.default;
    }, { "./EventBaseObject": "M4O7", "object-assign": "J4Nk" }], "Q38I": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = r; var e = require("./EventObject"), t = n(e); function n(e) { return e && e.__esModule ? e : { default: e } } function r(e, n, r) { function o(n) { var o = new t.default(n); r.call(e, o) } return e.addEventListener ? (e.addEventListener(n, o, !1), { remove: function () { e.removeEventListener(n, o, !1) } }) : e.attachEvent ? (e.attachEvent("on" + n, o), { remove: function () { e.detachEvent("on" + n, o) } }) : void 0 } module.exports = exports.default;
    }, { "./EventObject": "/z8I" }], "v9LT": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = r; var e = u(require("add-dom-event-listener")), t = u(require("react-dom")); function u(e) { return e && e.__esModule ? e : { default: e } } function r(u, r, a) { var d = t.default.unstable_batchedUpdates ? function (e) { t.default.unstable_batchedUpdates(a, e) } : a; return (0, e.default)(u, r, d) }
    }, { "add-dom-event-listener": "Q38I", "react-dom": "NKHc" }], "UbP1": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = d(require("babel-runtime/helpers/defineProperty")), t = d(require("babel-runtime/helpers/extends")), r = d(require("react")), a = d(require("prop-types")), u = d(require("classnames")), l = d(require("warning")); function d(e) { return e && e.__esModule ? e : { default: e } } var o = function (e, t, r, a, u, d) { (0, l.default)(!r || a > 0, "`Slider[step]` should be a positive number in order to make Slider[dots] work."); var o = Object.keys(t).map(parseFloat); if (r) for (var n = u; n <= d; n += a)-1 === o.indexOf(n) && o.push(n); return o }, n = function (a) { var l = a.prefixCls, d = a.vertical, n = a.marks, s = a.dots, i = a.step, f = a.included, p = a.lowerBound, c = a.upperBound, m = a.max, b = a.min, v = a.dotStyle, y = a.activeDotStyle, x = m - b, k = o(d, n, s, i, b, m).map(function (a) { var o, n = Math.abs(a - b) / x * 100 + "%", s = !f && a === c || f && a <= c && a >= p, i = d ? (0, t.default)({ bottom: n }, v) : (0, t.default)({ left: n }, v); s && (i = (0, t.default)({}, i, y)); var m = (0, u.default)((o = {}, (0, e.default)(o, l + "-dot", !0), (0, e.default)(o, l + "-dot-active", s), o)); return r.default.createElement("span", { className: m, style: i, key: a }) }); return r.default.createElement("div", { className: l + "-step" }, k) }; n.propTypes = { prefixCls: a.default.string, activeDotStyle: a.default.object, dotStyle: a.default.object, min: a.default.number, max: a.default.number, upperBound: a.default.number, lowerBound: a.default.number, included: a.default.bool, dots: a.default.bool, step: a.default.number, marks: a.default.object, vertical: a.default.bool }; var s = n; exports.default = s;
    }, { "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O", "classnames": "9qb7", "warning": "/sXU" }], "WJcF": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = l(require("babel-runtime/helpers/extends")), t = l(require("babel-runtime/helpers/defineProperty")), r = l(require("react")), a = l(require("prop-types")), u = l(require("classnames")); function l(e) { return e && e.__esModule ? e : { default: e } } var n = function (a) { var l = a.className, n = a.vertical, o = a.marks, d = a.included, i = a.upperBound, s = a.lowerBound, f = a.max, c = a.min, m = a.onClickLabel, p = Object.keys(o), b = p.length, v = .9 * (b > 1 ? 100 / (b - 1) : 100), y = f - c, x = p.map(parseFloat).sort(function (e, t) { return e - t }).map(function (a) { var f, p = o[a], b = "object" == typeof p && !r.default.isValidElement(p), x = b ? p.label : p; if (!x && 0 !== x) return null; var k = !d && a === i || d && a <= i && a >= s, h = (0, u.default)((f = {}, (0, t.default)(f, l + "-text", !0), (0, t.default)(f, l + "-text-active", k), f)), q = n ? { marginBottom: "-50%", bottom: (a - c) / y * 100 + "%" } : { width: v + "%", marginLeft: -v / 2 + "%", left: (a - c) / y * 100 + "%" }, B = b ? (0, e.default)({}, q, p.style) : q; return r.default.createElement("span", { className: h, style: B, key: a, onMouseDown: function (e) { return m(e, a) }, onTouchStart: function (e) { return m(e, a) } }, x) }); return r.default.createElement("div", { className: l }, x) }; n.propTypes = { className: a.default.string, vertical: a.default.bool, marks: a.default.object, included: a.default.bool, upperBound: a.default.number, lowerBound: a.default.number, max: a.default.number, min: a.default.number, onClickLabel: a.default.func }; var o = n; exports.default = o;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/defineProperty": "Xos8", "react": "1n8/", "prop-types": "5D9O", "classnames": "9qb7" }], "h8FM": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = d(require("babel-runtime/helpers/extends")), t = d(require("babel-runtime/helpers/defineProperty")), l = d(require("babel-runtime/helpers/objectWithoutProperties")), u = d(require("babel-runtime/helpers/classCallCheck")), a = d(require("babel-runtime/helpers/createClass")), r = d(require("babel-runtime/helpers/possibleConstructorReturn")), s = d(require("babel-runtime/helpers/inherits")), n = d(require("react")), i = d(require("prop-types")), o = d(require("classnames")), c = d(require("rc-util/es/Dom/addEventListener")); function d(e) { return e && e.__esModule ? e : { default: e } } var f = function (i) { function d() { var e, t, l, a; (0, u.default)(this, d); for (var s = arguments.length, n = Array(s), i = 0; i < s; i++)n[i] = arguments[i]; return t = l = (0, r.default)(this, (e = d.__proto__ || Object.getPrototypeOf(d)).call.apply(e, [this].concat(n))), l.state = { clickFocused: !1 }, l.setHandleRef = function (e) { l.handle = e }, l.handleMouseUp = function () { document.activeElement === l.handle && l.setClickFocus(!0) }, l.handleBlur = function () { l.setClickFocus(!1) }, l.handleKeyDown = function () { l.setClickFocus(!1) }, a = t, (0, r.default)(l, a) } return (0, s.default)(d, i), (0, a.default)(d, [{ key: "componentDidMount", value: function () { this.onMouseUpListener = (0, c.default)(document, "mouseup", this.handleMouseUp) } }, { key: "componentWillUnmount", value: function () { this.onMouseUpListener && this.onMouseUpListener.remove() } }, { key: "setClickFocus", value: function (e) { this.setState({ clickFocused: e }) } }, { key: "clickFocus", value: function () { this.setClickFocus(!0), this.focus() } }, { key: "focus", value: function () { this.handle.focus() } }, { key: "blur", value: function () { this.handle.blur() } }, { key: "render", value: function () { var u = this.props, a = u.prefixCls, r = u.vertical, s = u.offset, i = u.style, c = u.disabled, d = u.min, f = u.max, h = u.value, p = u.tabIndex, b = (0, l.default)(u, ["prefixCls", "vertical", "offset", "style", "disabled", "min", "max", "value", "tabIndex"]), m = (0, o.default)(this.props.className, (0, t.default)({}, a + "-handle-click-focused", this.state.clickFocused)), v = r ? { bottom: s + "%" } : { left: s + "%" }, y = (0, e.default)({}, i, v); return n.default.createElement("div", (0, e.default)({ ref: this.setHandleRef, tabIndex: c ? null : p || 0 }, b, { className: m, style: y, onBlur: this.handleBlur, onKeyDown: this.handleKeyDown, role: "slider", "aria-valuemin": d, "aria-valuemax": f, "aria-valuenow": h, "aria-disabled": !!c })) } }]), d }(n.default.Component), h = f; exports.default = h, f.propTypes = { prefixCls: i.default.string, className: i.default.string, vertical: i.default.bool, offset: i.default.number, style: i.default.object, disabled: i.default.bool, min: i.default.number, max: i.default.number, value: i.default.number, tabIndex: i.default.number };
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "classnames": "9qb7", "rc-util/es/Dom/addEventListener": "v9LT" }], "Imvn": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var E = { MAC_ENTER: 3, BACKSPACE: 8, TAB: 9, NUM_CENTER: 12, ENTER: 13, SHIFT: 16, CTRL: 17, ALT: 18, PAUSE: 19, CAPS_LOCK: 20, ESC: 27, SPACE: 32, PAGE_UP: 33, PAGE_DOWN: 34, END: 35, HOME: 36, LEFT: 37, UP: 38, RIGHT: 39, DOWN: 40, PRINT_SCREEN: 44, INSERT: 45, DELETE: 46, ZERO: 48, ONE: 49, TWO: 50, THREE: 51, FOUR: 52, FIVE: 53, SIX: 54, SEVEN: 55, EIGHT: 56, NINE: 57, QUESTION_MARK: 63, A: 65, B: 66, C: 67, D: 68, E: 69, F: 70, G: 71, H: 72, I: 73, J: 74, K: 75, L: 76, M: 77, N: 78, O: 79, P: 80, Q: 81, R: 82, S: 83, T: 84, U: 85, V: 86, W: 87, X: 88, Y: 89, Z: 90, META: 91, WIN_KEY_RIGHT: 92, CONTEXT_MENU: 93, NUM_ZERO: 96, NUM_ONE: 97, NUM_TWO: 98, NUM_THREE: 99, NUM_FOUR: 100, NUM_FIVE: 101, NUM_SIX: 102, NUM_SEVEN: 103, NUM_EIGHT: 104, NUM_NINE: 105, NUM_MULTIPLY: 106, NUM_PLUS: 107, NUM_MINUS: 109, NUM_PERIOD: 110, NUM_DIVISION: 111, F1: 112, F2: 113, F3: 114, F4: 115, F5: 116, F6: 117, F7: 118, F8: 119, F9: 120, F10: 121, F11: 122, F12: 123, NUMLOCK: 144, SEMICOLON: 186, DASH: 189, EQUALS: 187, COMMA: 188, PERIOD: 190, SLASH: 191, APOSTROPHE: 192, SINGLE_QUOTE: 222, OPEN_SQUARE_BRACKET: 219, BACKSLASH: 220, CLOSE_SQUARE_BRACKET: 221, WIN_KEY: 224, MAC_FF_META: 224, WIN_IME: 229, isTextModifyingKeyEvent: function (e) { var N = e.keyCode; if (e.altKey && !e.ctrlKey || e.metaKey || N >= E.F1 && N <= E.F12) return !1; switch (N) { case E.ALT: case E.CAPS_LOCK: case E.CONTEXT_MENU: case E.CTRL: case E.DOWN: case E.END: case E.ESC: case E.HOME: case E.INSERT: case E.LEFT: case E.MAC_FF_META: case E.META: case E.NUMLOCK: case E.NUM_CENTER: case E.PAGE_DOWN: case E.PAGE_UP: case E.PAUSE: case E.PRINT_SCREEN: case E.RIGHT: case E.SHIFT: case E.UP: case E.WIN_KEY: case E.WIN_KEY_RIGHT: return !1; default: return !0 } }, isCharacterKey: function (e) { if (e >= E.ZERO && e <= E.NINE) return !0; if (e >= E.NUM_ZERO && e <= E.NUM_MULTIPLY) return !0; if (e >= E.A && e <= E.Z) return !0; if (-1 !== window.navigation.userAgent.indexOf("WebKit") && 0 === e) return !0; switch (e) { case E.SPACE: case E.QUESTION_MARK: case E.NUM_PLUS: case E.NUM_MINUS: case E.NUM_PERIOD: case E.NUM_DIVISION: case E.SEMICOLON: case E.DASH: case E.EQUALS: case E.COMMA: case E.PERIOD: case E.SLASH: case E.APOSTROPHE: case E.SINGLE_QUOTE: case E.OPEN_SQUARE_BRACKET: case E.BACKSLASH: case E.CLOSE_SQUARE_BRACKET: return !0; default: return !1 } } }, e = E; exports.default = e;
    }, {}], "QoqB": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.isEventFromHandle = u, exports.isValueOutOfRange = o, exports.isNotTouchEvent = a, exports.getClosestPoint = s, exports.getPrecision = i, exports.getMousePosition = c, exports.getTouchPosition = f, exports.getHandleCenterPosition = l, exports.ensureValueInRange = p, exports.ensureValuePrecision = d, exports.pauseEvent = h, exports.getKeyboardValueMutator = x; var e = r(require("babel-runtime/helpers/toConsumableArray")), t = require("react-dom"), n = r(require("rc-util/es/KeyCode")); function r(e) { return e && e.__esModule ? e : { default: e } } function u(e, n) { return Object.keys(n).some(function (r) { return e.target === (0, t.findDOMNode)(n[r]) }) } function o(e, t) { var n = t.min, r = t.max; return e < n || e > r } function a(e) { return e.touches.length > 1 || "touchend" === e.type.toLowerCase() && e.touches.length > 0 } function s(t, n) { var r = n.marks, u = n.step, o = n.min, a = Object.keys(r).map(parseFloat); if (null !== u) { var s = Math.round((t - o) / u) * u + o; a.push(s) } var i = a.map(function (e) { return Math.abs(t - e) }); return a[i.indexOf(Math.min.apply(Math, (0, e.default)(i)))] } function i(e) { var t = e.toString(), n = 0; return t.indexOf(".") >= 0 && (n = t.length - t.indexOf(".") - 1), n } function c(e, t) { return e ? t.clientY : t.pageX } function f(e, t) { return e ? t.touches[0].clientY : t.touches[0].pageX } function l(e, t) { var n = t.getBoundingClientRect(); return e ? n.top + .5 * n.height : n.left + .5 * n.width } function p(e, t) { var n = t.max, r = t.min; return e <= r ? r : e >= n ? n : e } function d(e, t) { var n = t.step, r = s(e, t); return null === n ? r : parseFloat(r.toFixed(i(n))) } function h(e) { e.stopPropagation(), e.preventDefault() } function x(e) { switch (e.keyCode) { case n.default.UP: case n.default.RIGHT: return function (e, t) { return e + t.step }; case n.default.DOWN: case n.default.LEFT: return function (e, t) { return e - t.step }; case n.default.END: return function (e, t) { return t.max }; case n.default.HOME: return function (e, t) { return t.min }; case n.default.PAGE_UP: return function (e, t) { return e + 2 * t.step }; case n.default.PAGE_DOWN: return function (e, t) { return e - 2 * t.step }; default: return } }
    }, { "babel-runtime/helpers/toConsumableArray": "mYpx", "react-dom": "NKHc", "rc-util/es/KeyCode": "Imvn" }], "TUhJ": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = M; var e = b(require("babel-runtime/helpers/objectWithoutProperties")), t = b(require("babel-runtime/helpers/extends")), o = b(require("babel-runtime/helpers/defineProperty")), n = b(require("babel-runtime/helpers/classCallCheck")), r = b(require("babel-runtime/helpers/createClass")), a = b(require("babel-runtime/helpers/possibleConstructorReturn")), l = b(require("babel-runtime/helpers/get")), s = b(require("babel-runtime/helpers/inherits")), u = b(require("react")), i = b(require("prop-types")), d = b(require("rc-util/es/Dom/addEventListener")), c = b(require("classnames")), f = b(require("warning")), h = b(require("./Steps")), p = b(require("./Marks")), v = b(require("../Handle")), m = y(require("../utils")); function y(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var o in e) if (Object.prototype.hasOwnProperty.call(e, o)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, o) : {}; n.get || n.set ? Object.defineProperty(t, o, n) : t[o] = e[o] } return t.default = e, t } function b(e) { return e && e.__esModule ? e : { default: e } } function g() { } function M(f) { var y, b; return b = y = function (e) { function i(e) { (0, n.default)(this, i); var t = (0, a.default)(this, (i.__proto__ || Object.getPrototypeOf(i)).call(this, e)); return t.onMouseDown = function (e) { if (0 === e.button) { var o = t.props.vertical, n = m.getMousePosition(o, e); if (m.isEventFromHandle(e, t.handlesRefs)) { var r = m.getHandleCenterPosition(o, e.target); t.dragOffset = n - r, n = r } else t.dragOffset = 0; t.removeDocumentEvents(), t.onStart(n), t.addDocumentMouseEvents() } }, t.onTouchStart = function (e) { if (!m.isNotTouchEvent(e)) { var o = t.props.vertical, n = m.getTouchPosition(o, e); if (m.isEventFromHandle(e, t.handlesRefs)) { var r = m.getHandleCenterPosition(o, e.target); t.dragOffset = n - r, n = r } else t.dragOffset = 0; t.onStart(n), t.addDocumentTouchEvents(), m.pauseEvent(e) } }, t.onFocus = function (e) { var o = t.props, n = o.onFocus, r = o.vertical; if (m.isEventFromHandle(e, t.handlesRefs)) { var a = m.getHandleCenterPosition(r, e.target); t.dragOffset = 0, t.onStart(a), m.pauseEvent(e), n && n(e) } }, t.onBlur = function (e) { var o = t.props.onBlur; t.onEnd(e), o && o(e) }, t.onMouseUp = function () { t.handlesRefs[t.prevMovedHandleIndex] && t.handlesRefs[t.prevMovedHandleIndex].clickFocus() }, t.onMouseMove = function (e) { if (t.sliderRef) { var o = m.getMousePosition(t.props.vertical, e); t.onMove(e, o - t.dragOffset) } else t.onEnd() }, t.onTouchMove = function (e) { if (!m.isNotTouchEvent(e) && t.sliderRef) { var o = m.getTouchPosition(t.props.vertical, e); t.onMove(e, o - t.dragOffset) } else t.onEnd() }, t.onKeyDown = function (e) { t.sliderRef && m.isEventFromHandle(e, t.handlesRefs) && t.onKeyboard(e) }, t.onClickMarkLabel = function (e, o) { e.stopPropagation(), t.onChange({ value: o }) }, t.saveSlider = function (e) { t.sliderRef = e }, t.handlesRefs = {}, t } return (0, s.default)(i, e), (0, r.default)(i, [{ key: "componentDidMount", value: function () { this.document = this.sliderRef && this.sliderRef.ownerDocument } }, { key: "componentWillUnmount", value: function () { (0, l.default)(i.prototype.__proto__ || Object.getPrototypeOf(i.prototype), "componentWillUnmount", this) && (0, l.default)(i.prototype.__proto__ || Object.getPrototypeOf(i.prototype), "componentWillUnmount", this).call(this), this.removeDocumentEvents() } }, { key: "getSliderStart", value: function () { var e = this.sliderRef.getBoundingClientRect(); return this.props.vertical ? e.top : e.left } }, { key: "getSliderLength", value: function () { var e = this.sliderRef; if (!e) return 0; var t = e.getBoundingClientRect(); return this.props.vertical ? t.height : t.width } }, { key: "addDocumentTouchEvents", value: function () { this.onTouchMoveListener = (0, d.default)(this.document, "touchmove", this.onTouchMove), this.onTouchUpListener = (0, d.default)(this.document, "touchend", this.onEnd) } }, { key: "addDocumentMouseEvents", value: function () { this.onMouseMoveListener = (0, d.default)(this.document, "mousemove", this.onMouseMove), this.onMouseUpListener = (0, d.default)(this.document, "mouseup", this.onEnd) } }, { key: "removeDocumentEvents", value: function () { this.onTouchMoveListener && this.onTouchMoveListener.remove(), this.onTouchUpListener && this.onTouchUpListener.remove(), this.onMouseMoveListener && this.onMouseMoveListener.remove(), this.onMouseUpListener && this.onMouseUpListener.remove() } }, { key: "focus", value: function () { this.props.disabled || this.handlesRefs[0].focus() } }, { key: "blur", value: function () { this.props.disabled || this.handlesRefs[0].blur() } }, { key: "calcValue", value: function (e) { var t = this.props, o = t.vertical, n = t.min, r = t.max, a = Math.abs(Math.max(e, 0) / this.getSliderLength()); return o ? (1 - a) * (r - n) + n : a * (r - n) + n } }, { key: "calcValueByPos", value: function (e) { var t = e - this.getSliderStart(); return this.trimAlignValue(this.calcValue(t)) } }, { key: "calcOffset", value: function (e) { var t = this.props, o = t.min; return 100 * ((e - o) / (t.max - o)) } }, { key: "saveHandle", value: function (e, t) { this.handlesRefs[e] = t } }, { key: "render", value: function () { var e, n = this.props, r = n.prefixCls, a = n.className, s = n.marks, d = n.dots, f = n.step, v = n.included, m = n.disabled, y = n.vertical, b = n.min, M = n.max, k = n.children, S = n.maximumTrackStyle, O = n.style, E = n.railStyle, C = n.dotStyle, T = n.activeDotStyle, j = (0, l.default)(i.prototype.__proto__ || Object.getPrototypeOf(i.prototype), "render", this).call(this), P = j.tracks, D = j.handles, _ = (0, c.default)(r, (e = {}, (0, o.default)(e, r + "-with-marks", Object.keys(s).length), (0, o.default)(e, r + "-disabled", m), (0, o.default)(e, r + "-vertical", y), (0, o.default)(e, a, a), e)); return u.default.createElement("div", { ref: this.saveSlider, className: _, onTouchStart: m ? g : this.onTouchStart, onMouseDown: m ? g : this.onMouseDown, onMouseUp: m ? g : this.onMouseUp, onKeyDown: m ? g : this.onKeyDown, onFocus: m ? g : this.onFocus, onBlur: m ? g : this.onBlur, style: O }, u.default.createElement("div", { className: r + "-rail", style: (0, t.default)({}, S, E) }), P, u.default.createElement(h.default, { prefixCls: r, vertical: y, marks: s, dots: d, step: f, included: v, lowerBound: this.getLowerBound(), upperBound: this.getUpperBound(), max: M, min: b, dotStyle: C, activeDotStyle: T }), D, u.default.createElement(p.default, { className: r + "-mark", onClickLabel: m ? g : this.onClickMarkLabel, vertical: y, marks: s, included: v, lowerBound: this.getLowerBound(), upperBound: this.getUpperBound(), max: M, min: b }), k) } }]), i }(f), y.displayName = "ComponentEnhancer(" + f.displayName + ")", y.propTypes = (0, t.default)({}, f.propTypes, { min: i.default.number, max: i.default.number, step: i.default.number, marks: i.default.object, included: i.default.bool, className: i.default.string, prefixCls: i.default.string, disabled: i.default.bool, children: i.default.any, onBeforeChange: i.default.func, onChange: i.default.func, onAfterChange: i.default.func, handle: i.default.func, dots: i.default.bool, vertical: i.default.bool, style: i.default.object, minimumTrackStyle: i.default.object, maximumTrackStyle: i.default.object, handleStyle: i.default.oneOfType([i.default.object, i.default.arrayOf(i.default.object)]), trackStyle: i.default.oneOfType([i.default.object, i.default.arrayOf(i.default.object)]), railStyle: i.default.object, dotStyle: i.default.object, activeDotStyle: i.default.object, autoFocus: i.default.bool, onFocus: i.default.func, onBlur: i.default.func }), y.defaultProps = (0, t.default)({}, f.defaultProps, { prefixCls: "rc-slider", className: "", min: 0, max: 100, step: 1, marks: {}, handle: function (o) { var n = o.index, r = (0, e.default)(o, ["index"]); return delete r.dragging, u.default.createElement(v.default, (0, t.default)({}, r, { key: n })) }, onBeforeChange: g, onChange: g, onAfterChange: g, included: !0, disabled: !1, dots: !1, vertical: !1, trackStyle: [{}], handleStyle: [{}], railStyle: {}, dotStyle: {}, activeDotStyle: {} }), b }
    }, { "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/get": "aBNY", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "rc-util/es/Dom/addEventListener": "v9LT", "classnames": "9qb7", "warning": "/sXU", "./Steps": "UbP1", "./Marks": "WJcF", "../Handle": "h8FM", "../utils": "QoqB" }], "ihrk": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = c(require("babel-runtime/helpers/extends")), t = c(require("babel-runtime/helpers/classCallCheck")), a = c(require("babel-runtime/helpers/createClass")), r = c(require("babel-runtime/helpers/possibleConstructorReturn")), n = c(require("babel-runtime/helpers/inherits")), u = c(require("react")), i = c(require("prop-types")), l = c(require("warning")), s = c(require("./common/Track")), o = c(require("./common/createSlider")), d = v(require("./utils")); function v(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var a in e) if (Object.prototype.hasOwnProperty.call(e, a)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, a) : {}; r.get || r.set ? Object.defineProperty(t, a, r) : t[a] = e[a] } return t.default = e, t } function c(e) { return e && e.__esModule ? e : { default: e } } var f = function (i) { function l(e) { (0, t.default)(this, l); var a = (0, r.default)(this, (l.__proto__ || Object.getPrototypeOf(l)).call(this, e)); a.onEnd = function () { a.setState({ dragging: !1 }), a.removeDocumentEvents(), a.props.onAfterChange(a.getValue()) }; var n = void 0 !== e.defaultValue ? e.defaultValue : e.min, u = void 0 !== e.value ? e.value : n; return a.state = { value: a.trimAlignValue(u), dragging: !1 }, a } return (0, n.default)(l, i), (0, a.default)(l, [{ key: "componentDidMount", value: function () { var e = this.props, t = e.autoFocus, a = e.disabled; t && !a && this.focus() } }, { key: "componentWillReceiveProps", value: function (e) { if ("value" in e || "min" in e || "max" in e) { var t = this.state.value, a = void 0 !== e.value ? e.value : t, r = this.trimAlignValue(a, e); r !== t && (this.setState({ value: r }), d.isValueOutOfRange(a, e) && this.props.onChange(r)) } } }, { key: "onChange", value: function (e) { var t = this.props; !("value" in t) && this.setState(e); var a = e.value; t.onChange(a) } }, { key: "onStart", value: function (e) { this.setState({ dragging: !0 }); var t = this.props, a = this.getValue(); t.onBeforeChange(a); var r = this.calcValueByPos(e); this.startValue = r, this.startPosition = e, r !== a && (this.prevMovedHandleIndex = 0, this.onChange({ value: r })) } }, { key: "onMove", value: function (e, t) { d.pauseEvent(e); var a = this.state.value, r = this.calcValueByPos(t); r !== a && this.onChange({ value: r }) } }, { key: "onKeyboard", value: function (e) { var t = d.getKeyboardValueMutator(e); if (t) { d.pauseEvent(e); var a = this.state.value, r = t(a, this.props), n = this.trimAlignValue(r); if (n === a) return; this.onChange({ value: n }) } } }, { key: "getValue", value: function () { return this.state.value } }, { key: "getLowerBound", value: function () { return this.props.min } }, { key: "getUpperBound", value: function () { return this.state.value } }, { key: "trimAlignValue", value: function (t) { var a = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, r = (0, e.default)({}, this.props, a), n = d.ensureValueInRange(t, r); return d.ensureValuePrecision(n, r) } }, { key: "render", value: function () { var t = this, a = this.props, r = a.prefixCls, n = a.vertical, i = a.included, l = a.disabled, o = a.minimumTrackStyle, d = a.trackStyle, v = a.handleStyle, c = a.tabIndex, f = a.min, h = a.max, p = a.handle, g = this.state, m = g.value, b = g.dragging, y = this.calcOffset(m), k = p({ className: r + "-handle", prefixCls: r, vertical: n, offset: y, value: m, dragging: b, disabled: l, min: f, max: h, index: 0, tabIndex: c, style: v[0] || v, ref: function (e) { return t.saveHandle(0, e) } }), V = d[0] || d; return { tracks: u.default.createElement(s.default, { className: r + "-track", vertical: n, included: i, offset: 0, length: y, style: (0, e.default)({}, o, V) }), handles: k } } }]), l }(u.default.Component); f.propTypes = { defaultValue: i.default.number, value: i.default.number, disabled: i.default.bool, autoFocus: i.default.bool, tabIndex: i.default.number }; var h = (0, o.default)(f); exports.default = h;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "warning": "/sXU", "./common/Track": "PwXI", "./common/createSlider": "TUhJ", "./utils": "QoqB" }], "pz6A": [function (require, module, exports) {
        module.exports = function (r, e, t, o) { var n = t ? t.call(o, r, e) : void 0; if (void 0 !== n) return !!n; if (r === e) return !0; if ("object" != typeof r || !r || "object" != typeof e || !e) return !1; var i = Object.keys(r), f = Object.keys(e); if (i.length !== f.length) return !1; for (var u = Object.prototype.hasOwnProperty.bind(e), v = 0; v < i.length; v++) { var a = i[v]; if (!u(a)) return !1; var c = r[a], l = e[a]; if (!1 === (n = t ? t.call(o, c, l, a) : void 0) || void 0 === n && c !== l) return !1 } return !0 };
    }, {}], "LI7V": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = c(require("babel-runtime/helpers/defineProperty")), t = c(require("babel-runtime/helpers/extends")), n = c(require("babel-runtime/helpers/toConsumableArray")), a = c(require("babel-runtime/helpers/classCallCheck")), r = c(require("babel-runtime/helpers/createClass")), u = c(require("babel-runtime/helpers/possibleConstructorReturn")), s = c(require("babel-runtime/helpers/inherits")), l = c(require("react")), i = c(require("prop-types")), o = c(require("classnames")), d = c(require("shallowequal")), h = c(require("./common/Track")), f = c(require("./common/createSlider")), p = v(require("./utils")); function v(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var a = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; a.get || a.set ? Object.defineProperty(t, n, a) : t[n] = e[n] } return t.default = e, t } function c(e) { return e && e.__esModule ? e : { default: e } } var b = function (i) { function f(e) { (0, a.default)(this, f); var t = (0, u.default)(this, (f.__proto__ || Object.getPrototypeOf(f)).call(this, e)); t.onEnd = function () { t.removeDocumentEvents(), t.props.onAfterChange(t.getValue()) }; var r = e.count, s = e.min, l = e.max, i = Array.apply(void 0, (0, n.default)(Array(r + 1))).map(function () { return s }), o = "defaultValue" in e ? e.defaultValue : i, d = (void 0 !== e.value ? e.value : o).map(function (e, n) { return t.trimAlignValue(e, n) }), h = d[0] === l ? 0 : d.length - 1; return t.state = { handle: null, recent: h, bounds: d }, t } return (0, s.default)(f, i), (0, r.default)(f, [{ key: "componentWillReceiveProps", value: function (e) { var t = this; if (("value" in e || "min" in e || "max" in e) && (this.props.min !== e.min || this.props.max !== e.max || !(0, d.default)(this.props.value, e.value))) { var n = this.state.bounds, a = e.value || n, r = a.map(function (n, a) { return t.trimAlignValue(n, a, e) }); if ((r.length !== n.length || !r.every(function (e, t) { return e === n[t] })) && (this.setState({ bounds: r }), n.some(function (t) { return p.isValueOutOfRange(t, e) }))) { var u = a.map(function (t) { return p.ensureValueInRange(t, e) }); this.props.onChange(u) } } } }, { key: "onChange", value: function (e) { var n = this.props; !("value" in n) ? this.setState(e) : void 0 !== e.handle && this.setState({ handle: e.handle }); var a = (0, t.default)({}, this.state, e).bounds; n.onChange(a) } }, { key: "onStart", value: function (e) { var t = this.props, a = this.state, r = this.getValue(); t.onBeforeChange(r); var u = this.calcValueByPos(e); this.startValue = u, this.startPosition = e; var s = this.getClosestBound(u); if (this.prevMovedHandleIndex = this.getBoundNeedMoving(u, s), this.setState({ handle: this.prevMovedHandleIndex, recent: this.prevMovedHandleIndex }), u !== r[this.prevMovedHandleIndex]) { var l = [].concat((0, n.default)(a.bounds)); l[this.prevMovedHandleIndex] = u, this.onChange({ bounds: l }) } } }, { key: "onMove", value: function (e, t) { p.pauseEvent(e); var n = this.state, a = this.calcValueByPos(t); a !== n.bounds[n.handle] && this.moveTo(a) } }, { key: "onKeyboard", value: function (e) { var t = p.getKeyboardValueMutator(e); if (t) { p.pauseEvent(e); var n = this.state, a = this.props, r = n.bounds[n.handle], u = t(r, a), s = this.trimAlignValue(u); if (s === r) return; this.moveTo(s, !0) } } }, { key: "getValue", value: function () { return this.state.bounds } }, { key: "getClosestBound", value: function (e) { for (var t = this.state.bounds, n = 0, a = 1; a < t.length - 1; ++a)e > t[a] && (n = a); return Math.abs(t[n + 1] - e) < Math.abs(t[n] - e) && (n += 1), n } }, { key: "getBoundNeedMoving", value: function (e, t) { var n = this.state, a = n.bounds, r = n.recent, u = t, s = a[t + 1] === a[t]; return s && a[r] === a[t] && (u = r), s && e !== a[t + 1] && (u = e < a[t + 1] ? t : t + 1), u } }, { key: "getLowerBound", value: function () { return this.state.bounds[0] } }, { key: "getUpperBound", value: function () { var e = this.state.bounds; return e[e.length - 1] } }, { key: "getPoints", value: function () { var e = this.props, n = e.marks, a = e.step, r = e.min, u = e.max, s = this._getPointsCache; if (!s || s.marks !== n || s.step !== a) { var l = (0, t.default)({}, n); if (null !== a) for (var i = r; i <= u; i += a)l[i] = i; var o = Object.keys(l).map(parseFloat); o.sort(function (e, t) { return e - t }), this._getPointsCache = { marks: n, step: a, points: o } } return this._getPointsCache.points } }, { key: "moveTo", value: function (e, t) { var a = this, r = this.state, u = this.props, s = [].concat((0, n.default)(r.bounds)); s[r.handle] = e; var l = r.handle; !1 !== u.pushable ? this.pushSurroundingHandles(s, l) : u.allowCross && (s.sort(function (e, t) { return e - t }), l = s.indexOf(e)), this.onChange({ handle: l, bounds: s }), t && this.setState({}, function () { a.handlesRefs[l].focus() }) } }, { key: "pushSurroundingHandles", value: function (e, t) { var n = e[t], a = this.props.pushable; a = Number(a); var r = 0; if (e[t + 1] - n < a && (r = 1), n - e[t - 1] < a && (r = -1), 0 !== r) { var u = t + r, s = r * (e[u] - n); this.pushHandle(e, u, r, a - s) || (e[t] = e[u] - r * a) } } }, { key: "pushHandle", value: function (e, t, n, a) { for (var r = e[t], u = e[t]; n * (u - r) < a;) { if (!this.pushHandleOnePoint(e, t, n)) return e[t] = r, !1; u = e[t] } return !0 } }, { key: "pushHandleOnePoint", value: function (e, t, n) { var a = this.getPoints(), r = a.indexOf(e[t]) + n; if (r >= a.length || r < 0) return !1; var u = t + n, s = a[r], l = this.props.pushable, i = n * (e[u] - s); return !!this.pushHandle(e, u, n, l - i) && (e[t] = s, !0) } }, { key: "trimAlignValue", value: function (e, n) { var a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, r = (0, t.default)({}, this.props, a), u = p.ensureValueInRange(e, r), s = this.ensureValueNotConflict(n, u, r); return p.ensureValuePrecision(s, r) } }, { key: "ensureValueNotConflict", value: function (e, t, n) { var a = n.allowCross, r = n.pushable, u = this.state || {}, s = u.bounds; if (e = void 0 === e ? u.handle : e, r = Number(r), !a && null != e && void 0 !== s) { if (e > 0 && t <= s[e - 1] + r) return s[e - 1] + r; if (e < s.length - 1 && t >= s[e + 1] - r) return s[e + 1] - r } return t } }, { key: "render", value: function () { var t = this, n = this.state, a = n.handle, r = n.bounds, u = this.props, s = u.prefixCls, i = u.vertical, d = u.included, f = u.disabled, p = u.min, v = u.max, c = u.handle, b = u.trackStyle, m = u.handleStyle, g = u.tabIndex, y = r.map(function (e) { return t.calcOffset(e) }), k = s + "-handle", C = r.map(function (n, r) { var u; return c({ className: (0, o.default)((u = {}, (0, e.default)(u, k, !0), (0, e.default)(u, k + "-" + (r + 1), !0), u)), prefixCls: s, vertical: i, offset: y[r], value: n, dragging: a === r, index: r, tabIndex: g[r] || 0, min: p, max: v, disabled: f, style: m[r], ref: function (e) { return t.saveHandle(r, e) } }) }); return { tracks: r.slice(0, -1).map(function (t, n) { var a, r = n + 1, u = (0, o.default)((a = {}, (0, e.default)(a, s + "-track", !0), (0, e.default)(a, s + "-track-" + r, !0), a)); return l.default.createElement(h.default, { className: u, vertical: i, included: d, offset: y[r - 1], length: y[r] - y[r - 1], style: b[n], key: r }) }), handles: C } } }]), f }(l.default.Component); b.displayName = "Range", b.propTypes = { defaultValue: i.default.arrayOf(i.default.number), value: i.default.arrayOf(i.default.number), count: i.default.number, pushable: i.default.oneOfType([i.default.bool, i.default.number]), allowCross: i.default.bool, disabled: i.default.bool, tabIndex: i.default.arrayOf(i.default.number) }, b.defaultProps = { count: 1, allowCross: !0, pushable: !1, tabIndex: [] }; var m = (0, f.default)(b); exports.default = m;
    }, { "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/toConsumableArray": "mYpx", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "classnames": "9qb7", "shallowequal": "pz6A", "./common/Track": "PwXI", "./common/createSlider": "TUhJ", "./utils": "QoqB" }], "asZT": [function (require, module, exports) {
        "use strict"; function e(e, r) { for (var t = r; t;) { if (t === e) return !0; t = t.parentNode } return !1 } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = e;
    }, {}], "tIov": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.getTransformName = o, exports.setTransitionProperty = a, exports.getTransitionProperty = i, exports.getTransformXY = l, exports.setTransformXY = f; var t = void 0, r = { Webkit: "-webkit-", Moz: "-moz-", ms: "-ms-", O: "-o-" }; function e() { if (void 0 !== t) return t; t = ""; var e = document.createElement("p").style; for (var n in r) n + "Transform" in e && (t = n); return t } function n() { return e() ? e() + "TransitionProperty" : "transitionProperty" } function o() { return e() ? e() + "Transform" : "transform" } function a(t, r) { var e = n(); e && (t.style[e] = r, "transitionProperty" !== e && (t.style.transitionProperty = r)) } function s(t, r) { var e = o(); e && (t.style[e] = r, "transform" !== e && (t.style.transform = r)) } function i(t) { return t.style.transitionProperty || t.style[n()] } function l(t) { var r = window.getComputedStyle(t, null), e = r.getPropertyValue("transform") || r.getPropertyValue(o()); if (e && "none" !== e) { var n = e.replace(/[^0-9\-.,]/g, "").split(","); return { x: parseFloat(n[12] || n[4], 0), y: parseFloat(n[13] || n[5], 0) } } return { x: 0, y: 0 } } var p = /matrix\((.*)\)/, u = /matrix3d\((.*)\)/; function f(t, r) { var e = window.getComputedStyle(t, null), n = e.getPropertyValue("transform") || e.getPropertyValue(o()); if (n && "none" !== n) { var a = void 0, i = n.match(p); if (i) (a = (i = i[1]).split(",").map(function (t) { return parseFloat(t, 10) }))[4] = r.x, a[5] = r.y, s(t, "matrix(" + a.join(",") + ")"); else (a = n.match(u)[1].split(",").map(function (t) { return parseFloat(t, 10) }))[12] = r.x, a[13] = r.y, s(t, "matrix3d(" + a.join(",") + ")") } else s(t, "translateX(" + r.x + "px) translateY(" + r.y + "px) translateZ(0)") }
    }, {}], "fDZk": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = require("./propertyUtils"), e = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t }, o = /[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source, n = void 0; function r(t) { var e = t.style.display; t.style.display = "none", t.offsetHeight, t.style.display = e } function i(t, o, r) { var f = r; if ("object" !== (void 0 === o ? "undefined" : e(o))) return void 0 !== f ? ("number" == typeof f && (f += "px"), void (t.style[o] = f)) : n(t, o); for (var u in o) o.hasOwnProperty(u) && i(t, u, o[u]) } function f(t) { var e, o = void 0, n = void 0, r = t.ownerDocument, i = r.body, f = r && r.documentElement; return o = (e = t.getBoundingClientRect()).left, n = e.top, { left: o -= f.clientLeft || i.clientLeft || 0, top: n -= f.clientTop || i.clientTop || 0 } } function u(t, e) { var o = t["page" + (e ? "Y" : "X") + "Offset"], n = "scroll" + (e ? "Top" : "Left"); if ("number" != typeof o) { var r = t.document; "number" != typeof (o = r.documentElement[n]) && (o = r.body[n]) } return o } function l(t) { return u(t) } function d(t) { return u(t, !0) } function a(t) { var e = f(t), o = t.ownerDocument, n = o.defaultView || o.parentWindow; return e.left += l(n), e.top += d(n), e } function p(t) { return null != t && t == t.window } function c(t) { return p(t) ? t.document : 9 === t.nodeType ? t : t.ownerDocument } function s(t, e, o) { var n = o, r = "", i = c(t); return (n = n || i.defaultView.getComputedStyle(t, null)) && (r = n.getPropertyValue(e) || n[e]), r } var v = new RegExp("^(" + o + ")(?!px)[a-z%]+$", "i"), y = /^(top|right|bottom|left)$/, m = "currentStyle", h = "runtimeStyle", g = "left", w = "px"; function b(t, e) { var o = t[m] && t[m][e]; if (v.test(o) && !y.test(e)) { var n = t.style, r = n[g], i = t[h][g]; t[h][g] = t[m][g], n[g] = "fontSize" === e ? "1em" : o || 0, o = n.pixelLeft + w, n[g] = r, t[h][g] = i } return "" === o ? "auto" : o } function x(t, e) { return "left" === t ? e.useCssRight ? "right" : t : e.useCssBottom ? "bottom" : t } function S(t) { return "left" === t ? "right" : "right" === t ? "left" : "top" === t ? "bottom" : "bottom" === t ? "top" : void 0 } function T(e, o, n) { "static" === i(e, "position") && (e.style.position = "relative"); var f = -999, u = -999, l = x("left", n), d = x("top", n), p = S(l), c = S(d); "left" !== l && (f = 999), "top" !== d && (u = 999); var s = "", v = a(e); ("left" in o || "top" in o) && (s = (0, t.getTransitionProperty)(e) || "", (0, t.setTransitionProperty)(e, "none")), "left" in o && (e.style[p] = "", e.style[l] = f + "px"), "top" in o && (e.style[c] = "", e.style[d] = u + "px"), r(e); var y = a(e), m = {}; for (var h in o) if (o.hasOwnProperty(h)) { var g = x(h, n), w = "left" === h ? f : u, b = v[h] - y[h]; m[g] = g === h ? w + b : w - b } i(e, m), r(e), ("left" in o || "top" in o) && (0, t.setTransitionProperty)(e, s); var T = {}; for (var C in o) if (o.hasOwnProperty(C)) { var P = x(C, n), W = o[C] - v[C]; T[P] = C === P ? m[P] + W : m[P] - W } i(e, T) } function C(e, o) { var n = a(e), r = (0, t.getTransformXY)(e), i = { x: r.x, y: r.y }; "left" in o && (i.x = r.x + o.left - n.left), "top" in o && (i.y = r.y + o.top - n.top), (0, t.setTransformXY)(e, i) } function P(e, o, n) { if (n.ignoreShake) { var r = a(e), i = r.left.toFixed(0), f = r.top.toFixed(0), u = o.left.toFixed(0), l = o.top.toFixed(0); if (i === u && f === l) return } n.useCssRight || n.useCssBottom ? T(e, o, n) : n.useCssTransform && (0, t.getTransformName)() in document.body.style ? C(e, o, n) : T(e, o, n) } function W(t, e) { for (var o = 0; o < t.length; o++)e(t[o]) } function O(t) { return "border-box" === n(t, "boxSizing") } "undefined" != typeof window && (n = window.getComputedStyle ? s : b); var R = ["margin", "border", "padding"], B = -1, L = 2, E = 1, F = 0; function D(t, e, o) { var n = {}, r = t.style, i = void 0; for (i in e) e.hasOwnProperty(i) && (n[i] = r[i], r[i] = e[i]); for (i in o.call(t), e) e.hasOwnProperty(i) && (r[i] = n[i]) } function H(t, e, o) { var r = 0, i = void 0, f = void 0, u = void 0; for (f = 0; f < e.length; f++)if (i = e[f]) for (u = 0; u < o.length; u++) { var l = void 0; l = "border" === i ? "" + i + o[u] + "Width" : i + o[u], r += parseFloat(n(t, l)) || 0 } return r } var V = {}; function z(t, e, o) { var r = o; if (p(t)) return "width" === e ? V.viewportWidth(t) : V.viewportHeight(t); if (9 === t.nodeType) return "width" === e ? V.docWidth(t) : V.docHeight(t); var i = "width" === e ? ["Left", "Right"] : ["Top", "Bottom"], f = "width" === e ? t.getBoundingClientRect().width : t.getBoundingClientRect().height, u = n(t), l = O(t, u), d = 0; (null == f || f <= 0) && (f = void 0, (null == (d = n(t, e)) || Number(d) < 0) && (d = t.style[e] || 0), d = parseFloat(d) || 0), void 0 === r && (r = l ? E : B); var a = void 0 !== f || l, c = f || d; return r === B ? a ? c - H(t, ["border", "padding"], i, u) : d : a ? r === E ? c : c + (r === L ? -H(t, ["border"], i, u) : H(t, ["margin"], i, u)) : d + H(t, R.slice(r), i, u) } W(["Width", "Height"], function (t) { V["doc" + t] = function (e) { var o = e.document; return Math.max(o.documentElement["scroll" + t], o.body["scroll" + t], V["viewport" + t](o)) }, V["viewport" + t] = function (e) { var o = "client" + t, n = e.document, r = n.body, i = n.documentElement[o]; return "CSS1Compat" === n.compatMode && i || r && r[o] || i } }); var A = { position: "absolute", visibility: "hidden", display: "block" }; function M() { for (var t = arguments.length, e = Array(t), o = 0; o < t; o++)e[o] = arguments[o]; var n = void 0, r = e[0]; return 0 !== r.offsetWidth ? n = z.apply(void 0, e) : D(r, A, function () { n = z.apply(void 0, e) }), n } function X(t, e) { for (var o in e) e.hasOwnProperty(o) && (t[o] = e[o]); return t } W(["width", "height"], function (t) { var e = t.charAt(0).toUpperCase() + t.slice(1); V["outer" + e] = function (e, o) { return e && M(e, t, o ? F : E) }; var o = "width" === t ? ["Left", "Right"] : ["Top", "Bottom"]; V[t] = function (e, r) { var f = r; if (void 0 === f) return e && M(e, t, B); if (e) { var u = n(e); return O(e) && (f += H(e, ["padding", "border"], o, u)), i(e, t, f) } } }); var Y = { getWindow: function (t) { if (t && t.document && t.setTimeout) return t; var e = t.ownerDocument || t; return e.defaultView || e.parentWindow }, getDocument: c, offset: function (t, e, o) { if (void 0 === e) return a(t); P(t, e, o || {}) }, isWindow: p, each: W, css: i, clone: function (t) { var e = void 0, o = {}; for (e in t) t.hasOwnProperty(e) && (o[e] = t[e]); if (t.overflow) for (e in t) t.hasOwnProperty(e) && (o.overflow[e] = t.overflow[e]); return o }, mix: X, getWindowScrollLeft: function (t) { return l(t) }, getWindowScrollTop: function (t) { return d(t) }, merge: function () { for (var t = {}, e = arguments.length, o = Array(e), n = 0; n < e; n++)o[n] = arguments[n]; for (var r = 0; r < o.length; r++)Y.mix(t, o[r]); return t }, viewportWidth: 0, viewportHeight: 0 }; X(Y, V); var j = Y; exports.default = j;
    }, { "./propertyUtils": "tIov" }], "zOmV": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = t(require("./utils")); function t(e) { return e && e.__esModule ? e : { default: e } } function o(t) { if (e.default.isWindow(t) || 9 === t.nodeType) return null; var o = e.default.getDocument(t).body, r = void 0, u = e.default.css(t, "position"); if (!("fixed" === u || "absolute" === u)) return "html" === t.nodeName.toLowerCase() ? null : t.parentNode; for (r = t.parentNode; r && r !== o; r = r.parentNode)if ("static" !== (u = e.default.css(r, "position"))) return r; return null } var r = o; exports.default = r;
    }, { "./utils": "fDZk" }], "c2x+": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = r; var e = t(require("./utils")); function t(e) { return e && e.__esModule ? e : { default: e } } function r(t) { if (e.default.isWindow(t) || 9 === t.nodeType) return !1; var r = e.default.getDocument(t).body, u = null; for (u = t.parentNode; u && u !== r; u = u.parentNode) { if ("fixed" === e.default.css(u, "position")) return !0 } return !1 }
    }, { "./utils": "fDZk" }], "qnHP": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = i(require("./utils")), e = i(require("./getOffsetParent")), o = i(require("./isAncestorFixed")); function i(t) { return t && t.__esModule ? t : { default: t } } function l(i) { for (var l = { left: 0, right: 1 / 0, top: 0, bottom: 1 / 0 }, a = (0, e.default)(i), r = t.default.getDocument(i), f = r.defaultView || r.parentWindow, n = r.body, d = r.documentElement; a;) { if (-1 !== navigator.userAgent.indexOf("MSIE") && 0 === a.clientWidth || a === n || a === d || "visible" === t.default.css(a, "overflow")) { if (a === n || a === d) break } else { var u = t.default.offset(a); u.left += a.clientLeft, u.top += a.clientTop, l.top = Math.max(l.top, u.top), l.right = Math.min(l.right, u.left + a.clientWidth), l.bottom = Math.min(l.bottom, u.top + a.clientHeight), l.left = Math.max(l.left, u.left) } a = (0, e.default)(a) } var s = null; t.default.isWindow(i) || 9 === i.nodeType || (s = i.style.position, "absolute" === t.default.css(i, "position") && (i.style.position = "fixed")); var h = t.default.getWindowScrollLeft(f), p = t.default.getWindowScrollTop(f), m = t.default.viewportWidth(f), c = t.default.viewportHeight(f), g = d.scrollWidth, v = d.scrollHeight; if (i.style && (i.style.position = s), (0, o.default)(i)) l.left = Math.max(l.left, h), l.top = Math.max(l.top, p), l.right = Math.min(l.right, h + m), l.bottom = Math.min(l.bottom, p + c); else { var M = Math.max(g, h + m); l.right = Math.min(l.right, M); var b = Math.max(v, p + c); l.bottom = Math.min(l.bottom, b) } return l.top >= 0 && l.left >= 0 && l.bottom > l.top && l.right > l.left ? l : null } var a = l; exports.default = a;
    }, { "./utils": "fDZk", "./getOffsetParent": "zOmV", "./isAncestorFixed": "c2x+" }], "GEbj": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = e(require("./utils")); function e(t) { return t && t.__esModule ? t : { default: t } } function i(e, i, h, o) { var d = t.default.clone(e), l = { width: i.width, height: i.height }; return o.adjustX && d.left < h.left && (d.left = h.left), o.resizeWidth && d.left >= h.left && d.left + l.width > h.right && (l.width -= d.left + l.width - h.right), o.adjustX && d.left + l.width > h.right && (d.left = Math.max(h.right - l.width, h.left)), o.adjustY && d.top < h.top && (d.top = h.top), o.resizeHeight && d.top >= h.top && d.top + l.height > h.bottom && (l.height -= d.top + l.height - h.bottom), o.adjustY && d.top + l.height > h.bottom && (d.top = Math.max(h.bottom - l.height, h.top)), t.default.mix(d, l) } var h = i; exports.default = h;
    }, { "./utils": "fDZk" }], "PJWi": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = t(require("./utils")); function t(e) { return e && e.__esModule ? e : { default: e } } function d(t) { var d = void 0, o = void 0, i = void 0; if (e.default.isWindow(t) || 9 === t.nodeType) { var u = e.default.getWindow(t); d = { left: e.default.getWindowScrollLeft(u), top: e.default.getWindowScrollTop(u) }, o = e.default.viewportWidth(u), i = e.default.viewportHeight(u) } else d = e.default.offset(t), o = e.default.outerWidth(t), i = e.default.outerHeight(t); return d.width = o, d.height = i, d } var o = d; exports.default = o;
    }, { "./utils": "fDZk" }], "MG8N": [function (require, module, exports) {
        "use strict"; function t(t, e) { var r = e.charAt(0), o = e.charAt(1), a = t.width, c = t.height, u = t.left, d = t.top; return "c" === r ? d += c / 2 : "b" === r && (d += c), "c" === o ? u += a / 2 : "r" === o && (u += a), { left: u, top: d } } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = t; exports.default = e;
    }, {}], "V1fe": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = t(require("./getAlignOffset")); function t(e) { return e && e.__esModule ? e : { default: e } } function r(t, r, f, u, l) { var o = (0, e.default)(r, f[1]), a = (0, e.default)(t, f[0]), d = [a.left - o.left, a.top - o.top]; return { left: t.left - d[0] + u[0] - l[0], top: t.top - d[1] + u[1] - l[1] } } var f = r; exports.default = f;
    }, { "./getAlignOffset": "MG8N" }], "4B9f": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = f(require("../utils")), e = f(require("../getVisibleRectForElement")), u = f(require("../adjustForViewport")), r = f(require("../getRegion")), s = f(require("../getElFuturePos")); function f(t) { return t && t.__esModule ? t : { default: t } } function i(t, e, u) { return t.left < u.left || t.left + e.width > u.right } function o(t, e, u) { return t.top < u.top || t.top + e.height > u.bottom } function a(t, e, u) { return t.left > u.right || t.left + e.width < u.left } function n(t, e, u) { return t.top > u.bottom || t.top + e.height < u.top } function d(e, u, r) { var s = []; return t.default.each(e, function (t) { s.push(t.replace(u, function (t) { return r[t] })) }), s } function l(t, e) { return t[e] = -t[e], t } function h(t, e) { return (/%$/.test(t) ? parseInt(t.substring(0, t.length - 1), 10) / 100 * e : parseInt(t, 10)) || 0 } function g(t, e) { t[0] = h(t[0], e.width), t[1] = h(t[1], e.height) } function c(f, h, c, p) { var v = c.points, j = c.offset || [0, 0], w = c.targetOffset || [0, 0], m = c.overflow, b = c.source || f; j = [].concat(j), w = [].concat(w), m = m || {}; var C = {}, q = 0, X = (0, e.default)(b), Y = (0, r.default)(b); g(j, Y), g(w, h); var x = (0, s.default)(Y, h, v, j, w), O = t.default.merge(Y, x); if (X && (m.adjustX || m.adjustY) && p) { if (m.adjustX && i(x, Y, X)) { var R = d(v, /[lr]/gi, { l: "r", r: "l" }), _ = l(j, 0), F = l(w, 0); a((0, s.default)(Y, h, R, _, F), Y, X) || (q = 1, v = R, j = _, w = F) } if (m.adjustY && o(x, Y, X)) { var k = d(v, /[tb]/gi, { t: "b", b: "t" }), B = l(j, 1), E = l(w, 1); n((0, s.default)(Y, h, k, B, E), Y, X) || (q = 1, v = k, j = B, w = E) } q && (x = (0, s.default)(Y, h, v, j, w), t.default.mix(O, x)); var I = i(x, Y, X), M = o(x, Y, X); (I || M) && (v = c.points, j = c.offset || [0, 0], w = c.targetOffset || [0, 0]), C.adjustX = m.adjustX && I, C.adjustY = m.adjustY && M, (C.adjustX || C.adjustY) && (O = (0, u.default)(x, Y, X, C)) } return O.width !== Y.width && t.default.css(b, "width", t.default.width(b) + O.width - Y.width), O.height !== Y.height && t.default.css(b, "height", t.default.height(b) + O.height - Y.height), t.default.offset(b, { left: O.left, top: O.top }, { useCssRight: c.useCssRight, useCssBottom: c.useCssBottom, useCssTransform: c.useCssTransform, ignoreShake: c.ignoreShake }), { points: v, offset: j, targetOffset: w, overflow: C } } var p = c; exports.default = p;
    }, { "../utils": "fDZk", "../getVisibleRectForElement": "qnHP", "../adjustForViewport": "GEbj", "../getRegion": "PJWi", "../getElFuturePos": "V1fe" }], "sWu3": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = f(require("./align")), t = f(require("../getOffsetParent")), r = f(require("../getVisibleRectForElement")), u = f(require("../getRegion")); function f(e) { return e && e.__esModule ? e : { default: e } } function l(e) { var t = (0, r.default)(e), f = (0, u.default)(e); return !t || f.left + f.width <= t.left || f.top + f.height <= t.top || f.left >= t.right || f.top >= t.bottom } function i(t, r, f) { var i = f.target || r, a = (0, u.default)(i), o = !l(i); return (0, e.default)(t, a, f, o) } i.__getOffsetParent = t.default, i.__getVisibleRectForElement = r.default; var a = i; exports.default = a;
    }, { "./align": "4B9f", "../getOffsetParent": "zOmV", "../getVisibleRectForElement": "qnHP", "../getRegion": "PJWi" }], "Xi6G": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = r(require("../utils")), t = r(require("./align")); function r(e) { return e && e.__esModule ? e : { default: e } } var i = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) { var r = arguments[t]; for (var i in r) Object.prototype.hasOwnProperty.call(r, i) && (e[i] = r[i]) } return e }; function o(r, o, a) { var n = void 0, l = void 0, u = e.default.getDocument(r), d = u.defaultView || u.parentWindow, f = e.default.getWindowScrollLeft(d), p = e.default.getWindowScrollTop(d), c = e.default.viewportWidth(d), s = e.default.viewportHeight(d), v = { left: n = "pageX" in o ? o.pageX : f + o.clientX, top: l = "pageY" in o ? o.pageY : p + o.clientY, width: 0, height: 0 }, g = n >= 0 && n <= f + c && l >= 0 && l <= p + s, w = [a.points[0], "cc"]; return (0, t.default)(r, v, i({}, a, { points: w }), g) } var a = o; exports.default = a;
    }, { "../utils": "fDZk", "./align": "4B9f" }], "T6sb": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), Object.defineProperty(exports, "alignElement", { enumerable: !0, get: function () { return e.default } }), Object.defineProperty(exports, "alignPoint", { enumerable: !0, get: function () { return t.default } }), exports.default = void 0; var e = r(require("./align/alignElement")), t = r(require("./align/alignPoint")); function r(e) { return e && e.__esModule ? e : { default: e } } var n = e.default; exports.default = n;
    }, { "./align/alignElement": "sWu3", "./align/alignPoint": "Xi6G" }], "dMsq": [function (require, module, exports) {
        "use strict"; function e(e, n) { var t = void 0; function i() { t && (clearTimeout(t), t = null) } function o() { i(), t = setTimeout(e, n) } return o.clear = i, o } function n(e, n) { return e === n || !(!e || !n) && ("pageX" in n && "pageY" in n ? e.pageX === n.pageX && e.pageY === n.pageY : "clientX" in n && "clientY" in n && (e.clientX === n.clientX && e.clientY === n.clientY)) } function t(e) { return e && "object" == typeof e && e.window === e } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.buffer = e, exports.isSamePoint = n, exports.isWindow = t;
    }, {}], "He3b": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = d(require("babel-runtime/helpers/classCallCheck")), t = d(require("babel-runtime/helpers/possibleConstructorReturn")), r = d(require("babel-runtime/helpers/inherits")), i = a(require("react")), o = d(require("prop-types")), n = d(require("react-dom")), l = require("dom-align"), u = d(require("rc-util/es/Dom/addEventListener")), s = require("./util"); function a(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var i = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; i.get || i.set ? Object.defineProperty(t, r, i) : t[r] = e[r] } return t.default = e, t } function d(e) { return e && e.__esModule ? e : { default: e } } function f(e) { return "function" == typeof e && e ? e() : null } function p(e) { return "object" == typeof e && e ? e : null } var c = function (o) { function a() { var r, i, u; (0, e.default)(this, a); for (var s = arguments.length, d = Array(s), c = 0; c < s; c++)d[c] = arguments[c]; return r = i = (0, t.default)(this, o.call.apply(o, [this].concat(d))), i.forceAlign = function () { var e = i.props, t = e.disabled, r = e.target, o = e.align, u = e.onAlign; if (!t && r) { var s = n.default.findDOMNode(i), a = void 0, d = f(r), c = p(r); d ? a = (0, l.alignElement)(s, d, o) : c && (a = (0, l.alignPoint)(s, c, o)), u && u(s, a) } }, u = r, (0, t.default)(i, u) } return (0, r.default)(a, o), a.prototype.componentDidMount = function () { var e = this.props; this.forceAlign(), !e.disabled && e.monitorWindowResize && this.startMonitorWindowResize() }, a.prototype.componentDidUpdate = function (e) { var t = !1, r = this.props; if (!r.disabled) { var i = n.default.findDOMNode(this), o = i ? i.getBoundingClientRect() : null; if (e.disabled) t = !0; else { var l = f(e.target), u = f(r.target), a = p(e.target), d = p(r.target); (0, s.isWindow)(l) && (0, s.isWindow)(u) ? t = !1 : (l !== u || l && !u && d || a && d && u || d && !(0, s.isSamePoint)(a, d)) && (t = !0); var c = this.sourceRect || {}; t || !i || c.width === o.width && c.height === o.height || (t = !0) } this.sourceRect = o } t && this.forceAlign(), r.monitorWindowResize && !r.disabled ? this.startMonitorWindowResize() : this.stopMonitorWindowResize() }, a.prototype.componentWillUnmount = function () { this.stopMonitorWindowResize() }, a.prototype.startMonitorWindowResize = function () { this.resizeHandler || (this.bufferMonitor = (0, s.buffer)(this.forceAlign, this.props.monitorBufferTime), this.resizeHandler = (0, u.default)(window, "resize", this.bufferMonitor)) }, a.prototype.stopMonitorWindowResize = function () { this.resizeHandler && (this.bufferMonitor.clear(), this.resizeHandler.remove(), this.resizeHandler = null) }, a.prototype.render = function () { var e = this, t = this.props, r = t.childrenProps, o = t.children, n = i.default.Children.only(o); if (r) { var l = {}; return Object.keys(r).forEach(function (t) { l[t] = e.props[r[t]] }), i.default.cloneElement(n, l) } return n }, a }(i.Component); c.propTypes = { childrenProps: o.default.object, align: o.default.object.isRequired, target: o.default.oneOfType([o.default.func, o.default.shape({ clientX: o.default.number, clientY: o.default.number, pageX: o.default.number, pageY: o.default.number })]), onAlign: o.default.func, monitorBufferTime: o.default.number, monitorWindowResize: o.default.bool, disabled: o.default.bool, children: o.default.any }, c.defaultProps = { target: function () { return window }, monitorBufferTime: 50, monitorWindowResize: !1, disabled: !1 }; var h = c; exports.default = h;
    }, { "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "react-dom": "NKHc", "dom-align": "T6sb", "rc-util/es/Dom/addEventListener": "v9LT", "./util": "dMsq" }], "AVA2": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = t(require("./Align")); function t(e) { return e && e.__esModule ? e : { default: e } } var r = e.default; exports.default = r;
    }, { "./Align": "He3b" }], "B3Pp": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.toArrayChildren = e, exports.findChildInChildrenByKey = t, exports.findShownChildInChildrenByKey = o, exports.findHiddenChildInChildrenByKey = i, exports.isSameChildren = u, exports.mergeChildren = c; var r = n(require("react")); function n(r) { return r && r.__esModule ? r : { default: r } } function e(n) { var e = []; return r.default.Children.forEach(n, function (r) { e.push(r) }), e } function t(r, n) { var e = null; return r && r.forEach(function (r) { e || r && r.key === n && (e = r) }), e } function o(r, n, e) { var t = null; return r && r.forEach(function (r) { if (r && r.key === n && r.props[e]) { if (t) throw new Error("two child with same key for <rc-animate> children"); t = r } }), t } function i(r, n, e) { var t = 0; return r && r.forEach(function (r) { t || (t = r && r.key === n && !r.props[e]) }), t } function u(r, n, e) { var t = r.length === n.length; return t && r.forEach(function (r, o) { var i = n[o]; r && i && (r && !i || !r && i ? t = !1 : r.key !== i.key ? t = !1 : e && r.props[e] !== i.props[e] && (t = !1)) }), t } function c(r, n) { var e = [], o = {}, i = []; return r.forEach(function (r) { r && t(n, r.key) ? i.length && (o[r.key] = i, i = []) : i.push(r) }), n.forEach(function (r) { r && o.hasOwnProperty(r.key) && (e = e.concat(o[r.key])), e.push(r) }), e = e.concat(i) }
    }, { "react": "1n8/" }], "eUxv": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var n = { transitionend: { transition: "transitionend", WebkitTransition: "webkitTransitionEnd", MozTransition: "mozTransitionEnd", OTransition: "oTransitionEnd", msTransition: "MSTransitionEnd" }, animationend: { animation: "animationend", WebkitAnimation: "webkitAnimationEnd", MozAnimation: "mozAnimationEnd", OAnimation: "oAnimationEnd", msAnimation: "MSAnimationEnd" } }, i = []; function t() { var t = document.createElement("div").style; for (var e in "AnimationEvent" in window || delete n.animationend.animation, "TransitionEvent" in window || delete n.transitionend.transition, n) if (n.hasOwnProperty(e)) { var o = n[e]; for (var a in o) if (a in t) { i.push(o[a]); break } } } function e(n, i, t) { n.addEventListener(i, t, !1) } function o(n, i, t) { n.removeEventListener(i, t, !1) } "undefined" != typeof window && "undefined" != typeof document && t(); var a = { addEndEventListener: function (n, t) { 0 !== i.length ? i.forEach(function (i) { e(n, i, t) }) : window.setTimeout(t, 0) }, endEvents: i, removeEndEventListener: function (n, t) { 0 !== i.length && i.forEach(function (i) { o(n, i, t) }) } }, r = a; exports.default = r;
    }, {}], "v5sI": [function (require, module, exports) {
        module.exports = function (r, e) { if (r.indexOf) return r.indexOf(e); for (var n = 0; n < r.length; ++n)if (r[n] === e) return n; return -1 };
    }, {}], "m+xf": [function (require, module, exports) {
        try { var t = require("indexof") } catch (s) { t = require("component-indexof") } var i = /\s+/, e = Object.prototype.toString; function r(t) { if (!t || !t.nodeType) throw new Error("A DOM element reference is required"); this.el = t, this.list = t.classList } module.exports = function (t) { return new r(t) }, r.prototype.add = function (i) { if (this.list) return this.list.add(i), this; var e = this.array(); return ~t(e, i) || e.push(i), this.el.className = e.join(" "), this }, r.prototype.remove = function (i) { if ("[object RegExp]" == e.call(i)) return this.removeMatching(i); if (this.list) return this.list.remove(i), this; var r = this.array(), s = t(r, i); return ~s && r.splice(s, 1), this.el.className = r.join(" "), this }, r.prototype.removeMatching = function (t) { for (var i = this.array(), e = 0; e < i.length; e++)t.test(i[e]) && this.remove(i[e]); return this }, r.prototype.toggle = function (t, i) { return this.list ? (void 0 !== i ? i !== this.list.toggle(t, i) && this.list.toggle(t) : this.list.toggle(t), this) : (void 0 !== i ? i ? this.add(t) : this.remove(t) : this.has(t) ? this.remove(t) : this.add(t), this) }, r.prototype.array = function () { var t = (this.el.getAttribute("class") || "").replace(/^\s+|\s+$/g, "").split(i); return "" === t[0] && t.shift(), t }, r.prototype.has = r.prototype.contains = function (i) { return this.list ? this.list.contains(i) : !!~t(this.array(), i) };
    }, { "indexof": "v5sI", "component-indexof": "v5sI" }], "f3eR": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.isCssAnimationSupported = void 0; var e = i(require("babel-runtime/helpers/typeof")), t = i(require("./Event")), n = i(require("component-classes")); function i(e) { return e && e.__esModule ? e : { default: e } } var r = 0 !== t.default.endEvents.length; exports.isCssAnimationSupported = r; var o = ["Webkit", "Moz", "O", "ms"], u = ["-webkit-", "-moz-", "-o-", "ms-", ""]; function a(e, t) { for (var n = window.getComputedStyle(e, null), i = "", r = 0; r < u.length && !(i = n.getPropertyValue(u[r] + t)); r++); return i } function d(e) { if (r) { var t = parseFloat(a(e, "transition-delay")) || 0, n = parseFloat(a(e, "transition-duration")) || 0, i = parseFloat(a(e, "animation-delay")) || 0, o = parseFloat(a(e, "animation-duration")) || 0, u = Math.max(n + t, o + i); e.rcEndAnimTimeout = setTimeout(function () { e.rcEndAnimTimeout = null, e.rcEndListener && e.rcEndListener() }, 1e3 * u + 200) } } function s(e) { e.rcEndAnimTimeout && (clearTimeout(e.rcEndAnimTimeout), e.rcEndAnimTimeout = null) } var c = function (i, r, o) { var u = "object" === (void 0 === r ? "undefined" : (0, e.default)(r)), a = u ? r.name : r, c = u ? r.active : r + "-active", m = o, l = void 0, E = void 0, f = (0, n.default)(i); return o && "[object Object]" === Object.prototype.toString.call(o) && (m = o.end, l = o.start, E = o.active), i.rcEndListener && i.rcEndListener(), i.rcEndListener = function (e) { e && e.target !== i || (i.rcAnimTimeout && (clearTimeout(i.rcAnimTimeout), i.rcAnimTimeout = null), s(i), f.remove(a), f.remove(c), t.default.removeEndEventListener(i, i.rcEndListener), i.rcEndListener = null, m && m()) }, t.default.addEndEventListener(i, i.rcEndListener), l && l(), f.add(a), i.rcAnimTimeout = setTimeout(function () { i.rcAnimTimeout = null, f.add(c), E && setTimeout(E, 0), d(i) }, 30), { stop: function () { i.rcEndListener && i.rcEndListener() } } }; c.style = function (e, n, i) { e.rcEndListener && e.rcEndListener(), e.rcEndListener = function (n) { n && n.target !== e || (e.rcAnimTimeout && (clearTimeout(e.rcAnimTimeout), e.rcAnimTimeout = null), s(e), t.default.removeEndEventListener(e, e.rcEndListener), e.rcEndListener = null, i && i()) }, t.default.addEndEventListener(e, e.rcEndListener), e.rcAnimTimeout = setTimeout(function () { for (var t in n) n.hasOwnProperty(t) && (e.style[t] = n[t]); e.rcAnimTimeout = null, d(e) }, 0) }, c.setTransition = function (e, t, n) { var i = t, r = n; void 0 === n && (r = i, i = ""), i = i || "", o.forEach(function (t) { e.style[t + "Transition" + i] = r }) }, c.isCssAnimationSupported = r; var m = c; exports.default = m;
    }, { "babel-runtime/helpers/typeof": "GyB/", "./Event": "eUxv", "component-classes": "m+xf" }], "CwbJ": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var n = { isAppearSupported: function (n) { return n.transitionName && n.transitionAppear || n.animation.appear }, isEnterSupported: function (n) { return n.transitionName && n.transitionEnter || n.animation.enter }, isLeaveSupported: function (n) { return n.transitionName && n.transitionLeave || n.animation.leave }, allowAppearCallback: function (n) { return n.transitionAppear || n.animation.appear }, allowEnterCallback: function (n) { return n.transitionEnter || n.animation.enter }, allowLeaveCallback: function (n) { return n.transitionLeave || n.animation.leave } }, t = n; exports.default = t;
    }, {}], "sYx7": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = c(require("babel-runtime/helpers/typeof")), t = c(require("babel-runtime/helpers/classCallCheck")), r = c(require("babel-runtime/helpers/createClass")), i = c(require("babel-runtime/helpers/possibleConstructorReturn")), n = c(require("babel-runtime/helpers/inherits")), o = c(require("react")), a = c(require("react-dom")), p = c(require("prop-types")), s = l(require("css-animation")), u = c(require("./util")); function l(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var i = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; i.get || i.set ? Object.defineProperty(t, r, i) : t[r] = e[r] } return t.default = e, t } function c(e) { return e && e.__esModule ? e : { default: e } } var f = { enter: "transitionEnter", appear: "transitionAppear", leave: "transitionLeave" }, d = function (o) { function p() { return (0, t.default)(this, p), (0, i.default)(this, (p.__proto__ || Object.getPrototypeOf(p)).apply(this, arguments)) } return (0, n.default)(p, o), (0, r.default)(p, [{ key: "componentWillUnmount", value: function () { this.stop() } }, { key: "componentWillEnter", value: function (e) { u.default.isEnterSupported(this.props) ? this.transition("enter", e) : e() } }, { key: "componentWillAppear", value: function (e) { u.default.isAppearSupported(this.props) ? this.transition("appear", e) : e() } }, { key: "componentWillLeave", value: function (e) { u.default.isLeaveSupported(this.props) ? this.transition("leave", e) : e() } }, { key: "transition", value: function (t, r) { var i = this, n = a.default.findDOMNode(this), o = this.props, p = o.transitionName, u = "object" === (void 0 === p ? "undefined" : (0, e.default)(p)); this.stop(); var l = function () { i.stopper = null, r() }; if ((s.isCssAnimationSupported || !o.animation[t]) && p && o[f[t]]) { var c = u ? p[t] : p + "-" + t, d = c + "-active"; u && p[t + "Active"] && (d = p[t + "Active"]), this.stopper = (0, s.default)(n, { name: c, active: d }, l) } else this.stopper = o.animation[t](n, l) } }, { key: "stop", value: function () { var e = this.stopper; e && (this.stopper = null, e.stop()) } }, { key: "render", value: function () { return this.props.children } }]), p }(o.default.Component); d.propTypes = { children: p.default.any }; var h = d; exports.default = h;
    }, { "babel-runtime/helpers/typeof": "GyB/", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "react-dom": "NKHc", "prop-types": "5D9O", "css-animation": "f3eR", "./util": "CwbJ" }], "mKtm": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = f(require("babel-runtime/helpers/extends")), n = f(require("babel-runtime/helpers/defineProperty")), r = f(require("babel-runtime/helpers/classCallCheck")), t = f(require("babel-runtime/helpers/createClass")), i = f(require("babel-runtime/helpers/possibleConstructorReturn")), a = f(require("babel-runtime/helpers/inherits")), o = f(require("react")), l = f(require("prop-types")), s = require("./ChildrenUtils"), u = f(require("./AnimateChild")), d = f(require("./util")); function f(e) { return e && e.__esModule ? e : { default: e } } var p = "rc_animate_" + Date.now(); function h(e) { var n = e.children; return o.default.isValidElement(n) && !n.key ? o.default.cloneElement(n, { key: p }) : n } function c() { } var y = function (l) { function d(e) { (0, r.default)(this, d); var n = (0, i.default)(this, (d.__proto__ || Object.getPrototypeOf(d)).call(this, e)); return v.call(n), n.currentlyAnimatingKeys = {}, n.keysToEnter = [], n.keysToLeave = [], n.state = { children: (0, s.toArrayChildren)(h(e)) }, n.childrenRefs = {}, n } return (0, a.default)(d, l), (0, t.default)(d, [{ key: "componentDidMount", value: function () { var e = this, n = this.props.showProp, r = this.state.children; n && (r = r.filter(function (e) { return !!e.props[n] })), r.forEach(function (n) { n && e.performAppear(n.key) }) } }, { key: "componentWillReceiveProps", value: function (e) { var r = this; this.nextProps = e; var t = (0, s.toArrayChildren)(h(e)), i = this.props; i.exclusive && Object.keys(this.currentlyAnimatingKeys).forEach(function (e) { r.stop(e) }); var a = i.showProp, l = this.currentlyAnimatingKeys, u = i.exclusive ? (0, s.toArrayChildren)(h(i)) : this.state.children, d = []; a ? (u.forEach(function (e) { var r = e && (0, s.findChildInChildrenByKey)(t, e.key), i = void 0; (i = r && r.props[a] || !e.props[a] ? r : o.default.cloneElement(r || e, (0, n.default)({}, a, !0))) && d.push(i) }), t.forEach(function (e) { e && (0, s.findChildInChildrenByKey)(u, e.key) || d.push(e) })) : d = (0, s.mergeChildren)(u, t), this.setState({ children: d }), t.forEach(function (e) { var n = e && e.key; if (!e || !l[n]) { var t = e && (0, s.findChildInChildrenByKey)(u, n); if (a) { var i = e.props[a]; if (t) !(0, s.findShownChildInChildrenByKey)(u, n, a) && i && r.keysToEnter.push(n); else i && r.keysToEnter.push(n) } else t || r.keysToEnter.push(n) } }), u.forEach(function (e) { var n = e && e.key; if (!e || !l[n]) { var i = e && (0, s.findChildInChildrenByKey)(t, n); if (a) { var o = e.props[a]; if (i) !(0, s.findShownChildInChildrenByKey)(t, n, a) && o && r.keysToLeave.push(n); else o && r.keysToLeave.push(n) } else i || r.keysToLeave.push(n) } }) } }, { key: "componentDidUpdate", value: function () { var e = this.keysToEnter; this.keysToEnter = [], e.forEach(this.performEnter); var n = this.keysToLeave; this.keysToLeave = [], n.forEach(this.performLeave) } }, { key: "isValidChildByKey", value: function (e, n) { var r = this.props.showProp; return r ? (0, s.findShownChildInChildrenByKey)(e, n, r) : (0, s.findChildInChildrenByKey)(e, n) } }, { key: "stop", value: function (e) { delete this.currentlyAnimatingKeys[e]; var n = this.childrenRefs[e]; n && n.stop() } }, { key: "render", value: function () { var n = this, r = this.props; this.nextProps = r; var t = this.state.children, i = null; t && (i = t.map(function (e) { if (null == e) return e; if (!e.key) throw new Error("must set key for <rc-animate> children"); return o.default.createElement(u.default, { key: e.key, ref: function (r) { return n.childrenRefs[e.key] = r }, animation: r.animation, transitionName: r.transitionName, transitionEnter: r.transitionEnter, transitionAppear: r.transitionAppear, transitionLeave: r.transitionLeave }, e) })); var a = r.component; if (a) { var l = r; return "string" == typeof a && (l = (0, e.default)({ className: r.className, style: r.style }, r.componentProps)), o.default.createElement(a, l, i) } return i[0] || null } }]), d }(o.default.Component); y.isAnimate = !0, y.propTypes = { component: l.default.any, componentProps: l.default.object, animation: l.default.object, transitionName: l.default.oneOfType([l.default.string, l.default.object]), transitionEnter: l.default.bool, transitionAppear: l.default.bool, exclusive: l.default.bool, transitionLeave: l.default.bool, onEnd: l.default.func, onEnter: l.default.func, onLeave: l.default.func, onAppear: l.default.func, showProp: l.default.string }, y.defaultProps = { animation: {}, component: "span", componentProps: {}, transitionEnter: !0, transitionLeave: !0, transitionAppear: !1, onEnd: c, onEnter: c, onLeave: c, onAppear: c }; var v = function () { var e = this; this.performEnter = function (n) { e.childrenRefs[n] && (e.currentlyAnimatingKeys[n] = !0, e.childrenRefs[n].componentWillEnter(e.handleDoneAdding.bind(e, n, "enter"))) }, this.performAppear = function (n) { e.childrenRefs[n] && (e.currentlyAnimatingKeys[n] = !0, e.childrenRefs[n].componentWillAppear(e.handleDoneAdding.bind(e, n, "appear"))) }, this.handleDoneAdding = function (n, r) { var t = e.props; if (delete e.currentlyAnimatingKeys[n], !t.exclusive || t === e.nextProps) { var i = (0, s.toArrayChildren)(h(t)); e.isValidChildByKey(i, n) ? "appear" === r ? d.default.allowAppearCallback(t) && (t.onAppear(n), t.onEnd(n, !0)) : d.default.allowEnterCallback(t) && (t.onEnter(n), t.onEnd(n, !0)) : e.performLeave(n) } }, this.performLeave = function (n) { e.childrenRefs[n] && (e.currentlyAnimatingKeys[n] = !0, e.childrenRefs[n].componentWillLeave(e.handleDoneLeaving.bind(e, n))) }, this.handleDoneLeaving = function (n) { var r = e.props; if (delete e.currentlyAnimatingKeys[n], !r.exclusive || r === e.nextProps) { var t = (0, s.toArrayChildren)(h(r)); if (e.isValidChildByKey(t, n)) e.performEnter(n); else { var i = function () { d.default.allowLeaveCallback(r) && (r.onLeave(n), r.onEnd(n, !1)) }; (0, s.isSameChildren)(e.state.children, t, r.showProp) ? i() : e.setState({ children: t }, i) } } } }, m = y; exports.default = m;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "./ChildrenUtils": "B3Pp", "./AnimateChild": "sYx7", "./util": "CwbJ" }], "xHPX": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = u(require("babel-runtime/helpers/objectWithoutProperties")), r = u(require("babel-runtime/helpers/classCallCheck")), t = u(require("babel-runtime/helpers/possibleConstructorReturn")), i = u(require("babel-runtime/helpers/inherits")), l = s(require("react")), n = u(require("prop-types")); function s(e) { if (e && e.__esModule) return e; var r = {}; if (null != e) for (var t in e) if (Object.prototype.hasOwnProperty.call(e, t)) { var i = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, t) : {}; i.get || i.set ? Object.defineProperty(r, t, i) : r[t] = e[t] } return r.default = e, r } function u(e) { return e && e.__esModule ? e : { default: e } } var a = function (n) { function s() { return (0, r.default)(this, s), (0, t.default)(this, n.apply(this, arguments)) } return (0, i.default)(s, n), s.prototype.shouldComponentUpdate = function (e) { return e.hiddenClassName || e.visible }, s.prototype.render = function () { var r = this.props, t = r.hiddenClassName, i = r.visible, n = (0, e.default)(r, ["hiddenClassName", "visible"]); return t || l.default.Children.count(n.children) > 1 ? (!i && t && (n.className += " " + t), l.default.createElement("div", n)) : l.default.Children.only(n.children) }, s }(l.Component); a.propTypes = { children: n.default.any, className: n.default.string, visible: n.default.bool, hiddenClassName: n.default.string }; var o = a; exports.default = o;
    }, { "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O" }], "hk5C": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = u(require("babel-runtime/helpers/classCallCheck")), r = u(require("babel-runtime/helpers/possibleConstructorReturn")), t = u(require("babel-runtime/helpers/inherits")), n = l(require("react")), s = u(require("prop-types")), a = u(require("./LazyRenderBox")); function l(e) { if (e && e.__esModule) return e; var r = {}; if (null != e) for (var t in e) if (Object.prototype.hasOwnProperty.call(e, t)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, t) : {}; n.get || n.set ? Object.defineProperty(r, t, n) : r[t] = e[t] } return r.default = e, r } function u(e) { return e && e.__esModule ? e : { default: e } } var i = function (s) { function l() { return (0, e.default)(this, l), (0, r.default)(this, s.apply(this, arguments)) } return (0, t.default)(l, s), l.prototype.render = function () { var e = this.props, r = e.className; return e.visible || (r += " " + e.hiddenClassName), n.default.createElement("div", { className: r, onMouseEnter: e.onMouseEnter, onMouseLeave: e.onMouseLeave, style: e.style }, n.default.createElement(a.default, { className: e.prefixCls + "-content", visible: e.visible }, e.children)) }, l }(n.Component); i.propTypes = { hiddenClassName: s.default.string, className: s.default.string, prefixCls: s.default.string, onMouseEnter: s.default.func, onMouseLeave: s.default.func, children: s.default.any }; var o = i; exports.default = o;
    }, { "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "./LazyRenderBox": "xHPX" }], "jQUK": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.getAlignFromPlacement = n, exports.getAlignPopupClassName = u, exports.saveRef = o; var e = t(require("babel-runtime/helpers/extends")); function t(e) { return e && e.__esModule ? e : { default: e } } function r(e, t, r) { return r ? e[0] === t[0] : e[0] === t[0] && e[1] === t[1] } function n(t, r, n) { var u = t[r] || {}; return (0, e.default)({}, u, n) } function u(e, t, n, u) { var o = n.points; for (var s in e) if (e.hasOwnProperty(s) && r(e[s].points, o, u)) return t + "-placement-" + s; return "" } function o(e, t) { this[e] = t }
    }, { "babel-runtime/helpers/extends": "T4f3" }], "qyht": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = c(require("babel-runtime/helpers/extends")), t = c(require("babel-runtime/helpers/classCallCheck")), i = c(require("babel-runtime/helpers/possibleConstructorReturn")), n = c(require("babel-runtime/helpers/inherits")), r = f(require("react")), a = c(require("prop-types")), s = c(require("react-dom")), o = c(require("rc-align")), l = c(require("rc-animate")), u = c(require("./PopupInner")), p = c(require("./LazyRenderBox")), d = require("./utils"); function f(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var i in e) if (Object.prototype.hasOwnProperty.call(e, i)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, i) : {}; n.get || n.set ? Object.defineProperty(t, i, n) : t[i] = e[i] } return t.default = e, t } function c(e) { return e && e.__esModule ? e : { default: e } } var h = function (a) { function f(e) { (0, t.default)(this, f); var n = (0, i.default)(this, a.call(this, e)); return g.call(n), n.state = { stretchChecked: !1, targetWidth: void 0, targetHeight: void 0 }, n.savePopupRef = d.saveRef.bind(n, "popupInstance"), n.saveAlignRef = d.saveRef.bind(n, "alignInstance"), n } return (0, n.default)(f, a), f.prototype.componentDidMount = function () { this.rootNode = this.getPopupDomNode(), this.setStretchSize() }, f.prototype.componentDidUpdate = function () { this.setStretchSize() }, f.prototype.getPopupDomNode = function () { return s.default.findDOMNode(this.popupInstance) }, f.prototype.getMaskTransitionName = function () { var e = this.props, t = e.maskTransitionName, i = e.maskAnimation; return !t && i && (t = e.prefixCls + "-" + i), t }, f.prototype.getTransitionName = function () { var e = this.props, t = e.transitionName; return !t && e.animation && (t = e.prefixCls + "-" + e.animation), t }, f.prototype.getClassName = function (e) { return this.props.prefixCls + " " + this.props.className + " " + e }, f.prototype.getPopupElement = function () { var t = this, i = this.savePopupRef, n = this.state, a = n.stretchChecked, s = n.targetHeight, p = n.targetWidth, d = this.props, f = d.align, c = d.visible, h = d.prefixCls, g = d.style, m = d.getClassNameFromAlign, v = d.destroyPopupOnHide, b = d.stretch, y = d.children, N = d.onMouseEnter, C = d.onMouseLeave, x = this.getClassName(this.currentAlignClassName || m(f)), A = h + "-hidden"; c || (this.currentAlignClassName = null); var k = {}; b && (-1 !== b.indexOf("height") ? k.height = s : -1 !== b.indexOf("minHeight") && (k.minHeight = s), -1 !== b.indexOf("width") ? k.width = p : -1 !== b.indexOf("minWidth") && (k.minWidth = p), a || (k.visibility = "hidden", setTimeout(function () { t.alignInstance && t.alignInstance.forceAlign() }, 0))); var E = { className: x, prefixCls: h, ref: i, onMouseEnter: N, onMouseLeave: C, style: (0, e.default)({}, k, g, this.getZIndexStyle()) }; return v ? r.default.createElement(l.default, { component: "", exclusive: !0, transitionAppear: !0, transitionName: this.getTransitionName() }, c ? r.default.createElement(o.default, { target: this.getAlignTarget(), key: "popup", ref: this.saveAlignRef, monitorWindowResize: !0, align: f, onAlign: this.onAlign }, r.default.createElement(u.default, (0, e.default)({ visible: !0 }, E), y)) : null) : r.default.createElement(l.default, { component: "", exclusive: !0, transitionAppear: !0, transitionName: this.getTransitionName(), showProp: "xVisible" }, r.default.createElement(o.default, { target: this.getAlignTarget(), key: "popup", ref: this.saveAlignRef, monitorWindowResize: !0, xVisible: c, childrenProps: { visible: "xVisible" }, disabled: !c, align: f, onAlign: this.onAlign }, r.default.createElement(u.default, (0, e.default)({ hiddenClassName: A }, E), y))) }, f.prototype.getZIndexStyle = function () { var e = {}, t = this.props; return void 0 !== t.zIndex && (e.zIndex = t.zIndex), e }, f.prototype.getMaskElement = function () { var e = this.props, t = void 0; if (e.mask) { var i = this.getMaskTransitionName(); t = r.default.createElement(p.default, { style: this.getZIndexStyle(), key: "mask", className: e.prefixCls + "-mask", hiddenClassName: e.prefixCls + "-mask-hidden", visible: e.visible }), i && (t = r.default.createElement(l.default, { key: "mask", showProp: "visible", transitionAppear: !0, component: "", transitionName: i }, t)) } return t }, f.prototype.render = function () { return r.default.createElement("div", null, this.getMaskElement(), this.getPopupElement()) }, f }(r.Component); h.propTypes = { visible: a.default.bool, style: a.default.object, getClassNameFromAlign: a.default.func, onAlign: a.default.func, getRootDomNode: a.default.func, onMouseEnter: a.default.func, align: a.default.any, destroyPopupOnHide: a.default.bool, className: a.default.string, prefixCls: a.default.string, onMouseLeave: a.default.func, stretch: a.default.string, children: a.default.node, point: a.default.shape({ pageX: a.default.number, pageY: a.default.number }) }; var g = function () { var e = this; this.onAlign = function (t, i) { var n = e.props, r = n.getClassNameFromAlign(i); e.currentAlignClassName !== r && (e.currentAlignClassName = r, t.className = e.getClassName(r)), n.onAlign(t, i) }, this.setStretchSize = function () { var t = e.props, i = t.stretch, n = t.getRootDomNode, r = t.visible, a = e.state, s = a.stretchChecked, o = a.targetHeight, l = a.targetWidth; if (i && r) { var u = n(); if (u) { var p = u.offsetHeight, d = u.offsetWidth; o === p && l === d && s || e.setState({ stretchChecked: !0, targetHeight: p, targetWidth: d }) } } else s && e.setState({ stretchChecked: !1 }) }, this.getTargetElement = function () { return e.props.getRootDomNode() }, this.getAlignTarget = function () { var t = e.props.point; return t || e.getTargetElement } }, m = h; exports.default = m;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "react-dom": "NKHc", "rc-align": "AVA2", "rc-animate": "mKtm", "./PopupInner": "hk5C", "./LazyRenderBox": "xHPX", "./utils": "jQUK" }], "GJtx": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = i(require("babel-runtime/helpers/classCallCheck")), t = i(require("babel-runtime/helpers/createClass")), n = i(require("babel-runtime/helpers/possibleConstructorReturn")), r = i(require("babel-runtime/helpers/inherits")), o = i(require("react")), u = i(require("react-dom")), a = i(require("prop-types")); function i(e) { return e && e.__esModule ? e : { default: e } } var l = function (o) { function a() { var t, r, o, i; (0, e.default)(this, a); for (var l = arguments.length, s = Array(l), p = 0; p < l; p++)s[p] = arguments[p]; return r = o = (0, n.default)(this, (t = a.__proto__ || Object.getPrototypeOf(a)).call.apply(t, [this].concat(s))), o.removeContainer = function () { o.container && (u.default.unmountComponentAtNode(o.container), o.container.parentNode.removeChild(o.container), o.container = null) }, o.renderComponent = function (e, t) { var n = o.props, r = n.visible, a = n.getComponent, i = n.forceRender, l = n.getContainer, s = n.parent; (r || s._component || i) && (o.container || (o.container = l()), u.default.unstable_renderSubtreeIntoContainer(s, a(e), o.container, function () { t && t.call(this) })) }, i = r, (0, n.default)(o, i) } return (0, r.default)(a, o), (0, t.default)(a, [{ key: "componentDidMount", value: function () { this.props.autoMount && this.renderComponent() } }, { key: "componentDidUpdate", value: function () { this.props.autoMount && this.renderComponent() } }, { key: "componentWillUnmount", value: function () { this.props.autoDestroy && this.removeContainer() } }, { key: "render", value: function () { return this.props.children({ renderComponent: this.renderComponent, removeContainer: this.removeContainer }) } }]), a }(o.default.Component); l.propTypes = { autoMount: a.default.bool, autoDestroy: a.default.bool, visible: a.default.bool, forceRender: a.default.bool, parent: a.default.any, getComponent: a.default.func.isRequired, getContainer: a.default.func.isRequired, children: a.default.func.isRequired }, l.defaultProps = { autoMount: !0, autoDestroy: !0, forceRender: !1 }; var s = l; exports.default = s;
    }, { "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "react-dom": "NKHc", "prop-types": "5D9O" }], "LoYh": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = u(require("babel-runtime/helpers/classCallCheck")), t = u(require("babel-runtime/helpers/createClass")), r = u(require("babel-runtime/helpers/possibleConstructorReturn")), n = u(require("babel-runtime/helpers/inherits")), i = u(require("react")), o = u(require("react-dom")), a = u(require("prop-types")); function u(e) { return e && e.__esModule ? e : { default: e } } var l = function (i) { function a() { return (0, e.default)(this, a), (0, r.default)(this, (a.__proto__ || Object.getPrototypeOf(a)).apply(this, arguments)) } return (0, n.default)(a, i), (0, t.default)(a, [{ key: "componentDidMount", value: function () { this.createContainer() } }, { key: "componentDidUpdate", value: function (e) { var t = this.props.didUpdate; t && t(e) } }, { key: "componentWillUnmount", value: function () { this.removeContainer() } }, { key: "createContainer", value: function () { this._container = this.props.getContainer(), this.forceUpdate() } }, { key: "removeContainer", value: function () { this._container && this._container.parentNode.removeChild(this._container) } }, { key: "render", value: function () { return this._container ? o.default.createPortal(this.props.children, this._container) : null } }]), a }(i.default.Component); l.propTypes = { getContainer: a.default.func.isRequired, children: a.default.node.isRequired, didUpdate: a.default.func }; var s = l; exports.default = s;
    }, { "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "react-dom": "NKHc", "prop-types": "5D9O" }], "P/ZM": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = f(require("babel-runtime/helpers/extends")), t = f(require("babel-runtime/helpers/classCallCheck")), o = f(require("babel-runtime/helpers/possibleConstructorReturn")), n = f(require("babel-runtime/helpers/inherits")), i = f(require("react")), s = f(require("prop-types")), u = require("react-dom"), p = f(require("rc-util/es/Dom/contains")), r = f(require("rc-util/es/Dom/addEventListener")), a = f(require("./Popup")), l = require("./utils"), c = f(require("rc-util/es/ContainerRender")), d = f(require("rc-util/es/Portal")), h = f(require("classnames")); function f(e) { return e && e.__esModule ? e : { default: e } } function m() { } function g() { return "" } function C() { return window.document } var v = ["onClick", "onMouseDown", "onTouchStart", "onMouseEnter", "onMouseLeave", "onFocus", "onBlur", "onContextMenu"], b = !!u.createPortal, T = function (e) { function s(n) { (0, t.default)(this, s); var i = (0, o.default)(this, e.call(this, n)); y.call(i); var u = void 0; return u = "popupVisible" in n ? !!n.popupVisible : !!n.defaultPopupVisible, i.prevPopupVisible = u, i.state = { popupVisible: u }, i } return (0, n.default)(s, e), s.prototype.componentWillMount = function () { var e = this; v.forEach(function (t) { e["fire" + t] = function (o) { e.fireEvents(t, o) } }) }, s.prototype.componentDidMount = function () { this.componentDidUpdate({}, { popupVisible: this.state.popupVisible }) }, s.prototype.componentWillReceiveProps = function (e) { var t = e.popupVisible; void 0 !== t && this.setState({ popupVisible: t }) }, s.prototype.componentDidUpdate = function (e, t) { var o = this.props, n = this.state; if (b || this.renderComponent(null, function () { t.popupVisible !== n.popupVisible && o.afterPopupVisibleChange(n.popupVisible) }), this.prevPopupVisible = t.popupVisible, n.popupVisible) { var i = void 0; return this.clickOutsideHandler || !this.isClickToHide() && !this.isContextMenuToShow() || (i = o.getDocument(), this.clickOutsideHandler = (0, r.default)(i, "mousedown", this.onDocumentClick)), this.touchOutsideHandler || (i = i || o.getDocument(), this.touchOutsideHandler = (0, r.default)(i, "touchstart", this.onDocumentClick)), !this.contextMenuOutsideHandler1 && this.isContextMenuToShow() && (i = i || o.getDocument(), this.contextMenuOutsideHandler1 = (0, r.default)(i, "scroll", this.onContextMenuClose)), void (!this.contextMenuOutsideHandler2 && this.isContextMenuToShow() && (this.contextMenuOutsideHandler2 = (0, r.default)(window, "blur", this.onContextMenuClose))) } this.clearOutsideHandler() }, s.prototype.componentWillUnmount = function () { this.clearDelayTimer(), this.clearOutsideHandler() }, s.prototype.getPopupDomNode = function () { return this._component && this._component.getPopupDomNode ? this._component.getPopupDomNode() : null }, s.prototype.getPopupAlign = function () { var e = this.props, t = e.popupPlacement, o = e.popupAlign, n = e.builtinPlacements; return t && n ? (0, l.getAlignFromPlacement)(n, t, o) : o }, s.prototype.setPopupVisible = function (e, t) { var o = this.props.alignPoint; this.clearDelayTimer(), this.state.popupVisible !== e && ("popupVisible" in this.props || this.setState({ popupVisible: e }), this.props.onPopupVisibleChange(e)), o && t && this.setPoint(t) }, s.prototype.delaySetPopupVisible = function (e, t, o) { var n = this, i = 1e3 * t; if (this.clearDelayTimer(), i) { var s = o ? { pageX: o.pageX, pageY: o.pageY } : null; this.delayTimer = setTimeout(function () { n.setPopupVisible(e, s), n.clearDelayTimer() }, i) } else this.setPopupVisible(e, o) }, s.prototype.clearDelayTimer = function () { this.delayTimer && (clearTimeout(this.delayTimer), this.delayTimer = null) }, s.prototype.clearOutsideHandler = function () { this.clickOutsideHandler && (this.clickOutsideHandler.remove(), this.clickOutsideHandler = null), this.contextMenuOutsideHandler1 && (this.contextMenuOutsideHandler1.remove(), this.contextMenuOutsideHandler1 = null), this.contextMenuOutsideHandler2 && (this.contextMenuOutsideHandler2.remove(), this.contextMenuOutsideHandler2 = null), this.touchOutsideHandler && (this.touchOutsideHandler.remove(), this.touchOutsideHandler = null) }, s.prototype.createTwoChains = function (e) { var t = this.props.children.props, o = this.props; return t[e] && o[e] ? this["fire" + e] : t[e] || o[e] }, s.prototype.isClickToShow = function () { var e = this.props, t = e.action, o = e.showAction; return -1 !== t.indexOf("click") || -1 !== o.indexOf("click") }, s.prototype.isContextMenuToShow = function () { var e = this.props, t = e.action, o = e.showAction; return -1 !== t.indexOf("contextMenu") || -1 !== o.indexOf("contextMenu") }, s.prototype.isClickToHide = function () { var e = this.props, t = e.action, o = e.hideAction; return -1 !== t.indexOf("click") || -1 !== o.indexOf("click") }, s.prototype.isMouseEnterToShow = function () { var e = this.props, t = e.action, o = e.showAction; return -1 !== t.indexOf("hover") || -1 !== o.indexOf("mouseEnter") }, s.prototype.isMouseLeaveToHide = function () { var e = this.props, t = e.action, o = e.hideAction; return -1 !== t.indexOf("hover") || -1 !== o.indexOf("mouseLeave") }, s.prototype.isFocusToShow = function () { var e = this.props, t = e.action, o = e.showAction; return -1 !== t.indexOf("focus") || -1 !== o.indexOf("focus") }, s.prototype.isBlurToHide = function () { var e = this.props, t = e.action, o = e.hideAction; return -1 !== t.indexOf("focus") || -1 !== o.indexOf("blur") }, s.prototype.forcePopupAlign = function () { this.state.popupVisible && this._component && this._component.alignInstance && this._component.alignInstance.forceAlign() }, s.prototype.fireEvents = function (e, t) { var o = this.props.children.props[e]; o && o(t); var n = this.props[e]; n && n(t) }, s.prototype.close = function () { this.setPopupVisible(!1) }, s.prototype.render = function () { var e = this, t = this.state.popupVisible, o = this.props, n = o.children, s = o.forceRender, u = o.alignPoint, p = o.className, r = i.default.Children.only(n), a = { key: "trigger" }; this.isContextMenuToShow() ? a.onContextMenu = this.onContextMenu : a.onContextMenu = this.createTwoChains("onContextMenu"), this.isClickToHide() || this.isClickToShow() ? (a.onClick = this.onClick, a.onMouseDown = this.onMouseDown, a.onTouchStart = this.onTouchStart) : (a.onClick = this.createTwoChains("onClick"), a.onMouseDown = this.createTwoChains("onMouseDown"), a.onTouchStart = this.createTwoChains("onTouchStart")), this.isMouseEnterToShow() ? (a.onMouseEnter = this.onMouseEnter, u && (a.onMouseMove = this.onMouseMove)) : a.onMouseEnter = this.createTwoChains("onMouseEnter"), this.isMouseLeaveToHide() ? a.onMouseLeave = this.onMouseLeave : a.onMouseLeave = this.createTwoChains("onMouseLeave"), this.isFocusToShow() || this.isBlurToHide() ? (a.onFocus = this.onFocus, a.onBlur = this.onBlur) : (a.onFocus = this.createTwoChains("onFocus"), a.onBlur = this.createTwoChains("onBlur")); var l = (0, h.default)(r && r.props && r.props.className, p); l && (a.className = l); var f = i.default.cloneElement(r, a); if (!b) return i.default.createElement(c.default, { parent: this, visible: t, autoMount: !1, forceRender: s, getComponent: this.getComponent, getContainer: this.getContainer }, function (t) { var o = t.renderComponent; return e.renderComponent = o, f }); var m = void 0; return (t || this._component || s) && (m = i.default.createElement(d.default, { key: "portal", getContainer: this.getContainer, didUpdate: this.handlePortalUpdate }, this.getComponent())), [f, m] }, s }(i.default.Component); T.propTypes = { children: s.default.any, action: s.default.oneOfType([s.default.string, s.default.arrayOf(s.default.string)]), showAction: s.default.any, hideAction: s.default.any, getPopupClassNameFromAlign: s.default.any, onPopupVisibleChange: s.default.func, afterPopupVisibleChange: s.default.func, popup: s.default.oneOfType([s.default.node, s.default.func]).isRequired, popupStyle: s.default.object, prefixCls: s.default.string, popupClassName: s.default.string, className: s.default.string, popupPlacement: s.default.string, builtinPlacements: s.default.object, popupTransitionName: s.default.oneOfType([s.default.string, s.default.object]), popupAnimation: s.default.any, mouseEnterDelay: s.default.number, mouseLeaveDelay: s.default.number, zIndex: s.default.number, focusDelay: s.default.number, blurDelay: s.default.number, getPopupContainer: s.default.func, getDocument: s.default.func, forceRender: s.default.bool, destroyPopupOnHide: s.default.bool, mask: s.default.bool, maskClosable: s.default.bool, onPopupAlign: s.default.func, popupAlign: s.default.object, popupVisible: s.default.bool, defaultPopupVisible: s.default.bool, maskTransitionName: s.default.oneOfType([s.default.string, s.default.object]), maskAnimation: s.default.string, stretch: s.default.string, alignPoint: s.default.bool }, T.defaultProps = { prefixCls: "rc-trigger-popup", getPopupClassNameFromAlign: g, getDocument: C, onPopupVisibleChange: m, afterPopupVisibleChange: m, onPopupAlign: m, popupClassName: "", mouseEnterDelay: 0, mouseLeaveDelay: .1, focusDelay: 0, blurDelay: .15, popupStyle: {}, destroyPopupOnHide: !1, popupAlign: {}, defaultPopupVisible: !1, mask: !1, maskClosable: !0, action: [], showAction: [], hideAction: [] }; var y = function () { var t = this; this.onMouseEnter = function (e) { var o = t.props.mouseEnterDelay; t.fireEvents("onMouseEnter", e), t.delaySetPopupVisible(!0, o, o ? null : e) }, this.onMouseMove = function (e) { t.fireEvents("onMouseMove", e), t.setPoint(e) }, this.onMouseLeave = function (e) { t.fireEvents("onMouseLeave", e), t.delaySetPopupVisible(!1, t.props.mouseLeaveDelay) }, this.onPopupMouseEnter = function () { t.clearDelayTimer() }, this.onPopupMouseLeave = function (e) { e.relatedTarget && !e.relatedTarget.setTimeout && t._component && t._component.getPopupDomNode && (0, p.default)(t._component.getPopupDomNode(), e.relatedTarget) || t.delaySetPopupVisible(!1, t.props.mouseLeaveDelay) }, this.onFocus = function (e) { t.fireEvents("onFocus", e), t.clearDelayTimer(), t.isFocusToShow() && (t.focusTime = Date.now(), t.delaySetPopupVisible(!0, t.props.focusDelay)) }, this.onMouseDown = function (e) { t.fireEvents("onMouseDown", e), t.preClickTime = Date.now() }, this.onTouchStart = function (e) { t.fireEvents("onTouchStart", e), t.preTouchTime = Date.now() }, this.onBlur = function (e) { t.fireEvents("onBlur", e), t.clearDelayTimer(), t.isBlurToHide() && t.delaySetPopupVisible(!1, t.props.blurDelay) }, this.onContextMenu = function (e) { e.preventDefault(), t.fireEvents("onContextMenu", e), t.setPopupVisible(!0, e) }, this.onContextMenuClose = function () { t.isContextMenuToShow() && t.close() }, this.onClick = function (e) { if (t.fireEvents("onClick", e), t.focusTime) { var o = void 0; if (t.preClickTime && t.preTouchTime ? o = Math.min(t.preClickTime, t.preTouchTime) : t.preClickTime ? o = t.preClickTime : t.preTouchTime && (o = t.preTouchTime), Math.abs(o - t.focusTime) < 20) return; t.focusTime = 0 } t.preClickTime = 0, t.preTouchTime = 0, e && e.preventDefault && e.preventDefault(); var n = !t.state.popupVisible; (t.isClickToHide() && !n || n && t.isClickToShow()) && t.setPopupVisible(!t.state.popupVisible, e) }, this.onDocumentClick = function (e) { if (!t.props.mask || t.props.maskClosable) { var o = e.target, n = (0, u.findDOMNode)(t), i = t.getPopupDomNode(); (0, p.default)(n, o) || (0, p.default)(i, o) || t.close() } }, this.getRootDomNode = function () { return (0, u.findDOMNode)(t) }, this.getPopupClassNameFromAlign = function (e) { var o = [], n = t.props, i = n.popupPlacement, s = n.builtinPlacements, u = n.prefixCls, p = n.alignPoint, r = n.getPopupClassNameFromAlign; return i && s && o.push((0, l.getAlignPopupClassName)(s, u, e, p)), r && o.push(r(e)), o.join(" ") }, this.getComponent = function () { var o = t.props, n = o.prefixCls, s = o.destroyPopupOnHide, u = o.popupClassName, p = o.action, r = o.onPopupAlign, l = o.popupAnimation, c = o.popupTransitionName, d = o.popupStyle, h = o.mask, f = o.maskAnimation, m = o.maskTransitionName, g = o.zIndex, C = o.popup, v = o.stretch, b = o.alignPoint, T = t.state, y = T.popupVisible, P = T.point, M = t.getPopupAlign(), D = {}; return t.isMouseEnterToShow() && (D.onMouseEnter = t.onPopupMouseEnter), t.isMouseLeaveToHide() && (D.onMouseLeave = t.onPopupMouseLeave), i.default.createElement(a.default, (0, e.default)({ prefixCls: n, destroyPopupOnHide: s, visible: y, point: b && P, className: u, action: p, align: M, onAlign: r, animation: l, getClassNameFromAlign: t.getPopupClassNameFromAlign }, D, { stretch: v, getRootDomNode: t.getRootDomNode, style: d, mask: h, zIndex: g, transitionName: c, maskAnimation: f, maskTransitionName: m, ref: t.savePopup }), "function" == typeof C ? C() : C) }, this.getContainer = function () { var e = t.props, o = document.createElement("div"); return o.style.position = "absolute", o.style.top = "0", o.style.left = "0", o.style.width = "100%", (e.getPopupContainer ? e.getPopupContainer((0, u.findDOMNode)(t)) : e.getDocument().body).appendChild(o), o }, this.setPoint = function (e) { t.props.alignPoint && e && t.setState({ point: { pageX: e.pageX, pageY: e.pageY } }) }, this.handlePortalUpdate = function () { t.prevPopupVisible !== t.state.popupVisible && t.props.afterPopupVisibleChange(t.state.popupVisible) }, this.savePopup = function (e) { t._component = e } }, P = T; exports.default = P;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "react-dom": "NKHc", "rc-util/es/Dom/contains": "asZT", "rc-util/es/Dom/addEventListener": "v9LT", "./Popup": "qyht", "./utils": "jQUK", "rc-util/es/ContainerRender": "GJtx", "rc-util/es/Portal": "LoYh", "classnames": "9qb7" }], "0iqF": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.placements = void 0; var t = { adjustX: 1, adjustY: 1 }, e = [0, 0], o = { left: { points: ["cr", "cl"], overflow: t, offset: [-4, 0], targetOffset: e }, right: { points: ["cl", "cr"], overflow: t, offset: [4, 0], targetOffset: e }, top: { points: ["bc", "tc"], overflow: t, offset: [0, -4], targetOffset: e }, bottom: { points: ["tc", "bc"], overflow: t, offset: [0, 4], targetOffset: e }, topLeft: { points: ["bl", "tl"], overflow: t, offset: [0, -4], targetOffset: e }, leftTop: { points: ["tr", "tl"], overflow: t, offset: [-4, 0], targetOffset: e }, topRight: { points: ["br", "tr"], overflow: t, offset: [0, -4], targetOffset: e }, rightTop: { points: ["tl", "tr"], overflow: t, offset: [4, 0], targetOffset: e }, bottomRight: { points: ["tr", "br"], overflow: t, offset: [0, 4], targetOffset: e }, rightBottom: { points: ["bl", "br"], overflow: t, offset: [4, 0], targetOffset: e }, bottomLeft: { points: ["tl", "bl"], overflow: t, offset: [0, 4], targetOffset: e }, leftBottom: { points: ["br", "bl"], overflow: t, offset: [-4, 0], targetOffset: e } }; exports.placements = o; var f = o; exports.default = f;
    }, {}], "s/bY": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = n(require("babel-runtime/helpers/classCallCheck")), r = n(require("babel-runtime/helpers/possibleConstructorReturn")), t = n(require("babel-runtime/helpers/inherits")), u = n(require("react")), i = n(require("prop-types")); function n(e) { return e && e.__esModule ? e : { default: e } } var l = function (i) { function n() { return (0, e.default)(this, n), (0, r.default)(this, i.apply(this, arguments)) } return (0, t.default)(n, i), n.prototype.componentDidUpdate = function () { var e = this.props.trigger; e && e.forcePopupAlign() }, n.prototype.render = function () { var e = this.props, r = e.overlay, t = e.prefixCls, i = e.id; return u.default.createElement("div", { className: t + "-inner", id: i }, "function" == typeof r ? r() : r) }, n }(u.default.Component); l.propTypes = { prefixCls: i.default.string, overlay: i.default.oneOfType([i.default.node, i.default.func]).isRequired, id: i.default.string, trigger: i.default.any }; var o = l; exports.default = o;
    }, { "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O" }], "DRdR": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = f(require("babel-runtime/helpers/extends")), t = f(require("babel-runtime/helpers/objectWithoutProperties")), r = f(require("babel-runtime/helpers/classCallCheck")), a = f(require("babel-runtime/helpers/possibleConstructorReturn")), l = f(require("babel-runtime/helpers/inherits")), i = s(require("react")), o = f(require("prop-types")), n = f(require("rc-trigger")), u = require("./placements"), p = f(require("./Content")); function s(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var a = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; a.get || a.set ? Object.defineProperty(t, r, a) : t[r] = e[r] } return t.default = e, t } function f(e) { return e && e.__esModule ? e : { default: e } } var d = function (o) { function s() { var e, t, l; (0, r.default)(this, s); for (var n = arguments.length, u = Array(n), f = 0; f < n; f++)u[f] = arguments[f]; return e = t = (0, a.default)(this, o.call.apply(o, [this].concat(u))), t.getPopupElement = function () { var e = t.props, r = e.arrowContent, a = e.overlay, l = e.prefixCls, o = e.id; return [i.default.createElement("div", { className: l + "-arrow", key: "arrow" }, r), i.default.createElement(p.default, { key: "content", trigger: t.trigger, prefixCls: l, id: o, overlay: a })] }, t.saveTrigger = function (e) { t.trigger = e }, l = e, (0, a.default)(t, l) } return (0, l.default)(s, o), s.prototype.getPopupDomNode = function () { return this.trigger.getPopupDomNode() }, s.prototype.render = function () { var r = this.props, a = r.overlayClassName, l = r.trigger, o = r.mouseEnterDelay, p = r.mouseLeaveDelay, s = r.overlayStyle, f = r.prefixCls, d = r.children, g = r.onVisibleChange, c = r.afterVisibleChange, y = r.transitionName, m = r.animation, b = r.placement, v = r.align, h = r.destroyTooltipOnHide, C = r.defaultVisible, P = r.getTooltipContainer, O = (0, t.default)(r, ["overlayClassName", "trigger", "mouseEnterDelay", "mouseLeaveDelay", "overlayStyle", "prefixCls", "children", "onVisibleChange", "afterVisibleChange", "transitionName", "animation", "placement", "align", "destroyTooltipOnHide", "defaultVisible", "getTooltipContainer"]), D = (0, e.default)({}, O); return "visible" in this.props && (D.popupVisible = this.props.visible), i.default.createElement(n.default, (0, e.default)({ popupClassName: a, ref: this.saveTrigger, prefixCls: f, popup: this.getPopupElement, action: l, builtinPlacements: u.placements, popupPlacement: b, popupAlign: v, getPopupContainer: P, onPopupVisibleChange: g, afterPopupVisibleChange: c, popupTransitionName: y, popupAnimation: m, defaultPopupVisible: C, destroyPopupOnHide: h, mouseLeaveDelay: p, popupStyle: s, mouseEnterDelay: o }, D), d) }, s }(i.Component); d.propTypes = { trigger: o.default.any, children: o.default.any, defaultVisible: o.default.bool, visible: o.default.bool, placement: o.default.string, transitionName: o.default.oneOfType([o.default.string, o.default.object]), animation: o.default.any, onVisibleChange: o.default.func, afterVisibleChange: o.default.func, overlay: o.default.oneOfType([o.default.node, o.default.func]).isRequired, overlayStyle: o.default.object, overlayClassName: o.default.string, prefixCls: o.default.string, mouseEnterDelay: o.default.number, mouseLeaveDelay: o.default.number, getTooltipContainer: o.default.func, destroyTooltipOnHide: o.default.bool, align: o.default.object, arrowContent: o.default.any, id: o.default.string }, d.defaultProps = { prefixCls: "rc-tooltip", mouseEnterDelay: 0, destroyTooltipOnHide: !1, mouseLeaveDelay: .1, align: {}, placement: "right", trigger: ["hover"], arrowContent: null }; var g = d; exports.default = g;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "rc-trigger": "P/ZM", "./placements": "0iqF", "./Content": "s/bY" }], "KA0F": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = t(require("./Tooltip")); function t(e) { return e && e.__esModule ? e : { default: e } } var r = e.default; exports.default = r;
    }, { "./Tooltip": "DRdR" }], "x/MX": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = f; var e = p(require("babel-runtime/helpers/objectWithoutProperties")), t = p(require("babel-runtime/helpers/defineProperty")), r = p(require("babel-runtime/helpers/extends")), l = p(require("babel-runtime/helpers/classCallCheck")), i = p(require("babel-runtime/helpers/createClass")), a = p(require("babel-runtime/helpers/possibleConstructorReturn")), u = p(require("babel-runtime/helpers/inherits")), n = p(require("react")), o = p(require("prop-types")), s = p(require("rc-tooltip")), d = p(require("./Handle")); function p(e) { return e && e.__esModule ? e : { default: e } } function f(p) { var f, b; return b = f = function (o) { function f(i) { (0, l.default)(this, f); var u = (0, a.default)(this, (f.__proto__ || Object.getPrototypeOf(f)).call(this, i)); return u.handleTooltipVisibleChange = function (e, l) { u.setState(function (i) { return { visibles: (0, r.default)({}, i.visibles, (0, t.default)({}, e, l)) } }) }, u.handleWithTooltip = function (t) { var l = t.value, i = t.dragging, a = t.index, o = t.disabled, p = (0, e.default)(t, ["value", "dragging", "index", "disabled"]), f = u.props, b = f.tipFormatter, c = f.tipProps, h = f.handleStyle, v = c.prefixCls, y = void 0 === v ? "rc-slider-tooltip" : v, m = c.overlay, q = void 0 === m ? b(l) : m, C = c.placement, g = void 0 === C ? "top" : C, x = c.visible, P = void 0 !== x && x, _ = (0, e.default)(c, ["prefixCls", "overlay", "placement", "visible"]), T = void 0; return T = Array.isArray(h) ? h[a] || h[0] : h, n.default.createElement(s.default, (0, r.default)({}, _, { prefixCls: y, overlay: q, placement: g, visible: !o && (u.state.visibles[a] || i) || P, key: a }), n.default.createElement(d.default, (0, r.default)({}, p, { style: (0, r.default)({}, T), value: l, onMouseEnter: function () { return u.handleTooltipVisibleChange(a, !0) }, onMouseLeave: function () { return u.handleTooltipVisibleChange(a, !1) } }))) }, u.state = { visibles: {} }, u } return (0, u.default)(f, o), (0, i.default)(f, [{ key: "render", value: function () { return n.default.createElement(p, (0, r.default)({}, this.props, { handle: this.handleWithTooltip })) } }]), f }(n.default.Component), f.propTypes = { tipFormatter: o.default.func, handleStyle: o.default.oneOfType([o.default.object, o.default.arrayOf(o.default.object)]), tipProps: o.default.object }, f.defaultProps = { tipFormatter: function (e) { return e }, handleStyle: [{}], tipProps: {} }, b }
    }, { "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/defineProperty": "Xos8", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/createClass": "jx4H", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "rc-tooltip": "KA0F", "./Handle": "h8FM" }], "homl": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), Object.defineProperty(exports, "Range", { enumerable: !0, get: function () { return t.default } }), Object.defineProperty(exports, "Handle", { enumerable: !0, get: function () { return r.default } }), Object.defineProperty(exports, "createSliderWithTooltip", { enumerable: !0, get: function () { return u.default } }), exports.default = void 0; var e = l(require("./Slider")), t = l(require("./Range")), r = l(require("./Handle")), u = l(require("./createSliderWithTooltip")); function l(e) { return e && e.__esModule ? e : { default: e } } e.default.Range = t.default, e.default.Handle = r.default, e.default.createSliderWithTooltip = u.default; var a = e.default; exports.default = a;
    }, { "./Slider": "ihrk", "./Range": "LI7V", "./Handle": "h8FM", "./createSliderWithTooltip": "x/MX" }], "2mi8": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), u = C(e), t = require("babel-runtime/helpers/objectWithoutProperties"), l = C(t), r = require("babel-runtime/helpers/classCallCheck"), s = C(r), a = require("babel-runtime/helpers/possibleConstructorReturn"), n = C(a), d = require("babel-runtime/helpers/inherits"), f = C(d), o = require("classnames"), i = C(o), m = require("react"), p = C(m), b = require("prop-types"), c = C(b), h = require("prop-types-extra/lib/elementType"), P = C(h), x = require("./utils/bootstrapUtils"), q = require("./utils/StyleConfig"); function C(e) { return e && e.__esModule ? e : { default: e } } var y = { componentClass: P.default, xs: c.default.number, sm: c.default.number, md: c.default.number, lg: c.default.number, xsHidden: c.default.bool, smHidden: c.default.bool, mdHidden: c.default.bool, lgHidden: c.default.bool, xsOffset: c.default.number, smOffset: c.default.number, mdOffset: c.default.number, lgOffset: c.default.number, xsPush: c.default.number, smPush: c.default.number, mdPush: c.default.number, lgPush: c.default.number, xsPull: c.default.number, smPull: c.default.number, mdPull: c.default.number, lgPull: c.default.number }, g = { componentClass: "div" }, v = function (e) { function t() { return (0, s.default)(this, t), (0, n.default)(this, e.apply(this, arguments)) } return (0, f.default)(t, e), t.prototype.render = function () { var e = this.props, t = e.componentClass, r = e.className, s = (0, l.default)(e, ["componentClass", "className"]), a = (0, x.splitBsProps)(s), n = a[0], d = a[1], f = []; return q.DEVICE_SIZES.forEach(function (e) { function u(u, t) { var l = "" + e + u, r = d[l]; null != r && f.push((0, x.prefix)(n, "" + e + t + "-" + r)), delete d[l] } u("", ""), u("Offset", "-offset"), u("Push", "-push"), u("Pull", "-pull"); var t = e + "Hidden"; d[t] && f.push("hidden-" + e), delete d[t] }), p.default.createElement(t, (0, u.default)({}, d, { className: (0, i.default)(r, f) })) }, t }(p.default.Component); v.propTypes = y, v.defaultProps = g, exports.default = (0, x.bsClass)("col", v), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "prop-types-extra/lib/elementType": "aemN", "./utils/bootstrapUtils": "t+qF", "./utils/StyleConfig": "uE08" }], "Zn90": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("react"), t = n(e); function n(e) { return e && e.__esModule ? e : { default: e } } function l(e, n, l) { var r = 0; return t.default.Children.map(e, function (e) { return t.default.isValidElement(e) ? n.call(l, e, r++) : e }) } function r(e, n, l) { var r = 0; t.default.Children.forEach(e, function (e) { t.default.isValidElement(e) && n.call(l, e, r++) }) } function a(e) { var n = 0; return t.default.Children.forEach(e, function (e) { t.default.isValidElement(e) && ++n }), n } function u(e, n, l) { var r = 0, a = []; return t.default.Children.forEach(e, function (e) { t.default.isValidElement(e) && n.call(l, e, r++) && a.push(e) }), a } function f(e, n, l) { var r = 0, a = void 0; return t.default.Children.forEach(e, function (e) { a || t.default.isValidElement(e) && n.call(l, e, r++) && (a = e) }), a } function i(e, n, l) { var r = 0, a = !0; return t.default.Children.forEach(e, function (e) { a && t.default.isValidElement(e) && (n.call(l, e, r++) || (a = !1)) }), a } function d(e, n, l) { var r = 0, a = !1; return t.default.Children.forEach(e, function (e) { a || t.default.isValidElement(e) && n.call(l, e, r++) && (a = !0) }), a } function o(e) { var n = []; return t.default.Children.forEach(e, function (e) { t.default.isValidElement(e) && n.push(e) }), n } exports.default = { map: l, forEach: r, count: a, find: f, filter: u, every: i, some: d, toArray: o }, module.exports = exports.default;
    }, { "react": "1n8/" }], "0K5I": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = S(e), r = require("babel-runtime/helpers/objectWithoutProperties"), s = S(r), a = require("babel-runtime/helpers/classCallCheck"), i = S(a), l = require("babel-runtime/helpers/possibleConstructorReturn"), o = S(l), u = require("babel-runtime/helpers/inherits"), n = S(u), d = require("classnames"), p = S(d), c = require("react"), f = S(c), h = require("prop-types"), b = S(h), m = require("./utils/bootstrapUtils"), q = require("./utils/StyleConfig"), C = require("./utils/ValidComponentChildren"), v = S(C); function S(e) { return e && e.__esModule ? e : { default: e } } var y = { controlId: b.default.string, validationState: b.default.oneOf(["success", "warning", "error", null]) }, x = { $bs_formGroup: b.default.object.isRequired }, g = function (e) { function r() { return (0, i.default)(this, r), (0, o.default)(this, e.apply(this, arguments)) } return (0, n.default)(r, e), r.prototype.getChildContext = function () { var e = this.props; return { $bs_formGroup: { controlId: e.controlId, validationState: e.validationState } } }, r.prototype.hasFeedback = function (e) { var t = this; return v.default.some(e, function (e) { return "feedback" === e.props.bsRole || e.props.children && t.hasFeedback(e.props.children) }) }, r.prototype.render = function () { var e = this.props, r = e.validationState, a = e.className, i = e.children, l = (0, s.default)(e, ["validationState", "className", "children"]), o = (0, m.splitBsPropsAndOmit)(l, ["controlId"]), u = o[0], n = o[1], d = (0, t.default)({}, (0, m.getClassSet)(u), { "has-feedback": this.hasFeedback(i) }); return r && (d["has-" + r] = !0), f.default.createElement("div", (0, t.default)({}, n, { className: (0, p.default)(a, d) }), i) }, r }(f.default.Component); g.propTypes = y, g.childContextTypes = x, exports.default = (0, m.bsClass)("form-group", (0, m.bsSizes)([q.Size.LARGE, q.Size.SMALL], g)), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "./utils/bootstrapUtils": "t+qF", "./utils/StyleConfig": "uE08", "./utils/ValidComponentChildren": "Zn90" }], "FqSm": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), r = q(e), t = require("babel-runtime/helpers/objectWithoutProperties"), s = q(t), l = require("babel-runtime/helpers/classCallCheck"), u = q(l), a = require("babel-runtime/helpers/possibleConstructorReturn"), i = q(a), p = require("babel-runtime/helpers/inherits"), n = q(p), o = require("classnames"), d = q(o), f = require("react"), c = q(f), h = require("prop-types"), b = q(h), m = require("./utils/bootstrapUtils"); function q(e) { return e && e.__esModule ? e : { default: e } } var y = { glyph: b.default.string.isRequired }, g = function (e) { function t() { return (0, u.default)(this, t), (0, i.default)(this, e.apply(this, arguments)) } return (0, n.default)(t, e), t.prototype.render = function () { var e, t = this.props, l = t.glyph, u = t.className, a = (0, s.default)(t, ["glyph", "className"]), i = (0, m.splitBsProps)(a), p = i[0], n = i[1], o = (0, r.default)({}, (0, m.getClassSet)(p), ((e = {})[(0, m.prefix)(p, l)] = !0, e)); return c.default.createElement("span", (0, r.default)({}, n, { className: (0, d.default)(u, o) })) }, t }(c.default.Component); g.propTypes = y, exports.default = (0, m.bsClass)("glyphicon", g), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "./utils/bootstrapUtils": "t+qF" }], "6lLY": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/objectWithoutProperties"), r = g(e), t = require("babel-runtime/helpers/extends"), l = g(t), s = require("babel-runtime/helpers/classCallCheck"), u = g(s), a = require("babel-runtime/helpers/possibleConstructorReturn"), n = g(a), o = require("babel-runtime/helpers/inherits"), i = g(o), p = require("classnames"), c = g(p), d = require("react"), f = g(d), h = require("prop-types"), b = g(h), m = require("./Glyphicon"), y = g(m), q = require("./utils/bootstrapUtils"); function g(e) { return e && e.__esModule ? e : { default: e } } var v = { bsRole: "feedback" }, x = { $bs_formGroup: b.default.object }, C = function (e) { function t() { return (0, u.default)(this, t), (0, n.default)(this, e.apply(this, arguments)) } return (0, i.default)(t, e), t.prototype.getGlyph = function (e) { switch (e) { case "success": return "ok"; case "warning": return "warning-sign"; case "error": return "remove"; default: return null } }, t.prototype.renderDefaultFeedback = function (e, r, t, s) { var u = this.getGlyph(e && e.validationState); return u ? f.default.createElement(y.default, (0, l.default)({}, s, { glyph: u, className: (0, c.default)(r, t) })) : null }, t.prototype.render = function () { var e = this.props, t = e.className, s = e.children, u = (0, r.default)(e, ["className", "children"]), a = (0, q.splitBsProps)(u), n = a[0], o = a[1], i = (0, q.getClassSet)(n); if (!s) return this.renderDefaultFeedback(this.context.$bs_formGroup, t, i, o); var p = f.default.Children.only(s); return f.default.cloneElement(p, (0, l.default)({}, o, { className: (0, c.default)(p.props.className, t, i) })) }, t }(f.default.Component); C.defaultProps = v, C.contextTypes = x, exports.default = (0, q.bsClass)("form-control-feedback", C), module.exports = exports.default;
    }, { "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "./Glyphicon": "FqSm", "./utils/bootstrapUtils": "t+qF" }], "fyQg": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = C(e), r = require("babel-runtime/helpers/objectWithoutProperties"), s = C(r), l = require("babel-runtime/helpers/classCallCheck"), a = C(l), u = require("babel-runtime/helpers/possibleConstructorReturn"), o = C(u), n = require("babel-runtime/helpers/inherits"), p = C(n), i = require("classnames"), c = C(i), d = require("react"), f = C(d), m = require("prop-types-extra/lib/elementType"), b = C(m), h = require("./utils/bootstrapUtils"); function C(e) { return e && e.__esModule ? e : { default: e } } var q = { componentClass: b.default }, x = { componentClass: "p" }, y = function (e) { function r() { return (0, a.default)(this, r), (0, o.default)(this, e.apply(this, arguments)) } return (0, p.default)(r, e), r.prototype.render = function () { var e = this.props, r = e.componentClass, l = e.className, a = (0, s.default)(e, ["componentClass", "className"]), u = (0, h.splitBsProps)(a), o = u[0], n = u[1], p = (0, h.getClassSet)(o); return f.default.createElement(r, (0, t.default)({}, n, { className: (0, c.default)(l, p) })) }, r }(f.default.Component); y.propTypes = q, y.defaultProps = x, exports.default = (0, h.bsClass)("form-control-static", y), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types-extra/lib/elementType": "aemN", "./utils/bootstrapUtils": "t+qF" }], "pugI": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = R(e), r = require("babel-runtime/helpers/objectWithoutProperties"), s = R(r), i = require("babel-runtime/helpers/classCallCheck"), u = R(i), l = require("babel-runtime/helpers/possibleConstructorReturn"), o = R(l), a = require("babel-runtime/helpers/inherits"), n = R(a), p = require("classnames"), f = R(p), d = require("react"), c = R(d), b = require("prop-types"), m = R(b), q = require("prop-types-extra/lib/elementType"), C = R(q), h = require("warning"), y = R(h), S = require("./FormControlFeedback"), x = R(S), _ = require("./FormControlStatic"), v = R(_), g = require("./utils/bootstrapUtils"), z = require("./utils/StyleConfig"); function R(e) { return e && e.__esModule ? e : { default: e } } var F = { componentClass: C.default, type: m.default.string, id: m.default.string, inputRef: m.default.func }, M = { componentClass: "input" }, P = { $bs_formGroup: m.default.object }, k = function (e) { function r() { return (0, u.default)(this, r), (0, o.default)(this, e.apply(this, arguments)) } return (0, n.default)(r, e), r.prototype.render = function () { var e = this.context.$bs_formGroup, r = e && e.controlId, i = this.props, u = i.componentClass, l = i.type, o = i.id, a = void 0 === o ? r : o, n = i.inputRef, p = i.className, d = i.bsSize, b = (0, s.default)(i, ["componentClass", "type", "id", "inputRef", "className", "bsSize"]), m = (0, g.splitBsProps)(b), q = m[0], C = m[1], h = void 0; if ("file" !== l && (h = (0, g.getClassSet)(q)), d) { var y = z.SIZE_MAP[d] || d; h[(0, g.prefix)({ bsClass: "input" }, y)] = !0 } return c.default.createElement(u, (0, t.default)({}, C, { type: l, id: a, ref: n, className: (0, f.default)(p, h) })) }, r }(c.default.Component); k.propTypes = F, k.defaultProps = M, k.contextTypes = P, k.Feedback = x.default, k.Static = v.default, exports.default = (0, g.bsClass)("form-control", (0, g.bsSizes)([z.Size.SMALL, z.Size.LARGE], k)), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "prop-types-extra/lib/elementType": "aemN", "warning": "/sXU", "./FormControlFeedback": "6lLY", "./FormControlStatic": "fyQg", "./utils/bootstrapUtils": "t+qF", "./utils/StyleConfig": "uE08" }], "3Gw8": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = r(require("react")), t = n(require("rc-slider")); function n(e) { return e && e.__esModule ? e : { default: e } } function r(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; r.get || r.set ? Object.defineProperty(t, n, r) : t[n] = e[n] } return t.default = e, t } function o(e) { return (o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function u(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function a(e, t, n) { return t && i(e.prototype, t), n && i(e, n), e } function l(e, t) { return !t || "object" !== o(t) && "function" != typeof t ? f(e) : t } function c(e) { return (c = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function s(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && p(e, t) } function p(e, t) { return (p = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function f(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } var m = require("react-bootstrap/lib/Col"), y = require("react-bootstrap/lib/FormGroup"), b = require("react-bootstrap/lib/FormControl"), d = function (n) { function r(e) { var t; return u(this, r), (t = l(this, c(r).call(this, e))).onChange = t.onChange.bind(f(f(t))), t.state = { inputValue: "" }, t } return s(r, e.Component), a(r, [{ key: "onChange", value: function (e) { var t = this.props, n = t.schema, r = t.onChange, o = n.minimum, u = n.maximum, i = e; "number" == typeof u && (i = Math.min(i, u)), "number" == typeof o && (i = Math.max(i, o)), r(i) } }, { key: "onInputBlur", value: function (e) { "" !== e && null != e && this.onChange(parseFloat(e)) } }, { key: "render", value: function () { var n = this, r = this.props, o = r.value, u = void 0 === o ? 0 : o, i = r.schema, a = r.options, l = void 0 === a ? {} : a, c = r.readonly, s = void 0 !== c && c, p = l.step, f = void 0 === p ? 1 : p, d = i.minimum, h = i.maximum, v = u; this.state.editing && (v = this.state.inputValue); return e.createElement(y, { className: "range-slider-group" }, e.createElement(m, { className: "slider-wrap", xs: 9 }, e.createElement(t.default, { disabled: s, value: u, onChange: this.onChange, min: d, max: h, included: !1, step: f })), e.createElement(m, { className: "input-wrap", xs: 3 }, e.createElement(b, { type: "number", value: v, disabled: s, onChange: function (e) { n.setState({ inputValue: e.target.value }) }, onKeyPress: function (e) { "Enter" === e.key && n.onInputBlur(e.target.value) }, onFocus: function () { n.setState({ inputValue: u, editing: !0 }) }, onBlur: function (e) { n.onInputBlur(e.target.value), n.setState({ inputValue: e.target.value, editing: !1 }) } }))) } }]), r }(); exports.default = d;
    }, { "react": "1n8/", "rc-slider": "homl", "react-bootstrap/lib/Col": "2mi8", "react-bootstrap/lib/FormGroup": "0K5I", "react-bootstrap/lib/FormControl": "pugI" }], "d+o0": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.version = void 0, exports.uncontrolledPropTypes = u, exports.getType = p, exports.getValue = s, exports.getLinkName = l, exports.defaultKey = f, exports.chain = d, exports.transform = v, exports.each = h, exports.has = y, exports.isReactComponent = x; var r = require("react"), e = o(r), t = require("invariant"), n = o(t); function o(r) { return r && r.__esModule ? r : { default: r } } function a(r, e) { return function (t, n) { if (void 0 !== t[n] && !t[r]) return new Error("You have provided a `" + n + "` prop to `" + e + "` without an `" + r + "` handler. This will render a read-only field. If the field should be mutable use `" + f(n) + "`. Otherwise, set `" + r + "`") } } function u(r, e, t) { var n = {}; return n } var i = exports.version = e.default.version.split(".").map(parseFloat); function p(r) { return i[0] >= 15 || 0 === i[0] && i[1] >= 13 ? r : r.type } function s(r, e) { var t = l(e); return t && !c(r, e) && c(r, t) ? r[t].value : r[e] } function c(r, e) { return void 0 !== r[e] } function l(r) { return "value" === r ? "valueLink" : "checked" === r ? "checkedLink" : null } function f(r) { return "default" + r.charAt(0).toUpperCase() + r.substr(1) } function d(r, e, t) { return function () { for (var n = arguments.length, o = Array(n), a = 0; a < n; a++)o[a] = arguments[a]; e && e.call.apply(e, [r].concat(o)), t && t.call.apply(t, [r].concat(o)) } } function v(r, e, t) { return h(r, e.bind(null, t = t || (Array.isArray(r) ? [] : {}))), t } function h(r, e, t) { if (Array.isArray(r)) return r.forEach(e, t); for (var n in r) y(r, n) && e.call(t, r[n], n, r) } function y(r, e) { return !!r && Object.prototype.hasOwnProperty.call(r, e) } function x(r) { return !!(r && r.prototype && r.prototype.isReactComponent) }
    }, { "react": "1n8/", "invariant": "2gTp" }], "T8DI": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) { var n = arguments[t]; for (var o in n) Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o]) } return e }; exports.default = f; var t = require("react"), n = u(t), o = require("invariant"), r = u(o), i = require("./utils"), a = p(i); function p(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]); return t.default = e, t } function u(e) { return e && e.__esModule ? e : { default: e } } function s(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function l(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function c(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } function f(t, o) { return function i(p, u) { var f, h; var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : []; var v, y = p.displayName || p.name || "Component", m = a.getType(p).propTypes, g = a.isReactComponent(p), b = Object.keys(u); var _ = ["valueLink", "checkedLink"].concat(b.map(a.defaultKey)); v = a.uncontrolledPropTypes(u, m, y); (0, r.default)(g || !d.length, "[uncontrollable] stateless function components cannot pass through methods because they have no associated instances. Check component: " + y + ", attempting to pass through methods: " + d.join(", ")); d = a.transform(d, function (e, t) { e[t] = function () { var e; return (e = this.refs.inner)[t].apply(e, arguments) } }, {}); var C = (h = f = function (r) { function i() { return s(this, i), l(this, r.apply(this, arguments)) } return c(i, r), i.prototype.shouldComponentUpdate = function () { for (var e = arguments.length, n = Array(e), o = 0; o < e; o++)n[o] = arguments[o]; return !t.shouldComponentUpdate || t.shouldComponentUpdate.apply(this, n) }, i.prototype.componentWillMount = function () { var e = this, t = this.props; this._values = {}, b.forEach(function (n) { e._values[n] = t[a.defaultKey(n)] }) }, i.prototype.componentWillReceiveProps = function (e) { var n = this, o = this.props; t.componentWillReceiveProps && t.componentWillReceiveProps.call(this, e), b.forEach(function (t) { void 0 === a.getValue(e, t) && void 0 !== a.getValue(o, t) && (n._values[t] = e[a.defaultKey(t)]) }) }, i.prototype.componentWillUnmount = function () { this.unmounted = !0 }, i.prototype.getControlledInstance = function () { return this.refs.inner }, i.prototype.render = function () { var t = this, r = {}, i = function (e) { var t = {}; return a.each(e, function (e, n) { -1 === _.indexOf(n) && (t[n] = e) }), t }(this.props); return a.each(u, function (e, n) { var i = a.getLinkName(n), p = t.props[n]; i && !O(t.props, n) && O(t.props, i) && (p = t.props[i].value), r[n] = void 0 !== p ? p : t._values[n], r[e] = function (e, t) { var n = a.getLinkName(e), r = this.props[u[e]]; n && O(this.props, n) && !r && (r = this.props[n].requestChange); for (var i = arguments.length, p = Array(i > 2 ? i - 2 : 0), s = 2; s < i; s++)p[s - 2] = arguments[s]; o(this, e, r, t, p) }.bind(t, n) }), r = e({}, i, r, { ref: g ? "inner" : null }), n.default.createElement(p, r) }, i }(n.default.Component), f.displayName = "Uncontrolled(" + y + ")", f.propTypes = v, h); e(C.prototype, d); C.ControlledComponent = p; C.deferControlTo = function (t) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, o = arguments[2]; return i(t, e({}, u, n), o) }; return C; function O(e, t) { return void 0 !== e[t] } } } module.exports = exports.default;
    }, { "react": "1n8/", "invariant": "2gTp", "./utils": "d+o0" }], "pOCK": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("./createUncontrollable"), t = n(e); function n(e) { return e && e.__esModule ? e : { default: e } } var o = { shouldComponentUpdate: function () { return !this._notifying } }; function u(e, t, n, o, u) { n && (e._notifying = !0, n.call.apply(n, [e, o].concat(u)), e._notifying = !1), e._values[t] = o, e.unmounted || e.forceUpdate() } exports.default = (0, t.default)(o, u), module.exports = exports.default;
    }, { "./createUncontrollable": "T8DI" }], "87Sr": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = u; var e = require("./utils/createChainableTypeChecker"), r = t(e); function t(e) { return e && e.__esModule ? e : { default: e } } function u() { for (var e = arguments.length, t = Array(e), u = 0; u < e; u++)t[u] = arguments[u]; return (0, r.default)(function () { for (var e = arguments.length, r = Array(e), u = 0; u < e; u++)r[u] = arguments[u]; var l = null; return t.forEach(function (e) { if (null == l) { var t = e.apply(void 0, r); null != t && (l = t) } }), l }) } module.exports = exports.default;
    }, { "./utils/createChainableTypeChecker": "njtJ" }], "ItNz": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), r = j(e), t = require("babel-runtime/helpers/objectWithoutProperties"), l = j(t), u = require("babel-runtime/helpers/classCallCheck"), i = j(u), s = require("babel-runtime/helpers/possibleConstructorReturn"), a = j(s), o = require("babel-runtime/helpers/inherits"), p = j(o), f = require("classnames"), n = j(f), c = require("react"), d = j(c), b = require("prop-types"), h = j(b), v = require("prop-types-extra/lib/all"), m = j(v), q = require("./Button"), x = j(q), k = require("./utils/bootstrapUtils"); function j(e) { return e && e.__esModule ? e : { default: e } } var y = { vertical: h.default.bool, justified: h.default.bool, block: (0, m.default)(h.default.bool, function (e) { var r = e.block, t = e.vertical; return r && !t ? new Error("`block` requires `vertical` to be set to have any effect") : null }) }, C = { block: !1, justified: !1, vertical: !1 }, P = function (e) { function t() { return (0, i.default)(this, t), (0, a.default)(this, e.apply(this, arguments)) } return (0, p.default)(t, e), t.prototype.render = function () { var e, t = this.props, u = t.block, i = t.justified, s = t.vertical, a = t.className, o = (0, l.default)(t, ["block", "justified", "vertical", "className"]), p = (0, k.splitBsProps)(o), f = p[0], c = p[1], b = (0, r.default)({}, (0, k.getClassSet)(f), ((e = {})[(0, k.prefix)(f)] = !s, e[(0, k.prefix)(f, "vertical")] = s, e[(0, k.prefix)(f, "justified")] = i, e[(0, k.prefix)(x.default.defaultProps, "block")] = u, e)); return d.default.createElement("div", (0, r.default)({}, c, { className: (0, n.default)(a, b) })) }, t }(d.default.Component); P.propTypes = y, P.defaultProps = C, exports.default = (0, k.bsClass)("btn-group", P), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "prop-types-extra/lib/all": "87Sr", "./Button": "2PkR", "./utils/bootstrapUtils": "t+qF" }], "SSCK": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = m(e), r = require("babel-runtime/helpers/objectWithoutProperties"), u = m(r), a = require("babel-runtime/helpers/classCallCheck"), l = m(a), n = require("babel-runtime/helpers/possibleConstructorReturn"), o = m(n), i = require("babel-runtime/helpers/inherits"), d = m(i), s = require("prop-types"), p = m(s), c = require("react"), f = m(c), h = require("./Button"), b = m(h); function m(e) { return e && e.__esModule ? e : { default: e } } var C = { type: p.default.oneOf(["checkbox", "radio"]), name: p.default.string, checked: p.default.bool, disabled: p.default.bool, onChange: p.default.func, value: p.default.any.isRequired }, q = function (e) { function r() { return (0, l.default)(this, r), (0, o.default)(this, e.apply(this, arguments)) } return (0, d.default)(r, e), r.prototype.render = function () { var e = this.props, r = e.children, a = e.name, l = e.checked, n = e.type, o = e.onChange, i = e.value, d = (0, u.default)(e, ["children", "name", "checked", "type", "onChange", "value"]), s = d.disabled; return f.default.createElement(b.default, (0, t.default)({}, d, { active: !!l, componentClass: "label" }), f.default.createElement("input", { name: a, type: n, autoComplete: "off", value: i, checked: !!l, disabled: !!s, onChange: o }), r) }, r }(f.default.Component); q.propTypes = C, exports.default = q, module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "prop-types": "5D9O", "react": "1n8/", "./Button": "2PkR" }], "pKrx": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = k(e), r = require("babel-runtime/helpers/objectWithoutProperties"), n = k(r), u = require("babel-runtime/helpers/classCallCheck"), a = k(u), l = require("babel-runtime/helpers/possibleConstructorReturn"), o = k(l), i = require("babel-runtime/helpers/inherits"), d = k(i), s = require("prop-types"), p = k(s), f = require("react"), c = k(f), h = require("invariant"), g = k(h), m = require("uncontrollable"), b = k(m), q = require("./utils/createChainedFunction"), v = k(q), y = require("./utils/ValidComponentChildren"), C = k(y), x = require("./ButtonGroup"), T = k(x), V = require("./ToggleButton"), _ = k(V); function k(e) { return e && e.__esModule ? e : { default: e } } var B = { name: p.default.string, value: p.default.any, onChange: p.default.func, type: p.default.oneOf(["checkbox", "radio"]).isRequired }, O = { type: "radio" }, E = function (e) { function r() { return (0, a.default)(this, r), (0, o.default)(this, e.apply(this, arguments)) } return (0, d.default)(r, e), r.prototype.getValues = function () { var e = this.props.value; return null == e ? [] : [].concat(e) }, r.prototype.handleToggle = function (e) { var t = this.props, r = t.type, n = t.onChange, u = this.getValues(), a = -1 !== u.indexOf(e); "radio" !== r ? n(a ? u.filter(function (t) { return t !== e }) : [].concat(u, [e])) : a || n(e) }, r.prototype.render = function () { var e = this, r = this.props, u = r.children, a = r.type, l = r.name, o = (0, n.default)(r, ["children", "type", "name"]), i = this.getValues(); return "radio" !== a || l || (0, g.default)(!1), delete o.onChange, delete o.value, c.default.createElement(T.default, (0, t.default)({}, o, { "data-toggle": "buttons" }), C.default.map(u, function (t) { var r = t.props, n = r.value, u = r.onChange; return c.default.cloneElement(t, { type: a, name: t.name || l, checked: -1 !== i.indexOf(n), onChange: (0, v.default)(u, function () { return e.handleToggle(n) }) }) })) }, r }(c.default.Component); E.propTypes = B, E.defaultProps = O; var M = (0, b.default)(E, { value: "onChange" }); M.Button = _.default, exports.default = M, module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "prop-types": "5D9O", "react": "1n8/", "invariant": "2gTp", "uncontrollable": "pOCK", "./utils/createChainedFunction": "GYue", "./utils/ValidComponentChildren": "Zn90", "./ButtonGroup": "ItNz", "./ToggleButton": "SSCK" }], "sxBK": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = o; var e = t(require("react")); function t(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } var r = require("react-bootstrap/lib/ToggleButtonGroup"), n = require("react-bootstrap/lib/ToggleButton"); function o(t) { var o = t.value, a = t.schema, u = t.options, i = (void 0 === u ? {} : u).labels, l = void 0 === i ? {} : i, c = a.enumNames || [], p = a.enum.map(function (t, r) { var o = c[r] || t, a = l[t] || function () { return o }, u = { label: o }; return e.createElement(n, { key: r, value: t }, e.createElement(a, Object.assign({}, u))) }); return e.createElement(r, { type: "radio", name: "options", defaultValue: o, onChange: function (e) { t.onChange(e) } }, p) }
    }, { "react": "1n8/", "react-bootstrap/lib/ToggleButtonGroup": "pKrx", "react-bootstrap/lib/ToggleButton": "SSCK" }], "I4f+": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = u(require("react")), t = i(require("react-jsonschema-form")), r = i(require("./widgets/Select")), n = i(require("./widgets/Range")), o = i(require("./widgets/ButtonRadio")); function i(e) { return e && e.__esModule ? e : { default: e } } function u(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function c(e) { return (c = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function f(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function a(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function l(e, t, r) { return t && a(e.prototype, t), r && a(e, r), e } function s(e, t) { return !t || "object" !== c(t) && "function" != typeof t ? p(e) : t } function p(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function y(e) { return (y = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function d(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && b(e, t) } function b(e, t) { return (b = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } var O = t.default, h = { select: r.default, range: n.default, buttonRadio: o.default }, m = function (t) { function r() { return f(this, r), s(this, y(r).apply(this, arguments)) } return d(r, e.Component), l(r, [{ key: "render", value: function () { return e.createElement(O, Object.assign({ widgets: h }, this.props), this.props.children ? this.props.children : e.createElement("div", null)) } }]), r }(); exports.default = m, m.defaultProps = { liveValidate: !0, widgets: h, showErrorList: !1, noHtml5Validate: !0, safeRenderCompletion: !0 };
    }, { "react": "1n8/", "react-jsonschema-form": "AY2U", "./widgets/Select": "Wdpo", "./widgets/Range": "3Gw8", "./widgets/ButtonRadio": "sxBK" }], "+O0P": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("serializr"), t = require("mobx"), r = i(require("./Model")), n = o(require("../../Utils")); function o(e) { return e && e.__esModule ? e : { default: e } } function i(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function u(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function c(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function f(e, t, r) { return t && c(e.prototype, t), r && c(e, r), e } function a(e, t) { return !t || "object" !== h(t) && "function" != typeof t ? l(e) : t } function l(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function p(e) { return (p = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function s(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && y(e, t) } function y(e, t) { return (y = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function h(e) { return (h = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var b = function (e, t, r, n) { var o, i = arguments.length, u = i < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, r) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : h(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, t, r, n); else for (var c = e.length - 1; c >= 0; c--)(o = e[c]) && (u = (i < 3 ? o(u) : i > 3 ? o(t, r, u) : o(t, r)) || u); return i > 3 && u && Object.defineProperty(t, r, u), u }, d = function (e) { function t() { var e; return u(this, t), (e = a(this, p(t).call(this)))._height = 3, e.width = 3, e.x = 0, e.y = 0, e.padding = new r.Padding(.2), e.padding.top = .5, e.padding.bottom = 0, e } return s(t, r.default), f(t, [{ key: "clampHeight", value: function (e) { return n.default.clamp(e, this.minHeight, this.maxHeight) } }, { key: "height", get: function () { return this.clampHeight(this._height) }, set: function (e) { this._height = this.clampHeight(e) } }, { key: "maxHeight", get: function () { return this.width < 2.855 ? 3 : 5 } }, { key: "minHeight", get: function () { return 1.2 } }, { key: "maxWidth", get: function () { return 5 } }, { key: "minWidth", get: function () { return .95 } }]), t }(); b([(0, e.serializable)((0, e.alias)("height", (0, e.primitive)())), e.serializable], d.prototype, "_height", void 0), b([e.serializable], d.prototype, "width", void 0), b([e.serializable, t.observable], d.prototype, "x", void 0), b([e.serializable, t.observable], d.prototype, "y", void 0); var g = d; exports.default = g;
    }, { "serializr": "94gV", "mobx": "6uYi", "./Model": "wZmN", "../../Utils": "r8Tc" }], "0TZw": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"), t = o(require("./Model")), r = require("serializr"); function o(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; o.get || o.set ? Object.defineProperty(t, r, o) : t[r] = e[r] } return t.default = e, t } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var r = 0; r < t.length; r++) { var o = t[r]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function u(e, t, r) { return t && i(e.prototype, t), r && i(e, r), e } function c(e, t) { return !t || "object" !== y(t) && "function" != typeof t ? f(e) : t } function f(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function l(e) { return (l = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function p(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) } function a(e, t) { return (a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function y(e) { return (y = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var s = function (e, t, r, o) { var n, i = arguments.length, u = i < 3 ? t : null === o ? o = Object.getOwnPropertyDescriptor(t, r) : o; if ("object" === ("undefined" == typeof Reflect ? "undefined" : y(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, t, r, o); else for (var c = e.length - 1; c >= 0; c--)(n = e[c]) && (u = (i < 3 ? n(u) : i > 3 ? n(t, r, u) : n(t, r)) || u); return i > 3 && u && Object.defineProperty(t, r, u), u }, d = function (e) { function r() { var e; return n(this, r), (e = c(this, l(r).call(this))).type = t.ModelType.GlassSlidingDoor, e.x = 0, e.y = 0, e.type = t.ModelType.GlassSlidingDoor, e.padding = new t.Padding(.05), e.padding.top = .5, e.padding.bottom = 0, e } return p(r, t.default), u(r, [{ key: "width", get: function () { return 1.95 } }, { key: "height", get: function () { return 2 } }, { key: "maxHeight", get: function () { return this.height } }, { key: "minHeight", get: function () { return this.height } }, { key: "maxWidth", get: function () { return this.width } }, { key: "minWidth", get: function () { return this.width } }]), r }(); s([r.serializable], d.prototype, "type", void 0), s([r.serializable, e.observable], d.prototype, "x", void 0), s([r.serializable, e.observable], d.prototype, "y", void 0), s([e.computed], d.prototype, "width", null), s([e.computed], d.prototype, "height", null); var b = d; exports.default = b;
    }, { "mobx": "6uYi", "./Model": "wZmN", "serializr": "94gV" }], "5B+w": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"), t = o(require("./Model")), r = require("serializr"); function o(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; o.get || o.set ? Object.defineProperty(t, r, o) : t[r] = e[r] } return t.default = e, t } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var r = 0; r < t.length; r++) { var o = t[r]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function u(e, t, r) { return t && i(e.prototype, t), r && i(e, r), e } function c(e, t) { return !t || "object" !== y(t) && "function" != typeof t ? f(e) : t } function f(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function p(e) { return (p = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function l(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) } function a(e, t) { return (a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function y(e) { return (y = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var s = function (e, t, r, o) { var n, i = arguments.length, u = i < 3 ? t : null === o ? o = Object.getOwnPropertyDescriptor(t, r) : o; if ("object" === ("undefined" == typeof Reflect ? "undefined" : y(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, t, r, o); else for (var c = e.length - 1; c >= 0; c--)(n = e[c]) && (u = (i < 3 ? n(u) : i > 3 ? n(t, r, u) : n(t, r)) || u); return i > 3 && u && Object.defineProperty(t, r, u), u }, d = function (e) { function r() { var e; return n(this, r), (e = c(this, p(r).call(this))).type = t.ModelType.PADoor, e.x = 0, e.y = 0, e.type = t.ModelType.PADoor, e.padding = new t.Padding(.05), e.padding.bottom = 0, e.padding.top = .2, e } return l(r, t.default), u(r, [{ key: "width", get: function () { return .823 } }, { key: "height", get: function () { return 2.03 } }, { key: "maxHeight", get: function () { return this.height } }, { key: "minHeight", get: function () { return this.height } }, { key: "maxWidth", get: function () { return this.width } }, { key: "minWidth", get: function () { return this.width } }]), r }(); s([r.serializable], d.prototype, "type", void 0), s([r.serializable, e.observable], d.prototype, "x", void 0), s([r.serializable, e.observable], d.prototype, "y", void 0), s([e.computed], d.prototype, "width", null), s([e.computed], d.prototype, "height", null); var b = d; exports.default = b;
    }, { "mobx": "6uYi", "./Model": "wZmN", "serializr": "94gV" }], "+7t0": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("serializr"), t = require("mobx"), r = o(require("./Model")); function o(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; o.get || o.set ? Object.defineProperty(t, r, o) : t[r] = e[r] } return t.default = e, t } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var r = 0; r < t.length; r++) { var o = t[r]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function u(e, t, r) { return t && i(e.prototype, t), r && i(e, r), e } function f(e, t) { return !t || "object" !== y(t) && "function" != typeof t ? c(e) : t } function c(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function l(e) { return (l = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function a(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && p(e, t) } function p(e, t) { return (p = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function y(e) { return (y = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var b = function (e, t, r, o) { var n, i = arguments.length, u = i < 3 ? t : null === o ? o = Object.getOwnPropertyDescriptor(t, r) : o; if ("object" === ("undefined" == typeof Reflect ? "undefined" : y(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, t, r, o); else for (var f = e.length - 1; f >= 0; f--)(n = e[f]) && (u = (i < 3 ? n(u) : i > 3 ? n(t, r, u) : n(t, r)) || u); return i > 3 && u && Object.defineProperty(t, r, u), u }, s = function (e) { function t() { var e; return n(this, t), (e = f(this, l(t).call(this))).width = 1, e.height = 1, e.x = 0, e.y = 0, e.type = r.ModelType.Opening, e.padding = new r.Padding(0), e } return a(t, r.default), u(t, [{ key: "maxHeight", get: function () { return 10 } }, { key: "minHeight", get: function () { return 0 } }, { key: "maxWidth", get: function () { return 30 } }, { key: "minWidth", get: function () { return 0 } }]), t }(); exports.default = s, b([e.serializable], s.prototype, "width", void 0), b([e.serializable], s.prototype, "height", void 0), b([e.serializable, t.observable], s.prototype, "x", void 0), b([e.serializable, t.observable], s.prototype, "y", void 0);
    }, { "serializr": "94gV", "mobx": "6uYi", "./Model": "wZmN" }], "3d79": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = n(require("./Model")), t = require("serializr"), r = require("mobx"); function n(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function o(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function u(e, t, r) { return t && i(e.prototype, t), r && i(e, r), e } function f(e, t) { return !t || "object" !== y(t) && "function" != typeof t ? c(e) : t } function c(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function l(e) { return (l = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function a(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && p(e, t) } function p(e, t) { return (p = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function y(e) { return (y = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var s = function (e, t, r, n) { var o, i = arguments.length, u = i < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, r) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : y(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, t, r, n); else for (var f = e.length - 1; f >= 0; f--)(o = e[f]) && (u = (i < 3 ? o(u) : i > 3 ? o(t, r, u) : o(t, r)) || u); return i > 3 && u && Object.defineProperty(t, r, u), u }, b = function (t) { function r() { var t; return o(this, r), (t = f(this, l(r).call(this))).x = 0, t.type = e.ModelType.Skylight, t.padding = new e.Padding(0), t } return a(r, e.default), u(r, [{ key: "y", get: function () { return 0 }, set: function (e) { } }, { key: "width", get: function () { return .762 } }, { key: "height", get: function () { return 50 } }, { key: "maxHeight", get: function () { return this.height } }, { key: "minHeight", get: function () { return 0 } }, { key: "maxWidth", get: function () { return this.width } }, { key: "minWidth", get: function () { return this.width } }]), r }(); exports.default = b, s([t.serializable, r.observable], b.prototype, "x", void 0);
    }, { "./Model": "wZmN", "serializr": "94gV", "mobx": "6uYi" }], "NkSR": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("serializr"), t = n(require("./Model")), r = require("mobx"); function n(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function o(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function u(e, t, r) { return t && i(e.prototype, t), r && i(e, r), e } function f(e, t) { return !t || "object" !== y(t) && "function" != typeof t ? c(e) : t } function c(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function l(e) { return (l = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function a(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && p(e, t) } function p(e, t) { return (p = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function y(e) { return (y = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var s = function (e, t, r, n) { var o, i = arguments.length, u = i < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, r) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : y(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, t, r, n); else for (var f = e.length - 1; f >= 0; f--)(o = e[f]) && (u = (i < 3 ? o(u) : i > 3 ? o(t, r, u) : o(t, r)) || u); return i > 3 && u && Object.defineProperty(t, r, u), u }, b = function (e) { function r() { var e; return o(this, r), (e = f(this, l(r).call(this))).x = 0, e.type = t.ModelType.Whirlybird, e.padding = new t.Padding(0), e } return a(r, t.default), u(r, [{ key: "y", get: function () { return 30 }, set: function (e) { } }, { key: "width", get: function () { return .5 } }, { key: "height", get: function () { return .5 } }, { key: "maxHeight", get: function () { return this.height } }, { key: "minHeight", get: function () { return this.height } }, { key: "maxWidth", get: function () { return this.width } }, { key: "minWidth", get: function () { return this.width } }]), r }(); exports.default = b, s([e.serializable, r.observable], b.prototype, "x", void 0);
    }, { "serializr": "94gV", "./Model": "wZmN", "mobx": "6uYi" }], "ECuv": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("serializr"), r = require("./Model"), l = f(require("./MetalSlidingDoor")), o = f(require("./RollerDoor")), i = f(require("./Window")), t = f(require("./GlassSlidingDoor")), n = f(require("./PADoor")), u = f(require("./Opening")), a = f(require("./Skylight")), d = f(require("./Whirlybird")); function f(e) { return e && e.__esModule ? e : { default: e } } function p(e, r, l) { return r in e ? Object.defineProperty(e, r, { value: l, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = l, e } function y(e, r) { if (!(e instanceof r)) throw new TypeError("Cannot call a class as a function") } function c(e, r) { for (var l = 0; l < r.length; l++) { var o = r[l]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function s(e, r, l) { return r && c(e.prototype, r), l && c(e, l), e } var M = function () { function f() { y(this, f) } return s(f, null, [{ key: "create", value: function (f) { var y, c = (p(y = {}, r.ModelType.Window, i.default), p(y, r.ModelType.GlassSlidingDoor, t.default), p(y, r.ModelType.PADoor, n.default), p(y, r.ModelType.RollerDoor, o.default), p(y, r.ModelType.MetalSlidingDoor, l.default), p(y, r.ModelType.Opening, u.default), p(y, r.ModelType.Skylight, a.default), p(y, r.ModelType.Whirlybird, d.default), y); return (0, e.deserialize)(c[f.type], f) } }]), f }(); exports.default = M;
    }, { "serializr": "94gV", "./Model": "wZmN", "./MetalSlidingDoor": "y87A", "./RollerDoor": "+O0P", "./Window": "6a89", "./GlassSlidingDoor": "0TZw", "./PADoor": "5B+w", "./Opening": "+7t0", "./Skylight": "3d79", "./Whirlybird": "NkSR" }], "t/JC": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.Direction = void 0; var e = require("mobx"), t = require("serializr"), i = r(require("./model/Factory")); function r(e) { return e && e.__esModule ? e : { default: e } } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function o(e, t) { for (var i = 0; i < t.length; i++) { var r = t[i]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function a(e, t, i) { return t && o(e.prototype, t), i && o(e, i), e } function s(e) { if (null == e) throw new TypeError("Cannot destructure undefined") } function h(e) { return (h = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var f, l = function (e, t, i, r) { var n, o = arguments.length, a = o < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, i) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : h(Reflect)) && "function" == typeof Reflect.decorate) a = Reflect.decorate(e, t, i, r); else for (var s = e.length - 1; s >= 0; s--)(n = e[s]) && (a = (o < 3 ? n(a) : o > 3 ? n(t, i, a) : n(t, i)) || a); return o > 3 && a && Object.defineProperty(t, i, a), a }; function u(e, t, i) { s(e), t(null, i.rootContext.target) } function c(e, t, i) { s(e), t(null, i.rootContext.target._grid) } exports.Direction = f, function (e) { e[e.Horizontal = 0] = "Horizontal", e[e.Vertical = 1] = "Vertical", e[e.Roof = 2] = "Roof" }(f || (exports.Direction = f = {})); var g = function (e) { return e.map(function (e) { return (0, t.serialize)(e) }) }, d = function (e) { return e.map(function (e) { return i.default.create(e) }) }, b = function () { function e(t) { n(this, e), this.models = [], this.visible = !0; var i = t || {}, r = i.shed, o = i.grid, a = i.x, s = i.y, h = i.direction; this.shed = r, this.x = a, this.y = s, this.direction = h, this.grid = o } return a(e, [{ key: "getLayout", value: function () { var e = this, t = [], i = this.bounds.length - .2; return this.models.forEach(function (r) { var n = r.padding, o = n.left + n.right, a = i - o, s = r.x || 0, h = r.y || 0, f = r.width, l = r.height; s + (f = Math.min(f, a)) > i && (s = i - f); var u = e.getSectionRoofY(s), c = e.getSectionRoofY(s + f), g = Math.min(u, c) - (n.top + n.bottom); s + f > a && (s = a - f), h + (l = Math.min(l, g)) > g && (h = g - l); var d = []; r.minHeight < l && d.push({ message: "Does not have enough height to display." }), r.minWidth < f && d.push({ message: "Does not have enough width to display." }); var b = { x: s + .1 + n.left, y: h + n.bottom, model: r, width: f, height: l, errors: d }; t.push(b) }), t } }, { key: "getBayOffset", value: function (e) { for (var t = this.shed, i = t.baySizes, r = t.fullLength / 2, n = 0, o = i[e], a = 0; a < e; a++)n += i[a]; return r - n - o } }, { key: "getSectionRoofY", value: function (e) { var t = this.shed, i = this.x; if (this.direction === f.Horizontal) switch (i) { case 0: return t.getAwningLeftRoofY(e); case 1: return this.shed.getRoofY(e); case 2: return t.getAwningRightRoofY(e) } else if (this.direction === f.Vertical) switch (i) { case 0: return t.leftAwningGutterHeight; case 1: return t.awningLeft.visible ? t.leftAwningApexHeight : t.leftGutterHeight; case 2: return t.awningRight.visible ? t.rightAwningApexHeight : t.rightGutterHeight; case 3: return t.rightAwningGutterHeight } else if (this.direction === f.Roof) switch (i) { case 0: return t.awningLeft.roofLength; case 1: return t.leftRoofDistance; case 2: return t.rightRoofDistance; case 3: return t.awningRight.roofLength }return 0 } }, { key: "bounds", get: function () { var e = this.shed, t = this.x, i = this.y, r = 0, n = 0, o = 0; if (this.direction === f.Horizontal) r = [e.awningLeft.length, e.width, e.awningRight.length][t], n = [e.leftAwningGutterHeight, Math.min(e.rightGutterHeight, e.leftGutterHeight), e.rightAwningGutterHeight][t]; else if (this.direction === f.Roof) { switch (t) { case 0: n = e.awningLeft.roofLength; break; case 1: n = e.leftRoofDistance; break; case 2: n = e.rightRoofDistance; break; case 3: n = e.awningRight.roofLength }r = e.baySizes[i], o = this.getBayOffset(i) } else { switch (t) { case 0: n = e.leftAwningGutterHeight; break; case 1: n = e.leftGutterHeight, e.awningLeft.visible && (n = e.leftAwningApexHeight); break; case 2: n = e.rightGutterHeight, e.awningRight.visible && (n = e.rightAwningApexHeight); break; case 3: n = e.rightAwningGutterHeight }r = e.baySizes[i], o = this.getBayOffset(i) } return { x: o, y: 0, length: r, height: n } } }]), e }(); l([(0, t.serializable)((0, t.custom)(g, d)), e.observable], b.prototype, "models", void 0), l([t.serializable, e.observable], b.prototype, "visible", void 0), l([t.serializable, e.observable], b.prototype, "direction", void 0), l([(0, t.serializable)((0, t.reference)("id", u))], b.prototype, "shed", void 0), l([(0, t.serializable)((0, t.reference)("id", c))], b.prototype, "grid", void 0), l([t.serializable, e.observable], b.prototype, "x", void 0), l([t.serializable, e.observable], b.prototype, "y", void 0), l([e.computed], b.prototype, "bounds", null); var p = b; exports.default = p;
    }, { "mobx": "6uYi", "serializr": "94gV", "./model/Factory": "ECuv" }], "Pw6J": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.Extra = void 0; var e = a(require("react")), t = require("mobx"), i = require("mobx-react"), n = p(require("../../../components/form/Form")), r = require("../../../stores/model/Model"), o = p(require("../../../stores/model/Factory")), u = require("../../../stores/model/MetalSlidingDoor"), m = require("../../../stores/model/Window"), l = require("../../../stores/Section"); function p(e) { return e && e.__esModule ? e : { default: e } } function a(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var i in e) if (Object.prototype.hasOwnProperty.call(e, i)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, i) : {}; n.get || n.set ? Object.defineProperty(t, i, n) : t[i] = e[i] } return t.default = e, t } function s(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function y(e, t) { for (var i = 0; i < t.length; i++) { var n = t[i]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function d(e, t, i) { return t && y(e.prototype, t), i && y(e, i), e } function f(e, t) { return !t || "object" !== x(t) && "function" != typeof t ? c(e) : t } function c(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function g(e) { return (g = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function h(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && b(e, t) } function b(e, t) { return (b = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function x(e) { return (x = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var w = function (e, t, i, n) { var r, o = arguments.length, u = o < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, i) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : x(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, t, i, n); else for (var m = e.length - 1; m >= 0; m--)(r = e[m]) && (u = (o < 3 ? r(u) : o > 3 ? r(t, i, u) : r(t, i)) || u); return o > 3 && u && Object.defineProperty(t, i, u), u }, O = { awningRight: { heightOffset: { "ui:widget": "range", "ui:options": { step: .2 } }, length: { "ui:widget": "range", "ui:options": { step: .25 } } }, awningLeft: { heightOffset: { "ui:widget": "range", "ui:options": { step: .25 } }, length: { "ui:widget": "range" } }, models: { items: { x: { "ui:title": "X", "ui:widget": "range", "ui:options": { step: .1 } }, y: { "ui:title": "Y", "ui:widget": "range", "ui:options": { step: .1 } }, width: { "ui:title": "Width", "ui:widget": "range", "ui:options": { step: .2 } }, height: { "ui:title": "Height", "ui:widget": "range", "ui:options": { step: .2 } }, heightOffset: { "ui:title": "Height Offset", "ui:widget": "range", "ui:options": { step: .2 } } } }, baySizes: { items: { "ui:widget": "range", "ui:options": { step: .2 } } }, comment: { "ui:widget": "textarea" } }, v = function (t) { function i(e, t) { var n; return s(this, i), (n = f(this, g(i).call(this, e, t))).state = {}, n } return h(i, e.Component), d(i, [{ key: "render", value: function () { return null } }]), i }(); exports.Extra = v, exports.Extra = v = w([i.observer], v); var M = function (i) { function p(e, t) { var i; return s(this, p), (i = f(this, g(p).call(this, e, t))).state = {}, i } return h(p, e.Component), d(p, [{ key: "render", value: function () { var i = this.props, p = i.shed, a = i.sections, s = a[0], y = s.bounds, d = y.length, f = y.height, c = [r.ModelType.PADoor, r.ModelType.GlassSlidingDoor, r.ModelType.MetalSlidingDoor, r.ModelType.RollerDoor, r.ModelType.Window, r.ModelType.Opening]; s.direction === l.Direction.Roof && (c = [r.ModelType.Whirlybird, r.ModelType.Skylight]); var g = { type: "object", properties: { type: { title: "Section", displayLabel: !1, type: "string", enum: c, default: c[0] } }, dependencies: { type: { oneOf: [{ properties: { type: { displayLabel: !1, enum: [r.ModelType.PADoor] }, x: { title: "x", type: "number", minimum: 0, maximum: d, default: 0 }, y: { title: "y", type: "number", minimum: 0, maximum: f, default: 0 } } }, { properties: { type: { enum: [r.ModelType.GlassSlidingDoor] }, x: { title: "x", type: "number", minimum: 0, maximum: d, default: 0 }, y: { title: "y", type: "number", minimum: 0, maximum: f, default: 0 } } }, { properties: { type: { enum: [r.ModelType.MetalSlidingDoor] }, width: { title: "width", minimum: .5, maximum: 10, type: "number" }, height: { title: "Height", minimum: .5, maximum: p.maxHeight, type: "number" }, x: { title: "x", type: "number", minimum: 0, maximum: d, default: 0 }, y: { title: "y", type: "number", minimum: 0, maximum: f, default: 0 }, openDirection: { title: "Open Direction", displayLabel: !1, type: "string", enum: Object.values(u.OpenDirection), default: u.OpenDirection.Right } } }, { properties: { type: { enum: [r.ModelType.RollerDoor] }, width: { minimum: 1, maximum: 5, type: "number" }, height: { minimum: 1.2, maximum: 5, type: "number" }, x: { title: "x", type: "number", minimum: 0, maximum: d, default: 0 }, y: { title: "y", type: "number", minimum: 0, maximum: f, default: 0 } } }, { properties: { type: { enum: [r.ModelType.Window] }, x: { title: "x", type: "number", minimum: 0, maximum: d, default: 0 }, y: { title: "y", type: "number", minimum: 0, maximum: f, default: 0 }, windowType: { title: "Size", displayLabel: !1, type: "string", enum: Object.values(m.WindowTypes) } } }, { properties: { type: { enum: [r.ModelType.Opening] }, width: { minimum: .5, maximum: Math.max(p.maxWidth, 6), type: "number" }, height: { minimum: .5, maximum: p.maxHeight, type: "number" }, x: { title: "x", type: "number", minimum: 0, maximum: d, default: 0 }, y: { title: "y", type: "number", minimum: 0, maximum: f, default: 0 } } }, { properties: { type: { enum: [r.ModelType.Skylight] }, x: { title: "x", type: "number", minimum: 0, maximum: d, default: 0 } } }, { properties: { type: { enum: [r.ModelType.Whirlybird] }, x: { title: "x", type: "number", minimum: 0, maximum: d, default: 0 } } }] } } }, h = ""; a.length > 1 && (h = "(".concat(a.length, ")")); var b = { type: "object", properties: { models: { title: "Extras ".concat(h), type: "array", items: g } } }, x = { formData: { models: s.getLayout().map(function (e, t) { var i = e.model, n = e.width, r = e.height, o = i.toJson(); return Object.assign(o, { id: t, width: n, height: r }), o }) }, schema: b, onChange: function (e) { var i = e.formData.models.map(function (e) { var t = e.id; delete e.id; var i = s.models[t], n = { type: e.type, x: e.x, y: e.y }; return i && i.type === e.type ? n = e : (n.x || delete n.x, n.y || delete n.y), o.default.create(n) }); (0, t.transaction)(function () { a.forEach(function (e) { e.models.splice(0, e.models.length), i.forEach(function (t) { e.models.push(t) }) }) }) }, className: "extras" }; return e.createElement(n.default, Object.assign({}, x, { uiSchema: O })) } }]), p }(), j = M = w([i.observer], M); exports.default = j;
    }, { "react": "1n8/", "mobx": "6uYi", "mobx-react": "lQiT", "../../../components/form/Form": "I4f+", "../../../stores/model/Model": "wZmN", "../../../stores/model/Factory": "ECuv", "../../../stores/model/MetalSlidingDoor": "y87A", "../../../stores/model/Window": "6a89", "../../../stores/Section": "t/JC" }], "ODQQ": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/objectWithoutProperties"), t = h(e), r = require("babel-runtime/helpers/classCallCheck"), n = h(r), a = require("babel-runtime/helpers/possibleConstructorReturn"), i = h(a), l = require("babel-runtime/helpers/inherits"), u = h(l), o = require("react"), d = h(o), s = require("prop-types"), c = h(s), f = require("uncontrollable"), p = h(f); function h(e) { return e && e.__esModule ? e : { default: e } } var b = "tab", y = "pane", C = c.default.oneOfType([c.default.string, c.default.number]), v = { id: function (e) { var t = null; if (!e.generateChildId) { for (var r = arguments.length, n = Array(r > 1 ? r - 1 : 0), a = 1; a < r; a++)n[a - 1] = arguments[a]; (t = C.apply(void 0, [e].concat(n))) || e.id || (t = new Error("In order to properly initialize Tabs in a way that is accessible to assistive technologies (such as screen readers) an `id` or a `generateChildId` prop to TabContainer is required")) } return t }, generateChildId: c.default.func, onSelect: c.default.func, activeKey: c.default.any }, g = { $bs_tabContainer: c.default.shape({ activeKey: c.default.any, onSelect: c.default.func.isRequired, getTabId: c.default.func.isRequired, getPaneId: c.default.func.isRequired }) }, q = function (e) { function r() { return (0, n.default)(this, r), (0, i.default)(this, e.apply(this, arguments)) } return (0, u.default)(r, e), r.prototype.getChildContext = function () { var e = this.props, t = e.activeKey, r = e.onSelect, n = e.generateChildId, a = e.id, i = n || function (e, t) { return a ? a + "-" + t + "-" + e : null }; return { $bs_tabContainer: { activeKey: t, onSelect: r, getTabId: function (e) { return i(e, b) }, getPaneId: function (e) { return i(e, y) } } } }, r.prototype.render = function () { var e = this.props, r = e.children, n = (0, t.default)(e, ["children"]); return delete n.generateChildId, delete n.onSelect, delete n.activeKey, d.default.cloneElement(d.default.Children.only(r), n) }, r }(d.default.Component); q.propTypes = v, q.childContextTypes = g, exports.default = (0, p.default)(q, { activeKey: "onSelect" }), module.exports = exports.default;
    }, { "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "uncontrollable": "pOCK" }], "uBqW": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = v(e), n = require("babel-runtime/helpers/objectWithoutProperties"), a = v(n), i = require("babel-runtime/helpers/classCallCheck"), o = v(i), l = require("babel-runtime/helpers/possibleConstructorReturn"), u = v(l), r = require("babel-runtime/helpers/inherits"), s = v(r), d = require("classnames"), p = v(d), c = require("react"), f = v(c), h = require("prop-types"), m = v(h), b = require("prop-types-extra/lib/elementType"), y = v(b), C = require("./utils/bootstrapUtils"); function v(e) { return e && e.__esModule ? e : { default: e } } var x = { componentClass: y.default, animation: m.default.oneOfType([m.default.bool, y.default]), mountOnEnter: m.default.bool, unmountOnExit: m.default.bool }, E = { componentClass: "div", animation: !0, mountOnEnter: !1, unmountOnExit: !1 }, P = { $bs_tabContainer: m.default.shape({ activeKey: m.default.any }) }, O = { $bs_tabContent: m.default.shape({ bsClass: m.default.string, animation: m.default.oneOfType([m.default.bool, y.default]), activeKey: m.default.any, mountOnEnter: m.default.bool, unmountOnExit: m.default.bool, onPaneEnter: m.default.func.isRequired, onPaneExited: m.default.func.isRequired, exiting: m.default.bool.isRequired }) }, q = function (e) { function n(t, a) { (0, o.default)(this, n); var i = (0, u.default)(this, e.call(this, t, a)); return i.handlePaneEnter = i.handlePaneEnter.bind(i), i.handlePaneExited = i.handlePaneExited.bind(i), i.state = { activeKey: null, activeChild: null }, i } return (0, s.default)(n, e), n.prototype.getChildContext = function () { var e = this.props, t = e.bsClass, n = e.animation, a = e.mountOnEnter, i = e.unmountOnExit, o = this.state.activeKey, l = this.getContainerActiveKey(), u = null != o && o !== l; return { $bs_tabContent: { bsClass: t, animation: n, activeKey: null != o ? o : l, mountOnEnter: a, unmountOnExit: i, onPaneEnter: this.handlePaneEnter, onPaneExited: this.handlePaneExited, exiting: u } } }, n.prototype.componentWillReceiveProps = function (e) { !e.animation && this.state.activeChild && this.setState({ activeKey: null, activeChild: null }) }, n.prototype.componentWillUnmount = function () { this.isUnmounted = !0 }, n.prototype.getContainerActiveKey = function () { var e = this.context.$bs_tabContainer; return e && e.activeKey }, n.prototype.handlePaneEnter = function (e, t) { return !!this.props.animation && (t === this.getContainerActiveKey() && (this.setState({ activeKey: t, activeChild: e }), !0)) }, n.prototype.handlePaneExited = function (e) { this.isUnmounted || this.setState(function (t) { return t.activeChild !== e ? null : { activeKey: null, activeChild: null } }) }, n.prototype.render = function () { var e = this.props, n = e.componentClass, i = e.className, o = (0, a.default)(e, ["componentClass", "className"]), l = (0, C.splitBsPropsAndOmit)(o, ["animation", "mountOnEnter", "unmountOnExit"]), u = l[0], r = l[1]; return f.default.createElement(n, (0, t.default)({}, r, { className: (0, p.default)(i, (0, C.prefix)(u, "content")) })) }, n }(f.default.Component); q.propTypes = x, q.defaultProps = E, q.contextTypes = P, q.childContextTypes = O, exports.default = (0, C.bsClass)("tab", q), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "prop-types-extra/lib/elementType": "aemN", "./utils/bootstrapUtils": "t+qF" }], "aUfQ": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.classNamesShape = exports.timeoutsShape = void 0, exports.transitionTimeout = n; var e = require("prop-types"), t = r(e); function r(e) { return e && e.__esModule ? e : { default: e } } function n(e) { var t = "transition" + e + "Timeout", r = "transition" + e; return function (e) { if (e[r]) { if (null == e[t]) return new Error(t + " wasn't supplied to CSSTransitionGroup: this can cause unreliable animations and won't be supported in a future version of React. See https://fb.me/react-animation-transition-group-timeout for more information."); if ("number" != typeof e[t]) return new Error(t + " must be a number (in milliseconds)") } return null } } var i = exports.timeoutsShape = t.default.oneOfType([t.default.number, t.default.shape({ enter: t.default.number, exit: t.default.number }).isRequired]), a = exports.classNamesShape = t.default.oneOfType([t.default.string, t.default.shape({ enter: t.default.string, exit: t.default.string, active: t.default.string }), t.default.shape({ enter: t.default.string, enterDone: t.default.string, enterActive: t.default.string, exit: t.default.string, exitDone: t.default.string, exitActive: t.default.string })]);
    }, { "prop-types": "5D9O" }], "4RiQ": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.EXITING = exports.ENTERED = exports.ENTERING = exports.EXITED = exports.UNMOUNTED = void 0; var t = require("prop-types"), e = u(t), n = require("react"), o = a(n), i = require("react-dom"), r = a(i), s = require("./utils/PropTypes"); function a(t) { return t && t.__esModule ? t : { default: t } } function u(t) { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var n in t) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]); return e.default = t, e } function p(t, e) { var n = {}; for (var o in t) e.indexOf(o) >= 0 || Object.prototype.hasOwnProperty.call(t, o) && (n[o] = t[o]); return n } function l(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } function c(t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e } function f(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e) } var d = exports.UNMOUNTED = "unmounted", h = exports.EXITED = "exited", E = exports.ENTERING = "entering", x = exports.ENTERED = "entered", y = exports.EXITING = "exiting", b = function (t) { function e(n, o) { l(this, e); var i = c(this, t.call(this, n, o)), r = o.transitionGroup, s = r && !r.isMounting ? n.enter : n.appear, a = void 0; return i.nextStatus = null, n.in ? s ? (a = h, i.nextStatus = E) : a = x : a = n.unmountOnExit || n.mountOnEnter ? d : h, i.state = { status: a }, i.nextCallback = null, i } return f(e, t), e.prototype.getChildContext = function () { return { transitionGroup: null } }, e.prototype.componentDidMount = function () { this.updateStatus(!0) }, e.prototype.componentWillReceiveProps = function (t) { var e = (this.pendingState || this.state).status; t.in ? (e === d && this.setState({ status: h }), e !== E && e !== x && (this.nextStatus = E)) : e !== E && e !== x || (this.nextStatus = y) }, e.prototype.componentDidUpdate = function () { this.updateStatus() }, e.prototype.componentWillUnmount = function () { this.cancelNextCallback() }, e.prototype.getTimeouts = function () { var t = this.props.timeout, e = void 0, n = void 0, o = void 0; return e = n = o = t, null != t && "number" != typeof t && (e = t.exit, n = t.enter, o = t.appear), { exit: e, enter: n, appear: o } }, e.prototype.updateStatus = function () { var t = arguments.length > 0 && void 0 !== arguments[0] && arguments[0], e = this.nextStatus; if (null !== e) { this.nextStatus = null, this.cancelNextCallback(); var n = r.default.findDOMNode(this); e === E ? this.performEnter(n, t) : this.performExit(n) } else this.props.unmountOnExit && this.state.status === h && this.setState({ status: d }) }, e.prototype.performEnter = function (t, e) { var n = this, o = this.props.enter, i = this.context.transitionGroup ? this.context.transitionGroup.isMounting : e, r = this.getTimeouts(); e || o ? (this.props.onEnter(t, i), this.safeSetState({ status: E }, function () { n.props.onEntering(t, i), n.onTransitionEnd(t, r.enter, function () { n.safeSetState({ status: x }, function () { n.props.onEntered(t, i) }) }) })) : this.safeSetState({ status: x }, function () { n.props.onEntered(t) }) }, e.prototype.performExit = function (t) { var e = this, n = this.props.exit, o = this.getTimeouts(); n ? (this.props.onExit(t), this.safeSetState({ status: y }, function () { e.props.onExiting(t), e.onTransitionEnd(t, o.exit, function () { e.safeSetState({ status: h }, function () { e.props.onExited(t) }) }) })) : this.safeSetState({ status: h }, function () { e.props.onExited(t) }) }, e.prototype.cancelNextCallback = function () { null !== this.nextCallback && (this.nextCallback.cancel(), this.nextCallback = null) }, e.prototype.safeSetState = function (t, e) { var n = this; this.pendingState = t, e = this.setNextCallback(e), this.setState(t, function () { n.pendingState = null, e() }) }, e.prototype.setNextCallback = function (t) { var e = this, n = !0; return this.nextCallback = function (o) { n && (n = !1, e.nextCallback = null, t(o)) }, this.nextCallback.cancel = function () { n = !1 }, this.nextCallback }, e.prototype.onTransitionEnd = function (t, e, n) { this.setNextCallback(n), t ? (this.props.addEndListener && this.props.addEndListener(t, this.nextCallback), null != e && setTimeout(this.nextCallback, e)) : setTimeout(this.nextCallback, 0) }, e.prototype.render = function () { var t = this.state.status; if (t === d) return null; var e = this.props, n = e.children, i = p(e, ["children"]); if (delete i.in, delete i.mountOnEnter, delete i.unmountOnExit, delete i.appear, delete i.enter, delete i.exit, delete i.timeout, delete i.addEndListener, delete i.onEnter, delete i.onEntering, delete i.onEntered, delete i.onExit, delete i.onExiting, delete i.onExited, "function" == typeof n) return n(t, i); var r = o.default.Children.only(n); return o.default.cloneElement(r, i) }, e }(o.default.Component); function m() { } b.contextTypes = { transitionGroup: e.object }, b.childContextTypes = { transitionGroup: function () { } }, b.propTypes = {}, b.defaultProps = { in: !1, mountOnEnter: !1, unmountOnExit: !1, appear: !1, enter: !0, exit: !0, onEnter: m, onEntering: m, onEntered: m, onExit: m, onExiting: m, onExited: m }, b.UNMOUNTED = 0, b.EXITED = 1, b.ENTERING = 2, b.ENTERED = 3, b.EXITING = 4, exports.default = b;
    }, { "prop-types": "5D9O", "react": "1n8/", "react-dom": "NKHc", "./utils/PropTypes": "aUfQ" }], "UlEz": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e, t = require("babel-runtime/helpers/extends"), r = q(t), u = require("babel-runtime/helpers/objectWithoutProperties"), n = q(u), l = require("babel-runtime/helpers/classCallCheck"), a = q(l), o = require("babel-runtime/helpers/possibleConstructorReturn"), i = q(o), s = require("babel-runtime/helpers/inherits"), f = q(s), d = require("classnames"), p = q(d), c = require("react"), m = q(c), b = require("prop-types"), E = q(b), h = require("react-transition-group/Transition"), x = q(h); function q(e) { return e && e.__esModule ? e : { default: e } } var N = { in: E.default.bool, mountOnEnter: E.default.bool, unmountOnExit: E.default.bool, appear: E.default.bool, timeout: E.default.number, onEnter: E.default.func, onEntering: E.default.func, onEntered: E.default.func, onExit: E.default.func, onExiting: E.default.func, onExited: E.default.func }, y = { in: !1, timeout: 300, mountOnEnter: !1, unmountOnExit: !1, appear: !1 }, C = ((e = {})[h.ENTERING] = "in", e[h.ENTERED] = "in", e), O = function (e) { function t() { return (0, a.default)(this, t), (0, i.default)(this, e.apply(this, arguments)) } return (0, f.default)(t, e), t.prototype.render = function () { var e = this.props, t = e.className, u = e.children, l = (0, n.default)(e, ["className", "children"]); return m.default.createElement(x.default, l, function (e, n) { return m.default.cloneElement(u, (0, r.default)({}, n, { className: (0, p.default)("fade", t, u.props.className, C[e]) })) }) }, t }(m.default.Component); O.propTypes = N, O.defaultProps = y, exports.default = O, module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "react-transition-group/Transition": "4RiQ" }], "QWT8": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var t = require("babel-runtime/helpers/extends"), e = _(t), n = require("babel-runtime/helpers/objectWithoutProperties"), i = _(n), a = require("babel-runtime/helpers/classCallCheck"), o = _(a), r = require("babel-runtime/helpers/possibleConstructorReturn"), u = _(r), l = require("babel-runtime/helpers/inherits"), s = _(l), d = require("classnames"), f = _(d), p = require("react"), h = _(p), b = require("prop-types"), c = _(b), E = require("prop-types-extra/lib/elementType"), x = _(E), m = require("warning"), y = _(m), g = require("./utils/bootstrapUtils"), v = require("./utils/createChainedFunction"), C = _(v), q = require("./Fade"), O = _(q); function _(t) { return t && t.__esModule ? t : { default: t } } var $ = { eventKey: c.default.any, animation: c.default.oneOfType([c.default.bool, x.default]), id: c.default.string, "aria-labelledby": c.default.string, bsClass: c.default.string, onEnter: c.default.func, onEntering: c.default.func, onEntered: c.default.func, onExit: c.default.func, onExiting: c.default.func, onExited: c.default.func, mountOnEnter: c.default.bool, unmountOnExit: c.default.bool }, I = { $bs_tabContainer: c.default.shape({ getTabId: c.default.func, getPaneId: c.default.func }), $bs_tabContent: c.default.shape({ bsClass: c.default.string, animation: c.default.oneOfType([c.default.bool, x.default]), activeKey: c.default.any, mountOnEnter: c.default.bool, unmountOnExit: c.default.bool, onPaneEnter: c.default.func.isRequired, onPaneExited: c.default.func.isRequired, exiting: c.default.bool.isRequired }) }, P = { $bs_tabContainer: c.default.oneOf([null]) }, T = function (t) { function n(e, i) { (0, o.default)(this, n); var a = (0, u.default)(this, t.call(this, e, i)); return a.handleEnter = a.handleEnter.bind(a), a.handleExited = a.handleExited.bind(a), a.in = !1, a } return (0, s.default)(n, t), n.prototype.getChildContext = function () { return { $bs_tabContainer: null } }, n.prototype.componentDidMount = function () { this.shouldBeIn() && this.handleEnter() }, n.prototype.componentDidUpdate = function () { this.in ? this.shouldBeIn() || this.handleExited() : this.shouldBeIn() && this.handleEnter() }, n.prototype.componentWillUnmount = function () { this.in && this.handleExited() }, n.prototype.getAnimation = function () { if (null != this.props.animation) return this.props.animation; var t = this.context.$bs_tabContent; return t && t.animation }, n.prototype.handleEnter = function () { var t = this.context.$bs_tabContent; t && (this.in = t.onPaneEnter(this, this.props.eventKey)) }, n.prototype.handleExited = function () { var t = this.context.$bs_tabContent; t && (t.onPaneExited(this), this.in = !1) }, n.prototype.isActive = function () { var t = this.context.$bs_tabContent, e = t && t.activeKey; return this.props.eventKey === e }, n.prototype.shouldBeIn = function () { return this.getAnimation() && this.isActive() }, n.prototype.render = function () { var t = this.props, n = t.eventKey, a = t.className, o = t.onEnter, r = t.onEntering, u = t.onEntered, l = t.onExit, s = t.onExiting, d = t.onExited, p = t.mountOnEnter, b = t.unmountOnExit, c = (0, i.default)(t, ["eventKey", "className", "onEnter", "onEntering", "onEntered", "onExit", "onExiting", "onExited", "mountOnEnter", "unmountOnExit"]), E = this.context, x = E.$bs_tabContent, m = E.$bs_tabContainer, y = (0, g.splitBsPropsAndOmit)(c, ["animation"]), v = y[0], q = y[1], _ = this.isActive(), $ = this.getAnimation(), I = null != p ? p : x && x.mountOnEnter, P = null != b ? b : x && x.unmountOnExit; if (!_ && !$ && P) return null; var T = !0 === $ ? O.default : $ || null; x && (v.bsClass = (0, g.prefix)(x, "pane")); var A = (0, e.default)({}, (0, g.getClassSet)(v), { active: _ }); m && (q.id = m.getPaneId(n), q["aria-labelledby"] = m.getTabId(n)); var K = h.default.createElement("div", (0, e.default)({}, q, { role: "tabpanel", "aria-hidden": !_, className: (0, f.default)(a, A) })); if (T) { var B = x && x.exiting; return h.default.createElement(T, { in: _ && !B, onEnter: (0, C.default)(this.handleEnter, o), onEntering: r, onEntered: u, onExit: l, onExiting: s, onExited: (0, C.default)(this.handleExited, d), mountOnEnter: I, unmountOnExit: P }, K) } return K }, n }(h.default.Component); T.propTypes = $, T.contextTypes = I, T.childContextTypes = P, exports.default = (0, g.bsClass)("tab-pane", T), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "prop-types-extra/lib/elementType": "aemN", "warning": "/sXU", "./utils/bootstrapUtils": "t+qF", "./utils/createChainedFunction": "GYue", "./Fade": "UlEz" }], "bg+n": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/classCallCheck"), t = q(e), r = require("babel-runtime/helpers/possibleConstructorReturn"), a = q(r), l = require("babel-runtime/helpers/inherits"), u = q(l), n = require("babel-runtime/helpers/extends"), s = q(n), i = require("react"), d = q(i), o = require("prop-types"), p = q(o), f = require("./TabContainer"), b = q(f), c = require("./TabContent"), h = q(c), C = require("./TabPane"), m = q(C); function q(e) { return e && e.__esModule ? e : { default: e } } var x = (0, s.default)({}, m.default.propTypes, { disabled: p.default.bool, title: p.default.node, tabClassName: p.default.string }), y = function (e) { function r() { return (0, t.default)(this, r), (0, a.default)(this, e.apply(this, arguments)) } return (0, u.default)(r, e), r.prototype.render = function () { var e = (0, s.default)({}, this.props); return delete e.title, delete e.disabled, delete e.tabClassName, d.default.createElement(m.default, e) }, r }(d.default.Component); y.propTypes = x, y.Container = b.default, y.Content = h.default, y.Pane = m.default, exports.default = y, module.exports = exports.default;
    }, { "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "babel-runtime/helpers/extends": "T4f3", "react": "1n8/", "prop-types": "5D9O", "./TabContainer": "ODQQ", "./TabContent": "uBqW", "./TabPane": "QWT8" }], "cbd5": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = a; var e = r(require("react")); function r(e) { if (e && e.__esModule) return e; var r = {}; if (null != e) for (var t in e) if (Object.prototype.hasOwnProperty.call(e, t)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, t) : {}; o.get || o.set ? Object.defineProperty(r, t, o) : r[t] = e[t] } return r.default = e, r } var t = require("react-bootstrap/lib/Button"), o = require("react-bootstrap/lib/Tab"); function a(r) { var a = r.closeButton, n = null; return void 0 !== a && a && (n = e.createElement(t, { bsStyle: "primary", bsSize: "large" }, "Large button")), e.createElement(o, Object.assign({}, r), n, r.children) }
    }, { "react": "1n8/", "react-bootstrap/lib/Button": "2PkR", "react-bootstrap/lib/Tab": "bg+n" }], "91/V": [function (require, module, exports) {
        "use strict"; function e(e) { return function (r, s, o, t, n) { var u = o || "<<anonymous>>", a = n || s; if (null == r[s]) return new Error("The " + t + " `" + a + "` is required to make `" + u + "` accessible for users of assistive technologies such as screen readers."); for (var i = arguments.length, c = Array(i > 5 ? i - 5 : 0), l = 5; l < i; l++)c[l - 5] = arguments[l]; return e.apply(void 0, [r, s, o, t, n].concat(c)) } } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = e, module.exports = exports.default;
    }, {}], "dy/l": [function (require, module, exports) {
        function e(e) { if (e && "object" == typeof e) { var t = e.which || e.keyCode || e.charCode; t && (e = t) } if ("number" == typeof e) return a[e]; var n, p = String(e); return (n = r[p.toLowerCase()]) ? n : (n = o[p.toLowerCase()]) || (1 === p.length ? p.charCodeAt(0) : void 0) } e.isEventKey = function (e, t) { if (e && "object" == typeof e) { var a = e.which || e.keyCode || e.charCode; if (null == a) return !1; if ("string" == typeof t) { var n; if (n = r[t.toLowerCase()]) return n === a; if (n = o[t.toLowerCase()]) return n === a } else if ("number" == typeof t) return t === a; return !1 } }, exports = module.exports = e; var r = exports.code = exports.codes = { backspace: 8, tab: 9, enter: 13, shift: 16, ctrl: 17, alt: 18, "pause/break": 19, "caps lock": 20, esc: 27, space: 32, "page up": 33, "page down": 34, end: 35, home: 36, left: 37, up: 38, right: 39, down: 40, insert: 45, delete: 46, command: 91, "left command": 91, "right command": 93, "numpad *": 106, "numpad +": 107, "numpad -": 109, "numpad .": 110, "numpad /": 111, "num lock": 144, "scroll lock": 145, "my computer": 182, "my calculator": 183, ";": 186, "=": 187, ",": 188, "-": 189, ".": 190, "/": 191, "`": 192, "[": 219, "\\": 220, "]": 221, "'": 222 }, o = exports.aliases = { windows: 91, "⇧": 16, "⌥": 18, "⌃": 17, "⌘": 91, ctl: 17, control: 17, option: 18, pause: 19, break: 19, caps: 20, return: 13, escape: 27, spc: 32, spacebar: 32, pgup: 33, pgdn: 34, ins: 45, del: 46, cmd: 91 }; for (t = 97; t < 123; t++)r[String.fromCharCode(t)] = t - 32; for (var t = 48; t < 58; t++)r[t - 48] = t; for (t = 1; t < 13; t++)r["f" + t] = t + 111; for (t = 0; t < 10; t++)r["numpad " + t] = t + 96; var a = exports.names = exports.title = {}; for (t in r) a[r[t]] = t; for (var n in o) r[n] = o[n];
    }, {}], "Ti8L": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = k(e), r = require("babel-runtime/helpers/objectWithoutProperties"), i = k(r), a = require("babel-runtime/helpers/classCallCheck"), l = k(a), n = require("babel-runtime/helpers/possibleConstructorReturn"), s = k(n), u = require("babel-runtime/helpers/inherits"), o = k(u), d = require("classnames"), f = k(d), c = require("keycode"), p = k(c), v = require("react"), h = k(v), b = require("prop-types"), y = k(b), g = require("react-dom"), x = k(g), C = require("prop-types-extra/lib/all"), q = k(C), m = require("warning"), K = k(m), _ = require("./utils/bootstrapUtils"), A = require("./utils/createChainedFunction"), P = k(A), R = require("./utils/ValidComponentChildren"), S = k(R); function k(e) { return e && e.__esModule ? e : { default: e } } var j = { activeKey: y.default.any, activeHref: y.default.string, stacked: y.default.bool, justified: (0, q.default)(y.default.bool, function (e) { var t = e.justified, r = e.navbar; return t && r ? Error("justified navbar `Nav`s are not supported") : null }), onSelect: y.default.func, role: y.default.string, navbar: y.default.bool, pullRight: y.default.bool, pullLeft: y.default.bool }, N = { justified: !1, pullRight: !1, pullLeft: !1, stacked: !1 }, T = { $bs_navbar: y.default.shape({ bsClass: y.default.string, onSelect: y.default.func }), $bs_tabContainer: y.default.shape({ activeKey: y.default.any, onSelect: y.default.func.isRequired, getTabId: y.default.func.isRequired, getPaneId: y.default.func.isRequired }) }, w = function (e) { function r() { return (0, l.default)(this, r), (0, s.default)(this, e.apply(this, arguments)) } return (0, o.default)(r, e), r.prototype.componentDidUpdate = function () { var e = this; if (this._needsRefocus) { this._needsRefocus = !1; var t = this.props.children, r = this.getActiveProps(), i = r.activeKey, a = r.activeHref, l = S.default.find(t, function (t) { return e.isActive(t, i, a) }), n = S.default.toArray(t).indexOf(l), s = x.default.findDOMNode(this).children, u = s && s[n]; u && u.firstChild && u.firstChild.focus() } }, r.prototype.getActiveProps = function () { var e = this.context.$bs_tabContainer; return e || this.props }, r.prototype.getNextActiveChild = function (e) { var t = this, r = this.props.children, i = r.filter(function (e) { return null != e.props.eventKey && !e.props.disabled }), a = this.getActiveProps(), l = a.activeKey, n = a.activeHref, s = S.default.find(r, function (e) { return t.isActive(e, l, n) }), u = i.indexOf(s); if (-1 === u) return i[0]; var o = u + e, d = i.length; return o >= d ? o = 0 : o < 0 && (o = d - 1), i[o] }, r.prototype.getTabProps = function (e, t, r, i, a) { var l = this; if (!t && "tablist" !== r) return null; var n = e.props, s = n.id, u = n["aria-controls"], o = n.eventKey, d = n.role, f = n.onKeyDown, c = n.tabIndex; return t && (s = t.getTabId(o), u = t.getPaneId(o)), "tablist" === r && (d = d || "tab", f = (0, P.default)(function (e) { return l.handleTabKeyDown(a, e) }, f), c = i ? c : -1), { id: s, role: d, onKeyDown: f, "aria-controls": u, tabIndex: c } }, r.prototype.handleTabKeyDown = function (e, t) { var r = void 0; switch (t.keyCode) { case p.default.codes.left: case p.default.codes.up: r = this.getNextActiveChild(-1); break; case p.default.codes.right: case p.default.codes.down: r = this.getNextActiveChild(1); break; default: return }t.preventDefault(), e && r && null != r.props.eventKey && e(r.props.eventKey), this._needsRefocus = !0 }, r.prototype.isActive = function (e, t, r) { var i = e.props; return !!(i.active || null != t && i.eventKey === t || r && i.href === r) || i.active }, r.prototype.render = function () { var e, r = this, a = this.props, l = a.stacked, n = a.justified, s = a.onSelect, u = a.role, o = a.navbar, d = a.pullRight, c = a.pullLeft, p = a.className, b = a.children, y = (0, i.default)(a, ["stacked", "justified", "onSelect", "role", "navbar", "pullRight", "pullLeft", "className", "children"]), g = this.context.$bs_tabContainer, x = u || (g ? "tablist" : null), C = this.getActiveProps(), q = C.activeKey, m = C.activeHref; delete y.activeKey, delete y.activeHref; var K = (0, _.splitBsProps)(y), A = K[0], R = K[1], k = (0, t.default)({}, (0, _.getClassSet)(A), ((e = {})[(0, _.prefix)(A, "stacked")] = l, e[(0, _.prefix)(A, "justified")] = n, e)), j = null != o ? o : this.context.$bs_navbar, N = void 0, T = void 0; if (j) { var w = this.context.$bs_navbar || { bsClass: "navbar" }; k[(0, _.prefix)(w, "nav")] = !0, T = (0, _.prefix)(w, "right"), N = (0, _.prefix)(w, "left") } else T = "pull-right", N = "pull-left"; return k[T] = d, k[N] = c, h.default.createElement("ul", (0, t.default)({}, R, { role: x, className: (0, f.default)(p, k) }), S.default.map(b, function (e) { var i = r.isActive(e, q, m), a = (0, P.default)(e.props.onSelect, s, j && j.onSelect, g && g.onSelect); return (0, v.cloneElement)(e, (0, t.default)({}, r.getTabProps(e, g, x, i, a), { active: i, activeKey: q, activeHref: m, onSelect: a })) })) }, r }(h.default.Component); w.propTypes = j, w.defaultProps = N, w.contextTypes = T, exports.default = (0, _.bsClass)("nav", (0, _.bsStyles)(["tabs", "pills"], w)), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "keycode": "dy/l", "react": "1n8/", "prop-types": "5D9O", "react-dom": "NKHc", "prop-types-extra/lib/all": "87Sr", "warning": "/sXU", "./utils/bootstrapUtils": "t+qF", "./utils/createChainedFunction": "GYue", "./utils/ValidComponentChildren": "Zn90" }], "Kpgx": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = q(e), l = require("babel-runtime/helpers/objectWithoutProperties"), r = q(l), a = require("babel-runtime/helpers/classCallCheck"), i = q(a), s = require("babel-runtime/helpers/possibleConstructorReturn"), u = q(s), n = require("babel-runtime/helpers/inherits"), o = q(n), d = require("classnames"), c = q(d), p = require("react"), f = q(p), h = require("prop-types"), b = q(h), v = require("./SafeAnchor"), m = q(v), C = require("./utils/createChainedFunction"), y = q(C); function q(e) { return e && e.__esModule ? e : { default: e } } var k = { active: b.default.bool, disabled: b.default.bool, role: b.default.string, href: b.default.string, onClick: b.default.func, onSelect: b.default.func, eventKey: b.default.any }, x = { active: !1, disabled: !1 }, S = function (e) { function l(t, r) { (0, i.default)(this, l); var a = (0, u.default)(this, e.call(this, t, r)); return a.handleClick = a.handleClick.bind(a), a } return (0, o.default)(l, e), l.prototype.handleClick = function (e) { this.props.disabled ? e.preventDefault() : this.props.onSelect && this.props.onSelect(this.props.eventKey, e) }, l.prototype.render = function () { var e = this.props, l = e.active, a = e.disabled, i = e.onClick, s = e.className, u = e.style, n = (0, r.default)(e, ["active", "disabled", "onClick", "className", "style"]); return delete n.onSelect, delete n.eventKey, delete n.activeKey, delete n.activeHref, n.role ? "tab" === n.role && (n["aria-selected"] = l) : "#" === n.href && (n.role = "button"), f.default.createElement("li", { role: "presentation", className: (0, c.default)(s, { active: l, disabled: a }), style: u }, f.default.createElement(m.default, (0, t.default)({}, n, { disabled: a, onClick: (0, y.default)(i, this.handleClick) }))) }, l }(f.default.Component); S.propTypes = k, S.defaultProps = x, exports.default = S, module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "./SafeAnchor": "dvX0", "./utils/createChainedFunction": "GYue" }], "HI3u": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = M(e), n = require("babel-runtime/helpers/objectWithoutProperties"), r = M(n), l = require("babel-runtime/helpers/classCallCheck"), a = M(l), u = require("babel-runtime/helpers/possibleConstructorReturn"), i = M(u), o = require("babel-runtime/helpers/inherits"), s = M(o), d = require("react"), f = M(d), p = require("prop-types"), c = M(p), m = require("prop-types-extra/lib/isRequiredForA11y"), b = M(m), y = require("uncontrollable"), v = M(y), h = require("./Nav"), q = M(h), E = require("./NavItem"), C = M(E), O = require("./TabContainer"), x = M(O), K = require("./TabContent"), N = M(K), S = require("./utils/bootstrapUtils"), T = require("./utils/ValidComponentChildren"), _ = M(T); function M(e) { return e && e.__esModule ? e : { default: e } } var P = x.default.ControlledComponent, R = { activeKey: c.default.any, bsStyle: c.default.oneOf(["tabs", "pills"]), animation: c.default.bool, id: (0, b.default)(c.default.oneOfType([c.default.string, c.default.number])), onSelect: c.default.func, mountOnEnter: c.default.bool, unmountOnExit: c.default.bool }, g = { bsStyle: "tabs", animation: !0, mountOnEnter: !1, unmountOnExit: !1 }; function j(e) { var t = void 0; return _.default.forEach(e, function (e) { null == t && (t = e.props.eventKey) }), t } var k = function (e) { function n() { return (0, a.default)(this, n), (0, i.default)(this, e.apply(this, arguments)) } return (0, s.default)(n, e), n.prototype.renderTab = function (e) { var t = e.props, n = t.title, r = t.eventKey, l = t.disabled, a = t.tabClassName; return null == n ? null : f.default.createElement(C.default, { eventKey: r, disabled: l, className: a }, n) }, n.prototype.render = function () { var e = this.props, n = e.id, l = e.onSelect, a = e.animation, u = e.mountOnEnter, i = e.unmountOnExit, o = e.bsClass, s = e.className, d = e.style, p = e.children, c = e.activeKey, m = void 0 === c ? j(p) : c, b = (0, r.default)(e, ["id", "onSelect", "animation", "mountOnEnter", "unmountOnExit", "bsClass", "className", "style", "children", "activeKey"]); return f.default.createElement(P, { id: n, activeKey: m, onSelect: l, className: s, style: d }, f.default.createElement("div", null, f.default.createElement(q.default, (0, t.default)({}, b, { role: "tablist" }), _.default.map(p, this.renderTab)), f.default.createElement(N.default, { bsClass: o, animation: a, mountOnEnter: u, unmountOnExit: i }, p))) }, n }(f.default.Component); k.propTypes = R, k.defaultProps = g, (0, S.bsClass)("tab", k), exports.default = (0, v.default)(k, { activeKey: "onSelect" }), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "react": "1n8/", "prop-types": "5D9O", "prop-types-extra/lib/isRequiredForA11y": "91/V", "uncontrollable": "pOCK", "./Nav": "Ti8L", "./NavItem": "Kpgx", "./TabContainer": "ODQQ", "./TabContent": "uBqW", "./utils/bootstrapUtils": "t+qF", "./utils/ValidComponentChildren": "Zn90" }], "PfJX": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = n; var e = t(require("react")); function t(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; o.get || o.set ? Object.defineProperty(t, r, o) : t[r] = e[r] } return t.default = e, t } var r = function (e, t) { var r = {}; for (var o in e) Object.prototype.hasOwnProperty.call(e, o) && t.indexOf(o) < 0 && (r[o] = e[o]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var n = 0; for (o = Object.getOwnPropertySymbols(e); n < o.length; n++)t.indexOf(o[n]) < 0 && (r[o[n]] = e[o[n]]) } return r }, o = require("react-bootstrap/lib/Tabs"); function n(t) { var n = t.closeButton, c = void 0 !== n && n, l = t.onClose, i = r(t, ["closeButton", "onClose"]), a = null; return c && (a = e.createElement("button", { onClick: function () { l && l() }, className: "close" }, "×")), e.createElement(o, Object.assign({}, i), a, t.children) }
    }, { "react": "1n8/", "react-bootstrap/lib/Tabs": "HI3u" }], "e2xO": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/classCallCheck"), t = p(e), r = require("babel-runtime/helpers/possibleConstructorReturn"), l = p(r), u = require("babel-runtime/helpers/inherits"), a = p(u), s = require("prop-types"), n = p(s), o = require("react"), i = p(o); function p(e) { return e && e.__esModule ? e : { default: e } } var d = { label: n.default.string.isRequired, onClick: n.default.func }, c = { label: "Close" }, f = function (e) { function r() { return (0, t.default)(this, r), (0, l.default)(this, e.apply(this, arguments)) } return (0, a.default)(r, e), r.prototype.render = function () { var e = this.props, t = e.label, r = e.onClick; return i.default.createElement("button", { type: "button", className: "close", onClick: r }, i.default.createElement("span", { "aria-hidden": "true" }, "×"), i.default.createElement("span", { className: "sr-only" }, t)) }, r }(i.default.Component); f.propTypes = d, f.defaultProps = c, exports.default = f, module.exports = exports.default;
    }, { "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "prop-types": "5D9O", "react": "1n8/" }], "VV+3": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/core-js/object/values"), t = S(e), r = require("babel-runtime/helpers/extends"), s = S(r), l = require("babel-runtime/helpers/objectWithoutProperties"), a = S(l), u = require("babel-runtime/helpers/classCallCheck"), i = S(u), o = require("babel-runtime/helpers/possibleConstructorReturn"), n = S(o), p = require("babel-runtime/helpers/inherits"), d = S(p), c = require("classnames"), f = S(c), b = require("react"), m = S(b), h = require("prop-types"), q = S(h), C = require("./utils/bootstrapUtils"), x = require("./utils/StyleConfig"), y = require("./CloseButton"), v = S(y); function S(e) { return e && e.__esModule ? e : { default: e } } var L = { onDismiss: q.default.func, closeLabel: q.default.string }, N = { closeLabel: "Close alert" }, _ = function (e) { function t() { return (0, i.default)(this, t), (0, n.default)(this, e.apply(this, arguments)) } return (0, d.default)(t, e), t.prototype.render = function () { var e, t = this.props, r = t.onDismiss, l = t.closeLabel, u = t.className, i = t.children, o = (0, a.default)(t, ["onDismiss", "closeLabel", "className", "children"]), n = (0, C.splitBsProps)(o), p = n[0], d = n[1], c = !!r, b = (0, s.default)({}, (0, C.getClassSet)(p), ((e = {})[(0, C.prefix)(p, "dismissable")] = c, e)); return m.default.createElement("div", (0, s.default)({}, d, { role: "alert", className: (0, f.default)(u, b) }), c && m.default.createElement(v.default, { onClick: r, label: l }), i) }, t }(m.default.Component); _.propTypes = L, _.defaultProps = N, exports.default = (0, C.bsStyles)((0, t.default)(x.State), x.State.INFO, (0, C.bsClass)("alert", _)), module.exports = exports.default;
    }, { "babel-runtime/core-js/object/values": "Qujq", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "./utils/bootstrapUtils": "t+qF", "./utils/StyleConfig": "uE08", "./CloseButton": "e2xO" }], "vz5k": [function (require, module, exports) {
        var define;
        var global = arguments[3];
        var e, r = arguments[3]; !function (t) { if ("object" == typeof exports && "undefined" != typeof module) module.exports = t(); else if ("function" == typeof e && e.amd) e([], t); else { var s; "undefined" != typeof window ? s = window : void 0 !== r ? s = r : "undefined" != typeof self && (s = self), s.sbjs = t() } }(function () { return function e(r, t, s) { function i(n, o) { if (!t[n]) { if (!r[n]) { var c = "function" == typeof require && require; if (!o && c) return c(n, !0); if (a) return a(n, !0); var u = new Error("Cannot find module '" + n + "'"); throw u.code = "MODULE_NOT_FOUND", u } var p = t[n] = { exports: {} }; r[n][0].call(p.exports, function (e) { var t = r[n][1][e]; return i(t || e) }, p, p.exports, e, r, t, s) } return t[n].exports } for (var a = "function" == typeof require && require, n = 0; n < s.length; n++)i(s[n]); return i }({ 1: [function (e, r, t) { "use strict"; var s = e("./init"), i = { init: function (e) { this.get = s(e), e && e.callback && "function" == typeof e.callback && e.callback(this.get) } }; r.exports = i }, { "./init": 6 }], 2: [function (e, r, t) { "use strict"; var s = e("./terms"), i = e("./helpers/utils"), a = { containers: { current: "sbjs_current", current_extra: "sbjs_current_add", first: "sbjs_first", first_extra: "sbjs_first_add", session: "sbjs_session", udata: "sbjs_udata", promocode: "sbjs_promo" }, service: { migrations: "sbjs_migrations" }, delimiter: "|||", aliases: { main: { type: "typ", source: "src", medium: "mdm", campaign: "cmp", content: "cnt", term: "trm" }, extra: { fire_date: "fd", entrance_point: "ep", referer: "rf" }, session: { pages_seen: "pgs", current_page: "cpg" }, udata: { visits: "vst", ip: "uip", agent: "uag" }, promo: "code" }, pack: { main: function (e) { return a.aliases.main.type + "=" + e.type + a.delimiter + a.aliases.main.source + "=" + e.source + a.delimiter + a.aliases.main.medium + "=" + e.medium + a.delimiter + a.aliases.main.campaign + "=" + e.campaign + a.delimiter + a.aliases.main.content + "=" + e.content + a.delimiter + a.aliases.main.term + "=" + e.term }, extra: function (e) { return a.aliases.extra.fire_date + "=" + i.setDate(new Date, e) + a.delimiter + a.aliases.extra.entrance_point + "=" + document.location.href + a.delimiter + a.aliases.extra.referer + "=" + (document.referrer || s.none) }, user: function (e, r) { return a.aliases.udata.visits + "=" + e + a.delimiter + a.aliases.udata.ip + "=" + r + a.delimiter + a.aliases.udata.agent + "=" + navigator.userAgent }, session: function (e) { return a.aliases.session.pages_seen + "=" + e + a.delimiter + a.aliases.session.current_page + "=" + document.location.href }, promo: function (e) { return a.aliases.promo + "=" + i.setLeadingZeroToInt(i.randomInt(e.min, e.max), e.max.toString().length) } } }; r.exports = a }, { "./helpers/utils": 5, "./terms": 9 }], 3: [function (e, r, t) { "use strict"; var s = e("../data").delimiter; r.exports = { encodeData: function (e) { return encodeURIComponent(e).replace(/\!/g, "%21").replace(/\~/g, "%7E").replace(/\*/g, "%2A").replace(/\'/g, "%27").replace(/\(/g, "%28").replace(/\)/g, "%29") }, decodeData: function (e) { try { return decodeURIComponent(e).replace(/\%21/g, "!").replace(/\%7E/g, "~").replace(/\%2A/g, "*").replace(/\%27/g, "'").replace(/\%28/g, "(").replace(/\%29/g, ")") } catch (r) { try { return unescape(e) } catch (t) { return "" } } }, set: function (e, r, t, s, i) { var a, n; if (t) { var o = new Date; o.setTime(o.getTime() + 60 * t * 1e3), a = "; expires=" + o.toGMTString() } else a = ""; n = s && !i ? ";domain=." + s : "", document.cookie = this.encodeData(e) + "=" + this.encodeData(r) + a + n + "; path=/" }, get: function (e) { for (var r = this.encodeData(e) + "=", t = document.cookie.split(";"), s = 0; s < t.length; s++) { for (var i = t[s]; " " === i.charAt(0);)i = i.substring(1, i.length); if (0 === i.indexOf(r)) return this.decodeData(i.substring(r.length, i.length)) } return null }, destroy: function (e, r, t) { this.set(e, "", -1, r, t) }, parse: function (e) { var r = [], t = {}; if ("string" == typeof e) r.push(e); else for (var i in e) e.hasOwnProperty(i) && r.push(e[i]); for (var a = 0; a < r.length; a++) { var n; t[this.unsbjs(r[a])] = {}, n = this.get(r[a]) ? this.get(r[a]).split(s) : []; for (var o = 0; o < n.length; o++) { var c = n[o].split("="), u = c.splice(0, 1); u.push(c.join("=")), t[this.unsbjs(r[a])][u[0]] = this.decodeData(u[1]) } } return t }, unsbjs: function (e) { return e.replace("sbjs_", "") } } }, { "../data": 2 }], 4: [function (e, r, t) { "use strict"; r.exports = { parse: function (e) { for (var r = this.parseOptions, t = r.parser[r.strictMode ? "strict" : "loose"].exec(e), s = {}, i = 14; i--;)s[r.key[i]] = t[i] || ""; return s[r.q.name] = {}, s[r.key[12]].replace(r.q.parser, function (e, t, i) { t && (s[r.q.name][t] = i) }), s }, parseOptions: { strictMode: !1, key: ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"], q: { name: "queryKey", parser: /(?:^|&)([^&=]*)=?([^&]*)/g }, parser: { strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/, loose: /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/ } }, getParam: function (e) { for (var r = {}, t = (e || window.location.search.substring(1)).split("&"), s = 0; s < t.length; s++) { var i = t[s].split("="); if (void 0 === r[i[0]]) r[i[0]] = i[1]; else if ("string" == typeof r[i[0]]) { var a = [r[i[0]], i[1]]; r[i[0]] = a } else r[i[0]].push(i[1]) } return r }, getHost: function (e) { return this.parse(e).host.replace("www.", "") } } }, {}], 5: [function (e, r, t) { "use strict"; r.exports = { escapeRegexp: function (e) { return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&") }, setDate: function (e, r) { var t = e.getTimezoneOffset() / 60, s = e.getHours(), i = r || 0 === r ? r : -t; return e.setHours(s + t + i), e.getFullYear() + "-" + this.setLeadingZeroToInt(e.getMonth() + 1, 2) + "-" + this.setLeadingZeroToInt(e.getDate(), 2) + " " + this.setLeadingZeroToInt(e.getHours(), 2) + ":" + this.setLeadingZeroToInt(e.getMinutes(), 2) + ":" + this.setLeadingZeroToInt(e.getSeconds(), 2) }, setLeadingZeroToInt: function (e, r) { for (var t = e + ""; t.length < r;)t = "0" + t; return t }, randomInt: function (e, r) { return Math.floor(Math.random() * (r - e + 1)) + e } } }, {}], 6: [function (e, r, t) { "use strict"; var s = e("./data"), i = e("./terms"), a = e("./helpers/cookies"), n = e("./helpers/uri"), o = e("./helpers/utils"), c = e("./params"), u = e("./migrations"); r.exports = function (e) { var r, t, p, f, l, m, g, d, h, v = c.fetch(e), y = n.getParam(), _ = v.domain.host, x = v.domain.isolate, b = v.lifetime; function k(e) { switch (e) { case i.traffic.utm: r = i.traffic.utm, t = void 0 !== y.utm_source ? y.utm_source : void 0 !== y.gclid ? "google" : void 0 !== y.yclid ? "yandex" : i.none, p = void 0 !== y.utm_medium ? y.utm_medium : void 0 !== y.gclid ? "cpc" : void 0 !== y.yclid ? "cpc" : i.none, f = void 0 !== y.utm_campaign ? y.utm_campaign : void 0 !== y[v.campaign_param] ? y[v.campaign_param] : void 0 !== y.gclid ? "google_cpc" : void 0 !== y.yclid ? "yandex_cpc" : i.none, l = y.utm_content || i.none, m = function () { var e = document.referrer; if (y.utm_term) return y.utm_term; if (!(e && n.parse(e).host && n.parse(e).host.match(/^(?:.*\.)?yandex\..{2,9}$/i))) return !1; try { return n.getParam(n.parse(document.referrer).query).text } catch (r) { return !1 } }() || i.none; break; case i.traffic.organic: r = i.traffic.organic, t = t || n.getHost(document.referrer), p = i.referer.organic, f = i.none, l = i.none, m = i.none; break; case i.traffic.referral: r = i.traffic.referral, t = t || n.getHost(document.referrer), p = p || i.referer.referral, f = i.none, l = n.parse(document.referrer).path, m = i.none; break; case i.traffic.typein: r = i.traffic.typein, t = v.typein_attributes.source, p = v.typein_attributes.medium, f = i.none, l = i.none, m = i.none; break; default: r = i.oops, t = i.oops, p = i.oops, f = i.oops, l = i.oops, m = i.oops }var a = { type: r, source: t, medium: p, campaign: f, content: l, term: m }; return s.pack.main(a) } function w(e) { var r = document.referrer; switch (e) { case i.traffic.organic: return !!r && q(r) && function (e) { var r = new RegExp("^(?:.*\\.)?" + o.escapeRegexp("yandex") + "\\..{2,9}$"), s = new RegExp(".*" + o.escapeRegexp("text") + "=.*"), i = new RegExp("^(?:www\\.)?" + o.escapeRegexp("google") + "\\..{2,9}$"); if (n.parse(e).query && n.parse(e).host.match(r) && n.parse(e).query.match(s)) return t = "yandex", !0; if (n.parse(e).host.match(i)) return t = "google", !0; if (!n.parse(e).query) return !1; for (var a = 0; a < v.organics.length; a++) { if (n.parse(e).host.match(new RegExp("^(?:.*\\.)?" + o.escapeRegexp(v.organics[a].host) + "$", "i")) && n.parse(e).query.match(new RegExp(".*" + o.escapeRegexp(v.organics[a].param) + "=.*", "i"))) return t = v.organics[a].display || v.organics[a].host, !0; if (a + 1 === v.organics.length) return !1 } }(r); case i.traffic.referral: return !!r && q(r) && function (e) { if (!(v.referrals.length > 0)) return t = n.getHost(e), !0; for (var r = 0; r < v.referrals.length; r++) { if (n.parse(e).host.match(new RegExp("^(?:.*\\.)?" + o.escapeRegexp(v.referrals[r].host) + "$", "i"))) return t = v.referrals[r].display || v.referrals[r].host, p = v.referrals[r].medium || i.referer.referral, !0; if (r + 1 === v.referrals.length) return t = n.getHost(e), !0 } }(r); default: return !1 } } function q(e) { if (v.domain) { if (x) return n.getHost(e) !== n.getHost(_); var r = new RegExp("^(?:.*\\.)?" + o.escapeRegexp(_) + "$", "i"); return !n.getHost(e).match(r) } return n.getHost(e) !== n.getHost(document.location.href) } function I() { a.set(s.containers.current_extra, s.pack.extra(v.timezone_offset), b, _, x), a.get(s.containers.first_extra) || a.set(s.containers.first_extra, s.pack.extra(v.timezone_offset), b, _, x) } return u.go(b, _, x), a.set(s.containers.current, function () { var e; if (void 0 !== y.utm_source || void 0 !== y.utm_medium || void 0 !== y.utm_campaign || void 0 !== y.utm_content || void 0 !== y.utm_term || void 0 !== y.gclid || void 0 !== y.yclid || void 0 !== y[v.campaign_param]) I(), e = k(i.traffic.utm); else if (w(i.traffic.organic)) I(), e = k(i.traffic.organic); else if (!a.get(s.containers.session) && w(i.traffic.referral)) I(), e = k(i.traffic.referral); else { if (a.get(s.containers.first) || a.get(s.containers.current)) return a.get(s.containers.current); I(), e = k(i.traffic.typein) } return e }(), b, _, x), a.get(s.containers.first) || a.set(s.containers.first, a.get(s.containers.current), b, _, x), a.get(s.containers.udata) ? (g = parseInt(a.parse(s.containers.udata)[a.unsbjs(s.containers.udata)][s.aliases.udata.visits]) || 1, g = a.get(s.containers.session) ? g : g + 1, d = s.pack.user(g, v.user_ip)) : (g = 1, d = s.pack.user(g, v.user_ip)), a.set(s.containers.udata, d, b, _, x), a.get(s.containers.session) ? (h = parseInt(a.parse(s.containers.session)[a.unsbjs(s.containers.session)][s.aliases.session.pages_seen]) || 1, h += 1) : h = 1, a.set(s.containers.session, s.pack.session(h), v.session_length, _, x), v.promocode && !a.get(s.containers.promocode) && a.set(s.containers.promocode, s.pack.promo(v.promocode), b, _, x), a.parse(s.containers) } }, { "./data": 2, "./helpers/cookies": 3, "./helpers/uri": 4, "./helpers/utils": 5, "./migrations": 7, "./params": 8, "./terms": 9 }], 7: [function (e, r, t) { "use strict"; var s = e("./data"), i = e("./helpers/cookies"); r.exports = { go: function (e, r, t) { var a, n = this.migrations, o = { l: e, d: r, i: t }; if (i.get(s.containers.first) || i.get(s.service.migrations)) { if (!i.get(s.service.migrations)) for (a = 0; a < n.length; a++)n[a].go(n[a].id, o) } else { var c = []; for (a = 0; a < n.length; a++)c.push(n[a].id); var u = ""; for (a = 0; a < c.length; a++)u += c[a] + "=1", a < c.length - 1 && (u += s.delimiter); i.set(s.service.migrations, u, o.l, o.d, o.i) } }, migrations: [{ id: "1418474375998", version: "1.0.0-beta", go: function (e, r) { var t = e + "=1", a = e + "=0", n = function (e, r, t) { return r || t ? e : s.delimiter }; try { var o = []; for (var c in s.containers) s.containers.hasOwnProperty(c) && o.push(s.containers[c]); for (var u = 0; u < o.length; u++)if (i.get(o[u])) { var p = i.get(o[u]).replace(/(\|)?\|(\|)?/g, n); i.destroy(o[u], r.d, r.i), i.destroy(o[u], r.d, !r.i), i.set(o[u], p, r.l, r.d, r.i) } i.get(s.containers.session) && i.set(s.containers.session, s.pack.session(0), r.l, r.d, r.i), i.set(s.service.migrations, t, r.l, r.d, r.i) } catch (f) { i.set(s.service.migrations, a, r.l, r.d, r.i) } } }] } }, { "./data": 2, "./helpers/cookies": 3 }], 8: [function (e, r, t) { "use strict"; var s = e("./terms"), i = e("./helpers/uri"); r.exports = { fetch: function (e) { var r = e || {}, t = {}; if (t.lifetime = this.validate.checkFloat(r.lifetime) || 6, t.lifetime = parseInt(30 * t.lifetime * 24 * 60), t.session_length = this.validate.checkInt(r.session_length) || 30, t.timezone_offset = this.validate.checkInt(r.timezone_offset), t.campaign_param = r.campaign_param || !1, t.user_ip = r.user_ip || s.none, r.promocode ? (t.promocode = {}, t.promocode.min = parseInt(r.promocode.min) || 1e5, t.promocode.max = parseInt(r.promocode.max) || 999999) : t.promocode = !1, r.typein_attributes && r.typein_attributes.source && r.typein_attributes.medium ? (t.typein_attributes = {}, t.typein_attributes.source = r.typein_attributes.source, t.typein_attributes.medium = r.typein_attributes.medium) : t.typein_attributes = { source: "(direct)", medium: "(none)" }, r.domain && this.validate.isString(r.domain) ? t.domain = { host: r.domain, isolate: !1 } : r.domain && r.domain.host ? t.domain = r.domain : t.domain = { host: i.getHost(document.location.hostname), isolate: !1 }, t.referrals = [], r.referrals && r.referrals.length > 0) for (var a = 0; a < r.referrals.length; a++)r.referrals[a].host && t.referrals.push(r.referrals[a]); if (t.organics = [], r.organics && r.organics.length > 0) for (var n = 0; n < r.organics.length; n++)r.organics[n].host && r.organics[n].param && t.organics.push(r.organics[n]); return t.organics.push({ host: "bing.com", param: "q", display: "bing" }), t.organics.push({ host: "yahoo.com", param: "p", display: "yahoo" }), t.organics.push({ host: "about.com", param: "q", display: "about" }), t.organics.push({ host: "aol.com", param: "q", display: "aol" }), t.organics.push({ host: "ask.com", param: "q", display: "ask" }), t.organics.push({ host: "globososo.com", param: "q", display: "globo" }), t.organics.push({ host: "go.mail.ru", param: "q", display: "go.mail.ru" }), t.organics.push({ host: "rambler.ru", param: "query", display: "rambler" }), t.organics.push({ host: "tut.by", param: "query", display: "tut.by" }), t.referrals.push({ host: "t.co", display: "twitter.com" }), t.referrals.push({ host: "plus.url.google.com", display: "plus.google.com" }), t }, validate: { checkFloat: function (e) { return !(!e || !this.isNumeric(parseFloat(e))) && parseFloat(e) }, checkInt: function (e) { return !(!e || !this.isNumeric(parseInt(e))) && parseInt(e) }, isNumeric: function (e) { return !isNaN(e) }, isString: function (e) { return "[object String]" === Object.prototype.toString.call(e) } } } }, { "./helpers/uri": 4, "./terms": 9 }], 9: [function (e, r, t) { "use strict"; r.exports = { traffic: { utm: "utm", organic: "organic", referral: "referral", typein: "typein" }, referer: { referral: "referral", organic: "organic", social: "social" }, none: "(none)", oops: "(Houston, we have a problem)" } }, {}] }, {}, [1])(1) });
    }, {}], "Wk4j": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = exports.State = void 0; var e = require("mobx"), t = r(require("axios")), o = r(require("../Utils")), n = r(require("sourcebuster")); function r(e) { return e && e.__esModule ? e : { default: e } } function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { for (var o = 0; o < t.length; o++) { var n = t[o]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function c(e, t, o) { return t && s(e.prototype, t), o && s(e, o), e } function u(e) { return (u = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var a, l = function (e, t, o, n) { var r, i = arguments.length, s = i < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, o) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : u(Reflect)) && "function" == typeof Reflect.decorate) s = Reflect.decorate(e, t, o, n); else for (var c = e.length - 1; c >= 0; c--)(r = e[c]) && (s = (i < 3 ? r(s) : i > 3 ? r(t, o, s) : r(t, o)) || s); return i > 3 && s && Object.defineProperty(t, o, s), s }; try { n.default && n.default.init({ lifetime: 6 }) } catch (d) { console.log("failed to init", d) } exports.State = a, function (e) { e[e.None = 0] = "None", e[e.Pending = 1] = "Pending", e[e.Done = 2] = "Done", e[e.Error = 3] = "Error" }(a || (exports.State = a = {})); var f = function () { function e(t) { i(this, e), this.state = a.None, this.shed = t.shed, this.customer = t.customer } return c(e, [{ key: "toJson", value: function () { var e = this.customer.toJson(); return ["mezzanineFloor", "shedSeal", "insulateRoof", "insulateWalls"].forEach(function (t) { e[t] = 1 == e[t] ? "yes" : "no" }), { shed: this.shed.toJson(), customer: e } } }, { key: "request", value: function () { var e = this; this.state = a.Pending; var r = this.shed, i = this.toJson(), s = function () { t.default.post("/request-quote.php", i).then(function () { e.state = a.Done }).catch(function (t) { e.state = a.Error, console.error(t) }) }; r.save().then(function (e) { var t = e.writeId, r = e.revision, c = o.default.getUrl(), u = "".concat(c, "/#").concat(t, "/").concat(r); Object.assign(i.customer, { webshedUrl: u }), n.default && Object.assign(i.customer, o.default.flattenObject({ _ref: n.default.get || {} })), s() }).catch(function (e) { console.log("err", e), s() }).finally(function () { if (window.gtag_report_conversion) try { console.log("reporting"), window.gtag_report_conversion() } catch (d) { console.log("failed to report") } }) } }]), e }(); exports.default = f, l([e.observable], f.prototype, "customer", void 0), l([e.observable], f.prototype, "shed", void 0), l([e.observable], f.prototype, "state", void 0);
    }, { "mobx": "6uYi", "axios": "dZBD", "../Utils": "r8Tc", "sourcebuster": "vz5k" }], "BiVZ": [function (require, module, exports) {
        "use strict"; var i; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0, function (i) { i.Gable = "Gable", i.SkillionRight = "Skillion Right", i.SkillionLeft = "Skillion Left", i.AmericanBarn = "American Barn", i.AustralianBarn = "Australian Barn", i.SkillionBarn = "Skillion Barn" }(i || (i = {})); var l = i; exports.default = l;
    }, {}], "sMkg": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = a(require("react")), e = require("mobx"), o = require("mobx-react"), r = u(require("../../../components/form/Form")), i = u(require("../../../Utils")), n = u(require("../../../types/ShedType")); function u(t) { return t && t.__esModule ? t : { default: t } } function a(t) { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var o in t) if (Object.prototype.hasOwnProperty.call(t, o)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(t, o) : {}; r.get || r.set ? Object.defineProperty(e, o, r) : e[o] = t[o] } return e.default = t, e } function c(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } function f(t, e) { for (var o = 0; o < e.length; o++) { var r = e[o]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } function m(t, e, o) { return e && f(t.prototype, e), o && f(t, o), t } function s(t, e) { return !e || "object" !== d(e) && "function" != typeof e ? l(t) : e } function l(t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t } function p(t) { return (p = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t) })(t) } function h(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && y(t, e) } function y(t, e) { return (y = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t })(t, e) } function d(t) { return (d = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(t) } var b = function (t, e, o, r) { var i, n = arguments.length, u = n < 3 ? e : null === r ? r = Object.getOwnPropertyDescriptor(e, o) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : d(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(t, e, o, r); else for (var a = t.length - 1; a >= 0; a--)(i = t[a]) && (u = (n < 3 ? i(u) : n > 3 ? i(e, o, u) : i(e, o)) || u); return n > 3 && u && Object.defineProperty(e, o, u), u }, g = { length: { "ui:widget": "range", "ui:options": { step: 1 } }, width: { "ui:widget": "range", "ui:options": { step: 1 } }, customRoofPitch: { "ui:widget": "range", "ui:options": { step: 1 } }, height: { "ui:widget": "range", "ui:options": { step: .5 } }, baySizes: { items: { "ui:widget": "range", "ui:options": { step: .2 } } } }, P = function (o) { function u(t, e) { var o; return c(this, u), (o = s(this, p(u).call(this, t, e))).state = {}, o } return h(u, t.Component), m(u, [{ key: "render", value: function () { var o = this, i = this.props.shed, u = { type: "array", title: "Bay Sizes (m)", minItems: 1, items: { type: "number", default: 4, minimum: i.minBaySize, maximum: i.maxBaySize } }, a = i.maxLength, c = i.minLength, f = i.maxWidth, m = i.minWidth, s = i.maxHeight, l = i.minHeight, p = { type: "string", title: "Roof Pitch", default: 11, enum: ["5", "11", "22", "-1"], enumNames: ["5", "11", "22", "Custom"] }, h = { type: "number", title: "Custom Roof Pitch", minimum: i.minRoofPitch, maximum: i.maxRoofPitch, default: 11 }, y = { shedType: { type: "string", title: "Roof Type", default: n.default.Gable, enum: Object.values(n.default) }, roofPitch: p, customRoofPitch: h, length: { title: "Length (m)", type: "number", minimum: c, maximum: a }, width: { title: "Width (m)", type: "number", minimum: m, maximum: f }, height: { title: "Height (m)", type: "number", minimum: l, maximum: s }, customBaySize: { type: "boolean", title: "Custom Bay Sizes" } }, d = i.roofPitch; this.state.customRoofPitch || !p.enum.includes(d.toString()) ? d = -1 : delete y.customRoofPitch, i.customBaySize && (y.baySizes = (0, e.toJS)(u)); var b = { type: "object", properties: y }, P = { formData: { roofPitch: d.toString(), customRoofPitch: (0, e.toJS)(i.roofPitch), shedType: (0, e.toJS)(i.shedType), width: (0, e.toJS)(i.width), height: (0, e.toJS)(i.height), length: (0, e.toJS)(i.length), customBaySize: (0, e.toJS)(i.customBaySize), baySizes: (0, e.toJS)(i.baySizes) }, schema: b, onChange: function (t) { t.formData.roofPitch = parseFloat(t.formData.roofPitch), o.setState({ customRoofPitch: -1 === t.formData.roofPitch }), -1 === t.formData.roofPitch && (t.formData.roofPitch = t.formData.customRoofPitch || d), o.onFormChange(t) } }; return t.createElement(r.default, Object.assign({}, P, { uiSchema: g })) } }, { key: "onFormChange", value: function (t) { var o = this; if (0 === t.errors.length) { var r = t.formData; (0, e.transaction)(function () { i.default.setObjectDelta(o.props.shed, r) }) } } }]), u }(), S = P = b([o.observer], P); exports.default = S;
    }, { "react": "1n8/", "mobx": "6uYi", "mobx-react": "lQiT", "../../../components/form/Form": "I4f+", "../../../Utils": "r8Tc", "../../../types/ShedType": "BiVZ" }], "buGj": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) { var n = arguments[t]; for (var r in n) Object.prototype.hasOwnProperty.call(n, r) && (e[r] = n[r]) } return e }, t = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } return function (t, n, r) { return n && e(t.prototype, n), r && e(t, r), t } }(), n = require("react"), r = c(n), i = require("prop-types"), l = c(i), a = require("classnames"), s = c(a); function c(e) { return e && e.__esModule ? e : { default: e } } function o(e, t, n) { return t in e ? Object.defineProperty(e, t, { value: n, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = n, e } function u(e, t) { var n = {}; for (var r in e) t.indexOf(r) >= 0 || Object.prototype.hasOwnProperty.call(e, r) && (n[r] = e[r]); return n } function f(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function p(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function d(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var g = { title: /<title>.*<\/title>/gi, desc: /<desc>.*<\/desc>/gi, comment: /<!--.*-->/gi, defs: /<defs>.*<\/defs>/gi, width: / +width="\d+(\.\d+)?(px)?"/gi, height: / +height="\d+(\.\d+)?(px)?"/gi, fill: / +fill="(none|#[0-9a-f]+)"/gi, sketchMSShapeGroup: / +sketch:type="MSShapeGroup"/gi, sketchMSPage: / +sketch:type="MSPage"/gi, sketchMSLayerGroup: / +sketch:type="MSLayerGroup"/gi }, h = function (i) { function l() { return f(this, l), p(this, (l.__proto__ || Object.getPrototypeOf(l)).apply(this, arguments)) } return d(l, n.Component), t(l, [{ key: "render", value: function () { var t = this.props, n = t.className, i = t.component, a = t.svg, c = t.fill, f = t.width, p = t.accessibilityLabel, d = t.accessibilityDesc, h = t.classSuffix, y = t.cleanupExceptions, b = u(t, ["className", "component", "svg", "fill", "width", "accessibilityLabel", "accessibilityDesc", "classSuffix", "cleanupExceptions"]), v = this.props, O = v.cleanup, m = v.height; (!0 === O || 0 === O.length && y.length > 0) && (O = Object.keys(g)), O = O.filter(function (e) { return !(y.indexOf(e) > -1) }), f && void 0 === m && (m = f), delete b.cleanup, delete b.height; var x = (0, s.default)(o({ SVGInline: !0, "SVGInline--cleaned": O.length }, n, n)), S = x.split(" ").join(h + " ") + h, w = l.cleanupSvg(a, O).replace(/<svg/, '<svg class="' + S + '"' + (c ? ' fill="' + c + '"' : "") + (f || m ? ' style="' + (f ? "width: " + f + ";" : "") + (m ? "height: " + m + ";" : "") + '"' : "")), j = void 0; if (d) { var _ = (j = /<svg(.|\n|\r\n)*?>/.exec(w)).index + j[0].length; w = w.substr(0, _) + "<desc>" + d + "</desc>" + w.substr(_) } if (p) { var P = (j = j || /<svg(.|\n|\r\n)*?>/.exec(w)).index + j[0].length - 1, k = "SVGInline-" + l.idCount++ + "-title"; w = w.substr(0, P) + ' role="img" aria-labelledby="' + k + '"' + w.substr(P, 1) + '<title id="' + k + '">' + p + "</title>" + w.substr(P + 1) } return r.default.createElement(i, e({}, b, { className: x, dangerouslySetInnerHTML: { __html: w } })) } }]), l }(); h.propTypes = { className: l.default.string, classSuffix: l.default.string, component: l.default.oneOfType([l.default.string, l.default.func]), svg: l.default.string.isRequired, fill: l.default.string, cleanup: l.default.oneOfType([l.default.bool, l.default.array]), cleanupExceptions: l.default.array, width: l.default.string, height: l.default.string, accessibilityLabel: l.default.string, accessibilityDesc: l.default.string }, h.defaultProps = { component: "span", classSuffix: "-svg", cleanup: [], cleanupExceptions: [] }, h.idCount = 0, h.cleanupSvg = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : []; return Object.keys(g).filter(function (e) { return t.indexOf(e) > -1 }).reduce(function (e, t) { return e.replace(g[t], "") }, e).trim() }, exports.default = h;
    }, { "react": "1n8/", "prop-types": "5D9O", "classnames": "9qb7" }], "Ggjz": [function (require, module, exports) {
        module.exports = '<svg width="24" height="24" viewBox="0 0 24 24"><path d="M12.449 4.63a1.97 1.97 0 0 0-2.761 0l-7.743 7.747a1.973 1.973 0 0 0 0 2.764l7.743 7.747a1.97 1.97 0 0 0 2.76 0l7.743-7.747a1.973 1.973 0 0 0 0-2.764zm-1.38 1.448l7.675 7.681-7.676 7.681-7.676-7.68z"/><path d="M8.365.548L6.951 1.962l.707.707 5.906 5.906.707.707 1.415-1.414-.707-.707-5.907-5.906zM3.693 14.821h14.813l-7.453 7.453zM22.382 20.975a1.86 1.86 0 1 1-3.72 0c0-1.027 1.86-4.355 1.86-4.355s1.86 3.328 1.86 4.355z"/></svg>'
    }, {}], "8K9W": [function (require, module, exports) {
        module.exports = '<svg width="24" height="24" viewBox="0 0 24 24"><path d="M4.734.874a1 1 0 0 0-1 1v20.252a1 1 0 0 0 1 1h14.532a1 1 0 0 0 1-1V1.874a1 1 0 0 0-1-1zm1 2h12.532v18.252H5.734z"/><path d="M7.557 16.894a.963.963 0 0 0-.963.963v.18a.963.963 0 0 0 .963.962h8.886a.963.963 0 0 0 .963-.963v-.18a.963.963 0 0 0-.963-.962zM7.557 12.894a.963.963 0 0 0-.963.963v.18a.963.963 0 0 0 .963.962h8.886a.963.963 0 0 0 .963-.963v-.18a.963.963 0 0 0-.963-.962zM7.557 8.894a.963.963 0 0 0-.963.963v.18a.963.963 0 0 0 .963.962h8.886a.963.963 0 0 0 .963-.963v-.18a.963.963 0 0 0-.963-.962zM7.5 4.894a.907.907 0 0 0-.906.906v.293a.907.907 0 0 0 .906.906h4.873a.907.907 0 0 0 .906-.906V5.8a.907.907 0 0 0-.906-.906z"/></svg>'
    }, {}], "jlLt": [function (require, module, exports) {
        module.exports = '<svg width="24" height="24" viewBox="0 0 24 24"><g transform="translate(.298 -1027.945)"><path d="M16.84 1032.82a13.835 13.835 0 0 1 2.483 5.103h.122c.725 0 1.31-.584 1.31-1.31v-2.483c0-.725-.585-1.31-1.31-1.31z"/><rect ry="1.135" y="1044.661" x="8.47" height="3.98" width="14.864"/><ellipse ry="9.099" rx="9.099" cy="1039.545" cx="9.154"/><ellipse ry="5.811" rx="5.811" cy="1039.604" cx="9.194" stroke="#fff" stroke-width="1.99"/><rect ry=".902" y="1038.955" x="16.413" height="8.24" width="1.804"/><rect ry=".902" y="1046.515" x="21.078" height="3.7" width="2.27"/></g></svg>'
    }, {}], "WSzj": [function (require, module, exports) {
        module.exports = '<svg width="24" height="24" viewBox="0 0 24 24"><path d="M.639 4.1v17.583h1.67V4.1zM5.469 3.46v18.135h1.674V3.46zM8.973 3.493V21.55h1.672V3.493zM13.78 3.73v17.894h1.663V3.73zM17.002 3.491V21.55h1.67V3.491zM21.719 4.062v17.576h1.642V4.062z"/><path d="M2.169 1.464l-.073.125L.64 4.106l1.496.649L3.17 2.964h1.342l1.334 2h4.225l1.334-2h1.197l1.334 2h4.225l1.334-2h1.197l1.215 1.822 1.453-.725-1.732-2.597h-3.069l-1.334 2h-2.353l-1.334-2h-3.069l-1.334 2H6.782l-1.334-2zM2.169 19.036l-.072.125L.64 21.68l1.496.648 1.035-1.79h1.342l1.334 2h4.224l1.334-2h1.198l1.334 2h4.224l1.334-2h1.197l1.215 1.822 1.453-.725-1.732-2.598H18.56l-1.334 2h-2.354l-1.334-2H10.47l-1.334 2H6.782l-1.334-2z"/></svg>'
    }, {}], "q8Ei": [function (require, module, exports) {
        module.exports = '<svg width="24" height="24" viewBox="0 0 24 24"><path d="M.408 2.91v18.18h23.184V2.91zm2 2h19.184v14.18H2.408z"/><path d="M11 3.892V20.243h2V3.892z"/></svg>'
    }, {}], "W6O4": [function (require, module, exports) {
        module.exports = '<svg width="100" height="10" viewBox="0 0 26.458 2.646"><g fill="none" stroke="#000" stroke-width=".265"><path d="M1.635 1.323s.747.953 1.493 0c.747-.954 1.493 0 1.493 0M4.621 1.323s.747.953 1.493 0c.747-.954 1.493 0 1.493 0"/><path d="M7.597 1.323s.747.953 1.493 0c.747-.954 1.493 0 1.493 0M10.583 1.323s.747.953 1.493 0c.747-.954 1.493 0 1.493 0"/><path d="M13.55 1.323s.746.953 1.492 0c.747-.954 1.493 0 1.493 0M16.535 1.323s.747.953 1.493 0c.747-.954 1.493 0 1.493 0"/><path d="M19.511 1.323s.747.953 1.493 0c.747-.954 1.493 0 1.493 0M22.497 1.323s.747.953 1.493 0c.747-.954 1.493 0 1.493 0"/></g></svg>'
    }, {}], "bnin": [function (require, module, exports) {
        module.exports = '<svg width="100" height="10" viewBox="0 0 26.458 2.646"><g fill="none" stroke="#000" stroke-width=".242"><path d="M1.348 1.834c.14 0 .328-.959.468-.959h1.169c.14 0 .327.959.467.959h1.87l.235-.192h.935l.234.192h1.87M8.596 1.834c.14 0 .328-.959.468-.959h1.169c.14 0 .327.959.467.959h1.871l.234-.192h.935l.234.192h1.87"/><path d="M15.844 1.834c.14 0 .328-.959.468-.959h1.169c.14 0 .327.959.468.959h1.87l.234-.192h.935l.234.192h1.87"/><path d="M23.092 1.834c.14 0 .328-.959.468-.959h1.169c.14 0 .327.959.468.959l.32-.008"/></g></svg>'
    }, {}], "hCBT": [function (require, module, exports) {
        module.exports = '<svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 2v20h3V5.95L21 9V6z"/><path d="M16.012 7.646L16 22h3l.012-14.356z"/></svg>'
    }, {}], "3KV/": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = s(require("./paint.svgi")), r = s(require("./quote.svgi")), t = s(require("./tape.svgi")), u = s(require("./wall.svgi")), i = s(require("./window.svgi")), a = s(require("./corrugated.svgi")), d = s(require("./trimdek.svgi")), l = s(require("./awning.svgi")); function s(e) { return e && e.__esModule ? e : { default: e } } var o = { paint: e.default, quote: r.default, tape: t.default, wall: u.default, window: i.default, corrugated: a.default, trimdek: d.default, awning: l.default }, f = o; exports.default = f;
    }, { "./paint.svgi": "Ggjz", "./quote.svgi": "8K9W", "./tape.svgi": "jlLt", "./wall.svgi": "WSzj", "./window.svgi": "q8Ei", "./corrugated.svgi": "W6O4", "./trimdek.svgi": "bnin", "./awning.svgi": "hCBT" }], "YIMX": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = o; var e = i(require("react")), t = n(require("react-svg-inline")), r = n(require("./icons")); function n(e) { return e && e.__esModule ? e : { default: e } } function i(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function o(n) { var i = n.name, o = n.width, u = n.height, a = void 0 === u ? "" : u, c = r.default[i]; return e.createElement("span", null, e.createElement(t.default, { className: "icon", width: o, heigth: a, svg: c })) }
    }, { "react": "1n8/", "react-svg-inline": "buGj", "./icons": "3KV/" }], "kHbh": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = h(require("react")), t = require("mobx"), n = require("mobx-react"), r = g(require("./forms/Grid")), i = g(require("../../components/form/Form")), o = g(require("../../Utils")), a = g(require("../../types/Sheeting")), l = g(require("../../stores/Colours")), u = g(require("../../stores/editorStates/States")), s = g(require("./forms/Extras")), c = g(require("../../components/tab/Tab")), f = g(require("../../components/tab/Tabs")), m = require("../../stores/Quote"), p = g(require("./forms/Size")), d = g(require("../../components/icon/Icon")); function g(e) { return e && e.__esModule ? e : { default: e } } function h(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; r.get || r.set ? Object.defineProperty(t, n, r) : t[n] = e[n] } return t.default = e, t } function b(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function y(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function v(e, t, n) { return t && y(e.prototype, t), n && y(e, n), e } function w(e, t) { return !t || "object" !== C(t) && "function" != typeof t ? j(e) : t } function E(e) { return (E = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function S(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && O(e, t) } function O(e, t) { return (O = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function j(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function C(e) { return (C = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var q = function (e, t, n, r) { var i, o = arguments.length, a = o < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, n) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : C(Reflect)) && "function" == typeof Reflect.decorate) a = Reflect.decorate(e, t, n, r); else for (var l = e.length - 1; l >= 0; l--)(i = e[l]) && (a = (o < 3 ? i(a) : o > 3 ? i(t, n, a) : i(t, n)) || a); return o > 3 && a && Object.defineProperty(t, n, a), a }, x = require("react-bootstrap/lib/Button"), R = require("react-bootstrap/lib/Alert"); function k(t) { var n = t.title, r = t.icon; return e.createElement("span", null, e.createElement(d.default, { name: r }), " ", n) } var D = [], T = [], P = []; l.default.colours.forEach(function (e) { D.push(e.id), T.push(e.name), P.push(e.hex) }); var F = function (e) { return { title: e, type: "string", enum: D, enumNames: T, colours: P } }, _ = { Trimdek: function () { return e.createElement("div", null, e.createElement("div", null, e.createElement(d.default, { name: "trimdek", height: "20px" })), e.createElement("div", null, "Trimdek")) }, Corrugated: function () { return e.createElement("div", null, e.createElement("div", null, e.createElement(d.default, { name: "corrugated", height: "20px" })), e.createElement("div", null, "Corrugated")) } }, N = { roofSheeting: { "ui:widget": "buttonRadio", "ui:options": { labels: _ } }, wallSheeting: { "ui:widget": "buttonRadio", "ui:options": { labels: _ } }, awningRight: { heightOffset: { "ui:widget": "range", "ui:options": { step: .2 } }, length: { "ui:widget": "range", "ui:options": { step: .25 } } }, awningLeft: { heightOffset: { "ui:widget": "range", "ui:options": { step: .25 } }, length: { "ui:widget": "range" } }, models: { items: { x: { "ui:title": "X", "ui:widget": "range", "ui:options": { step: .1 } }, y: { "ui:title": "Y", "ui:widget": "range", "ui:options": { step: .1 } }, width: { "ui:title": "Width", "ui:widget": "range", "ui:options": { step: .2 } }, height: { "ui:title": "Height", "ui:widget": "range", "ui:options": { step: .2 } }, heightOffset: { "ui:title": "Height Offset", "ui:widget": "range", "ui:options": { step: .2 } } } }, baySizes: { items: { "ui:widget": "range", "ui:options": { step: .2 } } }, comment: { "ui:widget": "textarea", "ui:options": { rows: 3 } } }, z = function (n) { function l(e, t) { var n; return b(this, l), (n = w(this, E(l).call(this, e, t))).onTabSelect = n.onTabSelect.bind(j(j(n))), n.onTabClose = n.onTabClose.bind(j(j(n))), n.state = { key: 3 }, n } return S(l, e.Component), v(l, [{ key: "onTabSelect", value: function (e) { var t = this.props.editor; t.currentStateId === e ? t.set(null) : t.set(e) } }, { key: "onTabClose", value: function () { this.props.editor.set(null) } }, { key: "render", value: function () { var t = this.props, n = t.editor, i = t.shed, o = n.currentStateId, a = "vertical-tabs" + (null === o ? " tab-content-hidden" : ""); return e.createElement("div", null, e.createElement(f.default, { activeKey: o, className: a, id: "main-tabs", animation: !1, onSelect: this.onTabSelect, closeButton: !0, onClose: this.onTabClose }, e.createElement(c.default, { eventKey: u.default.Size, title: e.createElement(k, { title: "Size", icon: "tape" }) }, o === u.default.Size ? e.createElement(p.default, { shed: i }) : ""), e.createElement(c.default, { eventKey: u.default.Awnings, title: e.createElement(k, { title: "Awnings", icon: "awning" }) }, o === u.default.Awnings ? this.awning() : ""), e.createElement(c.default, { eventKey: u.default.Walls, title: e.createElement(k, { title: "Walls", icon: "wall" }) }, o === u.default.Walls ? e.createElement(r.default, { shed: i }) : ""), e.createElement(c.default, { eventKey: u.default.Extras, title: e.createElement(k, { title: "Extras", icon: "window" }) }, o === u.default.Extras ? this.extras() : ""), e.createElement(c.default, { eventKey: u.default.Colours, title: e.createElement(k, { title: "Colours", icon: "paint" }) }, o === u.default.Colours ? this.colours() : ""), e.createElement(c.default, { eventKey: u.default.Quote, title: e.createElement(k, { title: "Quote", icon: "quote" }) }, o === u.default.Quote ? this.quote() : ""))) } }, { key: "extrasForm", value: function (t) { return e.createElement(s.default, { shed: this.props.shed, sections: t }) } }, { key: "extras", value: function () { var t = this.props.editor.getCurrent(); if (t) { var n = t.editing; if (n && n.length > 0) return this.extrasForm(n) } return e.createElement("span", null, "Select a wall section to add doors and ", e.createElement("br", null), "windows. You can also select a roof section to add skylights or whirlybirds.") } }, { key: "createForm", value: function (t) { return e.createElement(i.default, Object.assign({}, t, { uiSchema: N })) } }, { key: "awning", value: function () { var e = this, n = this.props.shed, r = function (e) { var t = { visible: { type: "boolean", title: "Visible", default: !1 } }; return e.visible && Object.assign(t, { roofPitch: { type: "number", title: "Roof Pitch", default: 11, enum: [5, 11, 22] }, length: { type: "number", title: "Length (m)", minimum: 1, maximum: 6 }, heightOffset: { type: "number", title: "Height Offset (m)", minimum: 0, maximum: 3 } }), t }, i = { type: "object", properties: { awningRight: { title: "Awning " + n.getRotationText(1), type: "object", properties: r(n.awningRight) }, awningLeft: { title: "Awning " + n.getRotationText(3), type: "object", properties: r(n.awningLeft) } } }, o = { awningRight: (0, t.toJS)(n.awningRight), awningLeft: (0, t.toJS)(n.awningLeft) }; return this.createForm({ formData: o, schema: i, onChange: function (t) { e.onFormChange(t); var r = t.formData; n.setAwningRightVisible(r.awningRight.visible), n.setAwningLeftVisible(r.awningLeft.visible) } }) } }, { key: "quote", value: function () { var t = this.props.quote, n = { type: "object", properties: { firstName: { type: "string", title: "First Name" }, lastName: { type: "string", title: "Last Name" }, email: { type: "string", title: "Email", format: "email" }, phoneNumber: { type: "string", title: "Phone Number" }, address: { type: "string", title: "Build Address" }, mezzanineFloor: { type: "boolean", title: "Mezzanine Floor" }, shedSeal: { type: "boolean", title: "Shed Seal" }, insulateRoof: { type: "boolean", title: "Insulate Roof" }, insulateWalls: { type: "boolean", title: "Insulate Walls" }, comment: { type: "string", title: "Comment" } }, required: ["firstName", "email", "phoneNumber", "address"] }, r = function (e) { o.default.setObjectDelta(t.customer, e) }, a = { liveValidate: !1, formData: this.getFormData(t.customer, n), schema: n, onChange: function (e) { r(e.formData) } }, l = t.state !== m.State.None && t.state !== m.State.Error, u = null, s = function () { t.state = m.State.None }; return t.state === m.State.Error ? u = e.createElement(R, { bsStyle: "danger", onDismiss: s }, e.createElement("p", null, "Failed to submit quote, please try again. If the error persists, please try calling 08 6230 2250 or emailing Sales@RoysSheds.com.au Apologies for any inconveniences caused.")) : t.state === m.State.Done && (u = e.createElement(R, { onDismiss: s }, e.createElement("p", null, "Quote successfully submitted.")), l = !1), e.createElement("div", null, e.createElement(i.default, Object.assign({}, a, { uiSchema: N, onSubmit: function (e) { var n = e.formData; r(n), setTimeout(function () { t.request() }, 1) } }), u, e.createElement(x, { type: "submit", bsStyle: "primary", bsSize: "large", block: !0, disabled: l }, l ? "Loading..." : "Submit"))) } }, { key: "colours", value: function () { var t = this, n = this.props.shed, r = Object.values(a.default), o = { type: "object", properties: { roofColour: F("Roof Colour"), wallColour: F("Wall Colour"), flashingColour: F("Flashing Colour"), doorColour: F("Door Colour"), roofSheeting: { type: "string", title: "Roof Sheeting", enum: r }, wallSheeting: { type: "string", title: "Wall Sheeting", enum: r } } }, l = { formData: this.getFormData(n, o), schema: o, onChange: function (e) { t.onFormChange(e) } }; return e.createElement("div", null, e.createElement(i.default, Object.assign({}, l, { uiSchema: N })), e.createElement("p", null, "Please note, the colours shown here are a representation of the colours that we source. The actual colours may vary. Inspect physical samples before deciding on colours.")) } }, { key: "getFormData", value: function (e, n) { var r = Object.keys(n.properties), i = {}; return r.forEach(function (n) { i[n] = (0, t.toJS)(e[n]) }), i } }, { key: "onFormChange", value: function (e) { 0 === e.errors.length && o.default.setObjectDelta(this.props.shed, e.formData) } }]), l }(), A = z = q([(0, n.inject)("shed", "editor", "quote"), n.observer], z); exports.default = A;
    }, { "react": "1n8/", "mobx": "6uYi", "mobx-react": "lQiT", "./forms/Grid": "jy/S", "../../components/form/Form": "I4f+", "../../Utils": "r8Tc", "../../types/Sheeting": "uODF", "../../stores/Colours": "+ae8", "../../stores/editorStates/States": "wK5u", "./forms/Extras": "Pw6J", "../../components/tab/Tab": "cbd5", "../../components/tab/Tabs": "PfJX", "react-bootstrap/lib/Button": "2PkR", "react-bootstrap/lib/Alert": "VV+3", "../../stores/Quote": "Wk4j", "./forms/Size": "sMkg", "../../components/icon/Icon": "YIMX" }], "Kzmh": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), r = h(e), t = require("babel-runtime/helpers/objectWithoutProperties"), s = h(t), l = require("babel-runtime/helpers/classCallCheck"), u = h(l), a = require("babel-runtime/helpers/possibleConstructorReturn"), i = h(a), o = require("babel-runtime/helpers/inherits"), n = h(o), p = require("classnames"), b = h(p), d = require("react"), c = h(d), f = require("./utils/bootstrapUtils"); function h(e) { return e && e.__esModule ? e : { default: e } } var m = function (e) { function t() { return (0, u.default)(this, t), (0, i.default)(this, e.apply(this, arguments)) } return (0, n.default)(t, e), t.prototype.render = function () { var e = this.props, t = e.className, l = (0, s.default)(e, ["className"]), u = (0, f.splitBsProps)(l), a = u[0], i = u[1], o = (0, f.getClassSet)(a); return c.default.createElement("div", (0, r.default)({}, i, { role: "toolbar", className: (0, b.default)(t, o) })) }, t }(c.default.Component); exports.default = (0, f.bsClass)("btn-toolbar", m), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "./utils/bootstrapUtils": "t+qF" }], "jogY": [function (require, module, exports) {
        function t(n) { return (t = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(n) } module.exports = function (t) { function n(e) { if (r[e]) return r[e].exports; var o = r[e] = { i: e, l: !1, exports: {} }; return t[e].call(o.exports, o, o.exports, n), o.l = !0, o.exports } var r = {}; return n.m = t, n.c = r, n.d = function (t, r, e) { n.o(t, r) || Object.defineProperty(t, r, { configurable: !1, enumerable: !0, get: e }) }, n.n = function (t) { var r = t && t.__esModule ? function () { return t.default } : function () { return t }; return n.d(r, "a", r), r }, n.o = function (t, n) { return Object.prototype.hasOwnProperty.call(t, n) }, n.p = "", n(n.s = 13) }([function (t, n) { var r = t.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = r) }, function (n, r) { n.exports = function (n) { return "object" == t(n) ? null !== n : "function" == typeof n } }, function (t, n) { var r = t.exports = { version: "2.5.0" }; "number" == typeof __e && (__e = r) }, function (t, n, r) { t.exports = !r(4)(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a }) }, function (t, n) { t.exports = function (t) { try { return !!t() } catch (t) { return !0 } } }, function (t, n) { var r = {}.toString; t.exports = function (t) { return r.call(t).slice(8, -1) } }, function (t, n, r) { var e = r(32)("wks"), o = r(9), u = r(0).Symbol, i = "function" == typeof u; (t.exports = function (t) { return e[t] || (e[t] = i && u[t] || (i ? u : o)("Symbol." + t)) }).store = e }, function (t, n, r) { var e = r(0), o = r(2), u = r(8), i = r(22), c = r(10), f = function (t, n, r) { var a, s, p, l, y = t & f.F, v = t & f.G, h = t & f.S, d = t & f.P, x = t & f.B, m = v ? e : h ? e[n] || (e[n] = {}) : (e[n] || {}).prototype, b = v ? o : o[n] || (o[n] = {}), g = b.prototype || (b.prototype = {}); for (a in v && (r = n), r) p = ((s = !y && m && void 0 !== m[a]) ? m : r)[a], l = x && s ? c(p, e) : d && "function" == typeof p ? c(Function.call, p) : p, m && i(m, a, p, t & f.U), b[a] != p && u(b, a, l), d && g[a] != p && (g[a] = p) }; e.core = o, f.F = 1, f.G = 2, f.S = 4, f.P = 8, f.B = 16, f.W = 32, f.U = 64, f.R = 128, t.exports = f }, function (t, n, r) { var e = r(16), o = r(21); t.exports = r(3) ? function (t, n, r) { return e.f(t, n, o(1, r)) } : function (t, n, r) { return t[n] = r, t } }, function (t, n) { var r = 0, e = Math.random(); t.exports = function (t) { return "Symbol(".concat(void 0 === t ? "" : t, ")_", (++r + e).toString(36)) } }, function (t, n, r) { var e = r(24); t.exports = function (t, n, r) { if (e(t), void 0 === n) return t; switch (r) { case 1: return function (r) { return t.call(n, r) }; case 2: return function (r, e) { return t.call(n, r, e) }; case 3: return function (r, e, o) { return t.call(n, r, e, o) } }return function () { return t.apply(n, arguments) } } }, function (t, n) { t.exports = function (t) { if (null == t) throw TypeError("Can't call method on  " + t); return t } }, function (t, n, r) { var e = r(28), o = Math.min; t.exports = function (t) { return t > 0 ? o(e(t), 9007199254740991) : 0 } }, function (t, n, r) { "use strict"; n.__esModule = !0, n.default = function (t, n) { if (t && n) { var r = Array.isArray(n) ? n : n.split(","), e = t.name || "", o = t.type || "", u = o.replace(/\/.*$/, ""); return r.some(function (t) { var n = t.trim(); return "." === n.charAt(0) ? e.toLowerCase().endsWith(n.toLowerCase()) : n.endsWith("/*") ? u === n.replace(/\/.*$/, "") : o === n }) } return !0 }, r(14), r(34) }, function (t, n, r) { r(15), t.exports = r(2).Array.some }, function (t, n, r) { "use strict"; var e = r(7), o = r(25)(3); e(e.P + e.F * !r(33)([].some, !0), "Array", { some: function (t) { return o(this, t, arguments[1]) } }) }, function (t, n, r) { var e = r(17), o = r(18), u = r(20), i = Object.defineProperty; n.f = r(3) ? Object.defineProperty : function (t, n, r) { if (e(t), n = u(n, !0), e(r), o) try { return i(t, n, r) } catch (t) { } if ("get" in r || "set" in r) throw TypeError("Accessors not supported!"); return "value" in r && (t[n] = r.value), t } }, function (t, n, r) { var e = r(1); t.exports = function (t) { if (!e(t)) throw TypeError(t + " is not an object!"); return t } }, function (t, n, r) { t.exports = !r(3) && !r(4)(function () { return 7 != Object.defineProperty(r(19)("div"), "a", { get: function () { return 7 } }).a }) }, function (t, n, r) { var e = r(1), o = r(0).document, u = e(o) && e(o.createElement); t.exports = function (t) { return u ? o.createElement(t) : {} } }, function (t, n, r) { var e = r(1); t.exports = function (t, n) { if (!e(t)) return t; var r, o; if (n && "function" == typeof (r = t.toString) && !e(o = r.call(t))) return o; if ("function" == typeof (r = t.valueOf) && !e(o = r.call(t))) return o; if (!n && "function" == typeof (r = t.toString) && !e(o = r.call(t))) return o; throw TypeError("Can't convert object to primitive value") } }, function (t, n) { t.exports = function (t, n) { return { enumerable: !(1 & t), configurable: !(2 & t), writable: !(4 & t), value: n } } }, function (t, n, r) { var e = r(0), o = r(8), u = r(23), i = r(9)("src"), c = Function.toString, f = ("" + c).split("toString"); r(2).inspectSource = function (t) { return c.call(t) }, (t.exports = function (t, n, r, c) { var a = "function" == typeof r; a && (u(r, "name") || o(r, "name", n)), t[n] !== r && (a && (u(r, i) || o(r, i, t[n] ? "" + t[n] : f.join(String(n)))), t === e ? t[n] = r : c ? t[n] ? t[n] = r : o(t, n, r) : (delete t[n], o(t, n, r))) })(Function.prototype, "toString", function () { return "function" == typeof this && this[i] || c.call(this) }) }, function (t, n) { var r = {}.hasOwnProperty; t.exports = function (t, n) { return r.call(t, n) } }, function (t, n) { t.exports = function (t) { if ("function" != typeof t) throw TypeError(t + " is not a function!"); return t } }, function (t, n, r) { var e = r(10), o = r(26), u = r(27), i = r(12), c = r(29); t.exports = function (t, n) { var r = 1 == t, f = 2 == t, a = 3 == t, s = 4 == t, p = 6 == t, l = 5 == t || p, y = n || c; return function (n, c, v) { for (var h, d, x = u(n), m = o(x), b = e(c, v, 3), g = i(m.length), S = 0, _ = r ? y(n, g) : f ? y(n, 0) : void 0; g > S; S++)if ((l || S in m) && (d = b(h = m[S], S, x), t)) if (r) _[S] = d; else if (d) switch (t) { case 3: return !0; case 5: return h; case 6: return S; case 2: _.push(h) } else if (s) return !1; return p ? -1 : a || s ? s : _ } } }, function (t, n, r) { var e = r(5); t.exports = Object("z").propertyIsEnumerable(0) ? Object : function (t) { return "String" == e(t) ? t.split("") : Object(t) } }, function (t, n, r) { var e = r(11); t.exports = function (t) { return Object(e(t)) } }, function (t, n) { var r = Math.ceil, e = Math.floor; t.exports = function (t) { return isNaN(t = +t) ? 0 : (t > 0 ? e : r)(t) } }, function (t, n, r) { var e = r(30); t.exports = function (t, n) { return new (e(t))(n) } }, function (t, n, r) { var e = r(1), o = r(31), u = r(6)("species"); t.exports = function (t) { var n; return o(t) && ("function" != typeof (n = t.constructor) || n !== Array && !o(n.prototype) || (n = void 0), e(n) && null === (n = n[u]) && (n = void 0)), void 0 === n ? Array : n } }, function (t, n, r) { var e = r(5); t.exports = Array.isArray || function (t) { return "Array" == e(t) } }, function (t, n, r) { var e = r(0), o = e["__core-js_shared__"] || (e["__core-js_shared__"] = {}); t.exports = function (t) { return o[t] || (o[t] = {}) } }, function (t, n, r) { "use strict"; var e = r(4); t.exports = function (t, n) { return !!t && e(function () { n ? t.call(null, function () { }, 1) : t.call(null) }) } }, function (t, n, r) { r(35), t.exports = r(2).String.endsWith }, function (t, n, r) { "use strict"; var e = r(7), o = r(12), u = r(36), i = "".endsWith; e(e.P + e.F * r(38)("endsWith"), "String", { endsWith: function (t) { var n = u(this, t, "endsWith"), r = arguments.length > 1 ? arguments[1] : void 0, e = o(n.length), c = void 0 === r ? e : Math.min(o(r), e), f = String(t); return i ? i.call(n, f, c) : n.slice(c - f.length, c) === f } }) }, function (t, n, r) { var e = r(37), o = r(11); t.exports = function (t, n, r) { if (e(n)) throw TypeError("String#" + r + " doesn't accept regex!"); return String(o(t)) } }, function (t, n, r) { var e = r(1), o = r(5), u = r(6)("match"); t.exports = function (t) { var n; return e(t) && (void 0 !== (n = t[u]) ? !!n : "RegExp" == o(t)) } }, function (t, n, r) { var e = r(6)("match"); t.exports = function (t) { var n = /./; try { "/./"[t](n) } catch (r) { try { return n[e] = !1, !"/./"[t](n) } catch (t) { } } return !0 } }]);
    }, {}], "qiqN": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.getDataTransferItems = n, exports.fileAccepted = i, exports.fileMatchSize = u, exports.allFilesAccepted = o, exports.onDocumentDragOver = a, exports.isIeOrEdge = f, exports.supportMultiple = void 0; var e = t(require("attr-accept")); function t(e) { return e && e.__esModule ? e : { default: e } } var r = "undefined" == typeof document || !document || !document.createElement || "multiple" in document.createElement("input"); function n(e) { var t = []; if (e.dataTransfer) { var r = e.dataTransfer; r.files && r.files.length ? t = r.files : r.items && r.items.length && (t = r.items) } else e.target && e.target.files && (t = e.target.files); return Array.prototype.slice.call(t) } function i(t, r) { return "application/x-moz-file" === t.type || (0, e.default)(t, r) } function u(e, t, r) { return e.size <= t && e.size >= r } function o(e, t) { return e.every(function (e) { return i(e, t) }) } function a(e) { e.preventDefault() } function s(e) { return -1 !== e.indexOf("MSIE") || -1 !== e.indexOf("Trident/") } function l(e) { return -1 !== e.indexOf("Edge/") } function f() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : window.navigator.userAgent; return s(e) || l(e) } exports.supportMultiple = r;
    }, { "attr-accept": "jogY" }], "GjUm": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = { rejected: { borderStyle: "solid", borderColor: "#c66", backgroundColor: "#eee" }, disabled: { opacity: .5 }, active: { borderStyle: "solid", borderColor: "#6c6", backgroundColor: "#eee" }, default: { width: 200, height: 200, borderWidth: 2, borderColor: "#666", borderStyle: "dashed", borderRadius: 5 } }; exports.default = e;
    }, {}], "pJc5": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = r(require("react")), t = r(require("prop-types")), n = require("./utils"), a = r(require("./utils/styles")); function r(e) { return e && e.__esModule ? e : { default: e } } var i = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) { var n = arguments[t]; for (var a in n) Object.prototype.hasOwnProperty.call(n, a) && (e[a] = n[a]) } return e }, o = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var a = t[n]; a.enumerable = a.enumerable || !1, a.configurable = !0, "value" in a && (a.writable = !0), Object.defineProperty(e, a.key, a) } } return function (t, n, a) { return n && e(t.prototype, n), a && e(t, a), t } }(); function l(e, t) { var n = {}; for (var a in e) t.indexOf(a) >= 0 || Object.prototype.hasOwnProperty.call(e, a) && (n[a] = e[a]); return n } function s(e) { if (Array.isArray(e)) { for (var t = 0, n = Array(e.length); t < e.length; t++)n[t] = e[t]; return n } return Array.from(e) } function c(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function u(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function p(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var d = function (t) { function r(e, t) { c(this, r); var n = u(this, (r.__proto__ || Object.getPrototypeOf(r)).call(this, e, t)); return n.renderChildren = function (e, t, a, r) { return "function" == typeof e ? e(i({}, n.state, { isDragActive: t, isDragAccept: a, isDragReject: r })) : e }, n.composeHandlers = n.composeHandlers.bind(n), n.onClick = n.onClick.bind(n), n.onDocumentDrop = n.onDocumentDrop.bind(n), n.onDragEnter = n.onDragEnter.bind(n), n.onDragLeave = n.onDragLeave.bind(n), n.onDragOver = n.onDragOver.bind(n), n.onDragStart = n.onDragStart.bind(n), n.onDrop = n.onDrop.bind(n), n.onFileDialogCancel = n.onFileDialogCancel.bind(n), n.onInputElementClick = n.onInputElementClick.bind(n), n.setRef = n.setRef.bind(n), n.setRefs = n.setRefs.bind(n), n.isFileDialogActive = !1, n.state = { draggedFiles: [], acceptedFiles: [], rejectedFiles: [] }, n } return p(r, e.default.Component), o(r, [{ key: "componentDidMount", value: function () { var e = this.props.preventDropOnDocument; this.dragTargets = [], e && (document.addEventListener("dragover", n.onDocumentDragOver, !1), document.addEventListener("drop", this.onDocumentDrop, !1)), null != this.fileInputEl && this.fileInputEl.addEventListener("click", this.onInputElementClick, !1), window.addEventListener("focus", this.onFileDialogCancel, !1) } }, { key: "componentWillUnmount", value: function () { this.props.preventDropOnDocument && (document.removeEventListener("dragover", n.onDocumentDragOver), document.removeEventListener("drop", this.onDocumentDrop)), null != this.fileInputEl && this.fileInputEl.removeEventListener("click", this.onInputElementClick, !1), window.removeEventListener("focus", this.onFileDialogCancel, !1) } }, { key: "composeHandlers", value: function (e) { return this.props.disabled ? null : e } }, { key: "onDocumentDrop", value: function (e) { this.node && this.node.contains(e.target) || (e.preventDefault(), this.dragTargets = []) } }, { key: "onDragStart", value: function (e) { this.props.onDragStart && this.props.onDragStart.call(this, e) } }, { key: "onDragEnter", value: function (e) { var t = this; e.preventDefault(), -1 === this.dragTargets.indexOf(e.target) && this.dragTargets.push(e.target), Promise.resolve(this.props.getDataTransferItems(e)).then(function (e) { t.setState({ isDragActive: !0, draggedFiles: e }) }), this.props.onDragEnter && this.props.onDragEnter.call(this, e) } }, { key: "onDragOver", value: function (e) { e.preventDefault(), e.stopPropagation(); try { e.dataTransfer.dropEffect = this.isFileDialogActive ? "none" : "copy" } catch (t) { } return this.props.onDragOver && this.props.onDragOver.call(this, e), !1 } }, { key: "onDragLeave", value: function (e) { var t = this; e.preventDefault(), this.dragTargets = this.dragTargets.filter(function (n) { return n !== e.target && t.node.contains(n) }), this.dragTargets.length > 0 || (this.setState({ isDragActive: !1, draggedFiles: [] }), this.props.onDragLeave && this.props.onDragLeave.call(this, e)) } }, { key: "onDrop", value: function (e) { var t = this, a = this.props, r = a.onDrop, i = a.onDropAccepted, o = a.onDropRejected, l = a.multiple, c = a.disablePreview, u = a.accept, p = a.getDataTransferItems; e.preventDefault(), this.dragTargets = [], this.isFileDialogActive = !1, this.draggedFiles = null, this.setState({ isDragActive: !1, draggedFiles: [] }), Promise.resolve(p(e)).then(function (a) { var p = [], d = []; a.forEach(function (e) { if (!c) try { e.preview = window.URL.createObjectURL(e) } catch (a) { 0 } (0, n.fileAccepted)(e, u) && (0, n.fileMatchSize)(e, t.props.maxSize, t.props.minSize) ? p.push(e) : d.push(e) }), !l && p.length > 1 && d.push.apply(d, s(p.splice(0))), r && r.call(t, p, d, e), d.length > 0 && o && o.call(t, d, e), p.length > 0 && i && i.call(t, p, e) }) } }, { key: "onClick", value: function (e) { var t = this.props, a = t.onClick; t.disableClick || (e.stopPropagation(), a && a.call(this, e), (0, n.isIeOrEdge)() ? setTimeout(this.open.bind(this), 0) : this.open()) } }, { key: "onInputElementClick", value: function (e) { e.stopPropagation(), this.props.inputProps && this.props.inputProps.onClick && this.props.inputProps.onClick() } }, { key: "onFileDialogCancel", value: function () { var e = this, t = this.props.onFileDialogCancel; this.isFileDialogActive && setTimeout(function () { null != e.fileInputEl && (e.fileInputEl.files.length || (e.isFileDialogActive = !1)); "function" == typeof t && t() }, 300) } }, { key: "setRef", value: function (e) { this.node = e } }, { key: "setRefs", value: function (e) { this.fileInputEl = e } }, { key: "open", value: function () { this.isFileDialogActive = !0, this.fileInputEl.value = null, this.fileInputEl.click() } }, { key: "render", value: function () { var t = this.props, r = t.accept, o = t.acceptClassName, s = t.activeClassName, c = t.children, u = t.disabled, p = t.disabledClassName, d = t.inputProps, f = t.multiple, g = t.name, h = t.rejectClassName, v = l(t, ["accept", "acceptClassName", "activeClassName", "children", "disabled", "disabledClassName", "inputProps", "multiple", "name", "rejectClassName"]), D = v.acceptStyle, m = v.activeStyle, b = v.className, y = void 0 === b ? "" : b, C = v.disabledStyle, k = v.rejectStyle, E = v.style, O = l(v, ["acceptStyle", "activeStyle", "className", "disabledStyle", "rejectStyle", "style"]), S = this.state, j = S.isDragActive, F = S.draggedFiles, P = F.length, T = f || P <= 1, w = P > 0 && (0, n.allFilesAccepted)(F, this.props.accept), A = P > 0 && (!w || !T), I = !(y || E || m || D || k || C); j && s && (y += " " + s), w && o && (y += " " + o), A && h && (y += " " + h), u && p && (y += " " + p), I && (E = a.default.default, m = a.default.active, D = a.default.active, k = a.default.rejected, C = a.default.disabled); var L = i({ position: "relative" }, E); m && j && (L = i({}, L, m)), D && w && (L = i({}, L, D)), k && A && (L = i({}, L, k)), C && u && (L = i({}, L, C)); var N = { accept: r, disabled: u, type: "file", style: i({ position: "absolute", top: 0, right: 0, bottom: 0, left: 0, opacity: 1e-5, pointerEvents: "none" }, d.style), multiple: n.supportMultiple && f, ref: this.setRefs, onChange: this.onDrop, autoComplete: "off" }; g && g.length && (N.name = g); O.acceptedFiles, O.preventDropOnDocument, O.disablePreview, O.disableClick, O.onDropAccepted, O.onDropRejected, O.onFileDialogCancel, O.maxSize, O.minSize, O.getDataTransferItems; var R = l(O, ["acceptedFiles", "preventDropOnDocument", "disablePreview", "disableClick", "onDropAccepted", "onDropRejected", "onFileDialogCancel", "maxSize", "minSize", "getDataTransferItems"]); return e.default.createElement("div", i({ className: y, style: L }, R, { onClick: this.composeHandlers(this.onClick), onDragStart: this.composeHandlers(this.onDragStart), onDragEnter: this.composeHandlers(this.onDragEnter), onDragOver: this.composeHandlers(this.onDragOver), onDragLeave: this.composeHandlers(this.onDragLeave), onDrop: this.composeHandlers(this.onDrop), ref: this.setRef, "aria-disabled": u }), this.renderChildren(c, j, w, A), e.default.createElement("input", i({}, d, N))) } }]), r }(), f = d; exports.default = f, d.propTypes = { accept: t.default.oneOfType([t.default.string, t.default.arrayOf(t.default.string)]), children: t.default.oneOfType([t.default.node, t.default.func]), disableClick: t.default.bool, disabled: t.default.bool, disablePreview: t.default.bool, preventDropOnDocument: t.default.bool, inputProps: t.default.object, multiple: t.default.bool, name: t.default.string, maxSize: t.default.number, minSize: t.default.number, className: t.default.string, activeClassName: t.default.string, acceptClassName: t.default.string, rejectClassName: t.default.string, disabledClassName: t.default.string, style: t.default.object, activeStyle: t.default.object, acceptStyle: t.default.object, rejectStyle: t.default.object, disabledStyle: t.default.object, getDataTransferItems: t.default.func, onClick: t.default.func, onDrop: t.default.func, onDropAccepted: t.default.func, onDropRejected: t.default.func, onDragStart: t.default.func, onDragEnter: t.default.func, onDragOver: t.default.func, onDragLeave: t.default.func, onFileDialogCancel: t.default.func }, d.defaultProps = { preventDropOnDocument: !0, disabled: !1, disablePreview: !1, disableClick: !1, inputProps: {}, multiple: !0, maxSize: 1 / 0, minSize: 0, getDataTransferItems: n.getDataTransferItems };
    }, { "react": "1n8/", "prop-types": "5D9O", "./utils": "qiqN", "./utils/styles": "GjUm" }], "BNKO": [function (require, module, exports) {
        !function () { "use strict"; var e = "undefined" != typeof window && void 0 !== window.document ? window.document : {}, n = "undefined" != typeof module && module.exports, l = "undefined" != typeof Element && "ALLOW_KEYBOARD_INPUT" in Element, r = function () { for (var n, l = [["requestFullscreen", "exitFullscreen", "fullscreenElement", "fullscreenEnabled", "fullscreenchange", "fullscreenerror"], ["webkitRequestFullscreen", "webkitExitFullscreen", "webkitFullscreenElement", "webkitFullscreenEnabled", "webkitfullscreenchange", "webkitfullscreenerror"], ["webkitRequestFullScreen", "webkitCancelFullScreen", "webkitCurrentFullScreenElement", "webkitCancelFullScreen", "webkitfullscreenchange", "webkitfullscreenerror"], ["mozRequestFullScreen", "mozCancelFullScreen", "mozFullScreenElement", "mozFullScreenEnabled", "mozfullscreenchange", "mozfullscreenerror"], ["msRequestFullscreen", "msExitFullscreen", "msFullscreenElement", "msFullscreenEnabled", "MSFullscreenChange", "MSFullscreenError"]], r = 0, t = l.length, u = {}; r < t; r++)if ((n = l[r]) && n[1] in e) { for (r = 0; r < n.length; r++)u[l[0][r]] = n[r]; return u } return !1 }(), t = { change: r.fullscreenchange, error: r.fullscreenerror }, u = { request: function (n) { var t = r.requestFullscreen; n = n || e.documentElement, / Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent) ? n[t]() : n[t](l ? Element.ALLOW_KEYBOARD_INPUT : {}) }, exit: function () { e[r.exitFullscreen]() }, toggle: function (e) { this.isFullscreen ? this.exit() : this.request(e) }, onchange: function (e) { this.on("change", e) }, onerror: function (e) { this.on("error", e) }, on: function (n, l) { var r = t[n]; r && e.addEventListener(r, l, !1) }, off: function (n, l) { var r = t[n]; r && e.removeEventListener(r, l, !1) }, raw: r }; r ? (Object.defineProperties(u, { isFullscreen: { get: function () { return Boolean(e[r.fullscreenElement]) } }, element: { enumerable: !0, get: function () { return e[r.fullscreenElement] } }, enabled: { enumerable: !0, get: function () { return Boolean(e[r.fullscreenEnabled]) } } }), n ? module.exports = u : window.screenfull = u) : n ? module.exports = !1 : window.screenfull = !1 }();
    }, {}], "Vx1w": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = !("undefined" == typeof window || !window.document || !window.document.createElement), module.exports = exports.default;
    }, {}], "HAUy": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("../util/inDOM"), t = n(e); function n(e) { return e && e.__esModule ? e : { default: e } } var r = function () { }; t.default && (r = document.addEventListener ? function (e, t, n, r) { return e.addEventListener(t, n, r || !1) } : document.attachEvent ? function (e, t, n) { return e.attachEvent("on" + t, function (t) { (t = t || window.event).target = t.target || t.srcElement, t.currentTarget = e, n.call(e, t) }) } : void 0), exports.default = r, module.exports = exports.default;
    }, { "../util/inDOM": "Vx1w" }], "B5P+": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("../util/inDOM"), t = n(e); function n(e) { return e && e.__esModule ? e : { default: e } } var r = function () { }; t.default && (r = document.addEventListener ? function (e, t, n, r) { return e.removeEventListener(t, n, r || !1) } : document.attachEvent ? function (e, t, n) { return e.detachEvent("on" + t, n) } : void 0), exports.default = r, module.exports = exports.default;
    }, { "../util/inDOM": "Vx1w" }], "MdZy": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("../util/inDOM"), t = o(e); function o(e) { return e && e.__esModule ? e : { default: e } } function n(e, t) { if (t) do { if (t === e) return !0 } while (t = t.parentNode); return !1 } exports.default = t.default ? function (e, t) { return e.contains ? e.contains(t) : e.compareDocumentPosition ? e === t || !!(16 & e.compareDocumentPosition(t)) : n(e, t) } : n, module.exports = exports.default;
    }, { "../util/inDOM": "Vx1w" }], "7DKm": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = l; var e = /^[\w-]*$/, t = Function.prototype.bind.call(Function.prototype.call, [].slice); function l(l, s) { var o, n = "#" === s[0], r = "." === s[0], a = n || r ? s.slice(1) : s; return e.test(a) ? n ? (o = (l = l.getElementById ? l : document).getElementById(a)) ? [o] : [] : l.getElementsByClassName && r ? t(l.getElementsByClassName(a)) : t(l.getElementsByTagName(s)) : t(l.querySelectorAll(s)) } module.exports = exports.default;
    }, {}], "a9Br": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = o; var e = require("../query/contains"), r = n(e), t = require("../query/querySelectorAll"), u = n(t); function n(e) { return e && e.__esModule ? e : { default: e } } function o(e, t) { return function (n) { var o = n.currentTarget, l = n.target; (0, u.default)(o, e).some(function (e) { return (0, r.default)(e, l) }) && t.call(this, n) } } module.exports = exports.default;
    }, { "../query/contains": "MdZy", "../query/querySelectorAll": "7DKm" }], "qZbV": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = require("../util/inDOM"), t = n(e), u = require("./on"), r = n(u), o = require("./off"), f = n(o); function n(e) { return e && e.__esModule ? e : { default: e } } var i = function () { }; t.default && (i = function (e, t, u, o) { return (0, r.default)(e, t, u, o), function () { (0, f.default)(e, t, u, o) } }), exports.default = i, module.exports = exports.default;
    }, { "../util/inDOM": "Vx1w", "./on": "HAUy", "./off": "B5P+" }], "1/7p": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.listen = exports.filter = exports.off = exports.on = void 0; var e = require("./on"), t = i(e), r = require("./off"), f = i(r), o = require("./filter"), l = i(o), u = require("./listen"), s = i(u); function i(e) { return e && e.__esModule ? e : { default: e } } exports.on = t.default, exports.off = f.default, exports.filter = l.default, exports.listen = s.default, exports.default = { on: t.default, off: f.default, filter: l.default, listen: s.default };
    }, { "./on": "HAUy", "./off": "B5P+", "./filter": "a9Br", "./listen": "qZbV" }], "r4LY": [function (require, module, exports) {
        "use strict"; function e(e) { return e && e.ownerDocument || document } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = e, module.exports = exports.default;
    }, {}], "VJtT": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = function (e) { if ((!d && 0 !== d || e) && t.default) { var o = document.createElement("div"); o.style.position = "absolute", o.style.top = "-9999px", o.style.width = "50px", o.style.height = "50px", o.style.overflow = "scroll", document.body.appendChild(o), d = o.offsetWidth - o.clientWidth, document.body.removeChild(o) } return d }; var e = require("./inDOM"), t = o(e); function o(e) { return e && e.__esModule ? e : { default: e } } var d = void 0; module.exports = exports.default;
    }, { "./inDOM": "Vx1w" }], "OKgH": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = u; var e = require("./ownerDocument"), t = r(e); function r(e) { return e && e.__esModule ? e : { default: e } } function u() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : (0, t.default)(); try { return e.activeElement } catch (r) { } } module.exports = exports.default;
    }, { "./ownerDocument": "r4LY" }], "V4yr": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, t = require("react"), o = a(t), n = require("./utils/createChainableTypeChecker"), r = a(n); function a(e) { return e && e.__esModule ? e : { default: e } } function l(t, n, r, a, l) { var u = t[n], i = void 0 === u ? "undefined" : e(u); return o.default.isValidElement(u) ? new Error("Invalid " + a + " `" + l + "` of type ReactElement supplied to `" + r + "`, expected a ReactComponent or a DOMElement. You can usually obtain a ReactComponent or DOMElement from a ReactElement by attaching a ref to it.") : "object" === i && "function" == typeof u.render || 1 === u.nodeType ? null : new Error("Invalid " + a + " `" + l + "` of value `" + u + "` supplied to `" + r + "`, expected a ReactComponent or a DOMElement.") } exports.default = (0, r.default)(l), module.exports = exports.default;
    }, { "react": "1n8/", "./utils/createChainableTypeChecker": "njtJ" }], "6oQY": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = u; var e = require("warning"), r = t(e); function t(e) { return e && e.__esModule ? e : { default: e } } var n = {}; function u(e, t) { return function (u, o, a, d, f) { var l = a || "<<anonymous>>", i = f || o; if (null != u[o]) { var s = a + "." + o; (0, r.default)(n[s], "The " + d + " `" + i + "` of `" + l + "` is deprecated. " + t + "."), n[s] = !0 } for (var c = arguments.length, p = Array(c > 5 ? c - 5 : 0), v = 5; v < c; v++)p[v - 5] = arguments[v]; return e.apply(void 0, [u, o, a, d, f].concat(p)) } } function o() { n = {} } u._resetWarned = o, module.exports = exports.default;
    }, { "warning": "/sXU" }], "ULai": [function (require, module, exports) {
        "use strict"; function e(e, s) { return e.classList ? !!s && e.classList.contains(s) : -1 !== (" " + (e.className.baseVal || e.className) + " ").indexOf(" " + s + " ") } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = e, module.exports = exports.default;
    }, {}], "NQzu": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = t; var s = require("./hasClass"), e = a(s); function a(s) { return s && s.__esModule ? s : { default: s } } function t(s, a) { s.classList ? s.classList.add(a) : (0, e.default)(s, a) || ("string" == typeof s.className ? s.className = s.className + " " + a : s.setAttribute("class", (s.className && s.className.baseVal || "") + " " + a)) } module.exports = exports.default;
    }, { "./hasClass": "ULai" }], "hW4d": [function (require, module, exports) {
        "use strict"; function s(s, e) { return s.replace(new RegExp("(^|\\s)" + e + "(?:\\s|$)", "g"), "$1").replace(/\s+/g, " ").replace(/^\s*|\s*$/g, "") } module.exports = function (e, a) { e.classList ? e.classList.remove(a) : "string" == typeof e.className ? e.className = s(e.className, a) : e.setAttribute("class", s(e.className && e.className.baseVal || "", a)) };
    }, {}], "x5t6": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.hasClass = exports.removeClass = exports.addClass = void 0; var e = require("./addClass"), s = d(e), a = require("./removeClass"), r = d(a), l = require("./hasClass"), t = d(l); function d(e) { return e && e.__esModule ? e : { default: e } } exports.addClass = s.default, exports.removeClass = r.default, exports.hasClass = t.default, exports.default = { addClass: s.default, removeClass: r.default, hasClass: t.default };
    }, { "./addClass": "NQzu", "./removeClass": "hW4d", "./hasClass": "ULai" }], "m/mp": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = t; var e = /-(.)/g; function t(t) { return t.replace(e, function (e, t) { return t.toUpperCase() }) } module.exports = exports.default;
    }, {}], "nF2G": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = l; var e = require("./camelize"), r = t(e); function t(e) { return e && e.__esModule ? e : { default: e } } var u = /^-ms-/; function l(e) { return (0, r.default)(e.replace(u, "ms-")) } module.exports = exports.default;
    }, { "./camelize": "m/mp" }], "ONuB": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = t; var e = /([A-Z])/g; function t(t) { return t.replace(e, "-$1").toLowerCase() } module.exports = exports.default;
    }, {}], "i7ni": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = o; var e = require("./hyphenate"), t = r(e); function r(e) { return e && e.__esModule ? e : { default: e } } var u = /^ms-/; function o(e) { return (0, t.default)(e).replace(u, "-ms-") } module.exports = exports.default;
    }, { "./hyphenate": "ONuB" }], "PuKc": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = o; var e = require("../util/camelizeStyle"), t = l(e); function l(e) { return e && e.__esModule ? e : { default: e } } var r = /^(top|right|bottom|left)$/, u = /^([+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|))(?!px)[a-z%]+$/i; function o(e) { if (!e) throw new TypeError("No Element passed to `getComputedStyle()`"); var l = e.ownerDocument; return "defaultView" in l ? l.defaultView.opener ? e.ownerDocument.defaultView.getComputedStyle(e, null) : window.getComputedStyle(e, null) : { getPropertyValue: function (l) { var o = e.style; "float" == (l = (0, t.default)(l)) && (l = "styleFloat"); var n = e.currentStyle[l] || null; if (null == n && o && o[l] && (n = o[l]), u.test(n) && !r.test(l)) { var f = o.left, a = e.runtimeStyle, i = a && a.left; i && (a.left = e.currentStyle.left), o.left = "fontSize" === l ? "1em" : n, n = o.pixelLeft + "px", o.left = f, i && (a.left = i) } return n } } } module.exports = exports.default;
    }, { "../util/camelizeStyle": "nF2G" }], "CFxQ": [function (require, module, exports) {
        "use strict"; function e(e, t) { return "removeProperty" in e.style ? e.style.removeProperty(t) : e.style.removeAttribute(t) } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = e, module.exports = exports.default;
    }, {}], "40SE": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.animationEnd = exports.animationDelay = exports.animationTiming = exports.animationDuration = exports.animationName = exports.transitionEnd = exports.transitionDuration = exports.transitionDelay = exports.transitionTiming = exports.transitionProperty = exports.transform = void 0; var n = require("../util/inDOM"), t = i(n); function i(n) { return n && n.__esModule ? n : { default: n } } var o = "transform", r = void 0, a = void 0, e = void 0, s = void 0, p = void 0, m = void 0, d = void 0, x = void 0, u = void 0, f = void 0, l = void 0; if (t.default) { var v = y(); r = v.prefix, exports.transitionEnd = a = v.transitionEnd, exports.animationEnd = e = v.animationEnd, exports.transform = o = r + "-" + o, exports.transitionProperty = s = r + "-transition-property", exports.transitionDuration = p = r + "-transition-duration", exports.transitionDelay = d = r + "-transition-delay", exports.transitionTiming = m = r + "-transition-timing-function", exports.animationName = x = r + "-animation-name", exports.animationDuration = u = r + "-animation-duration", exports.animationTiming = f = r + "-animation-delay", exports.animationDelay = l = r + "-animation-timing-function" } function y() { for (var n = document.createElement("div").style, t = { O: function (n) { return "o" + n.toLowerCase() }, Moz: function (n) { return n.toLowerCase() }, Webkit: function (n) { return "webkit" + n }, ms: function (n) { return "MS" + n } }, i = Object.keys(t), o = void 0, r = void 0, a = "", e = 0; e < i.length; e++) { var s = i[e]; if (s + "TransitionProperty" in n) { a = "-" + s.toLowerCase(), o = t[s]("TransitionEnd"), r = t[s]("AnimationEnd"); break } } return !o && "transitionProperty" in n && (o = "transitionend"), !r && "animationName" in n && (r = "animationend"), n = null, { animationEnd: r, transitionEnd: o, prefix: a } } exports.transform = o, exports.transitionProperty = s, exports.transitionTiming = m, exports.transitionDelay = d, exports.transitionDuration = p, exports.transitionEnd = a, exports.animationName = x, exports.animationDuration = u, exports.animationTiming = f, exports.animationDelay = l, exports.animationEnd = e, exports.default = { transform: o, end: a, property: s, timing: m, delay: d, duration: p };
    }, { "../util/inDOM": "Vx1w" }], "OFA2": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = t; var e = /^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i; function t(t) { return !(!t || !e.test(t)) } module.exports = exports.default;
    }, {}], "cZJ7": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = p; var e = require("../util/camelizeStyle"), t = d(e), r = require("../util/hyphenateStyle"), u = d(r), i = require("./getComputedStyle"), l = d(i), a = require("./removeStyle"), o = d(a), f = require("../transition/properties"), s = require("../transition/isTransform"), n = d(s); function d(e) { return e && e.__esModule ? e : { default: e } } function p(e, r, i) { var a = "", s = "", d = r; if ("string" == typeof r) { if (void 0 === i) return e.style[(0, t.default)(r)] || (0, l.default)(e).getPropertyValue((0, u.default)(r)); (d = {})[r] = i } Object.keys(d).forEach(function (t) { var r = d[t]; r || 0 === r ? (0, n.default)(t) ? s += t + "(" + r + ") " : a += (0, u.default)(t) + ": " + r + ";" : (0, o.default)(e, (0, u.default)(t)) }), s && (a += f.transform + ": " + s + ";"), e.style.cssText += ";" + a } module.exports = exports.default;
    }, { "../util/camelizeStyle": "nF2G", "../util/hyphenateStyle": "i7ni", "./getComputedStyle": "PuKc", "./removeStyle": "CFxQ", "../transition/properties": "40SE", "../transition/isTransform": "OFA2" }], "2bOG": [function (require, module, exports) {
        "use strict"; function e(e) { return e === e.window ? e : 9 === e.nodeType && (e.defaultView || e.parentWindow) } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = e, module.exports = exports.default;
    }, {}], "unvh": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.default = d; var e = require("dom-helpers/query/isWindow"), t = u(e), r = require("dom-helpers/ownerDocument"), n = u(r); function u(e) { return e && e.__esModule ? e : { default: e } } function o(e) { return e && "body" === e.tagName.toLowerCase() } function i(e) { var r = (0, n.default)(e), u = (0, t.default)(r).innerWidth; if (!u) { var o = r.documentElement.getBoundingClientRect(); u = o.right - Math.abs(o.left) } return r.body.clientWidth < u } function d(e) { return (0, t.default)(e) || o(e) ? i(e) : e.scrollHeight > e.clientHeight } module.exports = exports.default;
    }, { "dom-helpers/query/isWindow": "2bOG", "dom-helpers/ownerDocument": "r4LY" }], "orLy": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.ariaHidden = i, exports.hideSiblings = r, exports.showSiblings = o; var t = ["template", "script", "style"], e = function (e) { var n = e.nodeType, i = e.tagName; return 1 === n && -1 === t.indexOf(i.toLowerCase()) }, n = function (t, n, i) { n = [].concat(n), [].forEach.call(t.children, function (t) { -1 === n.indexOf(t) && e(t) && i(t) }) }; function i(t, e) { e && (t ? e.setAttribute("aria-hidden", "true") : e.removeAttribute("aria-hidden")) } function r(t, e) { n(t, e, function (t) { return i(!0, t) }) } function o(t, e) { n(t, e, function (t) { return i(!1, t) }) }
    }, {}], "Mhzi": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("dom-helpers/class"), i = r(e), n = require("dom-helpers/style"), s = r(n), o = require("dom-helpers/util/scrollbarSize"), t = r(o), a = require("./utils/isOverflowing"), l = r(a), d = require("./utils/manageAriaHidden"); function r(e) { return e && e.__esModule ? e : { default: e } } function u(e, i) { if (!(e instanceof i)) throw new TypeError("Cannot call a class as a function") } function f(e, i) { var n = -1; return e.some(function (e, s) { if (i(e, s)) return n = s, !0 }), n } function h(e, i) { return f(e, function (e) { return -1 !== e.modals.indexOf(i) }) } function c(e, i) { var n = { overflow: "hidden" }; e.style = { overflow: i.style.overflow, paddingRight: i.style.paddingRight }, e.overflowing && (n.paddingRight = parseInt((0, s.default)(i, "paddingRight") || 0, 10) + (0, t.default)() + "px"), (0, s.default)(i, n) } function m(e, i) { var n = e.style; Object.keys(n).forEach(function (e) { return i.style[e] = n[e] }) } var g = function e() { var n = this, s = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, o = s.hideSiblingNodes, t = void 0 === o || o, a = s.handleContainerOverflow, r = void 0 === a || a; u(this, e), this.add = function (e, s, o) { var t = n.modals.indexOf(e), a = n.containers.indexOf(s); if (-1 !== t) return t; if (t = n.modals.length, n.modals.push(e), n.hideSiblingNodes && (0, d.hideSiblings)(s, e.mountNode), -1 !== a) return n.data[a].modals.push(e), t; var r = { modals: [e], classes: o ? o.split(/\s+/) : [], overflowing: (0, l.default)(s) }; return n.handleContainerOverflow && c(r, s), r.classes.forEach(i.default.addClass.bind(null, s)), n.containers.push(s), n.data.push(r), t }, this.remove = function (e) { var s = n.modals.indexOf(e); if (-1 !== s) { var o = h(n.data, e), t = n.data[o], a = n.containers[o]; t.modals.splice(t.modals.indexOf(e), 1), n.modals.splice(s, 1), 0 === t.modals.length ? (t.classes.forEach(i.default.removeClass.bind(null, a)), n.handleContainerOverflow && m(t, a), n.hideSiblingNodes && (0, d.showSiblings)(a, e.mountNode), n.containers.splice(o, 1), n.data.splice(o, 1)) : n.hideSiblingNodes && (0, d.ariaHidden)(!1, t.modals[t.modals.length - 1].mountNode) } }, this.isTopModal = function (e) { return !!n.modals.length && n.modals[n.modals.length - 1] === e }, this.hideSiblingNodes = t, this.handleContainerOverflow = r, this.modals = [], this.containers = [], this.data = [] }; exports.default = g, module.exports = exports.default;
    }, { "dom-helpers/class": "x5t6", "dom-helpers/style": "cZJ7", "dom-helpers/util/scrollbarSize": "VJtT", "./utils/isOverflowing": "unvh", "./utils/manageAriaHidden": "orLy" }], "HfI3": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.default = o; var e = require("react-dom"), t = u(e); function u(e) { return e && e.__esModule ? e : { default: e } } function o(e, u) { return e = "function" == typeof e ? e() : e, t.default.findDOMNode(e) || u } module.exports = exports.default;
    }, { "react-dom": "NKHc" }], "B7R5": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.default = function (e) { return (0, u.default)(r.default.findDOMNode(e)) }; var e = require("react-dom"), r = o(e), t = require("dom-helpers/ownerDocument"), u = o(t); function o(e) { return e && e.__esModule ? e : { default: e } } module.exports = exports.default;
    }, { "react-dom": "NKHc", "dom-helpers/ownerDocument": "r4LY" }], "Sn4e": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("prop-types"), t = s(e), r = require("prop-types-extra/lib/componentOrElement"), n = s(r), o = require("react"), a = s(o), l = require("react-dom"), u = s(l), i = require("./utils/getContainer"), p = s(i), d = require("./utils/ownerDocument"), c = s(d); function s(e) { return e && e.__esModule ? e : { default: e } } function f(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function y(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function _(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var v = function (e) { function t() { var r, n; f(this, t); for (var o = arguments.length, l = Array(o), i = 0; i < o; i++)l[i] = arguments[i]; return r = n = y(this, e.call.apply(e, [this].concat(l))), n._mountOverlayTarget = function () { n._overlayTarget || (n._overlayTarget = document.createElement("div"), n._portalContainerNode = (0, p.default)(n.props.container, (0, c.default)(n).body), n._portalContainerNode.appendChild(n._overlayTarget)) }, n._unmountOverlayTarget = function () { n._overlayTarget && (n._portalContainerNode.removeChild(n._overlayTarget), n._overlayTarget = null), n._portalContainerNode = null }, n._renderOverlay = function () { var e = n.props.children ? a.default.Children.only(n.props.children) : null; if (null !== e) { n._mountOverlayTarget(); var t = !n._overlayInstance; n._overlayInstance = u.default.unstable_renderSubtreeIntoContainer(n, e, n._overlayTarget, function () { t && n.props.onRendered && n.props.onRendered() }) } else n._unrenderOverlay(), n._unmountOverlayTarget() }, n._unrenderOverlay = function () { n._overlayTarget && (u.default.unmountComponentAtNode(n._overlayTarget), n._overlayInstance = null) }, n.getMountNode = function () { return n._overlayTarget }, y(n, r) } return _(t, e), t.prototype.componentDidMount = function () { this._isMounted = !0, this._renderOverlay() }, t.prototype.componentDidUpdate = function () { this._renderOverlay() }, t.prototype.componentWillReceiveProps = function (e) { this._overlayTarget && e.container !== this.props.container && (this._portalContainerNode.removeChild(this._overlayTarget), this._portalContainerNode = (0, p.default)(e.container, (0, c.default)(this).body), this._portalContainerNode.appendChild(this._overlayTarget)) }, t.prototype.componentWillUnmount = function () { this._isMounted = !1, this._unrenderOverlay(), this._unmountOverlayTarget() }, t.prototype.render = function () { return null }, t }(a.default.Component); v.displayName = "Portal", v.propTypes = { container: t.default.oneOfType([n.default, t.default.func]), onRendered: t.default.func }, exports.default = v, module.exports = exports.default;
    }, { "prop-types": "5D9O", "prop-types-extra/lib/componentOrElement": "V4yr", "react": "1n8/", "react-dom": "NKHc", "./utils/getContainer": "HfI3", "./utils/ownerDocument": "B7R5" }], "JDVy": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("prop-types"), t = h(e), o = require("prop-types-extra/lib/componentOrElement"), r = h(o), n = require("react"), i = h(n), a = require("react-dom"), u = h(a), p = require("./utils/getContainer"), l = h(p), c = require("./utils/ownerDocument"), s = h(c), f = require("./LegacyPortal"), d = h(f); function h(e) { return e && e.__esModule ? e : { default: e } } function y(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function m(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function _(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var b = function (e) { function t() { var o, r; y(this, t); for (var n = arguments.length, i = Array(n), a = 0; a < n; a++)i[a] = arguments[a]; return o = r = m(this, e.call.apply(e, [this].concat(i))), r.setContainer = function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : r.props; r._portalContainerNode = (0, l.default)(e.container, (0, s.default)(r).body) }, r.getMountNode = function () { return r._portalContainerNode }, m(r, o) } return _(t, e), t.prototype.componentDidMount = function () { this.setContainer(), this.forceUpdate(this.props.onRendered) }, t.prototype.componentWillReceiveProps = function (e) { e.container !== this.props.container && this.setContainer(e) }, t.prototype.componentWillUnmount = function () { this._portalContainerNode = null }, t.prototype.render = function () { return this.props.children && this._portalContainerNode ? u.default.createPortal(this.props.children, this._portalContainerNode) : null }, t }(i.default.Component); b.displayName = "Portal", b.propTypes = { container: t.default.oneOfType([r.default, t.default.func]), onRendered: t.default.func }, exports.default = u.default.createPortal ? b : d.default, module.exports = exports.default;
    }, { "prop-types": "5D9O", "prop-types-extra/lib/componentOrElement": "V4yr", "react": "1n8/", "react-dom": "NKHc", "./utils/getContainer": "HfI3", "./utils/ownerDocument": "B7R5", "./LegacyPortal": "Sn4e" }], "9Y4Y": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("prop-types"), t = n(e), r = require("react"), o = n(r); function n(e) { return e && e.__esModule ? e : { default: e } } function u(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function p(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var s = { children: t.default.node }, c = function (e) { function t() { return u(this, t), i(this, e.apply(this, arguments)) } return p(t, e), t.prototype.render = function () { return this.props.children }, t }(o.default.Component); c.propTypes = s, exports.default = c, module.exports = exports.default;
    }, { "prop-types": "5D9O", "react": "1n8/" }], "MEoH": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.default = function (e, r, o, s) { return (0, t.default)(e, r, o, s), { remove: function () { (0, u.default)(e, r, o, s) } } }; var e = require("dom-helpers/events/on"), t = o(e), r = require("dom-helpers/events/off"), u = o(r); function o(e) { return e && e.__esModule ? e : { default: e } } module.exports = exports.default;
    }, { "dom-helpers/events/on": "HAUy", "dom-helpers/events/off": "B5P+" }], "qsvW": [function (require, module, exports) {
        "use strict"; function e(e) { var t = void 0; return !document.addEventListener ? (document.attachEvent("onfocusin", e), t = function () { return document.detachEvent("onfocusin", e) }) : (document.addEventListener("focus", e, !0), t = function () { return document.removeEventListener("focus", e, !0) }), { remove: t } } exports.__esModule = !0, exports.default = e, module.exports = exports.default;
    }, {}], "K4hF": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) { var o = arguments[t]; for (var n in o) Object.prototype.hasOwnProperty.call(o, n) && (e[n] = o[n]) } return e }, t = require("dom-helpers/activeElement"), o = S(t), n = require("dom-helpers/query/contains"), r = S(n), s = require("dom-helpers/util/inDOM"), a = S(s), i = require("prop-types"), u = S(i), p = require("prop-types-extra/lib/componentOrElement"), d = S(p), c = require("prop-types-extra/lib/deprecated"), l = S(c), f = require("prop-types-extra/lib/elementType"), h = S(f), y = require("react"), m = S(y), b = require("react-dom"), E = S(b), w = require("warning"), k = S(w), g = require("./ModalManager"), v = S(g), x = require("./Portal"), F = S(x), D = require("./RefHolder"), M = S(D), q = require("./utils/addEventListener"), O = S(q), T = require("./utils/addFocusListener"), _ = S(T), C = require("./utils/getContainer"), K = S(C), N = require("./utils/ownerDocument"), P = S(N); function S(e) { return e && e.__esModule ? e : { default: e } } function H(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function R(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function j(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var B = new v.default, L = function (t) { function n() { var e, o; H(this, n); for (var r = arguments.length, s = Array(r), a = 0; a < r; a++)s[a] = arguments[a]; return e = o = R(this, t.call.apply(t, [this].concat(s))), U.call(o), R(o, e) } return j(n, t), n.prototype.omitProps = function (e, t) { var o = Object.keys(e), n = {}; return o.map(function (o) { Object.prototype.hasOwnProperty.call(t, o) || (n[o] = e[o]) }), n }, n.prototype.render = function () { var t = this.props, o = t.show, r = t.container, s = t.children, a = t.transition, i = t.backdrop, u = t.className, p = t.style, d = t.onExit, c = t.onExiting, l = t.onEnter, f = t.onEntering, h = t.onEntered, b = m.default.Children.only(s), E = this.omitProps(this.props, n.propTypes); if (!(o || a && !this.state.exited)) return null; var w = b.props, k = w.role, g = w.tabIndex; return void 0 !== k && void 0 !== g || (b = (0, y.cloneElement)(b, { role: void 0 === k ? "document" : k, tabIndex: null == g ? "-1" : g })), a && (b = m.default.createElement(a, { appear: !0, unmountOnExit: !0, in: o, onExit: d, onExiting: c, onExited: this.handleHidden, onEnter: l, onEntering: f, onEntered: h }, b)), m.default.createElement(F.default, { ref: this.setMountNode, container: r, onRendered: this.onPortalRendered }, m.default.createElement("div", e({ ref: this.setModalNodeRef, role: k || "dialog" }, E, { style: p, className: u }), i && this.renderBackdrop(), m.default.createElement(M.default, { ref: this.setDialogRef }, b))) }, n.prototype.componentWillReceiveProps = function (e) { e.show ? this.setState({ exited: !1 }) : e.transition || this.setState({ exited: !0 }) }, n.prototype.componentWillUpdate = function (e) { !this.props.show && e.show && this.checkForFocus() }, n.prototype.componentDidMount = function () { this._isMounted = !0, this.props.show && this.onShow() }, n.prototype.componentDidUpdate = function (e) { var t = this.props.transition; !e.show || this.props.show || t ? !e.show && this.props.show && this.onShow() : this.onHide() }, n.prototype.componentWillUnmount = function () { var e = this.props, t = e.show, o = e.transition; this._isMounted = !1, (t || o && !this.state.exited) && this.onHide() }, n.prototype.autoFocus = function () { if (this.props.autoFocus) { var e = this.getDialogElement(), t = (0, o.default)((0, P.default)(this)); e && !(0, r.default)(e, t) && (this.lastFocus = t, e.hasAttribute("tabIndex") || ((0, k.default)(!1, 'The modal content node does not accept focus. For the benefit of assistive technologies, the tabIndex of the node is being set to "-1".'), e.setAttribute("tabIndex", -1)), e.focus()) } }, n.prototype.restoreLastFocus = function () { this.lastFocus && this.lastFocus.focus && (this.lastFocus.focus(), this.lastFocus = null) }, n.prototype.getDialogElement = function () { return E.default.findDOMNode(this.dialog) }, n.prototype.isTopModal = function () { return this.props.manager.isTopModal(this) }, n }(m.default.Component); L.propTypes = e({}, F.default.propTypes, { show: u.default.bool, container: u.default.oneOfType([d.default, u.default.func]), onShow: u.default.func, onHide: u.default.func, backdrop: u.default.oneOfType([u.default.bool, u.default.oneOf(["static"])]), renderBackdrop: u.default.func, onEscapeKeyDown: u.default.func, onEscapeKeyUp: (0, l.default)(u.default.func, "Please use onEscapeKeyDown instead for consistency"), onBackdropClick: u.default.func, backdropStyle: u.default.object, backdropClassName: u.default.string, containerClassName: u.default.string, keyboard: u.default.bool, transition: h.default, backdropTransition: h.default, autoFocus: u.default.bool, enforceFocus: u.default.bool, restoreFocus: u.default.bool, onEnter: u.default.func, onEntering: u.default.func, onEntered: u.default.func, onExit: u.default.func, onExiting: u.default.func, onExited: u.default.func, manager: u.default.object.isRequired }), L.defaultProps = { show: !1, backdrop: !0, keyboard: !0, autoFocus: !0, enforceFocus: !0, restoreFocus: !0, onHide: function () { }, manager: B, renderBackdrop: function (e) { return m.default.createElement("div", e) } }; var U = function () { var e = this; this.state = { exited: !this.props.show }, this.renderBackdrop = function () { var t = e.props, o = t.backdropStyle, n = t.backdropClassName, r = t.renderBackdrop, s = t.backdropTransition, a = r({ ref: function (t) { return e.backdrop = t }, style: o, className: n, onClick: e.handleBackdropClick }); return s && (a = m.default.createElement(s, { appear: !0, in: e.props.show }, a)), a }, this.onPortalRendered = function () { e.autoFocus(), e.props.onShow && e.props.onShow() }, this.onShow = function () { var t = (0, P.default)(e), o = (0, K.default)(e.props.container, t.body); e.props.manager.add(e, o, e.props.containerClassName), e._onDocumentKeydownListener = (0, O.default)(t, "keydown", e.handleDocumentKeyDown), e._onDocumentKeyupListener = (0, O.default)(t, "keyup", e.handleDocumentKeyUp), e._onFocusinListener = (0, _.default)(e.enforceFocus) }, this.onHide = function () { e.props.manager.remove(e), e._onDocumentKeydownListener.remove(), e._onDocumentKeyupListener.remove(), e._onFocusinListener.remove(), e.props.restoreFocus && e.restoreLastFocus() }, this.setMountNode = function (t) { e.mountNode = t ? t.getMountNode() : t }, this.setModalNodeRef = function (t) { e.modalNode = t }, this.setDialogRef = function (t) { e.dialog = t }, this.handleHidden = function () { var t; (e.setState({ exited: !0 }), e.onHide(), e.props.onExited) && (t = e.props).onExited.apply(t, arguments) }, this.handleBackdropClick = function (t) { t.target === t.currentTarget && (e.props.onBackdropClick && e.props.onBackdropClick(t), !0 === e.props.backdrop && e.props.onHide()) }, this.handleDocumentKeyDown = function (t) { e.props.keyboard && 27 === t.keyCode && e.isTopModal() && (e.props.onEscapeKeyDown && e.props.onEscapeKeyDown(t), e.props.onHide()) }, this.handleDocumentKeyUp = function (t) { e.props.keyboard && 27 === t.keyCode && e.isTopModal() && e.props.onEscapeKeyUp && e.props.onEscapeKeyUp(t) }, this.checkForFocus = function () { a.default && (e.lastFocus = (0, o.default)()) }, this.enforceFocus = function () { if (e.props.enforceFocus && e._isMounted && e.isTopModal()) { var t = e.getDialogElement(), n = (0, o.default)((0, P.default)(e)); t && !(0, r.default)(t, n) && t.focus() } } }; L.Manager = v.default, exports.default = L, module.exports = exports.default;
    }, { "dom-helpers/activeElement": "OKgH", "dom-helpers/query/contains": "MdZy", "dom-helpers/util/inDOM": "Vx1w", "prop-types": "5D9O", "prop-types-extra/lib/componentOrElement": "V4yr", "prop-types-extra/lib/deprecated": "6oQY", "prop-types-extra/lib/elementType": "aemN", "react": "1n8/", "react-dom": "NKHc", "warning": "/sXU", "./ModalManager": "Mhzi", "./Portal": "JDVy", "./RefHolder": "9Y4Y", "./utils/addEventListener": "MEoH", "./utils/addFocusListener": "qsvW", "./utils/getContainer": "HfI3", "./utils/ownerDocument": "B7R5" }], "Msl5": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = C(e), r = require("babel-runtime/helpers/objectWithoutProperties"), s = C(r), l = require("babel-runtime/helpers/classCallCheck"), a = C(l), u = require("babel-runtime/helpers/possibleConstructorReturn"), o = C(u), n = require("babel-runtime/helpers/inherits"), i = C(n), p = require("classnames"), d = C(p), c = require("react"), m = C(c), f = require("prop-types-extra/lib/elementType"), b = C(f), h = require("./utils/bootstrapUtils"); function C(e) { return e && e.__esModule ? e : { default: e } } var q = { componentClass: b.default }, x = { componentClass: "div" }, y = function (e) { function r() { return (0, a.default)(this, r), (0, o.default)(this, e.apply(this, arguments)) } return (0, i.default)(r, e), r.prototype.render = function () { var e = this.props, r = e.componentClass, l = e.className, a = (0, s.default)(e, ["componentClass", "className"]), u = (0, h.splitBsProps)(a), o = u[0], n = u[1], i = (0, h.getClassSet)(o); return m.default.createElement(r, (0, t.default)({}, n, { className: (0, d.default)(l, i) })) }, r }(m.default.Component); y.propTypes = q, y.defaultProps = x, exports.default = (0, h.bsClass)("modal-body", y), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types-extra/lib/elementType": "aemN", "./utils/bootstrapUtils": "t+qF" }], "PsMn": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = C(e), r = require("babel-runtime/helpers/objectWithoutProperties"), l = C(r), s = require("babel-runtime/helpers/classCallCheck"), a = C(s), i = require("babel-runtime/helpers/possibleConstructorReturn"), u = C(i), o = require("babel-runtime/helpers/inherits"), d = C(o), n = require("classnames"), p = C(n), f = require("react"), c = C(f), m = require("prop-types"), b = C(m), h = require("./utils/bootstrapUtils"), q = require("./utils/StyleConfig"); function C(e) { return e && e.__esModule ? e : { default: e } } var x = { dialogClassName: b.default.string }, y = function (e) { function r() { return (0, a.default)(this, r), (0, u.default)(this, e.apply(this, arguments)) } return (0, d.default)(r, e), r.prototype.render = function () { var e, r = this.props, s = r.dialogClassName, a = r.className, i = r.style, u = r.children, o = (0, l.default)(r, ["dialogClassName", "className", "style", "children"]), d = (0, h.splitBsProps)(o), n = d[0], f = d[1], m = (0, h.prefix)(n), b = (0, t.default)({ display: "block" }, i), q = (0, t.default)({}, (0, h.getClassSet)(n), ((e = {})[m] = !1, e[(0, h.prefix)(n, "dialog")] = !0, e)); return c.default.createElement("div", (0, t.default)({}, f, { tabIndex: "-1", role: "dialog", style: b, className: (0, p.default)(a, m) }), c.default.createElement("div", { className: (0, p.default)(s, q) }, c.default.createElement("div", { className: (0, h.prefix)(n, "content"), role: "document" }, u))) }, r }(c.default.Component); y.propTypes = x, exports.default = (0, h.bsClass)("modal", (0, h.bsSizes)([q.Size.LARGE, q.Size.SMALL], y)), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "./utils/bootstrapUtils": "t+qF", "./utils/StyleConfig": "uE08" }], "iXS3": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = C(e), r = require("babel-runtime/helpers/objectWithoutProperties"), s = C(r), l = require("babel-runtime/helpers/classCallCheck"), a = C(l), u = require("babel-runtime/helpers/possibleConstructorReturn"), o = C(u), n = require("babel-runtime/helpers/inherits"), i = C(n), p = require("classnames"), d = C(p), c = require("react"), f = C(c), m = require("prop-types-extra/lib/elementType"), b = C(m), h = require("./utils/bootstrapUtils"); function C(e) { return e && e.__esModule ? e : { default: e } } var q = { componentClass: b.default }, x = { componentClass: "div" }, y = function (e) { function r() { return (0, a.default)(this, r), (0, o.default)(this, e.apply(this, arguments)) } return (0, i.default)(r, e), r.prototype.render = function () { var e = this.props, r = e.componentClass, l = e.className, a = (0, s.default)(e, ["componentClass", "className"]), u = (0, h.splitBsProps)(a), o = u[0], n = u[1], i = (0, h.getClassSet)(o); return f.default.createElement(r, (0, t.default)({}, n, { className: (0, d.default)(l, i) })) }, r }(f.default.Component); y.propTypes = q, y.defaultProps = x, exports.default = (0, h.bsClass)("modal-footer", y), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types-extra/lib/elementType": "aemN", "./utils/bootstrapUtils": "t+qF" }], "MjD9": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = _(e), l = require("babel-runtime/helpers/objectWithoutProperties"), r = _(l), s = require("babel-runtime/helpers/classCallCheck"), u = _(s), a = require("babel-runtime/helpers/possibleConstructorReturn"), o = _(a), n = require("babel-runtime/helpers/inherits"), i = _(n), d = require("classnames"), c = _(d), p = require("prop-types"), f = _(p), b = require("react"), h = _(b), m = require("./utils/bootstrapUtils"), q = require("./utils/createChainedFunction"), C = _(q), x = require("./CloseButton"), B = _(x); function _(e) { return e && e.__esModule ? e : { default: e } } var y = { closeLabel: f.default.string, closeButton: f.default.bool, onHide: f.default.func }, H = { closeLabel: "Close", closeButton: !1 }, v = { $bs_modal: f.default.shape({ onHide: f.default.func }) }, L = function (e) { function l() { return (0, u.default)(this, l), (0, o.default)(this, e.apply(this, arguments)) } return (0, i.default)(l, e), l.prototype.render = function () { var e = this.props, l = e.closeLabel, s = e.closeButton, u = e.onHide, a = e.className, o = e.children, n = (0, r.default)(e, ["closeLabel", "closeButton", "onHide", "className", "children"]), i = this.context.$bs_modal, d = (0, m.splitBsProps)(n), p = d[0], f = d[1], b = (0, m.getClassSet)(p); return h.default.createElement("div", (0, t.default)({}, f, { className: (0, c.default)(a, b) }), s && h.default.createElement(B.default, { label: l, onClick: (0, C.default)(i && i.onHide, u) }), o) }, l }(h.default.Component); L.propTypes = y, L.defaultProps = H, L.contextTypes = v, exports.default = (0, m.bsClass)("modal-header", L), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "prop-types": "5D9O", "react": "1n8/", "./utils/bootstrapUtils": "t+qF", "./utils/createChainedFunction": "GYue", "./CloseButton": "e2xO" }], "BqP/": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = C(e), r = require("babel-runtime/helpers/objectWithoutProperties"), s = C(r), l = require("babel-runtime/helpers/classCallCheck"), a = C(l), u = require("babel-runtime/helpers/possibleConstructorReturn"), o = C(u), n = require("babel-runtime/helpers/inherits"), i = C(n), p = require("classnames"), c = C(p), d = require("react"), m = C(d), f = require("prop-types-extra/lib/elementType"), b = C(f), h = require("./utils/bootstrapUtils"); function C(e) { return e && e.__esModule ? e : { default: e } } var q = { componentClass: b.default }, x = { componentClass: "h4" }, y = function (e) { function r() { return (0, a.default)(this, r), (0, o.default)(this, e.apply(this, arguments)) } return (0, i.default)(r, e), r.prototype.render = function () { var e = this.props, r = e.componentClass, l = e.className, a = (0, s.default)(e, ["componentClass", "className"]), u = (0, h.splitBsProps)(a), o = u[0], n = u[1], i = (0, h.getClassSet)(o); return m.default.createElement(r, (0, t.default)({}, n, { className: (0, c.default)(l, i) })) }, r }(m.default.Component); y.propTypes = q, y.defaultProps = x, exports.default = (0, h.bsClass)("modal-title", y), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types-extra/lib/elementType": "aemN", "./utils/bootstrapUtils": "t+qF" }], "1hZm": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/core-js/object/entries"), r = t(e); function t(e) { return e && e.__esModule ? e : { default: e } } function u(e, t) { var u = t.propTypes, o = {}, s = {}; return (0, r.default)(e).forEach(function (e) { var r = e[0], t = e[1]; u[r] ? o[r] = t : s[r] = t }), [o, s] } exports.default = u, module.exports = exports.default;
    }, { "babel-runtime/core-js/object/entries": "FgrW" }], "fdwO": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/objectWithoutProperties"), t = V(e), l = require("babel-runtime/helpers/classCallCheck"), o = V(l), a = require("babel-runtime/helpers/possibleConstructorReturn"), i = V(a), n = require("babel-runtime/helpers/inherits"), r = V(n), d = require("babel-runtime/helpers/extends"), u = V(d), s = require("classnames"), f = V(s), p = require("dom-helpers/events"), c = V(p), h = require("dom-helpers/ownerDocument"), m = V(h), b = require("dom-helpers/util/inDOM"), y = V(b), g = require("dom-helpers/util/scrollbarSize"), C = V(g), E = require("react"), q = V(E), R = require("prop-types"), T = V(R), x = require("react-dom"), N = V(x), k = require("react-overlays/lib/Modal"), D = V(k), w = require("react-overlays/lib/utils/isOverflowing"), M = V(w), v = require("prop-types-extra/lib/elementType"), O = V(v), S = require("./Fade"), _ = V(S), A = require("./ModalBody"), I = V(A), z = require("./ModalDialog"), H = V(z), F = require("./ModalFooter"), W = V(F), P = require("./ModalHeader"), U = V(P), B = require("./ModalTitle"), L = V(B), K = require("./utils/bootstrapUtils"), $ = require("./utils/createChainedFunction"), j = V($), G = require("./utils/splitComponentProps"), J = V(G), Q = require("./utils/StyleConfig"); function V(e) { return e && e.__esModule ? e : { default: e } } var X = (0, u.default)({}, D.default.propTypes, H.default.propTypes, { backdrop: T.default.oneOf(["static", !0, !1]), backdropClassName: T.default.string, keyboard: T.default.bool, animation: T.default.bool, dialogComponentClass: O.default, autoFocus: T.default.bool, enforceFocus: T.default.bool, restoreFocus: T.default.bool, show: T.default.bool, onHide: T.default.func, onEnter: T.default.func, onEntering: T.default.func, onEntered: T.default.func, onExit: T.default.func, onExiting: T.default.func, onExited: T.default.func, container: D.default.propTypes.container }), Y = (0, u.default)({}, D.default.defaultProps, { animation: !0, dialogComponentClass: H.default }), Z = { $bs_modal: T.default.shape({ onHide: T.default.func }) }; function ee(e) { return q.default.createElement(_.default, (0, u.default)({}, e, { timeout: le.TRANSITION_DURATION })) } function te(e) { return q.default.createElement(_.default, (0, u.default)({}, e, { timeout: le.BACKDROP_TRANSITION_DURATION })) } var le = function (e) { function l(t, a) { (0, o.default)(this, l); var n = (0, i.default)(this, e.call(this, t, a)); return n.handleEntering = n.handleEntering.bind(n), n.handleExited = n.handleExited.bind(n), n.handleWindowResize = n.handleWindowResize.bind(n), n.handleDialogClick = n.handleDialogClick.bind(n), n.setModalRef = n.setModalRef.bind(n), n.state = { style: {} }, n } return (0, r.default)(l, e), l.prototype.getChildContext = function () { return { $bs_modal: { onHide: this.props.onHide } } }, l.prototype.componentWillUnmount = function () { this.handleExited() }, l.prototype.setModalRef = function (e) { this._modal = e }, l.prototype.handleDialogClick = function (e) { e.target === e.currentTarget && this.props.onHide() }, l.prototype.handleEntering = function () { c.default.on(window, "resize", this.handleWindowResize), this.updateStyle() }, l.prototype.handleExited = function () { c.default.off(window, "resize", this.handleWindowResize) }, l.prototype.handleWindowResize = function () { this.updateStyle() }, l.prototype.updateStyle = function () { if (y.default) { var e = this._modal.getDialogElement(), t = e.scrollHeight, l = (0, m.default)(e), o = (0, M.default)(N.default.findDOMNode(this.props.container || l.body)), a = t > l.documentElement.clientHeight; this.setState({ style: { paddingRight: o && !a ? (0, C.default)() : void 0, paddingLeft: !o && a ? (0, C.default)() : void 0 } }) } }, l.prototype.render = function () { var e = this.props, l = e.backdrop, o = e.backdropClassName, a = e.animation, i = e.show, n = e.dialogComponentClass, r = e.className, d = e.style, s = e.children, p = e.onEntering, c = e.onExited, h = (0, t.default)(e, ["backdrop", "backdropClassName", "animation", "show", "dialogComponentClass", "className", "style", "children", "onEntering", "onExited"]), m = (0, J.default)(h, D.default), b = m[0], y = m[1], g = i && !a && "in"; return q.default.createElement(D.default, (0, u.default)({}, b, { ref: this.setModalRef, show: i, containerClassName: (0, K.prefix)(h, "open"), transition: a ? ee : void 0, backdrop: l, backdropTransition: a ? te : void 0, backdropClassName: (0, f.default)((0, K.prefix)(h, "backdrop"), o, g), onEntering: (0, j.default)(p, this.handleEntering), onExited: (0, j.default)(c, this.handleExited) }), q.default.createElement(n, (0, u.default)({}, y, { style: (0, u.default)({}, this.state.style, d), className: (0, f.default)(r, g), onClick: !0 === l ? this.handleDialogClick : null }), s)) }, l }(q.default.Component); le.propTypes = X, le.defaultProps = Y, le.childContextTypes = Z, le.Body = I.default, le.Header = U.default, le.Title = L.default, le.Footer = W.default, le.Dialog = H.default, le.TRANSITION_DURATION = 300, le.BACKDROP_TRANSITION_DURATION = 150, exports.default = (0, K.bsClass)("modal", (0, K.bsSizes)([Q.Size.LARGE, Q.Size.SMALL], le)), module.exports = exports.default;
    }, { "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "babel-runtime/helpers/extends": "T4f3", "classnames": "9qb7", "dom-helpers/events": "1/7p", "dom-helpers/ownerDocument": "r4LY", "dom-helpers/util/inDOM": "Vx1w", "dom-helpers/util/scrollbarSize": "VJtT", "react": "1n8/", "prop-types": "5D9O", "react-dom": "NKHc", "react-overlays/lib/Modal": "K4hF", "react-overlays/lib/utils/isOverflowing": "unvh", "prop-types-extra/lib/elementType": "aemN", "./Fade": "UlEz", "./ModalBody": "Msl5", "./ModalDialog": "PsMn", "./ModalFooter": "iXS3", "./ModalHeader": "MjD9", "./ModalTitle": "BqP/", "./utils/bootstrapUtils": "t+qF", "./utils/createChainedFunction": "GYue", "./utils/splitComponentProps": "1hZm", "./utils/StyleConfig": "uE08" }], "Fity": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), r = m(e), t = require("babel-runtime/helpers/objectWithoutProperties"), s = m(t), l = require("babel-runtime/helpers/classCallCheck"), u = m(l), i = require("babel-runtime/helpers/possibleConstructorReturn"), a = m(i), n = require("babel-runtime/helpers/inherits"), o = m(n), p = require("classnames"), d = m(p), f = require("react"), b = m(f), c = require("./utils/bootstrapUtils"), h = require("./utils/StyleConfig"); function m(e) { return e && e.__esModule ? e : { default: e } } var q = function (e) { function t() { return (0, u.default)(this, t), (0, a.default)(this, e.apply(this, arguments)) } return (0, o.default)(t, e), t.prototype.render = function () { var e = this.props, t = e.className, l = (0, s.default)(e, ["className"]), u = (0, c.splitBsProps)(l), i = u[0], a = u[1], n = (0, c.getClassSet)(i); return b.default.createElement("div", (0, r.default)({}, a, { className: (0, d.default)(t, n) })) }, t }(b.default.Component); exports.default = (0, c.bsClass)("well", (0, c.bsSizes)([h.Size.LARGE, h.Size.SMALL], q)), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "./utils/bootstrapUtils": "t+qF", "./utils/StyleConfig": "uE08" }], "17Bp": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = o(require("react")), t = a(require("../../components/tab/Tabs")), n = a(require("../../components/tab/Tab")), r = a(require("axios")); function a(e) { return e && e.__esModule ? e : { default: e } } function o(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; r.get || r.set ? Object.defineProperty(t, n, r) : t[n] = e[n] } return t.default = e, t } function l(e) { return (l = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function s(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function c(e, t, n) { return t && i(e.prototype, t), n && i(e, n), e } function u(e, t) { return !t || "object" !== l(t) && "function" != typeof t ? f(e) : t } function h(e) { return (h = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function m(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && d(e, t) } function d(e, t) { return (d = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function f(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } var p = require("react-bootstrap/lib/Button"), y = require("react-bootstrap/lib/Modal"), b = require("react-bootstrap/lib/Well"), E = function (a) { function o(e, t) { var n; return s(this, o), (n = u(this, h(o).call(this, e, t))).handleShow = n.handleShow.bind(f(f(n))), n.handleClose = n.handleClose.bind(f(f(n))), n.state = { show: !1, licenses: [] }, n } return m(o, e.Component), c(o, [{ key: "handleClose", value: function () { this.setState({ show: !1 }) } }, { key: "handleShow", value: function () { this.setState({ show: !0 }), this.fetchLicenses() } }, { key: "componentDidMount", value: function () { } }, { key: "fetchLicenses", value: function () { var e = this; 0 === this.state.licenses.length && r.default.get("licenses.json").then(function (t) { e.setState({ licenses: t.data }) }) } }, { key: "render", value: function () { var r = this.state.licenses, a = r.map(function (t, n) { var r = t.key, a = void 0 === r ? "" : r, o = t.repository, l = void 0 === o ? "" : o, s = t.licenses, i = void 0 === s ? "" : s, c = t.contents, u = void 0 === c ? "" : c, h = null; return u.trim() && (h = e.createElement(b, { bsSize: "large" }, u.split("\n").map(function (t, n) { return e.createElement("span", { key: n }, t, e.createElement("br", null)) }))), e.createElement("div", { key: n }, e.createElement("a", { href: l, rel: "noopener", target: "_blank" }, " ", e.createElement("h3", null, a, " (", i, ")")), h) }); return e.createElement("div", null, e.createElement("div", { className: "terms-control" }, e.createElement("a", { className: "copyright", onClick: this.handleShow, target: "_blank" }, "©"), e.createElement("a", { className: "logo", href: "https://unda.com.au/", target: "_blank" }, "Unda"), e.createElement("a", { className: "logo", href: "https://royssheds.com.au/", target: "_blank" }, "Roys Sheds, Perth, WA")), e.createElement(y, { show: this.state.show, onHide: this.handleClose }, e.createElement(y.Header, { closeButton: !0 }, e.createElement(y.Title, null, "About")), e.createElement(y.Body, null, e.createElement(t.default, { id: "about-tabs", defaultActiveKey: "tab-0", animation: !1 }, e.createElement(n.default, { eventKey: "tab-0", title: "EULA" }, this.eula()), e.createElement(n.default, { eventKey: "tab-1", title: "Privacy and Desclaimer" }, e.createElement("br", null), e.createElement(p, { href: "https://royssheds.com.au/privacy-policy", target: "_blank" }, "Privacy Policy"), e.createElement("br", null), e.createElement("br", null), e.createElement(p, { href: "https://royssheds.com.au/disclaimer", target: "_blank" }, "Disclaimer")), e.createElement(n.default, { eventKey: "tab-2", title: "Third Party Licenses" }, r.length > 0 ? a : "Loading licenses..."))), e.createElement(y.Footer, null, e.createElement(p, { onClick: this.handleClose }, "Close")))) } }, { key: "eula", value: function () { return e.createElement("span", null, e.createElement("h3", null, "End-User License Agreement (EULA) of ", e.createElement("span", null, "Web Shed")), e.createElement("p", null, 'This End-User License Agreement ("EULA") is a legal agreement between you and ', e.createElement("span", null, "Roys Sheds")), e.createElement("p", null, "This EULA agreement governs your acquisition and use of our ", e.createElement("span", null, "Web Shed"), ' software ("Software") directly from ', e.createElement("span", null, "Roys Sheds"), " or indirectly through a ", e.createElement("span", null, "Roys Sheds"), ' authorized reseller or distributor (a "Reseller").'), e.createElement("p", null, "Please read this EULA agreement carefully before completing the installation process and using the ", e.createElement("span", null, "Web Shed"), " software. It provides a license to use the ", e.createElement("span", null, "Web Shed"), " software and contains warranty information and liability disclaimers."), e.createElement("p", null, "If you register for a free trial of the ", e.createElement("span", null, "Web Shed"), ' software, this EULA agreement will also govern that trial. By clicking "accept" or installing and/or using the ', e.createElement("span", null, "Web Shed"), " software, you are confirming your acceptance of the Software and agreeing to become bound by the terms of this EULA agreement."), e.createElement("p", null, "If you are entering into this EULA agreement on behalf of a company or other legal entity, you represent that you have the authority to bind such entity and its affiliates to these terms and conditions. If you do not have such authority or if you do not agree with the terms and conditions of this EULA agreement, do not install or use the Software, and you must not accept this EULA agreement."), e.createElement("p", null, "This EULA agreement shall apply only to the Software supplied by ", e.createElement("span", null, "Roys Sheds"), " herewith regardless of whether other software is referred to or described herein. The terms also apply to any ", e.createElement("span", null, "Roys Sheds"), " updates, supplements, Internet-based services, and support services for the Software, unless other terms accompany those items on delivery. If so, those terms apply."), e.createElement("h3", null, "License Grant"), e.createElement("p", null, e.createElement("span", null, "Roys Sheds"), " hereby grants you a personal, non-transferable, non-exclusive licence to use the ", e.createElement("span", null, "Web Shed"), " software on your devices in accordance with the terms of this EULA agreement."), e.createElement("p", null, "You are permitted to load the ", e.createElement("span", null, "Web Shed"), " software (for example a PC, laptop, mobile or tablet) under your control. You are responsible for ensuring your device meets the minimum requirements of the ", e.createElement("span", null, "Web Shed"), " software."), e.createElement("p", null, "You are not permitted to:"), e.createElement("ul", null, e.createElement("li", null, "Edit, alter, modify, adapt, translate or otherwise change the whole or any part of the Software nor permit the whole or any part of the Software to be combined with or become incorporated in any other software, nor decompile, disassemble or reverse engineer the Software or attempt to do any such things"), e.createElement("li", null, "Reproduce, copy, distribute, resell or otherwise use the Software for any commercial purpose"), e.createElement("li", null, "Allow any third party to use the Software on behalf of or for the benefit of any third party"), e.createElement("li", null, "Use the Software in any way which breaches any applicable local, national or international law"), e.createElement("li", null, "use the Software for any purpose that ", e.createElement("span", null, "Roys Sheds"), " considers is a breach of this EULA agreement")), e.createElement("h3", null, "Intellectual Property and Ownership"), e.createElement("p", null, e.createElement("span", null, "Roys Sheds"), " shall at all times retain ownership of the Software as originally downloaded by you and all subsequent downloads of the Software by you. The Software (and the copyright, and other intellectual property rights of whatever nature in the Software, including any modifications made thereto) are and shall remain the property of ", e.createElement("span", null, "Roys Sheds"), "."), e.createElement("p", null, e.createElement("span", null, "Roys Sheds"), " reserves the right to grant licences to use the Software to third parties."), e.createElement("h3", null, "Termination"), e.createElement("p", null, "This EULA agreement is effective from the date you first use the Software and shall continue until terminated. You may terminate it at any time upon written notice to ", e.createElement("span", null, "Roys Sheds"), "."), e.createElement("p", null, "It will also terminate immediately if you fail to comply with any term of this EULA agreement. Upon such termination, the licenses granted by this EULA agreement will immediately terminate and you agree to stop all access and use of the Software. The provisions that by their nature continue and survive will survive any termination of this EULA agreement."), e.createElement("h3", null, "Governing Law"), e.createElement("p", null, "This EULA agreement, and any dispute arising out of or in connection with this EULA agreement, shall be governed by and construed in accordance with the laws of ", e.createElement("span", null, "Australia"), ".")) } }]), o }(); exports.default = E;
    }, { "react": "1n8/", "react-bootstrap/lib/Button": "2PkR", "react-bootstrap/lib/Modal": "fdwO", "react-bootstrap/lib/Well": "Fity", "../../components/tab/Tabs": "PfJX", "../../components/tab/Tab": "cbd5", "axios": "dZBD" }], "ApBt": [function (require, module, exports) {
        module.exports = "/loading.5843dd16.svg";
    }, {}], "BPUt": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = o(require("react")), t = require("mobx-react"), r = n(require("../../../images/loading.svg")); function n(e) { return e && e.__esModule ? e : { default: e } } function o(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function c(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function u(e, t, r) { return t && c(e.prototype, t), r && c(e, r), e } function f(e, t) { return !t || "object" !== y(t) && "function" != typeof t ? l(e) : t } function l(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function a(e) { return (a = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function p(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && s(e, t) } function s(e, t) { return (s = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function y(e) { return (y = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var b = function (e, t, r, n) { var o, i = arguments.length, c = i < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, r) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : y(Reflect)) && "function" == typeof Reflect.decorate) c = Reflect.decorate(e, t, r, n); else for (var u = e.length - 1; u >= 0; u--)(o = e[u]) && (c = (i < 3 ? o(c) : i > 3 ? o(t, r, c) : o(t, r)) || c); return i > 3 && c && Object.defineProperty(t, r, c), c }, d = function (t) { function n() { return i(this, n), f(this, a(n).apply(this, arguments)) } return p(n, e.Component), u(n, [{ key: "render", value: function () { var t = this.props.request.loading; return e.createElement("div", { className: "loading-control ".concat(t ? "loading-show" : "") }, t ? e.createElement("img", { className: "loading-icon", src: r.default }) : null) } }]), n }(), O = d = b([(0, t.inject)("request"), t.observer], d); exports.default = O;
    }, { "react": "1n8/", "mobx-react": "lQiT", "../../../images/loading.svg": "ApBt" }], "C/+9": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = r(require("react")), t = require("mobx-react"); function r(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; o.get || o.set ? Object.defineProperty(t, r, o) : t[r] = e[r] } return t.default = e, t } function o(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function n(e, t) { for (var r = 0; r < t.length; r++) { var o = t[r]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function i(e, t, r) { return t && n(e.prototype, t), r && n(e, r), e } function u(e, t) { return !t || "object" !== s(t) && "function" != typeof t ? c(e) : t } function c(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function a(e) { return (a = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function l(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && f(e, t) } function f(e, t) { return (f = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function s(e) { return (s = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var p = function (e, t, r, o) { var n, i = arguments.length, u = i < 3 ? t : null === o ? o = Object.getOwnPropertyDescriptor(t, r) : o; if ("object" === ("undefined" == typeof Reflect ? "undefined" : s(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(e, t, r, o); else for (var c = e.length - 1; c >= 0; c--)(n = e[c]) && (u = (i < 3 ? n(u) : i > 3 ? n(t, r, u) : n(t, r)) || u); return i > 3 && u && Object.defineProperty(t, r, u), u }, y = require("react-bootstrap/lib/Button"), h = require("react-bootstrap/lib/Modal"), d = function (t) { function r(e, t) { var n; return o(this, r), (n = u(this, a(r).call(this, e, t))).state = { show: !1 }, n } return l(r, e.Component), i(r, [{ key: "show", value: function () { this.setState({ show: !0 }) } }, { key: "hide", value: function () { this.setState({ show: !1 }) } }, { key: "load", value: function () { var e = this; this.state.show && !this.promise && (this.promise = require("_bundle_loader")(require.resolve("./Share")).then(function (t) { e.setState({ Share: t.default }) }).catch(function () { e.promise = void 0 })) } }, { key: "componentDidUpdate", value: function () { this.load() } }, { key: "componentDidMount", value: function () { this.load() } }, { key: "render", value: function () { var t = this, r = this.props.shed, o = this.state.Share, n = void 0 === o ? function () { return null } : o, i = function () { t.hide() }; return e.createElement(h, { show: this.state.show, onHide: i }, e.createElement(h.Header, { closeButton: !0 }, e.createElement(h.Title, null, "Share")), e.createElement(h.Body, null, e.createElement(n, { shed: r })), e.createElement(h.Footer, null, e.createElement(y, { onClick: i }, "Close"))) } }]), r }(), b = d = p([t.observer], d); exports.default = b;
    }, { "react": "1n8/", "mobx-react": "lQiT", "react-bootstrap/lib/Button": "2PkR", "react-bootstrap/lib/Modal": "fdwO", "_bundle_loader": "21/1", "./Share": [["Share.87e8361f.js", "qKsY"], "qKsY"] }], "Kkzo": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = T(e), r = require("babel-runtime/helpers/objectWithoutProperties"), l = T(r), s = require("babel-runtime/helpers/classCallCheck"), a = T(s), o = require("babel-runtime/helpers/possibleConstructorReturn"), u = T(o), f = require("babel-runtime/helpers/inherits"), i = T(f), p = require("classnames"), n = T(p), d = require("react"), m = T(d), c = require("prop-types"), b = T(c), h = require("prop-types-extra/lib/isRequiredForA11y"), y = T(h), O = require("./utils/bootstrapUtils"); function T(e) { return e && e.__esModule ? e : { default: e } } var q = { id: (0, y.default)(b.default.oneOfType([b.default.string, b.default.number])), placement: b.default.oneOf(["top", "right", "bottom", "left"]), positionTop: b.default.oneOfType([b.default.number, b.default.string]), positionLeft: b.default.oneOfType([b.default.number, b.default.string]), arrowOffsetTop: b.default.oneOfType([b.default.number, b.default.string]), arrowOffsetLeft: b.default.oneOfType([b.default.number, b.default.string]) }, g = { placement: "right" }, x = function (e) { function r() { return (0, a.default)(this, r), (0, u.default)(this, e.apply(this, arguments)) } return (0, i.default)(r, e), r.prototype.render = function () { var e, r = this.props, s = r.placement, a = r.positionTop, o = r.positionLeft, u = r.arrowOffsetTop, f = r.arrowOffsetLeft, i = r.className, p = r.style, d = r.children, c = (0, l.default)(r, ["placement", "positionTop", "positionLeft", "arrowOffsetTop", "arrowOffsetLeft", "className", "style", "children"]), b = (0, O.splitBsProps)(c), h = b[0], y = b[1], T = (0, t.default)({}, (0, O.getClassSet)(h), ((e = {})[s] = !0, e)), q = (0, t.default)({ top: a, left: o }, p), g = { top: u, left: f }; return m.default.createElement("div", (0, t.default)({}, y, { role: "tooltip", className: (0, n.default)(i, T), style: q }), m.default.createElement("div", { className: (0, O.prefix)(h, "arrow"), style: g }), m.default.createElement("div", { className: (0, O.prefix)(h, "inner") }, d)) }, r }(m.default.Component); x.propTypes = q, x.defaultProps = g, exports.default = (0, O.bsClass)("tooltip", x), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "prop-types-extra/lib/isRequiredForA11y": "91/V", "./utils/bootstrapUtils": "t+qF" }], "J6TN": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = f; var e = require("./contains"), t = u(e), i = require("./isWindow"), o = u(i), l = require("../ownerDocument"), n = u(l); function u(e) { return e && e.__esModule ? e : { default: e } } function f(e) { var i = (0, n.default)(e), l = (0, o.default)(i), u = i && i.documentElement, f = { top: 0, left: 0, height: 0, width: 0 }; if (i) return (0, t.default)(u, e) ? (void 0 !== e.getBoundingClientRect && (f = e.getBoundingClientRect()), f = { top: f.top + (l.pageYOffset || u.scrollTop) - (u.clientTop || 0), left: f.left + (l.pageXOffset || u.scrollLeft) - (u.clientLeft || 0), width: (null == f.width ? e.offsetWidth : f.width) || 0, height: (null == f.height ? e.offsetHeight : f.height) || 0 }) : f } module.exports = exports.default;
    }, { "./contains": "MdZy", "./isWindow": "2bOG", "../ownerDocument": "r4LY" }], "IqS7": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = a; var e = require("../ownerDocument"), t = u(e), r = require("../style"), o = u(r); function u(e) { return e && e.__esModule ? e : { default: e } } function n(e) { return e.nodeName && e.nodeName.toLowerCase() } function a(e) { for (var r = (0, t.default)(e), u = e && e.offsetParent; u && "html" !== n(e) && "static" === (0, o.default)(u, "position");)u = u.offsetParent; return u || r.documentElement } module.exports = exports.default;
    }, { "../ownerDocument": "r4LY", "../style": "cZJ7" }], "3G/1": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = l; var e = require("./isWindow"), t = o(e); function o(e) { return e && e.__esModule ? e : { default: e } } function l(e, o) { var l = (0, t.default)(e); if (void 0 === o) return l ? "pageYOffset" in l ? l.pageYOffset : l.document.documentElement.scrollTop : e.scrollTop; l ? l.scrollTo("pageXOffset" in l ? l.pageXOffset : l.document.documentElement.scrollLeft, o) : e.scrollTop = o } module.exports = exports.default;
    }, { "./isWindow": "2bOG" }], "vrkR": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = l; var e = require("./isWindow"), t = o(e); function o(e) { return e && e.__esModule ? e : { default: e } } function l(e, o) { var l = (0, t.default)(e); if (void 0 === o) return l ? "pageXOffset" in l ? l.pageXOffset : l.document.documentElement.scrollLeft : e.scrollLeft; l ? l.scrollTo(o, "pageYOffset" in l ? l.pageYOffset : l.document.documentElement.scrollTop) : e.scrollLeft = o } module.exports = exports.default;
    }, { "./isWindow": "2bOG" }], "EAAE": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }); var e = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) { var r = arguments[t]; for (var o in r) Object.prototype.hasOwnProperty.call(r, o) && (e[o] = r[o]) } return e }; exports.default = c; var t = require("./offset"), r = s(t), o = require("./offsetParent"), a = s(o), f = require("./scrollTop"), l = s(f), u = require("./scrollLeft"), n = s(u), d = require("../style"), i = s(d); function s(e) { return e && e.__esModule ? e : { default: e } } function p(e) { return e.nodeName && e.nodeName.toLowerCase() } function c(t, o) { var f, u = { top: 0, left: 0 }; return "fixed" === (0, i.default)(t, "position") ? f = t.getBoundingClientRect() : (o = o || (0, a.default)(t), f = (0, r.default)(t), "html" !== p(o) && (u = (0, r.default)(o)), u.top += parseInt((0, i.default)(o, "borderTopWidth"), 10) - (0, l.default)(o) || 0, u.left += parseInt((0, i.default)(o, "borderLeftWidth"), 10) - (0, n.default)(o) || 0), e({}, f, { top: f.top - u.top - (parseInt((0, i.default)(t, "marginTop"), 10) || 0), left: f.left - u.left - (parseInt((0, i.default)(t, "marginLeft"), 10) || 0) }) } module.exports = exports.default;
    }, { "./offset": "J6TN", "./offsetParent": "IqS7", "./scrollTop": "3G/1", "./scrollLeft": "vrkR", "../style": "cZJ7" }], "lC38": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0, exports.default = s; var e = require("dom-helpers/query/offset"), t = l(e), o = require("dom-helpers/query/position"), r = l(o), i = require("dom-helpers/query/scrollTop"), d = l(i), u = require("./ownerDocument"), f = l(u); function l(e) { return e && e.__esModule ? e : { default: e } } function n(e) { var o = void 0, r = void 0, i = void 0; if ("BODY" === e.tagName) o = window.innerWidth, r = window.innerHeight, i = (0, d.default)((0, f.default)(e).documentElement) || (0, d.default)(e); else { var u = (0, t.default)(e); o = u.width, r = u.height, i = (0, d.default)(e) } return { width: o, height: r, scroll: i } } function a(e, t, o, r) { var i = n(o), d = i.scroll, u = i.height, f = e - r - d, l = e + r - d + t; return f < 0 ? -f : l > u ? u - l : 0 } function h(e, t, o, r) { var i = n(o).width, d = e - r, u = e + r + t; return d < 0 ? -d : u > i ? i - u : 0 } function s(e, o, i, d, u) { var f = "BODY" === d.tagName ? (0, t.default)(i) : (0, r.default)(i, d), l = (0, t.default)(o), n = l.height, s = l.width, p = void 0, v = void 0, c = void 0, w = void 0; if ("left" === e || "right" === e) { v = f.top + (f.height - n) / 2, p = "left" === e ? f.left - s : f.left + f.width; var m = a(v, n, d, u); v += m, w = 50 * (1 - 2 * m / n) + "%", c = void 0 } else { if ("top" !== e && "bottom" !== e) throw new Error('calcOverlayPosition(): No such placement of "' + e + '" found.'); p = f.left + (f.width - s) / 2, v = "top" === e ? f.top - n : f.top + f.height; var g = h(p, s, d, u); p += g, c = 50 * (1 - 2 * g / s) + "%", w = void 0 } return { positionLeft: p, positionTop: v, arrowOffsetLeft: c, arrowOffsetTop: w } } module.exports = exports.default;
    }, { "dom-helpers/query/offset": "J6TN", "dom-helpers/query/position": "EAAE", "dom-helpers/query/scrollTop": "3G/1", "./ownerDocument": "B7R5" }], "2xwR": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var t = Object.assign || function (t) { for (var e = 1; e < arguments.length; e++) { var o = arguments[e]; for (var n in o) Object.prototype.hasOwnProperty.call(o, n) && (t[n] = o[n]) } return t }, e = require("classnames"), o = g(e), n = require("prop-types"), r = g(n), i = require("prop-types-extra/lib/componentOrElement"), a = g(i), s = require("react"), p = g(s), l = require("react-dom"), u = g(l), f = require("./utils/calculatePosition"), c = g(f), d = require("./utils/getContainer"), h = g(d), y = require("./utils/ownerDocument"), m = g(y); function g(t) { return t && t.__esModule ? t : { default: t } } function O(t, e) { var o = {}; for (var n in t) e.indexOf(n) >= 0 || Object.prototype.hasOwnProperty.call(t, n) && (o[n] = t[n]); return o } function P(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } function b(t, e) { if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !e || "object" != typeof e && "function" != typeof e ? t : e } function T(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, enumerable: !1, writable: !0, configurable: !0 } }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e) } var v = function (e) { function n(t, o) { P(this, n); var r = b(this, e.call(this, t, o)); return r.getTarget = function () { var t = r.props.target, e = "function" == typeof t ? t() : t; return e && u.default.findDOMNode(e) || null }, r.maybeUpdatePosition = function (t) { var e = r.getTarget(); (r.props.shouldUpdatePosition || e !== r._lastTarget || t) && r.updatePosition(e) }, r.state = { positionLeft: 0, positionTop: 0, arrowOffsetLeft: null, arrowOffsetTop: null }, r._needsFlush = !1, r._lastTarget = null, r } return T(n, e), n.prototype.componentDidMount = function () { this.updatePosition(this.getTarget()) }, n.prototype.componentWillReceiveProps = function () { this._needsFlush = !0 }, n.prototype.componentDidUpdate = function (t) { this._needsFlush && (this._needsFlush = !1, this.maybeUpdatePosition(this.props.placement !== t.placement)) }, n.prototype.render = function () { var e = this.props, n = e.children, r = e.className, i = O(e, ["children", "className"]), a = this.state, l = a.positionLeft, u = a.positionTop, f = O(a, ["positionLeft", "positionTop"]); delete i.target, delete i.container, delete i.containerPadding, delete i.shouldUpdatePosition; var c = p.default.Children.only(n); return (0, s.cloneElement)(c, t({}, i, f, { positionLeft: l, positionTop: u, className: (0, o.default)(r, c.props.className), style: t({}, c.props.style, { left: l, top: u }) })) }, n.prototype.updatePosition = function (t) { if (this._lastTarget = t, t) { var e = u.default.findDOMNode(this), o = (0, h.default)(this.props.container, (0, m.default)(this).body); this.setState((0, c.default)(this.props.placement, e, t, o, this.props.containerPadding)) } else this.setState({ positionLeft: 0, positionTop: 0, arrowOffsetLeft: null, arrowOffsetTop: null }) }, n }(p.default.Component); v.propTypes = { target: r.default.oneOfType([a.default, r.default.func]), container: r.default.oneOfType([a.default, r.default.func]), containerPadding: r.default.number, placement: r.default.oneOf(["top", "right", "bottom", "left"]), shouldUpdatePosition: r.default.bool }, v.displayName = "Position", v.defaultProps = { containerPadding: 0, placement: "right", shouldUpdatePosition: !1 }, exports.default = v, module.exports = exports.default;
    }, { "classnames": "9qb7", "prop-types": "5D9O", "prop-types-extra/lib/componentOrElement": "V4yr", "react": "1n8/", "react-dom": "NKHc", "./utils/calculatePosition": "lC38", "./utils/getContainer": "HfI3", "./utils/ownerDocument": "B7R5" }], "PBS5": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("dom-helpers/query/contains"), t = c(e), o = require("prop-types"), n = c(o), r = require("react"), s = c(r), u = require("react-dom"), i = c(u), p = require("./utils/addEventListener"), a = c(p), d = require("./utils/ownerDocument"), l = c(d); function c(e) { return e && e.__esModule ? e : { default: e } } function f(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function m(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function h(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var y = 27; function v(e) { return 0 === e.button } function b(e) { return !!(e.metaKey || e.altKey || e.ctrlKey || e.shiftKey) } var C = function (e) { function o(n, r) { f(this, o); var s = m(this, e.call(this, n, r)); return s.addEventListeners = function () { var e = s.props.event, t = (0, l.default)(s); s.documentMouseCaptureListener = (0, a.default)(t, e, s.handleMouseCapture, !0), s.documentMouseListener = (0, a.default)(t, e, s.handleMouse), s.documentKeyupListener = (0, a.default)(t, "keyup", s.handleKeyUp) }, s.removeEventListeners = function () { s.documentMouseCaptureListener && s.documentMouseCaptureListener.remove(), s.documentMouseListener && s.documentMouseListener.remove(), s.documentKeyupListener && s.documentKeyupListener.remove() }, s.handleMouseCapture = function (e) { s.preventMouseRootClose = b(e) || !v(e) || (0, t.default)(i.default.findDOMNode(s), e.target) }, s.handleMouse = function (e) { !s.preventMouseRootClose && s.props.onRootClose && s.props.onRootClose(e) }, s.handleKeyUp = function (e) { e.keyCode === y && s.props.onRootClose && s.props.onRootClose(e) }, s.preventMouseRootClose = !1, s } return h(o, e), o.prototype.componentDidMount = function () { this.props.disabled || this.addEventListeners() }, o.prototype.componentDidUpdate = function (e) { !this.props.disabled && e.disabled ? this.addEventListeners() : this.props.disabled && !e.disabled && this.removeEventListeners() }, o.prototype.componentWillUnmount = function () { this.props.disabled || this.removeEventListeners() }, o.prototype.render = function () { return this.props.children }, o }(s.default.Component); C.displayName = "RootCloseWrapper", C.propTypes = { onRootClose: n.default.func, children: n.default.element, disabled: n.default.bool, event: n.default.oneOf(["click", "mousedown"]) }, C.defaultProps = { event: "click" }, exports.default = C, module.exports = exports.default;
    }, { "dom-helpers/query/contains": "MdZy", "prop-types": "5D9O", "react": "1n8/", "react-dom": "NKHc", "./utils/addEventListener": "MEoH", "./utils/ownerDocument": "B7R5" }], "u2Ed": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) { var n = arguments[t]; for (var o in n) Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o]) } return e }, t = require("prop-types"), n = c(t), o = require("prop-types-extra/lib/elementType"), r = c(o), i = require("react"), a = c(i), l = require("./Portal"), u = c(l), s = require("./Position"), d = c(s), p = require("./RootCloseWrapper"), f = c(p); function c(e) { return e && e.__esModule ? e : { default: e } } function h(e, t) { var n = {}; for (var o in e) t.indexOf(o) >= 0 || Object.prototype.hasOwnProperty.call(e, o) && (n[o] = e[o]); return n } function E(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function y(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function x(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var b = function (e) { function t(n, o) { E(this, t); var r = y(this, e.call(this, n, o)); return r.handleHidden = function () { var e; (r.setState({ exited: !0 }), r.props.onExited) && (e = r.props).onExited.apply(e, arguments) }, r.state = { exited: !n.show }, r.onHiddenListener = r.handleHidden.bind(r), r } return x(t, e), t.prototype.componentWillReceiveProps = function (e) { e.show ? this.setState({ exited: !1 }) : e.transition || this.setState({ exited: !0 }) }, t.prototype.render = function () { var e = this.props, t = e.container, n = e.containerPadding, o = e.target, r = e.placement, i = e.shouldUpdatePosition, l = e.rootClose, s = e.children, p = e.transition, c = h(e, ["container", "containerPadding", "target", "placement", "shouldUpdatePosition", "rootClose", "children", "transition"]); if (!(c.show || p && !this.state.exited)) return null; var E = s; if (E = a.default.createElement(d.default, { container: t, containerPadding: n, target: o, placement: r, shouldUpdatePosition: i }, E), p) { var y = c.onExit, x = c.onExiting, b = c.onEnter, v = c.onEntering, g = c.onEntered; E = a.default.createElement(p, { in: c.show, appear: !0, onExit: y, onExiting: x, onExited: this.onHiddenListener, onEnter: b, onEntering: v, onEntered: g }, E) } return l && (E = a.default.createElement(f.default, { onRootClose: c.onHide }, E)), a.default.createElement(u.default, { container: t }, E) }, t }(a.default.Component); b.propTypes = e({}, u.default.propTypes, d.default.propTypes, { show: n.default.bool, rootClose: n.default.bool, onHide: function (e) { var t = n.default.func; e.rootClose && (t = t.isRequired); for (var o = arguments.length, r = Array(o > 1 ? o - 1 : 0), i = 1; i < o; i++)r[i - 1] = arguments[i]; return t.apply(void 0, [e].concat(r)) }, transition: r.default, onEnter: n.default.func, onEntering: n.default.func, onEntered: n.default.func, onExit: n.default.func, onExiting: n.default.func, onExited: n.default.func }), exports.default = b, module.exports = exports.default;
    }, { "prop-types": "5D9O", "prop-types-extra/lib/elementType": "aemN", "react": "1n8/", "./Portal": "JDVy", "./Position": "2xwR", "./RootCloseWrapper": "PBS5" }], "q+5o": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/objectWithoutProperties"), t = C(e), r = require("babel-runtime/helpers/classCallCheck"), l = C(r), u = require("babel-runtime/helpers/possibleConstructorReturn"), n = C(u), a = require("babel-runtime/helpers/inherits"), o = C(a), i = require("babel-runtime/helpers/extends"), s = C(i), f = require("classnames"), d = C(f), p = require("react"), c = C(p), m = require("prop-types"), b = C(m), h = require("react-overlays/lib/Overlay"), q = C(h), y = require("prop-types-extra/lib/elementType"), x = C(y), E = require("./Fade"), v = C(E); function C(e) { return e && e.__esModule ? e : { default: e } } var g = (0, s.default)({}, q.default.propTypes, { show: b.default.bool, rootClose: b.default.bool, onHide: b.default.func, animation: b.default.oneOfType([b.default.bool, x.default]), onEnter: b.default.func, onEntering: b.default.func, onEntered: b.default.func, onExit: b.default.func, onExiting: b.default.func, onExited: b.default.func, placement: b.default.oneOf(["top", "right", "bottom", "left"]) }), T = { animation: v.default, rootClose: !1, show: !1, placement: "right" }, _ = function (e) { function r() { return (0, l.default)(this, r), (0, n.default)(this, e.apply(this, arguments)) } return (0, o.default)(r, e), r.prototype.render = function () { var e = this.props, r = e.animation, l = e.children, u = (0, t.default)(e, ["animation", "children"]), n = !0 === r ? v.default : r || null, a = void 0; return a = n ? l : (0, p.cloneElement)(l, { className: (0, d.default)(l.props.className, "in") }), c.default.createElement(q.default, (0, s.default)({}, u, { transition: n }), a) }, r }(c.default.Component); _.propTypes = g, _.defaultProps = T, exports.default = _, module.exports = exports.default;
    }, { "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "babel-runtime/helpers/extends": "T4f3", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "react-overlays/lib/Overlay": "u2Ed", "prop-types-extra/lib/elementType": "aemN", "./Fade": "UlEz" }], "aYu/": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/objectWithoutProperties"), t = H(e), o = require("babel-runtime/helpers/classCallCheck"), l = H(o), n = require("babel-runtime/helpers/possibleConstructorReturn"), r = H(n), u = require("babel-runtime/helpers/inherits"), a = H(u), i = require("babel-runtime/helpers/extends"), d = H(i), h = require("dom-helpers/query/contains"), s = H(h), f = require("react"), y = H(f), p = require("prop-types"), c = H(p), v = require("react-dom"), m = H(v), O = require("warning"), w = H(O), D = require("./Overlay"), _ = H(D), b = require("./utils/createChainedFunction"), S = H(b); function H(e) { return e && e.__esModule ? e : { default: e } } function g(e, t) { return Array.isArray(t) ? t.indexOf(e) >= 0 : e === t } var M = c.default.oneOf(["click", "hover", "focus"]), C = (0, d.default)({}, _.default.propTypes, { trigger: c.default.oneOfType([M, c.default.arrayOf(M)]), delay: c.default.number, delayShow: c.default.number, delayHide: c.default.number, defaultOverlayShown: c.default.bool, overlay: c.default.node.isRequired, onBlur: c.default.func, onClick: c.default.func, onFocus: c.default.func, onMouseOut: c.default.func, onMouseOver: c.default.func, target: c.default.oneOf([null]), onHide: c.default.oneOf([null]), show: c.default.oneOf([null]) }), T = { defaultOverlayShown: !1, trigger: ["hover", "focus"] }, q = function (e) { function o(t, n) { (0, l.default)(this, o); var u = (0, r.default)(this, e.call(this, t, n)); return u.handleToggle = u.handleToggle.bind(u), u.handleDelayedShow = u.handleDelayedShow.bind(u), u.handleDelayedHide = u.handleDelayedHide.bind(u), u.handleHide = u.handleHide.bind(u), u.handleMouseOver = function (e) { return u.handleMouseOverOut(u.handleDelayedShow, e, "fromElement") }, u.handleMouseOut = function (e) { return u.handleMouseOverOut(u.handleDelayedHide, e, "toElement") }, u._mountNode = null, u.state = { show: t.defaultOverlayShown }, u } return (0, a.default)(o, e), o.prototype.componentDidMount = function () { this._mountNode = document.createElement("div"), this.renderOverlay() }, o.prototype.componentDidUpdate = function () { this.renderOverlay() }, o.prototype.componentWillUnmount = function () { m.default.unmountComponentAtNode(this._mountNode), this._mountNode = null, clearTimeout(this._hoverShowDelay), clearTimeout(this._hoverHideDelay) }, o.prototype.handleDelayedHide = function () { var e = this; if (null != this._hoverShowDelay) return clearTimeout(this._hoverShowDelay), void (this._hoverShowDelay = null); if (this.state.show && null == this._hoverHideDelay) { var t = null != this.props.delayHide ? this.props.delayHide : this.props.delay; t ? this._hoverHideDelay = setTimeout(function () { e._hoverHideDelay = null, e.hide() }, t) : this.hide() } }, o.prototype.handleDelayedShow = function () { var e = this; if (null != this._hoverHideDelay) return clearTimeout(this._hoverHideDelay), void (this._hoverHideDelay = null); if (!this.state.show && null == this._hoverShowDelay) { var t = null != this.props.delayShow ? this.props.delayShow : this.props.delay; t ? this._hoverShowDelay = setTimeout(function () { e._hoverShowDelay = null, e.show() }, t) : this.show() } }, o.prototype.handleHide = function () { this.hide() }, o.prototype.handleMouseOverOut = function (e, t, o) { var l = t.currentTarget, n = t.relatedTarget || t.nativeEvent[o]; n && n === l || (0, s.default)(l, n) || e(t) }, o.prototype.handleToggle = function () { this.state.show ? this.hide() : this.show() }, o.prototype.hide = function () { this.setState({ show: !1 }) }, o.prototype.makeOverlay = function (e, t) { return y.default.createElement(_.default, (0, d.default)({}, t, { show: this.state.show, onHide: this.handleHide, target: this }), e) }, o.prototype.show = function () { this.setState({ show: !0 }) }, o.prototype.renderOverlay = function () { m.default.unstable_renderSubtreeIntoContainer(this, this._overlay, this._mountNode) }, o.prototype.render = function () { var e = this.props, o = e.trigger, l = e.overlay, n = e.children, r = e.onBlur, u = e.onClick, a = e.onFocus, i = e.onMouseOut, d = e.onMouseOver, h = (0, t.default)(e, ["trigger", "overlay", "children", "onBlur", "onClick", "onFocus", "onMouseOut", "onMouseOver"]); delete h.delay, delete h.delayShow, delete h.delayHide, delete h.defaultOverlayShown; var s = y.default.Children.only(n), p = s.props, c = {}; return this.state.show && (c["aria-describedby"] = l.props.id), c.onClick = (0, S.default)(p.onClick, u), g("click", o) && (c.onClick = (0, S.default)(c.onClick, this.handleToggle)), g("hover", o) && (c.onMouseOver = (0, S.default)(p.onMouseOver, d, this.handleMouseOver), c.onMouseOut = (0, S.default)(p.onMouseOut, i, this.handleMouseOut)), g("focus", o) && (c.onFocus = (0, S.default)(p.onFocus, a, this.handleDelayedShow), c.onBlur = (0, S.default)(p.onBlur, r, this.handleDelayedHide)), this._overlay = this.makeOverlay(l, h), (0, f.cloneElement)(s, c) }, o }(y.default.Component); q.propTypes = C, q.defaultProps = T, exports.default = q, module.exports = exports.default;
    }, { "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "babel-runtime/helpers/extends": "T4f3", "dom-helpers/query/contains": "MdZy", "react": "1n8/", "prop-types": "5D9O", "react-dom": "NKHc", "warning": "/sXU", "./Overlay": "q+5o", "./utils/createChainedFunction": "GYue" }], "Ke9n": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = a; var e = r(require("react")); function r(e) { if (e && e.__esModule) return e; var r = {}; if (null != e) for (var t in e) if (Object.prototype.hasOwnProperty.call(e, t)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, t) : {}; o.get || o.set ? Object.defineProperty(r, t, o) : r[t] = e[t] } return r.default = e, r } var t = require("react-bootstrap/lib/Tooltip"), o = require("react-bootstrap/lib/OverlayTrigger"); function a(r) { var a = r.children, l = r.text, n = r.placement, i = e.createElement(t, { id: l.toLocaleLowerCase().split(" ").join("-") }, e.createElement("span", null, l)); return e.createElement(o, { placement: n, overlay: i }, a) }
    }, { "react": "1n8/", "react-bootstrap/lib/Tooltip": "Kkzo", "react-bootstrap/lib/OverlayTrigger": "aYu/" }], "6m2x": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = f(require("react")), t = require("mobx-react"), n = s(require("../../Utils")), r = s(require("../../types/View")), l = s(require("react-dropzone")), o = s(require("screenfull")), a = s(require("./About")), i = s(require("./Loading")), c = s(require("./shareModal/ShareModal")), u = s(require("../../components/tooltip/Tooltip")); function s(e) { return e && e.__esModule ? e : { default: e } } function f(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var r = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, n) : {}; r.get || r.set ? Object.defineProperty(t, n, r) : t[n] = e[n] } return t.default = e, t } function d(e, t, n, r, l, o, a) { try { var i = e[o](a), c = i.value } catch (u) { return void n(u) } i.done ? t(c) : Promise.resolve(c).then(r, l) } function p(e) { return function () { var t = this, n = arguments; return new Promise(function (r, l) { var o = e.apply(t, n); function a(e) { d(o, r, l, a, i, "next", e) } function i(e) { d(o, r, l, a, i, "throw", e) } a(void 0) }) } } function m(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function h(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function b(e, t, n) { return t && h(e.prototype, t), n && h(e, n), e } function v(e, t) { return !t || "object" !== S(t) && "function" != typeof t ? w(e) : t } function g(e) { return (g = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function y(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && E(e, t) } function E(e, t) { return (E = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function w(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function S(e) { return (S = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var C = function (e, t, n, r) { var l, o = arguments.length, a = o < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, n) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : S(Reflect)) && "function" == typeof Reflect.decorate) a = Reflect.decorate(e, t, n, r); else for (var i = e.length - 1; i >= 0; i--)(l = e[i]) && (a = (o < 3 ? l(a) : o > 3 ? l(t, n, a) : l(t, n)) || a); return o > 3 && a && Object.defineProperty(t, n, a), a }, k = require("react-bootstrap/lib/Button"), O = require("react-bootstrap/lib/Glyphicon"), P = require("react-bootstrap/lib/ButtonGroup"), j = require("react-bootstrap/lib/ToggleButtonGroup"), x = require("react-bootstrap/lib/ButtonToolbar"), q = require("react-bootstrap/lib/ToggleButton"), N = function (t) { function s(t, r) { var l; return m(this, s), (l = v(this, g(s).call(this, t, r))).toggleFullScreen = l.toggleFullScreen.bind(w(w(l))), l.onFullScreenChange = l.onFullScreenChange.bind(w(w(l))), l.onViewChange = l.onViewChange.bind(w(w(l))), l.state = { dev: "true" === n.default.getParameterByName("dev"), fullscreen: o.default && o.default.isFullscreen }, l.shareModal = e.createRef(), l } return y(s, e.Component), b(s, [{ key: "onFullScreenChange", value: function () { this.setState({ fullscreen: o.default && o.default.isFullscreen }) } }, { key: "componentDidMount", value: function () { o.default && o.default.onchange(this.onFullScreenChange) } }, { key: "componentWillUnmount", value: function () { o.default && o.default.off("change", this.onFullScreenChange) } }, { key: "download", value: function () { var e = this.props.shed, t = e.width, n = e.height, r = e.length, l = "".concat(r, " x ").concat(t, "m x ").concat(n, "m.webshed"), o = e.toJson(), a = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(o, null, "\t")), i = document.getElementById("downloadAnchorElem"); i && (i.setAttribute("href", a), i.setAttribute("download", l), i.click()) } }, { key: "toggleFullScreen", value: function () { o.default && o.default.toggle() } }, { key: "onViewChange", value: function (e) { var t = e; this.props.shed.view = t } }, { key: "render", value: function () { var t = this, n = this.props, s = n.onNewClick, f = n.onLoadClick, d = n.onPdfClick, m = n.onImageClick, h = n.shed, b = null; this.state.dev && (b = e.createElement("div", null, e.createElement(k, { onClick: function () { t.download() } }, e.createElement(O, { glyph: "download" })), e.createElement("br", null), e.createElement("br", null), e.createElement(l.default, { onDrop: function (e) { e.forEach(function (e) { var t = new FileReader; t.onload = function () { var e = JSON.parse(t.result); delete e.writeId, delete e.readId, delete e.revision, h.fromJson(e) }, t.onabort = function () { return console.log("file reading was aborted") }, t.onerror = function () { return console.log("file reading has failed") }, t.readAsBinaryString(e) }) }, className: "file-upload", activeClassName: "file-upload-active", acceptClassName: "file-upload-accept", rejectClassName: "file-upload-reject", disabledStyle: {} }), e.createElement("br", null))); var v = null; o.default && (v = e.createElement(u.default, { placement: "right", text: this.state.fullscreen ? "Exit full screen" : "Full screen" }, e.createElement(k, { onClick: this.toggleFullScreen, bsSize: "small" }, e.createElement(O, { glyph: this.state.fullscreen ? "resize-small" : "resize-full" })))); var g = function () { var e = p(regeneratorRuntime.mark(function e() { var n, r; return regeneratorRuntime.wrap(function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (n = t.props.shed, !(r = t.shareModal.current)) { e.next = 7; break } if (n.isSaved) { e.next = 6; break } return e.next = 6, n.save(); case 6: r.show(); case 7: case "end": return e.stop() } }, e, this) })); return function () { return e.apply(this, arguments) } }(), y = null; return h.view === r.default.Edit && (y = e.createElement(x, null, e.createElement(P, { vertical: !0, bsSize: "small" }, e.createElement(k, { onClick: function () { h.zoomIn() } }, e.createElement(O, { glyph: "plus" })), e.createElement(k, { onClick: function () { h.zoomOut() } }, e.createElement(O, { glyph: "minus" }))))), e.createElement("div", { className: "controls-ui" }, e.createElement("div", { className: "top-left" }, e.createElement("a", { id: "downloadAnchorElem" }), b, e.createElement("div", { className: "main-toolbar" }, e.createElement(x, null, e.createElement(P, { vertical: !0, bsSize: "small" }, e.createElement(k, { onClick: function () { s() } }, "New"), e.createElement(k, { onClick: function () { f() } }, "Load"), e.createElement(k, { onClick: function () { h.save() } }, "Save"), e.createElement(k, { onClick: function () { g() } }, "Share"))), e.createElement(x, null, e.createElement(j, { value: h.view, onChange: this.onViewChange, type: "radio", name: "options", defaultValue: r.default.Edit, vertical: !0, bsSize: "small" }, e.createElement(q, { value: r.default.Edit }, "View"), e.createElement(q, { value: r.default.Plan }, "Plan"))), e.createElement(x, null, e.createElement(P, { vertical: !0, bsSize: "small" }, v, e.createElement(u.default, { placement: "right", text: h.transparent ? "Hide Internals" : "View Internals" }, e.createElement(k, { bsSize: "small", value: r.default.Plan, onClick: function () { h.transparent = !h.transparent } }, e.createElement(O, { glyph: h.transparent ? "eye-close" : "eye-open" }))), e.createElement(u.default, { placement: "right", text: "Export Image" }, e.createElement(k, { bsSize: "small", onClick: function () { m() } }, e.createElement(O, { glyph: "picture" }))), e.createElement(u.default, { placement: "right", text: "Export PDF" }, e.createElement(k, { bsSize: "small", onClick: function () { d() } }, e.createElement(O, { glyph: "print" }))))))), e.createElement("div", { className: "bottom-right" }, e.createElement(a.default, null)), e.createElement("div", { className: "top-right" }, e.createElement("div", { className: "main-toolbar" }, y)), e.createElement(i.default, null), e.createElement(c.default, { ref: this.shareModal, shed: h })) } }]), s }(), F = N = C([(0, t.inject)("shed", "editor"), t.observer], N); exports.default = F;
    }, { "react": "1n8/", "mobx-react": "lQiT", "../../Utils": "r8Tc", "../../types/View": "EZis", "react-bootstrap/lib/Button": "2PkR", "react-bootstrap/lib/Glyphicon": "FqSm", "react-bootstrap/lib/ButtonGroup": "ItNz", "react-bootstrap/lib/ToggleButtonGroup": "pKrx", "react-bootstrap/lib/ButtonToolbar": "Kzmh", "react-bootstrap/lib/ToggleButton": "SSCK", "react-dropzone": "pJc5", "screenfull": "BNKO", "./About": "17Bp", "./Loading": "BPUt", "./shareModal/ShareModal": "C/+9", "../../components/tooltip/Tooltip": "Ke9n" }], "yUTY": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = C(e), r = require("babel-runtime/helpers/objectWithoutProperties"), s = C(r), l = require("babel-runtime/helpers/classCallCheck"), u = C(l), a = require("babel-runtime/helpers/possibleConstructorReturn"), o = C(a), n = require("babel-runtime/helpers/inherits"), i = C(n), p = require("classnames"), c = C(p), d = require("react"), f = C(d), m = require("prop-types-extra/lib/elementType"), b = C(m), h = require("./utils/bootstrapUtils"); function C(e) { return e && e.__esModule ? e : { default: e } } var q = { componentClass: b.default }, x = { componentClass: "div" }, y = function (e) { function r() { return (0, u.default)(this, r), (0, o.default)(this, e.apply(this, arguments)) } return (0, i.default)(r, e), r.prototype.render = function () { var e = this.props, r = e.componentClass, l = e.className, u = (0, s.default)(e, ["componentClass", "className"]), a = (0, h.splitBsProps)(u), o = a[0], n = a[1], i = (0, h.getClassSet)(o); return f.default.createElement(r, (0, t.default)({}, n, { className: (0, c.default)(l, i) })) }, r }(f.default.Component); y.propTypes = q, y.defaultProps = x, exports.default = (0, h.bsClass)("row", y), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types-extra/lib/elementType": "aemN", "./utils/bootstrapUtils": "t+qF" }], "I7L6": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), r = q(e), t = require("babel-runtime/helpers/objectWithoutProperties"), l = q(t), s = require("babel-runtime/helpers/classCallCheck"), u = q(s), i = require("babel-runtime/helpers/possibleConstructorReturn"), o = q(i), a = require("babel-runtime/helpers/inherits"), n = q(a), p = require("classnames"), d = q(p), c = require("react"), f = q(c), b = require("prop-types"), m = q(b), h = require("./utils/bootstrapUtils"); function q(e) { return e && e.__esModule ? e : { default: e } } var x = { responsive: m.default.bool, rounded: m.default.bool, circle: m.default.bool, thumbnail: m.default.bool }, v = { responsive: !1, rounded: !1, circle: !1, thumbnail: !1 }, C = function (e) { function t() { return (0, u.default)(this, t), (0, o.default)(this, e.apply(this, arguments)) } return (0, n.default)(t, e), t.prototype.render = function () { var e, t = this.props, s = t.responsive, u = t.rounded, i = t.circle, o = t.thumbnail, a = t.className, n = (0, l.default)(t, ["responsive", "rounded", "circle", "thumbnail", "className"]), p = (0, h.splitBsProps)(n), c = p[0], b = p[1], m = ((e = {})[(0, h.prefix)(c, "responsive")] = s, e[(0, h.prefix)(c, "rounded")] = u, e[(0, h.prefix)(c, "circle")] = i, e[(0, h.prefix)(c, "thumbnail")] = o, e); return f.default.createElement("img", (0, r.default)({}, b, { className: (0, d.default)(a, m) })) }, t }(f.default.Component); C.propTypes = x, C.defaultProps = v, exports.default = (0, h.bsClass)("img", C), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "./utils/bootstrapUtils": "t+qF" }], "a4p2": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/core-js/object/values"), t = C(e), r = require("babel-runtime/helpers/extends"), l = C(r), a = require("babel-runtime/helpers/objectWithoutProperties"), s = C(a), u = require("babel-runtime/helpers/classCallCheck"), i = C(u), n = require("babel-runtime/helpers/possibleConstructorReturn"), d = C(n), o = require("babel-runtime/helpers/inherits"), p = C(o), f = require("classnames"), c = C(f), m = require("react"), b = C(m), h = require("prop-types"), y = C(h), q = require("./utils/bootstrapUtils"), v = require("./utils/StyleConfig"); function C(e) { return e && e.__esModule ? e : { default: e } } var x = { active: y.default.any, disabled: y.default.any, header: y.default.node, listItem: y.default.bool, onClick: y.default.func, href: y.default.string, type: y.default.string }, N = { listItem: !1 }, g = function (e) { function t() { return (0, i.default)(this, t), (0, d.default)(this, e.apply(this, arguments)) } return (0, p.default)(t, e), t.prototype.renderHeader = function (e, t) { return b.default.isValidElement(e) ? (0, m.cloneElement)(e, { className: (0, c.default)(e.props.className, t) }) : b.default.createElement("h4", { className: t }, e) }, t.prototype.render = function () { var e = this.props, t = e.active, r = e.disabled, a = e.className, u = e.header, i = e.listItem, n = e.children, d = (0, s.default)(e, ["active", "disabled", "className", "header", "listItem", "children"]), o = (0, q.splitBsProps)(d), p = o[0], f = o[1], m = (0, l.default)({}, (0, q.getClassSet)(p), { active: t, disabled: r }), h = void 0; return f.href ? h = "a" : f.onClick ? (h = "button", f.type = f.type || "button") : h = i ? "li" : "span", f.className = (0, c.default)(a, m), u ? b.default.createElement(h, f, this.renderHeader(u, (0, q.prefix)(p, "heading")), b.default.createElement("p", { className: (0, q.prefix)(p, "text") }, n)) : b.default.createElement(h, f, n) }, t }(b.default.Component); g.propTypes = x, g.defaultProps = N, exports.default = (0, q.bsClass)("list-group-item", (0, q.bsStyles)((0, t.default)(v.State), g)), module.exports = exports.default;
    }, { "babel-runtime/core-js/object/values": "Qujq", "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types": "5D9O", "./utils/bootstrapUtils": "t+qF", "./utils/StyleConfig": "uE08" }], "T+qr": [function (require, module, exports) {
        "use strict"; exports.__esModule = !0; var e = require("babel-runtime/helpers/extends"), t = x(e), r = require("babel-runtime/helpers/objectWithoutProperties"), l = x(r), u = require("babel-runtime/helpers/classCallCheck"), s = x(u), n = require("babel-runtime/helpers/possibleConstructorReturn"), i = x(n), a = require("babel-runtime/helpers/inherits"), o = x(a), p = require("classnames"), d = x(p), c = require("react"), f = x(c), m = require("prop-types-extra/lib/elementType"), h = x(m), b = require("./ListGroupItem"), C = x(b), q = require("./utils/bootstrapUtils"), v = require("./utils/ValidComponentChildren"), y = x(v); function x(e) { return e && e.__esModule ? e : { default: e } } var _ = { componentClass: h.default }; function N(e) { return e ? y.default.some(e, function (e) { return e.type !== C.default || e.props.href || e.props.onClick }) ? "div" : "ul" : "div" } var g = function (e) { function r() { return (0, s.default)(this, r), (0, i.default)(this, e.apply(this, arguments)) } return (0, o.default)(r, e), r.prototype.render = function () { var e = this.props, r = e.children, u = e.componentClass, s = void 0 === u ? N(r) : u, n = e.className, i = (0, l.default)(e, ["children", "componentClass", "className"]), a = (0, q.splitBsProps)(i), o = a[0], p = a[1], m = (0, q.getClassSet)(o), h = "ul" === s && y.default.every(r, function (e) { return e.type === C.default }); return f.default.createElement(s, (0, t.default)({}, p, { className: (0, d.default)(n, m) }), h ? y.default.map(r, function (e) { return (0, c.cloneElement)(e, { listItem: !0 }) }) : r) }, r }(f.default.Component); g.propTypes = _, exports.default = (0, q.bsClass)("list-group", g), module.exports = exports.default;
    }, { "babel-runtime/helpers/extends": "T4f3", "babel-runtime/helpers/objectWithoutProperties": "zCAL", "babel-runtime/helpers/classCallCheck": "dACh", "babel-runtime/helpers/possibleConstructorReturn": "VOrx", "babel-runtime/helpers/inherits": "ZKjc", "classnames": "9qb7", "react": "1n8/", "prop-types-extra/lib/elementType": "aemN", "./ListGroupItem": "a4p2", "./utils/bootstrapUtils": "t+qF", "./utils/ValidComponentChildren": "Zn90" }], "yMSs": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = r; var e = t(require("react")); function t(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function r(t) { var r = t.onClick; return e.createElement("button", { type: "button", className: "close", onClick: r }, e.createElement("span", { "aria-hidden": "true" }, "×")) }
    }, { "react": "1n8/" }], "VSk5": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = l(require("react")), t = require("mobx-react"), r = a(require("../../../components/tab/Tabs")), n = a(require("../../../components/tab/Tab")), o = a(require("../../../components/button/Close")); function a(e) { return e && e.__esModule ? e : { default: e } } function l(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function c(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function u(e, t, r) { return t && c(e.prototype, t), r && c(e, r), e } function s(e, t) { return !t || "object" !== b(t) && "function" != typeof t ? d(e) : t } function m(e) { return (m = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function f(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && p(e, t) } function p(e, t) { return (p = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } function d(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function b(e) { return (b = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var y = function (e, t, r, n) { var o, a = arguments.length, l = a < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, r) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : b(Reflect)) && "function" == typeof Reflect.decorate) l = Reflect.decorate(e, t, r, n); else for (var i = e.length - 1; i >= 0; i--)(o = e[i]) && (l = (a < 3 ? o(l) : a > 3 ? o(t, r, l) : o(t, r)) || l); return a > 3 && l && Object.defineProperty(t, r, l), l }, h = require("react-bootstrap/lib/Button"), v = require("react-bootstrap/lib/Modal"), g = require("react-bootstrap/lib/Row"), w = require("react-bootstrap/lib/Col"), E = require("react-bootstrap/lib/Image"), k = require("react-bootstrap/lib/ListGroup"), O = require("react-bootstrap/lib/Alert"); function S(t) { var r = t.title, n = t.src, o = t.onClick, a = function (e) { e.stopPropagation(), e.preventDefault(), o() }; return e.createElement(w, { className: "shed-list-item", sm: 6, md: 4 }, e.createElement("a", { href: "#", onClick: a }, e.createElement(E, { src: n, rounded: !0 })), e.createElement("h5", null, e.createElement("a", { href: "#", onClick: a }, r))) } var j = [{ name: "garaport", title: "15m x 10m Garaport" }, { name: "american-barn", title: "32m x 12m Barn" }, { name: "small-skillion", title: "6m x 6.6m Skillion" }, { name: "double-garage", title: "Double Garage" }, { name: "single-garage", title: "Single Garage" }, { name: "triple-sliding-door", title: "Triple Sliding Door" }, { name: "workshop", title: "Workshop" }, { name: "parking", title: "Parking Shed" }], P = function (t) { function a(e, t) { var r; return i(this, a), (r = s(this, m(a).call(this, e, t))).onSelect = r.onSelect.bind(d(d(r))), r.state = { show: !1, tabId: void 0 }, r } return f(a, e.Component), u(a, [{ key: "show", value: function (e) { this.setState({ show: !0, tabId: e }) } }, { key: "hide", value: function () { this.setState({ show: !1 }) } }, { key: "onSelect", value: function (e) { this.setState({ tabId: e }) } }, { key: "render", value: function () { var t = this, a = this.props, l = a.shed, i = a.saves, c = function () { t.hide() }, u = j.map(function (t, r) { var n = t.name, o = t.title; return e.createElement(S, { key: r, src: "".concat("templates", "/").concat(n, ".jpg"), title: o, onClick: function () { l.loadFromJson("".concat("templates", "/").concat(n, ".json")), c() } }) }), s = i.asArray().sort(function (e, t) { var r = new Date(e.date), n = new Date(t.date); return r > n ? -1 : r < n ? 1 : 0 }).map(function (t, r) { var n = t.length, a = t.width, u = t.height, s = t.date, m = new Date(s).toLocaleDateString("en-AU", { weekday: "long", year: "numeric", month: "long", day: "numeric", hour: "numeric" }); return e.createElement("a", { className: "list-group-item load-item", key: "load-".concat(r), onClick: function () { l.load(t.writeId, t.revision), c() } }, e.createElement("h5", null, "".concat(n, "m x ").concat(a, "m x ").concat(u, "m shed")), e.createElement("span", null, "Saved on ", m), e.createElement(o.default, { onClick: function (e) { e.preventDefault(), e.stopPropagation(), i.remove(t) } })) }); s = 0 === s.length ? [e.createElement(O, { key: "alert" }, e.createElement("h4", null, "You do not appear to have any saved sheds"))] : [e.createElement(k, { key: "listGroup" }, s)]; var m = null; return "demo" === this.state.tabId && (m = e.createElement("div", { className: "embed-responsive embed-responsive-16by9" }, e.createElement("iframe", { width: "560", height: "315", src: "https://www.youtube.com/embed/4jVfSiBbOU4", frameborder: "0", allow: "accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture", allowfullscreen: !0 }))), e.createElement(v, { bsSize: "large", show: this.state.show, onHide: c }, e.createElement(v.Header, { className: "empty-modal-header", closeButton: !0 }), e.createElement(v.Body, null, e.createElement(r.default, { activeKey: this.state.tabId, onSelect: this.onSelect, className: "new-shed-tabs", id: "new-shed" }, e.createElement(n.default, { eventKey: "new", title: "New" }, e.createElement(g, { className: "shed-list" }, e.createElement(S, { title: "Blank Shed", src: "".concat("templates", "/blank.jpg"), onClick: function () { l.blank(), c() } }), u)), e.createElement(n.default, { eventKey: "load", title: "Load" }, s), e.createElement(n.default, { eventKey: "demo", title: "Demo Video" }, m))), e.createElement(v.Footer, null, e.createElement(h, { onClick: c }, "Close"))) } }]), a }(), _ = P = y([t.observer], P); exports.default = _;
    }, { "react": "1n8/", "mobx-react": "lQiT", "react-bootstrap/lib/Button": "2PkR", "react-bootstrap/lib/Modal": "fdwO", "react-bootstrap/lib/Row": "yUTY", "react-bootstrap/lib/Col": "2mi8", "react-bootstrap/lib/Image": "I7L6", "react-bootstrap/lib/ListGroup": "T+qr", "react-bootstrap/lib/Alert": "VV+3", "../../../components/tab/Tabs": "PfJX", "../../../components/tab/Tab": "cbd5", "../../../components/button/Close": "yMSs" }], "ROXr": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = c(require("react")), t = require("mobx"), r = a(require("./scene/Scene")), n = a(require("./ui/UI")), o = a(require("./ui/Controls")), i = a(require("./ui/modals/NewShed")), u = a(require("../Utils")); function a(e) { return e && e.__esModule ? e : { default: e } } function c(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function s(e) { return (s = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function l(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function f(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function d(e, t, r) { return t && f(e.prototype, t), r && f(e, r), e } function p(e, t) { return !t || "object" !== s(t) && "function" != typeof t ? h(e) : t } function h(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function y(e) { return (y = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function v(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && b(e, t) } function b(e, t) { return (b = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } var m = function (a) { function c(t) { var r; return l(this, c), (r = p(this, y(c).call(this, t))).newShed = e.createRef(), r.scene = e.createRef(), r } return v(c, e.Component), d(c, [{ key: "componentDidMount", value: function () { var e = this.props, r = this.loadShed(), n = this.newShed.current; !r && n && n.show(); var o = e.app.stores.shed; (0, t.autorun)(function () { var e = "#"; o.readId && (e = "#".concat(o.writeId, "/").concat(o.revision)), history.replaceState(void 0, void 0, e) }) } }, { key: "loadShed", value: function () { var e = this.props.app.stores.shed, t = location.hash, r = u.default.getParameterByName("open"); if (t.startsWith("#")) { var n = location.hash.slice(1, location.hash.length).split("/"), o = n[0], i = parseInt(n[1], 10) || 0; if (o !== e.writeId || o !== e.readId || i !== e.revision) return e.load(o, i), !0 } else if (r) return e.loadFromJson(r), u.default.cleanUrl(), !0; return !1 } }, { key: "render", value: function () { var t = this, u = this.props.app.stores, a = u.shed, c = u.saves, s = u.editor, l = u.quote, f = function (e) { return function () { var r = t.newShed.current; r && r.show(e) } }; return e.createElement("div", null, e.createElement(n.default, { shed: a, editor: s, quote: l, key: "ui" }), e.createElement(r.default, { shed: a, editor: s, ref: this.scene, key: "scene" }, e.createElement(o.default, { shed: a, editor: s, onNewClick: f("new"), onLoadClick: f("load"), onPdfClick: function () { var e = t.scene.current; e && e.downloadPdf() }, onImageClick: function () { var e = t.scene.current; e && e.downloadImage() } })), e.createElement(i.default, { ref: this.newShed, shed: a, saves: c })) } }]), c }(); exports.default = m;
    }, { "react": "1n8/", "mobx": "6uYi", "./scene/Scene": "IMgQ", "./ui/UI": "kHbh", "./ui/Controls": "6m2x", "./ui/modals/NewShed": "VSk5", "../Utils": "r8Tc" }], "UxGm": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"); function t(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function o(e) { return (o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var r = function (e, t, r, n) { var l, f = arguments.length, c = f < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, r) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : o(Reflect)) && "function" == typeof Reflect.decorate) c = Reflect.decorate(e, t, r, n); else for (var a = e.length - 1; a >= 0; a--)(l = e[a]) && (c = (f < 3 ? l(c) : f > 3 ? l(t, r, c) : l(t, r)) || c); return f > 3 && c && Object.defineProperty(t, r, c), c }, n = function e(o) { t(this, e), this.baseUrl = o.baseUrl, this.localSaveKey = o.localSaveKey }; exports.default = n, r([e.observable], n.prototype, "baseUrl", void 0), r([e.observable], n.prototype, "localSaveKey", void 0);
    }, { "mobx": "6uYi" }], "ZPje": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.Sections = exports.default = void 0; var e = require("mobx"), t = r(require("./Section")), o = require("serializr"); function r(e) { return e && e.__esModule ? e : { default: e } } function i(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function n(e) { return (n = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var l = function (e, t, o, r) { var i, l = arguments.length, f = l < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, o) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : n(Reflect)) && "function" == typeof Reflect.decorate) f = Reflect.decorate(e, t, o, r); else for (var a = e.length - 1; a >= 0; a--)(i = e[a]) && (f = (l < 3 ? i(f) : l > 3 ? i(t, o, f) : i(t, o)) || f); return l > 3 && f && Object.defineProperty(t, o, f), f }, f = function e(t) { i(this, e); var o = t || {}, r = o.top, n = o.bottom, l = o.left, f = o.right; this.top = r, this.bottom = n, this.left = l, this.right = f }; exports.Sections = exports.default = f, l([(0, o.serializable)((0, o.object)(t.default)), e.observable], f.prototype, "top", void 0), l([(0, o.serializable)((0, o.object)(t.default)), e.observable], f.prototype, "bottom", void 0), l([(0, o.serializable)((0, o.object)(t.default)), e.observable], f.prototype, "left", void 0), l([(0, o.serializable)((0, o.object)(t.default)), e.observable], f.prototype, "right", void 0);
    }, { "mobx": "6uYi", "./Section": "t/JC", "serializr": "94gV" }], "0bKu": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = require("mobx"), e = o(require("./Section")), r = i(require("./Sections")), n = require("serializr"); function i(t) { return t && t.__esModule ? t : { default: t } } function o(t) { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var r in t) if (Object.prototype.hasOwnProperty.call(t, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(t, r) : {}; n.get || n.set ? Object.defineProperty(e, r, n) : e[r] = t[r] } return e.default = t, e } function u(t) { return f(t) || s(t) || c() } function c() { throw new TypeError("Invalid attempt to spread non-iterable instance") } function s(t) { if (Symbol.iterator in Object(t) || "[object Arguments]" === Object.prototype.toString.call(t)) return Array.from(t) } function f(t) { if (Array.isArray(t)) { for (var e = 0, r = new Array(t.length); e < t.length; e++)r[e] = t[e]; return r } } function a(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } function h(t, e) { for (var r = 0; r < e.length; r++) { var n = e[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n) } } function l(t, e, r) { return e && h(t.prototype, e), r && h(t, r), t } function d(t) { if (null == t) throw new TypeError("Cannot destructure undefined") } function g(t) { return (g = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(t) } var y = function (t, e, r, n) { var i, o = arguments.length, u = o < 3 ? e : null === n ? n = Object.getOwnPropertyDescriptor(e, r) : n; if ("object" === ("undefined" == typeof Reflect ? "undefined" : g(Reflect)) && "function" == typeof Reflect.decorate) u = Reflect.decorate(t, e, r, n); else for (var c = t.length - 1; c >= 0; c--)(i = t[c]) && (u = (o < 3 ? i(u) : o > 3 ? i(e, r, u) : i(e, r)) || u); return o > 3 && u && Object.defineProperty(e, r, u), u }; function p(t, e, r) { d(t), e(null, r.rootContext.target) } var v = function () { function t(e) { a(this, t), this.id = "grid"; var r = e || {}, n = r.width, i = void 0 === n ? 1 : n, o = r.height, u = void 0 === o ? 1 : o, c = r.shed; this.shed = c, this.grid = [], this.generate(i, u) } return l(t, [{ key: "getSections", value: function (t, e) { var r = this.grid; if (!(t < 0 || e < 0 || t >= r.length || e >= r[0].length)) return r[t][e] } }, { key: "generate", value: function (t, n) { this.grid = new Array(t - 1); for (var i = this.grid, o = 0; o < t; o++) { i[o] = new Array(n - 1); for (var u = i[o], c = 0; c < n; c++) { var s = void 0, f = this.createSection({ shed: this.shed, grid: this, direction: e.Direction.Horizontal, x: o, y: c + 1 }), a = void 0, h = this.createSection({ shed: this.shed, grid: this, direction: e.Direction.Vertical, x: o + 1, y: c }), l = c - 1; s = l >= 0 ? u[l].bottom : this.createSection({ shed: this.shed, grid: this, direction: e.Direction.Horizontal, x: o, y: c }); var d = o - 1; a = d >= 0 ? i[d][c].right : this.createSection({ shed: this.shed, grid: this, direction: e.Direction.Vertical, x: o, y: c }); var g = new r.default({ top: s, bottom: f, left: a, right: h, shed: this.shed }); u[c] = g } } } }, { key: "createSection", value: function (t) { return new e.default(t) } }, { key: "getRowSections", value: function (t) { var e = t, r = !0, n = this.rowSectionCount - 1; if (e === n) e-- , r = !1; else if (e > n) throw Error("Index out of bounds"); var i = []; return this.grid.forEach(function (t) { var n = t[e], o = n.top; r || (o = n.bottom), function (t) { i.push({ section: t }) }(o) }), i } }, { key: "getColumnSections", value: function (t) { var e = t, r = !0, n = this.columnSectionCount - 1; if (e === n) e-- , r = !1; else if (e > n) throw Error("Index out of bounds"); var i = this.grid[e], o = []; return i.forEach(function (t) { var e = t.left; r || (e = t.right), function (t) { o.push({ section: t }) }(e) }), o } }, { key: "width", set: function (t) { this.generate(t, this.height) }, get: function () { return this.grid.length } }, { key: "height", set: function (t) { this.generate(this.width, t) }, get: function () { return this.grid[0].length } }, { key: "totalSections", get: function () { var t = []; return this.grid.forEach(function (e) { e.forEach(function (e) { e && (t.push(e.top), t.push(e.bottom), t.push(e.right), t.push(e.left)) }) }), u(new Set(t)).length } }, { key: "rowSectionCount", get: function () { return this.grid[0].length + 1 } }, { key: "columnSectionCount", get: function () { return this.grid.length + 1 } }]), t }(); y([(0, n.serializable)((0, n.identifier)())], v.prototype, "id", void 0), y([(0, n.serializable)((0, n.list)((0, n.list)((0, n.object)(r.default)))), t.observable], v.prototype, "grid", void 0), y([(0, n.serializable)((0, n.reference)("id", p))], v.prototype, "shed", void 0); var b = v; exports.default = b;
    }, { "mobx": "6uYi", "./Section": "t/JC", "./Sections": "ZPje", "serializr": "94gV" }], "1IgF": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"), t = r(require("../views/render/babylon/RenderUtils")), o = require("serializr"); function r(e) { return e && e.__esModule ? e : { default: e } } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var o = 0; o < t.length; o++) { var r = t[o]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function l(e, t, o) { return t && i(e.prototype, t), o && i(e, o), e } function f(e) { return (f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var u = function (e, t, o, r) { var n, i = arguments.length, l = i < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, o) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : f(Reflect)) && "function" == typeof Reflect.decorate) l = Reflect.decorate(e, t, o, r); else for (var u = e.length - 1; u >= 0; u--)(n = e[u]) && (l = (i < 3 ? n(l) : i > 3 ? n(t, o, l) : n(t, o)) || l); return i > 3 && l && Object.defineProperty(t, o, l), l }, a = function () { function e() { n(this, e), this.roofPitch = 5, this.length = 4, this.heightOffset = .5, this.visible = !0 } return l(e, [{ key: "roofHeight", get: function () { return t.default.getOpposite(this.roofPitch, this.length) } }, { key: "roofLength", get: function () { return t.default.getDistance(this.length, this.roofHeight) } }]), e }(); exports.default = a, u([o.serializable, e.observable], a.prototype, "roofPitch", void 0), u([o.serializable, e.observable], a.prototype, "length", void 0), u([o.serializable, e.observable], a.prototype, "heightOffset", void 0), u([o.serializable, e.observable], a.prototype, "visible", void 0), u([e.computed], a.prototype, "roofHeight", null), u([e.computed], a.prototype, "roofLength", null);
    }, { "mobx": "6uYi", "../views/render/babylon/RenderUtils": "SyBU", "serializr": "94gV" }], "gupR": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = require("mobx"), i = g(require("../types/Sheeting")), e = g(require("../types/ShedType")), o = g(require("./Grid")), n = f(require("./Section")), s = g(require("./Awning")), r = g(require("../views/render/babylon/RenderUtils")), h = g(require("../types/View")), l = g(require("../Utils")), a = g(require("./Vector2")), u = require("serializr"); function f(t) { if (t && t.__esModule) return t; var i = {}; if (null != t) for (var e in t) if (Object.prototype.hasOwnProperty.call(t, e)) { var o = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(t, e) : {}; o.get || o.set ? Object.defineProperty(i, e, o) : i[e] = t[e] } return i.default = t, i } function g(t) { return t && t.__esModule ? t : { default: t } } function c(t, i) { if (!(t instanceof i)) throw new TypeError("Cannot call a class as a function") } function p(t, i) { for (var e = 0; e < i.length; e++) { var o = i[e]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(t, o.key, o) } } function d(t, i, e) { return i && p(t.prototype, i), e && p(t, e), t } function y(t) { return (y = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(t) } var v = function (t, i, e, o) { var n, s = arguments.length, r = s < 3 ? i : null === o ? o = Object.getOwnPropertyDescriptor(i, e) : o; if ("object" === ("undefined" == typeof Reflect ? "undefined" : y(Reflect)) && "function" == typeof Reflect.decorate) r = Reflect.decorate(t, i, e, o); else for (var h = t.length - 1; h >= 0; h--)(n = t[h]) && (r = (s < 3 ? n(r) : s > 3 ? n(i, e, r) : n(i, e)) || r); return s > 3 && r && Object.defineProperty(i, e, r), r }, b = function () { function f(t) { var r = this; c(this, f), this.revision = 0, this.id = "shed", this.version = "0.0.2", this.maxBaySize = 8, this.minBaySize = 1, this.maxWidth = 20, this.minWidth = 3, this.maxLength = 60, this.minLength = 1, this.maxHeight = 7, this.minHeight = 2.4, this.minAwningHeight = 1.8, this.minRoofPitch = 5, this.maxRoofPitch = 45, this.maxRotation = 4, this._rotation = 0, this._width = 10, this._height = 5, this._length = 20, this.concreteHeight = .2, this._roofPitch = 11, this._roofOffset = 0, this.doorColour = "basal", this.flashingColour = "basal", this.roofColour = "off-white", this.wallColour = "off-white", this.wallSheeting = i.default.Trimdek, this.roofSheeting = i.default.Trimdek, this.view = h.default.Edit, this.inertialRadiusOffset = 1, this.showLogo = !0, this.showRotationText = !0, this.showMeasurements = !0, this.transparent = !1, this.cameraPosition = new a.default(0, 0); var l = t || {}, u = l.maxWidth, g = void 0 === u ? this.maxWidth : u, p = l.minWidth, d = void 0 === p ? this.minWidth : p, y = l.maxLength, v = void 0 === y ? this.maxLength : y, b = l.minLength, m = void 0 === b ? this.minLength : b, w = l.maxHeight, R = void 0 === w ? this.maxHeight : w, k = l.minHeight, S = void 0 === k ? this.minHeight : k; this.app = t.app, this.maxBays = 30, this.maxWidth = g, this.minWidth = d, this.maxLength = v, this.minLength = m, this.maxHeight = R, this.minHeight = S, this._grid = new o.default({ width: 3, height: this.maxBays, shed: this }), this.awningRight = new s.default, this.awningLeft = new s.default; for (var z = [], A = 0; A < 4; A++) { for (var H = [], L = 0; L < this.maxBays - 1; L++)H.push(new n.default({ shed: this, x: A, y: L, grid: this._grid, direction: n.Direction.Roof })); z.push(H) } this._roofSections = z; for (var W = this._grid, x = W.columnSectionCount, P = 0; P < x; P++) { var _ = W.getColumnSections(P); 0 !== P && P !== x - 1 && _.forEach(function (t) { t.section.visible = !1 }) } for (var B = W.rowSectionCount, O = function (t) { W.getRowSections(t).forEach(function (i) { i.section.visible = 0 === t || t === r.gableWallCount - 1 }) }, C = 0; C < B; C++)O(C); this._baySizes = [], this.shedType = e.default.Gable, this.setAwningsVisible(!1), this._customBaySize = !1 } return d(f, [{ key: "zoomIn", value: function () { this.inertialRadiusOffset = 1 } }, { key: "zoomOut", value: function () { this.inertialRadiusOffset = -1 } }, { key: "switchSection", value: function (t, i) { t.forEach(function (t, e) { var o = t.section, n = i[e].section, s = o.models, r = o.visible; o.models = n.models, o.visible = n.visible, n.models = s, n.visible = r }) } }, { key: "clampHeight", value: function (t) { return l.default.clamp(t, this.minHeight, this.maxHeight) } }, { key: "clampRoofPitch", value: function (t) { return l.default.clamp(t, this.minRoofPitch, this.maxRoofPitch) } }, { key: "switchSections", value: function (t) { var i = this.gableWallCount, e = this.grid, o = i - t; if (0 !== o) if (o > 0) for (var n = 0; n < o; n++) { var s = t - 1 + n, r = e.getRowSections(s), h = e.getRowSections(s + 1); this.switchSection(r, h) } else if (o < 0) for (var l = 0; l < Math.abs(o); l++) { var a = t - 1 - l, u = e.getRowSections(a), f = e.getRowSections(a - 1); this.switchSection(u, f) } } }, { key: "clampWidth", value: function (t) { return l.default.clamp(t, this.minWidth, this.maxWidth) } }, { key: "getRoofY", value: function (t) { var i = this.height; return this.isSkillionLeft ? i += r.default.getOpposite(this.rightRoofPitch, this.rightRoofWidth - t) : this.isSkillionRight ? i += r.default.getOpposite(this.leftRoofPitch, t) : t <= this.rightRoofWidth ? i += r.default.getOpposite(this.rightRoofPitch, t) : t <= this.rightRoofWidth + this.leftRoofWidth && (i += r.default.getOpposite(this.leftRoofPitch, this.rightRoofWidth - (t - this.rightRoofWidth))), i } }, { key: "getAwningLeftRoofY", value: function (t) { return this.leftAwningGutterHeight + r.default.getOpposite(this.awningLeft.roofPitch, t) } }, { key: "getAwningRightRoofY", value: function (t) { var i = this.rightAwningGutterHeight, e = r.default.getOpposite(this.awningRight.roofPitch, t); return i + (this.awningRight.roofHeight - e) } }, { key: "getSections", value: function (t, i) { var e = t, o = i; return i === this.bayCount && (o = this.grid.height - 1), this.awningLeft.visible || e++ , this.grid.getSections(e, o) } }, { key: "getRoofSections", value: function (t) { var i = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1], e = this._roofSections, o = t; if (i) throw new Error("Error"); return e[o] } }, { key: "getGableSections", value: function (t) { var i = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1], e = t, o = this.grid.getRowSections(e).concat([]); return i && (this.awningRight.visible || o.splice(o.length - 1, 1), this.awningLeft.visible || o.splice(0, 1)), o } }, { key: "getGutterSections", value: function (t) { var i = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1], e = this.grid, o = t; i && (this.awningLeft.visible || o++); var n = e.getColumnSections(o).concat([]); return i ? n.splice(0, this.bayCount) : n } }, { key: "setAwningsVisible", value: function (t) { this.setAwningRightVisible(t), this.setAwningLeftVisible(t) } }, { key: "setAwningRightVisible", value: function (t) { this.awningRight.visible = t, this.isBarnType && this.setAwningRightEnclosed(t) } }, { key: "setAwningLeftVisible", value: function (t) { this.awningLeft.visible = t, this.isBarnType && this.setAwningLeftEnclosed(t) } }, { key: "setAwningEnclose", value: function (t, i, e, o) { for (var n = this, s = function (e) { n.getGutterSections(e, !1).forEach(function (n) { var s = n.section; e === t ? s.visible = o : e === i && (s.visible = !o) }) }, r = 0; r < this.gridGutterWallCount; r++)s(r);[0, this.gableWallCount - 1].forEach(function (t) { n.getGableSections(t, !1)[e].section.visible = o }) } }, { key: "setAwningLeftEnclosed", value: function (t) { this.setAwningEnclose(0, 1, 0, t) } }, { key: "setAwningRightEnclosed", value: function (t) { this.setAwningEnclose(3, 2, 2, t) } }, { key: "setAwningsHeightOffset", value: function (t) { this.awningRight.heightOffset = t, this.awningLeft.heightOffset = t } }, { key: "setAwningsRoofPitch", value: function (t) { this.awningRight.roofPitch = t, this.awningLeft.roofPitch = t } }, { key: "getDirection", value: function (t, i) { var e = { "top-right": 90, "bottom-right": 0, "bottom-left": -90, "top-left": 180 }, o = function (t, i) { return "".concat(t, "-").concat(i) }; return e[o(t, i)] || e[o(i, t)] } }, { key: "getRotationText", value: function (t) { var i = ["Front", "Right", "Back", "Left"]; return i[(this.rotation + t) % i.length] } }, { key: "blank", value: function () { var t = new f({ app: this.app }); this.fromJson(t.toJson()), this.writeId = void 0, this.readId = void 0, this.revision = 0 } }, { key: "save", value: function () { var t = this, i = this.app; return i.request.post("/sheds", this.toJson()).then(function (e) { var o = e.data, n = o.readId, s = o.revision, r = o.writeId; return t.writeId = r, t.readId = n, t.revision = s, i.stores.saves.add({ shed: t }), o }) } }, { key: "load", value: function (t) { var i = this, e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0; this.app.request.get("/sheds/".concat(t, "/").concat(e), this.toJson()).then(function (t) { i.fromJson(t.data) }) } }, { key: "loadFromJson", value: function (t) { var i = this; this.app.request.get(t, { baseURL: "" }).then(function (t) { i.fromJson(t.data), i.writeId = void 0, i.readId = void 0, i.revision = 0 }) } }, { key: "toJson", value: function () { return (0, u.serialize)(this) } }, { key: "fromJson", value: function (t) { var i = new f({ app: this.app }); return (0, u.update)(f, this, i.toJson()), (0, u.update)(f, this, t), this } }, { key: "isSaved", get: function () { return !!this.writeId } }, { key: "url", get: function () { var t = l.default.getUrl(), i = this.writeId, e = this.revision; return this.isSaved ? "".concat(t, "/#").concat(i, "/").concat(e) : t } }, { key: "title", get: function () { var t = this.fullLength, i = this.fullWidth, e = this.height; return "".concat(t, "m x ").concat(i, "m x ").concat(e, "m") } }, { key: "height", get: function () { var t = this, i = this.clampHeight(this._height), e = this.minAwningHeight, o = function () { return i + t.roofHeight }, n = function (t, o) { if (o.visible) { var n = t - function (t) { return t.roofHeight + t.heightOffset }(o); n < e && (i += e - n) } return i }; return i = n(this.isSkillionLeft ? o() : i, this.awningLeft), i = n(this.isSkillionRight ? o() : i, this.awningRight), i = Math.min(i, this.maxHeight), Math.round(100 * i) / 100 }, set: function (t) { this._height = this.clampHeight(t) } }, { key: "length", get: function () { return this.customBaySize ? this.baySizes.reduce(function (t, i) { return t + i }) : this._length }, set: function (t) { var i = l.default.clamp(t, this.minLength, this.maxLength), e = this.gableWallCount; if (this._length = i, this.switchSections(e), this.customBaySize) { var o, n = this.baySizes.concat([]); do { (o = i / n.length) > this.maxBaySize ? n.push(1) : (o < 3 || o < this.minBaySize) && n.splice(n.length - 1, 1), o = i / n.length } while (o > this.maxBaySize || o < this.minBaySize); for (var s = 0; s < n.length; s++)n[s] = o; this.baySizes = n } } }, { key: "roofPitch", set: function (t) { this._roofPitch = this.clampRoofPitch(t) }, get: function () { return this.clampRoofPitch(this._roofPitch) } }, { key: "width", set: function (t) { this._width = this.clampWidth(t) }, get: function () { return this.clampWidth(this._width) } }, { key: "longRoofWidth", get: function () { return this.width / 2 + Math.abs(this.roofOffset) } }, { key: "shortRoofWidth", get: function () { return this.width - this.longRoofWidth } }, { key: "apex", get: function () { return this.height + this.roofHeight } }, { key: "roofHeight", get: function () { return r.default.getOpposite(this.roofPitch, this.longRoofWidth) } }, { key: "shortRoofDistance", get: function () { return r.default.getDistance(this.shortRoofWidth, this.roofHeight) } }, { key: "shortRoofPitch", get: function () { return r.default.getOppositeAdjacentAngle(this.roofHeight, this.shortRoofWidth) } }, { key: "longRoofDistance", get: function () { return r.default.getDistance(this.longRoofWidth, this.roofHeight) } }, { key: "longRoofPitch", get: function () { return r.default.getOppositeAdjacentAngle(this.roofHeight, this.longRoofWidth) } }, { key: "leftLong", get: function () { return this.roofOffset > 0 } }, { key: "leftRoofWidth", get: function () { return this.leftLong ? this.longRoofWidth : this.shortRoofWidth } }, { key: "rightRoofWidth", get: function () { return this.leftLong ? this.shortRoofWidth : this.longRoofWidth } }, { key: "leftRoofDistance", get: function () { return this.leftLong ? this.longRoofDistance : this.shortRoofDistance } }, { key: "leftRoofPitch", get: function () { return this.leftLong ? this.longRoofPitch : this.shortRoofPitch } }, { key: "rightRoofPitch", get: function () { return this.leftLong ? this.shortRoofPitch : this.longRoofPitch } }, { key: "leftGutterHeight", get: function () { return this.isSkillionLeft ? this.apex : this.height } }, { key: "rightGutterHeight", get: function () { return this.isSkillionRight ? this.apex : this.height } }, { key: "rightRoofDistance", get: function () { return this.leftLong ? this.shortRoofDistance : this.longRoofDistance } }, { key: "gridWidth", get: function () { var t = 1; return this.awningLeft.visible && t++ , this.awningRight.visible && t++ , t } }, { key: "gridHeight", get: function () { return this.bayCount } }, { key: "roofCount", get: function () { return this.bayCount } }, { key: "gableWallCount", get: function () { return this.bayCount + 1 } }, { key: "gridGableWallCount", get: function () { return this.grid.rowSectionCount } }, { key: "gutterWallCount", get: function () { var t = 1; return this.awningRight.visible && t++ , this.awningLeft.visible && t++ , t + 1 } }, { key: "gridGutterWallCount", get: function () { return this.grid.columnSectionCount } }, { key: "grid", get: function () { return this._grid } }, { key: "fullWidth", get: function () { var t = this.width, i = this.awningRight, e = this.awningLeft; return i.visible && (t += this.awningRight.length), e.visible && (t += this.awningLeft.length), t } }, { key: "fullLength", get: function () { return this.length } }, { key: "customBaySize", get: function () { return this._customBaySize }, set: function (t) { var i = this.customBaySize, e = this.gableWallCount; if (i !== t) { var o = this.baySizes; this._baySizes = [], t ? this._baySizes = this.optimalBaySizes : this._length = o.reduce(function (t, i) { return t + i }) } this._customBaySize = t, this.switchSections(e) } }, { key: "isSkillion", get: function () { return this.width / 2 - Math.abs(this.roofOffset) < .01 } }, { key: "isSkillionRight", get: function () { return this.isSkillion && this.roofOffset > 0 } }, { key: "isSkillionLeft", get: function () { return this.isSkillion && this.roofOffset < 0 } }, { key: "isBarnType", get: function () { return [e.default.AustralianBarn, e.default.AmericanBarn, e.default.SkillionBarn].includes(this.shedType) } }, { key: "shedType", set: function (i) { var o = this, n = this._shedType; this._shedType = i, (0, t.transaction)(function () { var t = [e.default.AustralianBarn, e.default.AmericanBarn, e.default.SkillionBarn]; if (!t.includes(n) && t.includes(i) || t.includes(n) && !t.includes(i) || void 0 === n) { var s = t.includes(i); o.setAwningLeftEnclosed(s), o.setAwningRightEnclosed(s), o.setAwningsVisible(s) } switch (i) { case e.default.SkillionRight: case e.default.SkillionLeft: o.roofPitch = 5; break; case e.default.Gable: o.roofPitch = 11, o.setAwningsHeightOffset(0); break; case e.default.AmericanBarn: o.roofPitch = 11, o.setAwningsHeightOffset(1), o.setAwningsRoofPitch(5); break; case e.default.AustralianBarn: o.roofPitch = 11, o.setAwningsHeightOffset(0), o.setAwningsRoofPitch(5); break; case e.default.SkillionBarn: o.roofPitch = 5, o.setAwningsHeightOffset(1), o.setAwningsRoofPitch(5) } }) }, get: function () { return this._shedType } }, { key: "roofOffset", get: function () { var t = this._roofOffset, i = this.width / 2; switch (this.shedType) { case e.default.SkillionLeft: t = -i; break; case e.default.SkillionRight: case e.default.SkillionBarn: t = i }return l.default.clamp(t, -i, i) }, set: function (t) { this._roofOffset = t } }, { key: "optimalBaySizes", get: function () { for (var t = this.optimalBayCount, i = this.optimalBaySize, e = [], o = 0; o < t; o++)e.push(i); return e } }, { key: "optimalBaySize", get: function () { var t, i = this.length; return i <= (t = i < 12 ? 3 : 4) && (t = i), i / Math.floor(i / t) } }, { key: "optimalBayCount", get: function () { return Math.round(this.length / this.optimalBaySize) } }, { key: "bayCount", get: function () { return this.customBaySize ? this._baySizes.length : this.optimalBayCount } }, { key: "baySizes", get: function () { if (this.customBaySize) return this._baySizes; var t = this.bayCount; return new Array(t).fill(this.optimalBaySize) }, set: function (t) { var i = this; if (t.length > 0 && (t = t.map(function (t) { return l.default.clamp(t, i.minBaySize, i.maxBaySize) })).reduce(function (t, i) { return t + i }) < this.maxLength) { var e = this.gableWallCount; this._baySizes = t, this.switchSections(e) } } }, { key: "rightAwningGutterHeight", get: function () { return this.rightAwningApexHeight - this.awningRight.roofHeight } }, { key: "rightAwningApexHeight", get: function () { return this.rightGutterHeight - this.awningRight.heightOffset } }, { key: "leftAwningGutterHeight", get: function () { return this.leftAwningApexHeight - this.awningLeft.roofHeight } }, { key: "leftAwningApexHeight", get: function () { return this.leftGutterHeight - this.awningLeft.heightOffset } }, { key: "widths", get: function () { var t = []; return this.awningLeft.visible && t.push(this.awningLeft.length), t.push(this.width), this.awningRight.visible && t.push(this.awningRight.length), t } }, { key: "rotation", get: function () { return this._rotation }, set: function (t) { this._rotation = t % this.maxRotation } }, { key: "cornerFlashings", get: function () { for (var t = this, i = this.fullLength / 2, e = this.width / 2, o = { "top-right": [1, 0], "right-top": [0, 1], "right-bottom": [0, -1], "bottom-right": [1, 0], "bottom-left": [0, -1], "left-bottom": [-1, 0], "left-top": [0, 1], "top-left": [1, 0] }, n = ["top", "right", "bottom", "left"], s = [], r = -i, h = function (i) { for (var h = function (h) { for (var l = t.getSections(h, i), a = 0; a < n.length; a++) { var u = n[a], f = n[a + 1] || n[0];[[u, f], [f, u]].every(function (e) { var n = e[0], s = e[1], r = o["".concat(n, "-").concat(s)], l = t.getSections(h + r[0], i + r[1]); return !l || l && !l[n].visible }) && l[u].visible && l[f].visible; if (l && l[u].visible && l[f].visible) { var g = r; "bottom" !== u && "bottom" !== f || (g += t.baySizes[i]); var c = 0, p = 0; "right" === u || "right" === f ? (c -= e, p = t.rightGutterHeight) : "left" !== u && "left" !== f || (c += e, p = t.leftGutterHeight), s.push({ sections: { x: h, y: i }, direction: t.getDirection(u, f), height: p, position: { x: c, y: t.concreteHeight, z: -g } }) } } }, l = 0; l < t.gridWidth; l++)h(l); i < t.baySizes.length && (r += t.baySizes[i]) }, l = 0; l < this.gridHeight; l++)h(l); return s } }]), f }(); v([u.serializable, t.observable], b.prototype, "writeId", void 0), v([u.serializable, t.observable], b.prototype, "readId", void 0), v([u.serializable, t.observable], b.prototype, "revision", void 0), v([(0, u.serializable)((0, u.identifier)())], b.prototype, "id", void 0), v([u.serializable], b.prototype, "version", void 0), v([t.observable], b.prototype, "maxBays", void 0), v([t.observable], b.prototype, "maxBaySize", void 0), v([t.observable], b.prototype, "minBaySize", void 0), v([t.observable], b.prototype, "maxWidth", void 0), v([t.observable], b.prototype, "minWidth", void 0), v([t.observable], b.prototype, "maxLength", void 0), v([t.observable], b.prototype, "minLength", void 0), v([t.observable], b.prototype, "maxHeight", void 0), v([t.observable], b.prototype, "minHeight", void 0), v([t.observable], b.prototype, "minAwningHeight", void 0), v([t.observable], b.prototype, "minRoofPitch", void 0), v([t.observable], b.prototype, "maxRoofPitch", void 0), v([t.observable], b.prototype, "maxRotation", void 0), v([(0, u.serializable)((0, u.alias)("rotation", (0, u.primitive)())), t.observable], b.prototype, "_rotation", void 0), v([(0, u.serializable)((0, u.alias)("width", (0, u.primitive)())), u.serializable, t.observable], b.prototype, "_width", void 0), v([(0, u.serializable)((0, u.alias)("height", (0, u.primitive)())), u.serializable, t.observable], b.prototype, "_height", void 0), v([(0, u.serializable)((0, u.alias)("length", (0, u.primitive)())), t.observable], b.prototype, "_length", void 0), v([u.serializable, t.observable], b.prototype, "concreteHeight", void 0), v([(0, u.serializable)((0, u.alias)("roofPitch", (0, u.primitive)())), u.serializable, t.observable], b.prototype, "_roofPitch", void 0), v([t.observable], b.prototype, "_roofOffset", void 0), v([u.serializable, t.observable], b.prototype, "doorColour", void 0), v([u.serializable, t.observable], b.prototype, "flashingColour", void 0), v([u.serializable, t.observable], b.prototype, "roofColour", void 0), v([u.serializable, t.observable], b.prototype, "wallColour", void 0), v([u.serializable, t.observable], b.prototype, "wallSheeting", void 0), v([u.serializable, t.observable], b.prototype, "roofSheeting", void 0), v([(0, u.serializable)((0, u.alias)("customBaySize", (0, u.primitive)())), t.observable], b.prototype, "_customBaySize", void 0), v([(0, u.serializable)((0, u.alias)("shedType", (0, u.primitive)())), t.observable], b.prototype, "_shedType", void 0), v([(0, u.serializable)((0, u.alias)("baySizes", (0, u.list)((0, u.primitive)()))), t.observable], b.prototype, "_baySizes", void 0), v([(0, u.serializable)((0, u.alias)("grid", (0, u.object)(o.default))), t.observable], b.prototype, "_grid", void 0), v([(0, u.serializable)((0, u.alias)("roofSections", (0, u.list)((0, u.list)((0, u.object)(n.default))))), t.observable], b.prototype, "_roofSections", void 0), v([(0, u.serializable)((0, u.object)(s.default)), t.observable], b.prototype, "awningRight", void 0), v([(0, u.serializable)((0, u.object)(s.default)), t.observable], b.prototype, "awningLeft", void 0), v([t.observable], b.prototype, "view", void 0), v([t.observable], b.prototype, "inertialRadiusOffset", void 0), v([t.observable], b.prototype, "showLogo", void 0), v([t.observable], b.prototype, "showRotationText", void 0), v([t.observable], b.prototype, "showMeasurements", void 0), v([t.observable], b.prototype, "transparent", void 0), v([t.observable], b.prototype, "cameraPosition", void 0), v([t.computed], b.prototype, "isSaved", null), v([t.computed], b.prototype, "url", null), v([t.computed], b.prototype, "title", null), v([t.computed], b.prototype, "height", null), v([t.computed], b.prototype, "length", null), v([t.computed], b.prototype, "width", null), v([t.computed], b.prototype, "longRoofWidth", null), v([t.computed], b.prototype, "shortRoofWidth", null), v([t.computed], b.prototype, "apex", null), v([t.computed], b.prototype, "roofHeight", null), v([t.computed], b.prototype, "shortRoofDistance", null), v([t.computed], b.prototype, "shortRoofPitch", null), v([t.computed], b.prototype, "longRoofDistance", null), v([t.computed], b.prototype, "longRoofPitch", null), v([t.computed], b.prototype, "leftLong", null), v([t.computed], b.prototype, "leftRoofWidth", null), v([t.computed], b.prototype, "rightRoofWidth", null), v([t.computed], b.prototype, "leftRoofDistance", null), v([t.computed], b.prototype, "leftRoofPitch", null), v([t.computed], b.prototype, "rightRoofPitch", null), v([t.computed], b.prototype, "leftGutterHeight", null), v([t.computed], b.prototype, "rightGutterHeight", null), v([t.computed], b.prototype, "rightRoofDistance", null), v([t.computed], b.prototype, "gridWidth", null), v([t.computed], b.prototype, "gridHeight", null), v([t.computed], b.prototype, "roofCount", null), v([t.computed], b.prototype, "gableWallCount", null), v([t.computed], b.prototype, "gridGableWallCount", null), v([t.computed], b.prototype, "gutterWallCount", null), v([t.computed], b.prototype, "gridGutterWallCount", null), v([t.computed], b.prototype, "grid", null), v([t.computed], b.prototype, "fullWidth", null), v([t.computed], b.prototype, "fullLength", null), v([t.computed], b.prototype, "customBaySize", null), v([t.action], b.prototype, "setAwningRightVisible", null), v([t.action], b.prototype, "setAwningLeftVisible", null), v([t.action], b.prototype, "setAwningEnclose", null), v([t.action], b.prototype, "setAwningLeftEnclosed", null), v([t.action], b.prototype, "setAwningRightEnclosed", null), v([t.computed], b.prototype, "isSkillion", null), v([t.computed], b.prototype, "isSkillionRight", null), v([t.computed], b.prototype, "isSkillionLeft", null), v([t.computed], b.prototype, "isBarnType", null), v([t.computed], b.prototype, "optimalBaySize", null), v([t.computed], b.prototype, "optimalBayCount", null), v([t.computed], b.prototype, "bayCount", null), v([t.computed], b.prototype, "baySizes", null), v([t.computed], b.prototype, "rightAwningGutterHeight", null), v([t.computed], b.prototype, "rightAwningApexHeight", null), v([t.computed], b.prototype, "leftAwningGutterHeight", null), v([t.computed], b.prototype, "leftAwningApexHeight", null), v([t.computed], b.prototype, "widths", null), v([t.computed], b.prototype, "rotation", null), v([t.computed], b.prototype, "cornerFlashings", null), v([t.action], b.prototype, "fromJson", null); var m = b; exports.default = m;
    }, { "mobx": "6uYi", "../types/Sheeting": "uODF", "../types/ShedType": "BiVZ", "./Grid": "0bKu", "./Section": "t/JC", "./Awning": "1IgF", "../views/render/babylon/RenderUtils": "SyBU", "../types/View": "EZis", "../Utils": "r8Tc", "./Vector2": "TglT", "serializr": "94gV" }], "rC32": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var t = require("mobx"); function e(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } function n(t, e) { for (var n = 0; n < e.length; n++) { var r = e[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r) } } function r(t, e, r) { return e && n(t.prototype, e), r && n(t, r), t } function o(t) { return (o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(t) } var u = function (t, e, n, r) { var u, i = arguments.length, a = i < 3 ? e : null === r ? r = Object.getOwnPropertyDescriptor(e, n) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : o(Reflect)) && "function" == typeof Reflect.decorate) a = Reflect.decorate(t, e, n, r); else for (var c = t.length - 1; c >= 0; c--)(u = t[c]) && (a = (i < 3 ? u(a) : i > 3 ? u(e, n, a) : u(e, n)) || a); return i > 3 && a && Object.defineProperty(e, n, a), a }, i = function () { function t() { e(this, t), this.states = {}, this._currentStateId = null } return r(t, [{ key: "get", value: function (t) { return t ? this.states[t] : null } }, { key: "getCurrent", value: function () { var t = this.currentStateId; return t ? this.get(t) : null } }, { key: "set", value: function (t) { var e = this.currentStateId; if (e) { var n = this.get(e); n && n.onExit() } this._currentStateId = t; var r = this.get(t); r ? r.onEnter() : null !== t && console.warn("set state " + t + " does not exist.") } }, { key: "add", value: function (t) { this.states[t.id] = t, t.fms = this } }, { key: "currentStateId", get: function () { return this._currentStateId } }]), t }(); exports.default = i, u([t.observable], i.prototype, "_currentStateId", void 0), u([t.observable], i.prototype, "states", void 0), u([t.computed], i.prototype, "currentStateId", null), u([t.action], i.prototype, "set", null);
    }, { "mobx": "6uYi" }], "aeCS": [function (require, module, exports) {
        "use strict"; function e(e, n) { if (!(e instanceof n)) throw new TypeError("Cannot call a class as a function") } function n(e, n) { for (var t = 0; t < n.length; t++) { var r = n[t]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function t(e, t, r) { return t && n(e.prototype, t), r && n(e, r), e } Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var r = function () { function n(t) { e(this, n), this.id = t } return t(n, [{ key: "onEnter", value: function () { } }, { key: "onExit", value: function () { } }]), n }(); exports.default = r;
    }, {}], "rSnM": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"), o = require("serializr"); function t(e, o) { if (!(e instanceof o)) throw new TypeError("Cannot call a class as a function") } function r(e, o) { for (var t = 0; t < o.length; t++) { var r = o[t]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, o, t) { return o && r(e.prototype, o), t && r(e, t), e } function l(e) { return (l = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var a = function (e, o, t, r) { var i, a = arguments.length, n = a < 3 ? o : null === r ? r = Object.getOwnPropertyDescriptor(o, t) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : l(Reflect)) && "function" == typeof Reflect.decorate) n = Reflect.decorate(e, o, t, r); else for (var s = e.length - 1; s >= 0; s--)(i = e[s]) && (n = (a < 3 ? i(n) : a > 3 ? i(o, t, n) : i(o, t)) || n); return a > 3 && n && Object.defineProperty(o, t, n), n }, n = function () { function e() { t(this, e), this.mezzanineFloor = !1, this.shedSeal = !1, this.insulateRoof = !1, this.insulateWalls = !1 } return i(e, [{ key: "toJson", value: function () { return (0, o.serialize)(this) } }]), e }(); a([o.serializable, e.observable], n.prototype, "firstName", void 0), a([o.serializable, e.observable], n.prototype, "lastName", void 0), a([o.serializable, e.observable], n.prototype, "email", void 0), a([o.serializable, e.observable], n.prototype, "phoneNumber", void 0), a([o.serializable, e.observable], n.prototype, "address", void 0), a([o.serializable, e.observable], n.prototype, "comment", void 0), a([o.serializable, e.observable], n.prototype, "mezzanineFloor", void 0), a([o.serializable, e.observable], n.prototype, "shedSeal", void 0), a([o.serializable, e.observable], n.prototype, "insulateRoof", void 0), a([o.serializable, e.observable], n.prototype, "insulateWalls", void 0); var s = n; exports.default = s;
    }, { "mobx": "6uYi", "serializr": "94gV" }], "dpwK": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), Object.defineProperty(exports, "Config", { enumerable: !0, get: function () { return e.default } }), Object.defineProperty(exports, "Shed", { enumerable: !0, get: function () { return t.default } }), Object.defineProperty(exports, "FiniteStateMachine", { enumerable: !0, get: function () { return r.default } }), Object.defineProperty(exports, "Extras", { enumerable: !0, get: function () { return n.default } }), Object.defineProperty(exports, "NoOp", { enumerable: !0, get: function () { return u.default } }), Object.defineProperty(exports, "States", { enumerable: !0, get: function () { return i.default } }), Object.defineProperty(exports, "Quote", { enumerable: !0, get: function () { return o.default } }), Object.defineProperty(exports, "Customer", { enumerable: !0, get: function () { return a.default } }); var e = f(require("./Config")), t = f(require("./Shed")), r = f(require("./finiteStateMachine/FiniteStateMachine")), n = f(require("./editorStates/Extras")), u = f(require("./editorStates/NoOp")), i = f(require("./editorStates/States")), o = f(require("./Quote")), a = f(require("./Customer")); function f(e) { return e && e.__esModule ? e : { default: e } }
    }, { "./Config": "UxGm", "./Shed": "gupR", "./finiteStateMachine/FiniteStateMachine": "rC32", "./editorStates/Extras": "tINm", "./editorStates/NoOp": "aeCS", "./editorStates/States": "wK5u", "./Quote": "Wk4j", "./Customer": "rSnM" }], "h8gQ": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"); function t(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function o(e) { return (o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var n = function (e, t, n, r) { var f, c = arguments.length, i = c < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, n) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : o(Reflect)) && "function" == typeof Reflect.decorate) i = Reflect.decorate(e, t, n, r); else for (var l = e.length - 1; l >= 0; l--)(f = e[l]) && (i = (c < 3 ? f(i) : c > 3 ? f(t, n, i) : f(t, n)) || i); return c > 3 && i && Object.defineProperty(t, n, i), i }, r = function e() { t(this, e), this.loading = !1 }; exports.default = r, n([e.observable], r.prototype, "loading", void 0);
    }, { "mobx": "6uYi" }], "Dqcc": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"), t = require("serializr"); function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function o(e, t) { for (var r = 0; r < t.length; r++) { var o = t[r]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o) } } function i(e, t, r) { return t && o(e.prototype, t), r && o(e, r), e } function n(e) { return (n = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var l = function (e, t, r, o) { var i, l = arguments.length, a = l < 3 ? t : null === o ? o = Object.getOwnPropertyDescriptor(t, r) : o; if ("object" === ("undefined" == typeof Reflect ? "undefined" : n(Reflect)) && "function" == typeof Reflect.decorate) a = Reflect.decorate(e, t, r, o); else for (var s = e.length - 1; s >= 0; s--)(i = e[s]) && (a = (l < 3 ? i(a) : l > 3 ? i(t, r, a) : i(t, r)) || a); return l > 3 && a && Object.defineProperty(t, r, a), a }, a = function () { function e() { r(this, e), this.writeId = "", this.readId = "", this.revision = 0, this.width = 0, this.height = 0, this.length = 0, this.date = 0 } return i(e, null, [{ key: "fromShed", value: function (t) { var r = new e; return r.writeId = t.writeId || "", r.readId = t.readId || "", r.revision = t.revision, r.width = t.width, r.height = t.height, r.length = t.length, r.date = Date.now(), r } }]), e }(); exports.default = a, l([t.serializable, e.observable], a.prototype, "writeId", void 0), l([t.serializable, e.observable], a.prototype, "readId", void 0), l([t.serializable, e.observable], a.prototype, "revision", void 0), l([t.serializable, e.observable], a.prototype, "width", void 0), l([t.serializable, e.observable], a.prototype, "height", void 0), l([t.serializable, e.observable], a.prototype, "length", void 0), l([t.serializable, e.observable], a.prototype, "date", void 0);
    }, { "mobx": "6uYi", "serializr": "94gV" }], "ayyT": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = require("mobx"), t = n(require("./Save")), o = require("serializr"), r = n(require("../Utils")); function n(e) { return e && e.__esModule ? e : { default: e } } function s(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var o = 0; o < t.length; o++) { var r = t[o]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function a(e, t, o) { return t && i(e.prototype, t), o && i(e, o), e } function u(e) { return (u = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var f = function (e, t, o, r) { var n, s = arguments.length, i = s < 3 ? t : null === r ? r = Object.getOwnPropertyDescriptor(t, o) : r; if ("object" === ("undefined" == typeof Reflect ? "undefined" : u(Reflect)) && "function" == typeof Reflect.decorate) i = Reflect.decorate(e, t, o, r); else for (var a = e.length - 1; a >= 0; a--)(n = e[a]) && (i = (s < 3 ? n(i) : s > 3 ? n(t, o, i) : n(t, o)) || i); return s > 3 && i && Object.defineProperty(t, o, i), i }, l = function () { function e() { s(this, e), this.storageKey = "savedWebSheds", this.saves = []; var t = r.default.getItem(this.storageKey); if (t) try { this.fromJson(t) } catch (o) { this.saves = [], console.error("Failed to load from json", o) } this.save = r.default.debounce(this.save.bind(this), 100, !0) } return a(e, [{ key: "save", value: function () { console.log, r.default.setItem(this.storageKey, this.toJson()) } }, { key: "add", value: function (e) { for (var o = t.default.fromShed(e.shed), r = this.saves, n = -1, s = 0; s < r.length; s++)if (r[s].writeId === o.writeId) { n = s; break } -1 === n ? r.push(o) : r[n] = o, this.save() } }, { key: "remove", value: function (e) { var t = this.saves, o = t.indexOf(e); -1 !== o && t.splice(o, 1), this.save() } }, { key: "toJson", value: function () { return (0, o.serialize)(this) } }, { key: "asArray", value: function () { return this.saves } }, { key: "fromJson", value: function (t) { return this.saves = [], (0, o.update)(e, this, t), this } }]), e }(); exports.default = l, f([(0, o.serializable)((0, o.alias)("saves", (0, o.list)((0, o.object)(t.default)))), e.observable], l.prototype, "saves", void 0), f([e.action], l.prototype, "fromJson", null);
    }, { "mobx": "6uYi", "./Save": "Dqcc", "serializr": "94gV", "../Utils": "r8Tc" }], "zo2T": [function (require, module, exports) {
        "use strict"; Object.defineProperty(exports, "__esModule", { value: !0 }), exports.default = void 0; var e = c(require("react")), t = c(require("react-dom")), r = require("mobx-react"), n = u(require("axios")), s = u(require("./views/App")), i = require("./stores"), o = u(require("./stores/Request")), a = u(require("./stores/Saves")); function u(e) { return e && e.__esModule ? e : { default: e } } function c(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) if (Object.prototype.hasOwnProperty.call(e, r)) { var n = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(e, r) : {}; n.get || n.set ? Object.defineProperty(t, r, n) : t[r] = e[r] } return t.default = e, t } function d(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function l(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function f(e, t, r) { return t && l(e.prototype, t), r && l(e, r), e } var p = function () { function u(e) { d(this, u), this.id = e; var t = this._config = new i.Config({ baseUrl: "https://api.webshed.royssheds.com.au/api/v1", localSaveKey: "localShed" }); this._request = n.default.create({ baseURL: t.baseUrl }), this._stores = this.initState(), this.initInterceptors() } return f(u, [{ key: "stores", get: function () { return this._stores } }, { key: "config", get: function () { return this._config } }, { key: "request", get: function () { return this._request } }]), f(u, [{ key: "initState", value: function () { var e = new i.FiniteStateMachine; e.add(new i.NoOp(i.States.Size)), e.add(new i.NoOp(i.States.Colours)), e.add(new i.NoOp(i.States.Walls)), e.add(new i.NoOp(i.States.Quote)), e.add(new i.NoOp(i.States.Awnings)), e.add(new i.Extras); var t = new i.Shed({ app: this }); window.shed = t; var r = new i.Customer; return { shed: t, editor: e, quote: new i.Quote({ shed: t, customer: r }), request: new o.default, saves: new a.default } } }, { key: "initInterceptors", value: function () { var e = this._request, t = this.stores.request; e.interceptors.request.use(function (e) { return t.loading = !0, e }, function (e) { return t.loading = !1, Promise.reject(e) }), e.interceptors.response.use(function (e) { return t.loading = !1, e }, function (e) { return t.loading = !1, Promise.reject(e) }) } }, { key: "render", value: function () { t.render(e.createElement(r.Provider, Object.assign({}, this.stores), e.createElement("div", { className: "rs-container" }, e.createElement(s.default, { app: this }))), document.getElementById(this.id)) } }]), u }(); exports.default = p, window.RS = { Shed: p };
    }, { "react": "1n8/", "react-dom": "NKHc", "mobx-react": "lQiT", "axios": "dZBD", "./views/App": "ROXr", "./stores": "dpwK", "./stores/Request": "h8gQ", "./stores/Saves": "ayyT" }], "Yi9z": [function (require, module, exports) {
        module.exports = function (n) { return new Promise(function (e, o) { var r = document.createElement("script"); r.async = !0, r.type = "text/javascript", r.charset = "utf-8", r.src = n, r.onerror = function (n) { r.onerror = r.onload = null, o(n) }, r.onload = function () { r.onerror = r.onload = null, e() }, document.getElementsByTagName("head")[0].appendChild(r) }) };
    }, {}], 0: [function (require, module, exports) {
        var b = require("21/1"); b.register("js", require("Yi9z"));
    }, {}]
}, {}, [0, "zo2T"], null)